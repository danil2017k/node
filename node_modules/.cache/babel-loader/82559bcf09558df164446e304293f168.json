{"ast":null,"code":"require(\"core-js/modules/es.error.cause.js\");require(\"core-js/modules/es.typed-array.at.js\");require(\"core-js/modules/esnext.typed-array.find-last.js\");require(\"core-js/modules/esnext.typed-array.find-last-index.js\");/* build: `node build.js modules=ALL exclude=gestures,accessors requirejs minifier=uglifyjs` */ /*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */ // Version 4.0.0-rc.1\nvar fabric=fabric||{version:\"4.0.0-rc.1\"};if(typeof exports!==\"undefined\"){exports.fabric=fabric;}else if(typeof define===\"function\"&&define.amd){/* _AMD_START_ */define([],function(){return fabric;});}/* _AMD_END_ */if(typeof document!==\"undefined\"&&typeof window!==\"undefined\"){if(document instanceof(typeof HTMLDocument!==\"undefined\"?HTMLDocument:Document)){fabric.document=document;}else{fabric.document=document.implementation.createHTMLDocument(\"\");}fabric.window=window;}else{// assume we're running under node.js when document/window are not present\nvar jsdom=require(\"jsdom\");var virtualWindow=new jsdom.JSDOM(decodeURIComponent(\"%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E\"),{features:{FetchExternalResources:[\"img\"]},resources:\"usable\"}).window;fabric.document=virtualWindow.document;fabric.jsdomImplForWrapper=require(\"jsdom/lib/jsdom/living/generated/utils\").implForWrapper;fabric.nodeCanvas=require(\"jsdom/lib/jsdom/utils\").Canvas;fabric.window=virtualWindow;DOMParser=fabric.window.DOMParser;}/**\n * True when in environment that supports touch events\n * @type boolean\n */fabric.isTouchSupported=\"ontouchstart\"in fabric.window||\"ontouchstart\"in fabric.document||fabric.window&&fabric.window.navigator&&fabric.window.navigator.maxTouchPoints>0;/**\n * True when in environment that's probably Node.js\n * @type boolean\n */fabric.isLikelyNode=typeof Buffer!==\"undefined\"&&typeof window===\"undefined\";/* _FROM_SVG_START_ */ /**\n * Attributes parsed from all SVG elements\n * @type array\n */fabric.SHARED_ATTRIBUTES=[\"display\",\"transform\",\"fill\",\"fill-opacity\",\"fill-rule\",\"opacity\",\"stroke\",\"stroke-dasharray\",\"stroke-linecap\",\"stroke-dashoffset\",\"stroke-linejoin\",\"stroke-miterlimit\",\"stroke-opacity\",\"stroke-width\",\"id\",\"paint-order\",\"vector-effect\",\"instantiated_by_use\",\"clip-path\"];/* _FROM_SVG_END_ */ /**\n * Pixel per Inch as a default value set to 96. Can be changed for more realistic conversion.\n */fabric.DPI=96;fabric.reNum=\"(?:[-+]?(?:\\\\d+|\\\\d*\\\\.\\\\d+)(?:[eE][-+]?\\\\d+)?)\";fabric.rePathCommand=/([-+]?((\\d+\\.\\d+)|((\\d+)|(\\.\\d+)))(?:[eE][-+]?\\d+)?)/gi;fabric.reNonWord=/[ \\n\\.,;!\\?\\-]/;fabric.fontPaths={};fabric.iMatrix=[1,0,0,1,0,0];fabric.svgNS=\"http://www.w3.org/2000/svg\";/**\n * Pixel limit for cache canvases. 1Mpx , 4Mpx should be fine.\n * @since 1.7.14\n * @type Number\n * @default\n */fabric.perfLimitSizeTotal=2097152;/**\n * Pixel limit for cache canvases width or height. IE fixes the maximum at 5000\n * @since 1.7.14\n * @type Number\n * @default\n */fabric.maxCacheSideLimit=4096;/**\n * Lowest pixel limit for cache canvases, set at 256PX\n * @since 1.7.14\n * @type Number\n * @default\n */fabric.minCacheSideLimit=256;/**\n * Cache Object for widths of chars in text rendering.\n */fabric.charWidthsCache={};/**\n * if webgl is enabled and available, textureSize will determine the size\n * of the canvas backend\n * @since 2.0.0\n * @type Number\n * @default\n */fabric.textureSize=2048;/**\n * When 'true', style information is not retained when copy/pasting text, making\n * pasted text use destination style.\n * Defaults to 'false'.\n * @type Boolean\n * @default\n */fabric.disableStyleCopyPaste=false;/**\n * Enable webgl for filtering picture is available\n * A filtering backend will be initialized, this will both take memory and\n * time since a default 2048x2048 canvas will be created for the gl context\n * @since 2.0.0\n * @type Boolean\n * @default\n */fabric.enableGLFiltering=true;/**\n * Device Pixel Ratio\n * @see https://developer.apple.com/library/safari/documentation/AudioVideo/Conceptual/HTML-canvas-guide/SettingUptheCanvas/SettingUptheCanvas.html\n */fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;/**\n * Browser-specific constant to adjust CanvasRenderingContext2D.shadowBlur value,\n * which is unitless and not rendered equally across browsers.\n *\n * Values that work quite well (as of October 2017) are:\n * - Chrome: 1.5\n * - Edge: 1.75\n * - Firefox: 0.9\n * - Safari: 0.95\n *\n * @since 2.0.0\n * @type Number\n * @default 1\n */fabric.browserShadowBlurConstant=1;/**\n * This object contains the result of arc to beizer conversion for faster retrieving if the same arc needs to be converted again.\n * It was an internal variable, is accessible since version 2.3.4\n */fabric.arcToSegmentsCache={};/**\n * This object keeps the results of the boundsOfCurve calculation mapped by the joined arguments necessary to calculate it.\n * It does speed up calculation, if you parse and add always the same paths, but in case of heavy usage of freedrawing\n * you do not get any speed benefit and you get a big object in memory.\n * The object was a private variable before, while now is appended to the lib so that you have access to it and you\n * can eventually clear it.\n * It was an internal variable, is accessible since version 2.3.4\n */fabric.boundsOfCurveCache={};/**\n * If disabled boundsOfCurveCache is not used. For apps that make heavy usage of pencil drawing probably disabling it is better\n * @default true\n */fabric.cachesBoundsOfCurve=true;/**\n * Skip performance testing of setupGLContext and force the use of putImageData that seems to be the one that works best on\n * Chrome + old hardware. if your users are experiencing empty images after filtering you may try to force this to true\n * this has to be set before instantiating the filtering backend ( before filtering the first image )\n * @type Boolean\n * @default false\n */fabric.forceGLPutImageData=false;fabric.initFilterBackend=function(){if(fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)){console.log(\"max texture size: \"+fabric.maxTextureSize);return new fabric.WebglFilterBackend({tileSize:fabric.textureSize});}else if(fabric.Canvas2dFilterBackend){return new fabric.Canvas2dFilterBackend();}};if(typeof document!==\"undefined\"&&typeof window!==\"undefined\"){// ensure globality even if entire library were function wrapped (as in Meteor.js packaging system)\nwindow.fabric=fabric;}(function(){/**\n   * @private\n   * @param {String} eventName\n   * @param {Function} handler\n   */function _removeEventListener(eventName,handler){if(!this.__eventListeners[eventName]){return;}var eventListener=this.__eventListeners[eventName];if(handler){eventListener[eventListener.indexOf(handler)]=false;}else{fabric.util.array.fill(eventListener,false);}}/**\n   * Observes specified event\n   * @memberOf fabric.Observable\n   * @alias on\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function that receives a notification when an event of the specified type occurs\n   * @return {Self} thisArg\n   * @chainable\n   */function on(eventName,handler){if(!this.__eventListeners){this.__eventListeners={};}// one object with key/value pairs was passed\nif(arguments.length===1){for(var prop in eventName){this.on(prop,eventName[prop]);}}else{if(!this.__eventListeners[eventName]){this.__eventListeners[eventName]=[];}this.__eventListeners[eventName].push(handler);}return this;}/**\n   * Stops event observing for a particular event handler. Calling this method\n   * without arguments removes all handlers for all events\n   * @memberOf fabric.Observable\n   * @alias off\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function to be deleted from EventListeners\n   * @return {Self} thisArg\n   * @chainable\n   */function off(eventName,handler){if(!this.__eventListeners){return this;}// remove all key/value pairs (event name -> event handler)\nif(arguments.length===0){for(eventName in this.__eventListeners){_removeEventListener.call(this,eventName);}}// one object with key/value pairs was passed\nelse if(arguments.length===1&&typeof arguments[0]===\"object\"){for(var prop in eventName){_removeEventListener.call(this,prop,eventName[prop]);}}else{_removeEventListener.call(this,eventName,handler);}return this;}/**\n   * Fires event with an optional options object\n   * @memberOf fabric.Observable\n   * @param {String} eventName Event name to fire\n   * @param {Object} [options] Options object\n   * @return {Self} thisArg\n   * @chainable\n   */function fire(eventName,options){if(!this.__eventListeners){return this;}var listenersForEvent=this.__eventListeners[eventName];if(!listenersForEvent){return this;}for(var i=0,len=listenersForEvent.length;i<len;i++){listenersForEvent[i]&&listenersForEvent[i].call(this,options||{});}this.__eventListeners[eventName]=listenersForEvent.filter(function(value){return value!==false;});return this;}/**\n   * @namespace fabric.Observable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#events}\n   * @see {@link http://fabricjs.com/events|Events demo}\n   */fabric.Observable={fire:fire,on:on,off:off};})();/**\n * @namespace fabric.Collection\n */fabric.Collection={_objects:[],/**\n   * Adds objects to collection, Canvas or Group, then renders canvas\n   * (if `renderOnAddRemove` is not `false`).\n   * in case of Group no changes to bounding box are made.\n   * Objects should be instances of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the add method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */add:function(){this._objects.push.apply(this._objects,arguments);if(this._onObjectAdded){for(var i=0,length=arguments.length;i<length;i++){this._onObjectAdded(arguments[i]);}}this.renderOnAddRemove&&this.requestRenderAll();return this;},/**\n   * Inserts an object into collection at specified index, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * An object should be an instance of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the insertAt method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {Object} object Object to insert\n   * @param {Number} index Index to insert object at\n   * @param {Boolean} nonSplicing When `true`, no splicing (shifting) of objects occurs\n   * @return {Self} thisArg\n   * @chainable\n   */insertAt:function(object,index,nonSplicing){var objects=this._objects;if(nonSplicing){objects[index]=object;}else{objects.splice(index,0,object);}this._onObjectAdded&&this._onObjectAdded(object);this.renderOnAddRemove&&this.requestRenderAll();return this;},/**\n   * Removes objects from a collection, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */remove:function(){var objects=this._objects,index,somethingRemoved=false;for(var i=0,length=arguments.length;i<length;i++){index=objects.indexOf(arguments[i]);// only call onObjectRemoved if an object was actually removed\nif(index!==-1){somethingRemoved=true;objects.splice(index,1);this._onObjectRemoved&&this._onObjectRemoved(arguments[i]);}}this.renderOnAddRemove&&somethingRemoved&&this.requestRenderAll();return this;},/**\n   * Executes given function for each object in this group\n   * @param {Function} callback\n   *                   Callback invoked with current object as first argument,\n   *                   index - as second and an array of all objects - as third.\n   *                   Callback is invoked in a context of Global Object (e.g. `window`)\n   *                   when no `context` argument is given\n   *\n   * @param {Object} context Context (aka thisObject)\n   * @return {Self} thisArg\n   * @chainable\n   */forEachObject:function(callback,context){var objects=this.getObjects();for(var i=0,len=objects.length;i<len;i++){callback.call(context,objects[i],i,objects);}return this;},/**\n   * Returns an array of children objects of this instance\n   * Type parameter introduced in 1.3.10\n   * since 2.3.5 this method return always a COPY of the array;\n   * @param {String} [type] When specified, only objects of this type are returned\n   * @return {Array}\n   */getObjects:function(type){if(typeof type===\"undefined\"){return this._objects.concat();}return this._objects.filter(function(o){return o.type===type;});},/**\n   * Returns object at specified index\n   * @param {Number} index\n   * @return {Self} thisArg\n   */item:function(index){return this._objects[index];},/**\n   * Returns true if collection contains no objects\n   * @return {Boolean} true if collection is empty\n   */isEmpty:function(){return this._objects.length===0;},/**\n   * Returns a size of a collection (i.e: length of an array containing its objects)\n   * @return {Number} Collection size\n   */size:function(){return this._objects.length;},/**\n   * Returns true if collection contains an object\n   * @param {Object} object Object to check against\n   * @return {Boolean} `true` if collection contains an object\n   */contains:function(object){return this._objects.indexOf(object)>-1;},/**\n   * Returns number representation of a collection complexity\n   * @return {Number} complexity\n   */complexity:function(){return this._objects.reduce(function(memo,current){memo+=current.complexity?current.complexity():0;return memo;},0);}};/**\n * @namespace fabric.CommonMethods\n */fabric.CommonMethods={/**\n   * Sets object's properties from options\n   * @param {Object} [options] Options object\n   */_setOptions:function(options){for(var prop in options){this.set(prop,options[prop]);}},/**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Gradient to\n   */_initGradient:function(filler,property){if(filler&&filler.colorStops&&!(filler instanceof fabric.Gradient)){this.set(property,new fabric.Gradient(filler));}},/**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Pattern to\n   * @param {Function} [callback] callback to invoke after pattern load\n   */_initPattern:function(filler,property,callback){if(filler&&filler.source&&!(filler instanceof fabric.Pattern)){this.set(property,new fabric.Pattern(filler,callback));}else{callback&&callback();}},/**\n   * @private\n   */_setObject:function(obj){for(var prop in obj){this._set(prop,obj[prop]);}},/**\n   * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n   * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n   * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */set:function(key,value){if(typeof key===\"object\"){this._setObject(key);}else{this._set(key,value);}return this;},_set:function(key,value){this[key]=value;},/**\n   * Toggles specified property from `true` to `false` or from `false` to `true`\n   * @param {String} property Property to toggle\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */toggle:function(property){var value=this.get(property);if(typeof value===\"boolean\"){this.set(property,!value);}return this;},/**\n   * Basic getter\n   * @param {String} property Property name\n   * @return {*} value of a property\n   */get:function(property){return this[property];}};(function(global){var sqrt=Math.sqrt,atan2=Math.atan2,pow=Math.pow,PiBy180=Math.PI/180,PiBy2=Math.PI/2;/**\n   * @namespace fabric.util\n   */fabric.util={/**\n     * Calculate the cos of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */cos:function(angle){if(angle===0){return 1;}if(angle<0){// cos(a) = cos(-a)\nangle=-angle;}var angleSlice=angle/PiBy2;switch(angleSlice){case 1:case 3:return 0;case 2:return-1;}return Math.cos(angle);},/**\n     * Calculate the sin of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */sin:function(angle){if(angle===0){return 0;}var angleSlice=angle/PiBy2,sign=1;if(angle<0){// sin(-a) = -sin(a)\nsign=-1;}switch(angleSlice){case 1:return sign;case 2:return 0;case 3:return-sign;}return Math.sin(angle);},/**\n     * Removes value from an array.\n     * Presence of value (and its position in an array) is determined via `Array.prototype.indexOf`\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} array\n     * @param {*} value\n     * @return {Array} original array\n     */removeFromArray:function(array,value){var idx=array.indexOf(value);if(idx!==-1){array.splice(idx,1);}return array;},/**\n     * Returns random number between 2 specified ones.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} min lower limit\n     * @param {Number} max upper limit\n     * @return {Number} random value (between min and max)\n     */getRandomInt:function(min,max){return Math.floor(Math.random()*(max-min+1))+min;},/**\n     * Transforms degrees to radians.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} degrees value in degrees\n     * @return {Number} value in radians\n     */degreesToRadians:function(degrees){return degrees*PiBy180;},/**\n     * Transforms radians to degrees.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} radians value in radians\n     * @return {Number} value in degrees\n     */radiansToDegrees:function(radians){return radians/PiBy180;},/**\n     * Rotates `point` around `origin` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {fabric.Point} point The point to rotate\n     * @param {fabric.Point} origin The origin of the rotation\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {fabric.Point} The new rotated point\n     */rotatePoint:function(point,origin,radians){point.subtractEquals(origin);var v=fabric.util.rotateVector(point,radians);return new fabric.Point(v.x,v.y).addEquals(origin);},/**\n     * Rotates `vector` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} vector The vector to rotate (x and y)\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {Object} The new rotated point\n     */rotateVector:function(vector,radians){var sin=fabric.util.sin(radians),cos=fabric.util.cos(radians),rx=vector.x*cos-vector.y*sin,ry=vector.x*sin+vector.y*cos;return{x:rx,y:ry};},/**\n     * Apply transform t to point p\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Point} p The point to transform\n     * @param  {Array} t The transform\n     * @param  {Boolean} [ignoreOffset] Indicates that the offset should not be applied\n     * @return {fabric.Point} The transformed point\n     */transformPoint:function(p,t,ignoreOffset){if(ignoreOffset){return new fabric.Point(t[0]*p.x+t[2]*p.y,t[1]*p.x+t[3]*p.y);}return new fabric.Point(t[0]*p.x+t[2]*p.y+t[4],t[1]*p.x+t[3]*p.y+t[5]);},/**\n     * Returns coordinates of points's bounding rectangle (left, top, width, height)\n     * @param {Array} points 4 points array\n     * @param {Array} [transform] an array of 6 numbers representing a 2x3 transform matrix\n     * @return {Object} Object with left, top, width, height properties\n     */makeBoundingBoxFromPoints:function(points,transform){if(transform){for(var i=0;i<points.length;i++){points[i]=fabric.util.transformPoint(points[i],transform);}}var xPoints=[points[0].x,points[1].x,points[2].x,points[3].x],minX=fabric.util.array.min(xPoints),maxX=fabric.util.array.max(xPoints),width=maxX-minX,yPoints=[points[0].y,points[1].y,points[2].y,points[3].y],minY=fabric.util.array.min(yPoints),maxY=fabric.util.array.max(yPoints),height=maxY-minY;return{left:minX,top:minY,width:width,height:height};},/**\n     * Invert transformation t\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} t The transform\n     * @return {Array} The inverted transform\n     */invertTransform:function(t){var a=1/(t[0]*t[3]-t[1]*t[2]),r=[a*t[3],-a*t[1],-a*t[2],a*t[0]],o=fabric.util.transformPoint({x:t[4],y:t[5]},r,true);r[4]=-o.x;r[5]=-o.y;return r;},/**\n     * A wrapper around Number#toFixed, which contrary to native method returns number, not string.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number|String} number number to operate on\n     * @param {Number} fractionDigits number of fraction digits to \"leave\"\n     * @return {Number}\n     */toFixed:function(number,fractionDigits){return parseFloat(Number(number).toFixed(fractionDigits));},/**\n     * Converts from attribute value to pixel value if applicable.\n     * Returns converted pixels or original value not converted.\n     * @param {Number|String} value number to operate on\n     * @param {Number} fontSize\n     * @return {Number|String}\n     */parseUnit:function(value,fontSize){var unit=/\\D{0,2}$/.exec(value),number=parseFloat(value);if(!fontSize){fontSize=fabric.Text.DEFAULT_SVG_FONT_SIZE;}switch(unit[0]){case\"mm\":return number*fabric.DPI/25.4;case\"cm\":return number*fabric.DPI/2.54;case\"in\":return number*fabric.DPI;case\"pt\":return number*fabric.DPI/72;// or * 4 / 3\ncase\"pc\":return number*fabric.DPI/72*12;// or * 16\ncase\"em\":return number*fontSize;default:return number;}},/**\n     * Function which always returns `false`.\n     * @static\n     * @memberOf fabric.util\n     * @return {Boolean}\n     */falseFunction:function(){return false;},/**\n     * Returns klass \"Class\" object of given namespace\n     * @memberOf fabric.util\n     * @param {String} type Type of object (eg. 'circle')\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @return {Object} klass \"Class\"\n     */getKlass:function(type,namespace){// capitalize first letter only\ntype=fabric.util.string.camelize(type.charAt(0).toUpperCase()+type.slice(1));return fabric.util.resolveNamespace(namespace)[type];},/**\n     * Returns array of attributes for given svg that fabric parses\n     * @memberOf fabric.util\n     * @param {String} type Type of svg element (eg. 'circle')\n     * @return {Array} string names of supported attributes\n     */getSvgAttributes:function(type){var attributes=[\"instantiated_by_use\",\"style\",\"id\",\"class\"];switch(type){case\"linearGradient\":attributes=attributes.concat([\"x1\",\"y1\",\"x2\",\"y2\",\"gradientUnits\",\"gradientTransform\"]);break;case\"radialGradient\":attributes=attributes.concat([\"gradientUnits\",\"gradientTransform\",\"cx\",\"cy\",\"r\",\"fx\",\"fy\",\"fr\"]);break;case\"stop\":attributes=attributes.concat([\"offset\",\"stop-color\",\"stop-opacity\"]);break;}return attributes;},/**\n     * Returns object of given namespace\n     * @memberOf fabric.util\n     * @param {String} namespace Namespace string e.g. 'fabric.Image.filter' or 'fabric'\n     * @return {Object} Object for given namespace (default fabric)\n     */resolveNamespace:function(namespace){if(!namespace){return fabric;}var parts=namespace.split(\".\"),len=parts.length,i,obj=global||fabric.window;for(i=0;i<len;++i){obj=obj[parts[i]];}return obj;},/**\n     * Loads image element from given url and passes it to a callback\n     * @memberOf fabric.util\n     * @param {String} url URL representing an image\n     * @param {Function} callback Callback; invoked with loaded image\n     * @param {*} [context] Context to invoke callback in\n     * @param {Object} [crossOrigin] crossOrigin value to set image element to\n     */loadImage:function(url,callback,context,crossOrigin){if(!url){callback&&callback.call(context,url);return;}var img=fabric.util.createImage();/** @ignore */var onLoadCallback=function(){callback&&callback.call(context,img,false);img=img.onload=img.onerror=null;};img.onload=onLoadCallback;/** @ignore */img.onerror=function(){fabric.log(\"Error loading \"+img.src);callback&&callback.call(context,null,true);img=img.onload=img.onerror=null;};// data-urls appear to be buggy with crossOrigin\n// https://github.com/kangax/fabric.js/commit/d0abb90f1cd5c5ef9d2a94d3fb21a22330da3e0a#commitcomment-4513767\n// see https://code.google.com/p/chromium/issues/detail?id=315152\n//     https://bugzilla.mozilla.org/show_bug.cgi?id=935069\n// crossOrigin null is the same as not set.\nif(url.indexOf(\"data\")!==0&&crossOrigin!==undefined&&crossOrigin!==null){img.crossOrigin=crossOrigin;}// IE10 / IE11-Fix: SVG contents from data: URI\n// will only be available if the IMG is present\n// in the DOM (and visible)\nif(url.substring(0,14)===\"data:image/svg\"){img.onload=null;fabric.util.loadImageInDom(img,onLoadCallback);}img.src=url;},/**\n     * Attaches SVG image with data: URL to the dom\n     * @memberOf fabric.util\n     * @param {Object} img Image object with data:image/svg src\n     * @param {Function} callback Callback; invoked with loaded image\n     * @return {Object} DOM element (div containing the SVG image)\n     */loadImageInDom:function(img,onLoadCallback){var div=fabric.document.createElement(\"div\");div.style.width=div.style.height=\"1px\";div.style.left=div.style.top=\"-100%\";div.style.position=\"absolute\";div.appendChild(img);fabric.document.querySelector(\"body\").appendChild(div);/**\n       * Wrap in function to:\n       *   1. Call existing callback\n       *   2. Cleanup DOM\n       */img.onload=function(){onLoadCallback();div.parentNode.removeChild(div);div=null;};},/**\n     * Creates corresponding fabric instances from their object representations\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} objects Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @param {Function} reviver Method for further parsing of object elements,\n     * called after each fabric object created.\n     */enlivenObjects:function(objects,callback,namespace,reviver){objects=objects||[];var enlivenedObjects=[],numLoadedObjects=0,numTotalObjects=objects.length;function onLoaded(){if(++numLoadedObjects===numTotalObjects){callback&&callback(enlivenedObjects.filter(function(obj){// filter out undefined objects (objects that gave error)\nreturn obj;}));}}if(!numTotalObjects){callback&&callback(enlivenedObjects);return;}objects.forEach(function(o,index){// if sparse array\nif(!o||!o.type){onLoaded();return;}var klass=fabric.util.getKlass(o.type,namespace);klass.fromObject(o,function(obj,error){error||(enlivenedObjects[index]=obj);reviver&&reviver(o,obj,error);onLoaded();});});},/**\n     * Create and wait for loading of patterns\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} patterns Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * called after each fabric object created.\n     */enlivenPatterns:function(patterns,callback){patterns=patterns||[];function onLoaded(){if(++numLoadedPatterns===numPatterns){callback&&callback(enlivenedPatterns);}}var enlivenedPatterns=[],numLoadedPatterns=0,numPatterns=patterns.length;if(!numPatterns){callback&&callback(enlivenedPatterns);return;}patterns.forEach(function(p,index){if(p&&p.source){new fabric.Pattern(p,function(pattern){enlivenedPatterns[index]=pattern;onLoaded();});}else{enlivenedPatterns[index]=p;onLoaded();}});},/**\n     * Groups SVG elements (usually those retrieved from SVG document)\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} elements SVG elements to group\n     * @param {Object} [options] Options object\n     * @param {String} path Value to set sourcePath to\n     * @return {fabric.Object|fabric.Group}\n     */groupSVGElements:function(elements,options,path){var object;if(elements&&elements.length===1){return elements[0];}if(options){if(options.width&&options.height){options.centerPoint={x:options.width/2,y:options.height/2};}else{delete options.width;delete options.height;}}object=new fabric.Group(elements,options);if(typeof path!==\"undefined\"){object.sourcePath=path;}return object;},/**\n     * Populates an object with properties of another object\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} source Source object\n     * @param {Object} destination Destination object\n     * @return {Array} properties Properties names to include\n     */populateWithProperties:function(source,destination,properties){if(properties&&Object.prototype.toString.call(properties)===\"[object Array]\"){for(var i=0,len=properties.length;i<len;i++){if(properties[i]in source){destination[properties[i]]=source[properties[i]];}}}},/**\n     * Draws a dashed line between two points\n     *\n     * This method is used to draw dashed line around selection area.\n     * See <a href=\"http://stackoverflow.com/questions/4576724/dotted-stroke-in-canvas\">dotted stroke in canvas</a>\n     *\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x  start x coordinate\n     * @param {Number} y start y coordinate\n     * @param {Number} x2 end x coordinate\n     * @param {Number} y2 end y coordinate\n     * @param {Array} da dash array pattern\n     */drawDashedLine:function(ctx,x,y,x2,y2,da){var dx=x2-x,dy=y2-y,len=sqrt(dx*dx+dy*dy),rot=atan2(dy,dx),dc=da.length,di=0,draw=true;ctx.save();ctx.translate(x,y);ctx.moveTo(0,0);ctx.rotate(rot);x=0;while(len>x){x+=da[di++%dc];if(x>len){x=len;}ctx[draw?\"lineTo\":\"moveTo\"](x,0);draw=!draw;}ctx.restore();},/**\n     * Creates canvas element\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */createCanvasElement:function(){return fabric.document.createElement(\"canvas\");},/**\n     * Creates a canvas element that is a copy of another and is also painted\n     * @param {CanvasElement} canvas to copy size and content of\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */copyCanvasElement:function(canvas){var newCanvas=fabric.util.createCanvasElement();newCanvas.width=canvas.width;newCanvas.height=canvas.height;newCanvas.getContext(\"2d\").drawImage(canvas,0,0);return newCanvas;},/**\n     * since 2.6.0 moved from canvas instance to utility.\n     * @param {CanvasElement} canvasEl to copy size and content of\n     * @param {String} format 'jpeg' or 'png', in some browsers 'webp' is ok too\n     * @param {Number} quality <= 1 and > 0\n     * @static\n     * @memberOf fabric.util\n     * @return {String} data url\n     */toDataURL:function(canvasEl,format,quality){return canvasEl.toDataURL(\"image/\"+format,quality);},/**\n     * Creates image element (works on client and node)\n     * @static\n     * @memberOf fabric.util\n     * @return {HTMLImageElement} HTML image element\n     */createImage:function(){return fabric.document.createElement(\"img\");},/**\n     * Multiply matrix A by matrix B to nest transformations\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a First transformMatrix\n     * @param  {Array} b Second transformMatrix\n     * @param  {Boolean} is2x2 flag to multiply matrices as 2x2 matrices\n     * @return {Array} The product of the two transform matrices\n     */multiplyTransformMatrices:function(a,b,is2x2){// Matrix multiply a * b\nreturn[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],is2x2?0:a[0]*b[4]+a[2]*b[5]+a[4],is2x2?0:a[1]*b[4]+a[3]*b[5]+a[5]];},/**\n     * Decomposes standard 2x3 matrix into transform components\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a transformMatrix\n     * @return {Object} Components of transform\n     */qrDecompose:function(a){var angle=atan2(a[1],a[0]),denom=pow(a[0],2)+pow(a[1],2),scaleX=sqrt(denom),scaleY=(a[0]*a[3]-a[2]*a[1])/scaleX,skewX=atan2(a[0]*a[2]+a[1]*a[3],denom);return{angle:angle/PiBy180,scaleX:scaleX,scaleY:scaleY,skewX:skewX/PiBy180,skewY:0,translateX:a[4],translateY:a[5]};},/**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.angle] angle in degrees\n     * @return {Number[]} transform matrix\n     */calcRotateMatrix:function(options){if(!options.angle){return fabric.iMatrix.concat();}var theta=fabric.util.degreesToRadians(options.angle),cos=fabric.util.cos(theta),sin=fabric.util.sin(theta);return[cos,sin,-sin,cos,0,0];},/**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet.\n     * is called DimensionsTransformMatrix because those properties are the one that influence\n     * the size of the resulting box of the object.\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.scaleX]\n     * @param  {Number} [options.scaleY]\n     * @param  {Boolean} [options.flipX]\n     * @param  {Boolean} [options.flipY]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.skewX]\n     * @return {Number[]} transform matrix\n     */calcDimensionsMatrix:function(options){var scaleX=typeof options.scaleX===\"undefined\"?1:options.scaleX,scaleY=typeof options.scaleY===\"undefined\"?1:options.scaleY,scaleMatrix=[options.flipX?-scaleX:scaleX,0,0,options.flipY?-scaleY:scaleY,0,0],multiply=fabric.util.multiplyTransformMatrices,degreesToRadians=fabric.util.degreesToRadians;if(options.skewX){scaleMatrix=multiply(scaleMatrix,[1,0,Math.tan(degreesToRadians(options.skewX)),1],true);}if(options.skewY){scaleMatrix=multiply(scaleMatrix,[1,Math.tan(degreesToRadians(options.skewY)),0,1],true);}return scaleMatrix;},/**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.angle]\n     * @param  {Number} [options.scaleX]\n     * @param  {Number} [options.scaleY]\n     * @param  {Boolean} [options.flipX]\n     * @param  {Boolean} [options.flipY]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.translateX]\n     * @param  {Number} [options.translateY]\n     * @return {Number[]} transform matrix\n     */composeMatrix:function(options){var matrix=[1,0,0,1,options.translateX||0,options.translateY||0],multiply=fabric.util.multiplyTransformMatrices;if(options.angle){matrix=multiply(matrix,fabric.util.calcRotateMatrix(options));}if(options.scaleX!==1||options.scaleY!==1||options.skewX||options.skewY||options.flipX||options.flipY){matrix=multiply(matrix,fabric.util.calcDimensionsMatrix(options));}return matrix;},/**\n     * reset an object transform state to neutral. Top and left are not accounted for\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to transform\n     */resetObjectTransform:function(target){target.scaleX=1;target.scaleY=1;target.skewX=0;target.skewY=0;target.flipX=false;target.flipY=false;target.rotate(0);},/**\n     * Extract Object transform values\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to read from\n     * @return {Object} Components of transform\n     */saveObjectTransform:function(target){return{scaleX:target.scaleX,scaleY:target.scaleY,skewX:target.skewX,skewY:target.skewY,angle:target.angle,left:target.left,flipX:target.flipX,flipY:target.flipY,top:target.top};},/**\n     * Returns true if context has transparent pixel\n     * at specified location (taking tolerance into account)\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x x coordinate\n     * @param {Number} y y coordinate\n     * @param {Number} tolerance Tolerance\n     */isTransparent:function(ctx,x,y,tolerance){// If tolerance is > 0 adjust start coords to take into account.\n// If moves off Canvas fix to 0\nif(tolerance>0){if(x>tolerance){x-=tolerance;}else{x=0;}if(y>tolerance){y-=tolerance;}else{y=0;}}var _isTransparent=true,i,temp,imageData=ctx.getImageData(x,y,tolerance*2||1,tolerance*2||1),l=imageData.data.length;// Split image data - for tolerance > 1, pixelDataSize = 4;\nfor(i=3;i<l;i+=4){temp=imageData.data[i];_isTransparent=temp<=0;if(_isTransparent===false){break;// Stop if colour found\n}}imageData=null;return _isTransparent;},/**\n     * Parse preserveAspectRatio attribute from element\n     * @param {string} attribute to be parsed\n     * @return {Object} an object containing align and meetOrSlice attribute\n     */parsePreserveAspectRatioAttribute:function(attribute){var meetOrSlice=\"meet\",alignX=\"Mid\",alignY=\"Mid\",aspectRatioAttrs=attribute.split(\" \"),align;if(aspectRatioAttrs&&aspectRatioAttrs.length){meetOrSlice=aspectRatioAttrs.pop();if(meetOrSlice!==\"meet\"&&meetOrSlice!==\"slice\"){align=meetOrSlice;meetOrSlice=\"meet\";}else if(aspectRatioAttrs.length){align=aspectRatioAttrs.pop();}}//divide align in alignX and alignY\nalignX=align!==\"none\"?align.slice(1,4):\"none\";alignY=align!==\"none\"?align.slice(5,8):\"none\";return{meetOrSlice:meetOrSlice,alignX:alignX,alignY:alignY};},/**\n     * Clear char widths cache for the given font family or all the cache if no\n     * fontFamily is specified.\n     * Use it if you know you are loading fonts in a lazy way and you are not waiting\n     * for custom fonts to load properly when adding text objects to the canvas.\n     * If a text object is added when its own font is not loaded yet, you will get wrong\n     * measurement and so wrong bounding boxes.\n     * After the font cache is cleared, either change the textObject text content or call\n     * initDimensions() to trigger a recalculation\n     * @memberOf fabric.util\n     * @param {String} [fontFamily] font family to clear\n     */clearFabricFontCache:function(fontFamily){fontFamily=(fontFamily||\"\").toLowerCase();if(!fontFamily){fabric.charWidthsCache={};}else if(fabric.charWidthsCache[fontFamily]){delete fabric.charWidthsCache[fontFamily];}},/**\n     * Given current aspect ratio, determines the max width and height that can\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Number} ar aspect ratio\n     * @param {Number} maximumArea Maximum area you want to achieve\n     * @return {Object.x} Limited dimensions by X\n     * @return {Object.y} Limited dimensions by Y\n     */limitDimsByArea:function(ar,maximumArea){var roughWidth=Math.sqrt(maximumArea*ar),perfLimitSizeY=Math.floor(maximumArea/roughWidth);return{x:Math.floor(roughWidth),y:perfLimitSizeY};},capValue:function(min,value,max){return Math.max(min,Math.min(value,max));},/**\n     * Finds the scale for the object source to fit inside the object destination,\n     * keeping aspect ratio intact.\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Object | fabric.Object} source\n     * @param {Number} source.height natural unscaled height of the object\n     * @param {Number} source.width natural unscaled width of the object\n     * @param {Object | fabric.Object} destination\n     * @param {Number} destination.height natural unscaled height of the object\n     * @param {Number} destination.width natural unscaled width of the object\n     * @return {Number} scale factor to apply to source to fit into destination\n     */findScaleToFit:function(source,destination){return Math.min(destination.width/source.width,destination.height/source.height);},/**\n     * Finds the scale for the object source to cover entirely the object destination,\n     * keeping aspect ratio intact.\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Object | fabric.Object} source\n     * @param {Number} source.height natural unscaled height of the object\n     * @param {Number} source.width natural unscaled width of the object\n     * @param {Object | fabric.Object} destination\n     * @param {Number} destination.height natural unscaled height of the object\n     * @param {Number} destination.width natural unscaled width of the object\n     * @return {Number} scale factor to apply to source to cover destination\n     */findScaleToCover:function(source,destination){return Math.max(destination.width/source.width,destination.height/source.height);},/**\n     * given an array of 6 number returns something like `\"matrix(...numbers)\"`\n     * @memberOf fabric.util\n     * @param {Array} trasnform an array with 6 numbers\n     * @return {String} transform matrix for svg\n     * @return {Object.y} Limited dimensions by Y\n     */matrixToSVG:function(transform){return\"matrix(\"+transform.map(function(value){return fabric.util.toFixed(value,fabric.Object.NUM_FRACTION_DIGITS);}).join(\" \")+\")\";},/**\n     * given a width and height, return the size of the bounding box\n     * that can contains the box with width/height with applied transform\n     * described in options.\n     * Use to calculate the boxes around objects for controls.\n     * @memberOf fabric.util\n     * @param {Number} width\n     * @param {Number} height\n     * @param {Object} options\n     * @param {Number} options.scaleX\n     * @param {Number} options.scaleY\n     * @param {Number} options.skewX\n     * @param {Number} options.skewY\n     * @return {Object.x} width of containing\n     * @return {Object.y} height of containing\n     */sizeAfterTransform:function(width,height,options){var dimX=width/2,dimY=height/2,points=[{x:-dimX,y:-dimY},{x:dimX,y:-dimY},{x:-dimX,y:dimY},{x:dimX,y:dimY}],transformMatrix=fabric.util.calcDimensionsMatrix(options),bbox=fabric.util.makeBoundingBoxFromPoints(points,transformMatrix);return{x:bbox.width,y:bbox.height};}};})(typeof exports!==\"undefined\"?exports:this);(function(){var _join=Array.prototype.join;/* Adapted from http://dxr.mozilla.org/mozilla-central/source/content/svg/content/src/nsSVGPathDataParser.cpp\n   * by Andrea Bogazzi code is under MPL. if you don't have a copy of the license you can take it here\n   * http://mozilla.org/MPL/2.0/\n   */function arcToSegments(toX,toY,rx,ry,large,sweep,rotateX){var argsString=_join.call(arguments);if(fabric.arcToSegmentsCache[argsString]){return fabric.arcToSegmentsCache[argsString];}var PI=Math.PI,th=rotateX*PI/180,sinTh=fabric.util.sin(th),cosTh=fabric.util.cos(th),fromX=0,fromY=0;rx=Math.abs(rx);ry=Math.abs(ry);var px=-cosTh*toX*0.5-sinTh*toY*0.5,py=-cosTh*toY*0.5+sinTh*toX*0.5,rx2=rx*rx,ry2=ry*ry,py2=py*py,px2=px*px,pl=rx2*ry2-rx2*py2-ry2*px2,root=0;if(pl<0){var s=Math.sqrt(1-pl/(rx2*ry2));rx*=s;ry*=s;}else{root=(large===sweep?-1.0:1.0)*Math.sqrt(pl/(rx2*py2+ry2*px2));}var cx=root*rx*py/ry,cy=-root*ry*px/rx,cx1=cosTh*cx-sinTh*cy+toX*0.5,cy1=sinTh*cx+cosTh*cy+toY*0.5,mTheta=calcVectorAngle(1,0,(px-cx)/rx,(py-cy)/ry),dtheta=calcVectorAngle((px-cx)/rx,(py-cy)/ry,(-px-cx)/rx,(-py-cy)/ry);if(sweep===0&&dtheta>0){dtheta-=2*PI;}else if(sweep===1&&dtheta<0){dtheta+=2*PI;}// Convert into cubic bezier segments <= 90deg\nvar segments=Math.ceil(Math.abs(dtheta/PI*2)),result=[],mDelta=dtheta/segments,mT=8/3*Math.sin(mDelta/4)*Math.sin(mDelta/4)/Math.sin(mDelta/2),th3=mTheta+mDelta;for(var i=0;i<segments;i++){result[i]=segmentToBezier(mTheta,th3,cosTh,sinTh,rx,ry,cx1,cy1,mT,fromX,fromY);fromX=result[i][4];fromY=result[i][5];mTheta=th3;th3+=mDelta;}fabric.arcToSegmentsCache[argsString]=result;return result;}function segmentToBezier(th2,th3,cosTh,sinTh,rx,ry,cx1,cy1,mT,fromX,fromY){var costh2=fabric.util.cos(th2),sinth2=fabric.util.sin(th2),costh3=fabric.util.cos(th3),sinth3=fabric.util.sin(th3),toX=cosTh*rx*costh3-sinTh*ry*sinth3+cx1,toY=sinTh*rx*costh3+cosTh*ry*sinth3+cy1,cp1X=fromX+mT*(-cosTh*rx*sinth2-sinTh*ry*costh2),cp1Y=fromY+mT*(-sinTh*rx*sinth2+cosTh*ry*costh2),cp2X=toX+mT*(cosTh*rx*sinth3+sinTh*ry*costh3),cp2Y=toY+mT*(sinTh*rx*sinth3-cosTh*ry*costh3);return[cp1X,cp1Y,cp2X,cp2Y,toX,toY];}/*\n   * Private\n   */function calcVectorAngle(ux,uy,vx,vy){var ta=Math.atan2(uy,ux),tb=Math.atan2(vy,vx);if(tb>=ta){return tb-ta;}else{return 2*Math.PI-(ta-tb);}}/**\n   * Draws arc\n   * @param {CanvasRenderingContext2D} ctx\n   * @param {Number} fx\n   * @param {Number} fy\n   * @param {Array} coords\n   */fabric.util.drawArc=function(ctx,fx,fy,coords){var rx=coords[0],ry=coords[1],rot=coords[2],large=coords[3],sweep=coords[4],tx=coords[5],ty=coords[6],segs=[[],[],[],[]],segsNorm=arcToSegments(tx-fx,ty-fy,rx,ry,large,sweep,rot);for(var i=0,len=segsNorm.length;i<len;i++){segs[i][0]=segsNorm[i][0]+fx;segs[i][1]=segsNorm[i][1]+fy;segs[i][2]=segsNorm[i][2]+fx;segs[i][3]=segsNorm[i][3]+fy;segs[i][4]=segsNorm[i][4]+fx;segs[i][5]=segsNorm[i][5]+fy;ctx.bezierCurveTo.apply(ctx,segs[i]);}};/**\n   * Calculate bounding box of a elliptic-arc\n   * @param {Number} fx start point of arc\n   * @param {Number} fy\n   * @param {Number} rx horizontal radius\n   * @param {Number} ry vertical radius\n   * @param {Number} rot angle of horizontal axe\n   * @param {Number} large 1 or 0, whatever the arc is the big or the small on the 2 points\n   * @param {Number} sweep 1 or 0, 1 clockwise or counterclockwise direction\n   * @param {Number} tx end point of arc\n   * @param {Number} ty\n   */fabric.util.getBoundsOfArc=function(fx,fy,rx,ry,rot,large,sweep,tx,ty){var fromX=0,fromY=0,bound,bounds=[],segs=arcToSegments(tx-fx,ty-fy,rx,ry,large,sweep,rot);for(var i=0,len=segs.length;i<len;i++){bound=getBoundsOfCurve(fromX,fromY,segs[i][0],segs[i][1],segs[i][2],segs[i][3],segs[i][4],segs[i][5]);bounds.push({x:bound[0].x+fx,y:bound[0].y+fy});bounds.push({x:bound[1].x+fx,y:bound[1].y+fy});fromX=segs[i][4];fromY=segs[i][5];}return bounds;};/**\n   * Calculate bounding box of a beziercurve\n   * @param {Number} x0 starting point\n   * @param {Number} y0\n   * @param {Number} x1 first control point\n   * @param {Number} y1\n   * @param {Number} x2 secondo control point\n   * @param {Number} y2\n   * @param {Number} x3 end of beizer\n   * @param {Number} y3\n   */ // taken from http://jsbin.com/ivomiq/56/edit  no credits available for that.\nfunction getBoundsOfCurve(x0,y0,x1,y1,x2,y2,x3,y3){var argsString;if(fabric.cachesBoundsOfCurve){argsString=_join.call(arguments);if(fabric.boundsOfCurveCache[argsString]){return fabric.boundsOfCurveCache[argsString];}}var sqrt=Math.sqrt,min=Math.min,max=Math.max,abs=Math.abs,tvalues=[],bounds=[[],[]],a,b,c,t,t1,t2,b2ac,sqrtb2ac;b=6*x0-12*x1+6*x2;a=-3*x0+9*x1-9*x2+3*x3;c=3*x1-3*x0;for(var i=0;i<2;++i){if(i>0){b=6*y0-12*y1+6*y2;a=-3*y0+9*y1-9*y2+3*y3;c=3*y1-3*y0;}if(abs(a)<1e-12){if(abs(b)<1e-12){continue;}t=-c/b;if(0<t&&t<1){tvalues.push(t);}continue;}b2ac=b*b-4*c*a;if(b2ac<0){continue;}sqrtb2ac=sqrt(b2ac);t1=(-b+sqrtb2ac)/(2*a);if(0<t1&&t1<1){tvalues.push(t1);}t2=(-b-sqrtb2ac)/(2*a);if(0<t2&&t2<1){tvalues.push(t2);}}var x,y,j=tvalues.length,jlen=j,mt;while(j--){t=tvalues[j];mt=1-t;x=mt*mt*mt*x0+3*mt*mt*t*x1+3*mt*t*t*x2+t*t*t*x3;bounds[0][j]=x;y=mt*mt*mt*y0+3*mt*mt*t*y1+3*mt*t*t*y2+t*t*t*y3;bounds[1][j]=y;}bounds[0][jlen]=x0;bounds[1][jlen]=y0;bounds[0][jlen+1]=x3;bounds[1][jlen+1]=y3;var result=[{x:min.apply(null,bounds[0]),y:min.apply(null,bounds[1])},{x:max.apply(null,bounds[0]),y:max.apply(null,bounds[1])}];if(fabric.cachesBoundsOfCurve){fabric.boundsOfCurveCache[argsString]=result;}return result;}fabric.util.getBoundsOfCurve=getBoundsOfCurve;})();(function(){var slice=Array.prototype.slice;/**\n   * Invokes method on all items in a given array\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} method Name of a method to invoke\n   * @return {Array}\n   */function invoke(array,method){var args=slice.call(arguments,2),result=[];for(var i=0,len=array.length;i<len;i++){result[i]=args.length?array[i][method].apply(array[i],args):array[i][method].call(array[i]);}return result;}/**\n   * Finds maximum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */function max(array,byProperty){return find(array,byProperty,function(value1,value2){return value1>=value2;});}/**\n   * Finds minimum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */function min(array,byProperty){return find(array,byProperty,function(value1,value2){return value1<value2;});}/**\n   * @private\n   */function fill(array,value){var k=array.length;while(k--){array[k]=value;}return array;}/**\n   * @private\n   */function find(array,byProperty,condition){if(!array||array.length===0){return;}var i=array.length-1,result=byProperty?array[i][byProperty]:array[i];if(byProperty){while(i--){if(condition(array[i][byProperty],result)){result=array[i][byProperty];}}}else{while(i--){if(condition(array[i],result)){result=array[i];}}}return result;}/**\n   * @namespace fabric.util.array\n   */fabric.util.array={fill:fill,invoke:invoke,min:min,max:max};})();(function(){/**\n   * Copies all enumerable properties of one js object to another\n   * this does not and cannot compete with generic utils.\n   * Does not clone or extend fabric.Object subclasses.\n   * This is mostly for internal use and has extra handling for fabricJS objects\n   * it skips the canvas and group properties in deep cloning.\n   * @memberOf fabric.util.object\n   * @param {Object} destination Where to copy to\n   * @param {Object} source Where to copy from\n   * @return {Object}\n   */function extend(destination,source,deep){// JScript DontEnum bug is not taken care of\n// the deep clone is for internal use, is not meant to avoid\n// javascript traps or cloning html element or self referenced objects.\nif(deep){if(!fabric.isLikelyNode&&source instanceof Element){// avoid cloning deep images, canvases,\ndestination=source;}else if(source instanceof Array){destination=[];for(var i=0,len=source.length;i<len;i++){destination[i]=extend({},source[i],deep);}}else if(source&&typeof source===\"object\"){for(var property in source){if(property===\"canvas\"||property===\"group\"){// we do not want to clone this props at all.\n// we want to keep the keys in the copy\ndestination[property]=null;}else if(source.hasOwnProperty(property)){destination[property]=extend({},source[property],deep);}}}else{// this sounds odd for an extend but is ok for recursive use\ndestination=source;}}else{for(var property in source){destination[property]=source[property];}}return destination;}/**\n   * Creates an empty object and copies all enumerable properties of another object to it\n   * @memberOf fabric.util.object\n   * TODO: this function return an empty object if you try to clone null\n   * @param {Object} object Object to clone\n   * @return {Object}\n   */function clone(object,deep){return extend({},object,deep);}/** @namespace fabric.util.object */fabric.util.object={extend:extend,clone:clone};fabric.util.object.extend(fabric.util,fabric.Observable);})();(function(){/**\n   * Camelizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to camelize\n   * @return {String} Camelized version of a string\n   */function camelize(string){return string.replace(/-+(.)?/g,function(match,character){return character?character.toUpperCase():\"\";});}/**\n   * Capitalizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to capitalize\n   * @param {Boolean} [firstLetterOnly] If true only first letter is capitalized\n   * and other letters stay untouched, if false first letter is capitalized\n   * and other letters are converted to lowercase.\n   * @return {String} Capitalized version of a string\n   */function capitalize(string,firstLetterOnly){return string.charAt(0).toUpperCase()+(firstLetterOnly?string.slice(1):string.slice(1).toLowerCase());}/**\n   * Escapes XML in a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to escape\n   * @return {String} Escaped version of a string\n   */function escapeXml(string){return string.replace(/&/g,\"&amp;\").replace(/\"/g,\"&quot;\").replace(/'/g,\"&apos;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\");}/**\n   * Divide a string in the user perceived single units\n   * @memberOf fabric.util.string\n   * @param {String} textstring String to escape\n   * @return {Array} array containing the graphemes\n   */function graphemeSplit(textstring){var i=0,chr,graphemes=[];for(i=0,chr;i<textstring.length;i++){if((chr=getWholeChar(textstring,i))===false){continue;}graphemes.push(chr);}return graphemes;}// taken from mdn in the charAt doc page.\nfunction getWholeChar(str,i){var code=str.charCodeAt(i);if(isNaN(code)){return\"\";// Position not found\n}if(code<0xd800||code>0xdfff){return str.charAt(i);}// High surrogate (could change last hex to 0xDB7F to treat high private\n// surrogates as single characters)\nif(0xd800<=code&&code<=0xdbff){if(str.length<=i+1){throw\"High surrogate without following low surrogate\";}var next=str.charCodeAt(i+1);if(0xdc00>next||next>0xdfff){throw\"High surrogate without following low surrogate\";}return str.charAt(i)+str.charAt(i+1);}// Low surrogate (0xDC00 <= code && code <= 0xDFFF)\nif(i===0){throw\"Low surrogate without preceding high surrogate\";}var prev=str.charCodeAt(i-1);// (could change last hex to 0xDB7F to treat high private\n// surrogates as single characters)\nif(0xd800>prev||prev>0xdbff){throw\"Low surrogate without preceding high surrogate\";}// We can pass over low surrogates now as the second component\n// in a pair which we have already processed\nreturn false;}/**\n   * String utilities\n   * @namespace fabric.util.string\n   */fabric.util.string={camelize:camelize,capitalize:capitalize,escapeXml:escapeXml,graphemeSplit:graphemeSplit};})();(function(){var slice=Array.prototype.slice,emptyFunction=function(){},IS_DONTENUM_BUGGY=function(){for(var p in{toString:1}){if(p===\"toString\"){return false;}}return true;}(),/** @ignore */addMethods=function(klass,source,parent){for(var property in source){if(property in klass.prototype&&typeof klass.prototype[property]===\"function\"&&(source[property]+\"\").indexOf(\"callSuper\")>-1){klass.prototype[property]=function(property){return function(){var superclass=this.constructor.superclass;this.constructor.superclass=parent;var returnValue=source[property].apply(this,arguments);this.constructor.superclass=superclass;if(property!==\"initialize\"){return returnValue;}};}(property);}else{klass.prototype[property]=source[property];}if(IS_DONTENUM_BUGGY){if(source.toString!==Object.prototype.toString){klass.prototype.toString=source.toString;}if(source.valueOf!==Object.prototype.valueOf){klass.prototype.valueOf=source.valueOf;}}}};function Subclass(){}function callSuper(methodName){var parentMethod=null,_this=this;// climb prototype chain to find method not equal to callee's method\nwhile(_this.constructor.superclass){var superClassMethod=_this.constructor.superclass.prototype[methodName];if(_this[methodName]!==superClassMethod){parentMethod=superClassMethod;break;}// eslint-disable-next-line\n_this=_this.constructor.superclass.prototype;}if(!parentMethod){return console.log(\"tried to callSuper \"+methodName+\", method not found in prototype chain\",this);}return arguments.length>1?parentMethod.apply(this,slice.call(arguments,1)):parentMethod.call(this);}/**\n   * Helper for creation of \"classes\".\n   * @memberOf fabric.util\n   * @param {Function} [parent] optional \"Class\" to inherit from\n   * @param {Object} [properties] Properties shared by all instances of this class\n   *                  (be careful modifying objects defined here as this would affect all instances)\n   */function createClass(){var parent=null,properties=slice.call(arguments,0);if(typeof properties[0]===\"function\"){parent=properties.shift();}function klass(){this.initialize.apply(this,arguments);}klass.superclass=parent;klass.subclasses=[];if(parent){Subclass.prototype=parent.prototype;klass.prototype=new Subclass();parent.subclasses.push(klass);}for(var i=0,length=properties.length;i<length;i++){addMethods(klass,properties[i],parent);}if(!klass.prototype.initialize){klass.prototype.initialize=emptyFunction;}klass.prototype.constructor=klass;klass.prototype.callSuper=callSuper;return klass;}fabric.util.createClass=createClass;})();(function(){// since ie11 can use addEventListener but they do not support options, i need to check\nvar couldUseAttachEvent=!!fabric.document.createElement(\"div\").attachEvent,touchEvents=[\"touchstart\",\"touchmove\",\"touchend\"];/**\n   * Adds an event listener to an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */fabric.util.addListener=function(element,eventName,handler,options){element&&element.addEventListener(eventName,handler,couldUseAttachEvent?false:options);};/**\n   * Removes an event listener from an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */fabric.util.removeListener=function(element,eventName,handler,options){element&&element.removeEventListener(eventName,handler,couldUseAttachEvent?false:options);};function getTouchInfo(event){var touchProp=event.changedTouches;if(touchProp&&touchProp[0]){return touchProp[0];}return event;}fabric.util.getPointer=function(event){var element=event.target,scroll=fabric.util.getScrollLeftTop(element),_evt=getTouchInfo(event);return{x:_evt.clientX+scroll.left,y:_evt.clientY+scroll.top};};fabric.util.isTouchEvent=function(event){return touchEvents.indexOf(event.type)>-1||event.pointerType===\"touch\";};})();(function(){/**\n   * Cross-browser wrapper for setting element's style\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {Object} styles\n   * @return {HTMLElement} Element that was passed as a first argument\n   */function setStyle(element,styles){var elementStyle=element.style;if(!elementStyle){return element;}if(typeof styles===\"string\"){element.style.cssText+=\";\"+styles;return styles.indexOf(\"opacity\")>-1?setOpacity(element,styles.match(/opacity:\\s*(\\d?\\.?\\d*)/)[1]):element;}for(var property in styles){if(property===\"opacity\"){setOpacity(element,styles[property]);}else{var normalizedProperty=property===\"float\"||property===\"cssFloat\"?typeof elementStyle.styleFloat===\"undefined\"?\"cssFloat\":\"styleFloat\":property;elementStyle[normalizedProperty]=styles[property];}}return element;}var parseEl=fabric.document.createElement(\"div\"),supportsOpacity=typeof parseEl.style.opacity===\"string\",supportsFilters=typeof parseEl.style.filter===\"string\",reOpacity=/alpha\\s*\\(\\s*opacity\\s*=\\s*([^\\)]+)\\)/,/** @ignore */setOpacity=function(element){return element;};if(supportsOpacity){/** @ignore */setOpacity=function(element,value){element.style.opacity=value;return element;};}else if(supportsFilters){/** @ignore */setOpacity=function(element,value){var es=element.style;if(element.currentStyle&&!element.currentStyle.hasLayout){es.zoom=1;}if(reOpacity.test(es.filter)){value=value>=0.9999?\"\":\"alpha(opacity=\"+value*100+\")\";es.filter=es.filter.replace(reOpacity,value);}else{es.filter+=\" alpha(opacity=\"+value*100+\")\";}return element;};}fabric.util.setStyle=setStyle;})();(function(){var _slice=Array.prototype.slice;/**\n   * Takes id and returns an element with that id (if one exists in a document)\n   * @memberOf fabric.util\n   * @param {String|HTMLElement} id\n   * @return {HTMLElement|null}\n   */function getById(id){return typeof id===\"string\"?fabric.document.getElementById(id):id;}var sliceCanConvertNodelists,/**\n     * Converts an array-like object (e.g. arguments or NodeList) to an array\n     * @memberOf fabric.util\n     * @param {Object} arrayLike\n     * @return {Array}\n     */toArray=function(arrayLike){return _slice.call(arrayLike,0);};try{sliceCanConvertNodelists=toArray(fabric.document.childNodes)instanceof Array;}catch(err){}if(!sliceCanConvertNodelists){toArray=function(arrayLike){var arr=new Array(arrayLike.length),i=arrayLike.length;while(i--){arr[i]=arrayLike[i];}return arr;};}/**\n   * Creates specified element with specified attributes\n   * @memberOf fabric.util\n   * @param {String} tagName Type of an element to create\n   * @param {Object} [attributes] Attributes to set on an element\n   * @return {HTMLElement} Newly created element\n   */function makeElement(tagName,attributes){var el=fabric.document.createElement(tagName);for(var prop in attributes){if(prop===\"class\"){el.className=attributes[prop];}else if(prop===\"for\"){el.htmlFor=attributes[prop];}else{el.setAttribute(prop,attributes[prop]);}}return el;}/**\n   * Adds class to an element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to add class to\n   * @param {String} className Class to add to an element\n   */function addClass(element,className){if(element&&(\" \"+element.className+\" \").indexOf(\" \"+className+\" \")===-1){element.className+=(element.className?\" \":\"\")+className;}}/**\n   * Wraps element with another element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to wrap\n   * @param {HTMLElement|String} wrapper Element to wrap with\n   * @param {Object} [attributes] Attributes to set on a wrapper\n   * @return {HTMLElement} wrapper\n   */function wrapElement(element,wrapper,attributes){if(typeof wrapper===\"string\"){wrapper=makeElement(wrapper,attributes);}if(element.parentNode){element.parentNode.replaceChild(wrapper,element);}wrapper.appendChild(element);return wrapper;}/**\n   * Returns element scroll offsets\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to operate on\n   * @return {Object} Object with left/top values\n   */function getScrollLeftTop(element){var left=0,top=0,docElement=fabric.document.documentElement,body=fabric.document.body||{scrollLeft:0,scrollTop:0};// While loop checks (and then sets element to) .parentNode OR .host\n//  to account for ShadowDOM. We still want to traverse up out of ShadowDOM,\n//  but the .parentNode of a root ShadowDOM node will always be null, instead\n//  it should be accessed through .host. See http://stackoverflow.com/a/24765528/4383938\nwhile(element&&(element.parentNode||element.host)){// Set element to element parent, or 'host' in case of ShadowDOM\nelement=element.parentNode||element.host;if(element===fabric.document){left=body.scrollLeft||docElement.scrollLeft||0;top=body.scrollTop||docElement.scrollTop||0;}else{left+=element.scrollLeft||0;top+=element.scrollTop||0;}if(element.nodeType===1&&element.style.position===\"fixed\"){break;}}return{left:left,top:top};}/**\n   * Returns offset for a given element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get offset for\n   * @return {Object} Object with \"left\" and \"top\" properties\n   */function getElementOffset(element){var docElem,doc=element&&element.ownerDocument,box={left:0,top:0},offset={left:0,top:0},scrollLeftTop,offsetAttributes={borderLeftWidth:\"left\",borderTopWidth:\"top\",paddingLeft:\"left\",paddingTop:\"top\"};if(!doc){return offset;}for(var attr in offsetAttributes){offset[offsetAttributes[attr]]+=parseInt(getElementStyle(element,attr),10)||0;}docElem=doc.documentElement;if(typeof element.getBoundingClientRect!==\"undefined\"){box=element.getBoundingClientRect();}scrollLeftTop=getScrollLeftTop(element);return{left:box.left+scrollLeftTop.left-(docElem.clientLeft||0)+offset.left,top:box.top+scrollLeftTop.top-(docElem.clientTop||0)+offset.top};}/**\n   * Returns style attribute value of a given element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get style attribute for\n   * @param {String} attr Style attribute to get for element\n   * @return {String} Style attribute value of the given element.\n   */var getElementStyle;if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle){getElementStyle=function(element,attr){var style=fabric.document.defaultView.getComputedStyle(element,null);return style?style[attr]:undefined;};}else{getElementStyle=function(element,attr){var value=element.style[attr];if(!value&&element.currentStyle){value=element.currentStyle[attr];}return value;};}(function(){var style=fabric.document.documentElement.style,selectProp=\"userSelect\"in style?\"userSelect\":\"MozUserSelect\"in style?\"MozUserSelect\":\"WebkitUserSelect\"in style?\"WebkitUserSelect\":\"KhtmlUserSelect\"in style?\"KhtmlUserSelect\":\"\";/**\n     * Makes element unselectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make unselectable\n     * @return {HTMLElement} Element that was passed in\n     */function makeElementUnselectable(element){if(typeof element.onselectstart!==\"undefined\"){element.onselectstart=fabric.util.falseFunction;}if(selectProp){element.style[selectProp]=\"none\";}else if(typeof element.unselectable===\"string\"){element.unselectable=\"on\";}return element;}/**\n     * Makes element selectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make selectable\n     * @return {HTMLElement} Element that was passed in\n     */function makeElementSelectable(element){if(typeof element.onselectstart!==\"undefined\"){element.onselectstart=null;}if(selectProp){element.style[selectProp]=\"\";}else if(typeof element.unselectable===\"string\"){element.unselectable=\"\";}return element;}fabric.util.makeElementUnselectable=makeElementUnselectable;fabric.util.makeElementSelectable=makeElementSelectable;})();function getNodeCanvas(element){var impl=fabric.jsdomImplForWrapper(element);return impl._canvas||impl._image;}function cleanUpJsdomNode(element){if(!fabric.isLikelyNode){return;}var impl=fabric.jsdomImplForWrapper(element);if(impl){impl._image=null;impl._canvas=null;// unsure if necessary\nimpl._currentSrc=null;impl._attributes=null;impl._classList=null;}}function setImageSmoothing(ctx,value){ctx.imageSmoothingEnabled=ctx.imageSmoothingEnabled||ctx.webkitImageSmoothingEnabled||ctx.mozImageSmoothingEnabled||ctx.msImageSmoothingEnabled||ctx.oImageSmoothingEnabled;ctx.imageSmoothingEnabled=value;}/**\n   * setImageSmoothing sets the context imageSmoothingEnabled property.\n   * Used by canvas and by ImageObject.\n   * @memberOf fabric.util\n   * @since 4.0.0\n   * @param {HTMLRenderingContext2D} ctx to set on\n   * @param {Boolean} value true or false\n   */fabric.util.setImageSmoothing=setImageSmoothing;fabric.util.getById=getById;fabric.util.toArray=toArray;fabric.util.addClass=addClass;fabric.util.makeElement=makeElement;fabric.util.wrapElement=wrapElement;fabric.util.getScrollLeftTop=getScrollLeftTop;fabric.util.getElementOffset=getElementOffset;fabric.util.getNodeCanvas=getNodeCanvas;fabric.util.cleanUpJsdomNode=cleanUpJsdomNode;})();(function(){function addParamToUrl(url,param){return url+(/\\?/.test(url)?\"&\":\"?\")+param;}function emptyFn(){}/**\n   * Cross-browser abstraction for sending XMLHttpRequest\n   * @memberOf fabric.util\n   * @param {String} url URL to send XMLHttpRequest to\n   * @param {Object} [options] Options object\n   * @param {String} [options.method=\"GET\"]\n   * @param {String} [options.parameters] parameters to append to url in GET or in body\n   * @param {String} [options.body] body to send with POST or PUT request\n   * @param {Function} options.onComplete Callback to invoke when request is completed\n   * @return {XMLHttpRequest} request\n   */function request(url,options){options||(options={});var method=options.method?options.method.toUpperCase():\"GET\",onComplete=options.onComplete||function(){},xhr=new fabric.window.XMLHttpRequest(),body=options.body||options.parameters;/** @ignore */xhr.onreadystatechange=function(){if(xhr.readyState===4){onComplete(xhr);xhr.onreadystatechange=emptyFn;}};if(method===\"GET\"){body=null;if(typeof options.parameters===\"string\"){url=addParamToUrl(url,options.parameters);}}xhr.open(method,url,true);if(method===\"POST\"||method===\"PUT\"){xhr.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");}xhr.send(body);return xhr;}fabric.util.request=request;})();/**\n * Wrapper around `console.log` (when available)\n * @param {*} [values] Values to log\n */fabric.log=console.log;/**\n * Wrapper around `console.warn` (when available)\n * @param {*} [values] Values to log as a warning\n */fabric.warn=console.warn;(function(){function noop(){return false;}function defaultEasing(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;}/**\n   * Changes value from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Number} [options.startValue=0] Starting value\n   * @param {Number} [options.endValue=100] Ending value\n   * @param {Number} [options.byValue=100] Value to modify the property by\n   * @param {Function} [options.easing] Easing function\n   * @param {Number} [options.duration=500] Duration of change (in ms)\n   * @param {Function} [options.abort] Additional function with logic. If returns true, onComplete is called.\n   */function animate(options){requestAnimFrame(function(timestamp){options||(options={});var start=timestamp||+new Date(),duration=options.duration||500,finish=start+duration,time,onChange=options.onChange||noop,abort=options.abort||noop,onComplete=options.onComplete||noop,easing=options.easing||defaultEasing,startValue=\"startValue\"in options?options.startValue:0,endValue=\"endValue\"in options?options.endValue:100,byValue=options.byValue||endValue-startValue;options.onStart&&options.onStart();(function tick(ticktime){// TODO: move abort call after calculation\n// and pass (current,valuePerc, timePerc) as arguments\ntime=ticktime||+new Date();var currentTime=time>finish?duration:time-start,timePerc=currentTime/duration,current=easing(currentTime,startValue,byValue,duration),valuePerc=Math.abs((current-startValue)/byValue);if(abort()){onComplete(endValue,1,1);return;}if(time>finish){onChange(endValue,1,1);onComplete(endValue,1,1);return;}else{onChange(current,valuePerc,timePerc);requestAnimFrame(tick);}})(start);});}var _requestAnimFrame=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(callback){return fabric.window.setTimeout(callback,1000/60);};var _cancelAnimFrame=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;/**\n   * requestAnimationFrame polyfill based on http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n   * In order to get a precise start time, `requestAnimFrame` should be called as an entry into the method\n   * @memberOf fabric.util\n   * @param {Function} callback Callback to invoke\n   * @param {DOMElement} element optional Element to associate with animation\n   */function requestAnimFrame(){return _requestAnimFrame.apply(fabric.window,arguments);}function cancelAnimFrame(){return _cancelAnimFrame.apply(fabric.window,arguments);}fabric.util.animate=animate;fabric.util.requestAnimFrame=requestAnimFrame;fabric.util.cancelAnimFrame=cancelAnimFrame;})();(function(){// Calculate an in-between color. Returns a \"rgba()\" string.\n// Credit: Edwin Martin <edwin@bitstorm.org>\n//         http://www.bitstorm.org/jquery/color-animation/jquery.animate-colors.js\nfunction calculateColor(begin,end,pos){var color=\"rgba(\"+parseInt(begin[0]+pos*(end[0]-begin[0]),10)+\",\"+parseInt(begin[1]+pos*(end[1]-begin[1]),10)+\",\"+parseInt(begin[2]+pos*(end[2]-begin[2]),10);color+=\",\"+(begin&&end?parseFloat(begin[3]+pos*(end[3]-begin[3])):1);color+=\")\";return color;}/**\n   * Changes the color from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {String} fromColor The starting color in hex or rgb(a) format.\n   * @param {String} toColor The starting color in hex or rgb(a) format.\n   * @param {Number} [duration] Duration of change (in ms).\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Function} [options.colorEasing] Easing function. Note that this function only take two arguments (currentTime, duration). Thus the regular animation easing functions cannot be used.\n   * @param {Function} [options.abort] Additional function with logic. If returns true, onComplete is called.\n   */function animateColor(fromColor,toColor,duration,options){var startColor=new fabric.Color(fromColor).getSource(),endColor=new fabric.Color(toColor).getSource(),originalOnComplete=options.onComplete,originalOnChange=options.onChange;options=options||{};fabric.util.animate(fabric.util.object.extend(options,{duration:duration||500,startValue:startColor,endValue:endColor,byValue:endColor,easing:function(currentTime,startValue,byValue,duration){var posValue=options.colorEasing?options.colorEasing(currentTime,duration):1-Math.cos(currentTime/duration*(Math.PI/2));return calculateColor(startValue,byValue,posValue);},// has to take in account for color restoring;\nonComplete:function(current,valuePerc,timePerc){if(originalOnComplete){return originalOnComplete(calculateColor(endColor,endColor,0),valuePerc,timePerc);}},onChange:function(current,valuePerc,timePerc){if(originalOnChange){if(Array.isArray(current)){return originalOnChange(calculateColor(current,current,0),valuePerc,timePerc);}originalOnChange(current,valuePerc,timePerc);}}}));}fabric.util.animateColor=animateColor;})();(function(){function normalize(a,c,p,s){if(a<Math.abs(c)){a=c;s=p/4;}else{//handle the 0/0 case:\nif(c===0&&a===0){s=p/(2*Math.PI)*Math.asin(1);}else{s=p/(2*Math.PI)*Math.asin(c/a);}}return{a:a,c:c,p:p,s:s};}function elastic(opts,t,d){return opts.a*Math.pow(2,10*(t-=1))*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p);}/**\n   * Cubic easing out\n   * @memberOf fabric.util.ease\n   */function easeOutCubic(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;}/**\n   * Cubic easing in and out\n   * @memberOf fabric.util.ease\n   */function easeInOutCubic(t,b,c,d){t/=d/2;if(t<1){return c/2*t*t*t+b;}return c/2*((t-=2)*t*t+2)+b;}/**\n   * Quartic easing in\n   * @memberOf fabric.util.ease\n   */function easeInQuart(t,b,c,d){return c*(t/=d)*t*t*t+b;}/**\n   * Quartic easing out\n   * @memberOf fabric.util.ease\n   */function easeOutQuart(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;}/**\n   * Quartic easing in and out\n   * @memberOf fabric.util.ease\n   */function easeInOutQuart(t,b,c,d){t/=d/2;if(t<1){return c/2*t*t*t*t+b;}return-c/2*((t-=2)*t*t*t-2)+b;}/**\n   * Quintic easing in\n   * @memberOf fabric.util.ease\n   */function easeInQuint(t,b,c,d){return c*(t/=d)*t*t*t*t+b;}/**\n   * Quintic easing out\n   * @memberOf fabric.util.ease\n   */function easeOutQuint(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;}/**\n   * Quintic easing in and out\n   * @memberOf fabric.util.ease\n   */function easeInOutQuint(t,b,c,d){t/=d/2;if(t<1){return c/2*t*t*t*t*t+b;}return c/2*((t-=2)*t*t*t*t+2)+b;}/**\n   * Sinusoidal easing in\n   * @memberOf fabric.util.ease\n   */function easeInSine(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;}/**\n   * Sinusoidal easing out\n   * @memberOf fabric.util.ease\n   */function easeOutSine(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;}/**\n   * Sinusoidal easing in and out\n   * @memberOf fabric.util.ease\n   */function easeInOutSine(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;}/**\n   * Exponential easing in\n   * @memberOf fabric.util.ease\n   */function easeInExpo(t,b,c,d){return t===0?b:c*Math.pow(2,10*(t/d-1))+b;}/**\n   * Exponential easing out\n   * @memberOf fabric.util.ease\n   */function easeOutExpo(t,b,c,d){return t===d?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;}/**\n   * Exponential easing in and out\n   * @memberOf fabric.util.ease\n   */function easeInOutExpo(t,b,c,d){if(t===0){return b;}if(t===d){return b+c;}t/=d/2;if(t<1){return c/2*Math.pow(2,10*(t-1))+b;}return c/2*(-Math.pow(2,-10*--t)+2)+b;}/**\n   * Circular easing in\n   * @memberOf fabric.util.ease\n   */function easeInCirc(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;}/**\n   * Circular easing out\n   * @memberOf fabric.util.ease\n   */function easeOutCirc(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;}/**\n   * Circular easing in and out\n   * @memberOf fabric.util.ease\n   */function easeInOutCirc(t,b,c,d){t/=d/2;if(t<1){return-c/2*(Math.sqrt(1-t*t)-1)+b;}return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;}/**\n   * Elastic easing in\n   * @memberOf fabric.util.ease\n   */function easeInElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(t===0){return b;}t/=d;if(t===1){return b+c;}if(!p){p=d*0.3;}var opts=normalize(a,c,p,s);return-elastic(opts,t,d)+b;}/**\n   * Elastic easing out\n   * @memberOf fabric.util.ease\n   */function easeOutElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(t===0){return b;}t/=d;if(t===1){return b+c;}if(!p){p=d*0.3;}var opts=normalize(a,c,p,s);return opts.a*Math.pow(2,-10*t)*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p)+opts.c+b;}/**\n   * Elastic easing in and out\n   * @memberOf fabric.util.ease\n   */function easeInOutElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(t===0){return b;}t/=d/2;if(t===2){return b+c;}if(!p){p=d*(0.3*1.5);}var opts=normalize(a,c,p,s);if(t<1){return-0.5*elastic(opts,t,d)+b;}return opts.a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p)*0.5+opts.c+b;}/**\n   * Backwards easing in\n   * @memberOf fabric.util.ease\n   */function easeInBack(t,b,c,d,s){if(s===undefined){s=1.70158;}return c*(t/=d)*t*((s+1)*t-s)+b;}/**\n   * Backwards easing out\n   * @memberOf fabric.util.ease\n   */function easeOutBack(t,b,c,d,s){if(s===undefined){s=1.70158;}return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;}/**\n   * Backwards easing in and out\n   * @memberOf fabric.util.ease\n   */function easeInOutBack(t,b,c,d,s){if(s===undefined){s=1.70158;}t/=d/2;if(t<1){return c/2*(t*t*(((s*=1.525)+1)*t-s))+b;}return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b;}/**\n   * Bouncing easing in\n   * @memberOf fabric.util.ease\n   */function easeInBounce(t,b,c,d){return c-easeOutBounce(d-t,0,c,d)+b;}/**\n   * Bouncing easing out\n   * @memberOf fabric.util.ease\n   */function easeOutBounce(t,b,c,d){if((t/=d)<1/2.75){return c*(7.5625*t*t)+b;}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+0.75)+b;}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+0.9375)+b;}else{return c*(7.5625*(t-=2.625/2.75)*t+0.984375)+b;}}/**\n   * Bouncing easing in and out\n   * @memberOf fabric.util.ease\n   */function easeInOutBounce(t,b,c,d){if(t<d/2){return easeInBounce(t*2,0,c,d)*0.5+b;}return easeOutBounce(t*2-d,0,c,d)*0.5+c*0.5+b;}/**\n   * Easing functions\n   * See <a href=\"http://gizma.com/easing/\">Easing Equations by Robert Penner</a>\n   * @namespace fabric.util.ease\n   */fabric.util.ease={/**\n     * Quadratic easing in\n     * @memberOf fabric.util.ease\n     */easeInQuad:function(t,b,c,d){return c*(t/=d)*t+b;},/**\n     * Quadratic easing out\n     * @memberOf fabric.util.ease\n     */easeOutQuad:function(t,b,c,d){return-c*(t/=d)*(t-2)+b;},/**\n     * Quadratic easing in and out\n     * @memberOf fabric.util.ease\n     */easeInOutQuad:function(t,b,c,d){t/=d/2;if(t<1){return c/2*t*t+b;}return-c/2*(--t*(t-2)-1)+b;},/**\n     * Cubic easing in\n     * @memberOf fabric.util.ease\n     */easeInCubic:function(t,b,c,d){return c*(t/=d)*t*t+b;},easeOutCubic:easeOutCubic,easeInOutCubic:easeInOutCubic,easeInQuart:easeInQuart,easeOutQuart:easeOutQuart,easeInOutQuart:easeInOutQuart,easeInQuint:easeInQuint,easeOutQuint:easeOutQuint,easeInOutQuint:easeInOutQuint,easeInSine:easeInSine,easeOutSine:easeOutSine,easeInOutSine:easeInOutSine,easeInExpo:easeInExpo,easeOutExpo:easeOutExpo,easeInOutExpo:easeInOutExpo,easeInCirc:easeInCirc,easeOutCirc:easeOutCirc,easeInOutCirc:easeInOutCirc,easeInElastic:easeInElastic,easeOutElastic:easeOutElastic,easeInOutElastic:easeInOutElastic,easeInBack:easeInBack,easeOutBack:easeOutBack,easeInOutBack:easeInOutBack,easeInBounce:easeInBounce,easeOutBounce:easeOutBounce,easeInOutBounce:easeInOutBounce};})();(function(global){\"use strict\";/**\n   * @name fabric\n   * @namespace\n   */var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,parseUnit=fabric.util.parseUnit,multiplyTransformMatrices=fabric.util.multiplyTransformMatrices,svgValidTagNames=[\"path\",\"circle\",\"polygon\",\"polyline\",\"ellipse\",\"rect\",\"line\",\"image\",\"text\"],svgViewBoxElements=[\"symbol\",\"image\",\"marker\",\"pattern\",\"view\",\"svg\"],svgInvalidAncestors=[\"pattern\",\"defs\",\"symbol\",\"metadata\",\"clipPath\",\"mask\",\"desc\"],svgValidParents=[\"symbol\",\"g\",\"a\",\"svg\",\"clipPath\",\"defs\"],attributesMap={cx:\"left\",x:\"left\",r:\"radius\",cy:\"top\",y:\"top\",display:\"visible\",visibility:\"visible\",transform:\"transformMatrix\",\"fill-opacity\":\"fillOpacity\",\"fill-rule\":\"fillRule\",\"font-family\":\"fontFamily\",\"font-size\":\"fontSize\",\"font-style\":\"fontStyle\",\"font-weight\":\"fontWeight\",\"letter-spacing\":\"charSpacing\",\"paint-order\":\"paintFirst\",\"stroke-dasharray\":\"strokeDashArray\",\"stroke-dashoffset\":\"strokeDashOffset\",\"stroke-linecap\":\"strokeLineCap\",\"stroke-linejoin\":\"strokeLineJoin\",\"stroke-miterlimit\":\"strokeMiterLimit\",\"stroke-opacity\":\"strokeOpacity\",\"stroke-width\":\"strokeWidth\",\"text-decoration\":\"textDecoration\",\"text-anchor\":\"textAnchor\",opacity:\"opacity\",\"clip-path\":\"clipPath\",\"clip-rule\":\"clipRule\",\"vector-effect\":\"strokeUniform\",\"image-rendering\":\"imageSmoothing\"},colorAttributes={stroke:\"strokeOpacity\",fill:\"fillOpacity\"},fSize=\"font-size\",cPath=\"clip-path\";fabric.svgValidTagNamesRegEx=getSvgRegex(svgValidTagNames);fabric.svgViewBoxElementsRegEx=getSvgRegex(svgViewBoxElements);fabric.svgInvalidAncestorsRegEx=getSvgRegex(svgInvalidAncestors);fabric.svgValidParentsRegEx=getSvgRegex(svgValidParents);fabric.cssRules={};fabric.gradientDefs={};fabric.clipPaths={};function normalizeAttr(attr){// transform attribute names\nif(attr in attributesMap){return attributesMap[attr];}return attr;}function normalizeValue(attr,value,parentAttributes,fontSize){var isArray=Object.prototype.toString.call(value)===\"[object Array]\",parsed;if((attr===\"fill\"||attr===\"stroke\")&&value===\"none\"){value=\"\";}else if(attr===\"strokeUniform\"){return value===\"non-scaling-stroke\";}else if(attr===\"strokeDashArray\"){if(value===\"none\"){value=null;}else{value=value.replace(/,/g,\" \").split(/\\s+/).map(parseFloat);}}else if(attr===\"transformMatrix\"){if(parentAttributes&&parentAttributes.transformMatrix){value=multiplyTransformMatrices(parentAttributes.transformMatrix,fabric.parseTransformAttribute(value));}else{value=fabric.parseTransformAttribute(value);}}else if(attr===\"visible\"){value=value!==\"none\"&&value!==\"hidden\";// display=none on parent element always takes precedence over child element\nif(parentAttributes&&parentAttributes.visible===false){value=false;}}else if(attr===\"opacity\"){value=parseFloat(value);if(parentAttributes&&typeof parentAttributes.opacity!==\"undefined\"){value*=parentAttributes.opacity;}}else if(attr===\"textAnchor\"/* text-anchor */){value=value===\"start\"?\"left\":value===\"end\"?\"right\":\"center\";}else if(attr===\"charSpacing\"){// parseUnit returns px and we convert it to em\nparsed=parseUnit(value,fontSize)/fontSize*1000;}else if(attr===\"paintFirst\"){var fillIndex=value.indexOf(\"fill\");var strokeIndex=value.indexOf(\"stroke\");var value=\"fill\";if(fillIndex>-1&&strokeIndex>-1&&strokeIndex<fillIndex){value=\"stroke\";}else if(fillIndex===-1&&strokeIndex>-1){value=\"stroke\";}}else if(attr===\"href\"||attr===\"xlink:href\"||attr===\"font\"){return value;}else if(attr===\"imageSmoothing\"){return value===\"optimizeQuality\"?true:false;}else{parsed=isArray?value.map(parseUnit):parseUnit(value,fontSize);}return!isArray&&isNaN(parsed)?value:parsed;}/**\n   * @private\n   */function getSvgRegex(arr){return new RegExp(\"^(\"+arr.join(\"|\")+\")\\\\b\",\"i\");}/**\n   * @private\n   * @param {Object} attributes Array of attributes to parse\n   */function _setStrokeFillOpacity(attributes){for(var attr in colorAttributes){if(typeof attributes[colorAttributes[attr]]===\"undefined\"||attributes[attr]===\"\"){continue;}if(typeof attributes[attr]===\"undefined\"){if(!fabric.Object.prototype[attr]){continue;}attributes[attr]=fabric.Object.prototype[attr];}if(attributes[attr].indexOf(\"url(\")===0){continue;}var color=new fabric.Color(attributes[attr]);attributes[attr]=color.setAlpha(toFixed(color.getAlpha()*attributes[colorAttributes[attr]],2)).toRgba();}return attributes;}/**\n   * @private\n   */function _getMultipleNodes(doc,nodeNames){var nodeName,nodeArray=[],nodeList,i,len;for(i=0,len=nodeNames.length;i<len;i++){nodeName=nodeNames[i];nodeList=doc.getElementsByTagName(nodeName);nodeArray=nodeArray.concat(Array.prototype.slice.call(nodeList));}return nodeArray;}/**\n   * Parses \"transform\" attribute, returning an array of values\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {String} attributeValue String containing attribute value\n   * @return {Array} Array of 6 elements representing transformation matrix\n   */fabric.parseTransformAttribute=function(){function rotateMatrix(matrix,args){var cos=fabric.util.cos(args[0]),sin=fabric.util.sin(args[0]),x=0,y=0;if(args.length===3){x=args[1];y=args[2];}matrix[0]=cos;matrix[1]=sin;matrix[2]=-sin;matrix[3]=cos;matrix[4]=x-(cos*x-sin*y);matrix[5]=y-(sin*x+cos*y);}function scaleMatrix(matrix,args){var multiplierX=args[0],multiplierY=args.length===2?args[1]:args[0];matrix[0]=multiplierX;matrix[3]=multiplierY;}function skewMatrix(matrix,args,pos){matrix[pos]=Math.tan(fabric.util.degreesToRadians(args[0]));}function translateMatrix(matrix,args){matrix[4]=args[0];if(args.length===2){matrix[5]=args[1];}}// identity matrix\nvar iMatrix=fabric.iMatrix,// == begin transform regexp\nnumber=fabric.reNum,commaWsp=\"(?:\\\\s+,?\\\\s*|,\\\\s*)\",skewX=\"(?:(skewX)\\\\s*\\\\(\\\\s*(\"+number+\")\\\\s*\\\\))\",skewY=\"(?:(skewY)\\\\s*\\\\(\\\\s*(\"+number+\")\\\\s*\\\\))\",rotate=\"(?:(rotate)\\\\s*\\\\(\\\\s*(\"+number+\")(?:\"+commaWsp+\"(\"+number+\")\"+commaWsp+\"(\"+number+\"))?\\\\s*\\\\))\",scale=\"(?:(scale)\\\\s*\\\\(\\\\s*(\"+number+\")(?:\"+commaWsp+\"(\"+number+\"))?\\\\s*\\\\))\",translate=\"(?:(translate)\\\\s*\\\\(\\\\s*(\"+number+\")(?:\"+commaWsp+\"(\"+number+\"))?\\\\s*\\\\))\",matrix=\"(?:(matrix)\\\\s*\\\\(\\\\s*\"+\"(\"+number+\")\"+commaWsp+\"(\"+number+\")\"+commaWsp+\"(\"+number+\")\"+commaWsp+\"(\"+number+\")\"+commaWsp+\"(\"+number+\")\"+commaWsp+\"(\"+number+\")\"+\"\\\\s*\\\\))\",transform=\"(?:\"+matrix+\"|\"+translate+\"|\"+scale+\"|\"+rotate+\"|\"+skewX+\"|\"+skewY+\")\",transforms=\"(?:\"+transform+\"(?:\"+commaWsp+\"*\"+transform+\")*\"+\")\",transformList=\"^\\\\s*(?:\"+transforms+\"?)\\\\s*$\",// http://www.w3.org/TR/SVG/coords.html#TransformAttribute\nreTransformList=new RegExp(transformList),// == end transform regexp\nreTransform=new RegExp(transform,\"g\");return function(attributeValue){// start with identity matrix\nvar matrix=iMatrix.concat(),matrices=[];// return if no argument was given or\n// an argument does not match transform attribute regexp\nif(!attributeValue||attributeValue&&!reTransformList.test(attributeValue)){return matrix;}attributeValue.replace(reTransform,function(match){var m=new RegExp(transform).exec(match).filter(function(match){// match !== '' && match != null\nreturn!!match;}),operation=m[1],args=m.slice(2).map(parseFloat);switch(operation){case\"translate\":translateMatrix(matrix,args);break;case\"rotate\":args[0]=fabric.util.degreesToRadians(args[0]);rotateMatrix(matrix,args);break;case\"scale\":scaleMatrix(matrix,args);break;case\"skewX\":skewMatrix(matrix,args,2);break;case\"skewY\":skewMatrix(matrix,args,1);break;case\"matrix\":matrix=args;break;}// snapshot current matrix into matrices array\nmatrices.push(matrix.concat());// reset\nmatrix=iMatrix.concat();});var combinedMatrix=matrices[0];while(matrices.length>1){matrices.shift();combinedMatrix=fabric.util.multiplyTransformMatrices(combinedMatrix,matrices[0]);}return combinedMatrix;};}();/**\n   * @private\n   */function parseStyleString(style,oStyle){var attr,value;style.replace(/;\\s*$/,\"\").split(\";\").forEach(function(chunk){var pair=chunk.split(\":\");attr=pair[0].trim().toLowerCase();value=pair[1].trim();oStyle[attr]=value;});}/**\n   * @private\n   */function parseStyleObject(style,oStyle){var attr,value;for(var prop in style){if(typeof style[prop]===\"undefined\"){continue;}attr=prop.toLowerCase();value=style[prop];oStyle[attr]=value;}}/**\n   * @private\n   */function getGlobalStylesForElement(element,svgUid){var styles={};for(var rule in fabric.cssRules[svgUid]){if(elementMatchesRule(element,rule.split(\" \"))){for(var property in fabric.cssRules[svgUid][rule]){styles[property]=fabric.cssRules[svgUid][rule][property];}}}return styles;}/**\n   * @private\n   */function elementMatchesRule(element,selectors){var firstMatching,parentMatching=true;//start from rightmost selector.\nfirstMatching=selectorMatches(element,selectors.pop());if(firstMatching&&selectors.length){parentMatching=doesSomeParentMatch(element,selectors);}return firstMatching&&parentMatching&&selectors.length===0;}function doesSomeParentMatch(element,selectors){var selector,parentMatching=true;while(element.parentNode&&element.parentNode.nodeType===1&&selectors.length){if(parentMatching){selector=selectors.pop();}element=element.parentNode;parentMatching=selectorMatches(element,selector);}return selectors.length===0;}/**\n   * @private\n   */function selectorMatches(element,selector){var nodeName=element.nodeName,classNames=element.getAttribute(\"class\"),id=element.getAttribute(\"id\"),matcher,i;// i check if a selector matches slicing away part from it.\n// if i get empty string i should match\nmatcher=new RegExp(\"^\"+nodeName,\"i\");selector=selector.replace(matcher,\"\");if(id&&selector.length){matcher=new RegExp(\"#\"+id+\"(?![a-zA-Z\\\\-]+)\",\"i\");selector=selector.replace(matcher,\"\");}if(classNames&&selector.length){classNames=classNames.split(\" \");for(i=classNames.length;i--;){matcher=new RegExp(\"\\\\.\"+classNames[i]+\"(?![a-zA-Z\\\\-]+)\",\"i\");selector=selector.replace(matcher,\"\");}}return selector.length===0;}/**\n   * @private\n   * to support IE8 missing getElementById on SVGdocument and on node xmlDOM\n   */function elementById(doc,id){var el;doc.getElementById&&(el=doc.getElementById(id));if(el){return el;}var node,i,len,nodelist=doc.getElementsByTagName(\"*\");for(i=0,len=nodelist.length;i<len;i++){node=nodelist[i];if(id===node.getAttribute(\"id\")){return node;}}}/**\n   * @private\n   */function parseUseDirectives(doc){var nodelist=_getMultipleNodes(doc,[\"use\",\"svg:use\"]),i=0;while(nodelist.length&&i<nodelist.length){var el=nodelist[i],xlink=(el.getAttribute(\"xlink:href\")||el.getAttribute(\"href\")).substr(1),x=el.getAttribute(\"x\")||0,y=el.getAttribute(\"y\")||0,el2=elementById(doc,xlink).cloneNode(true),currentTrans=(el2.getAttribute(\"transform\")||\"\")+\" translate(\"+x+\", \"+y+\")\",parentNode,oldLength=nodelist.length,attr,j,attrs,len,namespace=fabric.svgNS;applyViewboxTransform(el2);if(/^svg$/i.test(el2.nodeName)){var el3=el2.ownerDocument.createElementNS(namespace,\"g\");for(j=0,attrs=el2.attributes,len=attrs.length;j<len;j++){attr=attrs.item(j);el3.setAttributeNS(namespace,attr.nodeName,attr.nodeValue);}// el2.firstChild != null\nwhile(el2.firstChild){el3.appendChild(el2.firstChild);}el2=el3;}for(j=0,attrs=el.attributes,len=attrs.length;j<len;j++){attr=attrs.item(j);if(attr.nodeName===\"x\"||attr.nodeName===\"y\"||attr.nodeName===\"xlink:href\"||attr.nodeName===\"href\"){continue;}if(attr.nodeName===\"transform\"){currentTrans=attr.nodeValue+\" \"+currentTrans;}else{el2.setAttribute(attr.nodeName,attr.nodeValue);}}el2.setAttribute(\"transform\",currentTrans);el2.setAttribute(\"instantiated_by_use\",\"1\");el2.removeAttribute(\"id\");parentNode=el.parentNode;parentNode.replaceChild(el2,el);// some browsers do not shorten nodelist after replaceChild (IE8)\nif(nodelist.length===oldLength){i++;}}}// http://www.w3.org/TR/SVG/coords.html#ViewBoxAttribute\n// matches, e.g.: +14.56e-12, etc.\nvar reViewBoxAttrValue=new RegExp(\"^\"+\"\\\\s*(\"+fabric.reNum+\"+)\\\\s*,?\"+\"\\\\s*(\"+fabric.reNum+\"+)\\\\s*,?\"+\"\\\\s*(\"+fabric.reNum+\"+)\\\\s*,?\"+\"\\\\s*(\"+fabric.reNum+\"+)\\\\s*\"+\"$\");/**\n   * Add a <g> element that envelop all child elements and makes the viewbox transformMatrix descend on all elements\n   */function applyViewboxTransform(element){if(!fabric.svgViewBoxElementsRegEx.test(element.nodeName)){return;}var viewBoxAttr=element.getAttribute(\"viewBox\"),scaleX=1,scaleY=1,minX=0,minY=0,viewBoxWidth,viewBoxHeight,matrix,el,widthAttr=element.getAttribute(\"width\"),heightAttr=element.getAttribute(\"height\"),x=element.getAttribute(\"x\")||0,y=element.getAttribute(\"y\")||0,preserveAspectRatio=element.getAttribute(\"preserveAspectRatio\")||\"\",missingViewBox=!viewBoxAttr||!(viewBoxAttr=viewBoxAttr.match(reViewBoxAttrValue)),missingDimAttr=!widthAttr||!heightAttr||widthAttr===\"100%\"||heightAttr===\"100%\",toBeParsed=missingViewBox&&missingDimAttr,parsedDim={},translateMatrix=\"\",widthDiff=0,heightDiff=0;parsedDim.width=0;parsedDim.height=0;parsedDim.toBeParsed=toBeParsed;if(missingViewBox){if((x||y)&&element.parentNode.nodeName!==\"#document\"){translateMatrix=\" translate(\"+parseUnit(x)+\" \"+parseUnit(y)+\") \";matrix=(element.getAttribute(\"transform\")||\"\")+translateMatrix;element.setAttribute(\"transform\",matrix);element.removeAttribute(\"x\");element.removeAttribute(\"y\");}}if(toBeParsed){return parsedDim;}if(missingViewBox){parsedDim.width=parseUnit(widthAttr);parsedDim.height=parseUnit(heightAttr);// set a transform for elements that have x y and are inner(only) SVGs\nreturn parsedDim;}minX=-parseFloat(viewBoxAttr[1]);minY=-parseFloat(viewBoxAttr[2]);viewBoxWidth=parseFloat(viewBoxAttr[3]);viewBoxHeight=parseFloat(viewBoxAttr[4]);parsedDim.minX=minX;parsedDim.minY=minY;parsedDim.viewBoxWidth=viewBoxWidth;parsedDim.viewBoxHeight=viewBoxHeight;if(!missingDimAttr){parsedDim.width=parseUnit(widthAttr);parsedDim.height=parseUnit(heightAttr);scaleX=parsedDim.width/viewBoxWidth;scaleY=parsedDim.height/viewBoxHeight;}else{parsedDim.width=viewBoxWidth;parsedDim.height=viewBoxHeight;}// default is to preserve aspect ratio\npreserveAspectRatio=fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio);if(preserveAspectRatio.alignX!==\"none\"){//translate all container for the effect of Mid, Min, Max\nif(preserveAspectRatio.meetOrSlice===\"meet\"){scaleY=scaleX=scaleX>scaleY?scaleY:scaleX;// calculate additional translation to move the viewbox\n}if(preserveAspectRatio.meetOrSlice===\"slice\"){scaleY=scaleX=scaleX>scaleY?scaleX:scaleY;// calculate additional translation to move the viewbox\n}widthDiff=parsedDim.width-viewBoxWidth*scaleX;heightDiff=parsedDim.height-viewBoxHeight*scaleX;if(preserveAspectRatio.alignX===\"Mid\"){widthDiff/=2;}if(preserveAspectRatio.alignY===\"Mid\"){heightDiff/=2;}if(preserveAspectRatio.alignX===\"Min\"){widthDiff=0;}if(preserveAspectRatio.alignY===\"Min\"){heightDiff=0;}}if(scaleX===1&&scaleY===1&&minX===0&&minY===0&&x===0&&y===0){return parsedDim;}if((x||y)&&element.parentNode.nodeName!==\"#document\"){translateMatrix=\" translate(\"+parseUnit(x)+\" \"+parseUnit(y)+\") \";}matrix=translateMatrix+\" matrix(\"+scaleX+\" 0\"+\" 0 \"+scaleY+\" \"+(minX*scaleX+widthDiff)+\" \"+(minY*scaleY+heightDiff)+\") \";// seems unused.\n// parsedDim.viewboxTransform = fabric.parseTransformAttribute(matrix);\nif(element.nodeName===\"svg\"){el=element.ownerDocument.createElementNS(fabric.svgNS,\"g\");// element.firstChild != null\nwhile(element.firstChild){el.appendChild(element.firstChild);}element.appendChild(el);}else{el=element;el.removeAttribute(\"x\");el.removeAttribute(\"y\");matrix=el.getAttribute(\"transform\")+matrix;}el.setAttribute(\"transform\",matrix);return parsedDim;}function hasAncestorWithNodeName(element,nodeName){while(element&&(element=element.parentNode)){if(element.nodeName&&nodeName.test(element.nodeName.replace(\"svg:\",\"\"))&&!element.getAttribute(\"instantiated_by_use\")){return true;}}return false;}/**\n   * Parses an SVG document, converts it to an array of corresponding fabric.* instances and passes them to a callback\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {SVGDocument} doc SVG document to parse\n   * @param {Function} callback Callback to call when parsing is finished;\n   * It's being passed an array of elements (parsed from a document).\n   * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n   * @param {Object} [parsingOptions] options for parsing document\n   * @param {String} [parsingOptions.crossOrigin] crossOrigin settings\n   */fabric.parseSVGDocument=function(doc,callback,reviver,parsingOptions){if(!doc){return;}parseUseDirectives(doc);var svgUid=fabric.Object.__uid++,i,len,options=applyViewboxTransform(doc),descendants=fabric.util.toArray(doc.getElementsByTagName(\"*\"));options.crossOrigin=parsingOptions&&parsingOptions.crossOrigin;options.svgUid=svgUid;if(descendants.length===0&&fabric.isLikelyNode){// we're likely in node, where \"o3-xml\" library fails to gEBTN(\"*\")\n// https://github.com/ajaxorg/node-o3-xml/issues/21\ndescendants=doc.selectNodes('//*[name(.)!=\"svg\"]');var arr=[];for(i=0,len=descendants.length;i<len;i++){arr[i]=descendants[i];}descendants=arr;}var elements=descendants.filter(function(el){applyViewboxTransform(el);return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace(\"svg:\",\"\"))&&!hasAncestorWithNodeName(el,fabric.svgInvalidAncestorsRegEx);// http://www.w3.org/TR/SVG/struct.html#DefsElement\n});if(!elements||elements&&!elements.length){callback&&callback([],{});return;}var clipPaths={};descendants.filter(function(el){return el.nodeName.replace(\"svg:\",\"\")===\"clipPath\";}).forEach(function(el){var id=el.getAttribute(\"id\");clipPaths[id]=fabric.util.toArray(el.getElementsByTagName(\"*\")).filter(function(el){return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace(\"svg:\",\"\"));});});fabric.gradientDefs[svgUid]=fabric.getGradientDefs(doc);fabric.cssRules[svgUid]=fabric.getCSSRules(doc);fabric.clipPaths[svgUid]=clipPaths;// Precedence of rules:   style > class > attribute\nfabric.parseElements(elements,function(instances,elements){if(callback){callback(instances,options,elements,descendants);delete fabric.gradientDefs[svgUid];delete fabric.cssRules[svgUid];delete fabric.clipPaths[svgUid];}},clone(options),reviver,parsingOptions);};function recursivelyParseGradientsXlink(doc,gradient){var gradientsAttrs=[\"gradientTransform\",\"x1\",\"x2\",\"y1\",\"y2\",\"gradientUnits\",\"cx\",\"cy\",\"r\",\"fx\",\"fy\"],xlinkAttr=\"xlink:href\",xLink=gradient.getAttribute(xlinkAttr).substr(1),referencedGradient=elementById(doc,xLink);if(referencedGradient&&referencedGradient.getAttribute(xlinkAttr)){recursivelyParseGradientsXlink(doc,referencedGradient);}gradientsAttrs.forEach(function(attr){if(referencedGradient&&!gradient.hasAttribute(attr)&&referencedGradient.hasAttribute(attr)){gradient.setAttribute(attr,referencedGradient.getAttribute(attr));}});if(!gradient.children.length){var referenceClone=referencedGradient.cloneNode(true);while(referenceClone.firstChild){gradient.appendChild(referenceClone.firstChild);}}gradient.removeAttribute(xlinkAttr);}var reFontDeclaration=new RegExp(\"(normal|italic)?\\\\s*(normal|small-caps)?\\\\s*\"+\"(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\\\s*(\"+fabric.reNum+\"(?:px|cm|mm|em|pt|pc|in)*)(?:\\\\/(normal|\"+fabric.reNum+\"))?\\\\s+(.*)\");extend(fabric,{/**\n     * Parses a short font declaration, building adding its properties to a style object\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {String} value font declaration\n     * @param {Object} oStyle definition\n     */parseFontDeclaration:function(value,oStyle){var match=value.match(reFontDeclaration);if(!match){return;}var fontStyle=match[1],// font variant is not used\n// fontVariant = match[2],\nfontWeight=match[3],fontSize=match[4],lineHeight=match[5],fontFamily=match[6];if(fontStyle){oStyle.fontStyle=fontStyle;}if(fontWeight){oStyle.fontWeight=isNaN(parseFloat(fontWeight))?fontWeight:parseFloat(fontWeight);}if(fontSize){oStyle.fontSize=parseUnit(fontSize);}if(fontFamily){oStyle.fontFamily=fontFamily;}if(lineHeight){oStyle.lineHeight=lineHeight===\"normal\"?1:lineHeight;}},/**\n     * Parses an SVG document, returning all of the gradient declarations found in it\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} Gradient definitions; key corresponds to element id, value -- to gradient definition element\n     */getGradientDefs:function(doc){var tagArray=[\"linearGradient\",\"radialGradient\",\"svg:linearGradient\",\"svg:radialGradient\"],elList=_getMultipleNodes(doc,tagArray),el,j=0,gradientDefs={};j=elList.length;while(j--){el=elList[j];if(el.getAttribute(\"xlink:href\")){recursivelyParseGradientsXlink(doc,el);}gradientDefs[el.getAttribute(\"id\")]=el;}return gradientDefs;},/**\n     * Returns an object of attributes' name/value, given element and an array of attribute names;\n     * Parses parent \"g\" nodes recursively upwards.\n     * @static\n     * @memberOf fabric\n     * @param {DOMElement} element Element to parse\n     * @param {Array} attributes Array of attributes to parse\n     * @return {Object} object containing parsed attributes' names/values\n     */parseAttributes:function(element,attributes,svgUid){if(!element){return;}var value,parentAttributes={},fontSize,parentFontSize;if(typeof svgUid===\"undefined\"){svgUid=element.getAttribute(\"svgUid\");}// if there's a parent container (`g` or `a` or `symbol` node), parse its attributes recursively upwards\nif(element.parentNode&&fabric.svgValidParentsRegEx.test(element.parentNode.nodeName)){parentAttributes=fabric.parseAttributes(element.parentNode,attributes,svgUid);}var ownAttributes=attributes.reduce(function(memo,attr){value=element.getAttribute(attr);if(value){// eslint-disable-line\nmemo[attr]=value;}return memo;},{});// add values parsed from style, which take precedence over attributes\n// (see: http://www.w3.org/TR/SVG/styling.html#UsingPresentationAttributes)\nvar cssAttrs=extend(getGlobalStylesForElement(element,svgUid),fabric.parseStyleAttribute(element));ownAttributes=extend(ownAttributes,cssAttrs);if(cssAttrs[cPath]){element.setAttribute(cPath,cssAttrs[cPath]);}fontSize=parentFontSize=parentAttributes.fontSize||fabric.Text.DEFAULT_SVG_FONT_SIZE;if(ownAttributes[fSize]){// looks like the minimum should be 9px when dealing with ems. this is what looks like in browsers.\nownAttributes[fSize]=fontSize=parseUnit(ownAttributes[fSize],parentFontSize);}var normalizedAttr,normalizedValue,normalizedStyle={};for(var attr in ownAttributes){normalizedAttr=normalizeAttr(attr);normalizedValue=normalizeValue(normalizedAttr,ownAttributes[attr],parentAttributes,fontSize);normalizedStyle[normalizedAttr]=normalizedValue;}if(normalizedStyle&&normalizedStyle.font){fabric.parseFontDeclaration(normalizedStyle.font,normalizedStyle);}var mergedAttrs=extend(parentAttributes,normalizedStyle);return fabric.svgValidParentsRegEx.test(element.nodeName)?mergedAttrs:_setStrokeFillOpacity(mergedAttrs);},/**\n     * Transforms an array of svg elements to corresponding fabric.* instances\n     * @static\n     * @memberOf fabric\n     * @param {Array} elements Array of elements to parse\n     * @param {Function} callback Being passed an array of fabric instances (transformed from SVG elements)\n     * @param {Object} [options] Options object\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     */parseElements:function(elements,callback,options,reviver,parsingOptions){new fabric.ElementsParser(elements,callback,options,reviver,parsingOptions).parse();},/**\n     * Parses \"style\" attribute, retuning an object with values\n     * @static\n     * @memberOf fabric\n     * @param {SVGElement} element Element to parse\n     * @return {Object} Objects with values parsed from style attribute of an element\n     */parseStyleAttribute:function(element){var oStyle={},style=element.getAttribute(\"style\");if(!style){return oStyle;}if(typeof style===\"string\"){parseStyleString(style,oStyle);}else{parseStyleObject(style,oStyle);}return oStyle;},/**\n     * Parses \"points\" attribute, returning an array of values\n     * @static\n     * @memberOf fabric\n     * @param {String} points points attribute string\n     * @return {Array} array of points\n     */parsePointsAttribute:function(points){// points attribute is required and must not be empty\nif(!points){return null;}// replace commas with whitespace and remove bookending whitespace\npoints=points.replace(/,/g,\" \").trim();points=points.split(/\\s+/);var parsedPoints=[],i,len;for(i=0,len=points.length;i<len;i+=2){parsedPoints.push({x:parseFloat(points[i]),y:parseFloat(points[i+1])});}// odd number of points is an error\n// if (parsedPoints.length % 2 !== 0) {\n//   return null;\n// }\nreturn parsedPoints;},/**\n     * Returns CSS rules for a given SVG document\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} CSS rules of this document\n     */getCSSRules:function(doc){var styles=doc.getElementsByTagName(\"style\"),i,len,allRules={},rules;// very crude parsing of style contents\nfor(i=0,len=styles.length;i<len;i++){// <style/> could produce `undefined`, covering this case with ''\nvar styleContents=styles[i].textContent||\"\";// remove comments\nstyleContents=styleContents.replace(/\\/\\*[\\s\\S]*?\\*\\//g,\"\");if(styleContents.trim()===\"\"){continue;}rules=styleContents.match(/[^{]*\\{[\\s\\S]*?\\}/g);rules=rules.map(function(rule){return rule.trim();});// eslint-disable-next-line no-loop-func\nrules.forEach(function(rule){var match=rule.match(/([\\s\\S]*?)\\s*\\{([^}]*)\\}/),ruleObj={},declaration=match[2].trim(),propertyValuePairs=declaration.replace(/;$/,\"\").split(/\\s*;\\s*/);for(i=0,len=propertyValuePairs.length;i<len;i++){var pair=propertyValuePairs[i].split(/\\s*:\\s*/),property=pair[0],value=pair[1];ruleObj[property]=value;}rule=match[1];rule.split(\",\").forEach(function(_rule){_rule=_rule.replace(/^svg/i,\"\").trim();if(_rule===\"\"){return;}if(allRules[_rule]){fabric.util.object.extend(allRules[_rule],ruleObj);}else{allRules[_rule]=fabric.util.object.clone(ruleObj);}});});}return allRules;},/**\n     * Takes url corresponding to an SVG document, and parses it into a set of fabric objects.\n     * Note that SVG is fetched via XMLHttpRequest, so it needs to conform to SOP (Same Origin Policy)\n     * @memberOf fabric\n     * @param {String} url\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */loadSVGFromURL:function(url,callback,reviver,options){url=url.replace(/^\\n\\s*/,\"\").trim();new fabric.util.request(url,{method:\"get\",onComplete:onComplete});function onComplete(r){var xml=r.responseXML;if(!xml||!xml.documentElement){callback&&callback(null);return false;}fabric.parseSVGDocument(xml.documentElement,function(results,_options,elements,allElements){callback&&callback(results,_options,elements,allElements);},reviver,options);}},/**\n     * Takes string corresponding to an SVG document, and parses it into a set of fabric objects\n     * @memberOf fabric\n     * @param {String} string\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */loadSVGFromString:function(string,callback,reviver,options){var parser=new fabric.window.DOMParser(),doc=parser.parseFromString(string.trim(),\"text/xml\");fabric.parseSVGDocument(doc.documentElement,function(results,_options,elements,allElements){callback(results,_options,elements,allElements);},reviver,options);}});})(typeof exports!==\"undefined\"?exports:this);fabric.ElementsParser=function(elements,callback,options,reviver,parsingOptions,doc){this.elements=elements;this.callback=callback;this.options=options;this.reviver=reviver;this.svgUid=options&&options.svgUid||0;this.parsingOptions=parsingOptions;this.regexUrl=/^url\\(['\"]?#([^'\"]+)['\"]?\\)/g;this.doc=doc;};(function(proto){proto.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects();};proto.createObjects=function(){var _this=this;this.elements.forEach(function(element,i){element.setAttribute(\"svgUid\",_this.svgUid);_this.createObject(element,i);});};proto.findTag=function(el){return fabric[fabric.util.string.capitalize(el.tagName.replace(\"svg:\",\"\"))];};proto.createObject=function(el,index){var klass=this.findTag(el);if(klass&&klass.fromElement){try{klass.fromElement(el,this.createCallback(index,el),this.options);}catch(err){fabric.log(err);}}else{this.checkIfDone();}};proto.createCallback=function(index,el){var _this=this;return function(obj){var _options;_this.resolveGradient(obj,el,\"fill\");_this.resolveGradient(obj,el,\"stroke\");if(obj instanceof fabric.Image&&obj._originalElement){_options=obj.parsePreserveAspectRatioAttribute(el);}obj._removeTransformMatrix(_options);_this.resolveClipPath(obj,el);_this.reviver&&_this.reviver(el,obj);_this.instances[index]=obj;_this.checkIfDone();};};proto.extractPropertyDefinition=function(obj,property,storage){var value=obj[property],regex=this.regexUrl;if(!regex.test(value)){return;}regex.lastIndex=0;var id=regex.exec(value)[1];regex.lastIndex=0;return fabric[storage][this.svgUid][id];};proto.resolveGradient=function(obj,el,property){var gradientDef=this.extractPropertyDefinition(obj,property,\"gradientDefs\");if(gradientDef){var opacityAttr=el.getAttribute(property+\"-opacity\");var gradient=fabric.Gradient.fromElement(gradientDef,obj,opacityAttr,this.options);obj.set(property,gradient);}};proto.createClipPathCallback=function(obj,container){return function(_newObj){_newObj._removeTransformMatrix();_newObj.fillRule=_newObj.clipRule;container.push(_newObj);};};proto.resolveClipPath=function(obj,usingElement){var clipPath=this.extractPropertyDefinition(obj,\"clipPath\",\"clipPaths\"),element,klass,objTransformInv,container,gTransform,options;if(clipPath){container=[];objTransformInv=fabric.util.invertTransform(obj.calcTransformMatrix());// move the clipPath tag as sibling to the real element that is using it\nvar clipPathTag=clipPath[0].parentNode;var clipPathOwner=usingElement;while(clipPathOwner.parentNode&&clipPathOwner.getAttribute(\"clip-path\")!==obj.clipPath){clipPathOwner=clipPathOwner.parentNode;}clipPathOwner.parentNode.appendChild(clipPathTag);for(var i=0;i<clipPath.length;i++){element=clipPath[i];klass=this.findTag(element);klass.fromElement(element,this.createClipPathCallback(obj,container),this.options);}if(container.length===1){clipPath=container[0];}else{clipPath=new fabric.Group(container);}gTransform=fabric.util.multiplyTransformMatrices(objTransformInv,clipPath.calcTransformMatrix());if(clipPath.clipPath){this.resolveClipPath(clipPath,clipPathOwner);}var options=fabric.util.qrDecompose(gTransform);clipPath.flipX=false;clipPath.flipY=false;clipPath.set(\"scaleX\",options.scaleX);clipPath.set(\"scaleY\",options.scaleY);clipPath.angle=options.angle;clipPath.skewX=options.skewX;clipPath.skewY=0;clipPath.setPositionByOrigin({x:options.translateX,y:options.translateY},\"center\",\"center\");obj.clipPath=clipPath;}else{// if clip-path does not resolve to any element, delete the property.\ndelete obj.clipPath;}};proto.checkIfDone=function(){if(--this.numElements===0){this.instances=this.instances.filter(function(el){// eslint-disable-next-line no-eq-null, eqeqeq\nreturn el!=null;});this.callback(this.instances,this.elements);}};})(fabric.ElementsParser.prototype);(function(global){\"use strict\";/* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */var fabric=global.fabric||(global.fabric={});if(fabric.Point){fabric.warn(\"fabric.Point is already defined\");return;}fabric.Point=Point;/**\n   * Point class\n   * @class fabric.Point\n   * @memberOf fabric\n   * @constructor\n   * @param {Number} x\n   * @param {Number} y\n   * @return {fabric.Point} thisArg\n   */function Point(x,y){this.x=x;this.y=y;}Point.prototype=/** @lends fabric.Point.prototype */{type:\"point\",constructor:Point,/**\n     * Adds another point to this one and returns another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point instance with added values\n     */add:function(that){return new Point(this.x+that.x,this.y+that.y);},/**\n     * Adds another point to this one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */addEquals:function(that){this.x+=that.x;this.y+=that.y;return this;},/**\n     * Adds value to this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point} new Point with added value\n     */scalarAdd:function(scalar){return new Point(this.x+scalar,this.y+scalar);},/**\n     * Adds value to this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */scalarAddEquals:function(scalar){this.x+=scalar;this.y+=scalar;return this;},/**\n     * Subtracts another point from this point and returns a new one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point object with subtracted values\n     */subtract:function(that){return new Point(this.x-that.x,this.y-that.y);},/**\n     * Subtracts another point from this point\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */subtractEquals:function(that){this.x-=that.x;this.y-=that.y;return this;},/**\n     * Subtracts value from this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */scalarSubtract:function(scalar){return new Point(this.x-scalar,this.y-scalar);},/**\n     * Subtracts value from this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */scalarSubtractEquals:function(scalar){this.x-=scalar;this.y-=scalar;return this;},/**\n     * Multiplies this point by a value and returns a new one\n     * TODO: rename in scalarMultiply in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */multiply:function(scalar){return new Point(this.x*scalar,this.y*scalar);},/**\n     * Multiplies this point by a value\n     * TODO: rename in scalarMultiplyEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */multiplyEquals:function(scalar){this.x*=scalar;this.y*=scalar;return this;},/**\n     * Divides this point by a value and returns a new one\n     * TODO: rename in scalarDivide in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */divide:function(scalar){return new Point(this.x/scalar,this.y/scalar);},/**\n     * Divides this point by a value\n     * TODO: rename in scalarDivideEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */divideEquals:function(scalar){this.x/=scalar;this.y/=scalar;return this;},/**\n     * Returns true if this point is equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */eq:function(that){return this.x===that.x&&this.y===that.y;},/**\n     * Returns true if this point is less than another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */lt:function(that){return this.x<that.x&&this.y<that.y;},/**\n     * Returns true if this point is less than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */lte:function(that){return this.x<=that.x&&this.y<=that.y;},/**\n    \n         * Returns true if this point is greater another one\n         * @param {fabric.Point} that\n         * @return {Boolean}\n         */gt:function(that){return this.x>that.x&&this.y>that.y;},/**\n     * Returns true if this point is greater than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */gte:function(that){return this.x>=that.x&&this.y>=that.y;},/**\n     * Returns new point which is the result of linear interpolation with this one and another one\n     * @param {fabric.Point} that\n     * @param {Number} t , position of interpolation, between 0 and 1 default 0.5\n     * @return {fabric.Point}\n     */lerp:function(that,t){if(typeof t===\"undefined\"){t=0.5;}t=Math.max(Math.min(1,t),0);return new Point(this.x+(that.x-this.x)*t,this.y+(that.y-this.y)*t);},/**\n     * Returns distance from this point and another one\n     * @param {fabric.Point} that\n     * @return {Number}\n     */distanceFrom:function(that){var dx=this.x-that.x,dy=this.y-that.y;return Math.sqrt(dx*dx+dy*dy);},/**\n     * Returns the point between this point and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */midPointFrom:function(that){return this.lerp(that);},/**\n     * Returns a new point which is the min of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */min:function(that){return new Point(Math.min(this.x,that.x),Math.min(this.y,that.y));},/**\n     * Returns a new point which is the max of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */max:function(that){return new Point(Math.max(this.x,that.x),Math.max(this.y,that.y));},/**\n     * Returns string representation of this point\n     * @return {String}\n     */toString:function(){return this.x+\",\"+this.y;},/**\n     * Sets x/y of this point\n     * @param {Number} x\n     * @param {Number} y\n     * @chainable\n     */setXY:function(x,y){this.x=x;this.y=y;return this;},/**\n     * Sets x of this point\n     * @param {Number} x\n     * @chainable\n     */setX:function(x){this.x=x;return this;},/**\n     * Sets y of this point\n     * @param {Number} y\n     * @chainable\n     */setY:function(y){this.y=y;return this;},/**\n     * Sets x/y of this point from another point\n     * @param {fabric.Point} that\n     * @chainable\n     */setFromPoint:function(that){this.x=that.x;this.y=that.y;return this;},/**\n     * Swaps x/y of this point and another point\n     * @param {fabric.Point} that\n     */swap:function(that){var x=this.x,y=this.y;this.x=that.x;this.y=that.y;that.x=x;that.y=y;},/**\n     * return a cloned instance of the point\n     * @return {fabric.Point}\n     */clone:function(){return new Point(this.x,this.y);}};})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";/* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */var fabric=global.fabric||(global.fabric={});if(fabric.Intersection){fabric.warn(\"fabric.Intersection is already defined\");return;}/**\n   * Intersection class\n   * @class fabric.Intersection\n   * @memberOf fabric\n   * @constructor\n   */function Intersection(status){this.status=status;this.points=[];}fabric.Intersection=Intersection;fabric.Intersection.prototype=/** @lends fabric.Intersection.prototype */{constructor:Intersection,/**\n     * Appends a point to intersection\n     * @param {fabric.Point} point\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */appendPoint:function(point){this.points.push(point);return this;},/**\n     * Appends points to intersection\n     * @param {Array} points\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */appendPoints:function(points){this.points=this.points.concat(points);return this;}};/**\n   * Checks if one line intersects another\n   * TODO: rename in intersectSegmentSegment\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {fabric.Point} b1\n   * @param {fabric.Point} b2\n   * @return {fabric.Intersection}\n   */fabric.Intersection.intersectLineLine=function(a1,a2,b1,b2){var result,uaT=(b2.x-b1.x)*(a1.y-b1.y)-(b2.y-b1.y)*(a1.x-b1.x),ubT=(a2.x-a1.x)*(a1.y-b1.y)-(a2.y-a1.y)*(a1.x-b1.x),uB=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(uB!==0){var ua=uaT/uB,ub=ubT/uB;if(0<=ua&&ua<=1&&0<=ub&&ub<=1){result=new Intersection(\"Intersection\");result.appendPoint(new fabric.Point(a1.x+ua*(a2.x-a1.x),a1.y+ua*(a2.y-a1.y)));}else{result=new Intersection();}}else{if(uaT===0||ubT===0){result=new Intersection(\"Coincident\");}else{result=new Intersection(\"Parallel\");}}return result;};/**\n   * Checks if line intersects polygon\n   * TODO: rename in intersectSegmentPolygon\n   * fix detection of coincident\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {Array} points\n   * @return {fabric.Intersection}\n   */fabric.Intersection.intersectLinePolygon=function(a1,a2,points){var result=new Intersection(),length=points.length,b1,b2,inter,i;for(i=0;i<length;i++){b1=points[i];b2=points[(i+1)%length];inter=Intersection.intersectLineLine(a1,a2,b1,b2);result.appendPoints(inter.points);}if(result.points.length>0){result.status=\"Intersection\";}return result;};/**\n   * Checks if polygon intersects another polygon\n   * @static\n   * @param {Array} points1\n   * @param {Array} points2\n   * @return {fabric.Intersection}\n   */fabric.Intersection.intersectPolygonPolygon=function(points1,points2){var result=new Intersection(),length=points1.length,i;for(i=0;i<length;i++){var a1=points1[i],a2=points1[(i+1)%length],inter=Intersection.intersectLinePolygon(a1,a2,points2);result.appendPoints(inter.points);}if(result.points.length>0){result.status=\"Intersection\";}return result;};/**\n   * Checks if polygon intersects rectangle\n   * @static\n   * @param {Array} points\n   * @param {fabric.Point} r1\n   * @param {fabric.Point} r2\n   * @return {fabric.Intersection}\n   */fabric.Intersection.intersectPolygonRectangle=function(points,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new fabric.Point(max.x,min.y),bottomLeft=new fabric.Point(min.x,max.y),inter1=Intersection.intersectLinePolygon(min,topRight,points),inter2=Intersection.intersectLinePolygon(topRight,max,points),inter3=Intersection.intersectLinePolygon(max,bottomLeft,points),inter4=Intersection.intersectLinePolygon(bottomLeft,min,points),result=new Intersection();result.appendPoints(inter1.points);result.appendPoints(inter2.points);result.appendPoints(inter3.points);result.appendPoints(inter4.points);if(result.points.length>0){result.status=\"Intersection\";}return result;};})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={});if(fabric.Color){fabric.warn(\"fabric.Color is already defined.\");return;}/**\n   * Color class\n   * The purpose of {@link fabric.Color} is to abstract and encapsulate common color operations;\n   * {@link fabric.Color} is a constructor and creates instances of {@link fabric.Color} objects.\n   *\n   * @class fabric.Color\n   * @param {String} color optional in hex or rgb(a) or hsl format or from known color list\n   * @return {fabric.Color} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#colors}\n   */function Color(color){if(!color){this.setSource([0,0,0,1]);}else{this._tryParsingColor(color);}}fabric.Color=Color;fabric.Color.prototype=/** @lends fabric.Color.prototype */{/**\n     * @private\n     * @param {String|Array} color Color value to parse\n     */_tryParsingColor:function(color){var source;if(color in Color.colorNameMap){color=Color.colorNameMap[color];}if(color===\"transparent\"){source=[255,255,255,0];}if(!source){source=Color.sourceFromHex(color);}if(!source){source=Color.sourceFromRgb(color);}if(!source){source=Color.sourceFromHsl(color);}if(!source){//if color is not recognize let's make black as canvas does\nsource=[0,0,0,1];}if(source){this.setSource(source);}},/**\n     * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n     * @private\n     * @param {Number} r Red color value\n     * @param {Number} g Green color value\n     * @param {Number} b Blue color value\n     * @return {Array} Hsl color\n     */_rgbToHsl:function(r,g,b){r/=255;g/=255;b/=255;var h,s,l,max=fabric.util.array.max([r,g,b]),min=fabric.util.array.min([r,g,b]);l=(max+min)/2;if(max===min){h=s=0;// achromatic\n}else{var d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}return[Math.round(h*360),Math.round(s*100),Math.round(l*100)];},/**\n     * Returns source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @return {Array}\n     */getSource:function(){return this._source;},/**\n     * Sets source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @param {Array} source\n     */setSource:function(source){this._source=source;},/**\n     * Returns color representation in RGB format\n     * @return {String} ex: rgb(0-255,0-255,0-255)\n     */toRgb:function(){var source=this.getSource();return\"rgb(\"+source[0]+\",\"+source[1]+\",\"+source[2]+\")\";},/**\n     * Returns color representation in RGBA format\n     * @return {String} ex: rgba(0-255,0-255,0-255,0-1)\n     */toRgba:function(){var source=this.getSource();return\"rgba(\"+source[0]+\",\"+source[1]+\",\"+source[2]+\",\"+source[3]+\")\";},/**\n     * Returns color representation in HSL format\n     * @return {String} ex: hsl(0-360,0%-100%,0%-100%)\n     */toHsl:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return\"hsl(\"+hsl[0]+\",\"+hsl[1]+\"%,\"+hsl[2]+\"%)\";},/**\n     * Returns color representation in HSLA format\n     * @return {String} ex: hsla(0-360,0%-100%,0%-100%,0-1)\n     */toHsla:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return\"hsla(\"+hsl[0]+\",\"+hsl[1]+\"%,\"+hsl[2]+\"%,\"+source[3]+\")\";},/**\n     * Returns color representation in HEX format\n     * @return {String} ex: FF5555\n     */toHex:function(){var source=this.getSource(),r,g,b;r=source[0].toString(16);r=r.length===1?\"0\"+r:r;g=source[1].toString(16);g=g.length===1?\"0\"+g:g;b=source[2].toString(16);b=b.length===1?\"0\"+b:b;return r.toUpperCase()+g.toUpperCase()+b.toUpperCase();},/**\n     * Returns color representation in HEXA format\n     * @return {String} ex: FF5555CC\n     */toHexa:function(){var source=this.getSource(),a;a=Math.round(source[3]*255);a=a.toString(16);a=a.length===1?\"0\"+a:a;return this.toHex()+a.toUpperCase();},/**\n     * Gets value of alpha channel for this color\n     * @return {Number} 0-1\n     */getAlpha:function(){return this.getSource()[3];},/**\n     * Sets value of alpha channel for this color\n     * @param {Number} alpha Alpha value 0-1\n     * @return {fabric.Color} thisArg\n     */setAlpha:function(alpha){var source=this.getSource();source[3]=alpha;this.setSource(source);return this;},/**\n     * Transforms color to its grayscale representation\n     * @return {fabric.Color} thisArg\n     */toGrayscale:function(){var source=this.getSource(),average=parseInt((source[0]*0.3+source[1]*0.59+source[2]*0.11).toFixed(0),10),currentAlpha=source[3];this.setSource([average,average,average,currentAlpha]);return this;},/**\n     * Transforms color to its black and white representation\n     * @param {Number} threshold\n     * @return {fabric.Color} thisArg\n     */toBlackWhite:function(threshold){var source=this.getSource(),average=(source[0]*0.3+source[1]*0.59+source[2]*0.11).toFixed(0),currentAlpha=source[3];threshold=threshold||127;average=Number(average)<Number(threshold)?0:255;this.setSource([average,average,average,currentAlpha]);return this;},/**\n     * Overlays color with another color\n     * @param {String|fabric.Color} otherColor\n     * @return {fabric.Color} thisArg\n     */overlayWith:function(otherColor){if(!(otherColor instanceof Color)){otherColor=new Color(otherColor);}var result=[],alpha=this.getAlpha(),otherAlpha=0.5,source=this.getSource(),otherSource=otherColor.getSource(),i;for(i=0;i<3;i++){result.push(Math.round(source[i]*(1-otherAlpha)+otherSource[i]*otherAlpha));}result[3]=alpha;this.setSource(result);return this;}};/**\n   * Regex matching color in RGB or RGBA formats (ex: rgb(0, 0, 0), rgba(255, 100, 10, 0.5), rgba( 255 , 100 , 10 , 0.5 ), rgb(1,1,1), rgba(100%, 60%, 10%, 0.5))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */ // eslint-disable-next-line max-len\nfabric.Color.reRGBa=/^rgba?\\(\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*(?:\\s*,\\s*((?:\\d*\\.?\\d+)?)\\s*)?\\)$/i;/**\n   * Regex matching color in HSL or HSLA formats (ex: hsl(200, 80%, 10%), hsla(300, 50%, 80%, 0.5), hsla( 300 , 50% , 80% , 0.5 ))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */fabric.Color.reHSLa=/^hsla?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3}\\%)\\s*,\\s*(\\d{1,3}\\%)\\s*(?:\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)$/i;/**\n   * Regex matching color in HEX format (ex: #FF5544CC, #FF5555, 010155, aff)\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */fabric.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;/**\n   * Map of the 148 color names with HEX code\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   * @see: https://www.w3.org/TR/css3-color/#svg-color\n   */fabric.Color.colorNameMap={aliceblue:\"#F0F8FF\",antiquewhite:\"#FAEBD7\",aqua:\"#00FFFF\",aquamarine:\"#7FFFD4\",azure:\"#F0FFFF\",beige:\"#F5F5DC\",bisque:\"#FFE4C4\",black:\"#000000\",blanchedalmond:\"#FFEBCD\",blue:\"#0000FF\",blueviolet:\"#8A2BE2\",brown:\"#A52A2A\",burlywood:\"#DEB887\",cadetblue:\"#5F9EA0\",chartreuse:\"#7FFF00\",chocolate:\"#D2691E\",coral:\"#FF7F50\",cornflowerblue:\"#6495ED\",cornsilk:\"#FFF8DC\",crimson:\"#DC143C\",cyan:\"#00FFFF\",darkblue:\"#00008B\",darkcyan:\"#008B8B\",darkgoldenrod:\"#B8860B\",darkgray:\"#A9A9A9\",darkgrey:\"#A9A9A9\",darkgreen:\"#006400\",darkkhaki:\"#BDB76B\",darkmagenta:\"#8B008B\",darkolivegreen:\"#556B2F\",darkorange:\"#FF8C00\",darkorchid:\"#9932CC\",darkred:\"#8B0000\",darksalmon:\"#E9967A\",darkseagreen:\"#8FBC8F\",darkslateblue:\"#483D8B\",darkslategray:\"#2F4F4F\",darkslategrey:\"#2F4F4F\",darkturquoise:\"#00CED1\",darkviolet:\"#9400D3\",deeppink:\"#FF1493\",deepskyblue:\"#00BFFF\",dimgray:\"#696969\",dimgrey:\"#696969\",dodgerblue:\"#1E90FF\",firebrick:\"#B22222\",floralwhite:\"#FFFAF0\",forestgreen:\"#228B22\",fuchsia:\"#FF00FF\",gainsboro:\"#DCDCDC\",ghostwhite:\"#F8F8FF\",gold:\"#FFD700\",goldenrod:\"#DAA520\",gray:\"#808080\",grey:\"#808080\",green:\"#008000\",greenyellow:\"#ADFF2F\",honeydew:\"#F0FFF0\",hotpink:\"#FF69B4\",indianred:\"#CD5C5C\",indigo:\"#4B0082\",ivory:\"#FFFFF0\",khaki:\"#F0E68C\",lavender:\"#E6E6FA\",lavenderblush:\"#FFF0F5\",lawngreen:\"#7CFC00\",lemonchiffon:\"#FFFACD\",lightblue:\"#ADD8E6\",lightcoral:\"#F08080\",lightcyan:\"#E0FFFF\",lightgoldenrodyellow:\"#FAFAD2\",lightgray:\"#D3D3D3\",lightgrey:\"#D3D3D3\",lightgreen:\"#90EE90\",lightpink:\"#FFB6C1\",lightsalmon:\"#FFA07A\",lightseagreen:\"#20B2AA\",lightskyblue:\"#87CEFA\",lightslategray:\"#778899\",lightslategrey:\"#778899\",lightsteelblue:\"#B0C4DE\",lightyellow:\"#FFFFE0\",lime:\"#00FF00\",limegreen:\"#32CD32\",linen:\"#FAF0E6\",magenta:\"#FF00FF\",maroon:\"#800000\",mediumaquamarine:\"#66CDAA\",mediumblue:\"#0000CD\",mediumorchid:\"#BA55D3\",mediumpurple:\"#9370DB\",mediumseagreen:\"#3CB371\",mediumslateblue:\"#7B68EE\",mediumspringgreen:\"#00FA9A\",mediumturquoise:\"#48D1CC\",mediumvioletred:\"#C71585\",midnightblue:\"#191970\",mintcream:\"#F5FFFA\",mistyrose:\"#FFE4E1\",moccasin:\"#FFE4B5\",navajowhite:\"#FFDEAD\",navy:\"#000080\",oldlace:\"#FDF5E6\",olive:\"#808000\",olivedrab:\"#6B8E23\",orange:\"#FFA500\",orangered:\"#FF4500\",orchid:\"#DA70D6\",palegoldenrod:\"#EEE8AA\",palegreen:\"#98FB98\",paleturquoise:\"#AFEEEE\",palevioletred:\"#DB7093\",papayawhip:\"#FFEFD5\",peachpuff:\"#FFDAB9\",peru:\"#CD853F\",pink:\"#FFC0CB\",plum:\"#DDA0DD\",powderblue:\"#B0E0E6\",purple:\"#800080\",rebeccapurple:\"#663399\",red:\"#FF0000\",rosybrown:\"#BC8F8F\",royalblue:\"#4169E1\",saddlebrown:\"#8B4513\",salmon:\"#FA8072\",sandybrown:\"#F4A460\",seagreen:\"#2E8B57\",seashell:\"#FFF5EE\",sienna:\"#A0522D\",silver:\"#C0C0C0\",skyblue:\"#87CEEB\",slateblue:\"#6A5ACD\",slategray:\"#708090\",slategrey:\"#708090\",snow:\"#FFFAFA\",springgreen:\"#00FF7F\",steelblue:\"#4682B4\",tan:\"#D2B48C\",teal:\"#008080\",thistle:\"#D8BFD8\",tomato:\"#FF6347\",turquoise:\"#40E0D0\",violet:\"#EE82EE\",wheat:\"#F5DEB3\",white:\"#FFFFFF\",whitesmoke:\"#F5F5F5\",yellow:\"#FFFF00\",yellowgreen:\"#9ACD32\"};/**\n   * @private\n   * @param {Number} p\n   * @param {Number} q\n   * @param {Number} t\n   * @return {Number}\n   */function hue2rgb(p,q,t){if(t<0){t+=1;}if(t>1){t-=1;}if(t<1/6){return p+(q-p)*6*t;}if(t<1/2){return q;}if(t<2/3){return p+(q-p)*(2/3-t)*6;}return p;}/**\n   * Returns new color object, when given a color in RGB format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255)\n   * @return {fabric.Color}\n   */fabric.Color.fromRgb=function(color){return Color.fromSource(Color.sourceFromRgb(color));};/**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in RGB or RGBA format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255), rgb(0%-100%,0%-100%,0%-100%)\n   * @return {Array} source\n   */fabric.Color.sourceFromRgb=function(color){var match=color.match(Color.reRGBa);if(match){var r=parseInt(match[1],10)/(/%$/.test(match[1])?100:1)*(/%$/.test(match[1])?255:1),g=parseInt(match[2],10)/(/%$/.test(match[2])?100:1)*(/%$/.test(match[2])?255:1),b=parseInt(match[3],10)/(/%$/.test(match[3])?100:1)*(/%$/.test(match[3])?255:1);return[parseInt(r,10),parseInt(g,10),parseInt(b,10),match[4]?parseFloat(match[4]):1];}};/**\n   * Returns new color object, when given a color in RGBA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */fabric.Color.fromRgba=Color.fromRgb;/**\n   * Returns new color object, when given a color in HSL format\n   * @param {String} color Color value ex: hsl(0-260,0%-100%,0%-100%)\n   * @memberOf fabric.Color\n   * @return {fabric.Color}\n   */fabric.Color.fromHsl=function(color){return Color.fromSource(Color.sourceFromHsl(color));};/**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HSL or HSLA format.\n   * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: hsl(0-360,0%-100%,0%-100%) or hsla(0-360,0%-100%,0%-100%, 0-1)\n   * @return {Array} source\n   * @see http://http://www.w3.org/TR/css3-color/#hsl-color\n   */fabric.Color.sourceFromHsl=function(color){var match=color.match(Color.reHSLa);if(!match){return;}var h=(parseFloat(match[1])%360+360)%360/360,s=parseFloat(match[2])/(/%$/.test(match[2])?100:1),l=parseFloat(match[3])/(/%$/.test(match[3])?100:1),r,g,b;if(s===0){r=g=b=l;}else{var q=l<=0.5?l*(s+1):l+s-l*s,p=l*2-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3);}return[Math.round(r*255),Math.round(g*255),Math.round(b*255),match[4]?parseFloat(match[4]):1];};/**\n   * Returns new color object, when given a color in HSLA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */fabric.Color.fromHsla=Color.fromHsl;/**\n   * Returns new color object, when given a color in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: FF5555\n   * @return {fabric.Color}\n   */fabric.Color.fromHex=function(color){return Color.fromSource(Color.sourceFromHex(color));};/**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color ex: FF5555 or FF5544CC (RGBa)\n   * @return {Array} source\n   */fabric.Color.sourceFromHex=function(color){if(color.match(Color.reHex)){var value=color.slice(color.indexOf(\"#\")+1),isShortNotation=value.length===3||value.length===4,isRGBa=value.length===8||value.length===4,r=isShortNotation?value.charAt(0)+value.charAt(0):value.substring(0,2),g=isShortNotation?value.charAt(1)+value.charAt(1):value.substring(2,4),b=isShortNotation?value.charAt(2)+value.charAt(2):value.substring(4,6),a=isRGBa?isShortNotation?value.charAt(3)+value.charAt(3):value.substring(6,8):\"FF\";return[parseInt(r,16),parseInt(g,16),parseInt(b,16),parseFloat((parseInt(a,16)/255).toFixed(2))];}};/**\n   * Returns new color object, when given color in array representation (ex: [200, 100, 100, 0.5])\n   * @static\n   * @memberOf fabric.Color\n   * @param {Array} source\n   * @return {fabric.Color}\n   */fabric.Color.fromSource=function(source){var oColor=new Color();oColor.setSource(source);return oColor;};})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),scaleMap=[\"e\",\"se\",\"s\",\"sw\",\"w\",\"nw\",\"n\",\"ne\",\"e\"],skewMap=[\"ns\",\"nesw\",\"ew\",\"nwse\"],controls={},LEFT=\"left\",TOP=\"top\",RIGHT=\"right\",BOTTOM=\"bottom\",CENTER=\"center\",opposite={top:BOTTOM,bottom:TOP,left:RIGHT,right:LEFT},radiansToDegrees=fabric.util.radiansToDegrees,sign=Math.sign||function(x){return(x>0)-(x<0)||+x;};/**\n   * Combine control position and object angle to find the control direction compared\n   * to the object center.\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   * @param {fabric.Control} control the control class\n   * @return {Number} 0 - 7 a quadrant number\n   */function findCornerQuadrant(fabricObject,control){var cornerAngle=fabricObject.angle+radiansToDegrees(Math.atan2(control.y,control.x))+360;return Math.round(cornerAngle%360/45);}function fireEvent(eventName,options){var target=options.transform.target,canvas=target.canvas,canasOptions=Object.assign({},options,{target:target});canvas&&canvas.fire(\"object:\"+eventName,canasOptions);target.fire(eventName,options);}/**\n   * Inspect event and fabricObject properties to understand if the scaling action\n   * @param {Event} eventData from the user action\n   * @param {fabric.Object} fabricObject the fabric object about to scale\n   * @return {Boolean} true if scale is proportional\n   */function scaleIsProportional(eventData,fabricObject){var canvas=fabricObject.canvas,uniScaleKey=canvas.uniScaleKey,uniformIsToggled=eventData[uniScaleKey];return canvas.uniformScaling&&!uniformIsToggled||!canvas.uniformScaling&&uniformIsToggled;}/**\n   * Inspect fabricObject to understand if the current scaling action is allowed\n   * @param {fabric.Object} fabricObject the fabric object about to scale\n   * @param {String} by 'x' or 'y' or ''\n   * @param {Boolean} scaleProportionally true if we are trying to scale proportionally\n   * @return {Boolean} true if scaling is not allowed at current conditions\n   */function scalingIsForbidden(fabricObject,by,scaleProportionally){var lockX=fabricObject.lockScalingX,lockY=fabricObject.lockScalingY;if(lockX&&lockY){return true;}if(!by&&(lockX||lockY)&&scaleProportionally){return true;}if(lockX&&by===\"x\"){return true;}if(lockY&&by===\"y\"){return true;}return false;}/**\n   * return the correct cursor style for the scale action\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */function scaleCursorStyleHandler(eventData,control,fabricObject){var notAllowed=\"not-allowed\",scaleProportionally=scaleIsProportional(eventData,fabricObject),by=\"\";if(control.x!==0&&control.y===0){by=\"x\";}else if(control.x===0&&control.y!==0){by=\"y\";}if(scalingIsForbidden(fabricObject,by,scaleProportionally)){return notAllowed;}var n=findCornerQuadrant(fabricObject,control);return scaleMap[n]+\"-resize\";}/**\n   * return the correct cursor style for the skew action\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */function skewCursorStyleHandler(eventData,control,fabricObject){var notAllowed=\"not-allowed\";if(control.x!==0&&fabricObject.lockSkewingY){return notAllowed;}if(control.y!==0&&fabricObject.lockSkewingX){return notAllowed;}var n=findCornerQuadrant(fabricObject,control)%4;return skewMap[n]+\"-resize\";}/**\n   * Combine skew and scale style handlers to cover fabric standard use case\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */function scaleSkewCursorStyleHandler(eventData,control,fabricObject){if(eventData[fabricObject.canvas.altActionKey]){return controls.skewCursorStyleHandler(eventData,control,fabricObject);}return controls.scaleCursorStyleHandler(eventData,control,fabricObject);}/**\n   * Inspect event , control and fabricObject to return the correct action name\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} an action name\n   */function scaleOrSkewActionName(eventData,control,fabricObject){var isAlternative=eventData[fabricObject.canvas.altActionKey];if(control.x===0){// then is scaleY or skewX\nreturn isAlternative?\"skewX\":\"scaleY\";}if(control.y===0){// then is scaleY or skewX\nreturn isAlternative?\"skewY\":\"scaleX\";}}/**\n   * Find the correct style for the control that is used for rotation.\n   * this function is very simple and it just take care of not-allowed or standard cursor\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */function rotationStyleHandler(eventData,control,fabricObject){if(fabricObject.lockRotation){return\"not-allowed\";}return control.cursorStyle;}function commonEventInfo(eventData,transform,x,y){return{e:eventData,transform:transform,pointer:{x:x,y:y}};}/**\n   * Wrap an action handler with saving/restoring object position on the transform.\n   * this is the code that permits to obects to keep their position while transforming.\n   * @param {Function} actionHandler the function to wrap\n   * @return {Function} a function with an action handler signature\n   */function wrapWithFixedAnchor(actionHandler){return function(eventData,transform,x,y){var target=transform.target,centerPoint=target.getCenterPoint(),constraint=target.translateToOriginPoint(centerPoint,transform.originX,transform.originY),actionPerformed=actionHandler(eventData,transform,x,y);target.setPositionByOrigin(constraint,transform.originX,transform.originY);return actionPerformed;};}/**\n   * Transforms a point described by x and y in a distance from the top left corner of the object\n   * bounding box.\n   * @param {Object} transform\n   * @param {String} originX\n   * @param {String} originY\n   * @param {number} x\n   * @param {number} y\n   * @return {Fabric.Point} the normalized point\n   */function getLocalPoint(transform,originX,originY,x,y){var target=transform.target,control=target.controls[transform.corner],zoom=target.canvas.getZoom(),padding=target.padding/zoom,localPoint=target.toLocalPoint(new fabric.Point(x,y),originX,originY);if(localPoint.x>=padding){localPoint.x-=padding;}if(localPoint.x<=-padding){localPoint.x+=padding;}if(localPoint.y>=padding){localPoint.y-=padding;}if(localPoint.y<=padding){localPoint.y+=padding;}localPoint.x-=control.offsetX;localPoint.y-=control.offsetY;return localPoint;}/**\n   * Detect if the fabric object is flipped on one side.\n   * @param {fabric.Object} target\n   * @return {Boolean} true if one flip, but not two.\n   */function targetHasOneFlip(target){return target.flipX&&!target.flipY||!target.flipX&&target.flipY;}/**\n   * Utility function to componsate the scale factor when skew is applied on both axes\n   * @private\n   */function compensateScaleForSkew(target,oppositeSkew,scaleToCompoensate,axis,reference){if(target[oppositeSkew]!==0){var newDim=target._getTransformedDimensions()[axis];var newValue=reference/newDim*target[scaleToCompoensate];target.set(scaleToCompoensate,newValue);}}/**\n   * Action handler for skewing on the X axis\n   * @private\n   */function skewObjectX(eventData,transform,x,y){var target=transform.target,// find how big the object would be, if there was no skewX. takes in account scaling\ndimNoSkew=target._getTransformedDimensions(0,target.skewY),localPoint=getLocalPoint(transform,transform.originX,transform.originY,x,y),// the mouse is in the center of the object, and we want it to stay there.\n// so the object will grow twice as much as the mouse.\n// this makes the skew growth to localPoint * 2 - dimNoSkew.\ntotalSkewSize=Math.abs(localPoint.x*2)-dimNoSkew.x,currentSkew=target.skewX,newSkew;if(totalSkewSize<2){// let's make it easy to go back to position 0.\nnewSkew=0;}else{newSkew=radiansToDegrees(Math.atan2(totalSkewSize/target.scaleX,dimNoSkew.y/target.scaleY));// now we have to find the sign of the skew.\n// it mostly depend on the origin of transformation.\nif(transform.originX===LEFT&&transform.originY===BOTTOM){newSkew=-newSkew;}if(transform.originX===RIGHT&&transform.originY===TOP){newSkew=-newSkew;}if(targetHasOneFlip(target)){newSkew=-newSkew;}}var hasSkewed=currentSkew!==newSkew;if(hasSkewed){var dimBeforeSkewing=target._getTransformedDimensions().y;target.set(\"skewX\",newSkew);compensateScaleForSkew(target,\"skewY\",\"scaleY\",\"y\",dimBeforeSkewing);fireEvent(\"skewing\",commonEventInfo(eventData,transform,x,y));}return hasSkewed;}/**\n   * Action handler for skewing on the Y axis\n   * @private\n   */function skewObjectY(eventData,transform,x,y){var target=transform.target,// find how big the object would be, if there was no skewX. takes in account scaling\ndimNoSkew=target._getTransformedDimensions(target.skewX,0),localPoint=getLocalPoint(transform,transform.originX,transform.originY,x,y),// the mouse is in the center of the object, and we want it to stay there.\n// so the object will grow twice as much as the mouse.\n// this makes the skew growth to localPoint * 2 - dimNoSkew.\ntotalSkewSize=Math.abs(localPoint.y*2)-dimNoSkew.y,currentSkew=target.skewY,newSkew;if(totalSkewSize<2){// let's make it easy to go back to position 0.\nnewSkew=0;}else{newSkew=radiansToDegrees(Math.atan2(totalSkewSize/target.scaleY,dimNoSkew.x/target.scaleX));// now we have to find the sign of the skew.\n// it mostly depend on the origin of transformation.\nif(transform.originX===LEFT&&transform.originY===BOTTOM){newSkew=-newSkew;}if(transform.originX===RIGHT&&transform.originY===TOP){newSkew=-newSkew;}if(targetHasOneFlip(target)){newSkew=-newSkew;}}var hasSkewed=currentSkew!==newSkew;if(hasSkewed){var dimBeforeSkewing=target._getTransformedDimensions().x;target.set(\"skewY\",newSkew);compensateScaleForSkew(target,\"skewX\",\"scaleX\",\"x\",dimBeforeSkewing);fireEvent(\"skewing\",commonEventInfo(eventData,transform,x,y));}return hasSkewed;}/**\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\n   * skew direction and determine the correct transform origin for the anchor point\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */function skewHandlerX(eventData,transform,x,y){// step1 figure out and change transform origin.\n// if skewX > 0 and originY bottom we anchor on right\n// if skewX > 0 and originY top we anchor on left\n// if skewX < 0 and originY bottom we anchor on left\n// if skewX < 0 and originY top we anchor on right\n// if skewX is 0, we look for mouse position to understand where are we going.\nvar target=transform.target,currentSkew=target.skewX,originX,originY=transform.originY;if(target.lockSkewingX){return false;}if(currentSkew===0){var localPointFromCenter=getLocalPoint(transform,CENTER,CENTER,x,y);if(localPointFromCenter.x>0){// we are pulling right, anchor left;\noriginX=LEFT;}else{// we are pulling right, anchor right\noriginX=RIGHT;}}else{if(currentSkew>0){originX=originY===TOP?LEFT:RIGHT;}if(currentSkew<0){originX=originY===TOP?RIGHT:LEFT;}// is the object flipped on one side only? swap the origin.\nif(targetHasOneFlip(target)){originX=originX===LEFT?RIGHT:LEFT;}}// once we have the origin, we find the anchor point\ntransform.originX=originX;var finalHandler=wrapWithFixedAnchor(skewObjectX);return finalHandler(eventData,transform,x,y);}/**\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\n   * skew direction and determine the correct transform origin for the anchor point\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */function skewHandlerY(eventData,transform,x,y){// step1 figure out and change transform origin.\n// if skewY > 0 and originX left we anchor on top\n// if skewY > 0 and originX right we anchor on bottom\n// if skewY < 0 and originX left we anchor on bottom\n// if skewY < 0 and originX right we anchor on top\n// if skewY is 0, we look for mouse position to understand where are we going.\nvar target=transform.target,currentSkew=target.skewY,originY,originX=transform.originX;if(target.lockSkewingY){return false;}if(currentSkew===0){var localPointFromCenter=getLocalPoint(transform,CENTER,CENTER,x,y);if(localPointFromCenter.y>0){// we are pulling down, anchor up;\noriginY=TOP;}else{// we are pulling up, anchor down\noriginY=BOTTOM;}}else{if(currentSkew>0){originY=originX===LEFT?TOP:BOTTOM;}if(currentSkew<0){originY=originX===LEFT?BOTTOM:TOP;}// is the object flipped on one side only? swap the origin.\nif(targetHasOneFlip(target)){originY=originY===TOP?BOTTOM:TOP;}}// once we have the origin, we find the anchor point\ntransform.originY=originY;var finalHandler=wrapWithFixedAnchor(skewObjectY);return finalHandler(eventData,transform,x,y);}/**\n   * Action handler for rotation and snapping, without anchor point.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   * @private\n   */function rotationWithSnapping(eventData,transform,x,y){var t=transform,target=t.target,pivotPoint=target.translateToOriginPoint(target.getCenterPoint(),t.originX,t.originY);if(target.lockRotation){return false;}var lastAngle=Math.atan2(t.ey-pivotPoint.y,t.ex-pivotPoint.x),curAngle=Math.atan2(y-pivotPoint.y,x-pivotPoint.x),angle=radiansToDegrees(curAngle-lastAngle+t.theta),hasRotated=true;if(target.snapAngle>0){var snapAngle=target.snapAngle,snapThreshold=target.snapThreshold||snapAngle,rightAngleLocked=Math.ceil(angle/snapAngle)*snapAngle,leftAngleLocked=Math.floor(angle/snapAngle)*snapAngle;if(Math.abs(angle-leftAngleLocked)<snapThreshold){angle=leftAngleLocked;}else if(Math.abs(angle-rightAngleLocked)<snapThreshold){angle=rightAngleLocked;}}// normalize angle to positive value\nif(angle<0){angle=360+angle;}angle%=360;hasRotated=target.angle!==angle;target.angle=angle;if(hasRotated){fireEvent(\"rotating\",commonEventInfo(eventData,transform,x,y));}return hasRotated;}/**\n   * Basic scaling logic, reused with differnt constrain for scaling X,Y, freely or equally.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @param {Object} options additional information for scaling\n   * @param {String} options.by 'x', 'y', 'equally' or '' to indicate type of scaling\n   * @return {Boolean} true if some change happened\n   * @private\n   */function scaleObject(eventData,transform,x,y,options){options=options||{};var target=transform.target,lockScalingX=target.lockScalingX,lockScalingY=target.lockScalingY,by=options.by,newPoint,scaleX,scaleY,dim,scaleProportionally=scaleIsProportional(eventData,target),forbidScaling=scalingIsForbidden(target,by,scaleProportionally),signX,signY;if(forbidScaling){return false;}newPoint=getLocalPoint(transform,transform.originX,transform.originY,x,y);signX=sign(newPoint.x);signY=sign(newPoint.y);if(!transform.signX){transform.signX=signX;}if(!transform.signY){transform.signY=signY;}if(target.lockScalingFlip&&(transform.signX!==signX||transform.signY!==signY)){return false;}dim=target._getTransformedDimensions();// missing detection of flip and logic to switch the origin\nif(scaleProportionally&&!by){// uniform scaling\nvar distance=Math.abs(newPoint.x)+Math.abs(newPoint.y),original=transform.original,originalDistance=Math.abs(dim.x*original.scaleX/target.scaleX)+Math.abs(dim.y*original.scaleY/target.scaleY),scale=distance/originalDistance,hasScaled;scaleX=original.scaleX*scale;scaleY=original.scaleY*scale;}else{scaleX=Math.abs(newPoint.x*target.scaleX/dim.x);scaleY=Math.abs(newPoint.y*target.scaleY/dim.y);}// if we are scaling by center, we need to double the scale\nif(transform.originX===CENTER&&transform.originY===CENTER){scaleX*=2;scaleY*=2;}if(transform.signX!==signX){transform.originX=opposite[transform.originX];scaleX*=-1;transform.signX=signX;}if(transform.signY!==signY){transform.originY=opposite[transform.originY];scaleY*=-1;transform.signY=signY;}// minScale is taken are in the setter.\nvar oldScaleX=target.scaleX,oldScaleY=target.scaleY;if(!by){!lockScalingX&&target.set(\"scaleX\",scaleX);!lockScalingY&&target.set(\"scaleY\",scaleY);}else{// forbidden cases already handled on top here.\nby===\"x\"&&target.set(\"scaleX\",scaleX);by===\"y\"&&target.set(\"scaleY\",scaleY);}hasScaled=oldScaleX!==target.scaleX||oldScaleY!==target.scaleY;if(hasScaled){fireEvent(\"scaling\",commonEventInfo(eventData,transform,x,y));}return hasScaled;}/**\n   * Generic scaling logic, to scale from corners either equally or freely.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */function scaleObjectFromCorner(eventData,transform,x,y){return scaleObject(eventData,transform,x,y);}/**\n   * Scaling logic for the X axis.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */function scaleObjectX(eventData,transform,x,y){return scaleObject(eventData,transform,x,y,{by:\"x\"});}/**\n   * Scaling logic for the Y axis.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */function scaleObjectY(eventData,transform,x,y){return scaleObject(eventData,transform,x,y,{by:\"y\"});}/**\n   * Composed action handler to either scale Y or skew X\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */function scalingYOrSkewingX(eventData,transform,x,y){// ok some safety needed here.\nif(eventData[transform.target.canvas.altActionKey]){return controls.skewHandlerX(eventData,transform,x,y);}return controls.scalingY(eventData,transform,x,y);}/**\n   * Composed action handler to either scale X or skew Y\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */function scalingXOrSkewingY(eventData,transform,x,y){// ok some safety needed here.\nif(eventData[transform.target.canvas.altActionKey]){return controls.skewHandlerY(eventData,transform,x,y);}return controls.scalingX(eventData,transform,x,y);}/**\n   * Action handler to change textbox width\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */function changeWidth(eventData,transform,x,y){var target=transform.target,localPoint=getLocalPoint(transform,transform.originX,transform.originY,x,y),strokePadding=target.strokeWidth/(target.strokeUniform?target.scaleX:1),newWidth=Math.abs(localPoint.x/target.scaleX)-strokePadding;target.set(\"width\",Math.max(newWidth,0));return true;}controls.scaleCursorStyleHandler=scaleCursorStyleHandler;controls.skewCursorStyleHandler=skewCursorStyleHandler;controls.scaleSkewCursorStyleHandler=scaleSkewCursorStyleHandler;controls.rotationWithSnapping=wrapWithFixedAnchor(rotationWithSnapping);controls.scalingEqually=wrapWithFixedAnchor(scaleObjectFromCorner);controls.scalingX=wrapWithFixedAnchor(scaleObjectX);controls.scalingY=wrapWithFixedAnchor(scaleObjectY);controls.scalingYOrSkewingX=scalingYOrSkewingX;controls.scalingXOrSkewingY=scalingXOrSkewingY;controls.changeWidth=wrapWithFixedAnchor(changeWidth);controls.skewHandlerX=skewHandlerX;controls.skewHandlerY=skewHandlerY;controls.scaleOrSkewActionName=scaleOrSkewActionName;controls.rotationStyleHandler=rotationStyleHandler;controls.fireEvent=fireEvent;controls.wrapWithFixedAnchor=wrapWithFixedAnchor;controls.getLocalPoint=getLocalPoint;fabric.controlsUtils=controls;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),degreesToRadians=fabric.util.degreesToRadians,controls=fabric.controlsUtils;/**\n   * Render a round control, as per fabric features.\n   * This function is written to respect object properties like transparentCorners, cornerSize\n   * cornerColor, cornerStrokeColor\n   * plus the addition of offsetY and offsetX.\n   * @param {CanvasRenderingContext2D} ctx context to render on\n   * @param {Number} left x coordinate where the control center should be\n   * @param {Number} top y coordinate where the control center should be\n   * @param {Object} styleOverride override for fabric.Object controls style\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   */function renderCircleControl(ctx,left,top,styleOverride,fabricObject){styleOverride=styleOverride||{};var size=styleOverride.cornerSize||fabricObject.cornerSize,transparentCorners=typeof styleOverride.transparentCorners!==\"undefined\"?styleOverride.transparentCorners:this.transparentCorners,methodName=transparentCorners?\"stroke\":\"fill\",stroke=!transparentCorners&&(styleOverride.cornerStrokeColor||fabricObject.cornerStrokeColor);ctx.save();ctx.fillStyle=styleOverride.cornerColor||fabricObject.cornerColor;ctx.strokeStyle=styleOverride.cornerStrokeColor||fabricObject.cornerStrokeColor;// this is still wrong\nctx.lineWidth=1;ctx.beginPath();ctx.arc(left,top,size/2,0,2*Math.PI,false);ctx[methodName]();if(stroke){ctx.stroke();}ctx.restore();}/**\n   * Render a square control, as per fabric features.\n   * This function is written to respect object properties like transparentCorners, cornerSize\n   * cornerColor, cornerStrokeColor\n   * plus the addition of offsetY and offsetX.\n   * @param {CanvasRenderingContext2D} ctx context to render on\n   * @param {Number} left x coordinate where the control center should be\n   * @param {Number} top y coordinate where the control center should be\n   * @param {Object} styleOverride override for fabric.Object controls style\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   */function renderSquareControl(ctx,left,top,styleOverride,fabricObject){styleOverride=styleOverride||{};var size=styleOverride.cornerSize||fabricObject.cornerSize,transparentCorners=typeof styleOverride.transparentCorners!==\"undefined\"?styleOverride.transparentCorners:fabricObject.transparentCorners,methodName=transparentCorners?\"stroke\":\"fill\",stroke=!transparentCorners&&(styleOverride.cornerStrokeColor||fabricObject.cornerStrokeColor),sizeBy2=size/2;ctx.save();ctx.fillStyle=styleOverride.cornerColor||fabricObject.cornerColor;ctx.strokeStyle=styleOverride.strokeCornerColor||fabricObject.strokeCornerColor;// this is still wrong\nctx.lineWidth=1;ctx.translate(left,top);ctx.rotate(degreesToRadians(fabricObject.angle));// this does not work, and fixed with ( && ) does not make sense.\n// to have real transparent corners we need the controls on upperCanvas\n// transparentCorners || ctx.clearRect(-sizeBy2, -sizeBy2, size, size);\nctx[methodName+\"Rect\"](-sizeBy2,-sizeBy2,size,size);if(stroke){ctx.strokeRect(-sizeBy2,-sizeBy2,size,size);}ctx.restore();}controls.renderCircleControl=renderCircleControl;controls.renderSquareControl=renderSquareControl;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={});function Control(options){for(var i in options){this[i]=options[i];}}fabric.Control=Control;fabric.Control.prototype=/** @lends fabric.Control.prototype */{/**\n     * keep track of control visibility.\n     * mainly for backward compatibility.\n     * if you do not want to see a control, you can remove it\n     * from the controlset.\n     * @type {Boolean}\n     * @default true\n     */visible:true,/**\n     * Name of the action that the controll will likely execute.\n     * This is optional. FabricJS uses to identify what the user is doing for some\n     * extra optimizations. If you are writing a custom control and you want to know\n     * somewhere else in the code what is going on, you can use this string here.\n     * you can also provide a custom getActionName if your control run multiple actions\n     * depending on some external state.\n     * default to scale since is the most common, used on 4 corners by default\n     * @type {String}\n     * @default 'scale'\n     */actionName:\"scale\",/**\n     * Drawing angle of the control.\n     * NOT used for now, but name marked as needed for internal logic\n     * example: to reuse the same drawing function for different rotated controls\n     * @type {Number}\n     * @default 0\n     */angle:0,/**\n     * Relative position of the control. X\n     * 0,0 is the center of the Object, while -0.5 (left) or 0.5 (right) are the extremities\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */x:0,/**\n     * Relative position of the control. Y\n     * 0,0 is the center of the Object, while -0.5 (top) or 0.5 (bottom) are the extremities\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */y:0,/**\n     * Horizontal offset of the control from the defined position. In pixels\n     * Positive offset moves the control to the right, negative to the left.\n     * It used when you want to have position of control that does not scale with\n     * the bounding box. Example: rotation control is placed at x:0, y: 0.5 on\n     * the boundindbox, with an offset of 30 pixels vertivally. Those 30 pixels will\n     * stay 30 pixels no matter how the object is big. Another example is having 2\n     * controls in the corner, that stay in the same position when the object scale.\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */offsetX:0,/**\n     * Vertical offset of the control from the defined position. In pixels\n     * Positive offset moves the control to the bottom, negative to the top.\n     * @type {Number}\n     * @default 0\n     */offsetY:0,/**\n     * Css cursor style to display when the control is hovered.\n     * if the method `cursorStyleHandler` is provided, this property is ignored.\n     * @type {String}\n     * @default 'crosshair'\n     */cursorStyle:\"crosshair\",/**\n     * If controls has an offsetY or offsetX, draw a line that connects\n     * the control to the bounding box\n     * @type {Boolean}\n     * @default false\n     */withConnection:false,/**\n     * The control actionHandler, provide one to handle action ( control being moved )\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */actionHandler:function/* eventData, transformData, fabricObject */(){},/**\n     * The control handler for mouse down, provide one to handle mouse down on control\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */mouseDownHandler:function/* eventData, transformData, fabricObject */(){},/**\n     * The control mouseUpHandler, provide one to handle an effect on mouse up.\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */mouseUpHandler:function/* eventData, transformData, fabricObject */(){},/**\n     * Returns control actionHandler\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */getActionHandler:function/* eventData, transformData, fabricObject */(){return this.actionHandler;},/**\n     * Returns control mouseDown handler\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */getMouseDownHandler:function/* eventData, fabricObject, control */(){return this.mouseDownHandler;},/**\n     * Returns control mouseUp handler\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */getMouseUpHandler:function/* eventData, fabricObject, control */(){return this.mouseUpHandler;},/**\n     * Returns control cursorStyle for css using cursorStyle. If you need a more elaborate\n     * function you can pass one in the constructor\n     * the cursorStyle property\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Control} control the current control ( likely this)\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {String}\n     */cursorStyleHandler:function(eventData,control/* fabricObject */){return control.cursorStyle;},/**\n     * Returns the action name. The basic implementation just return the actionName property.\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Control} control the current control ( likely this)\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {String}\n     */getActionName:function(eventData,control/* fabricObject */){return control.actionName;},/**\n     * Returns controls visibility\n     * @param {fabric.Object} object on which the control is displayed\n     * @param {String} controlKey key where the control is memorized on the\n     * @return {Boolean}\n     */getVisibility:function(fabricObject,controlKey){var objectVisibility=fabricObject._controlsVisibility;if(objectVisibility&&typeof objectVisibility[controlKey]!==\"undefined\"){return objectVisibility[controlKey];}return this.visible;},/**\n     * Sets controls visibility\n     * @param {Boolean} visibility for the object\n     * @return {Void}\n     */setVisibility:function(visibility/* name, fabricObject */){this.visible=visibility;},positionHandler:function(dim,finalMatrix/*, fabricObject, currentControl */){var point=fabric.util.transformPoint({x:this.x*dim.x+this.offsetX,y:this.y*dim.y+this.offsetY},finalMatrix);return point;},/**\n     * Render function for the control.\n     * When this function runs the context is unscaled. unrotate. Just retina scaled.\n     * all the functions will have to translate to the point left,top before starting Drawing\n     * if they want to draw a control where the position is detected.\n     * left and top are the result of the positionHandler function\n     * @param {RenderingContext2D} ctx the context where the control will be drawn\n     * @param {Number} left position of the canvas where we are about to render the control.\n     * @param {Number} top position of the canvas where we are about to render the control.\n     * @param {Object} styleOverride\n     * @param {fabric.Object} fabricObject the object where the control is about to be rendered\n     */render:function(ctx,left,top,styleOverride,fabricObject){styleOverride=styleOverride||{};switch(styleOverride.cornerStyle||fabricObject.cornerStyle){case\"circle\":fabric.controlsUtils.renderCircleControl.call(this,ctx,left,top,styleOverride,fabricObject);break;default:fabric.controlsUtils.renderSquareControl.call(this,ctx,left,top,styleOverride,fabricObject);}}};})(typeof exports!==\"undefined\"?exports:this);(function(){/* _FROM_SVG_START_ */function getColorStop(el,multiplier){var style=el.getAttribute(\"style\"),offset=el.getAttribute(\"offset\")||0,color,colorAlpha,opacity,i;// convert percents to absolute values\noffset=parseFloat(offset)/(/%$/.test(offset)?100:1);offset=offset<0?0:offset>1?1:offset;if(style){var keyValuePairs=style.split(/\\s*;\\s*/);if(keyValuePairs[keyValuePairs.length-1]===\"\"){keyValuePairs.pop();}for(i=keyValuePairs.length;i--;){var split=keyValuePairs[i].split(/\\s*:\\s*/),key=split[0].trim(),value=split[1].trim();if(key===\"stop-color\"){color=value;}else if(key===\"stop-opacity\"){opacity=value;}}}if(!color){color=el.getAttribute(\"stop-color\")||\"rgb(0,0,0)\";}if(!opacity){opacity=el.getAttribute(\"stop-opacity\");}color=new fabric.Color(color);colorAlpha=color.getAlpha();opacity=isNaN(parseFloat(opacity))?1:parseFloat(opacity);opacity*=colorAlpha*multiplier;return{offset:offset,color:color.toRgb(),opacity:opacity};}function getLinearCoords(el){return{x1:el.getAttribute(\"x1\")||0,y1:el.getAttribute(\"y1\")||0,x2:el.getAttribute(\"x2\")||\"100%\",y2:el.getAttribute(\"y2\")||0};}function getRadialCoords(el){return{x1:el.getAttribute(\"fx\")||el.getAttribute(\"cx\")||\"50%\",y1:el.getAttribute(\"fy\")||el.getAttribute(\"cy\")||\"50%\",r1:0,x2:el.getAttribute(\"cx\")||\"50%\",y2:el.getAttribute(\"cy\")||\"50%\",r2:el.getAttribute(\"r\")||\"50%\"};}/* _FROM_SVG_END_ */var clone=fabric.util.object.clone;/**\n   * Gradient class\n   * @class fabric.Gradient\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#gradients}\n   * @see {@link fabric.Gradient#initialize} for constructor definition\n   */fabric.Gradient=fabric.util.createClass(/** @lends fabric.Gradient.prototype */{/**\n       * Horizontal offset for aligning gradients coming from SVG when outside pathgroups\n       * @type Number\n       * @default 0\n       */offsetX:0,/**\n       * Vertical offset for aligning gradients coming from SVG when outside pathgroups\n       * @type Number\n       * @default 0\n       */offsetY:0,/**\n       * A transform matrix to apply to the gradient before painting.\n       * Imported from svg gradients, is not applied with the current transform in the center.\n       * Before this transform is applied, the origin point is at the top left corner of the object\n       * plus the addition of offsetY and offsetX.\n       * @type Number[]\n       * @default null\n       */gradientTransform:null,/**\n       * coordinates units for coords.\n       * If `pixels`, the number of coords are in the same unit of width / height.\n       * If set as `percentage` the coords are still a number, but 1 means 100% of width\n       * for the X and 100% of the height for the y. It can be bigger than 1 and negative.\n       * allowed values pixels or percentage.\n       * @type String\n       * @default 'pixels'\n       */gradientUnits:\"pixels\",/**\n       * Gradient type linear or radial\n       * @type String\n       * @default 'pixels'\n       */type:\"linear\",/**\n       * Constructor\n       * @param {Object} options Options object with type, coords, gradientUnits and colorStops\n       * @param {Object} [options.type] gradient type linear or radial\n       * @param {Object} [options.gradientUnits] gradient units\n       * @param {Object} [options.offsetX] SVG import compatibility\n       * @param {Object} [options.offsetY] SVG import compatibility\n       * @param {Object[]} options.colorStops contains the colorstops.\n       * @param {Object} options.coords contains the coords of the gradient\n       * @param {Number} [options.coords.x1] X coordiante of the first point for linear or of the focal point for radial\n       * @param {Number} [options.coords.y1] Y coordiante of the first point for linear or of the focal point for radial\n       * @param {Number} [options.coords.x2] X coordiante of the second point for linear or of the center point for radial\n       * @param {Number} [options.coords.y2] Y coordiante of the second point for linear or of the center point for radial\n       * @param {Number} [options.coords.r1] only for radial gradient, radius of the inner circle\n       * @param {Number} [options.coords.r2] only for radial gradient, radius of the external circle\n       * @return {fabric.Gradient} thisArg\n       */initialize:function(options){options||(options={});options.coords||(options.coords={});var coords,_this=this;// sets everything, then coords and colorstops get sets again\nObject.keys(options).forEach(function(option){_this[option]=options[option];});if(this.id){this.id+=\"_\"+fabric.Object.__uid++;}else{this.id=fabric.Object.__uid++;}coords={x1:options.coords.x1||0,y1:options.coords.y1||0,x2:options.coords.x2||0,y2:options.coords.y2||0};if(this.type===\"radial\"){coords.r1=options.coords.r1||0;coords.r2=options.coords.r2||0;}this.coords=coords;this.colorStops=options.colorStops.slice();},/**\n       * Adds another colorStop\n       * @param {Object} colorStop Object with offset and color\n       * @return {fabric.Gradient} thisArg\n       */addColorStop:function(colorStops){for(var position in colorStops){var color=new fabric.Color(colorStops[position]);this.colorStops.push({offset:parseFloat(position),color:color.toRgb(),opacity:color.getAlpha()});}return this;},/**\n       * Returns object representation of a gradient\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object}\n       */toObject:function(propertiesToInclude){var object={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};fabric.util.populateWithProperties(this,object,propertiesToInclude);return object;},/* _TO_SVG_START_ */ /**\n       * Returns SVG representation of an gradient\n       * @param {Object} object Object to create a gradient for\n       * @return {String} SVG representation of an gradient (linear/radial)\n       */toSVG:function(object,options){var coords=clone(this.coords,true),i,len,options=options||{},markup,commonAttributes,colorStops=clone(this.colorStops,true),needsSwap=coords.r1>coords.r2,transform=this.gradientTransform?this.gradientTransform.concat():fabric.iMatrix.concat(),offsetX=-this.offsetX,offsetY=-this.offsetY,withViewport=!!options.additionalTransform,gradientUnits=this.gradientUnits===\"pixels\"?\"userSpaceOnUse\":\"objectBoundingBox\";// colorStops must be sorted ascending\ncolorStops.sort(function(a,b){return a.offset-b.offset;});if(gradientUnits===\"objectBoundingBox\"){offsetX/=object.width;offsetY/=object.height;}else{offsetX+=object.width/2;offsetY+=object.height/2;}if(object.type===\"path\"){offsetX-=object.pathOffset.x;offsetY-=object.pathOffset.y;}transform[4]-=offsetX;transform[5]-=offsetY;commonAttributes='id=\"SVGID_'+this.id+'\" gradientUnits=\"'+gradientUnits+'\"';commonAttributes+=' gradientTransform=\"'+(withViewport?options.additionalTransform+\" \":\"\")+fabric.util.matrixToSVG(transform)+'\" ';if(this.type===\"linear\"){markup=[\"<linearGradient \",commonAttributes,' x1=\"',coords.x1,'\" y1=\"',coords.y1,'\" x2=\"',coords.x2,'\" y2=\"',coords.y2,'\">\\n'];}else if(this.type===\"radial\"){// svg radial gradient has just 1 radius. the biggest.\nmarkup=[\"<radialGradient \",commonAttributes,' cx=\"',needsSwap?coords.x1:coords.x2,'\" cy=\"',needsSwap?coords.y1:coords.y2,'\" r=\"',needsSwap?coords.r1:coords.r2,'\" fx=\"',needsSwap?coords.x2:coords.x1,'\" fy=\"',needsSwap?coords.y2:coords.y1,'\">\\n'];}if(this.type===\"radial\"){if(needsSwap){// svg goes from internal to external radius. if radius are inverted, swap color stops.\ncolorStops=colorStops.concat();colorStops.reverse();for(i=0,len=colorStops.length;i<len;i++){colorStops[i].offset=1-colorStops[i].offset;}}var minRadius=Math.min(coords.r1,coords.r2);if(minRadius>0){// i have to shift all colorStops and add new one in 0.\nvar maxRadius=Math.max(coords.r1,coords.r2),percentageShift=minRadius/maxRadius;for(i=0,len=colorStops.length;i<len;i++){colorStops[i].offset+=percentageShift*(1-colorStops[i].offset);}}}for(i=0,len=colorStops.length;i<len;i++){var colorStop=colorStops[i];markup.push(\"<stop \",'offset=\"',colorStop.offset*100+\"%\",'\" style=\"stop-color:',colorStop.color,typeof colorStop.opacity!==\"undefined\"?\";stop-opacity: \"+colorStop.opacity:\";\",'\"/>\\n');}markup.push(this.type===\"linear\"?\"</linearGradient>\\n\":\"</radialGradient>\\n\");return markup.join(\"\");},/* _TO_SVG_END_ */ /**\n       * Returns an instance of CanvasGradient\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @return {CanvasGradient}\n       */toLive:function(ctx){var gradient,coords=fabric.util.object.clone(this.coords),i,len;if(!this.type){return;}if(this.type===\"linear\"){gradient=ctx.createLinearGradient(coords.x1,coords.y1,coords.x2,coords.y2);}else if(this.type===\"radial\"){gradient=ctx.createRadialGradient(coords.x1,coords.y1,coords.r1,coords.x2,coords.y2,coords.r2);}for(i=0,len=this.colorStops.length;i<len;i++){var color=this.colorStops[i].color,opacity=this.colorStops[i].opacity,offset=this.colorStops[i].offset;if(typeof opacity!==\"undefined\"){color=new fabric.Color(color).setAlpha(opacity).toRgba();}gradient.addColorStop(offset,color);}return gradient;}});fabric.util.object.extend(fabric.Gradient,{/* _FROM_SVG_START_ */ /**\n     * Returns {@link fabric.Gradient} instance from an SVG element\n     * @static\n     * @memberOf fabric.Gradient\n     * @param {SVGGradientElement} el SVG gradient element\n     * @param {fabric.Object} instance\n     * @param {String} opacityAttr A fill-opacity or stroke-opacity attribute to multiply to each stop's opacity.\n     * @param {Object} svgOptions an object containing the size of the SVG in order to parse correctly graidents\n     * that uses gradientUnits as 'userSpaceOnUse' and percentages.\n     * @param {Object.number} viewBoxWidth width part of the viewBox attribute on svg\n     * @param {Object.number} viewBoxHeight height part of the viewBox attribute on svg\n     * @param {Object.number} width width part of the svg tag if viewBox is not specified\n     * @param {Object.number} height height part of the svg tag if viewBox is not specified\n     * @return {fabric.Gradient} Gradient instance\n     * @see http://www.w3.org/TR/SVG/pservers.html#LinearGradientElement\n     * @see http://www.w3.org/TR/SVG/pservers.html#RadialGradientElement\n     */fromElement:function(el,instance,opacityAttr,svgOptions){/**\n       *  @example:\n       *\n       *  <linearGradient id=\"linearGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\"/>\n       *    <stop offset=\"100%\" stop-color=\"black\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <linearGradient id=\"linearGrad2\">\n       *    <stop offset=\"0\" style=\"stop-color:rgb(255,255,255)\"/>\n       *    <stop offset=\"1\" style=\"stop-color:rgb(0,0,0)\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *    <stop offset=\"50%\" stop-color=\"black\" stop-opacity=\"0.5\" />\n       *    <stop offset=\"100%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *  </radialGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad2\">\n       *    <stop offset=\"0\" stop-color=\"rgb(255,255,255)\" />\n       *    <stop offset=\"0.5\" stop-color=\"rgb(0,0,0)\" />\n       *    <stop offset=\"1\" stop-color=\"rgb(255,255,255)\" />\n       *  </radialGradient>\n       *\n       */var multiplier=parseFloat(opacityAttr)/(/%$/.test(opacityAttr)?100:1);multiplier=multiplier<0?0:multiplier>1?1:multiplier;if(isNaN(multiplier)){multiplier=1;}var colorStopEls=el.getElementsByTagName(\"stop\"),type,gradientUnits=el.getAttribute(\"gradientUnits\")===\"userSpaceOnUse\"?\"pixels\":\"percentage\",gradientTransform=el.getAttribute(\"gradientTransform\")||\"\",colorStops=[],coords,i,offsetX=0,offsetY=0,transformMatrix;if(el.nodeName===\"linearGradient\"||el.nodeName===\"LINEARGRADIENT\"){type=\"linear\";coords=getLinearCoords(el);}else{type=\"radial\";coords=getRadialCoords(el);}for(i=colorStopEls.length;i--;){colorStops.push(getColorStop(colorStopEls[i],multiplier));}transformMatrix=fabric.parseTransformAttribute(gradientTransform);__convertPercentUnitsToValues(instance,coords,svgOptions,gradientUnits);if(gradientUnits===\"pixels\"){offsetX=-instance.left;offsetY=-instance.top;}var gradient=new fabric.Gradient({id:el.getAttribute(\"id\"),type:type,coords:coords,colorStops:colorStops,gradientUnits:gradientUnits,gradientTransform:transformMatrix,offsetX:offsetX,offsetY:offsetY});return gradient;}/* _FROM_SVG_END_ */});/**\n   * @private\n   */function __convertPercentUnitsToValues(instance,options,svgOptions,gradientUnits){var propValue,finalValue;Object.keys(options).forEach(function(prop){propValue=options[prop];if(propValue===\"Infinity\"){finalValue=1;}else if(propValue===\"-Infinity\"){finalValue=0;}else{finalValue=parseFloat(options[prop],10);if(typeof propValue===\"string\"&&/^(\\d+\\.\\d+)%|(\\d+)%$/.test(propValue)){finalValue*=0.01;if(gradientUnits===\"pixels\"){// then we need to fix those percentages here in svg parsing\nif(prop===\"x1\"||prop===\"x2\"||prop===\"r2\"){finalValue*=svgOptions.viewBoxWidth||svgOptions.width;}if(prop===\"y1\"||prop===\"y2\"){finalValue*=svgOptions.viewBoxHeight||svgOptions.height;}}}}options[prop]=finalValue;});}})();(function(){\"use strict\";var toFixed=fabric.util.toFixed;/**\n   * Pattern class\n   * @class fabric.Pattern\n   * @see {@link http://fabricjs.com/patterns|Pattern demo}\n   * @see {@link http://fabricjs.com/dynamic-patterns|DynamicPattern demo}\n   * @see {@link fabric.Pattern#initialize} for constructor definition\n   */fabric.Pattern=fabric.util.createClass(/** @lends fabric.Pattern.prototype */{/**\n       * Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)\n       * @type String\n       * @default\n       */repeat:\"repeat\",/**\n       * Pattern horizontal offset from object's left/top corner\n       * @type Number\n       * @default\n       */offsetX:0,/**\n       * Pattern vertical offset from object's left/top corner\n       * @type Number\n       * @default\n       */offsetY:0,/**\n       * crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n       * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n       * @type String\n       * @default\n       */crossOrigin:\"\",/**\n       * transform matrix to change the pattern, imported from svgs.\n       * @type Array\n       * @default\n       */patternTransform:null,/**\n       * Constructor\n       * @param {Object} [options] Options object\n       * @param {Function} [callback] function to invoke after callback init.\n       * @return {fabric.Pattern} thisArg\n       */initialize:function(options,callback){options||(options={});this.id=fabric.Object.__uid++;this.setOptions(options);if(!options.source||options.source&&typeof options.source!==\"string\"){callback&&callback(this);return;}else{// img src string\nvar _this=this;this.source=fabric.util.createImage();fabric.util.loadImage(options.source,function(img,isError){_this.source=img;callback&&callback(_this,isError);},null,this.crossOrigin);}},/**\n       * Returns object representation of a pattern\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} Object representation of a pattern instance\n       */toObject:function(propertiesToInclude){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,source,object;// <img> element\nif(typeof this.source.src===\"string\"){source=this.source.src;}// <canvas> element\nelse if(typeof this.source===\"object\"&&this.source.toDataURL){source=this.source.toDataURL();}object={type:\"pattern\",source:source,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:toFixed(this.offsetX,NUM_FRACTION_DIGITS),offsetY:toFixed(this.offsetY,NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?this.patternTransform.concat():null};fabric.util.populateWithProperties(this,object,propertiesToInclude);return object;},/* _TO_SVG_START_ */ /**\n       * Returns SVG representation of a pattern\n       * @param {fabric.Object} object\n       * @return {String} SVG representation of a pattern\n       */toSVG:function(object){var patternSource=typeof this.source===\"function\"?this.source():this.source,patternWidth=patternSource.width/object.width,patternHeight=patternSource.height/object.height,patternOffsetX=this.offsetX/object.width,patternOffsetY=this.offsetY/object.height,patternImgSrc=\"\";if(this.repeat===\"repeat-x\"||this.repeat===\"no-repeat\"){patternHeight=1;if(patternOffsetY){patternHeight+=Math.abs(patternOffsetY);}}if(this.repeat===\"repeat-y\"||this.repeat===\"no-repeat\"){patternWidth=1;if(patternOffsetX){patternWidth+=Math.abs(patternOffsetX);}}if(patternSource.src){patternImgSrc=patternSource.src;}else if(patternSource.toDataURL){patternImgSrc=patternSource.toDataURL();}return'<pattern id=\"SVGID_'+this.id+'\" x=\"'+patternOffsetX+'\" y=\"'+patternOffsetY+'\" width=\"'+patternWidth+'\" height=\"'+patternHeight+'\">\\n'+'<image x=\"0\" y=\"0\"'+' width=\"'+patternSource.width+'\" height=\"'+patternSource.height+'\" xlink:href=\"'+patternImgSrc+'\"></image>\\n'+\"</pattern>\\n\";},/* _TO_SVG_END_ */setOptions:function(options){for(var prop in options){this[prop]=options[prop];}},/**\n       * Returns an instance of CanvasPattern\n       * @param {CanvasRenderingContext2D} ctx Context to create pattern\n       * @return {CanvasPattern}\n       */toLive:function(ctx){var source=this.source;// if the image failed to load, return, and allow rest to continue loading\nif(!source){return\"\";}// if an image\nif(typeof source.src!==\"undefined\"){if(!source.complete){return\"\";}if(source.naturalWidth===0||source.naturalHeight===0){return\"\";}}return ctx.createPattern(source,this.repeat);}});})();(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),toFixed=fabric.util.toFixed;if(fabric.Shadow){fabric.warn(\"fabric.Shadow is already defined.\");return;}/**\n   * Shadow class\n   * @class fabric.Shadow\n   * @see {@link http://fabricjs.com/shadows|Shadow demo}\n   * @see {@link fabric.Shadow#initialize} for constructor definition\n   */fabric.Shadow=fabric.util.createClass(/** @lends fabric.Shadow.prototype */{/**\n       * Shadow color\n       * @type String\n       * @default\n       */color:\"rgb(0,0,0)\",/**\n       * Shadow blur\n       * @type Number\n       */blur:0,/**\n       * Shadow horizontal offset\n       * @type Number\n       * @default\n       */offsetX:0,/**\n       * Shadow vertical offset\n       * @type Number\n       * @default\n       */offsetY:0,/**\n       * Whether the shadow should affect stroke operations\n       * @type Boolean\n       * @default\n       */affectStroke:false,/**\n       * Indicates whether toObject should include default values\n       * @type Boolean\n       * @default\n       */includeDefaultValues:true,/**\n       * When `false`, the shadow will scale with the object.\n       * When `true`, the shadow's offsetX, offsetY, and blur will not be affected by the object's scale.\n       * default to false\n       * @type Boolean\n       * @default\n       */nonScaling:false,/**\n       * Constructor\n       * @param {Object|String} [options] Options object with any of color, blur, offsetX, offsetY properties or string (e.g. \"rgba(0,0,0,0.2) 2px 2px 10px\")\n       * @return {fabric.Shadow} thisArg\n       */initialize:function(options){if(typeof options===\"string\"){options=this._parseShadow(options);}for(var prop in options){this[prop]=options[prop];}this.id=fabric.Object.__uid++;},/**\n       * @private\n       * @param {String} shadow Shadow value to parse\n       * @return {Object} Shadow object with color, offsetX, offsetY and blur\n       */_parseShadow:function(shadow){var shadowStr=shadow.trim(),offsetsAndBlur=fabric.Shadow.reOffsetsAndBlur.exec(shadowStr)||[],color=shadowStr.replace(fabric.Shadow.reOffsetsAndBlur,\"\")||\"rgb(0,0,0)\";return{color:color.trim(),offsetX:parseInt(offsetsAndBlur[1],10)||0,offsetY:parseInt(offsetsAndBlur[2],10)||0,blur:parseInt(offsetsAndBlur[3],10)||0};},/**\n       * Returns a string representation of an instance\n       * @see http://www.w3.org/TR/css-text-decor-3/#text-shadow\n       * @return {String} Returns CSS3 text-shadow declaration\n       */toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join(\"px \");},/* _TO_SVG_START_ */ /**\n       * Returns SVG representation of a shadow\n       * @param {fabric.Object} object\n       * @return {String} SVG representation of a shadow\n       */toSVG:function(object){var fBoxX=40,fBoxY=40,NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,offset=fabric.util.rotateVector({x:this.offsetX,y:this.offsetY},fabric.util.degreesToRadians(-object.angle)),BLUR_BOX=20,color=new fabric.Color(this.color);if(object.width&&object.height){//http://www.w3.org/TR/SVG/filters.html#FilterEffectsRegion\n// we add some extra space to filter box to contain the blur ( 20 )\nfBoxX=toFixed((Math.abs(offset.x)+this.blur)/object.width,NUM_FRACTION_DIGITS)*100+BLUR_BOX;fBoxY=toFixed((Math.abs(offset.y)+this.blur)/object.height,NUM_FRACTION_DIGITS)*100+BLUR_BOX;}if(object.flipX){offset.x*=-1;}if(object.flipY){offset.y*=-1;}return'<filter id=\"SVGID_'+this.id+'\" y=\"-'+fBoxY+'%\" height=\"'+(100+2*fBoxY)+'%\" '+'x=\"-'+fBoxX+'%\" width=\"'+(100+2*fBoxX)+'%\" '+\">\\n\"+'\\t<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"'+toFixed(this.blur?this.blur/2:0,NUM_FRACTION_DIGITS)+'\"></feGaussianBlur>\\n'+'\\t<feOffset dx=\"'+toFixed(offset.x,NUM_FRACTION_DIGITS)+'\" dy=\"'+toFixed(offset.y,NUM_FRACTION_DIGITS)+'\" result=\"oBlur\" ></feOffset>\\n'+'\\t<feFlood flood-color=\"'+color.toRgb()+'\" flood-opacity=\"'+color.getAlpha()+'\"/>\\n'+'\\t<feComposite in2=\"oBlur\" operator=\"in\" />\\n'+\"\\t<feMerge>\\n\"+\"\\t\\t<feMergeNode></feMergeNode>\\n\"+'\\t\\t<feMergeNode in=\"SourceGraphic\"></feMergeNode>\\n'+\"\\t</feMerge>\\n\"+\"</filter>\\n\";},/* _TO_SVG_END_ */ /**\n       * Returns object representation of a shadow\n       * @return {Object} Object representation of a shadow instance\n       */toObject:function(){if(this.includeDefaultValues){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};}var obj={},proto=fabric.Shadow.prototype;[\"color\",\"blur\",\"offsetX\",\"offsetY\",\"affectStroke\",\"nonScaling\"].forEach(function(prop){if(this[prop]!==proto[prop]){obj[prop]=this[prop];}},this);return obj;}});/**\n   * Regex matching shadow offsetX, offsetY and blur (ex: \"2px 2px 10px rgba(0,0,0,0.2)\", \"rgb(0,255,0) 2px 2px\")\n   * @static\n   * @field\n   * @memberOf fabric.Shadow\n   */ // eslint-disable-next-line max-len\nfabric.Shadow.reOffsetsAndBlur=/(?:\\s|^)(-?\\d+(?:px)?(?:\\s?|$))?(-?\\d+(?:px)?(?:\\s?|$))?(\\d+(?:px)?)?(?:\\s?|$)(?:$|\\s)/;})(typeof exports!==\"undefined\"?exports:this);(function(){\"use strict\";if(fabric.StaticCanvas){fabric.warn(\"fabric.StaticCanvas is already defined.\");return;}// aliases for faster resolution\nvar extend=fabric.util.object.extend,getElementOffset=fabric.util.getElementOffset,removeFromArray=fabric.util.removeFromArray,toFixed=fabric.util.toFixed,transformPoint=fabric.util.transformPoint,invertTransform=fabric.util.invertTransform,getNodeCanvas=fabric.util.getNodeCanvas,createCanvasElement=fabric.util.createCanvasElement,CANVAS_INIT_ERROR=new Error(\"Could not initialize `canvas` element\");/**\n   * Static canvas class\n   * @class fabric.StaticCanvas\n   * @mixes fabric.Collection\n   * @mixes fabric.Observable\n   * @see {@link http://fabricjs.com/static_canvas|StaticCanvas demo}\n   * @see {@link fabric.StaticCanvas#initialize} for constructor definition\n   * @fires before:render\n   * @fires after:render\n   * @fires canvas:cleared\n   * @fires object:added\n   * @fires object:removed\n   */fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,/** @lends fabric.StaticCanvas.prototype */{/**\n       * Constructor\n       * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n       * @param {Object} [options] Options object\n       * @return {Object} thisArg\n       */initialize:function(el,options){options||(options={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(el,options);},/**\n       * Background color of canvas instance.\n       * Should be set via {@link fabric.StaticCanvas#setBackgroundColor}.\n       * @type {(String|fabric.Pattern)}\n       * @default\n       */backgroundColor:\"\",/**\n       * Background image of canvas instance.\n       * since 2.4.0 image caching is active, please when putting an image as background, add to the\n       * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n       * vale. As an alternative you can disable image objectCaching\n       * @type fabric.Image\n       * @default\n       */backgroundImage:null,/**\n       * Overlay color of canvas instance.\n       * Should be set via {@link fabric.StaticCanvas#setOverlayColor}\n       * @since 1.3.9\n       * @type {(String|fabric.Pattern)}\n       * @default\n       */overlayColor:\"\",/**\n       * Overlay image of canvas instance.\n       * since 2.4.0 image caching is active, please when putting an image as overlay, add to the\n       * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n       * vale. As an alternative you can disable image objectCaching\n       * @type fabric.Image\n       * @default\n       */overlayImage:null,/**\n       * Indicates whether toObject/toDatalessObject should include default values\n       * if set to false, takes precedence over the object value.\n       * @type Boolean\n       * @default\n       */includeDefaultValues:true,/**\n       * Indicates whether objects' state should be saved\n       * @type Boolean\n       * @default\n       */stateful:false,/**\n       * Indicates whether {@link fabric.Collection.add}, {@link fabric.Collection.insertAt} and {@link fabric.Collection.remove},\n       * {@link fabric.StaticCanvas.moveTo}, {@link fabric.StaticCanvas.clear} and many more, should also re-render canvas.\n       * Disabling this option will not give a performance boost when adding/removing a lot of objects to/from canvas at once\n       * since the renders are quequed and executed one per frame.\n       * Disabling is suggested anyway and managing the renders of the app manually is not a big effort ( canvas.requestRenderAll() )\n       * Left default to true to do not break documentation and old app, fiddles.\n       * @type Boolean\n       * @default\n       */renderOnAddRemove:true,/**\n       * Indicates whether object controls (borders/controls) are rendered above overlay image\n       * @type Boolean\n       * @default\n       */controlsAboveOverlay:false,/**\n       * Indicates whether the browser can be scrolled when using a touchscreen and dragging on the canvas\n       * @type Boolean\n       * @default\n       */allowTouchScrolling:false,/**\n       * Indicates whether this canvas will use image smoothing, this is on by default in browsers\n       * @type Boolean\n       * @default\n       */imageSmoothingEnabled:true,/**\n       * The transformation (in the format of Canvas transform) which focuses the viewport\n       * @type Array\n       * @default\n       */viewportTransform:fabric.iMatrix.concat(),/**\n       * if set to false background image is not affected by viewport transform\n       * @since 1.6.3\n       * @type Boolean\n       * @default\n       */backgroundVpt:true,/**\n       * if set to false overlya image is not affected by viewport transform\n       * @since 1.6.3\n       * @type Boolean\n       * @default\n       */overlayVpt:true,/**\n       * When true, canvas is scaled by devicePixelRatio for better rendering on retina screens\n       * @type Boolean\n       * @default\n       */enableRetinaScaling:true,/**\n       * Describe canvas element extension over design\n       * properties are tl,tr,bl,br.\n       * if canvas is not zoomed/panned those points are the four corner of canvas\n       * if canvas is viewportTransformed you those points indicate the extension\n       * of canvas element in plain untrasformed coordinates\n       * The coordinates get updated with @method calcViewportBoundaries.\n       * @memberOf fabric.StaticCanvas.prototype\n       */vptCoords:{},/**\n       * Based on vptCoords and object.aCoords, skip rendering of objects that\n       * are not included in current viewport.\n       * May greatly help in applications with crowded canvas and use of zoom/pan\n       * If One of the corner of the bounding box of the object is on the canvas\n       * the objects get rendered.\n       * @memberOf fabric.StaticCanvas.prototype\n       * @type Boolean\n       * @default\n       */skipOffscreen:true,/**\n       * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n       * the clipPath object gets used when the canvas has rendered, and the context is placed in the\n       * top left corner of the canvas.\n       * clipPath will clip away controls, if you do not want this to happen use controlsAboveOverlay = true\n       * @type fabric.Object\n       */clipPath:undefined,/**\n       * @private\n       * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n       * @param {Object} [options] Options object\n       */_initStatic:function(el,options){var cb=this.requestRenderAllBound;this._objects=[];this._createLowerCanvas(el);this._initOptions(options);// only initialize retina scaling once\nif(!this.interactive){this._initRetinaScaling();}if(options.overlayImage){this.setOverlayImage(options.overlayImage,cb);}if(options.backgroundImage){this.setBackgroundImage(options.backgroundImage,cb);}if(options.backgroundColor){this.setBackgroundColor(options.backgroundColor,cb);}if(options.overlayColor){this.setOverlayColor(options.overlayColor,cb);}this.calcOffset();},/**\n       * @private\n       */_isRetinaScaling:function(){return fabric.devicePixelRatio!==1&&this.enableRetinaScaling;},/**\n       * @private\n       * @return {Number} retinaScaling if applied, otherwise 1;\n       */getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1;},/**\n       * @private\n       */_initRetinaScaling:function(){if(!this._isRetinaScaling()){return;}var scaleRatio=fabric.devicePixelRatio;this.__initRetinaScaling(scaleRatio,this.lowerCanvasEl,this.contextContainer);if(this.upperCanvasEl){this.__initRetinaScaling(scaleRatio,this.upperCanvasEl,this.contextTop);}},__initRetinaScaling:function(scaleRatio,canvas,context){canvas.setAttribute(\"width\",this.width*scaleRatio);canvas.setAttribute(\"height\",this.height*scaleRatio);context.scale(scaleRatio,scaleRatio);},/**\n       * Calculates canvas element offset relative to the document\n       * This method is also attached as \"resize\" event handler of window\n       * @return {fabric.Canvas} instance\n       * @chainable\n       */calcOffset:function(){this._offset=getElementOffset(this.lowerCanvasEl);return this;},/**\n       * Sets {@link fabric.StaticCanvas#overlayImage|overlay image} for this canvas\n       * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set overlay to\n       * @param {Function} callback callback to invoke when image is loaded and set as an overlay\n       * @param {Object} [options] Optional options to set for the {@link fabric.Image|overlay image}.\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       * @see {@link http://jsfiddle.net/fabricjs/MnzHT/|jsFiddle demo}\n       * @example <caption>Normal overlayImage with left/top = 0</caption>\n       * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n       *   // Needed to position overlayImage at 0/0\n       *   originX: 'left',\n       *   originY: 'top'\n       * });\n       * @example <caption>overlayImage with different properties</caption>\n       * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n       *   opacity: 0.5,\n       *   angle: 45,\n       *   left: 400,\n       *   top: 400,\n       *   originX: 'left',\n       *   originY: 'top'\n       * });\n       * @example <caption>Stretched overlayImage #1 - width/height correspond to canvas width/height</caption>\n       * fabric.Image.fromURL('http://fabricjs.com/assets/jail_cell_bars.png', function(img, isError) {\n       *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n       *    canvas.setOverlayImage(img, canvas.renderAll.bind(canvas));\n       * });\n       * @example <caption>Stretched overlayImage #2 - width/height correspond to canvas width/height</caption>\n       * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n       *   width: canvas.width,\n       *   height: canvas.height,\n       *   // Needed to position overlayImage at 0/0\n       *   originX: 'left',\n       *   originY: 'top'\n       * });\n       * @example <caption>overlayImage loaded from cross-origin</caption>\n       * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n       *   opacity: 0.5,\n       *   angle: 45,\n       *   left: 400,\n       *   top: 400,\n       *   originX: 'left',\n       *   originY: 'top',\n       *   crossOrigin: 'anonymous'\n       * });\n       */setOverlayImage:function(image,callback,options){return this.__setBgOverlayImage(\"overlayImage\",image,callback,options);},/**\n       * Sets {@link fabric.StaticCanvas#backgroundImage|background image} for this canvas\n       * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set background to\n       * @param {Function} callback Callback to invoke when image is loaded and set as background\n       * @param {Object} [options] Optional options to set for the {@link fabric.Image|background image}.\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       * @see {@link http://jsfiddle.net/djnr8o7a/28/|jsFiddle demo}\n       * @example <caption>Normal backgroundImage with left/top = 0</caption>\n       * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n       *   // Needed to position backgroundImage at 0/0\n       *   originX: 'left',\n       *   originY: 'top'\n       * });\n       * @example <caption>backgroundImage with different properties</caption>\n       * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n       *   opacity: 0.5,\n       *   angle: 45,\n       *   left: 400,\n       *   top: 400,\n       *   originX: 'left',\n       *   originY: 'top'\n       * });\n       * @example <caption>Stretched backgroundImage #1 - width/height correspond to canvas width/height</caption>\n       * fabric.Image.fromURL('http://fabricjs.com/assets/honey_im_subtle.png', function(img, isError) {\n       *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n       *    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));\n       * });\n       * @example <caption>Stretched backgroundImage #2 - width/height correspond to canvas width/height</caption>\n       * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n       *   width: canvas.width,\n       *   height: canvas.height,\n       *   // Needed to position backgroundImage at 0/0\n       *   originX: 'left',\n       *   originY: 'top'\n       * });\n       * @example <caption>backgroundImage loaded from cross-origin</caption>\n       * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n       *   opacity: 0.5,\n       *   angle: 45,\n       *   left: 400,\n       *   top: 400,\n       *   originX: 'left',\n       *   originY: 'top',\n       *   crossOrigin: 'anonymous'\n       * });\n       */ // TODO: fix stretched examples\nsetBackgroundImage:function(image,callback,options){return this.__setBgOverlayImage(\"backgroundImage\",image,callback,options);},/**\n       * Sets {@link fabric.StaticCanvas#overlayColor|foreground color} for this canvas\n       * @param {(String|fabric.Pattern)} overlayColor Color or pattern to set foreground color to\n       * @param {Function} callback Callback to invoke when foreground color is set\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       * @see {@link http://jsfiddle.net/fabricjs/pB55h/|jsFiddle demo}\n       * @example <caption>Normal overlayColor - color value</caption>\n       * canvas.setOverlayColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n       * @example <caption>fabric.Pattern used as overlayColor</caption>\n       * canvas.setOverlayColor({\n       *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n       * }, canvas.renderAll.bind(canvas));\n       * @example <caption>fabric.Pattern used as overlayColor with repeat and offset</caption>\n       * canvas.setOverlayColor({\n       *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n       *   repeat: 'repeat',\n       *   offsetX: 200,\n       *   offsetY: 100\n       * }, canvas.renderAll.bind(canvas));\n       */setOverlayColor:function(overlayColor,callback){return this.__setBgOverlayColor(\"overlayColor\",overlayColor,callback);},/**\n       * Sets {@link fabric.StaticCanvas#backgroundColor|background color} for this canvas\n       * @param {(String|fabric.Pattern)} backgroundColor Color or pattern to set background color to\n       * @param {Function} callback Callback to invoke when background color is set\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       * @see {@link http://jsfiddle.net/fabricjs/hXzvk/|jsFiddle demo}\n       * @example <caption>Normal backgroundColor - color value</caption>\n       * canvas.setBackgroundColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n       * @example <caption>fabric.Pattern used as backgroundColor</caption>\n       * canvas.setBackgroundColor({\n       *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n       * }, canvas.renderAll.bind(canvas));\n       * @example <caption>fabric.Pattern used as backgroundColor with repeat and offset</caption>\n       * canvas.setBackgroundColor({\n       *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n       *   repeat: 'repeat',\n       *   offsetX: 200,\n       *   offsetY: 100\n       * }, canvas.renderAll.bind(canvas));\n       */setBackgroundColor:function(backgroundColor,callback){return this.__setBgOverlayColor(\"backgroundColor\",backgroundColor,callback);},/**\n       * @private\n       * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundImage|backgroundImage}\n       * or {@link fabric.StaticCanvas#overlayImage|overlayImage})\n       * @param {(fabric.Image|String|null)} image fabric.Image instance, URL of an image or null to set background or overlay to\n       * @param {Function} callback Callback to invoke when image is loaded and set as background or overlay. The first argument is the created image, the second argument is a flag indicating whether an error occured or not.\n       * @param {Object} [options] Optional options to set for the {@link fabric.Image|image}.\n       */__setBgOverlayImage:function(property,image,callback,options){if(typeof image===\"string\"){fabric.util.loadImage(image,function(img,isError){if(img){var instance=new fabric.Image(img,options);this[property]=instance;instance.canvas=this;}callback&&callback(img,isError);},this,options&&options.crossOrigin);}else{options&&image.setOptions(options);this[property]=image;image&&(image.canvas=this);callback&&callback(image,false);}return this;},/**\n       * @private\n       * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundColor|backgroundColor}\n       * or {@link fabric.StaticCanvas#overlayColor|overlayColor})\n       * @param {(Object|String|null)} color Object with pattern information, color value or null\n       * @param {Function} [callback] Callback is invoked when color is set\n       */__setBgOverlayColor:function(property,color,callback){this[property]=color;this._initGradient(color,property);this._initPattern(color,property,callback);return this;},/**\n       * @private\n       */_createCanvasElement:function(){var element=createCanvasElement();if(!element){throw CANVAS_INIT_ERROR;}if(!element.style){element.style={};}if(typeof element.getContext===\"undefined\"){throw CANVAS_INIT_ERROR;}return element;},/**\n       * @private\n       * @param {Object} [options] Options object\n       */_initOptions:function(options){var lowerCanvasEl=this.lowerCanvasEl;this._setOptions(options);this.width=this.width||parseInt(lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style){return;}lowerCanvasEl.width=this.width;lowerCanvasEl.height=this.height;lowerCanvasEl.style.width=this.width+\"px\";lowerCanvasEl.style.height=this.height+\"px\";this.viewportTransform=this.viewportTransform.slice();},/**\n       * Creates a bottom canvas\n       * @private\n       * @param {HTMLElement} [canvasEl]\n       */_createLowerCanvas:function(canvasEl){// canvasEl === 'HTMLCanvasElement' does not work on jsdom/node\nif(canvasEl&&canvasEl.getContext){this.lowerCanvasEl=canvasEl;}else{this.lowerCanvasEl=fabric.util.getById(canvasEl)||this._createCanvasElement();}fabric.util.addClass(this.lowerCanvasEl,\"lower-canvas\");if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl);}this.contextContainer=this.lowerCanvasEl.getContext(\"2d\");},/**\n       * Returns canvas width (in px)\n       * @return {Number}\n       */getWidth:function(){return this.width;},/**\n       * Returns canvas height (in px)\n       * @return {Number}\n       */getHeight:function(){return this.height;},/**\n       * Sets width of this canvas instance\n       * @param {Number|String} value                         Value to set width to\n       * @param {Object}        [options]                     Options object\n       * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n       * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */setWidth:function(value,options){return this.setDimensions({width:value},options);},/**\n       * Sets height of this canvas instance\n       * @param {Number|String} value                         Value to set height to\n       * @param {Object}        [options]                     Options object\n       * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n       * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */setHeight:function(value,options){return this.setDimensions({height:value},options);},/**\n       * Sets dimensions (width, height) of this canvas instance. when options.cssOnly flag active you should also supply the unit of measure (px/%/em)\n       * @param {Object}        dimensions                    Object with width/height properties\n       * @param {Number|String} [dimensions.width]            Width of canvas element\n       * @param {Number|String} [dimensions.height]           Height of canvas element\n       * @param {Object}        [options]                     Options object\n       * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n       * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */setDimensions:function(dimensions,options){var cssValue;options=options||{};for(var prop in dimensions){cssValue=dimensions[prop];if(!options.cssOnly){this._setBackstoreDimension(prop,dimensions[prop]);cssValue+=\"px\";this.hasLostContext=true;}if(!options.backstoreOnly){this._setCssDimension(prop,cssValue);}}if(this._isCurrentlyDrawing){this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles();}this._initRetinaScaling();this.calcOffset();if(!options.cssOnly){this.requestRenderAll();}return this;},/**\n       * Helper for setting width/height\n       * @private\n       * @param {String} prop property (width|height)\n       * @param {Number} value value to set property to\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */_setBackstoreDimension:function(prop,value){this.lowerCanvasEl[prop]=value;if(this.upperCanvasEl){this.upperCanvasEl[prop]=value;}if(this.cacheCanvasEl){this.cacheCanvasEl[prop]=value;}this[prop]=value;return this;},/**\n       * Helper for setting css width/height\n       * @private\n       * @param {String} prop property (width|height)\n       * @param {String} value value to set property to\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */_setCssDimension:function(prop,value){this.lowerCanvasEl.style[prop]=value;if(this.upperCanvasEl){this.upperCanvasEl.style[prop]=value;}if(this.wrapperEl){this.wrapperEl.style[prop]=value;}return this;},/**\n       * Returns canvas zoom level\n       * @return {Number}\n       */getZoom:function(){return this.viewportTransform[0];},/**\n       * Sets viewport transform of this canvas instance\n       * @param {Array} vpt the transform in the form of context.transform\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */setViewportTransform:function(vpt){var activeObject=this._activeObject,object,i,len;this.viewportTransform=vpt;for(i=0,len=this._objects.length;i<len;i++){object=this._objects[i];object.group||object.setCoords(true);}if(activeObject){activeObject.setCoords();}this.calcViewportBoundaries();this.renderOnAddRemove&&this.requestRenderAll();return this;},/**\n       * Sets zoom level of this canvas instance, zoom centered around point\n       * @param {fabric.Point} point to zoom with respect to\n       * @param {Number} value to set zoom to, less than 1 zooms out\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */zoomToPoint:function(point,value){// TODO: just change the scale, preserve other transformations\nvar before=point,vpt=this.viewportTransform.slice(0);point=transformPoint(point,invertTransform(this.viewportTransform));vpt[0]=value;vpt[3]=value;var after=transformPoint(point,vpt);vpt[4]+=before.x-after.x;vpt[5]+=before.y-after.y;return this.setViewportTransform(vpt);},/**\n       * Sets zoom level of this canvas instance\n       * @param {Number} value to set zoom to, less than 1 zooms out\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */setZoom:function(value){this.zoomToPoint(new fabric.Point(0,0),value);return this;},/**\n       * Pan viewport so as to place point at top left corner of canvas\n       * @param {fabric.Point} point to move to\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */absolutePan:function(point){var vpt=this.viewportTransform.slice(0);vpt[4]=-point.x;vpt[5]=-point.y;return this.setViewportTransform(vpt);},/**\n       * Pans viewpoint relatively\n       * @param {fabric.Point} point (position vector) to move by\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */relativePan:function(point){return this.absolutePan(new fabric.Point(-point.x-this.viewportTransform[4],-point.y-this.viewportTransform[5]));},/**\n       * Returns &lt;canvas> element corresponding to this instance\n       * @return {HTMLCanvasElement}\n       */getElement:function(){return this.lowerCanvasEl;},/**\n       * @private\n       * @param {fabric.Object} obj Object that was added\n       */_onObjectAdded:function(obj){this.stateful&&obj.setupState();obj._set(\"canvas\",this);obj.setCoords();this.fire(\"object:added\",{target:obj});obj.fire(\"added\");},/**\n       * @private\n       * @param {fabric.Object} obj Object that was removed\n       */_onObjectRemoved:function(obj){this.fire(\"object:removed\",{target:obj});obj.fire(\"removed\");delete obj.canvas;},/**\n       * Clears specified context of canvas element\n       * @param {CanvasRenderingContext2D} ctx Context to clear\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */clearContext:function(ctx){ctx.clearRect(0,0,this.width,this.height);return this;},/**\n       * Returns context of canvas where objects are drawn\n       * @return {CanvasRenderingContext2D}\n       */getContext:function(){return this.contextContainer;},/**\n       * Clears all contexts (background, main, top) of an instance\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */clear:function(){this._objects.length=0;this.backgroundImage=null;this.overlayImage=null;this.backgroundColor=\"\";this.overlayColor=\"\";if(this._hasITextHandlers){this.off(\"mouse:up\",this._mouseUpITextHandler);this._iTextInstances=null;this._hasITextHandlers=false;}this.clearContext(this.contextContainer);this.fire(\"canvas:cleared\");this.renderOnAddRemove&&this.requestRenderAll();return this;},/**\n       * Renders the canvas\n       * @return {fabric.Canvas} instance\n       * @chainable\n       */renderAll:function(){var canvasToDrawOn=this.contextContainer;this.renderCanvas(canvasToDrawOn,this._objects);return this;},/**\n       * Function created to be instance bound at initialization\n       * used in requestAnimationFrame rendering\n       * Let the fabricJS call it. If you call it manually you could have more\n       * animationFrame stacking on to of each other\n       * for an imperative rendering, use canvas.renderAll\n       * @private\n       * @return {fabric.Canvas} instance\n       * @chainable\n       */renderAndReset:function(){this.isRendering=0;this.renderAll();},/**\n       * Append a renderAll request to next animation frame.\n       * unless one is already in progress, in that case nothing is done\n       * a boolean flag will avoid appending more.\n       * @return {fabric.Canvas} instance\n       * @chainable\n       */requestRenderAll:function(){if(!this.isRendering){this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound);}return this;},/**\n       * Calculate the position of the 4 corner of canvas with current viewportTransform.\n       * helps to determinate when an object is in the current rendering viewport using\n       * object absolute coordinates ( aCoords )\n       * @return {Object} points.tl\n       * @chainable\n       */calcViewportBoundaries:function(){var points={},width=this.width,height=this.height,iVpt=invertTransform(this.viewportTransform);points.tl=transformPoint({x:0,y:0},iVpt);points.br=transformPoint({x:width,y:height},iVpt);points.tr=new fabric.Point(points.br.x,points.tl.y);points.bl=new fabric.Point(points.tl.x,points.br.y);this.vptCoords=points;return points;},cancelRequestedRender:function(){if(this.isRendering){fabric.util.cancelAnimFrame(this.isRendering);this.isRendering=0;}},/**\n       * Renders background, objects, overlay and controls.\n       * @param {CanvasRenderingContext2D} ctx\n       * @param {Array} objects to render\n       * @return {fabric.Canvas} instance\n       * @chainable\n       */renderCanvas:function(ctx,objects){var v=this.viewportTransform,path=this.clipPath;this.cancelRequestedRender();this.calcViewportBoundaries();this.clearContext(ctx);fabric.util.setImageSmoothing(ctx,this.imageSmoothingEnabled);this.fire(\"before:render\",{ctx:ctx});this._renderBackground(ctx);ctx.save();//apply viewport transform once for all rendering process\nctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);this._renderObjects(ctx,objects);ctx.restore();if(!this.controlsAboveOverlay&&this.interactive){this.drawControls(ctx);}if(path){path.canvas=this;// needed to setup a couple of variables\npath.shouldCache();path._transformDone=true;path.renderCache({forClipping:true});this.drawClipPathOnCanvas(ctx);}this._renderOverlay(ctx);if(this.controlsAboveOverlay&&this.interactive){this.drawControls(ctx);}this.fire(\"after:render\",{ctx:ctx});},/**\n       * Paint the cached clipPath on the lowerCanvasEl\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */drawClipPathOnCanvas:function(ctx){var v=this.viewportTransform,path=this.clipPath;ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);// DEBUG: uncomment this line, comment the following\n// ctx.globalAlpha = 0.4;\nctx.globalCompositeOperation=\"destination-in\";path.transform(ctx);ctx.scale(1/path.zoomX,1/path.zoomY);ctx.drawImage(path._cacheCanvas,-path.cacheTranslationX,-path.cacheTranslationY);ctx.restore();},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {Array} objects to render\n       */_renderObjects:function(ctx,objects){var i,len;for(i=0,len=objects.length;i<len;++i){objects[i]&&objects[i].render(ctx);}},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {string} property 'background' or 'overlay'\n       */_renderBackgroundOrOverlay:function(ctx,property){var fill=this[property+\"Color\"],object=this[property+\"Image\"],v=this.viewportTransform,needsVpt=this[property+\"Vpt\"];if(!fill&&!object){return;}if(fill){ctx.save();ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(this.width,0);ctx.lineTo(this.width,this.height);ctx.lineTo(0,this.height);ctx.closePath();ctx.fillStyle=fill.toLive?fill.toLive(ctx,this):fill;if(needsVpt){ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);}ctx.transform(1,0,0,1,fill.offsetX||0,fill.offsetY||0);var m=fill.gradientTransform||fill.patternTransform;m&&ctx.transform(m[0],m[1],m[2],m[3],m[4],m[5]);ctx.fill();ctx.restore();}if(object){ctx.save();if(needsVpt){ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);}object.render(ctx);ctx.restore();}},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderBackground:function(ctx){this._renderBackgroundOrOverlay(ctx,\"background\");},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderOverlay:function(ctx){this._renderBackgroundOrOverlay(ctx,\"overlay\");},/**\n       * Returns coordinates of a center of canvas.\n       * Returned value is an object with top and left properties\n       * @return {Object} object with \"top\" and \"left\" number values\n       */getCenter:function(){return{top:this.height/2,left:this.width/2};},/**\n       * Centers object horizontally in the canvas\n       * @param {fabric.Object} object Object to center horizontally\n       * @return {fabric.Canvas} thisArg\n       */centerObjectH:function(object){return this._centerObject(object,new fabric.Point(this.getCenter().left,object.getCenterPoint().y));},/**\n       * Centers object vertically in the canvas\n       * @param {fabric.Object} object Object to center vertically\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */centerObjectV:function(object){return this._centerObject(object,new fabric.Point(object.getCenterPoint().x,this.getCenter().top));},/**\n       * Centers object vertically and horizontally in the canvas\n       * @param {fabric.Object} object Object to center vertically and horizontally\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */centerObject:function(object){var center=this.getCenter();return this._centerObject(object,new fabric.Point(center.left,center.top));},/**\n       * Centers object vertically and horizontally in the viewport\n       * @param {fabric.Object} object Object to center vertically and horizontally\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */viewportCenterObject:function(object){var vpCenter=this.getVpCenter();return this._centerObject(object,vpCenter);},/**\n       * Centers object horizontally in the viewport, object.top is unchanged\n       * @param {fabric.Object} object Object to center vertically and horizontally\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */viewportCenterObjectH:function(object){var vpCenter=this.getVpCenter();this._centerObject(object,new fabric.Point(vpCenter.x,object.getCenterPoint().y));return this;},/**\n       * Centers object Vertically in the viewport, object.top is unchanged\n       * @param {fabric.Object} object Object to center vertically and horizontally\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */viewportCenterObjectV:function(object){var vpCenter=this.getVpCenter();return this._centerObject(object,new fabric.Point(object.getCenterPoint().x,vpCenter.y));},/**\n       * Calculate the point in canvas that correspond to the center of actual viewport.\n       * @return {fabric.Point} vpCenter, viewport center\n       * @chainable\n       */getVpCenter:function(){var center=this.getCenter(),iVpt=invertTransform(this.viewportTransform);return transformPoint({x:center.left,y:center.top},iVpt);},/**\n       * @private\n       * @param {fabric.Object} object Object to center\n       * @param {fabric.Point} center Center point\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */_centerObject:function(object,center){object.setPositionByOrigin(center,\"center\",\"center\");object.setCoords();this.renderOnAddRemove&&this.requestRenderAll();return this;},/**\n       * Returs dataless JSON representation of canvas\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {String} json string\n       */toDatalessJSON:function(propertiesToInclude){return this.toDatalessObject(propertiesToInclude);},/**\n       * Returns object representation of canvas\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */toObject:function(propertiesToInclude){return this._toObjectMethod(\"toObject\",propertiesToInclude);},/**\n       * Returns dataless object representation of canvas\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */toDatalessObject:function(propertiesToInclude){return this._toObjectMethod(\"toDatalessObject\",propertiesToInclude);},/**\n       * @private\n       */_toObjectMethod:function(methodName,propertiesToInclude){var clipPath=this.clipPath,data={version:fabric.version,objects:this._toObjects(methodName,propertiesToInclude)};if(clipPath){data.clipPath=this._toObject(this.clipPath,methodName,propertiesToInclude);}extend(data,this.__serializeBgOverlay(methodName,propertiesToInclude));fabric.util.populateWithProperties(this,data,propertiesToInclude);return data;},/**\n       * @private\n       */_toObjects:function(methodName,propertiesToInclude){return this._objects.filter(function(object){return!object.excludeFromExport;}).map(function(instance){return this._toObject(instance,methodName,propertiesToInclude);},this);},/**\n       * @private\n       */_toObject:function(instance,methodName,propertiesToInclude){var originalValue;if(!this.includeDefaultValues){originalValue=instance.includeDefaultValues;instance.includeDefaultValues=false;}var object=instance[methodName](propertiesToInclude);if(!this.includeDefaultValues){instance.includeDefaultValues=originalValue;}return object;},/**\n       * @private\n       */__serializeBgOverlay:function(methodName,propertiesToInclude){var data={},bgImage=this.backgroundImage,overlay=this.overlayImage;if(this.backgroundColor){data.background=this.backgroundColor.toObject?this.backgroundColor.toObject(propertiesToInclude):this.backgroundColor;}if(this.overlayColor){data.overlay=this.overlayColor.toObject?this.overlayColor.toObject(propertiesToInclude):this.overlayColor;}if(bgImage&&!bgImage.excludeFromExport){data.backgroundImage=this._toObject(bgImage,methodName,propertiesToInclude);}if(overlay&&!overlay.excludeFromExport){data.overlayImage=this._toObject(overlay,methodName,propertiesToInclude);}return data;},/* _TO_SVG_START_ */ /**\n       * When true, getSvgTransform() will apply the StaticCanvas.viewportTransform to the SVG transformation. When true,\n       * a zoomed canvas will then produce zoomed SVG output.\n       * @type Boolean\n       * @default\n       */svgViewportTransformation:true,/**\n       * Returns SVG representation of canvas\n       * @function\n       * @param {Object} [options] Options object for SVG output\n       * @param {Boolean} [options.suppressPreamble=false] If true xml tag is not included\n       * @param {Object} [options.viewBox] SVG viewbox object\n       * @param {Number} [options.viewBox.x] x-cooridnate of viewbox\n       * @param {Number} [options.viewBox.y] y-coordinate of viewbox\n       * @param {Number} [options.viewBox.width] Width of viewbox\n       * @param {Number} [options.viewBox.height] Height of viewbox\n       * @param {String} [options.encoding=UTF-8] Encoding of SVG output\n       * @param {String} [options.width] desired width of svg with or without units\n       * @param {String} [options.height] desired height of svg with or without units\n       * @param {Function} [reviver] Method for further parsing of svg elements, called after each fabric object converted into svg representation.\n       * @return {String} SVG string\n       * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n       * @see {@link http://jsfiddle.net/fabricjs/jQ3ZZ/|jsFiddle demo}\n       * @example <caption>Normal SVG output</caption>\n       * var svg = canvas.toSVG();\n       * @example <caption>SVG output without preamble (without &lt;?xml ../>)</caption>\n       * var svg = canvas.toSVG({suppressPreamble: true});\n       * @example <caption>SVG output with viewBox attribute</caption>\n       * var svg = canvas.toSVG({\n       *   viewBox: {\n       *     x: 100,\n       *     y: 100,\n       *     width: 200,\n       *     height: 300\n       *   }\n       * });\n       * @example <caption>SVG output with different encoding (default: UTF-8)</caption>\n       * var svg = canvas.toSVG({encoding: 'ISO-8859-1'});\n       * @example <caption>Modify SVG output with reviver function</caption>\n       * var svg = canvas.toSVG(null, function(svg) {\n       *   return svg.replace('stroke-dasharray: ; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; ', '');\n       * });\n       */toSVG:function(options,reviver){options||(options={});options.reviver=reviver;var markup=[];this._setSVGPreamble(markup,options);this._setSVGHeader(markup,options);if(this.clipPath){markup.push('<g clip-path=\"url(#'+this.clipPath.clipPathId+')\" >\\n');}this._setSVGBgOverlayColor(markup,\"background\");this._setSVGBgOverlayImage(markup,\"backgroundImage\",reviver);this._setSVGObjects(markup,reviver);if(this.clipPath){markup.push(\"</g>\\n\");}this._setSVGBgOverlayColor(markup,\"overlay\");this._setSVGBgOverlayImage(markup,\"overlayImage\",reviver);markup.push(\"</svg>\");return markup.join(\"\");},/**\n       * @private\n       */_setSVGPreamble:function(markup,options){if(options.suppressPreamble){return;}markup.push('<?xml version=\"1.0\" encoding=\"',options.encoding||\"UTF-8\",'\" standalone=\"no\" ?>\\n','<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" ','\"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n');},/**\n       * @private\n       */_setSVGHeader:function(markup,options){var width=options.width||this.width,height=options.height||this.height,vpt,viewBox='viewBox=\"0 0 '+this.width+\" \"+this.height+'\" ',NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;if(options.viewBox){viewBox='viewBox=\"'+options.viewBox.x+\" \"+options.viewBox.y+\" \"+options.viewBox.width+\" \"+options.viewBox.height+'\" ';}else{if(this.svgViewportTransformation){vpt=this.viewportTransform;viewBox='viewBox=\"'+toFixed(-vpt[4]/vpt[0],NUM_FRACTION_DIGITS)+\" \"+toFixed(-vpt[5]/vpt[3],NUM_FRACTION_DIGITS)+\" \"+toFixed(this.width/vpt[0],NUM_FRACTION_DIGITS)+\" \"+toFixed(this.height/vpt[3],NUM_FRACTION_DIGITS)+'\" ';}}markup.push(\"<svg \",'xmlns=\"http://www.w3.org/2000/svg\" ','xmlns:xlink=\"http://www.w3.org/1999/xlink\" ','version=\"1.1\" ','width=\"',width,'\" ','height=\"',height,'\" ',viewBox,'xml:space=\"preserve\">\\n',\"<desc>Created with Fabric.js \",fabric.version,\"</desc>\\n\",\"<defs>\\n\",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(options),\"</defs>\\n\");},createSVGClipPathMarkup:function(options){var clipPath=this.clipPath;if(clipPath){clipPath.clipPathId=\"CLIPPATH_\"+fabric.Object.__uid++;return'<clipPath id=\"'+clipPath.clipPathId+'\" >\\n'+this.clipPath.toClipPathSVG(options.reviver)+\"</clipPath>\\n\";}return\"\";},/**\n       * Creates markup containing SVG referenced elements like patterns, gradients etc.\n       * @return {String}\n       */createSVGRefElementsMarkup:function(){var _this=this,markup=[\"background\",\"overlay\"].map(function(prop){var fill=_this[prop+\"Color\"];if(fill&&fill.toLive){var shouldTransform=_this[prop+\"Vpt\"],vpt=_this.viewportTransform,object={width:_this.width/(shouldTransform?vpt[0]:1),height:_this.height/(shouldTransform?vpt[3]:1)};return fill.toSVG(object,{additionalTransform:shouldTransform?fabric.util.matrixToSVG(vpt):\"\"});}});return markup.join(\"\");},/**\n       * Creates markup containing SVG font faces,\n       * font URLs for font faces must be collected by developers\n       * and are not extracted from the DOM by fabricjs\n       * @param {Array} objects Array of fabric objects\n       * @return {String}\n       */createSVGFontFacesMarkup:function(){var markup=\"\",fontList={},obj,fontFamily,style,row,rowIndex,_char,charIndex,i,len,fontPaths=fabric.fontPaths,objects=[];this._objects.forEach(function add(object){objects.push(object);if(object._objects){object._objects.forEach(add);}});for(i=0,len=objects.length;i<len;i++){obj=objects[i];fontFamily=obj.fontFamily;if(obj.type.indexOf(\"text\")===-1||fontList[fontFamily]||!fontPaths[fontFamily]){continue;}fontList[fontFamily]=true;if(!obj.styles){continue;}style=obj.styles;for(rowIndex in style){row=style[rowIndex];for(charIndex in row){_char=row[charIndex];fontFamily=_char.fontFamily;if(!fontList[fontFamily]&&fontPaths[fontFamily]){fontList[fontFamily]=true;}}}}for(var j in fontList){markup+=[\"\\t\\t@font-face {\\n\",\"\\t\\t\\tfont-family: '\",j,\"';\\n\",\"\\t\\t\\tsrc: url('\",fontPaths[j],\"');\\n\",\"\\t\\t}\\n\"].join(\"\");}if(markup){markup=['\\t<style type=\"text/css\">',\"<![CDATA[\\n\",markup,\"]]>\",\"</style>\\n\"].join(\"\");}return markup;},/**\n       * @private\n       */_setSVGObjects:function(markup,reviver){var instance,i,len,objects=this._objects;for(i=0,len=objects.length;i<len;i++){instance=objects[i];if(instance.excludeFromExport){continue;}this._setSVGObject(markup,instance,reviver);}},/**\n       * @private\n       */_setSVGObject:function(markup,instance,reviver){markup.push(instance.toSVG(reviver));},/**\n       * @private\n       */_setSVGBgOverlayImage:function(markup,property,reviver){if(this[property]&&!this[property].excludeFromExport&&this[property].toSVG){markup.push(this[property].toSVG(reviver));}},/**\n       * @private\n       */_setSVGBgOverlayColor:function(markup,property){var filler=this[property+\"Color\"],vpt=this.viewportTransform,finalWidth=this.width,finalHeight=this.height;if(!filler){return;}if(filler.toLive){var repeat=filler.repeat,iVpt=fabric.util.invertTransform(vpt),shouldInvert=this[property+\"Vpt\"],additionalTransform=shouldInvert?fabric.util.matrixToSVG(iVpt):\"\";markup.push('<rect transform=\"'+additionalTransform+\" translate(\",finalWidth/2,\",\",finalHeight/2,')\"',' x=\"',filler.offsetX-finalWidth/2,'\" y=\"',filler.offsetY-finalHeight/2,'\" ','width=\"',repeat===\"repeat-y\"||repeat===\"no-repeat\"?filler.source.width:finalWidth,'\" height=\"',repeat===\"repeat-x\"||repeat===\"no-repeat\"?filler.source.height:finalHeight,'\" fill=\"url(#SVGID_'+filler.id+')\"',\"></rect>\\n\");}else{markup.push('<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" ','fill=\"',filler,'\"',\"></rect>\\n\");}},/* _TO_SVG_END_ */ /**\n       * Moves an object or the objects of a multiple selection\n       * to the bottom of the stack of drawn objects\n       * @param {fabric.Object} object Object to send to back\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */sendToBack:function(object){if(!object){return this;}var activeSelection=this._activeObject,i,obj,objs;if(object===activeSelection&&object.type===\"activeSelection\"){objs=activeSelection._objects;for(i=objs.length;i--;){obj=objs[i];removeFromArray(this._objects,obj);this._objects.unshift(obj);}}else{removeFromArray(this._objects,object);this._objects.unshift(object);}this.renderOnAddRemove&&this.requestRenderAll();return this;},/**\n       * Moves an object or the objects of a multiple selection\n       * to the top of the stack of drawn objects\n       * @param {fabric.Object} object Object to send\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */bringToFront:function(object){if(!object){return this;}var activeSelection=this._activeObject,i,obj,objs;if(object===activeSelection&&object.type===\"activeSelection\"){objs=activeSelection._objects;for(i=0;i<objs.length;i++){obj=objs[i];removeFromArray(this._objects,obj);this._objects.push(obj);}}else{removeFromArray(this._objects,object);this._objects.push(object);}this.renderOnAddRemove&&this.requestRenderAll();return this;},/**\n       * Moves an object or a selection down in stack of drawn objects\n       * An optional paramter, intersecting allowes to move the object in behind\n       * the first intersecting object. Where intersection is calculated with\n       * bounding box. If no intersection is found, there will not be change in the\n       * stack.\n       * @param {fabric.Object} object Object to send\n       * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */sendBackwards:function(object,intersecting){if(!object){return this;}var activeSelection=this._activeObject,i,obj,idx,newIdx,objs,objsMoved=0;if(object===activeSelection&&object.type===\"activeSelection\"){objs=activeSelection._objects;for(i=0;i<objs.length;i++){obj=objs[i];idx=this._objects.indexOf(obj);if(idx>0+objsMoved){newIdx=idx-1;removeFromArray(this._objects,obj);this._objects.splice(newIdx,0,obj);}objsMoved++;}}else{idx=this._objects.indexOf(object);if(idx!==0){// if object is not on the bottom of stack\nnewIdx=this._findNewLowerIndex(object,idx,intersecting);removeFromArray(this._objects,object);this._objects.splice(newIdx,0,object);}}this.renderOnAddRemove&&this.requestRenderAll();return this;},/**\n       * @private\n       */_findNewLowerIndex:function(object,idx,intersecting){var newIdx,i;if(intersecting){newIdx=idx;// traverse down the stack looking for the nearest intersecting object\nfor(i=idx-1;i>=0;--i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break;}}}else{newIdx=idx-1;}return newIdx;},/**\n       * Moves an object or a selection up in stack of drawn objects\n       * An optional paramter, intersecting allowes to move the object in front\n       * of the first intersecting object. Where intersection is calculated with\n       * bounding box. If no intersection is found, there will not be change in the\n       * stack.\n       * @param {fabric.Object} object Object to send\n       * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */bringForward:function(object,intersecting){if(!object){return this;}var activeSelection=this._activeObject,i,obj,idx,newIdx,objs,objsMoved=0;if(object===activeSelection&&object.type===\"activeSelection\"){objs=activeSelection._objects;for(i=objs.length;i--;){obj=objs[i];idx=this._objects.indexOf(obj);if(idx<this._objects.length-1-objsMoved){newIdx=idx+1;removeFromArray(this._objects,obj);this._objects.splice(newIdx,0,obj);}objsMoved++;}}else{idx=this._objects.indexOf(object);if(idx!==this._objects.length-1){// if object is not on top of stack (last item in an array)\nnewIdx=this._findNewUpperIndex(object,idx,intersecting);removeFromArray(this._objects,object);this._objects.splice(newIdx,0,object);}}this.renderOnAddRemove&&this.requestRenderAll();return this;},/**\n       * @private\n       */_findNewUpperIndex:function(object,idx,intersecting){var newIdx,i,len;if(intersecting){newIdx=idx;// traverse up the stack looking for the nearest intersecting object\nfor(i=idx+1,len=this._objects.length;i<len;++i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break;}}}else{newIdx=idx+1;}return newIdx;},/**\n       * Moves an object to specified level in stack of drawn objects\n       * @param {fabric.Object} object Object to send\n       * @param {Number} index Position to move to\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */moveTo:function(object,index){removeFromArray(this._objects,object);this._objects.splice(index,0,object);return this.renderOnAddRemove&&this.requestRenderAll();},/**\n       * Clears a canvas element and dispose objects\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */dispose:function(){// cancel eventually ongoing renders\nif(this.isRendering){fabric.util.cancelAnimFrame(this.isRendering);this.isRendering=0;}this.forEachObject(function(object){object.dispose&&object.dispose();});this._objects=[];if(this.backgroundImage&&this.backgroundImage.dispose){this.backgroundImage.dispose();}this.backgroundImage=null;if(this.overlayImage&&this.overlayImage.dispose){this.overlayImage.dispose();}this.overlayImage=null;this._iTextInstances=null;this.contextContainer=null;fabric.util.cleanUpJsdomNode(this.lowerCanvasEl);this.lowerCanvasEl=undefined;return this;},/**\n       * Returns a string representation of an instance\n       * @return {String} string representation of an instance\n       */toString:function(){return\"#<fabric.Canvas (\"+this.complexity()+\"): \"+\"{ objects: \"+this._objects.length+\" }>\";}});extend(fabric.StaticCanvas.prototype,fabric.Observable);extend(fabric.StaticCanvas.prototype,fabric.Collection);extend(fabric.StaticCanvas.prototype,fabric.DataURLExporter);extend(fabric.StaticCanvas,/** @lends fabric.StaticCanvas */{/**\n       * @static\n       * @type String\n       * @default\n       */EMPTY_JSON:'{\"objects\": [], \"background\": \"white\"}',/**\n       * Provides a way to check support of some of the canvas methods\n       * (either those of HTMLCanvasElement itself, or rendering context)\n       *\n       * @param {String} methodName Method to check support for;\n       *                            Could be one of \"setLineDash\"\n       * @return {Boolean | null} `true` if method is supported (or at least exists),\n       *                          `null` if canvas element or context can not be initialized\n       */supports:function(methodName){var el=createCanvasElement();if(!el||!el.getContext){return null;}var ctx=el.getContext(\"2d\");if(!ctx){return null;}switch(methodName){case\"setLineDash\":return typeof ctx.setLineDash!==\"undefined\";default:return null;}}});/**\n   * Returns JSON representation of canvas\n   * @function\n   * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n   * @return {String} JSON string\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n   * @see {@link http://jsfiddle.net/fabricjs/pec86/|jsFiddle demo}\n   * @example <caption>JSON without additional properties</caption>\n   * var json = canvas.toJSON();\n   * @example <caption>JSON with additional properties included</caption>\n   * var json = canvas.toJSON(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY']);\n   * @example <caption>JSON without default values</caption>\n   * canvas.includeDefaultValues = false;\n   * var json = canvas.toJSON();\n   */fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject;if(fabric.isLikelyNode){fabric.StaticCanvas.prototype.createPNGStream=function(){var impl=getNodeCanvas(this.lowerCanvasEl);return impl&&impl.createPNGStream();};fabric.StaticCanvas.prototype.createJPEGStream=function(opts){var impl=getNodeCanvas(this.lowerCanvasEl);return impl&&impl.createJPEGStream(opts);};}})();/**\n * BaseBrush class\n * @class fabric.BaseBrush\n * @see {@link http://fabricjs.com/freedrawing|Freedrawing demo}\n */fabric.BaseBrush=fabric.util.createClass(/** @lends fabric.BaseBrush.prototype */{/**\n     * Color of a brush\n     * @type String\n     * @default\n     */color:\"rgb(0, 0, 0)\",/**\n     * Width of a brush, has to be a Number, no string literals\n     * @type Number\n     * @default\n     */width:1,/**\n     * Shadow object representing shadow of this shape.\n     * <b>Backwards incompatibility note:</b> This property replaces \"shadowColor\" (String), \"shadowOffsetX\" (Number),\n     * \"shadowOffsetY\" (Number) and \"shadowBlur\" (Number) since v1.2.12\n     * @type fabric.Shadow\n     * @default\n     */shadow:null,/**\n     * Line endings style of a brush (one of \"butt\", \"round\", \"square\")\n     * @type String\n     * @default\n     */strokeLineCap:\"round\",/**\n     * Corner style of a brush (one of \"bevel\", \"round\", \"miter\")\n     * @type String\n     * @default\n     */strokeLineJoin:\"round\",/**\n     * Maximum miter length (used for strokeLineJoin = \"miter\") of a brush's\n     * @type Number\n     * @default\n     */strokeMiterLimit:10,/**\n     * Stroke Dash Array.\n     * @type Array\n     * @default\n     */strokeDashArray:null,/**\n     * Sets brush styles\n     * @private\n     */_setBrushStyles:function(){var ctx=this.canvas.contextTop;ctx.strokeStyle=this.color;ctx.lineWidth=this.width;ctx.lineCap=this.strokeLineCap;ctx.miterLimit=this.strokeMiterLimit;ctx.lineJoin=this.strokeLineJoin;if(fabric.StaticCanvas.supports(\"setLineDash\")){ctx.setLineDash(this.strokeDashArray||[]);}},/**\n     * Sets the transformation on given context\n     * @param {RenderingContext2d} ctx context to render on\n     * @private\n     */_saveAndTransform:function(ctx){var v=this.canvas.viewportTransform;ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);},/**\n     * Sets brush shadow styles\n     * @private\n     */_setShadow:function(){if(!this.shadow){return;}var canvas=this.canvas,shadow=this.shadow,ctx=canvas.contextTop,zoom=canvas.getZoom();if(canvas&&canvas._isRetinaScaling()){zoom*=fabric.devicePixelRatio;}ctx.shadowColor=shadow.color;ctx.shadowBlur=shadow.blur*zoom;ctx.shadowOffsetX=shadow.offsetX*zoom;ctx.shadowOffsetY=shadow.offsetY*zoom;},needsFullRender:function(){var color=new fabric.Color(this.color);return color.getAlpha()<1||!!this.shadow;},/**\n     * Removes brush shadow styles\n     * @private\n     */_resetShadow:function(){var ctx=this.canvas.contextTop;ctx.shadowColor=\"\";ctx.shadowBlur=ctx.shadowOffsetX=ctx.shadowOffsetY=0;}});(function(){/**\n   * PencilBrush class\n   * @class fabric.PencilBrush\n   * @extends fabric.BaseBrush\n   */fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,/** @lends fabric.PencilBrush.prototype */{/**\n       * Discard points that are less than `decimate` pixel distant from each other\n       * @type Number\n       * @default 0.4\n       */decimate:0.4,/**\n       * Constructor\n       * @param {fabric.Canvas} canvas\n       * @return {fabric.PencilBrush} Instance of a pencil brush\n       */initialize:function(canvas){this.canvas=canvas;this._points=[];},/**\n       * Invoked inside on mouse down and mouse move\n       * @param {Object} pointer\n       */_drawSegment:function(ctx,p1,p2){var midPoint=p1.midPointFrom(p2);ctx.quadraticCurveTo(p1.x,p1.y,midPoint.x,midPoint.y);return midPoint;},/**\n       * Invoked on mouse down\n       * @param {Object} pointer\n       */onMouseDown:function(pointer,options){if(!this.canvas._isMainEvent(options.e)){return;}this._prepareForDrawing(pointer);// capture coordinates immediately\n// this allows to draw dots (when movement never occurs)\nthis._captureDrawingPath(pointer);this._render();},/**\n       * Invoked on mouse move\n       * @param {Object} pointer\n       */onMouseMove:function(pointer,options){if(!this.canvas._isMainEvent(options.e)){return;}if(this._captureDrawingPath(pointer)&&this._points.length>1){if(this.needsFullRender()){// redraw curve\n// clear top canvas\nthis.canvas.clearContext(this.canvas.contextTop);this._render();}else{var points=this._points,length=points.length,ctx=this.canvas.contextTop;// draw the curve update\nthis._saveAndTransform(ctx);if(this.oldEnd){ctx.beginPath();ctx.moveTo(this.oldEnd.x,this.oldEnd.y);}this.oldEnd=this._drawSegment(ctx,points[length-2],points[length-1],true);ctx.stroke();ctx.restore();}}},/**\n       * Invoked on mouse up\n       */onMouseUp:function(options){if(!this.canvas._isMainEvent(options.e)){return true;}this.oldEnd=undefined;this._finalizeAndAddPath();return false;},/**\n       * @private\n       * @param {Object} pointer Actual mouse position related to the canvas.\n       */_prepareForDrawing:function(pointer){var p=new fabric.Point(pointer.x,pointer.y);this._reset();this._addPoint(p);this.canvas.contextTop.moveTo(p.x,p.y);},/**\n       * @private\n       * @param {fabric.Point} point Point to be added to points array\n       */_addPoint:function(point){if(this._points.length>1&&point.eq(this._points[this._points.length-1])){return false;}this._points.push(point);return true;},/**\n       * Clear points array and set contextTop canvas style.\n       * @private\n       */_reset:function(){this._points=[];this._setBrushStyles();this._setShadow();},/**\n       * @private\n       * @param {Object} pointer Actual mouse position related to the canvas.\n       */_captureDrawingPath:function(pointer){var pointerPoint=new fabric.Point(pointer.x,pointer.y);return this._addPoint(pointerPoint);},/**\n       * Draw a smooth path on the topCanvas using quadraticCurveTo\n       * @private\n       */_render:function(){var ctx=this.canvas.contextTop,i,len,p1=this._points[0],p2=this._points[1];this._saveAndTransform(ctx);ctx.beginPath();//if we only have 2 points in the path and they are the same\n//it means that the user only clicked the canvas without moving the mouse\n//then we should be drawing a dot. A path isn't drawn between two identical dots\n//that's why we set them apart a bit\nif(this._points.length===2&&p1.x===p2.x&&p1.y===p2.y){var width=this.width/1000;p1=new fabric.Point(p1.x,p1.y);p2=new fabric.Point(p2.x,p2.y);p1.x-=width;p2.x+=width;}ctx.moveTo(p1.x,p1.y);for(i=1,len=this._points.length;i<len;i++){// we pick the point between pi + 1 & pi + 2 as the\n// end point and p1 as our control point.\nthis._drawSegment(ctx,p1,p2);p1=this._points[i];p2=this._points[i+1];}// Draw last line as a straight line while\n// we wait for the next point to be able to calculate\n// the bezier control point\nctx.lineTo(p1.x,p1.y);ctx.stroke();ctx.restore();},/**\n       * Converts points to SVG path\n       * @param {Array} points Array of points\n       * @return {String} SVG path\n       */convertPointsToSVGPath:function(points){var path=[],i,width=this.width/1000,p1=new fabric.Point(points[0].x,points[0].y),p2=new fabric.Point(points[1].x,points[1].y),len=points.length,multSignX=1,multSignY=0,manyPoints=len>2;if(manyPoints){multSignX=points[2].x<p2.x?-1:points[2].x===p2.x?0:1;multSignY=points[2].y<p2.y?-1:points[2].y===p2.y?0:1;}path.push(\"M \",p1.x-multSignX*width,\" \",p1.y-multSignY*width,\" \");for(i=1;i<len;i++){if(!p1.eq(p2)){var midPoint=p1.midPointFrom(p2);// p1 is our bezier control point\n// midpoint is our endpoint\n// start point is p(i-1) value.\npath.push(\"Q \",p1.x,\" \",p1.y,\" \",midPoint.x,\" \",midPoint.y,\" \");}p1=points[i];if(i+1<points.length){p2=points[i+1];}}if(manyPoints){multSignX=p1.x>points[i-2].x?1:p1.x===points[i-2].x?0:-1;multSignY=p1.y>points[i-2].y?1:p1.y===points[i-2].y?0:-1;}path.push(\"L \",p1.x+multSignX*width,\" \",p1.y+multSignY*width);return path;},/**\n       * Creates fabric.Path object to add on canvas\n       * @param {String} pathData Path data\n       * @return {fabric.Path} Path to add on canvas\n       */createPath:function(pathData){var path=new fabric.Path(pathData,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});if(this.shadow){this.shadow.affectStroke=true;path.shadow=new fabric.Shadow(this.shadow);}return path;},/**\n       * Decimate poins array with the decimate value\n       */decimatePoints:function(points,distance){if(points.length<=2){return points;}var zoom=this.canvas.getZoom(),adjustedDistance=Math.pow(distance/zoom,2),i,l=points.length-1,lastPoint=points[0],newPoints=[lastPoint],cDistance;for(i=1;i<l;i++){cDistance=Math.pow(lastPoint.x-points[i].x,2)+Math.pow(lastPoint.y-points[i].y,2);if(cDistance>=adjustedDistance){lastPoint=points[i];newPoints.push(lastPoint);}}if(newPoints.length===1){newPoints.push(new fabric.Point(newPoints[0].x,newPoints[0].y));}return newPoints;},/**\n       * On mouseup after drawing the path on contextTop canvas\n       * we use the points captured to create an new fabric path object\n       * and add it to the fabric canvas.\n       */_finalizeAndAddPath:function(){var ctx=this.canvas.contextTop;ctx.closePath();if(this.decimate){this._points=this.decimatePoints(this._points,this.decimate);}var pathData=this.convertPointsToSVGPath(this._points).join(\"\");if(pathData===\"M 0 0 Q 0 0 0 0 L 0 0\"){// do not create 0 width/height paths, as they are\n// rendered inconsistently across browsers\n// Firefox 4, for example, renders a dot,\n// whereas Chrome 10 renders nothing\nthis.canvas.requestRenderAll();return;}var path=this.createPath(pathData);this.canvas.clearContext(this.canvas.contextTop);this.canvas.add(path);this.canvas.requestRenderAll();path.setCoords();this._resetShadow();// fire event 'path' created\nthis.canvas.fire(\"path:created\",{path:path});}});})();/**\n * CircleBrush class\n * @class fabric.CircleBrush\n */fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,/** @lends fabric.CircleBrush.prototype */{/**\n     * Width of a brush\n     * @type Number\n     * @default\n     */width:10,/**\n     * Constructor\n     * @param {fabric.Canvas} canvas\n     * @return {fabric.CircleBrush} Instance of a circle brush\n     */initialize:function(canvas){this.canvas=canvas;this.points=[];},/**\n     * Invoked inside on mouse down and mouse move\n     * @param {Object} pointer\n     */drawDot:function(pointer){var point=this.addPoint(pointer),ctx=this.canvas.contextTop;this._saveAndTransform(ctx);this.dot(ctx,point);ctx.restore();},dot:function(ctx,point){ctx.fillStyle=point.fill;ctx.beginPath();ctx.arc(point.x,point.y,point.radius,0,Math.PI*2,false);ctx.closePath();ctx.fill();},/**\n     * Invoked on mouse down\n     */onMouseDown:function(pointer){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(pointer);},/**\n     * Render the full state of the brush\n     * @private\n     */_render:function(){var ctx=this.canvas.contextTop,i,len,points=this.points;this._saveAndTransform(ctx);for(i=0,len=points.length;i<len;i++){this.dot(ctx,points[i]);}ctx.restore();},/**\n     * Invoked on mouse move\n     * @param {Object} pointer\n     */onMouseMove:function(pointer){if(this.needsFullRender()){this.canvas.clearContext(this.canvas.contextTop);this.addPoint(pointer);this._render();}else{this.drawDot(pointer);}},/**\n     * Invoked on mouse up\n     */onMouseUp:function(){var originalRenderOnAddRemove=this.canvas.renderOnAddRemove,i,len;this.canvas.renderOnAddRemove=false;var circles=[];for(i=0,len=this.points.length;i<len;i++){var point=this.points[i],circle=new fabric.Circle({radius:point.radius,left:point.x,top:point.y,originX:\"center\",originY:\"center\",fill:point.fill});this.shadow&&(circle.shadow=new fabric.Shadow(this.shadow));circles.push(circle);}var group=new fabric.Group(circles);group.canvas=this.canvas;this.canvas.add(group);this.canvas.fire(\"path:created\",{path:group});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=originalRenderOnAddRemove;this.canvas.requestRenderAll();},/**\n     * @param {Object} pointer\n     * @return {fabric.Point} Just added pointer point\n     */addPoint:function(pointer){var pointerPoint=new fabric.Point(pointer.x,pointer.y),circleRadius=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,circleColor=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();pointerPoint.radius=circleRadius;pointerPoint.fill=circleColor;this.points.push(pointerPoint);return pointerPoint;}});/**\n * SprayBrush class\n * @class fabric.SprayBrush\n */fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,/** @lends fabric.SprayBrush.prototype */{/**\n     * Width of a spray\n     * @type Number\n     * @default\n     */width:10,/**\n     * Density of a spray (number of dots per chunk)\n     * @type Number\n     * @default\n     */density:20,/**\n     * Width of spray dots\n     * @type Number\n     * @default\n     */dotWidth:1,/**\n     * Width variance of spray dots\n     * @type Number\n     * @default\n     */dotWidthVariance:1,/**\n     * Whether opacity of a dot should be random\n     * @type Boolean\n     * @default\n     */randomOpacity:false,/**\n     * Whether overlapping dots (rectangles) should be removed (for performance reasons)\n     * @type Boolean\n     * @default\n     */optimizeOverlapping:true,/**\n     * Constructor\n     * @param {fabric.Canvas} canvas\n     * @return {fabric.SprayBrush} Instance of a spray brush\n     */initialize:function(canvas){this.canvas=canvas;this.sprayChunks=[];},/**\n     * Invoked on mouse down\n     * @param {Object} pointer\n     */onMouseDown:function(pointer){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(pointer);this.render(this.sprayChunkPoints);},/**\n     * Invoked on mouse move\n     * @param {Object} pointer\n     */onMouseMove:function(pointer){this.addSprayChunk(pointer);this.render(this.sprayChunkPoints);},/**\n     * Invoked on mouse up\n     */onMouseUp:function(){var originalRenderOnAddRemove=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var rects=[];for(var i=0,ilen=this.sprayChunks.length;i<ilen;i++){var sprayChunk=this.sprayChunks[i];for(var j=0,jlen=sprayChunk.length;j<jlen;j++){var rect=new fabric.Rect({width:sprayChunk[j].width,height:sprayChunk[j].width,left:sprayChunk[j].x+1,top:sprayChunk[j].y+1,originX:\"center\",originY:\"center\",fill:this.color});rects.push(rect);}}if(this.optimizeOverlapping){rects=this._getOptimizedRects(rects);}var group=new fabric.Group(rects);this.shadow&&group.set(\"shadow\",new fabric.Shadow(this.shadow));this.canvas.add(group);this.canvas.fire(\"path:created\",{path:group});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=originalRenderOnAddRemove;this.canvas.requestRenderAll();},/**\n     * @private\n     * @param {Array} rects\n     */_getOptimizedRects:function(rects){// avoid creating duplicate rects at the same coordinates\nvar uniqueRects={},key,i,len;for(i=0,len=rects.length;i<len;i++){key=rects[i].left+\"\"+rects[i].top;if(!uniqueRects[key]){uniqueRects[key]=rects[i];}}var uniqueRectsArray=[];for(key in uniqueRects){uniqueRectsArray.push(uniqueRects[key]);}return uniqueRectsArray;},/**\n     * Render new chunk of spray brush\n     */render:function(sprayChunk){var ctx=this.canvas.contextTop,i,len;ctx.fillStyle=this.color;this._saveAndTransform(ctx);for(i=0,len=sprayChunk.length;i<len;i++){var point=sprayChunk[i];if(typeof point.opacity!==\"undefined\"){ctx.globalAlpha=point.opacity;}ctx.fillRect(point.x,point.y,point.width,point.width);}ctx.restore();},/**\n     * Render all spray chunks\n     */_render:function(){var ctx=this.canvas.contextTop,i,ilen;ctx.fillStyle=this.color;this._saveAndTransform(ctx);for(i=0,ilen=this.sprayChunks.length;i<ilen;i++){this.render(this.sprayChunks[i]);}ctx.restore();},/**\n     * @param {Object} pointer\n     */addSprayChunk:function(pointer){this.sprayChunkPoints=[];var x,y,width,radius=this.width/2,i;for(i=0;i<this.density;i++){x=fabric.util.getRandomInt(pointer.x-radius,pointer.x+radius);y=fabric.util.getRandomInt(pointer.y-radius,pointer.y+radius);if(this.dotWidthVariance){width=fabric.util.getRandomInt(// bottom clamp width to 1\nMath.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance);}else{width=this.dotWidth;}var point=new fabric.Point(x,y);point.width=width;if(this.randomOpacity){point.opacity=fabric.util.getRandomInt(0,100)/100;}this.sprayChunkPoints.push(point);}this.sprayChunks.push(this.sprayChunkPoints);}});/**\n * PatternBrush class\n * @class fabric.PatternBrush\n * @extends fabric.BaseBrush\n */fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,/** @lends fabric.PatternBrush.prototype */{getPatternSrc:function(){var dotWidth=20,dotDistance=5,patternCanvas=fabric.util.createCanvasElement(),patternCtx=patternCanvas.getContext(\"2d\");patternCanvas.width=patternCanvas.height=dotWidth+dotDistance;patternCtx.fillStyle=this.color;patternCtx.beginPath();patternCtx.arc(dotWidth/2,dotWidth/2,dotWidth/2,0,Math.PI*2,false);patternCtx.closePath();patternCtx.fill();return patternCanvas;},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace(\"this.color\",'\"'+this.color+'\"');},/**\n     * Creates \"pattern\" instance property\n     */getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),\"repeat\");},/**\n     * Sets brush styles\n     */_setBrushStyles:function(){this.callSuper(\"_setBrushStyles\");this.canvas.contextTop.strokeStyle=this.getPattern();},/**\n     * Creates path\n     */createPath:function(pathData){var path=this.callSuper(\"createPath\",pathData),topLeft=path._getLeftTopCoords().scalarAdd(path.strokeWidth/2);path.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-topLeft.x,offsetY:-topLeft.y});return path;}});(function(){var getPointer=fabric.util.getPointer,degreesToRadians=fabric.util.degreesToRadians,abs=Math.abs,supportLineDash=fabric.StaticCanvas.supports(\"setLineDash\"),isTouchEvent=fabric.util.isTouchEvent,STROKE_OFFSET=0.5;/**\n   * Canvas class\n   * @class fabric.Canvas\n   * @extends fabric.StaticCanvas\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#canvas}\n   * @see {@link fabric.Canvas#initialize} for constructor definition\n   *\n   * @fires object:modified at the end of a transform or any change when statefull is true\n   * @fires object:rotated at the end of a rotation transform\n   * @fires object:scaled at the end of a scale transform\n   * @fires object:moved at the end of translation transform\n   * @fires object:skewed at the end of a skew transform\n   * @fires object:rotating while an object is being rotated from the control\n   * @fires object:scaling while an object is being scaled by controls\n   * @fires object:moving while an object is being dragged\n   * @fires object:skewing while an object is being skewed from the controls\n   *\n   * @fires before:transform before a transform is is started\n   * @fires before:selection:cleared\n   * @fires selection:cleared\n   * @fires selection:updated\n   * @fires selection:created\n   *\n   * @fires path:created after a drawing operation ends and the path is added\n   * @fires mouse:down\n   * @fires mouse:move\n   * @fires mouse:up\n   * @fires mouse:down:before  on mouse down, before the inner fabric logic runs\n   * @fires mouse:move:before on mouse move, before the inner fabric logic runs\n   * @fires mouse:up:before on mouse up, before the inner fabric logic runs\n   * @fires mouse:over\n   * @fires mouse:out\n   * @fires mouse:dblclick whenever a native dbl click event fires on the canvas.\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop\n   * @fires after:render at the end of the render process, receives the context in the callback\n   * @fires before:render at start the render process, receives the context in the callback\n   *\n   */fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,/** @lends fabric.Canvas.prototype */{/**\n       * Constructor\n       * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n       * @param {Object} [options] Options object\n       * @return {Object} thisArg\n       */initialize:function(el,options){options||(options={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(el,options);this._initInteractive();this._createCacheCanvas();},/**\n       * When true, objects can be transformed by one side (unproportionally)\n       * when dragged on the corners that normally would not do that.\n       * @type Boolean\n       * @default\n       * @since fabric 4.0 // changed name and default value\n       */uniformScaling:true,/**\n       * Indicates which key switches uniform scaling.\n       * values: 'altKey', 'shiftKey', 'ctrlKey'.\n       * If `null` or 'none' or any other string that is not a modifier key\n       * feature is disabled.\n       * totally wrong named. this sounds like `uniform scaling`\n       * if Canvas.uniformScaling is true, pressing this will set it to false\n       * and viceversa.\n       * @since 1.6.2\n       * @type String\n       * @default\n       */uniScaleKey:\"shiftKey\",/**\n       * When true, objects use center point as the origin of scale transformation.\n       * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n       * @since 1.3.4\n       * @type Boolean\n       * @default\n       */centeredScaling:false,/**\n       * When true, objects use center point as the origin of rotate transformation.\n       * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n       * @since 1.3.4\n       * @type Boolean\n       * @default\n       */centeredRotation:false,/**\n       * Indicates which key enable centered Transform\n       * values: 'altKey', 'shiftKey', 'ctrlKey'.\n       * If `null` or 'none' or any other string that is not a modifier key\n       * feature is disabled feature disabled.\n       * @since 1.6.2\n       * @type String\n       * @default\n       */centeredKey:\"altKey\",/**\n       * Indicates which key enable alternate action on corner\n       * values: 'altKey', 'shiftKey', 'ctrlKey'.\n       * If `null` or 'none' or any other string that is not a modifier key\n       * feature is disabled feature disabled.\n       * @since 1.6.2\n       * @type String\n       * @default\n       */altActionKey:\"shiftKey\",/**\n       * Indicates that canvas is interactive. This property should not be changed.\n       * @type Boolean\n       * @default\n       */interactive:true,/**\n       * Indicates whether group selection should be enabled\n       * @type Boolean\n       * @default\n       */selection:true,/**\n       * Indicates which key or keys enable multiple click selection\n       * Pass value as a string or array of strings\n       * values: 'altKey', 'shiftKey', 'ctrlKey'.\n       * If `null` or empty or containing any other string that is not a modifier key\n       * feature is disabled.\n       * @since 1.6.2\n       * @type String|Array\n       * @default\n       */selectionKey:\"shiftKey\",/**\n       * Indicates which key enable alternative selection\n       * in case of target overlapping with active object\n       * values: 'altKey', 'shiftKey', 'ctrlKey'.\n       * For a series of reason that come from the general expectations on how\n       * things should work, this feature works only for preserveObjectStacking true.\n       * If `null` or 'none' or any other string that is not a modifier key\n       * feature is disabled.\n       * @since 1.6.5\n       * @type null|String\n       * @default\n       */altSelectionKey:null,/**\n       * Color of selection\n       * @type String\n       * @default\n       */selectionColor:\"rgba(100, 100, 255, 0.3)\",// blue\n/**\n       * Default dash array pattern\n       * If not empty the selection border is dashed\n       * @type Array\n       */selectionDashArray:[],/**\n       * Color of the border of selection (usually slightly darker than color of selection itself)\n       * @type String\n       * @default\n       */selectionBorderColor:\"rgba(255, 255, 255, 0.3)\",/**\n       * Width of a line used in object/group selection\n       * @type Number\n       * @default\n       */selectionLineWidth:1,/**\n       * Select only shapes that are fully contained in the dragged selection rectangle.\n       * @type Boolean\n       * @default\n       */selectionFullyContained:false,/**\n       * Default cursor value used when hovering over an object on canvas\n       * @type String\n       * @default\n       */hoverCursor:\"move\",/**\n       * Default cursor value used when moving an object on canvas\n       * @type String\n       * @default\n       */moveCursor:\"move\",/**\n       * Default cursor value used for the entire canvas\n       * @type String\n       * @default\n       */defaultCursor:\"default\",/**\n       * Cursor value used during free drawing\n       * @type String\n       * @default\n       */freeDrawingCursor:\"crosshair\",/**\n       * Cursor value used for rotation point\n       * @type String\n       * @default\n       */rotationCursor:\"crosshair\",/**\n       * Cursor value used for disabled elements ( corners with disabled action )\n       * @type String\n       * @since 2.0.0\n       * @default\n       */notAllowedCursor:\"not-allowed\",/**\n       * Default element class that's given to wrapper (div) element of canvas\n       * @type String\n       * @default\n       */containerClass:\"canvas-container\",/**\n       * When true, object detection happens on per-pixel basis rather than on per-bounding-box\n       * @type Boolean\n       * @default\n       */perPixelTargetFind:false,/**\n       * Number of pixels around target pixel to tolerate (consider active) during object detection\n       * @type Number\n       * @default\n       */targetFindTolerance:0,/**\n       * When true, target detection is skipped when hovering over canvas. This can be used to improve performance.\n       * @type Boolean\n       * @default\n       */skipTargetFind:false,/**\n       * When true, mouse events on canvas (mousedown/mousemove/mouseup) result in free drawing.\n       * After mousedown, mousemove creates a shape,\n       * and then mouseup finalizes it and adds an instance of `fabric.Path` onto canvas.\n       * @tutorial {@link http://fabricjs.com/fabric-intro-part-4#free_drawing}\n       * @type Boolean\n       * @default\n       */isDrawingMode:false,/**\n       * Indicates whether objects should remain in current stack position when selected.\n       * When false objects are brought to top and rendered as part of the selection group\n       * @type Boolean\n       * @default\n       */preserveObjectStacking:false,/**\n       * Indicates the angle that an object will lock to while rotating.\n       * @type Number\n       * @since 1.6.7\n       * @default\n       */snapAngle:0,/**\n       * Indicates the distance from the snapAngle the rotation will lock to the snapAngle.\n       * When `null`, the snapThreshold will default to the snapAngle.\n       * @type null|Number\n       * @since 1.6.7\n       * @default\n       */snapThreshold:null,/**\n       * Indicates if the right click on canvas can output the context menu or not\n       * @type Boolean\n       * @since 1.6.5\n       * @default\n       */stopContextMenu:false,/**\n       * Indicates if the canvas can fire right click events\n       * @type Boolean\n       * @since 1.6.5\n       * @default\n       */fireRightClick:false,/**\n       * Indicates if the canvas can fire middle click events\n       * @type Boolean\n       * @since 1.7.8\n       * @default\n       */fireMiddleClick:false,/**\n       * Keep track of the subTargets for Mouse Events\n       * @type fabric.Object[]\n       */targets:[],/**\n       * Keep track of the hovered target\n       * @type fabric.Object\n       * @private\n       */_hoveredTarget:null,/**\n       * hold the list of nested targets hovered\n       * @type fabric.Object[]\n       * @private\n       */_hoveredTargets:[],/**\n       * @private\n       */_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset();},/**\n       * Divides objects in two groups, one to render immediately\n       * and one to render as activeGroup.\n       * @return {Array} objects to render immediately and pushes the other in the activeGroup.\n       */_chooseObjectsToRender:function(){var activeObjects=this.getActiveObjects(),object,objsToRender,activeGroupObjects;if(activeObjects.length>0&&!this.preserveObjectStacking){objsToRender=[];activeGroupObjects=[];for(var i=0,length=this._objects.length;i<length;i++){object=this._objects[i];if(activeObjects.indexOf(object)===-1){objsToRender.push(object);}else{activeGroupObjects.push(object);}}if(activeObjects.length>1){this._activeObject._objects=activeGroupObjects;}objsToRender.push.apply(objsToRender,activeGroupObjects);}else{objsToRender=this._objects;}return objsToRender;},/**\n       * Renders both the top canvas and the secondary container canvas.\n       * @return {fabric.Canvas} instance\n       * @chainable\n       */renderAll:function(){if(this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode){this.clearContext(this.contextTop);this.contextTopDirty=false;}if(this.hasLostContext){this.renderTopLayer(this.contextTop);}var canvasToDrawOn=this.contextContainer;this.renderCanvas(canvasToDrawOn,this._chooseObjectsToRender());return this;},renderTopLayer:function(ctx){ctx.save();if(this.isDrawingMode&&this._isCurrentlyDrawing){this.freeDrawingBrush&&this.freeDrawingBrush._render();this.contextTopDirty=true;}// we render the top context - last object\nif(this.selection&&this._groupSelector){this._drawSelection(ctx);this.contextTopDirty=true;}ctx.restore();},/**\n       * Method to render only the top canvas.\n       * Also used to render the group selection box.\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */renderTop:function(){var ctx=this.contextTop;this.clearContext(ctx);this.renderTopLayer(ctx);this.fire(\"after:render\");return this;},/**\n       * Checks if point is contained within an area of given object\n       * @param {Event} e Event object\n       * @param {fabric.Object} target Object to test against\n       * @param {Object} [point] x,y object of point coordinates we want to check.\n       * @return {Boolean} true if point is contained within an area of given object\n       */containsPoint:function(e,target,point){var ignoreZoom=true,pointer=point||this.getPointer(e,ignoreZoom),xy,isTouch=e?isTouchEvent(e):false;if(target.group&&target.group===this._activeObject&&target.group.type===\"activeSelection\"){xy=this._normalizePointer(target.group,pointer);}else{xy={x:pointer.x,y:pointer.y};}// http://www.geog.ubc.ca/courses/klink/gis.notes/ncgia/u32.html\n// http://idav.ucdavis.edu/~okreylos/TAship/Spring2000/PointInPolygon.html\nreturn target.containsPoint(xy)||!!target._findTargetCorner(pointer,isTouch);},/**\n       * @private\n       */_normalizePointer:function(object,pointer){var m=object.calcTransformMatrix(),invertedM=fabric.util.invertTransform(m),vptPointer=this.restorePointerVpt(pointer);return fabric.util.transformPoint(vptPointer,invertedM);},/**\n       * Returns true if object is transparent at a certain location\n       * @param {fabric.Object} target Object to check\n       * @param {Number} x Left coordinate\n       * @param {Number} y Top coordinate\n       * @return {Boolean}\n       */isTargetTransparent:function(target,x,y){// in case the target is the activeObject, we cannot execute this optimization\n// because we need to draw controls too.\nif(target.shouldCache()&&target._cacheCanvas&&target!==this._activeObject){var normalizedPointer=this._normalizePointer(target,{x:x,y:y}),targetRelativeX=Math.max(target.cacheTranslationX+normalizedPointer.x*target.zoomX,0),targetRelativeY=Math.max(target.cacheTranslationY+normalizedPointer.y*target.zoomY,0);var isTransparent=fabric.util.isTransparent(target._cacheContext,Math.round(targetRelativeX),Math.round(targetRelativeY),this.targetFindTolerance);return isTransparent;}var ctx=this.contextCache,originalColor=target.selectionBackgroundColor,v=this.viewportTransform;target.selectionBackgroundColor=\"\";this.clearContext(ctx);ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);target.render(ctx);ctx.restore();target===this._activeObject&&target._renderControls(ctx,{hasBorders:false,transparentCorners:false},{hasBorders:false});target.selectionBackgroundColor=originalColor;var isTransparent=fabric.util.isTransparent(ctx,x,y,this.targetFindTolerance);return isTransparent;},/**\n       * takes an event and determins if selection key has been pressed\n       * @private\n       * @param {Event} e Event object\n       */_isSelectionKeyPressed:function(e){var selectionKeyPressed=false;if(Object.prototype.toString.call(this.selectionKey)===\"[object Array]\"){selectionKeyPressed=!!this.selectionKey.find(function(key){return e[key]===true;});}else{selectionKeyPressed=e[this.selectionKey];}return selectionKeyPressed;},/**\n       * @private\n       * @param {Event} e Event object\n       * @param {fabric.Object} target\n       */_shouldClearSelection:function(e,target){var activeObjects=this.getActiveObjects(),activeObject=this._activeObject;return!target||target&&activeObject&&activeObjects.length>1&&activeObjects.indexOf(target)===-1&&activeObject!==target&&!this._isSelectionKeyPressed(e)||target&&!target.evented||target&&!target.selectable&&activeObject&&activeObject!==target;},/**\n       * centeredScaling from object can't override centeredScaling from canvas.\n       * this should be fixed, since object setting should take precedence over canvas.\n       * also this should be something that will be migrated in the control properties.\n       * as ability to define the origin of the transformation that the control provide.\n       * @private\n       * @param {fabric.Object} target\n       * @param {String} action\n       */_shouldCenterTransform:function(target,action,altKey){if(!target){return;}var centerTransform;if(action===\"scale\"||action===\"scaleX\"||action===\"scaleY\"){centerTransform=this.centeredScaling||target.centeredScaling;}else if(action===\"rotate\"){centerTransform=this.centeredRotation||target.centeredRotation;}return centerTransform?!altKey:altKey;},/**\n       * should disappear before release 4.0\n       * @private\n       */_getOriginFromCorner:function(target,corner){var origin={x:target.originX,y:target.originY};if(corner===\"ml\"||corner===\"tl\"||corner===\"bl\"){origin.x=\"right\";}else if(corner===\"mr\"||corner===\"tr\"||corner===\"br\"){origin.x=\"left\";}if(corner===\"tl\"||corner===\"mt\"||corner===\"tr\"){origin.y=\"bottom\";}else if(corner===\"bl\"||corner===\"mb\"||corner===\"br\"){origin.y=\"top\";}else if(corner===\"mtr\"){origin.x=\"center\";origin.y=\"center\";}return origin;},/**\n       * @private\n       * @param {Boolean} alreadySelected true if target is already selected\n       * @param {String} corner a string representing the corner ml, mr, tl ...\n       * @param {Event} e Event object\n       * @param {fabric.Object} [target] inserted back to help overriding. Unused\n       */_getActionFromCorner:function(alreadySelected,corner,e,target){if(!corner||!alreadySelected){return\"drag\";}var control=target.controls[corner];return control.getActionName(e,control,target);},/**\n       * @private\n       * @param {Event} e Event object\n       * @param {fabric.Object} target\n       */_setupCurrentTransform:function(e,target,alreadySelected){if(!target){return;}var pointer=this.getPointer(e),corner=target.__corner,actionHandler=!!corner&&target.controls[corner].getActionHandler(),action=this._getActionFromCorner(alreadySelected,corner,e,target),origin=this._getOriginFromCorner(target,corner),altKey=e[this.centeredKey],transform={target:target,action:action,actionHandler:actionHandler,corner:corner,scaleX:target.scaleX,scaleY:target.scaleY,skewX:target.skewX,skewY:target.skewY,// used by transation\noffsetX:pointer.x-target.left,offsetY:pointer.y-target.top,originX:origin.x,originY:origin.y,ex:pointer.x,ey:pointer.y,lastX:pointer.x,lastY:pointer.y,// unsure they are useful anymore.\n// left: target.left,\n// top: target.top,\ntheta:degreesToRadians(target.angle),// end of unsure\nwidth:target.width*target.scaleX,shiftKey:e.shiftKey,altKey:altKey,original:fabric.util.saveObjectTransform(target)};if(this._shouldCenterTransform(target,action,altKey)){transform.originX=\"center\";transform.originY=\"center\";}transform.original.originX=origin.x;transform.original.originY=origin.y;this._currentTransform=transform;this._beforeTransform(e);},/**\n       * Translates object by \"setting\" its left/top\n       * @private\n       * @param {Number} x pointer's x coordinate\n       * @param {Number} y pointer's y coordinate\n       * @return {Boolean} true if the translation occurred\n       */_translateObject:function(x,y){var transform=this._currentTransform,target=transform.target,newLeft=x-transform.offsetX,newTop=y-transform.offsetY,moveX=!target.get(\"lockMovementX\")&&target.left!==newLeft,moveY=!target.get(\"lockMovementY\")&&target.top!==newTop;moveX&&target.set(\"left\",newLeft);moveY&&target.set(\"top\",newTop);return moveX||moveY;},/**\n       * Set the cursor type of the canvas element\n       * @param {String} value Cursor type of the canvas element.\n       * @see http://www.w3.org/TR/css3-ui/#cursor\n       */setCursor:function(value){this.upperCanvasEl.style.cursor=value;},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx to draw the selection on\n       */_drawSelection:function(ctx){var groupSelector=this._groupSelector,left=groupSelector.left,top=groupSelector.top,aleft=abs(left),atop=abs(top);if(this.selectionColor){ctx.fillStyle=this.selectionColor;ctx.fillRect(groupSelector.ex-(left>0?0:-left),groupSelector.ey-(top>0?0:-top),aleft,atop);}if(!this.selectionLineWidth||!this.selectionBorderColor){return;}ctx.lineWidth=this.selectionLineWidth;ctx.strokeStyle=this.selectionBorderColor;// selection border\nif(this.selectionDashArray.length>1&&!supportLineDash){var px=groupSelector.ex+STROKE_OFFSET-(left>0?0:aleft),py=groupSelector.ey+STROKE_OFFSET-(top>0?0:atop);ctx.beginPath();fabric.util.drawDashedLine(ctx,px,py,px+aleft,py,this.selectionDashArray);fabric.util.drawDashedLine(ctx,px,py+atop-1,px+aleft,py+atop-1,this.selectionDashArray);fabric.util.drawDashedLine(ctx,px,py,px,py+atop,this.selectionDashArray);fabric.util.drawDashedLine(ctx,px+aleft-1,py,px+aleft-1,py+atop,this.selectionDashArray);ctx.closePath();ctx.stroke();}else{fabric.Object.prototype._setLineDash.call(this,ctx,this.selectionDashArray);ctx.strokeRect(groupSelector.ex+STROKE_OFFSET-(left>0?0:aleft),groupSelector.ey+STROKE_OFFSET-(top>0?0:atop),aleft,atop);}},/**\n       * Method that determines what object we are clicking on\n       * the skipGroup parameter is for internal use, is needed for shift+click action\n       * 11/09/2018 TODO: would be cool if findTarget could discern between being a full target\n       * or the outside part of the corner.\n       * @param {Event} e mouse event\n       * @param {Boolean} skipGroup when true, activeGroup is skipped and only objects are traversed through\n       * @return {fabric.Object} the target found\n       */findTarget:function(e,skipGroup){if(this.skipTargetFind){return;}var ignoreZoom=true,pointer=this.getPointer(e,ignoreZoom),activeObject=this._activeObject,aObjects=this.getActiveObjects(),activeTarget,activeTargetSubs,isTouch=isTouchEvent(e);// first check current group (if one exists)\n// active group does not check sub targets like normal groups.\n// if active group just exits.\nthis.targets=[];if(aObjects.length>1&&!skipGroup&&activeObject===this._searchPossibleTargets([activeObject],pointer)){return activeObject;}// if we hit the corner of an activeObject, let's return that.\nif(aObjects.length===1&&activeObject._findTargetCorner(pointer,isTouch)){return activeObject;}if(aObjects.length===1&&activeObject===this._searchPossibleTargets([activeObject],pointer)){if(!this.preserveObjectStacking){return activeObject;}else{activeTarget=activeObject;activeTargetSubs=this.targets;this.targets=[];}}var target=this._searchPossibleTargets(this._objects,pointer);if(e[this.altSelectionKey]&&target&&activeTarget&&target!==activeTarget){target=activeTarget;this.targets=activeTargetSubs;}return target;},/**\n       * Checks point is inside the object.\n       * @param {Object} [pointer] x,y object of point coordinates we want to check.\n       * @param {fabric.Object} obj Object to test against\n       * @param {Object} [globalPointer] x,y object of point coordinates relative to canvas used to search per pixel target.\n       * @return {Boolean} true if point is contained within an area of given object\n       * @private\n       */_checkTarget:function(pointer,obj,globalPointer){if(obj&&obj.visible&&obj.evented&&this.containsPoint(null,obj,pointer)){if((this.perPixelTargetFind||obj.perPixelTargetFind)&&!obj.isEditing){var isTransparent=this.isTargetTransparent(obj,globalPointer.x,globalPointer.y);if(!isTransparent){return true;}}else{return true;}}},/**\n       * Function used to search inside objects an object that contains pointer in bounding box or that contains pointerOnCanvas when painted\n       * @param {Array} [objects] objects array to look into\n       * @param {Object} [pointer] x,y object of point coordinates we want to check.\n       * @return {fabric.Object} object that contains pointer\n       * @private\n       */_searchPossibleTargets:function(objects,pointer){// Cache all targets where their bounding box contains point.\nvar target,i=objects.length,subTarget;// Do not check for currently grouped objects, since we check the parent group itself.\n// until we call this function specifically to search inside the activeGroup\nwhile(i--){var objToCheck=objects[i];var pointerToUse=objToCheck.group&&objToCheck.group.type!==\"activeSelection\"?this._normalizePointer(objToCheck.group,pointer):pointer;if(this._checkTarget(pointerToUse,objToCheck,pointer)){target=objects[i];if(target.subTargetCheck&&target instanceof fabric.Group){subTarget=this._searchPossibleTargets(target._objects,pointer);subTarget&&this.targets.push(subTarget);}break;}}return target;},/**\n       * Returns pointer coordinates without the effect of the viewport\n       * @param {Object} pointer with \"x\" and \"y\" number values\n       * @return {Object} object with \"x\" and \"y\" number values\n       */restorePointerVpt:function(pointer){return fabric.util.transformPoint(pointer,fabric.util.invertTransform(this.viewportTransform));},/**\n       * Returns pointer coordinates relative to canvas.\n       * Can return coordinates with or without viewportTransform.\n       * ignoreZoom false gives back coordinates that represent\n       * the point clicked on canvas element.\n       * ignoreZoom true gives back coordinates after being processed\n       * by the viewportTransform ( sort of coordinates of what is displayed\n       * on the canvas where you are clicking.\n       * ignoreZoom true = HTMLElement coordinates relative to top,left\n       * ignoreZoom false, default = fabric space coordinates, the same used for shape position\n       * To interact with your shapes top and left you want to use ignoreZoom true\n       * most of the time, while ignoreZoom false will give you coordinates\n       * compatible with the object.oCoords system.\n       * of the time.\n       * @param {Event} e\n       * @param {Boolean} ignoreZoom\n       * @return {Object} object with \"x\" and \"y\" number values\n       */getPointer:function(e,ignoreZoom){// return cached values if we are in the event processing chain\nif(this._absolutePointer&&!ignoreZoom){return this._absolutePointer;}if(this._pointer&&ignoreZoom){return this._pointer;}var pointer=getPointer(e),upperCanvasEl=this.upperCanvasEl,bounds=upperCanvasEl.getBoundingClientRect(),boundsWidth=bounds.width||0,boundsHeight=bounds.height||0,cssScale;if(!boundsWidth||!boundsHeight){if(\"top\"in bounds&&\"bottom\"in bounds){boundsHeight=Math.abs(bounds.top-bounds.bottom);}if(\"right\"in bounds&&\"left\"in bounds){boundsWidth=Math.abs(bounds.right-bounds.left);}}this.calcOffset();pointer.x=pointer.x-this._offset.left;pointer.y=pointer.y-this._offset.top;if(!ignoreZoom){pointer=this.restorePointerVpt(pointer);}var retinaScaling=this.getRetinaScaling();if(retinaScaling!==1){pointer.x/=retinaScaling;pointer.y/=retinaScaling;}if(boundsWidth===0||boundsHeight===0){// If bounds are not available (i.e. not visible), do not apply scale.\ncssScale={width:1,height:1};}else{cssScale={width:upperCanvasEl.width/boundsWidth,height:upperCanvasEl.height/boundsHeight};}return{x:pointer.x*cssScale.width,y:pointer.y*cssScale.height};},/**\n       * @private\n       * @throws {CANVAS_INIT_ERROR} If canvas can not be initialized\n       */_createUpperCanvas:function(){var lowerCanvasClass=this.lowerCanvasEl.className.replace(/\\s*lower-canvas\\s*/,\"\"),lowerCanvasEl=this.lowerCanvasEl,upperCanvasEl=this.upperCanvasEl;// there is no need to create a new upperCanvas element if we have already one.\nif(upperCanvasEl){upperCanvasEl.className=\"\";}else{upperCanvasEl=this._createCanvasElement();this.upperCanvasEl=upperCanvasEl;}fabric.util.addClass(upperCanvasEl,\"upper-canvas \"+lowerCanvasClass);this.wrapperEl.appendChild(upperCanvasEl);this._copyCanvasStyle(lowerCanvasEl,upperCanvasEl);this._applyCanvasStyle(upperCanvasEl);this.contextTop=upperCanvasEl.getContext(\"2d\");},/**\n       * @private\n       */_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute(\"width\",this.width);this.cacheCanvasEl.setAttribute(\"height\",this.height);this.contextCache=this.cacheCanvasEl.getContext(\"2d\");},/**\n       * @private\n       */_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,\"div\",{class:this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.width+\"px\",height:this.height+\"px\",position:\"relative\"});fabric.util.makeElementUnselectable(this.wrapperEl);},/**\n       * @private\n       * @param {HTMLElement} element canvas element to apply styles on\n       */_applyCanvasStyle:function(element){var width=this.width||element.width,height=this.height||element.height;fabric.util.setStyle(element,{position:\"absolute\",width:width+\"px\",height:height+\"px\",left:0,top:0,\"touch-action\":this.allowTouchScrolling?\"manipulation\":\"none\",\"-ms-touch-action\":this.allowTouchScrolling?\"manipulation\":\"none\"});element.width=width;element.height=height;fabric.util.makeElementUnselectable(element);},/**\n       * Copy the entire inline style from one element (fromEl) to another (toEl)\n       * @private\n       * @param {Element} fromEl Element style is copied from\n       * @param {Element} toEl Element copied style is applied to\n       */_copyCanvasStyle:function(fromEl,toEl){toEl.style.cssText=fromEl.style.cssText;},/**\n       * Returns context of canvas where object selection is drawn\n       * @return {CanvasRenderingContext2D}\n       */getSelectionContext:function(){return this.contextTop;},/**\n       * Returns &lt;canvas> element on which object selection is drawn\n       * @return {HTMLCanvasElement}\n       */getSelectionElement:function(){return this.upperCanvasEl;},/**\n       * Returns currently active object\n       * @return {fabric.Object} active object\n       */getActiveObject:function(){return this._activeObject;},/**\n       * Returns an array with the current selected objects\n       * @return {fabric.Object} active object\n       */getActiveObjects:function(){var active=this._activeObject;if(active){if(active.type===\"activeSelection\"&&active._objects){return active._objects.slice(0);}else{return[active];}}return[];},/**\n       * @private\n       * @param {fabric.Object} obj Object that was removed\n       */_onObjectRemoved:function(obj){// removing active object should fire \"selection:cleared\" events\nif(obj===this._activeObject){this.fire(\"before:selection:cleared\",{target:obj});this._discardActiveObject();this.fire(\"selection:cleared\",{target:obj});obj.fire(\"deselected\");}if(obj===this._hoveredTarget){this._hoveredTarget=null;this._hoveredTargets=[];}this.callSuper(\"_onObjectRemoved\",obj);},/**\n       * @private\n       * Compares the old activeObject with the current one and fires correct events\n       * @param {fabric.Object} obj old activeObject\n       */_fireSelectionEvents:function(oldObjects,e){var somethingChanged=false,objects=this.getActiveObjects(),added=[],removed=[],opt={e:e};oldObjects.forEach(function(oldObject){if(objects.indexOf(oldObject)===-1){somethingChanged=true;oldObject.fire(\"deselected\",opt);removed.push(oldObject);}});objects.forEach(function(object){if(oldObjects.indexOf(object)===-1){somethingChanged=true;object.fire(\"selected\",opt);added.push(object);}});if(oldObjects.length>0&&objects.length>0){opt.selected=added;opt.deselected=removed;// added for backward compatibility\nopt.updated=added[0]||removed[0];opt.target=this._activeObject;somethingChanged&&this.fire(\"selection:updated\",opt);}else if(objects.length>0){opt.selected=added;// added for backward compatibility\nopt.target=this._activeObject;this.fire(\"selection:created\",opt);}else if(oldObjects.length>0){opt.deselected=removed;this.fire(\"selection:cleared\",opt);}},/**\n       * Sets given object as the only active object on canvas\n       * @param {fabric.Object} object Object to set as an active one\n       * @param {Event} [e] Event (passed along when firing \"object:selected\")\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */setActiveObject:function(object,e){var currentActives=this.getActiveObjects();this._setActiveObject(object,e);this._fireSelectionEvents(currentActives,e);return this;},/**\n       * @private\n       * @param {Object} object to set as active\n       * @param {Event} [e] Event (passed along when firing \"object:selected\")\n       * @return {Boolean} true if the selection happened\n       */_setActiveObject:function(object,e){if(this._activeObject===object){return false;}if(!this._discardActiveObject(e,object)){return false;}if(object.onSelect({e:e})){return false;}this._activeObject=object;return true;},/**\n       * @private\n       */_discardActiveObject:function(e,object){var obj=this._activeObject;if(obj){// onDeselect return TRUE to cancel selection;\nif(obj.onDeselect({e:e,object:object})){return false;}this._activeObject=null;}return true;},/**\n       * Discards currently active object and fire events. If the function is called by fabric\n       * as a consequence of a mouse event, the event is passed as a parameter and\n       * sent to the fire function for the custom events. When used as a method the\n       * e param does not have any application.\n       * @param {event} e\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */discardActiveObject:function(e){var currentActives=this.getActiveObjects(),activeObject=this.getActiveObject();if(currentActives.length){this.fire(\"before:selection:cleared\",{target:activeObject,e:e});}this._discardActiveObject(e);this._fireSelectionEvents(currentActives,e);return this;},/**\n       * Clears a canvas element and removes all event listeners\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */dispose:function(){var wrapper=this.wrapperEl;this.removeListeners();wrapper.removeChild(this.upperCanvasEl);wrapper.removeChild(this.lowerCanvasEl);this.contextCache=null;this.contextTop=null;[\"upperCanvasEl\",\"cacheCanvasEl\"].forEach(function(element){fabric.util.cleanUpJsdomNode(this[element]);this[element]=undefined;}.bind(this));if(wrapper.parentNode){wrapper.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl);}delete this.wrapperEl;fabric.StaticCanvas.prototype.dispose.call(this);return this;},/**\n       * Clears all contexts (background, main, top) of an instance\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */clear:function(){// this.discardActiveGroup();\nthis.discardActiveObject();this.clearContext(this.contextTop);return this.callSuper(\"clear\");},/**\n       * Draws objects' controls (borders/controls)\n       * @param {CanvasRenderingContext2D} ctx Context to render controls on\n       */drawControls:function(ctx){var activeObject=this._activeObject;if(activeObject){activeObject._renderControls(ctx);}},/**\n       * @private\n       */_toObject:function(instance,methodName,propertiesToInclude){//If the object is part of the current selection group, it should\n//be transformed appropriately\n//i.e. it should be serialised as it would appear if the selection group\n//were to be destroyed.\nvar originalProperties=this._realizeGroupTransformOnObject(instance),object=this.callSuper(\"_toObject\",instance,methodName,propertiesToInclude);//Undo the damage we did by changing all of its properties\nthis._unwindGroupTransformOnObject(instance,originalProperties);return object;},/**\n       * Realises an object's group transformation on it\n       * @private\n       * @param {fabric.Object} [instance] the object to transform (gets mutated)\n       * @returns the original values of instance which were changed\n       */_realizeGroupTransformOnObject:function(instance){if(instance.group&&instance.group.type===\"activeSelection\"&&this._activeObject===instance.group){var layoutProps=[\"angle\",\"flipX\",\"flipY\",\"left\",\"scaleX\",\"scaleY\",\"skewX\",\"skewY\",\"top\"];//Copy all the positionally relevant properties across now\nvar originalValues={};layoutProps.forEach(function(prop){originalValues[prop]=instance[prop];});this._activeObject.realizeTransform(instance);return originalValues;}else{return null;}},/**\n       * Restores the changed properties of instance\n       * @private\n       * @param {fabric.Object} [instance] the object to un-transform (gets mutated)\n       * @param {Object} [originalValues] the original values of instance, as returned by _realizeGroupTransformOnObject\n       */_unwindGroupTransformOnObject:function(instance,originalValues){if(originalValues){instance.set(originalValues);}},/**\n       * @private\n       */_setSVGObject:function(markup,instance,reviver){//If the object is in a selection group, simulate what would happen to that\n//object when the group is deselected\nvar originalProperties=this._realizeGroupTransformOnObject(instance);this.callSuper(\"_setSVGObject\",markup,instance,reviver);this._unwindGroupTransformOnObject(instance,originalProperties);},setViewportTransform:function(vpt){if(this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing){this._activeObject.clearContextTop();}fabric.StaticCanvas.prototype.setViewportTransform.call(this,vpt);}});// copying static properties manually to work around Opera's bug,\n// where \"prototype\" property is enumerable and overrides existing prototype\nfor(var prop in fabric.StaticCanvas){if(prop!==\"prototype\"){fabric.Canvas[prop]=fabric.StaticCanvas[prop];}}})();(function(){var addListener=fabric.util.addListener,removeListener=fabric.util.removeListener,RIGHT_CLICK=3,MIDDLE_CLICK=2,LEFT_CLICK=1,addEventOptions={passive:false};function checkClick(e,value){return e.button&&e.button===value-1;}fabric.util.object.extend(fabric.Canvas.prototype,/** @lends fabric.Canvas.prototype */{/**\n       * Contains the id of the touch event that owns the fabric transform\n       * @type Number\n       * @private\n       */mainTouchId:null,/**\n       * Adds mouse listeners to canvas\n       * @private\n       */_initEventListeners:function(){var eventMapping={};if(window.PointerEvent){// IE11 and other W3C Pointer Event implementations (see http://www.w3.org/TR/pointerevents)\neventMapping={down:\"pointerdown\",up:\"pointerup\",enter:\"pointerenter\",leave:\"pointerleave\",over:\"pointerover\",out:\"pointerout\",move:\"pointermove\"};}else if(window.MSPointerEvent&&window.navigator.msPointerEnabled){// IE10\neventMapping={down:\"MSPointerDown\",up:\"MSPointerUp\",enter:\"MSPointerEnter\",leave:\"MSPointerLeave\",over:\"MSPointerOver\",out:\"MSPointerOut\",move:\"MSPointerMove\"};}else{// Legacy W3C mouse events\neventMapping={down:\"mousedown\",up:\"mouseup\",enter:\"mouseover\",leave:\"mouseout\",over:\"mouseover\",out:\"mouseout\",move:\"mousemove\"};/*if ( $.Browser.vendor === $.BROWSERS.IE && $.Browser.version < 9 ) {\n                    eventMapping.enter = 'mouseenter';\n                    eventMapping.leave = ' mouseleave';\n                }*/}fabric.eventMapping=eventMapping;// in case we initialized the class twice. This should not happen normally\n// but in some kind of applications where the canvas element may be changed\n// this is a workaround to having double listeners.\nthis.removeListeners();this._bindEvents();this.addOrRemove(addListener,\"add\");},/**\n       * return an event prefix pointer or mouse.\n       * adapted\n       * @private\n       */_getEventPrefix:function(){return this.enablePointerEvents?\"pointer\":\"mouse\";},addOrRemove:function(functor,eventjsFunctor){var canvasElement=this.upperCanvasEl,eventTypePrefix=this._getEventPrefix();functor(fabric.window,\"resize\",this._onResize);functor(canvasElement,fabric.eventMapping.down,this._onMouseDown);functor(canvasElement,fabric.eventMapping.move,this._onMouseMove,addEventOptions);functor(canvasElement,fabric.eventMapping.out,this._onMouseOut);functor(canvasElement,fabric.eventMapping.enter,this._onMouseEnter);functor(canvasElement,\"wheel\",this._onMouseWheel);functor(canvasElement,\"contextmenu\",this._onContextMenu);functor(canvasElement,\"dblclick\",this._onDoubleClick);functor(canvasElement,\"dragover\",this._onDragOver);functor(canvasElement,\"dragenter\",this._onDragEnter);functor(canvasElement,\"dragleave\",this._onDragLeave);functor(canvasElement,\"drop\",this._onDrop);if(!this.enablePointerEvents){functor(canvasElement,\"touchstart\",this._onTouchStart,addEventOptions);}if(typeof eventjs!==\"undefined\"&&eventjsFunctor in eventjs){eventjs[eventjsFunctor](canvasElement,\"gesture\",this._onGesture);eventjs[eventjsFunctor](canvasElement,\"drag\",this._onDrag);eventjs[eventjsFunctor](canvasElement,\"orientation\",this._onOrientationChange);eventjs[eventjsFunctor](canvasElement,\"shake\",this._onShake);eventjs[eventjsFunctor](canvasElement,\"longpress\",this._onLongPress);}},/**\n       * Removes all event listeners\n       * adapted\n       */removeListeners:function(){this.addOrRemove(removeListener,\"remove\");// if you dispose on a mouseDown, before mouse up, you need to clean document to...\nvar eventTypePrefix=this._getEventPrefix();removeListener(fabric.document,fabric.eventMapping.up,this._onMouseUp);removeListener(fabric.document,\"touchend\",this._onTouchEnd,addEventOptions);removeListener(fabric.document,fabric.eventMapping.move,this._onMouseMove,addEventOptions);removeListener(fabric.document,\"touchmove\",this._onMouseMove,addEventOptions);},/**\n       * @private\n       */_bindEvents:function(){if(this.eventsBound){// for any reason we pass here twice we do not want to bind events twice.\nreturn;}this._onMouseDown=this._onMouseDown.bind(this);this._onTouchStart=this._onTouchStart.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onTouchEnd=this._onTouchEnd.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this);this._onMouseOut=this._onMouseOut.bind(this);this._onMouseEnter=this._onMouseEnter.bind(this);this._onContextMenu=this._onContextMenu.bind(this);this._onDoubleClick=this._onDoubleClick.bind(this);this._onDragOver=this._onDragOver.bind(this);this._onDragEnter=this._simpleEventHandler.bind(this,\"dragenter\");this._onDragLeave=this._simpleEventHandler.bind(this,\"dragleave\");this._onDrop=this._simpleEventHandler.bind(this,\"drop\");this.eventsBound=true;},/**\n       * @private\n       * @param {Event} [e] Event object fired on Event.js gesture\n       * @param {Event} [self] Inner Event object\n       */_onGesture:function(e,self){this.__onTransformGesture&&this.__onTransformGesture(e,self);},/**\n       * @private\n       * @param {Event} [e] Event object fired on Event.js drag\n       * @param {Event} [self] Inner Event object\n       */_onDrag:function(e,self){this.__onDrag&&this.__onDrag(e,self);},/**\n       * @private\n       * @param {Event} [e] Event object fired on wheel event\n       */_onMouseWheel:function(e){this.__onMouseWheel(e);},/**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       * adapted\n       */_onMouseOut:function(e){var target=this._hoveredTarget;this.fire(\"mouse:out\",{target:target,e:e});this._hoveredTarget=null;target&&target.fire(fabric.eventMapping.out,{e:e});var _this=this;this._hoveredTargets.forEach(function(_target){_this.fire(\"mouse:out\",{target:target,e:e});_target&&target.fire(fabric.eventMapping.out,{e:e});});this._hoveredTargets=[];if(this._iTextInstances){this._iTextInstances.forEach(function(obj){if(obj.isEditing){obj.hiddenTextarea.focus();}});}},/**\n       * @private\n       * @param {Event} e Event object fired on mouseenter\n       */_onMouseEnter:function(e){// This find target and consequent 'mouse:over' is used to\n// clear old instances on hovered target.\n// calling findTarget has the side effect of killing target.__corner.\n// as a short term fix we are not firing this if we are currently transforming.\n// as a long term fix we need to separate the action of finding a target with the\n// side effects we added to it.\nif(!this.currentTransform&&!this.findTarget(e)){this.fire(\"mouse:over\",{target:null,e:e});this._hoveredTarget=null;this._hoveredTargets=[];}},/**\n       * @private\n       * @param {Event} [e] Event object fired on Event.js orientation change\n       * @param {Event} [self] Inner Event object\n       */_onOrientationChange:function(e,self){this.__onOrientationChange&&this.__onOrientationChange(e,self);},/**\n       * @private\n       * @param {Event} [e] Event object fired on Event.js shake\n       * @param {Event} [self] Inner Event object\n       */_onShake:function(e,self){this.__onShake&&this.__onShake(e,self);},/**\n       * @private\n       * @param {Event} [e] Event object fired on Event.js shake\n       * @param {Event} [self] Inner Event object\n       */_onLongPress:function(e,self){this.__onLongPress&&this.__onLongPress(e,self);},/**\n       * prevent default to allow drop event to be fired\n       * @private\n       * @param {Event} [e] Event object fired on Event.js shake\n       */_onDragOver:function(e){e.preventDefault();var target=this._simpleEventHandler(\"dragover\",e);this._fireEnterLeaveEvents(target,e);},/**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       */_onContextMenu:function(e){if(this.stopContextMenu){e.stopPropagation();e.preventDefault();}return false;},/**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       */_onDoubleClick:function(e){this._cacheTransformEventData(e);this._handleEvent(e,\"dblclick\");this._resetTransformEventData(e);},/**\n       * Return a the id of an event.\n       * returns either the pointerId or the identifier or 0 for the mouse event\n       * @private\n       * @param {Event} evt Event object\n       */getPointerId:function(evt){var changedTouches=evt.changedTouches;if(changedTouches){return changedTouches[0]&&changedTouches[0].identifier;}if(this.enablePointerEvents){return evt.pointerId;}return-1;},/**\n       * Determines if an event has the id of the event that is considered main\n       * @private\n       * @param {evt} event Event object\n       */_isMainEvent:function(evt){if(evt.isPrimary===true){return true;}if(evt.isPrimary===false){return false;}if(evt.type===\"touchend\"&&evt.touches.length===0){return true;}if(evt.changedTouches){return evt.changedTouches[0].identifier===this.mainTouchId;}return true;},/**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       */_onTouchStart:function(e){e.preventDefault();if(this.mainTouchId===null){this.mainTouchId=this.getPointerId(e);}this.__onMouseDown(e);this._resetTransformEventData();var canvasElement=this.upperCanvasEl,eventTypePrefix=this._getEventPrefix();addListener(fabric.document,\"touchend\",this._onTouchEnd,addEventOptions);addListener(fabric.document,\"touchmove\",this._onMouseMove,addEventOptions);// Unbind mousedown to prevent double triggers from touch devices\nremoveListener(canvasElement,eventTypePrefix+\"down\",this._onMouseDown);},/**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       * adapted\n       */_onMouseDown:function(e){this.__onMouseDown(e);this._resetTransformEventData();var canvasElement=this.upperCanvasEl,eventTypePrefix=this._getEventPrefix();removeListener(canvasElement,fabric.eventMapping.move,this._onMouseMove,addEventOptions);addListener(fabric.document,fabric.eventMapping.up,this._onMouseUp);addListener(fabric.document,fabric.eventMapping.move,this._onMouseMove,addEventOptions);},/**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       * adapted\n       */_onTouchEnd:function(e){if(e.touches.length>0){// if there are still touches stop here\nreturn;}this.__onMouseUp(e);this._resetTransformEventData();this.mainTouchId=null;var eventTypePrefix=this._getEventPrefix();removeListener(fabric.document,\"touchend\",this._onTouchEnd,addEventOptions);removeListener(fabric.document,\"touchmove\",this._onMouseMove,addEventOptions);var _this=this;if(this._willAddMouseDown){clearTimeout(this._willAddMouseDown);}this._willAddMouseDown=setTimeout(function(){// Wait 400ms before rebinding mousedown to prevent double triggers\n// from touch devices\naddListener(_this.upperCanvasEl,fabric.eventMapping.down,_this._onMouseDown);_this._willAddMouseDown=0;},400);},/**\n       * @private\n       * @param {Event} e Event object fired on mouseup\n       * adapted\n       */_onMouseUp:function(e){this.__onMouseUp(e);this._resetTransformEventData();var canvasElement=this.upperCanvasEl,eventTypePrefix=this._getEventPrefix();if(this._isMainEvent(e)){removeListener(fabric.document,fabric.eventMapping.up,this._onMouseUp);removeListener(fabric.document,fabric.eventMapping.move,this._onMouseMove,addEventOptions);addListener(canvasElement,fabric.eventMapping.move,this._onMouseMove,addEventOptions);}},/**\n       * @private\n       * @param {Event} e Event object fired on mousemove\n       */_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault();this.__onMouseMove(e);},/**\n       * @private\n       */_onResize:function(){this.calcOffset();},/**\n       * Decides whether the canvas should be redrawn in mouseup and mousedown events.\n       * @private\n       * @param {Object} target\n       */_shouldRender:function(target){var activeObject=this._activeObject;if(!!activeObject!==!!target||activeObject&&target&&activeObject!==target){// this covers: switch of target, from target to no target, selection of target\n// multiSelection with key and mouse\nreturn true;}else if(activeObject&&activeObject.isEditing){// if we mouse up/down over a editing textbox a cursor change,\n// there is no need to re render\nreturn false;}return false;},/**\n       * Method that defines the actions when mouse is released on canvas.\n       * The method resets the currentTransform parameters, store the image corner\n       * position in the image object and render the canvas on top.\n       * @private\n       * @param {Event} e Event object fired on mouseup\n       */__onMouseUp:function(e){var target,transform=this._currentTransform,groupSelector=this._groupSelector,shouldRender=false,isClick=!groupSelector||groupSelector.left===0&&groupSelector.top===0;this._cacheTransformEventData(e);target=this._target;this._handleEvent(e,\"up:before\");// if right/middle click just fire events and return\n// target undefined will make the _handleEvent search the target\nif(checkClick(e,RIGHT_CLICK)){if(this.fireRightClick){this._handleEvent(e,\"up\",RIGHT_CLICK,isClick);}return;}if(checkClick(e,MIDDLE_CLICK)){if(this.fireMiddleClick){this._handleEvent(e,\"up\",MIDDLE_CLICK,isClick);}this._resetTransformEventData();return;}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(e);return;}if(!this._isMainEvent(e)){return;}if(transform){this._finalizeCurrentTransform(e);shouldRender=transform.actionPerformed;}if(!isClick){var targetWasActive=target===this._activeObject;this._maybeGroupObjects(e);if(!shouldRender){shouldRender=this._shouldRender(target)||!targetWasActive&&target===this._activeObject;}}if(target){var corner=target._findTargetCorner(this.getPointer(e,true),fabric.util.isTouchEvent(e));var control=target.controls[corner],mouseUpHandler=control&&control.getMouseUpHandler(e,target,control);if(mouseUpHandler){mouseUpHandler(e,target,control);}target.isMoving=false;}this._setCursorFromEvent(e,target);this._handleEvent(e,\"up\",LEFT_CLICK,isClick);this._groupSelector=null;this._currentTransform=null;// reset the target information about which corner is selected\ntarget&&(target.__corner=0);if(shouldRender){this.requestRenderAll();}else if(!isClick){this.renderTop();}},/**\n       * @private\n       * Handle event firing for target and subtargets\n       * @param {Event} e event from mouse\n       * @param {String} eventType event to fire (up, down or move)\n       * @return {Fabric.Object} target return the the target found, for internal reasons.\n       */_simpleEventHandler:function(eventType,e){var target=this.findTarget(e),targets=this.targets,options={e:e,target:target,subTargets:targets};this.fire(eventType,options);target&&target.fire(eventType,options);if(!targets){return target;}for(var i=0;i<targets.length;i++){targets[i].fire(eventType,options);}return target;},/**\n       * @private\n       * Handle event firing for target and subtargets\n       * @param {Event} e event from mouse\n       * @param {String} eventType event to fire (up, down or move)\n       * @param {fabric.Object} targetObj receiving event\n       * @param {Number} [button] button used in the event 1 = left, 2 = middle, 3 = right\n       * @param {Boolean} isClick for left button only, indicates that the mouse up happened without move.\n       */_handleEvent:function(e,eventType,button,isClick){var target=this._target,targets=this.targets||[],options={e:e,target:target,subTargets:targets,button:button||LEFT_CLICK,isClick:isClick||false,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire(\"mouse:\"+eventType,options);target&&target.fire(\"mouse\"+eventType,options);for(var i=0;i<targets.length;i++){targets[i].fire(\"mouse\"+eventType,options);}},/**\n       * @private\n       * @param {Event} e send the mouse event that generate the finalize down, so it can be used in the event\n       */_finalizeCurrentTransform:function(e){var transform=this._currentTransform,target=transform.target,eventName,options={e:e,target:target,transform:transform};if(target._scaling){target._scaling=false;}target.setCoords();if(transform.actionPerformed||this.stateful&&target.hasStateChanged()){if(transform.actionPerformed){eventName=this._addEventOptions(options,transform);this._fire(eventName,options);}this._fire(\"modified\",options);}},/**\n       * Mutate option object in order to add by property and give back the event name.\n       * @private\n       * @param {Object} options to mutate\n       * @param {Object} transform to inspect action from\n       */_addEventOptions:function(options,transform){// we can probably add more details at low cost\n// scale change, rotation changes, translation changes\nvar eventName,by;switch(transform.action){case\"scaleX\":eventName=\"scaled\";by=\"x\";break;case\"scaleY\":eventName=\"scaled\";by=\"y\";break;case\"skewX\":eventName=\"skewed\";by=\"x\";break;case\"skewY\":eventName=\"skewed\";by=\"y\";break;case\"scale\":eventName=\"scaled\";by=\"equally\";break;case\"rotate\":eventName=\"rotated\";break;case\"drag\":eventName=\"moved\";break;}options.by=by;return eventName;},/**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       */_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=true;if(this.getActiveObject()){this.discardActiveObject(e).requestRenderAll();}var pointer=this.getPointer(e);this.freeDrawingBrush.onMouseDown(pointer,{e:e,pointer:pointer});this._handleEvent(e,\"down\");},/**\n       * @private\n       * @param {Event} e Event object fired on mousemove\n       */_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var pointer=this.getPointer(e);this.freeDrawingBrush.onMouseMove(pointer,{e:e,pointer:pointer});}this.setCursor(this.freeDrawingCursor);this._handleEvent(e,\"move\");},/**\n       * @private\n       * @param {Event} e Event object fired on mouseup\n       */_onMouseUpInDrawingMode:function(e){var pointer=this.getPointer(e);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:e,pointer:pointer});this._handleEvent(e,\"up\");},/**\n       * Method that defines the actions when mouse is clicked on canvas.\n       * The method inits the currentTransform parameters and renders all the\n       * canvas so the current image can be placed on the top canvas and the rest\n       * in on the container one.\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       */__onMouseDown:function(e){this._cacheTransformEventData(e);this._handleEvent(e,\"down:before\");var target=this._target;// if right click just fire events\nif(checkClick(e,RIGHT_CLICK)){if(this.fireRightClick){this._handleEvent(e,\"down\",RIGHT_CLICK);}return;}if(checkClick(e,MIDDLE_CLICK)){if(this.fireMiddleClick){this._handleEvent(e,\"down\",MIDDLE_CLICK);}return;}if(this.isDrawingMode){this._onMouseDownInDrawingMode(e);return;}if(!this._isMainEvent(e)){return;}// ignore if some object is being transformed at this moment\nif(this._currentTransform){return;}var pointer=this._pointer;// save pointer for check in __onMouseUp event\nthis._previousPointer=pointer;var shouldRender=this._shouldRender(target),shouldGroup=this._shouldGroup(e,target);if(this._shouldClearSelection(e,target)){this.discardActiveObject(e);}else if(shouldGroup){this._handleGrouping(e,target);target=this._activeObject;}if(this.selection&&(!target||!target.selectable&&!target.isEditing&&target!==this._activeObject)){this._groupSelector={ex:pointer.x,ey:pointer.y,top:0,left:0};}if(target){var alreadySelected=target===this._activeObject;if(target.selectable){this.setActiveObject(target,e);}var corner=target._findTargetCorner(this.getPointer(e,true),fabric.util.isTouchEvent(e));target.__corner=corner;if(target===this._activeObject&&(corner||!shouldGroup)){var control=target.controls[corner],mouseDownHandler=control&&control.getMouseDownHandler(e,target,control);if(mouseDownHandler){mouseDownHandler(e,target,control);}this._setupCurrentTransform(e,target,alreadySelected);}}this._handleEvent(e,\"down\");// we must renderAll so that we update the visuals\n(shouldRender||shouldGroup)&&this.requestRenderAll();},/**\n       * reset cache form common information needed during event processing\n       * @private\n       */_resetTransformEventData:function(){this._target=null;this._pointer=null;this._absolutePointer=null;},/**\n       * Cache common information needed during event processing\n       * @private\n       * @param {Event} e Event object fired on event\n       */_cacheTransformEventData:function(e){// reset in order to avoid stale caching\nthis._resetTransformEventData();this._pointer=this.getPointer(e,true);this._absolutePointer=this.restorePointerVpt(this._pointer);this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)||null;},/**\n       * @private\n       */_beforeTransform:function(e){var t=this._currentTransform;this.stateful&&t.target.saveState();this.fire(\"before:transform\",{e:e,transform:t});},/**\n       * Method that defines the actions when mouse is hovering the canvas.\n       * The currentTransform parameter will define whether the user is rotating/scaling/translating\n       * an image or neither of them (only hovering). A group selection is also possible and would cancel\n       * all any other type of action.\n       * In case of an image transformation only the top canvas will be rendered.\n       * @private\n       * @param {Event} e Event object fired on mousemove\n       */__onMouseMove:function(e){this._handleEvent(e,\"move:before\");this._cacheTransformEventData(e);var target,pointer;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(e);return;}if(!this._isMainEvent(e)){return;}var groupSelector=this._groupSelector;// We initially clicked in an empty area, so we draw a box for multiple selection\nif(groupSelector){pointer=this._pointer;groupSelector.left=pointer.x-groupSelector.ex;groupSelector.top=pointer.y-groupSelector.ey;this.renderTop();}else if(!this._currentTransform){target=this.findTarget(e)||null;this._setCursorFromEvent(e,target);this._fireOverOutEvents(target,e);}else{this._transformObject(e);}this._handleEvent(e,\"move\");this._resetTransformEventData();},/**\n       * Manage the mouseout, mouseover events for the fabric object on the canvas\n       * @param {Fabric.Object} target the target where the target from the mousemove event\n       * @param {Event} e Event object fired on mousemove\n       * @private\n       * adapted\n       */_fireOverOutEvents:function(target,e){var _hoveredTarget=this._hoveredTarget,_hoveredTargets=this._hoveredTargets,targets=this.targets,length=Math.max(_hoveredTargets.length,targets.length);this.fireSyntheticInOutEvents(target,e,{oldTarget:_hoveredTarget,evtOut:fabric.eventMapping.out,canvasEvtOut:\"mouse:out\",evtIn:\"mouseover\",canvasEvtIn:\"mouse:over\"});for(var i=0;i<length;i++){this.fireSyntheticInOutEvents(targets[i],e,{oldTarget:_hoveredTargets[i],evtOut:fabric.eventMapping.out,evtIn:\"mouseover\"});}this._hoveredTarget=target;this._hoveredTargets=this.targets.concat();},/**\n       * Manage the dragEnter, dragLeave events for the fabric objects on the canvas\n       * @param {Fabric.Object} target the target where the target from the onDrag event\n       * @param {Event} e Event object fired on ondrag\n       * @private\n       */_fireEnterLeaveEvents:function(target,e){var _draggedoverTarget=this._draggedoverTarget,_hoveredTargets=this._hoveredTargets,targets=this.targets,length=Math.max(_hoveredTargets.length,targets.length);this.fireSyntheticInOutEvents(target,e,{oldTarget:_draggedoverTarget,evtOut:\"dragleave\",evtIn:\"dragenter\"});for(var i=0;i<length;i++){this.fireSyntheticInOutEvents(targets[i],e,{oldTarget:_hoveredTargets[i],evtOut:\"dragleave\",evtIn:\"dragenter\"});}this._draggedoverTarget=target;},/**\n       * Manage the synthetic in/out events for the fabric objects on the canvas\n       * @param {Fabric.Object} target the target where the target from the supported events\n       * @param {Event} e Event object fired\n       * @param {Object} config configuration for the function to work\n       * @param {String} config.targetName property on the canvas where the old target is stored\n       * @param {String} [config.canvasEvtOut] name of the event to fire at canvas level for out\n       * @param {String} config.evtOut name of the event to fire for out\n       * @param {String} [config.canvasEvtIn] name of the event to fire at canvas level for in\n       * @param {String} config.evtIn name of the event to fire for in\n       * @private\n       */fireSyntheticInOutEvents:function(target,e,config){var inOpt,outOpt,oldTarget=config.oldTarget,outFires,inFires,targetChanged=oldTarget!==target,canvasEvtIn=config.canvasEvtIn,canvasEvtOut=config.canvasEvtOut;if(targetChanged){inOpt={e:e,target:target,previousTarget:oldTarget};outOpt={e:e,target:oldTarget,nextTarget:target};}inFires=target&&targetChanged;outFires=oldTarget&&targetChanged;if(outFires){canvasEvtOut&&this.fire(canvasEvtOut,outOpt);oldTarget.fire(config.evtOut,outOpt);}if(inFires){canvasEvtIn&&this.fire(canvasEvtIn,inOpt);target.fire(config.evtIn,inOpt);}},/**\n       * Method that defines actions when an Event Mouse Wheel\n       * @param {Event} e Event object fired on mouseup\n       */__onMouseWheel:function(e){this._cacheTransformEventData(e);this._handleEvent(e,\"wheel\");this._resetTransformEventData();},/**\n       * @private\n       * @param {Event} e Event fired on mousemove\n       */_transformObject:function(e){var pointer=this.getPointer(e),transform=this._currentTransform;transform.reset=false;transform.target.isMoving=true;transform.shiftKey=e.shiftKey;transform.altKey=e[this.centeredKey];this._performTransformAction(e,transform,pointer);transform.actionPerformed&&this.requestRenderAll();},/**\n       * @private\n       */_performTransformAction:function(e,transform,pointer){var x=pointer.x,y=pointer.y,action=transform.action,actionPerformed=false,actionHandler=transform.actionHandler,// this object could be created from the function in the control handlers\noptions={target:transform.target,e:e,transform:transform,pointer:pointer};if(action===\"drag\"){actionPerformed=this._translateObject(x,y);if(actionPerformed){this._fire(\"moving\",options);this.setCursor(options.target.moveCursor||this.moveCursor);}}else if(actionHandler){(actionPerformed=actionHandler(e,transform,x,y))&&this._fire(action,options);}transform.actionPerformed=transform.actionPerformed||actionPerformed;},/**\n       * @private\n       */_fire:fabric.controlsUtils.fireEvent,/**\n       * Sets the cursor depending on where the canvas is being hovered.\n       * Note: very buggy in Opera\n       * @param {Event} e Event object\n       * @param {Object} target Object that the mouse is hovering, if so.\n       */_setCursorFromEvent:function(e,target){if(!target){this.setCursor(this.defaultCursor);return false;}var hoverCursor=target.hoverCursor||this.hoverCursor,activeSelection=this._activeObject&&this._activeObject.type===\"activeSelection\"?this._activeObject:null,// only show proper corner when group selection is not active\ncorner=(!activeSelection||!activeSelection.contains(target))&&// here we call findTargetCorner always with undefined for the touch parameter.\n// we assume that if you are using a cursor you do not need to interact with\n// the bigger touch area.\ntarget._findTargetCorner(this.getPointer(e,true));if(!corner){if(target.subTargetCheck){// hoverCursor should come from top-most subTarget,\n// so we walk the array backwards\nthis.targets.concat().reverse().map(function(_target){hoverCursor=_target.hoverCursor||hoverCursor;});}this.setCursor(hoverCursor);}else{this.setCursor(this.getCornerCursor(corner,target,e));}},/**\n       * @private\n       */getCornerCursor:function(corner,target,e){var control=target.controls[corner];return control.cursorStyleHandler(e,control,target);}});})();(function(){var min=Math.min,max=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,/** @lends fabric.Canvas.prototype */{/**\n       * @private\n       * @param {Event} e Event object\n       * @param {fabric.Object} target\n       * @return {Boolean}\n       */_shouldGroup:function(e,target){var activeObject=this._activeObject;return activeObject&&this._isSelectionKeyPressed(e)&&target&&target.selectable&&this.selection&&(activeObject!==target||activeObject.type===\"activeSelection\")&&!target.onSelect({e:e});},/**\n       * @private\n       * @param {Event} e Event object\n       * @param {fabric.Object} target\n       */_handleGrouping:function(e,target){var activeObject=this._activeObject;// avoid multi select when shift click on a corner\nif(activeObject.__corner){return;}if(target===activeObject){// if it's a group, find target again, using activeGroup objects\ntarget=this.findTarget(e,true);// if even object is not found or we are on activeObjectCorner, bail out\nif(!target||!target.selectable){return;}}if(activeObject&&activeObject.type===\"activeSelection\"){this._updateActiveSelection(target,e);}else{this._createActiveSelection(target,e);}},/**\n       * @private\n       */_updateActiveSelection:function(target,e){var activeSelection=this._activeObject,currentActiveObjects=activeSelection._objects.slice(0);if(activeSelection.contains(target)){activeSelection.removeWithUpdate(target);this._hoveredTarget=target;this._hoveredTargets=this.targets.concat();if(activeSelection.size()===1){// activate last remaining object\nthis._setActiveObject(activeSelection.item(0),e);}}else{activeSelection.addWithUpdate(target);this._hoveredTarget=activeSelection;this._hoveredTargets=this.targets.concat();}this._fireSelectionEvents(currentActiveObjects,e);},/**\n       * @private\n       */_createActiveSelection:function(target,e){var currentActives=this.getActiveObjects(),group=this._createGroup(target);this._hoveredTarget=group;// ISSUE 4115: should we consider subTargets here?\n// this._hoveredTargets = [];\n// this._hoveredTargets = this.targets.concat();\nthis._setActiveObject(group,e);this._fireSelectionEvents(currentActives,e);},/**\n       * @private\n       * @param {Object} target\n       */_createGroup:function(target){var objects=this._objects,isActiveLower=objects.indexOf(this._activeObject)<objects.indexOf(target),groupObjects=isActiveLower?[this._activeObject,target]:[target,this._activeObject];this._activeObject.isEditing&&this._activeObject.exitEditing();return new fabric.ActiveSelection(groupObjects,{canvas:this});},/**\n       * @private\n       * @param {Event} e mouse event\n       */_groupSelectedObjects:function(e){var group=this._collectObjects(e),aGroup;// do not create group for 1 element only\nif(group.length===1){this.setActiveObject(group[0],e);}else if(group.length>1){aGroup=new fabric.ActiveSelection(group.reverse(),{canvas:this});this.setActiveObject(aGroup,e);}},/**\n       * @private\n       */_collectObjects:function(e){var group=[],currentObject,x1=this._groupSelector.ex,y1=this._groupSelector.ey,x2=x1+this._groupSelector.left,y2=y1+this._groupSelector.top,selectionX1Y1=new fabric.Point(min(x1,x2),min(y1,y2)),selectionX2Y2=new fabric.Point(max(x1,x2),max(y1,y2)),allowIntersect=!this.selectionFullyContained,isClick=x1===x2&&y1===y2;// we iterate reverse order to collect top first in case of click.\nfor(var i=this._objects.length;i--;){currentObject=this._objects[i];if(!currentObject||!currentObject.selectable||!currentObject.visible){continue;}if(allowIntersect&&currentObject.intersectsWithRect(selectionX1Y1,selectionX2Y2)||currentObject.isContainedWithinRect(selectionX1Y1,selectionX2Y2)||allowIntersect&&currentObject.containsPoint(selectionX1Y1)||allowIntersect&&currentObject.containsPoint(selectionX2Y2)){group.push(currentObject);// only add one object if it's a click\nif(isClick){break;}}}if(group.length>1){group=group.filter(function(object){return!object.onSelect({e:e});});}return group;},/**\n       * @private\n       */_maybeGroupObjects:function(e){if(this.selection&&this._groupSelector){this._groupSelectedObjects(e);}this.setCursor(this.defaultCursor);// clear selection and current transformation\nthis._groupSelector=null;}});})();(function(){fabric.util.object.extend(fabric.StaticCanvas.prototype,/** @lends fabric.StaticCanvas.prototype */{/**\n       * Exports canvas element to a dataurl image. Note that when multiplier is used, cropping is scaled appropriately\n       * @param {Object} [options] Options object\n       * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n       * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n       * @param {Number} [options.multiplier=1] Multiplier to scale by, to have consistent\n       * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n       * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n       * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n       * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n       * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 2.0.0\n       * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n       * @see {@link http://jsfiddle.net/fabricjs/NfZVb/|jsFiddle demo}\n       * @example <caption>Generate jpeg dataURL with lower quality</caption>\n       * var dataURL = canvas.toDataURL({\n       *   format: 'jpeg',\n       *   quality: 0.8\n       * });\n       * @example <caption>Generate cropped png dataURL (clipping of canvas)</caption>\n       * var dataURL = canvas.toDataURL({\n       *   format: 'png',\n       *   left: 100,\n       *   top: 100,\n       *   width: 200,\n       *   height: 200\n       * });\n       * @example <caption>Generate double scaled png dataURL</caption>\n       * var dataURL = canvas.toDataURL({\n       *   format: 'png',\n       *   multiplier: 2\n       * });\n       */toDataURL:function(options){options||(options={});var format=options.format||\"png\",quality=options.quality||1,multiplier=(options.multiplier||1)*(options.enableRetinaScaling?this.getRetinaScaling():1),canvasEl=this.toCanvasElement(multiplier,options);return fabric.util.toDataURL(canvasEl,format,quality);},/**\n       * Create a new HTMLCanvas element painted with the current canvas content.\n       * No need to resize the actual one or repaint it.\n       * Will transfer object ownership to a new canvas, paint it, and set everything back.\n       * This is an intermediary step used to get to a dataUrl but also it is useful to\n       * create quick image copies of a canvas without passing for the dataUrl string\n       * @param {Number} [multiplier] a zoom factor.\n       * @param {Object} [cropping] Cropping informations\n       * @param {Number} [cropping.left] Cropping left offset.\n       * @param {Number} [cropping.top] Cropping top offset.\n       * @param {Number} [cropping.width] Cropping width.\n       * @param {Number} [cropping.height] Cropping height.\n       */toCanvasElement:function(multiplier,cropping){multiplier=multiplier||1;cropping=cropping||{};var scaledWidth=(cropping.width||this.width)*multiplier,scaledHeight=(cropping.height||this.height)*multiplier,zoom=this.getZoom(),originalWidth=this.width,originalHeight=this.height,newZoom=zoom*multiplier,vp=this.viewportTransform,translateX=(vp[4]-(cropping.left||0))*multiplier,translateY=(vp[5]-(cropping.top||0))*multiplier,originalInteractive=this.interactive,newVp=[newZoom,0,0,newZoom,translateX,translateY],originalRetina=this.enableRetinaScaling,canvasEl=fabric.util.createCanvasElement(),originalContextTop=this.contextTop;canvasEl.width=scaledWidth;canvasEl.height=scaledHeight;this.contextTop=null;this.enableRetinaScaling=false;this.interactive=false;this.viewportTransform=newVp;this.width=scaledWidth;this.height=scaledHeight;this.calcViewportBoundaries();this.renderCanvas(canvasEl.getContext(\"2d\"),this._objects);this.viewportTransform=vp;this.width=originalWidth;this.height=originalHeight;this.calcViewportBoundaries();this.interactive=originalInteractive;this.enableRetinaScaling=originalRetina;this.contextTop=originalContextTop;return canvasEl;}});})();fabric.util.object.extend(fabric.StaticCanvas.prototype,/** @lends fabric.StaticCanvas.prototype */{/**\n     * Populates canvas with data from the specified JSON.\n     * JSON format must conform to the one of {@link fabric.Canvas#toJSON}\n     * @param {String|Object} json JSON string or object\n     * @param {Function} callback Callback, invoked when json is parsed\n     *                            and corresponding objects (e.g: {@link fabric.Image})\n     *                            are initialized\n     * @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#deserialization}\n     * @see {@link http://jsfiddle.net/fabricjs/fmgXt/|jsFiddle demo}\n     * @example <caption>loadFromJSON</caption>\n     * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas));\n     * @example <caption>loadFromJSON with reviver</caption>\n     * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas), function(o, object) {\n     *   // `o` = json object\n     *   // `object` = fabric.Object instance\n     *   // ... do some stuff ...\n     * });\n     */loadFromJSON:function(json,callback,reviver){if(!json){return;}// serialize if it wasn't already\nvar serialized=typeof json===\"string\"?JSON.parse(json):fabric.util.object.clone(json);var _this=this,clipPath=serialized.clipPath,renderOnAddRemove=this.renderOnAddRemove;this.renderOnAddRemove=false;delete serialized.clipPath;this._enlivenObjects(serialized.objects,function(enlivenedObjects){_this.clear();_this._setBgOverlay(serialized,function(){if(clipPath){_this._enlivenObjects([clipPath],function(enlivenedCanvasClip){_this.clipPath=enlivenedCanvasClip[0];_this.__setupCanvas.call(_this,serialized,enlivenedObjects,renderOnAddRemove,callback);});}else{_this.__setupCanvas.call(_this,serialized,enlivenedObjects,renderOnAddRemove,callback);}});},reviver);return this;},/**\n     * @private\n     * @param {Object} serialized Object with background and overlay information\n     * @param {Array} restored canvas objects\n     * @param {Function} cached renderOnAddRemove callback\n     * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n     */__setupCanvas:function(serialized,enlivenedObjects,renderOnAddRemove,callback){var _this=this;enlivenedObjects.forEach(function(obj,index){// we splice the array just in case some custom classes restored from JSON\n// will add more object to canvas at canvas init.\n_this.insertAt(obj,index);});this.renderOnAddRemove=renderOnAddRemove;// remove parts i cannot set as options\ndelete serialized.objects;delete serialized.backgroundImage;delete serialized.overlayImage;delete serialized.background;delete serialized.overlay;// this._initOptions does too many things to just\n// call it. Normally loading an Object from JSON\n// create the Object instance. Here the Canvas is\n// already an instance and we are just loading things over it\nthis._setOptions(serialized);this.renderAll();callback&&callback();},/**\n     * @private\n     * @param {Object} serialized Object with background and overlay information\n     * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n     */_setBgOverlay:function(serialized,callback){var loaded={backgroundColor:false,overlayColor:false,backgroundImage:false,overlayImage:false};if(!serialized.backgroundImage&&!serialized.overlayImage&&!serialized.background&&!serialized.overlay){callback&&callback();return;}var cbIfLoaded=function(){if(loaded.backgroundImage&&loaded.overlayImage&&loaded.backgroundColor&&loaded.overlayColor){callback&&callback();}};this.__setBgOverlay(\"backgroundImage\",serialized.backgroundImage,loaded,cbIfLoaded);this.__setBgOverlay(\"overlayImage\",serialized.overlayImage,loaded,cbIfLoaded);this.__setBgOverlay(\"backgroundColor\",serialized.background,loaded,cbIfLoaded);this.__setBgOverlay(\"overlayColor\",serialized.overlay,loaded,cbIfLoaded);},/**\n     * @private\n     * @param {String} property Property to set (backgroundImage, overlayImage, backgroundColor, overlayColor)\n     * @param {(Object|String)} value Value to set\n     * @param {Object} loaded Set loaded property to true if property is set\n     * @param {Object} callback Callback function to invoke after property is set\n     */__setBgOverlay:function(property,value,loaded,callback){var _this=this;if(!value){loaded[property]=true;callback&&callback();return;}if(property===\"backgroundImage\"||property===\"overlayImage\"){fabric.util.enlivenObjects([value],function(enlivedObject){_this[property]=enlivedObject[0];loaded[property]=true;callback&&callback();});}else{this[\"set\"+fabric.util.string.capitalize(property,true)](value,function(){loaded[property]=true;callback&&callback();});}},/**\n     * @private\n     * @param {Array} objects\n     * @param {Function} callback\n     * @param {Function} [reviver]\n     */_enlivenObjects:function(objects,callback,reviver){if(!objects||objects.length===0){callback&&callback([]);return;}fabric.util.enlivenObjects(objects,function(enlivenedObjects){callback&&callback(enlivenedObjects);},null,reviver);},/**\n     * @private\n     * @param {String} format\n     * @param {Function} callback\n     */_toDataURL:function(format,callback){this.clone(function(clone){callback(clone.toDataURL(format));});},/**\n     * @private\n     * @param {String} format\n     * @param {Number} multiplier\n     * @param {Function} callback\n     */_toDataURLWithMultiplier:function(format,multiplier,callback){this.clone(function(clone){callback(clone.toDataURLWithMultiplier(format,multiplier));});},/**\n     * Clones canvas instance\n     * @param {Object} [callback] Receives cloned instance as a first argument\n     * @param {Array} [properties] Array of properties to include in the cloned canvas and children\n     */clone:function(callback,properties){var data=JSON.stringify(this.toJSON(properties));this.cloneWithoutData(function(clone){clone.loadFromJSON(data,function(){callback&&callback(clone);});});},/**\n     * Clones canvas instance without cloning existing data.\n     * This essentially copies canvas dimensions, clipping properties, etc.\n     * but leaves data empty (so that you can populate it with your own)\n     * @param {Object} [callback] Receives cloned instance as a first argument\n     */cloneWithoutData:function(callback){var el=fabric.util.createCanvasElement();el.width=this.width;el.height=this.height;var clone=new fabric.Canvas(el);if(this.backgroundImage){clone.setBackgroundImage(this.backgroundImage.src,function(){clone.renderAll();callback&&callback(clone);});clone.backgroundImageOpacity=this.backgroundImageOpacity;clone.backgroundImageStretch=this.backgroundImageStretch;}else{callback&&callback(clone);}}});(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,capitalize=fabric.util.string.capitalize,degreesToRadians=fabric.util.degreesToRadians,supportsLineDash=fabric.StaticCanvas.supports(\"setLineDash\"),objectCaching=!fabric.isLikelyNode,ALIASING_LIMIT=2;if(fabric.Object){return;}/**\n   * Root object class from which all 2d shape classes inherit from\n   * @class fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#objects}\n   * @see {@link fabric.Object#initialize} for constructor definition\n   *\n   * @fires added\n   * @fires removed\n   *\n   * @fires selected\n   * @fires deselected\n   * @fires modified\n   * @fires modified\n   * @fires moved\n   * @fires scaled\n   * @fires rotated\n   * @fires skewed\n   *\n   * @fires rotating\n   * @fires scaling\n   * @fires moving\n   * @fires skewing\n   *\n   * @fires mousedown\n   * @fires mouseup\n   * @fires mouseover\n   * @fires mouseout\n   * @fires mousewheel\n   * @fires mousedblclick\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop\n   */fabric.Object=fabric.util.createClass(fabric.CommonMethods,/** @lends fabric.Object.prototype */{/**\n       * Type of an object (rect, circle, path, etc.).\n       * Note that this property is meant to be read-only and not meant to be modified.\n       * If you modify, certain parts of Fabric (such as JSON loading) won't work correctly.\n       * @type String\n       * @default\n       */type:\"object\",/**\n       * Horizontal origin of transformation of an object (one of \"left\", \"right\", \"center\")\n       * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n       * @type String\n       * @default\n       */originX:\"left\",/**\n       * Vertical origin of transformation of an object (one of \"top\", \"bottom\", \"center\")\n       * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n       * @type String\n       * @default\n       */originY:\"top\",/**\n       * Top position of an object. Note that by default it's relative to object top. You can change this by setting originY={top/center/bottom}\n       * @type Number\n       * @default\n       */top:0,/**\n       * Left position of an object. Note that by default it's relative to object left. You can change this by setting originX={left/center/right}\n       * @type Number\n       * @default\n       */left:0,/**\n       * Object width\n       * @type Number\n       * @default\n       */width:0,/**\n       * Object height\n       * @type Number\n       * @default\n       */height:0,/**\n       * Object scale factor (horizontal)\n       * @type Number\n       * @default\n       */scaleX:1,/**\n       * Object scale factor (vertical)\n       * @type Number\n       * @default\n       */scaleY:1,/**\n       * When true, an object is rendered as flipped horizontally\n       * @type Boolean\n       * @default\n       */flipX:false,/**\n       * When true, an object is rendered as flipped vertically\n       * @type Boolean\n       * @default\n       */flipY:false,/**\n       * Opacity of an object\n       * @type Number\n       * @default\n       */opacity:1,/**\n       * Angle of rotation of an object (in degrees)\n       * @type Number\n       * @default\n       */angle:0,/**\n       * Angle of skew on x axes of an object (in degrees)\n       * @type Number\n       * @default\n       */skewX:0,/**\n       * Angle of skew on y axes of an object (in degrees)\n       * @type Number\n       * @default\n       */skewY:0,/**\n       * Size of object's controlling corners (in pixels)\n       * @type Number\n       * @default\n       */cornerSize:13,/**\n       * Size of object's controlling corners when touch interaction is detected\n       * @type Number\n       * @default\n       */touchCornerSize:24,/**\n       * When true, object's controlling corners are rendered as transparent inside (i.e. stroke instead of fill)\n       * @type Boolean\n       * @default\n       */transparentCorners:true,/**\n       * Default cursor value used when hovering over this object on canvas\n       * @type String\n       * @default\n       */hoverCursor:null,/**\n       * Default cursor value used when moving this object on canvas\n       * @type String\n       * @default\n       */moveCursor:null,/**\n       * Padding between object and its controlling borders (in pixels)\n       * @type Number\n       * @default\n       */padding:0,/**\n       * Color of controlling borders of an object (when it's active)\n       * @type String\n       * @default\n       */borderColor:\"rgb(178,204,255)\",/**\n       * Array specifying dash pattern of an object's borders (hasBorder must be true)\n       * @since 1.6.2\n       * @type Array\n       */borderDashArray:null,/**\n       * Color of controlling corners of an object (when it's active)\n       * @type String\n       * @default\n       */cornerColor:\"rgb(178,204,255)\",/**\n       * Color of controlling corners of an object (when it's active and transparentCorners false)\n       * @since 1.6.2\n       * @type String\n       * @default\n       */cornerStrokeColor:null,/**\n       * Specify style of control, 'rect' or 'circle'\n       * @since 1.6.2\n       * @type String\n       */cornerStyle:\"rect\",/**\n       * Array specifying dash pattern of an object's control (hasBorder must be true)\n       * @since 1.6.2\n       * @type Array\n       */cornerDashArray:null,/**\n       * When true, this object will use center point as the origin of transformation\n       * when being scaled via the controls.\n       * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n       * @since 1.3.4\n       * @type Boolean\n       * @default\n       */centeredScaling:false,/**\n       * When true, this object will use center point as the origin of transformation\n       * when being rotated via the controls.\n       * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n       * @since 1.3.4\n       * @type Boolean\n       * @default\n       */centeredRotation:true,/**\n       * Color of object's fill\n       * takes css colors https://www.w3.org/TR/css-color-3/\n       * @type String\n       * @default\n       */fill:\"rgb(0,0,0)\",/**\n       * Fill rule used to fill an object\n       * accepted values are nonzero, evenodd\n       * <b>Backwards incompatibility note:</b> This property was used for setting globalCompositeOperation until v1.4.12 (use `fabric.Object#globalCompositeOperation` instead)\n       * @type String\n       * @default\n       */fillRule:\"nonzero\",/**\n       * Composite rule used for canvas globalCompositeOperation\n       * @type String\n       * @default\n       */globalCompositeOperation:\"source-over\",/**\n       * Background color of an object.\n       * takes css colors https://www.w3.org/TR/css-color-3/\n       * @type String\n       * @default\n       */backgroundColor:\"\",/**\n       * Selection Background color of an object. colored layer behind the object when it is active.\n       * does not mix good with globalCompositeOperation methods.\n       * @type String\n       * @default\n       */selectionBackgroundColor:\"\",/**\n       * When defined, an object is rendered via stroke and this property specifies its color\n       * takes css colors https://www.w3.org/TR/css-color-3/\n       * @type String\n       * @default\n       */stroke:null,/**\n       * Width of a stroke used to render this object\n       * @type Number\n       * @default\n       */strokeWidth:1,/**\n       * Array specifying dash pattern of an object's stroke (stroke must be defined)\n       * @type Array\n       */strokeDashArray:null,/**\n       * Line offset of an object's stroke\n       * @type Number\n       * @default\n       */strokeDashOffset:0,/**\n       * Line endings style of an object's stroke (one of \"butt\", \"round\", \"square\")\n       * @type String\n       * @default\n       */strokeLineCap:\"butt\",/**\n       * Corner style of an object's stroke (one of \"bevil\", \"round\", \"miter\")\n       * @type String\n       * @default\n       */strokeLineJoin:\"miter\",/**\n       * Maximum miter length (used for strokeLineJoin = \"miter\") of an object's stroke\n       * @type Number\n       * @default\n       */strokeMiterLimit:4,/**\n       * Shadow object representing shadow of this shape\n       * @type fabric.Shadow\n       * @default\n       */shadow:null,/**\n       * Opacity of object's controlling borders when object is active and moving\n       * @type Number\n       * @default\n       */borderOpacityWhenMoving:0.4,/**\n       * Scale factor of object's controlling borders\n       * bigger number will make a thicker border\n       * border is 1, so this is basically a border tickness\n       * since there is no way to change the border itself.\n       * @type Number\n       * @default\n       */borderScaleFactor:1,/**\n       * Minimum allowed scale value of an object\n       * @type Number\n       * @default\n       */minScaleLimit:0,/**\n       * When set to `false`, an object can not be selected for modification (using either point-click-based or group-based selection).\n       * But events still fire on it.\n       * @type Boolean\n       * @default\n       */selectable:true,/**\n       * When set to `false`, an object can not be a target of events. All events propagate through it. Introduced in v1.3.4\n       * @type Boolean\n       * @default\n       */evented:true,/**\n       * When set to `false`, an object is not rendered on canvas\n       * @type Boolean\n       * @default\n       */visible:true,/**\n       * When set to `false`, object's controls are not displayed and can not be used to manipulate object\n       * @type Boolean\n       * @default\n       */hasControls:true,/**\n       * When set to `false`, object's controlling borders are not rendered\n       * @type Boolean\n       * @default\n       */hasBorders:true,/**\n       * When set to `true`, objects are \"found\" on canvas on per-pixel basis rather than according to bounding box\n       * @type Boolean\n       * @default\n       */perPixelTargetFind:false,/**\n       * When `false`, default object's values are not included in its serialization\n       * @type Boolean\n       * @default\n       */includeDefaultValues:true,/**\n       * When `true`, object horizontal movement is locked\n       * @type Boolean\n       * @default\n       */lockMovementX:false,/**\n       * When `true`, object vertical movement is locked\n       * @type Boolean\n       * @default\n       */lockMovementY:false,/**\n       * When `true`, object rotation is locked\n       * @type Boolean\n       * @default\n       */lockRotation:false,/**\n       * When `true`, object horizontal scaling is locked\n       * @type Boolean\n       * @default\n       */lockScalingX:false,/**\n       * When `true`, object vertical scaling is locked\n       * @type Boolean\n       * @default\n       */lockScalingY:false,/**\n       * When `true`, object horizontal skewing is locked\n       * @type Boolean\n       * @default\n       */lockSkewingX:false,/**\n       * When `true`, object vertical skewing is locked\n       * @type Boolean\n       * @default\n       */lockSkewingY:false,/**\n       * When `true`, object cannot be flipped by scaling into negative values\n       * @type Boolean\n       * @default\n       */lockScalingFlip:false,/**\n       * When `true`, object is not exported in OBJECT/JSON\n       * @since 1.6.3\n       * @type Boolean\n       * @default\n       */excludeFromExport:false,/**\n       * When `true`, object is cached on an additional canvas.\n       * When `false`, object is not cached unless necessary ( clipPath )\n       * default to true\n       * @since 1.7.0\n       * @type Boolean\n       * @default true\n       */objectCaching:objectCaching,/**\n       * When `true`, object properties are checked for cache invalidation. In some particular\n       * situation you may want this to be disabled ( spray brush, very big, groups)\n       * or if your application does not allow you to modify properties for groups child you want\n       * to disable it for groups.\n       * default to false\n       * since 1.7.0\n       * @type Boolean\n       * @default false\n       */statefullCache:false,/**\n       * When `true`, cache does not get updated during scaling. The picture will get blocky if scaled\n       * too much and will be redrawn with correct details at the end of scaling.\n       * this setting is performance and application dependant.\n       * default to true\n       * since 1.7.0\n       * @type Boolean\n       * @default true\n       */noScaleCache:true,/**\n       * When `false`, the stoke width will scale with the object.\n       * When `true`, the stroke will always match the exact pixel size entered for stroke width.\n       * default to false\n       * @since 2.6.0\n       * @type Boolean\n       * @default false\n       * @type Boolean\n       * @default false\n       */strokeUniform:false,/**\n       * When set to `true`, object's cache will be rerendered next render call.\n       * since 1.7.0\n       * @type Boolean\n       * @default true\n       */dirty:true,/**\n       * keeps the value of the last hovered corner during mouse move.\n       * 0 is no corner, or 'mt', 'ml', 'mtr' etc..\n       * It should be private, but there is no harm in using it as\n       * a read-only property.\n       * @type number|string|any\n       * @default 0\n       */__corner:0,/**\n       * Determines if the fill or the stroke is drawn first (one of \"fill\" or \"stroke\")\n       * @type String\n       * @default\n       */paintFirst:\"fill\",/**\n       * List of properties to consider when checking if state\n       * of an object is changed (fabric.Object#hasStateChanged)\n       * as well as for history (undo/redo) purposes\n       * @type Array\n       */stateProperties:(\"top left width height scaleX scaleY flipX flipY originX originY transformMatrix \"+\"stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit \"+\"angle opacity fill globalCompositeOperation shadow visible backgroundColor \"+\"skewX skewY fillRule paintFirst clipPath strokeUniform\").split(\" \"),/**\n       * List of properties to consider when checking if cache needs refresh\n       * Those properties are checked by statefullCache ON ( or lazy mode if we want ) or from single\n       * calls to Object.set(key, value). If the key is in this list, the object is marked as dirty\n       * and refreshed at the next render\n       * @type Array\n       */cacheProperties:(\"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform\"+\" strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath\").split(\" \"),/**\n       * List of properties to consider for animating colors.\n       * @type Array\n       */colorProperties:\"fill stroke backgroundColor\".split(\" \"),/**\n       * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n       * the clipPath object gets used when the object has rendered, and the context is placed in the center\n       * of the object cacheCanvas.\n       * If you want 0,0 of a clipPath to align with an object center, use clipPath.originX/Y to 'center'\n       * @type fabric.Object\n       */clipPath:undefined,/**\n       * Meaningful ONLY when the object is used as clipPath.\n       * if true, the clipPath will make the object clip to the outside of the clipPath\n       * since 2.4.0\n       * @type boolean\n       * @default false\n       */inverted:false,/**\n       * Meaningful ONLY when the object is used as clipPath.\n       * if true, the clipPath will have its top and left relative to canvas, and will\n       * not be influenced by the object transform. This will make the clipPath relative\n       * to the canvas, but clipping just a particular object.\n       * WARNING this is beta, this feature may change or be renamed.\n       * since 2.4.0\n       * @type boolean\n       * @default false\n       */absolutePositioned:false,/**\n       * Constructor\n       * @param {Object} [options] Options object\n       */initialize:function(options){if(options){this.setOptions(options);}},/**\n       * Create a the canvas used to keep the cached copy of the object\n       * @private\n       */_createCacheCanvas:function(){this._cacheProperties={};this._cacheCanvas=fabric.util.createCanvasElement();this._cacheContext=this._cacheCanvas.getContext(\"2d\");this._updateCacheCanvas();// if canvas gets created, is empty, so dirty.\nthis.dirty=true;},/**\n       * Limit the cache dimensions so that X * Y do not cross fabric.perfLimitSizeTotal\n       * and each side do not cross fabric.cacheSideLimit\n       * those numbers are configurable so that you can get as much detail as you want\n       * making bargain with performances.\n       * @param {Object} dims\n       * @param {Object} dims.width width of canvas\n       * @param {Object} dims.height height of canvas\n       * @param {Object} dims.zoomX zoomX zoom value to unscale the canvas before drawing cache\n       * @param {Object} dims.zoomY zoomY zoom value to unscale the canvas before drawing cache\n       * @return {Object}.width width of canvas\n       * @return {Object}.height height of canvas\n       * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n       * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n       */_limitCacheSize:function(dims){var perfLimitSizeTotal=fabric.perfLimitSizeTotal,width=dims.width,height=dims.height,max=fabric.maxCacheSideLimit,min=fabric.minCacheSideLimit;if(width<=max&&height<=max&&width*height<=perfLimitSizeTotal){if(width<min){dims.width=min;}if(height<min){dims.height=min;}return dims;}var ar=width/height,limitedDims=fabric.util.limitDimsByArea(ar,perfLimitSizeTotal),capValue=fabric.util.capValue,x=capValue(min,limitedDims.x,max),y=capValue(min,limitedDims.y,max);if(width>x){dims.zoomX/=width/x;dims.width=x;dims.capped=true;}if(height>y){dims.zoomY/=height/y;dims.height=y;dims.capped=true;}return dims;},/**\n       * Return the dimension and the zoom level needed to create a cache canvas\n       * big enough to host the object to be cached.\n       * @private\n       * @return {Object}.x width of object to be cached\n       * @return {Object}.y height of object to be cached\n       * @return {Object}.width width of canvas\n       * @return {Object}.height height of canvas\n       * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n       * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n       */_getCacheCanvasDimensions:function(){var objectScale=this.getTotalObjectScaling(),// caculate dimensions without skewing\ndim=this._getTransformedDimensions(0,0),neededX=dim.x*objectScale.scaleX/this.scaleX,neededY=dim.y*objectScale.scaleY/this.scaleY;return{// for sure this ALIASING_LIMIT is slightly creating problem\n// in situation in which the cache canvas gets an upper limit\n// also objectScale contains already scaleX and scaleY\nwidth:neededX+ALIASING_LIMIT,height:neededY+ALIASING_LIMIT,zoomX:objectScale.scaleX,zoomY:objectScale.scaleY,x:neededX,y:neededY};},/**\n       * Update width and height of the canvas for cache\n       * returns true or false if canvas needed resize.\n       * @private\n       * @return {Boolean} true if the canvas has been resized\n       */_updateCacheCanvas:function(){var targetCanvas=this.canvas;if(this.noScaleCache&&targetCanvas&&targetCanvas._currentTransform){var target=targetCanvas._currentTransform.target,action=targetCanvas._currentTransform.action;if(this===target&&action.slice&&action.slice(0,5)===\"scale\"){return false;}}var canvas=this._cacheCanvas,dims=this._limitCacheSize(this._getCacheCanvasDimensions()),minCacheSize=fabric.minCacheSideLimit,width=dims.width,height=dims.height,drawingWidth,drawingHeight,zoomX=dims.zoomX,zoomY=dims.zoomY,dimensionsChanged=width!==this.cacheWidth||height!==this.cacheHeight,zoomChanged=this.zoomX!==zoomX||this.zoomY!==zoomY,shouldRedraw=dimensionsChanged||zoomChanged,additionalWidth=0,additionalHeight=0,shouldResizeCanvas=false;if(dimensionsChanged){var canvasWidth=this._cacheCanvas.width,canvasHeight=this._cacheCanvas.height,sizeGrowing=width>canvasWidth||height>canvasHeight,sizeShrinking=(width<canvasWidth*0.9||height<canvasHeight*0.9)&&canvasWidth>minCacheSize&&canvasHeight>minCacheSize;shouldResizeCanvas=sizeGrowing||sizeShrinking;if(sizeGrowing&&!dims.capped&&(width>minCacheSize||height>minCacheSize)){additionalWidth=width*0.1;additionalHeight=height*0.1;}}if(shouldRedraw){if(shouldResizeCanvas){canvas.width=Math.ceil(width+additionalWidth);canvas.height=Math.ceil(height+additionalHeight);}else{this._cacheContext.setTransform(1,0,0,1,0,0);this._cacheContext.clearRect(0,0,canvas.width,canvas.height);}drawingWidth=dims.x/2;drawingHeight=dims.y/2;this.cacheTranslationX=Math.round(canvas.width/2-drawingWidth)+drawingWidth;this.cacheTranslationY=Math.round(canvas.height/2-drawingHeight)+drawingHeight;this.cacheWidth=width;this.cacheHeight=height;this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY);this._cacheContext.scale(zoomX,zoomY);this.zoomX=zoomX;this.zoomY=zoomY;return true;}return false;},/**\n       * Sets object's properties from options\n       * @param {Object} [options] Options object\n       */setOptions:function(options){this._setOptions(options);this._initGradient(options.fill,\"fill\");this._initGradient(options.stroke,\"stroke\");this._initPattern(options.fill,\"fill\");this._initPattern(options.stroke,\"stroke\");},/**\n       * Transforms context when rendering an object\n       * @param {CanvasRenderingContext2D} ctx Context\n       */transform:function(ctx){var needFullTransform=this.group&&!this.group._transformDone||this.group&&this.canvas&&ctx===this.canvas.contextTop;var m=this.calcTransformMatrix(!needFullTransform);ctx.transform(m[0],m[1],m[2],m[3],m[4],m[5]);},/**\n       * Returns an object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} Object representation of an instance\n       */toObject:function(propertiesToInclude){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,object={type:this.type,version:fabric.version,originX:this.originX,originY:this.originY,left:toFixed(this.left,NUM_FRACTION_DIGITS),top:toFixed(this.top,NUM_FRACTION_DIGITS),width:toFixed(this.width,NUM_FRACTION_DIGITS),height:toFixed(this.height,NUM_FRACTION_DIGITS),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:toFixed(this.strokeWidth,NUM_FRACTION_DIGITS),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,// strokeUniform:            this.strokeUniform,\nstrokeMiterLimit:toFixed(this.strokeMiterLimit,NUM_FRACTION_DIGITS),scaleX:toFixed(this.scaleX,NUM_FRACTION_DIGITS),scaleY:toFixed(this.scaleY,NUM_FRACTION_DIGITS),angle:toFixed(this.angle,NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:toFixed(this.opacity,NUM_FRACTION_DIGITS),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:toFixed(this.skewX,NUM_FRACTION_DIGITS),skewY:toFixed(this.skewY,NUM_FRACTION_DIGITS)};if(this.clipPath){object.clipPath=this.clipPath.toObject(propertiesToInclude);object.clipPath.inverted=this.clipPath.inverted;object.clipPath.absolutePositioned=this.clipPath.absolutePositioned;}fabric.util.populateWithProperties(this,object,propertiesToInclude);if(!this.includeDefaultValues){object=this._removeDefaultValues(object);}return object;},/**\n       * Returns (dataless) object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} Object representation of an instance\n       */toDatalessObject:function(propertiesToInclude){// will be overwritten by subclasses\nreturn this.toObject(propertiesToInclude);},/**\n       * @private\n       * @param {Object} object\n       */_removeDefaultValues:function(object){var prototype=fabric.util.getKlass(object.type).prototype,stateProperties=prototype.stateProperties;stateProperties.forEach(function(prop){if(prop===\"left\"||prop===\"top\"){return;}if(object[prop]===prototype[prop]){delete object[prop];}var isArray=Object.prototype.toString.call(object[prop])===\"[object Array]\"&&Object.prototype.toString.call(prototype[prop])===\"[object Array]\";// basically a check for [] === []\nif(isArray&&object[prop].length===0&&prototype[prop].length===0){delete object[prop];}});return object;},/**\n       * Returns a string representation of an instance\n       * @return {String}\n       */toString:function(){return\"#<fabric.\"+capitalize(this.type)+\">\";},/**\n       * Return the object scale factor counting also the group scaling\n       * @return {Object} object with scaleX and scaleY properties\n       */getObjectScaling:function(){var options=fabric.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(options.scaleX),scaleY:Math.abs(options.scaleY)};},/**\n       * Return the object scale factor counting also the group scaling, zoom and retina\n       * @return {Object} object with scaleX and scaleY properties\n       */getTotalObjectScaling:function(){var scale=this.getObjectScaling(),scaleX=scale.scaleX,scaleY=scale.scaleY;if(this.canvas){var zoom=this.canvas.getZoom();var retina=this.canvas.getRetinaScaling();scaleX*=zoom*retina;scaleY*=zoom*retina;}return{scaleX:scaleX,scaleY:scaleY};},/**\n       * Return the object opacity counting also the group property\n       * @return {Number}\n       */getObjectOpacity:function(){var opacity=this.opacity;if(this.group){opacity*=this.group.getObjectOpacity();}return opacity;},/**\n       * @private\n       * @param {String} key\n       * @param {*} value\n       * @return {fabric.Object} thisArg\n       */_set:function(key,value){var shouldConstrainValue=key===\"scaleX\"||key===\"scaleY\",isChanged=this[key]!==value,groupNeedsUpdate=false;if(shouldConstrainValue){value=this._constrainScale(value);}if(key===\"scaleX\"&&value<0){this.flipX=!this.flipX;value*=-1;}else if(key===\"scaleY\"&&value<0){this.flipY=!this.flipY;value*=-1;}else if(key===\"shadow\"&&value&&!(value instanceof fabric.Shadow)){value=new fabric.Shadow(value);}else if(key===\"dirty\"&&this.group){this.group.set(\"dirty\",value);}this[key]=value;if(isChanged){groupNeedsUpdate=this.group&&this.group.isOnACache();if(this.cacheProperties.indexOf(key)>-1){this.dirty=true;groupNeedsUpdate&&this.group.set(\"dirty\",true);}else if(groupNeedsUpdate&&this.stateProperties.indexOf(key)>-1){this.group.set(\"dirty\",true);}}return this;},/**\n       * This callback function is called by the parent group of an object every\n       * time a non-delegated property changes on the group. It is passed the key\n       * and value as parameters. Not adding in this function's signature to avoid\n       * Travis build error about unused variables.\n       */setOnGroup:function(){// implemented by sub-classes, as needed.\n},/**\n       * Retrieves viewportTransform from Object's canvas if possible\n       * @method getViewportTransform\n       * @memberOf fabric.Object.prototype\n       * @return {Array}\n       */getViewportTransform:function(){if(this.canvas&&this.canvas.viewportTransform){return this.canvas.viewportTransform;}return fabric.iMatrix.concat();},/*\n       * @private\n       * return if the object would be visible in rendering\n       * @memberOf fabric.Object.prototype\n       * @return {Boolean}\n       */isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible;},/**\n       * Renders an object on a specified context\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */render:function(ctx){// do not render if width/height are zeros or object is not visible\nif(this.isNotVisible()){return;}if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()){return;}ctx.save();this._setupCompositeOperation(ctx);this.drawSelectionBackground(ctx);this.transform(ctx);this._setOpacity(ctx);this._setShadow(ctx,this);if(this.shouldCache()){this.renderCache();this.drawCacheOnCanvas(ctx);}else{this._removeCacheCanvas();this.dirty=false;this.drawObject(ctx);if(this.objectCaching&&this.statefullCache){this.saveState({propertySet:\"cacheProperties\"});}}ctx.restore();},renderCache:function(options){options=options||{};if(!this._cacheCanvas){this._createCacheCanvas();}if(this.isCacheDirty()){this.statefullCache&&this.saveState({propertySet:\"cacheProperties\"});this.drawObject(this._cacheContext,options.forClipping);this.dirty=false;}},/**\n       * Remove cacheCanvas and its dimensions from the objects\n       */_removeCacheCanvas:function(){this._cacheCanvas=null;this.cacheWidth=0;this.cacheHeight=0;},/**\n       * return true if the object will draw a stroke\n       * Does not consider text styles. This is just a shortcut used at rendering time\n       * We want it to be an aproximation and be fast.\n       * wrote to avoid extra caching, it has to return true when stroke happens,\n       * can guess when it will not happen at 100% chance, does not matter if it misses\n       * some use case where the stroke is invisible.\n       * @since 3.0.0\n       * @returns Boolean\n       */hasStroke:function(){return this.stroke&&this.stroke!==\"transparent\"&&this.strokeWidth!==0;},/**\n       * return true if the object will draw a fill\n       * Does not consider text styles. This is just a shortcut used at rendering time\n       * We want it to be an aproximation and be fast.\n       * wrote to avoid extra caching, it has to return true when fill happens,\n       * can guess when it will not happen at 100% chance, does not matter if it misses\n       * some use case where the fill is invisible.\n       * @since 3.0.0\n       * @returns Boolean\n       */hasFill:function(){return this.fill&&this.fill!==\"transparent\";},/**\n       * When set to `true`, force the object to have its own cache, even if it is inside a group\n       * it may be needed when your object behave in a particular way on the cache and always needs\n       * its own isolated canvas to render correctly.\n       * Created to be overridden\n       * since 1.7.12\n       * @returns Boolean\n       */needsItsOwnCache:function(){if(this.paintFirst===\"stroke\"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow===\"object\"){return true;}if(this.clipPath){return true;}return false;},/**\n       * Decide if the object should cache or not. Create its own cache level\n       * objectCaching is a global flag, wins over everything\n       * needsItsOwnCache should be used when the object drawing method requires\n       * a cache step. None of the fabric classes requires it.\n       * Generally you do not cache objects in groups because the group outside is cached.\n       * Read as: cache if is needed, or if the feature is enabled but we are not already caching.\n       * @return {Boolean}\n       */shouldCache:function(){this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache());return this.ownCaching;},/**\n       * Check if this object or a child object will cast a shadow\n       * used by Group.shouldCache to know if child has a shadow recursively\n       * @return {Boolean}\n       */willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0);},/**\n       * Execute the drawing operation for an object clipPath\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */drawClipPathOnCache:function(ctx){var path=this.clipPath;ctx.save();// DEBUG: uncomment this line, comment the following\n// ctx.globalAlpha = 0.4\nif(path.inverted){ctx.globalCompositeOperation=\"destination-out\";}else{ctx.globalCompositeOperation=\"destination-in\";}//ctx.scale(1 / 2, 1 / 2);\nif(path.absolutePositioned){var m=fabric.util.invertTransform(this.calcTransformMatrix());ctx.transform(m[0],m[1],m[2],m[3],m[4],m[5]);}path.transform(ctx);ctx.scale(1/path.zoomX,1/path.zoomY);ctx.drawImage(path._cacheCanvas,-path.cacheTranslationX,-path.cacheTranslationY);ctx.restore();},/**\n       * Execute the drawing operation for an object on a specified context\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */drawObject:function(ctx,forClipping){var originalFill=this.fill,originalStroke=this.stroke;if(forClipping){this.fill=\"black\";this.stroke=\"\";this._setClippingProperties(ctx);}else{this._renderBackground(ctx);this._setStrokeStyles(ctx,this);this._setFillStyles(ctx,this);}this._render(ctx);this._drawClipPath(ctx);this.fill=originalFill;this.stroke=originalStroke;},_drawClipPath:function(ctx){var path=this.clipPath;if(!path){return;}// needed to setup a couple of variables\n// path canvas gets overridden with this one.\n// TODO find a better solution?\npath.canvas=this.canvas;path.shouldCache();path._transformDone=true;path.renderCache({forClipping:true});this.drawClipPathOnCache(ctx);},/**\n       * Paint the cached copy of the object on the target context.\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */drawCacheOnCanvas:function(ctx){ctx.scale(1/this.zoomX,1/this.zoomY);ctx.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY);},/**\n       * Check if cache is dirty\n       * @param {Boolean} skipCanvas skip canvas checks because this object is painted\n       * on parent canvas.\n       */isCacheDirty:function(skipCanvas){if(this.isNotVisible()){return false;}if(this._cacheCanvas&&!skipCanvas&&this._updateCacheCanvas()){// in this case the context is already cleared.\nreturn true;}else{if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged(\"cacheProperties\")){if(this._cacheCanvas&&!skipCanvas){var width=this.cacheWidth/this.zoomX;var height=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-width/2,-height/2,width,height);}return true;}}return false;},/**\n       * Draws a background for the object big as its untransformed dimensions\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderBackground:function(ctx){if(!this.backgroundColor){return;}var dim=this._getNonTransformedDimensions();ctx.fillStyle=this.backgroundColor;ctx.fillRect(-dim.x/2,-dim.y/2,dim.x,dim.y);// if there is background color no other shadows\n// should be casted\nthis._removeShadow(ctx);},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_setOpacity:function(ctx){if(this.group&&!this.group._transformDone){ctx.globalAlpha=this.getObjectOpacity();}else{ctx.globalAlpha*=this.opacity;}},_setStrokeStyles:function(ctx,decl){if(decl.stroke){ctx.lineWidth=decl.strokeWidth;ctx.lineCap=decl.strokeLineCap;ctx.lineDashOffset=decl.strokeDashOffset;ctx.lineJoin=decl.strokeLineJoin;ctx.miterLimit=decl.strokeMiterLimit;ctx.strokeStyle=decl.stroke.toLive?decl.stroke.toLive(ctx,this):decl.stroke;}},_setFillStyles:function(ctx,decl){if(decl.fill){ctx.fillStyle=decl.fill.toLive?decl.fill.toLive(ctx,this):decl.fill;}},_setClippingProperties:function(ctx){ctx.globalAlpha=1;ctx.strokeStyle=\"transparent\";ctx.fillStyle=\"#000000\";},/**\n       * @private\n       * Sets line dash\n       * @param {CanvasRenderingContext2D} ctx Context to set the dash line on\n       * @param {Array} dashArray array representing dashes\n       * @param {Function} alternative function to call if browser does not support lineDash\n       */_setLineDash:function(ctx,dashArray,alternative){if(!dashArray||dashArray.length===0){return;}// Spec requires the concatenation of two copies the dash list when the number of elements is odd\nif(1&dashArray.length){dashArray.push.apply(dashArray,dashArray);}if(supportsLineDash){ctx.setLineDash(dashArray);}else{alternative&&alternative(ctx);}},/**\n       * Renders controls and borders for the object\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {Object} [styleOverride] properties to override the object style\n       */_renderControls:function(ctx,styleOverride){var vpt=this.getViewportTransform(),matrix=this.calcTransformMatrix(),options,drawBorders,drawControls;styleOverride=styleOverride||{};drawBorders=typeof styleOverride.hasBorders!==\"undefined\"?styleOverride.hasBorders:this.hasBorders;drawControls=typeof styleOverride.hasControls!==\"undefined\"?styleOverride.hasControls:this.hasControls;matrix=fabric.util.multiplyTransformMatrices(vpt,matrix);options=fabric.util.qrDecompose(matrix);ctx.save();ctx.translate(options.translateX,options.translateY);ctx.lineWidth=1*this.borderScaleFactor;if(!this.group){ctx.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;}if(styleOverride.forActiveSelection){ctx.rotate(degreesToRadians(options.angle));drawBorders&&this.drawBordersInGroup(ctx,options,styleOverride);}else{ctx.rotate(degreesToRadians(this.angle));drawBorders&&this.drawBorders(ctx,styleOverride);}drawControls&&this.drawControls(ctx,styleOverride);ctx.restore();},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_setShadow:function(ctx){if(!this.shadow){return;}var shadow=this.shadow,canvas=this.canvas,scaling,multX=canvas&&canvas.viewportTransform[0]||1,multY=canvas&&canvas.viewportTransform[3]||1;if(shadow.nonScaling){scaling={scaleX:1,scaleY:1};}else{scaling=this.getObjectScaling();}if(canvas&&canvas._isRetinaScaling()){multX*=fabric.devicePixelRatio;multY*=fabric.devicePixelRatio;}ctx.shadowColor=shadow.color;ctx.shadowBlur=shadow.blur*fabric.browserShadowBlurConstant*(multX+multY)*(scaling.scaleX+scaling.scaleY)/4;ctx.shadowOffsetX=shadow.offsetX*multX*scaling.scaleX;ctx.shadowOffsetY=shadow.offsetY*multY*scaling.scaleY;},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_removeShadow:function(ctx){if(!this.shadow){return;}ctx.shadowColor=\"\";ctx.shadowBlur=ctx.shadowOffsetX=ctx.shadowOffsetY=0;},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {Object} filler fabric.Pattern or fabric.Gradient\n       * @return {Object} offset.offsetX offset for text rendering\n       * @return {Object} offset.offsetY offset for text rendering\n       */_applyPatternGradientTransform:function(ctx,filler){if(!filler||!filler.toLive){return{offsetX:0,offsetY:0};}var t=filler.gradientTransform||filler.patternTransform;var offsetX=-this.width/2+filler.offsetX||0,offsetY=-this.height/2+filler.offsetY||0;if(filler.gradientUnits===\"percentage\"){ctx.transform(this.width,0,0,this.height,offsetX,offsetY);}else{ctx.transform(1,0,0,1,offsetX,offsetY);}if(t){ctx.transform(t[0],t[1],t[2],t[3],t[4],t[5]);}return{offsetX:offsetX,offsetY:offsetY};},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderPaintInOrder:function(ctx){if(this.paintFirst===\"stroke\"){this._renderStroke(ctx);this._renderFill(ctx);}else{this._renderFill(ctx);this._renderStroke(ctx);}},/**\n       * @private\n       * function that actually render something on the context.\n       * empty here to allow Obects to work on tests to benchmark fabric functionalites\n       * not related to rendering\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_render:function/* ctx */(){},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderFill:function(ctx){if(!this.fill){return;}ctx.save();this._applyPatternGradientTransform(ctx,this.fill);if(this.fillRule===\"evenodd\"){ctx.fill(\"evenodd\");}else{ctx.fill();}ctx.restore();},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderStroke:function(ctx){if(!this.stroke||this.strokeWidth===0){return;}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(ctx);}ctx.save();if(this.strokeUniform&&this.group){var scaling=this.getObjectScaling();ctx.scale(1/scaling.scaleX,1/scaling.scaleY);}else if(this.strokeUniform){ctx.scale(1/this.scaleX,1/this.scaleY);}this._setLineDash(ctx,this.strokeDashArray,this._renderDashedStroke);if(this.stroke.toLive&&this.stroke.gradientUnits===\"percentage\"){// need to transform gradient in a pattern.\n// this is a slow process. If you are hitting this codepath, and the object\n// is not using caching, you should consider switching it on.\n// we need a canvas as big as the current object caching canvas.\nthis._applyPatternForTransformedGradient(ctx,this.stroke);}else{this._applyPatternGradientTransform(ctx,this.stroke);}ctx.stroke();ctx.restore();},/**\n       * This function try to patch the missing gradientTransform on canvas gradients.\n       * transforming a context to transform the gradient, is going to transform the stroke too.\n       * we want to transform the gradient but not the stroke operation, so we create\n       * a transformed gradient on a pattern and then we use the pattern instead of the gradient.\n       * this method has drwabacks: is slow, is in low resolution, needs a patch for when the size\n       * is limited.\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {fabric.Gradient} filler a fabric gradient instance\n       */_applyPatternForTransformedGradient:function(ctx,filler){var dims=this._limitCacheSize(this._getCacheCanvasDimensions()),pCanvas=fabric.util.createCanvasElement(),pCtx,retinaScaling=this.canvas.getRetinaScaling(),width=dims.x/this.scaleX/retinaScaling,height=dims.y/this.scaleY/retinaScaling;pCanvas.width=width;pCanvas.height=height;pCtx=pCanvas.getContext(\"2d\");pCtx.beginPath();pCtx.moveTo(0,0);pCtx.lineTo(width,0);pCtx.lineTo(width,height);pCtx.lineTo(0,height);pCtx.closePath();pCtx.translate(width/2,height/2);pCtx.scale(dims.zoomX/this.scaleX/retinaScaling,dims.zoomY/this.scaleY/retinaScaling);this._applyPatternGradientTransform(pCtx,filler);pCtx.fillStyle=filler.toLive(ctx);pCtx.fill();ctx.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2);ctx.scale(retinaScaling*this.scaleX/dims.zoomX,retinaScaling*this.scaleY/dims.zoomY);ctx.strokeStyle=pCtx.createPattern(pCanvas,\"no-repeat\");},/**\n       * This function is an helper for svg import. it returns the center of the object in the svg\n       * untransformed coordinates\n       * @private\n       * @return {Object} center point from element coordinates\n       */_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2};},/**\n       * This function is an helper for svg import. it decompose the transformMatrix\n       * and assign properties to object.\n       * untransformed coordinates\n       * @private\n       * @chainable\n       */_assignTransformMatrixProps:function(){if(this.transformMatrix){var options=fabric.util.qrDecompose(this.transformMatrix);this.flipX=false;this.flipY=false;this.set(\"scaleX\",options.scaleX);this.set(\"scaleY\",options.scaleY);this.angle=options.angle;this.skewX=options.skewX;this.skewY=0;}},/**\n       * This function is an helper for svg import. it removes the transform matrix\n       * and set to object properties that fabricjs can handle\n       * @private\n       * @param {Object} preserveAspectRatioOptions\n       * @return {thisArg}\n       */_removeTransformMatrix:function(preserveAspectRatioOptions){var center=this._findCenterFromElement();if(this.transformMatrix){this._assignTransformMatrixProps();center=fabric.util.transformPoint(center,this.transformMatrix);}this.transformMatrix=null;if(preserveAspectRatioOptions){this.scaleX*=preserveAspectRatioOptions.scaleX;this.scaleY*=preserveAspectRatioOptions.scaleY;this.cropX=preserveAspectRatioOptions.cropX;this.cropY=preserveAspectRatioOptions.cropY;center.x+=preserveAspectRatioOptions.offsetLeft;center.y+=preserveAspectRatioOptions.offsetTop;this.width=preserveAspectRatioOptions.width;this.height=preserveAspectRatioOptions.height;}this.setPositionByOrigin(center,\"center\",\"center\");},/**\n       * Clones an instance, using a callback method will work for every object.\n       * @param {Function} callback Callback is invoked with a clone as a first argument\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       */clone:function(callback,propertiesToInclude){var objectForm=this.toObject(propertiesToInclude);if(this.constructor.fromObject){this.constructor.fromObject(objectForm,callback);}else{fabric.Object._fromObject(\"Object\",objectForm,callback);}},/**\n       * Creates an instance of fabric.Image out of an object\n       * could make use of both toDataUrl or toCanvasElement.\n       * @param {Function} callback callback, invoked with an instance as a first argument\n       * @param {Object} [options] for clone as image, passed to toDataURL\n       * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n       * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n       * @param {Number} [options.multiplier=1] Multiplier to scale by\n       * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n       * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n       * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n       * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n       * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n       * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n       * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n       * @return {fabric.Object} thisArg\n       */cloneAsImage:function(callback,options){var canvasEl=this.toCanvasElement(options);if(callback){callback(new fabric.Image(canvasEl));}return this;},/**\n       * Converts an object into a HTMLCanvas element\n       * @param {Object} options Options object\n       * @param {Number} [options.multiplier=1] Multiplier to scale by\n       * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n       * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n       * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n       * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n       * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n       * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n       * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n       * @return {HTMLCanvasElement} Returns DOM element <canvas> with the fabric.Object\n       */toCanvasElement:function(options){options||(options={});var utils=fabric.util,origParams=utils.saveObjectTransform(this),originalGroup=this.group,originalShadow=this.shadow,abs=Math.abs,multiplier=(options.multiplier||1)*(options.enableRetinaScaling?fabric.devicePixelRatio:1);delete this.group;if(options.withoutTransform){utils.resetObjectTransform(this);}if(options.withoutShadow){this.shadow=null;}var el=fabric.util.createCanvasElement(),// skip canvas zoom and calculate with setCoords now.\nboundingRect=this.getBoundingRect(true,true),shadow=this.shadow,scaling,shadowOffset={x:0,y:0},shadowBlur,width,height;if(shadow){shadowBlur=shadow.blur;if(shadow.nonScaling){scaling={scaleX:1,scaleY:1};}else{scaling=this.getObjectScaling();}// consider non scaling shadow.\nshadowOffset.x=2*Math.round(abs(shadow.offsetX)+shadowBlur)*abs(scaling.scaleX);shadowOffset.y=2*Math.round(abs(shadow.offsetY)+shadowBlur)*abs(scaling.scaleY);}width=boundingRect.width+shadowOffset.x;height=boundingRect.height+shadowOffset.y;// if the current width/height is not an integer\n// we need to make it so.\nel.width=Math.ceil(width);el.height=Math.ceil(height);var canvas=new fabric.StaticCanvas(el,{enableRetinaScaling:false,renderOnAddRemove:false,skipOffscreen:false});if(options.format===\"jpeg\"){canvas.backgroundColor=\"#fff\";}this.setPositionByOrigin(new fabric.Point(canvas.width/2,canvas.height/2),\"center\",\"center\");var originalCanvas=this.canvas;canvas.add(this);var canvasEl=canvas.toCanvasElement(multiplier||1,options);this.shadow=originalShadow;this.set(\"canvas\",originalCanvas);if(originalGroup){this.group=originalGroup;}this.set(origParams).setCoords();// canvas.dispose will call image.dispose that will nullify the elements\n// since this canvas is a simple element for the process, we remove references\n// to objects in this way in order to avoid object trashing.\ncanvas._objects=[];canvas.dispose();canvas=null;return canvasEl;},/**\n       * Converts an object into a data-url-like string\n       * @param {Object} options Options object\n       * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n       * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n       * @param {Number} [options.multiplier=1] Multiplier to scale by\n       * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n       * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n       * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n       * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n       * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n       * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n       * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n       * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n       */toDataURL:function(options){options||(options={});return fabric.util.toDataURL(this.toCanvasElement(options),options.format||\"png\",options.quality||1);},/**\n       * Returns true if specified type is identical to the type of an instance\n       * @param {String} type Type to check against\n       * @return {Boolean}\n       */isType:function(type){return this.type===type;},/**\n       * Returns complexity of an instance\n       * @return {Number} complexity of this instance (is 1 unless subclassed)\n       */complexity:function(){return 1;},/**\n       * Returns a JSON representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} JSON\n       */toJSON:function(propertiesToInclude){// delegate, not alias\nreturn this.toObject(propertiesToInclude);},/**\n       * Sets \"angle\" of an instance with centered rotation\n       * @param {Number} angle Angle value (in degrees)\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */rotate:function(angle){var shouldCenterOrigin=(this.originX!==\"center\"||this.originY!==\"center\")&&this.centeredRotation;if(shouldCenterOrigin){this._setOriginToCenter();}this.set(\"angle\",angle);if(shouldCenterOrigin){this._resetOrigin();}return this;},/**\n       * Centers object horizontally on canvas to which it was added last.\n       * You might need to call `setCoords` on an object after centering, to update controls area.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */centerH:function(){this.canvas&&this.canvas.centerObjectH(this);return this;},/**\n       * Centers object horizontally on current viewport of canvas to which it was added last.\n       * You might need to call `setCoords` on an object after centering, to update controls area.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */viewportCenterH:function(){this.canvas&&this.canvas.viewportCenterObjectH(this);return this;},/**\n       * Centers object vertically on canvas to which it was added last.\n       * You might need to call `setCoords` on an object after centering, to update controls area.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */centerV:function(){this.canvas&&this.canvas.centerObjectV(this);return this;},/**\n       * Centers object vertically on current viewport of canvas to which it was added last.\n       * You might need to call `setCoords` on an object after centering, to update controls area.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */viewportCenterV:function(){this.canvas&&this.canvas.viewportCenterObjectV(this);return this;},/**\n       * Centers object vertically and horizontally on canvas to which is was added last\n       * You might need to call `setCoords` on an object after centering, to update controls area.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */center:function(){this.canvas&&this.canvas.centerObject(this);return this;},/**\n       * Centers object on current viewport of canvas to which it was added last.\n       * You might need to call `setCoords` on an object after centering, to update controls area.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */viewportCenter:function(){this.canvas&&this.canvas.viewportCenterObject(this);return this;},/**\n       * Returns coordinates of a pointer relative to an object\n       * @param {Event} e Event to operate upon\n       * @param {Object} [pointer] Pointer to operate upon (instead of event)\n       * @return {Object} Coordinates of a pointer (x, y)\n       */getLocalPointer:function(e,pointer){pointer=pointer||this.canvas.getPointer(e);var pClicked=new fabric.Point(pointer.x,pointer.y),objectLeftTop=this._getLeftTopCoords();if(this.angle){pClicked=fabric.util.rotatePoint(pClicked,objectLeftTop,degreesToRadians(-this.angle));}return{x:pClicked.x-objectLeftTop.x,y:pClicked.y-objectLeftTop.y};},/**\n       * Sets canvas globalCompositeOperation for specific object\n       * custom composition operation for the particular object can be specified using globalCompositeOperation property\n       * @param {CanvasRenderingContext2D} ctx Rendering canvas context\n       */_setupCompositeOperation:function(ctx){if(this.globalCompositeOperation){ctx.globalCompositeOperation=this.globalCompositeOperation;}}});fabric.util.createAccessors&&fabric.util.createAccessors(fabric.Object);extend(fabric.Object.prototype,fabric.Observable);/**\n   * Defines the number of fraction digits to use when serializing object values.\n   * You can use it to increase/decrease precision of such values like left, top, scaleX, scaleY, etc.\n   * @static\n   * @memberOf fabric.Object\n   * @constant\n   * @type Number\n   */fabric.Object.NUM_FRACTION_DIGITS=2;fabric.Object._fromObject=function(className,object,callback,extraParam){var klass=fabric[className];object=clone(object,true);fabric.util.enlivenPatterns([object.fill,object.stroke],function(patterns){if(typeof patterns[0]!==\"undefined\"){object.fill=patterns[0];}if(typeof patterns[1]!==\"undefined\"){object.stroke=patterns[1];}fabric.util.enlivenObjects([object.clipPath],function(enlivedProps){object.clipPath=enlivedProps[0];var instance=extraParam?new klass(object[extraParam],object):new klass(object);callback&&callback(instance);});});};/**\n   * Unique id used internally when creating SVG elements\n   * @static\n   * @memberOf fabric.Object\n   * @type Number\n   */fabric.Object.__uid=0;})(typeof exports!==\"undefined\"?exports:this);(function(){var degreesToRadians=fabric.util.degreesToRadians,originXOffset={left:-0.5,center:0,right:0.5},originYOffset={top:-0.5,center:0,bottom:0.5};fabric.util.object.extend(fabric.Object.prototype,/** @lends fabric.Object.prototype */{/**\n       * Translates the coordinates from a set of origin to another (based on the object's dimensions)\n       * @param {fabric.Point} point The point which corresponds to the originX and originY params\n       * @param {String} fromOriginX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} fromOriginY Vertical origin: 'top', 'center' or 'bottom'\n       * @param {String} toOriginX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} toOriginY Vertical origin: 'top', 'center' or 'bottom'\n       * @return {fabric.Point}\n       */translateToGivenOrigin:function(point,fromOriginX,fromOriginY,toOriginX,toOriginY){var x=point.x,y=point.y,offsetX,offsetY,dim;if(typeof fromOriginX===\"string\"){fromOriginX=originXOffset[fromOriginX];}else{fromOriginX-=0.5;}if(typeof toOriginX===\"string\"){toOriginX=originXOffset[toOriginX];}else{toOriginX-=0.5;}offsetX=toOriginX-fromOriginX;if(typeof fromOriginY===\"string\"){fromOriginY=originYOffset[fromOriginY];}else{fromOriginY-=0.5;}if(typeof toOriginY===\"string\"){toOriginY=originYOffset[toOriginY];}else{toOriginY-=0.5;}offsetY=toOriginY-fromOriginY;if(offsetX||offsetY){dim=this._getTransformedDimensions();x=point.x+offsetX*dim.x;y=point.y+offsetY*dim.y;}return new fabric.Point(x,y);},/**\n       * Translates the coordinates from origin to center coordinates (based on the object's dimensions)\n       * @param {fabric.Point} point The point which corresponds to the originX and originY params\n       * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n       * @return {fabric.Point}\n       */translateToCenterPoint:function(point,originX,originY){var p=this.translateToGivenOrigin(point,originX,originY,\"center\",\"center\");if(this.angle){return fabric.util.rotatePoint(p,point,degreesToRadians(this.angle));}return p;},/**\n       * Translates the coordinates from center to origin coordinates (based on the object's dimensions)\n       * @param {fabric.Point} center The point which corresponds to center of the object\n       * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n       * @return {fabric.Point}\n       */translateToOriginPoint:function(center,originX,originY){var p=this.translateToGivenOrigin(center,\"center\",\"center\",originX,originY);if(this.angle){return fabric.util.rotatePoint(p,center,degreesToRadians(this.angle));}return p;},/**\n       * Returns the real center coordinates of the object\n       * @return {fabric.Point}\n       */getCenterPoint:function(){var leftTop=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(leftTop,this.originX,this.originY);},/**\n       * Returns the coordinates of the object based on center coordinates\n       * @param {fabric.Point} point The point which corresponds to the originX and originY params\n       * @return {fabric.Point}\n       */ // getOriginPoint: function(center) {\n//   return this.translateToOriginPoint(center, this.originX, this.originY);\n// },\n/**\n       * Returns the coordinates of the object as if it has a different origin\n       * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n       * @return {fabric.Point}\n       */getPointByOrigin:function(originX,originY){var center=this.getCenterPoint();return this.translateToOriginPoint(center,originX,originY);},/**\n       * Returns the point in local coordinates\n       * @param {fabric.Point} point The point relative to the global coordinate system\n       * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n       * @return {fabric.Point}\n       */toLocalPoint:function(point,originX,originY){var center=this.getCenterPoint(),p,p2;if(typeof originX!==\"undefined\"&&typeof originY!==\"undefined\"){p=this.translateToGivenOrigin(center,\"center\",\"center\",originX,originY);}else{p=new fabric.Point(this.left,this.top);}p2=new fabric.Point(point.x,point.y);if(this.angle){p2=fabric.util.rotatePoint(p2,center,-degreesToRadians(this.angle));}return p2.subtractEquals(p);},/**\n       * Returns the point in global coordinates\n       * @param {fabric.Point} The point relative to the local coordinate system\n       * @return {fabric.Point}\n       */ // toGlobalPoint: function(point) {\n//   return fabric.util.rotatePoint(point, this.getCenterPoint(), degreesToRadians(this.angle)).addEquals(new fabric.Point(this.left, this.top));\n// },\n/**\n       * Sets the position of the object taking into consideration the object's origin\n       * @param {fabric.Point} pos The new position of the object\n       * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n       * @return {void}\n       */setPositionByOrigin:function(pos,originX,originY){var center=this.translateToCenterPoint(pos,originX,originY),position=this.translateToOriginPoint(center,this.originX,this.originY);this.set(\"left\",position.x);this.set(\"top\",position.y);},/**\n       * @param {String} to One of 'left', 'center', 'right'\n       */adjustPosition:function(to){var angle=degreesToRadians(this.angle),hypotFull=this.getScaledWidth(),xFull=fabric.util.cos(angle)*hypotFull,yFull=fabric.util.sin(angle)*hypotFull,offsetFrom,offsetTo;//TODO: this function does not consider mixed situation like top, center.\nif(typeof this.originX===\"string\"){offsetFrom=originXOffset[this.originX];}else{offsetFrom=this.originX-0.5;}if(typeof to===\"string\"){offsetTo=originXOffset[to];}else{offsetTo=to-0.5;}this.left+=xFull*(offsetTo-offsetFrom);this.top+=yFull*(offsetTo-offsetFrom);this.setCoords();this.originX=to;},/**\n       * Sets the origin/position of the object to it's center point\n       * @private\n       * @return {void}\n       */_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var center=this.getCenterPoint();this.originX=\"center\";this.originY=\"center\";this.left=center.x;this.top=center.y;},/**\n       * Resets the origin/position of the object to it's original origin\n       * @private\n       * @return {void}\n       */_resetOrigin:function(){var originPoint=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=originPoint.x;this.top=originPoint.y;this._originalOriginX=null;this._originalOriginY=null;},/**\n       * @private\n       */_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),\"left\",\"top\");}});})();(function(){function arrayFromCoords(coords){return[new fabric.Point(coords.tl.x,coords.tl.y),new fabric.Point(coords.tr.x,coords.tr.y),new fabric.Point(coords.br.x,coords.br.y),new fabric.Point(coords.bl.x,coords.bl.y)];}var util=fabric.util,degreesToRadians=util.degreesToRadians,multiplyMatrices=util.multiplyTransformMatrices,transformPoint=util.transformPoint;util.object.extend(fabric.Object.prototype,/** @lends fabric.Object.prototype */{/**\n       * Describe object's corner position in canvas element coordinates.\n       * properties are depending on control keys and padding the main controls.\n       * each property is an object with x, y and corner.\n       * The `corner` property contains in a similar manner the 4 points of the\n       * interactive area of the corner.\n       * The coordinates depends from the controls positionHandler and are used\n       * to draw and locate controls\n       * @memberOf fabric.Object.prototype\n       */oCoords:null,/**\n       * Describe object's corner position in canvas object absolute coordinates\n       * properties are tl,tr,bl,br and describe the four main corner.\n       * each property is an object with x, y, instance of Fabric.Point.\n       * The coordinates depends from this properties: width, height, scaleX, scaleY\n       * skewX, skewY, angle, strokeWidth, top, left.\n       * Those coordinates are useful to understand where an object is. They get updated\n       * with oCoords but they do not need to be updated when zoom or panning change.\n       * The coordinates get updated with @method setCoords.\n       * You can calculate them without updating with @method calcACoords();\n       * @memberOf fabric.Object.prototype\n       */aCoords:null,/**\n       * Describe object's corner position in canvas element coordinates.\n       * includes padding. Used of object detection.\n       * set and refreshed with setCoords and calcCoords.\n       * @memberOf fabric.Object.prototype\n       */lineCoords:null,/**\n       * storage for object transform matrix\n       */ownMatrixCache:null,/**\n       * storage for object full transform matrix\n       */matrixCache:null,/**\n       * custom controls interface\n       * controls are added by default_controls.js\n       */controls:{},/**\n       * return correct set of coordinates for intersection\n       * this will return either aCoords or lineCoords.\n       * @param {Boolean} absolute will return aCoords if true or lineCoords\n       * @return {Object} {tl, tr, br, bl} points\n       */_getCoords:function(absolute,calculate){if(calculate){return absolute?this.calcACoords():this.calcLineCoords();}if(!this.aCoords||!this.lineCoords){this.setCoords(true);}return absolute?this.aCoords:this.lineCoords;},/**\n       * return correct set of coordinates for intersection\n       * this will return either aCoords or lineCoords.\n       * The coords are returned in an array.\n       * @return {Array} [tl, tr, br, bl] of points\n       */getCoords:function(absolute,calculate){return arrayFromCoords(this._getCoords(absolute,calculate));},/**\n       * Checks if object intersects with an area formed by 2 points\n       * @param {Object} pointTL top-left point of area\n       * @param {Object} pointBR bottom-right point of area\n       * @param {Boolean} [absolute] use coordinates without viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if object intersects with an area formed by 2 points\n       */intersectsWithRect:function(pointTL,pointBR,absolute,calculate){var coords=this.getCoords(absolute,calculate),intersection=fabric.Intersection.intersectPolygonRectangle(coords,pointTL,pointBR);return intersection.status===\"Intersection\";},/**\n       * Checks if object intersects with another object\n       * @param {Object} other Object to test\n       * @param {Boolean} [absolute] use coordinates without viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if object intersects with another object\n       */intersectsWithObject:function(other,absolute,calculate){var intersection=fabric.Intersection.intersectPolygonPolygon(this.getCoords(absolute,calculate),other.getCoords(absolute,calculate));return intersection.status===\"Intersection\"||other.isContainedWithinObject(this,absolute,calculate)||this.isContainedWithinObject(other,absolute,calculate);},/**\n       * Checks if object is fully contained within area of another object\n       * @param {Object} other Object to test\n       * @param {Boolean} [absolute] use coordinates without viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if object is fully contained within area of another object\n       */isContainedWithinObject:function(other,absolute,calculate){var points=this.getCoords(absolute,calculate),otherCoords=absolute?other.aCoords:other.lineCoords,i=0,lines=other._getImageLines(otherCoords);for(;i<4;i++){if(!other.containsPoint(points[i],lines)){return false;}}return true;},/**\n       * Checks if object is fully contained within area formed by 2 points\n       * @param {Object} pointTL top-left point of area\n       * @param {Object} pointBR bottom-right point of area\n       * @param {Boolean} [absolute] use coordinates without viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if object is fully contained within area formed by 2 points\n       */isContainedWithinRect:function(pointTL,pointBR,absolute,calculate){var boundingRect=this.getBoundingRect(absolute,calculate);return boundingRect.left>=pointTL.x&&boundingRect.left+boundingRect.width<=pointBR.x&&boundingRect.top>=pointTL.y&&boundingRect.top+boundingRect.height<=pointBR.y;},/**\n       * Checks if point is inside the object\n       * @param {fabric.Point} point Point to check against\n       * @param {Object} [lines] object returned from @method _getImageLines\n       * @param {Boolean} [absolute] use coordinates without viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if point is inside the object\n       */containsPoint:function(point,lines,absolute,calculate){var coords=this._getCoords(absolute,calculate),lines=lines||this._getImageLines(coords),xPoints=this._findCrossPoints(point,lines);// if xPoints is odd then point is inside the object\nreturn xPoints!==0&&xPoints%2===1;},/**\n       * Checks if object is contained within the canvas with current viewportTransform\n       * the check is done stopping at first point that appears on screen\n       * @param {Boolean} [calculate] use coordinates of current position instead of .aCoords\n       * @return {Boolean} true if object is fully or partially contained within canvas\n       */isOnScreen:function(calculate){if(!this.canvas){return false;}var pointTL=this.canvas.vptCoords.tl,pointBR=this.canvas.vptCoords.br;var points=this.getCoords(true,calculate);// if some point is on screen, the object is on screen.\nif(points.some(function(point){return point.x<=pointBR.x&&point.x>=pointTL.x&&point.y<=pointBR.y&&point.y>=pointTL.y;})){return true;}// no points on screen, check intersection with absolute coordinates\nif(this.intersectsWithRect(pointTL,pointBR,true,calculate)){return true;}return this._containsCenterOfCanvas(pointTL,pointBR,calculate);},/**\n       * Checks if the object contains the midpoint between canvas extremities\n       * Does not make sense outside the context of isOnScreen and isPartiallyOnScreen\n       * @private\n       * @param {Fabric.Point} pointTL Top Left point\n       * @param {Fabric.Point} pointBR Top Right point\n       * @param {Boolean} calculate use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if the object contains the point\n       */_containsCenterOfCanvas:function(pointTL,pointBR,calculate){// worst case scenario the object is so big that contains the screen\nvar centerPoint={x:(pointTL.x+pointBR.x)/2,y:(pointTL.y+pointBR.y)/2};if(this.containsPoint(centerPoint,null,true,calculate)){return true;}return false;},/**\n       * Checks if object is partially contained within the canvas with current viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if object is partially contained within canvas\n       */isPartiallyOnScreen:function(calculate){if(!this.canvas){return false;}var pointTL=this.canvas.vptCoords.tl,pointBR=this.canvas.vptCoords.br;if(this.intersectsWithRect(pointTL,pointBR,true,calculate)){return true;}var allPointsAreOutside=this.getCoords(true,calculate).every(function(point){return(point.x>=pointBR.x||point.x<=pointTL.x)&&(point.y>=pointBR.y||point.y<=pointTL.y);});return allPointsAreOutside&&this._containsCenterOfCanvas(pointTL,pointBR,calculate);},/**\n       * Method that returns an object with the object edges in it, given the coordinates of the corners\n       * @private\n       * @param {Object} oCoords Coordinates of the object corners\n       */_getImageLines:function(oCoords){var lines={topline:{o:oCoords.tl,d:oCoords.tr},rightline:{o:oCoords.tr,d:oCoords.br},bottomline:{o:oCoords.br,d:oCoords.bl},leftline:{o:oCoords.bl,d:oCoords.tl}};// // debugging\n// if (this.canvas.contextTop) {\n//   this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n//   this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n//\n//   this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n//   this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n//\n//   this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n//   this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n//\n//   this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n//   this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n// }\nreturn lines;},/**\n       * Helper method to determine how many cross points are between the 4 object edges\n       * and the horizontal line determined by a point on canvas\n       * @private\n       * @param {fabric.Point} point Point to check\n       * @param {Object} lines Coordinates of the object being evaluated\n       */ // remove yi, not used but left code here just in case.\n_findCrossPoints:function(point,lines){var b1,b2,a1,a2,xi,// yi,\nxcount=0,iLine;for(var lineKey in lines){iLine=lines[lineKey];// optimisation 1: line below point. no cross\nif(iLine.o.y<point.y&&iLine.d.y<point.y){continue;}// optimisation 2: line above point. no cross\nif(iLine.o.y>=point.y&&iLine.d.y>=point.y){continue;}// optimisation 3: vertical line case\nif(iLine.o.x===iLine.d.x&&iLine.o.x>=point.x){xi=iLine.o.x;// yi = point.y;\n}// calculate the intersection point\nelse{b1=0;b2=(iLine.d.y-iLine.o.y)/(iLine.d.x-iLine.o.x);a1=point.y-b1*point.x;a2=iLine.o.y-b2*iLine.o.x;xi=-(a1-a2)/(b1-b2);// yi = a1 + b1 * xi;\n}// dont count xi < point.x cases\nif(xi>=point.x){xcount+=1;}// optimisation 4: specific for square images\nif(xcount===2){break;}}return xcount;},/**\n       * Returns coordinates of object's bounding rectangle (left, top, width, height)\n       * the box is intended as aligned to axis of canvas.\n       * @param {Boolean} [absolute] use coordinates without viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords / .aCoords\n       * @return {Object} Object with left, top, width, height properties\n       */getBoundingRect:function(absolute,calculate){var coords=this.getCoords(absolute,calculate);return util.makeBoundingBoxFromPoints(coords);},/**\n       * Returns width of an object's bounding box counting transformations\n       * before 2.0 it was named getWidth();\n       * @return {Number} width value\n       */getScaledWidth:function(){return this._getTransformedDimensions().x;},/**\n       * Returns height of an object bounding box counting transformations\n       * before 2.0 it was named getHeight();\n       * @return {Number} height value\n       */getScaledHeight:function(){return this._getTransformedDimensions().y;},/**\n       * Makes sure the scale is valid and modifies it if necessary\n       * @private\n       * @param {Number} value\n       * @return {Number}\n       */_constrainScale:function(value){if(Math.abs(value)<this.minScaleLimit){if(value<0){return-this.minScaleLimit;}else{return this.minScaleLimit;}}else if(value===0){return 0.0001;}return value;},/**\n       * Scales an object (equally by x and y)\n       * @param {Number} value Scale factor\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */scale:function(value){this._set(\"scaleX\",value);this._set(\"scaleY\",value);return this.setCoords();},/**\n       * Scales an object to a given width, with respect to bounding box (scaling by x/y equally)\n       * @param {Number} value New width value\n       * @param {Boolean} absolute ignore viewport\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */scaleToWidth:function(value,absolute){// adjust to bounding rect factor so that rotated shapes would fit as well\nvar boundingRectFactor=this.getBoundingRect(absolute).width/this.getScaledWidth();return this.scale(value/this.width/boundingRectFactor);},/**\n       * Scales an object to a given height, with respect to bounding box (scaling by x/y equally)\n       * @param {Number} value New height value\n       * @param {Boolean} absolute ignore viewport\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */scaleToHeight:function(value,absolute){// adjust to bounding rect factor so that rotated shapes would fit as well\nvar boundingRectFactor=this.getBoundingRect(absolute).height/this.getScaledHeight();return this.scale(value/this.height/boundingRectFactor);},/**\n       * Calculates and returns the .coords of an object.\n       * unused by the library, only for the end dev.\n       * @return {Object} Object with tl, tr, br, bl ....\n       * @chainable\n       * @deprecated\n       */calcCoords:function(absolute){// this is a compatibility function to avoid removing calcCoords now.\nif(absolute){return this.calcACoords();}return this.calcOCoords();},calcLineCoords:function(){var vpt=this.getViewportTransform(),padding=this.padding,angle=degreesToRadians(this.angle),cos=util.cos(angle),sin=util.sin(angle),cosP=cos*padding,sinP=sin*padding,cosPSinP=cosP+sinP,cosPMinusSinP=cosP-sinP,aCoords=this.calcACoords();var lineCoords={tl:transformPoint(aCoords.tl,vpt),tr:transformPoint(aCoords.tr,vpt),bl:transformPoint(aCoords.bl,vpt),br:transformPoint(aCoords.br,vpt)};if(padding){lineCoords.tl.x-=cosPMinusSinP;lineCoords.tl.y-=cosPSinP;lineCoords.tr.x+=cosPSinP;lineCoords.tr.y-=cosPMinusSinP;lineCoords.bl.x-=cosPSinP;lineCoords.bl.y+=cosPMinusSinP;lineCoords.br.x+=cosPMinusSinP;lineCoords.br.y+=cosPSinP;}return lineCoords;},calcOCoords:function(){var rotateMatrix=this._calcRotateMatrix(),translateMatrix=this._calcTranslateMatrix(),vpt=this.getViewportTransform(),startMatrix=multiplyMatrices(vpt,translateMatrix),finalMatrix=multiplyMatrices(startMatrix,rotateMatrix),finalMatrix=multiplyMatrices(finalMatrix,[1/vpt[0],0,0,1/vpt[3],0,0]),dim=this._calculateCurrentDimensions(),coords={};this.forEachControl(function(control,key,fabricObject){coords[key]=control.positionHandler(dim,finalMatrix,fabricObject);});// debug code\n// var canvas = this.canvas;\n// setTimeout(function() {\n//   canvas.contextTop.clearRect(0, 0, 700, 700);\n//   canvas.contextTop.fillStyle = 'green';\n//   Object.keys(coords).forEach(function(key) {\n//     var control = coords[key];\n//     canvas.contextTop.fillRect(control.x, control.y, 3, 3);\n//   });\n// }, 50);\nreturn coords;},calcACoords:function(){var rotateMatrix=this._calcRotateMatrix(),translateMatrix=this._calcTranslateMatrix(),finalMatrix=multiplyMatrices(translateMatrix,rotateMatrix),dim=this._getTransformedDimensions(),w=dim.x/2,h=dim.y/2;return{// corners\ntl:transformPoint({x:-w,y:-h},finalMatrix),tr:transformPoint({x:w,y:-h},finalMatrix),bl:transformPoint({x:-w,y:h},finalMatrix),br:transformPoint({x:w,y:h},finalMatrix)};},/**\n       * Sets corner position coordinates based on current angle, width and height.\n       * oCoords are used to find the corners\n       * aCoords are used to quickly find an object on the canvas\n       * lineCoords are used to quickly find object during pointer events.\n       * See {@link https://github.com/kangax/fabric.js/wiki/When-to-call-setCoords|When-to-call-setCoords}\n       * @param {Boolean} [skipCorners] skip calculation of oCoords.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */setCoords:function(skipCorners){this.aCoords=this.calcACoords();this.lineCoords=this.calcLineCoords();if(skipCorners){return this;}// set coordinates of the draggable boxes in the corners used to scale/rotate the image\nthis.oCoords=this.calcOCoords();this._setCornerCoords&&this._setCornerCoords();return this;},/**\n       * calculate rotation matrix of an object\n       * @return {Array} rotation matrix for the object\n       */_calcRotateMatrix:function(){return util.calcRotateMatrix(this);},/**\n       * calculate the translation matrix for an object transform\n       * @return {Array} rotation matrix for the object\n       */_calcTranslateMatrix:function(){var center=this.getCenterPoint();return[1,0,0,1,center.x,center.y];},transformMatrixKey:function(skipGroup){var sep=\"_\",prefix=\"\";if(!skipGroup&&this.group){prefix=this.group.transformMatrixKey(skipGroup)+sep;}return prefix+this.top+sep+this.left+sep+this.scaleX+sep+this.scaleY+sep+this.skewX+sep+this.skewY+sep+this.angle+sep+this.originX+sep+this.originY+sep+this.width+sep+this.height+sep+this.strokeWidth+this.flipX+this.flipY;},/**\n       * calculate transform matrix that represents the current transformations from the\n       * object's properties.\n       * @param {Boolean} [skipGroup] return transform matrix for object not counting parent transformations\n       * There are some situation in which this is useful to avoid the fake rotation.\n       * @return {Array} transform matrix for the object\n       */calcTransformMatrix:function(skipGroup){var matrix=this.calcOwnMatrix();if(skipGroup||!this.group){return matrix;}var key=this.transformMatrixKey(skipGroup),cache=this.matrixCache||(this.matrixCache={});if(cache.key===key){return cache.value;}if(this.group){matrix=multiplyMatrices(this.group.calcTransformMatrix(false),matrix);}cache.key=key;cache.value=matrix;return matrix;},/**\n       * calculate transform matrix that represents the current transformations from the\n       * object's properties, this matrix does not include the group transformation\n       * @return {Array} transform matrix for the object\n       */calcOwnMatrix:function(){var key=this.transformMatrixKey(true),cache=this.ownMatrixCache||(this.ownMatrixCache={});if(cache.key===key){return cache.value;}var tMatrix=this._calcTranslateMatrix(),options={angle:this.angle,translateX:tMatrix[4],translateY:tMatrix[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};cache.key=key;cache.value=util.composeMatrix(options);return cache.value;},/*\n       * Calculate object dimensions from its properties\n       * @private\n       * @deprecated since 3.4.0, please use fabric.util._calcDimensionsTransformMatrix\n       * not including or including flipX, flipY to emulate the flipping boolean\n       * @return {Object} .x width dimension\n       * @return {Object} .y height dimension\n       */_calcDimensionsTransformMatrix:function(skewX,skewY,flipping){return util.calcDimensionsMatrix({skewX:skewX,skewY:skewY,scaleX:this.scaleX*(flipping&&this.flipX?-1:1),scaleY:this.scaleY*(flipping&&this.flipY?-1:1)});},/*\n       * Calculate object dimensions from its properties\n       * @private\n       * @return {Object} .x width dimension\n       * @return {Object} .y height dimension\n       */_getNonTransformedDimensions:function(){var strokeWidth=this.strokeWidth,w=this.width+strokeWidth,h=this.height+strokeWidth;return{x:w,y:h};},/*\n       * Calculate object bounding box dimensions from its properties scale, skew.\n       * @param {Number} skewX, a value to override current skewX\n       * @param {Number} skewY, a value to override current skewY\n       * @private\n       * @return {Object} .x width dimension\n       * @return {Object} .y height dimension\n       */_getTransformedDimensions:function(skewX,skewY){if(typeof skewX===\"undefined\"){skewX=this.skewX;}if(typeof skewY===\"undefined\"){skewY=this.skewY;}var dimensions=this._getNonTransformedDimensions(),dimX,dimY,noSkew=skewX===0&&skewY===0;if(this.strokeUniform){dimX=this.width;dimY=this.height;}else{dimX=dimensions.x;dimY=dimensions.y;}if(noSkew){return this._finalizeDimensions(dimX*this.scaleX,dimY*this.scaleY);}var bbox=util.sizeAfterTransform(dimX,dimY,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:skewX,skewY:skewY});return this._finalizeDimensions(bbox.x,bbox.y);},/*\n       * Calculate object bounding box dimensions from its properties scale, skew.\n       * @param Number width width of the bbox\n       * @param Number height height of the bbox\n       * @private\n       * @return {Object} .x finalized width dimension\n       * @return {Object} .y finalized height dimension\n       */_finalizeDimensions:function(width,height){return this.strokeUniform?{x:width+this.strokeWidth,y:height+this.strokeWidth}:{x:width,y:height};},/*\n       * Calculate object dimensions for controls box, including padding and canvas zoom.\n       * and active selection\n       * private\n       */_calculateCurrentDimensions:function(){var vpt=this.getViewportTransform(),dim=this._getTransformedDimensions(),p=transformPoint(dim,vpt,true);return p.scalarAdd(2*this.padding);}});})();fabric.util.object.extend(fabric.Object.prototype,/** @lends fabric.Object.prototype */{/**\n     * Moves an object to the bottom of the stack of drawn objects\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */sendToBack:function(){if(this.group){fabric.StaticCanvas.prototype.sendToBack.call(this.group,this);}else if(this.canvas){this.canvas.sendToBack(this);}return this;},/**\n     * Moves an object to the top of the stack of drawn objects\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */bringToFront:function(){if(this.group){fabric.StaticCanvas.prototype.bringToFront.call(this.group,this);}else if(this.canvas){this.canvas.bringToFront(this);}return this;},/**\n     * Moves an object down in stack of drawn objects\n     * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */sendBackwards:function(intersecting){if(this.group){fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,intersecting);}else if(this.canvas){this.canvas.sendBackwards(this,intersecting);}return this;},/**\n     * Moves an object up in stack of drawn objects\n     * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */bringForward:function(intersecting){if(this.group){fabric.StaticCanvas.prototype.bringForward.call(this.group,this,intersecting);}else if(this.canvas){this.canvas.bringForward(this,intersecting);}return this;},/**\n     * Moves an object to specified level in stack of drawn objects\n     * @param {Number} index New position of object\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */moveTo:function(index){if(this.group&&this.group.type!==\"activeSelection\"){fabric.StaticCanvas.prototype.moveTo.call(this.group,this,index);}else if(this.canvas){this.canvas.moveTo(this,index);}return this;}});/* _TO_SVG_START_ */(function(){function getSvgColorString(prop,value){if(!value){return prop+\": none; \";}else if(value.toLive){return prop+\": url(#SVGID_\"+value.id+\"); \";}else{var color=new fabric.Color(value),str=prop+\": \"+color.toRgb()+\"; \",opacity=color.getAlpha();if(opacity!==1){//change the color in rgb + opacity\nstr+=prop+\"-opacity: \"+opacity.toString()+\"; \";}return str;}}var toFixed=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,/** @lends fabric.Object.prototype */{/**\n       * Returns styles-string for svg-export\n       * @param {Boolean} skipShadow a boolean to skip shadow filter output\n       * @return {String}\n       */getSvgStyles:function(skipShadow){var fillRule=this.fillRule?this.fillRule:\"nonzero\",strokeWidth=this.strokeWidth?this.strokeWidth:\"0\",strokeDashArray=this.strokeDashArray?this.strokeDashArray.join(\" \"):\"none\",strokeDashOffset=this.strokeDashOffset?this.strokeDashOffset:\"0\",strokeLineCap=this.strokeLineCap?this.strokeLineCap:\"butt\",strokeLineJoin=this.strokeLineJoin?this.strokeLineJoin:\"miter\",strokeMiterLimit=this.strokeMiterLimit?this.strokeMiterLimit:\"4\",opacity=typeof this.opacity!==\"undefined\"?this.opacity:\"1\",visibility=this.visible?\"\":\" visibility: hidden;\",filter=skipShadow?\"\":this.getSvgFilter(),fill=getSvgColorString(\"fill\",this.fill),stroke=getSvgColorString(\"stroke\",this.stroke);return[stroke,\"stroke-width: \",strokeWidth,\"; \",\"stroke-dasharray: \",strokeDashArray,\"; \",\"stroke-linecap: \",strokeLineCap,\"; \",\"stroke-dashoffset: \",strokeDashOffset,\"; \",\"stroke-linejoin: \",strokeLineJoin,\"; \",\"stroke-miterlimit: \",strokeMiterLimit,\"; \",fill,\"fill-rule: \",fillRule,\"; \",\"opacity: \",opacity,\";\",filter,visibility].join(\"\");},/**\n       * Returns styles-string for svg-export\n       * @param {Object} style the object from which to retrieve style properties\n       * @param {Boolean} useWhiteSpace a boolean to include an additional attribute in the style.\n       * @return {String}\n       */getSvgSpanStyles:function(style,useWhiteSpace){var term=\"; \";var fontFamily=style.fontFamily?\"font-family: \"+(style.fontFamily.indexOf(\"'\")===-1&&style.fontFamily.indexOf('\"')===-1?\"'\"+style.fontFamily+\"'\":style.fontFamily)+term:\"\";var strokeWidth=style.strokeWidth?\"stroke-width: \"+style.strokeWidth+term:\"\",fontFamily=fontFamily,fontSize=style.fontSize?\"font-size: \"+style.fontSize+\"px\"+term:\"\",fontStyle=style.fontStyle?\"font-style: \"+style.fontStyle+term:\"\",fontWeight=style.fontWeight?\"font-weight: \"+style.fontWeight+term:\"\",fill=style.fill?getSvgColorString(\"fill\",style.fill):\"\",stroke=style.stroke?getSvgColorString(\"stroke\",style.stroke):\"\",textDecoration=this.getSvgTextDecoration(style),deltaY=style.deltaY?\"baseline-shift: \"+-style.deltaY+\"; \":\"\";if(textDecoration){textDecoration=\"text-decoration: \"+textDecoration+term;}return[stroke,strokeWidth,fontFamily,fontSize,fontStyle,fontWeight,textDecoration,fill,deltaY,useWhiteSpace?\"white-space: pre; \":\"\"].join(\"\");},/**\n       * Returns text-decoration property for svg-export\n       * @param {Object} style the object from which to retrieve style properties\n       * @return {String}\n       */getSvgTextDecoration:function(style){return[\"overline\",\"underline\",\"line-through\"].filter(function(decoration){return style[decoration.replace(\"-\",\"\")];}).join(\" \");},/**\n       * Returns filter for svg shadow\n       * @return {String}\n       */getSvgFilter:function(){return this.shadow?\"filter: url(#SVGID_\"+this.shadow.id+\");\":\"\";},/**\n       * Returns id attribute for svg output\n       * @return {String}\n       */getSvgCommons:function(){return[this.id?'id=\"'+this.id+'\" ':\"\",this.clipPath?'clip-path=\"url(#'+this.clipPath.clipPathId+')\" ':\"\"].join(\"\");},/**\n       * Returns transform-string for svg-export\n       * @param {Boolean} use the full transform or the single object one.\n       * @return {String}\n       */getSvgTransform:function(full,additionalTransform){var transform=full?this.calcTransformMatrix():this.calcOwnMatrix(),svgTransform='transform=\"'+fabric.util.matrixToSVG(transform);return svgTransform+(additionalTransform||\"\")+'\" ';},_setSVGBg:function(textBgRects){if(this.backgroundColor){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;textBgRects.push(\"\\t\\t<rect \",this._getFillAttributes(this.backgroundColor),' x=\"',toFixed(-this.width/2,NUM_FRACTION_DIGITS),'\" y=\"',toFixed(-this.height/2,NUM_FRACTION_DIGITS),'\" width=\"',toFixed(this.width,NUM_FRACTION_DIGITS),'\" height=\"',toFixed(this.height,NUM_FRACTION_DIGITS),'\"></rect>\\n');}},/**\n       * Returns svg representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */toSVG:function(reviver){return this._createBaseSVGMarkup(this._toSVG(reviver),{reviver:reviver});},/**\n       * Returns svg clipPath representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */toClipPathSVG:function(reviver){return\"\\t\"+this._createBaseClipPathSVGMarkup(this._toSVG(reviver),{reviver:reviver});},/**\n       * @private\n       */_createBaseClipPathSVGMarkup:function(objectMarkup,options){options=options||{};var reviver=options.reviver,additionalTransform=options.additionalTransform||\"\",commonPieces=[this.getSvgTransform(true,additionalTransform),this.getSvgCommons()].join(\"\"),// insert commons in the markup, style and svgCommons\nindex=objectMarkup.indexOf(\"COMMON_PARTS\");objectMarkup[index]=commonPieces;return reviver?reviver(objectMarkup.join(\"\")):objectMarkup.join(\"\");},/**\n       * @private\n       */_createBaseSVGMarkup:function(objectMarkup,options){options=options||{};var noStyle=options.noStyle,reviver=options.reviver,styleInfo=noStyle?\"\":'style=\"'+this.getSvgStyles()+'\" ',shadowInfo=options.withShadow?'style=\"'+this.getSvgFilter()+'\" ':\"\",clipPath=this.clipPath,vectorEffect=this.strokeUniform?'vector-effect=\"non-scaling-stroke\" ':\"\",absoluteClipPath=clipPath&&clipPath.absolutePositioned,stroke=this.stroke,fill=this.fill,shadow=this.shadow,commonPieces,markup=[],clipPathMarkup,// insert commons in the markup, style and svgCommons\nindex=objectMarkup.indexOf(\"COMMON_PARTS\"),additionalTransform=options.additionalTransform;if(clipPath){clipPath.clipPathId=\"CLIPPATH_\"+fabric.Object.__uid++;clipPathMarkup='<clipPath id=\"'+clipPath.clipPathId+'\" >\\n'+clipPath.toClipPathSVG(reviver)+\"</clipPath>\\n\";}if(absoluteClipPath){markup.push(\"<g \",shadowInfo,this.getSvgCommons(),\" >\\n\");}markup.push(\"<g \",this.getSvgTransform(false),!absoluteClipPath?shadowInfo+this.getSvgCommons():\"\",\" >\\n\");commonPieces=[styleInfo,vectorEffect,noStyle?\"\":this.addPaintOrder(),\" \",additionalTransform?'transform=\"'+additionalTransform+'\" ':\"\"].join(\"\");objectMarkup[index]=commonPieces;if(fill&&fill.toLive){markup.push(fill.toSVG(this));}if(stroke&&stroke.toLive){markup.push(stroke.toSVG(this));}if(shadow){markup.push(shadow.toSVG(this));}if(clipPath){markup.push(clipPathMarkup);}markup.push(objectMarkup.join(\"\"));markup.push(\"</g>\\n\");absoluteClipPath&&markup.push(\"</g>\\n\");return reviver?reviver(markup.join(\"\")):markup.join(\"\");},addPaintOrder:function(){return this.paintFirst!==\"fill\"?' paint-order=\"'+this.paintFirst+'\" ':\"\";}});})();/* _TO_SVG_END_ */(function(){var extend=fabric.util.object.extend,originalSet=\"stateProperties\";/*\n      Depends on `stateProperties`\n    */function saveProps(origin,destination,props){var tmpObj={},deep=true;props.forEach(function(prop){tmpObj[prop]=origin[prop];});extend(origin[destination],tmpObj,deep);}function _isEqual(origValue,currentValue,firstPass){if(origValue===currentValue){// if the objects are identical, return\nreturn true;}else if(Array.isArray(origValue)){if(!Array.isArray(currentValue)||origValue.length!==currentValue.length){return false;}for(var i=0,len=origValue.length;i<len;i++){if(!_isEqual(origValue[i],currentValue[i])){return false;}}return true;}else if(origValue&&typeof origValue===\"object\"){var keys=Object.keys(origValue),key;if(!currentValue||typeof currentValue!==\"object\"||!firstPass&&keys.length!==Object.keys(currentValue).length){return false;}for(var i=0,len=keys.length;i<len;i++){key=keys[i];// since clipPath is in the statefull cache list and the clipPath objects\n// would be iterated as an object, this would lead to possible infinite recursion\n// we do not want to compare those.\nif(key===\"canvas\"||key===\"group\"){continue;}if(!_isEqual(origValue[key],currentValue[key])){return false;}}return true;}}fabric.util.object.extend(fabric.Object.prototype,/** @lends fabric.Object.prototype */{/**\n       * Returns true if object state (one of its state properties) was changed\n       * @param {String} [propertySet] optional name for the set of property we want to save\n       * @return {Boolean} true if instance' state has changed since `{@link fabric.Object#saveState}` was called\n       */hasStateChanged:function(propertySet){propertySet=propertySet||originalSet;var dashedPropertySet=\"_\"+propertySet;if(Object.keys(this[dashedPropertySet]).length<this[propertySet].length){return true;}return!_isEqual(this[dashedPropertySet],this,true);},/**\n       * Saves state of an object\n       * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n       * @return {fabric.Object} thisArg\n       */saveState:function(options){var propertySet=options&&options.propertySet||originalSet,destination=\"_\"+propertySet;if(!this[destination]){return this.setupState(options);}saveProps(this,destination,this[propertySet]);if(options&&options.stateProperties){saveProps(this,destination,options.stateProperties);}return this;},/**\n       * Setups state of an object\n       * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n       * @return {fabric.Object} thisArg\n       */setupState:function(options){options=options||{};var propertySet=options.propertySet||originalSet;options.propertySet=propertySet;this[\"_\"+propertySet]={};this.saveState(options);return this;}});})();(function(){var degreesToRadians=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,/** @lends fabric.Object.prototype */{/**\n       * Determines which corner has been clicked\n       * @private\n       * @param {Object} pointer The pointer indicating the mouse position\n       * @return {String|Boolean} corner code (tl, tr, bl, br, etc.), or false if nothing is found\n       */_findTargetCorner:function(pointer,forTouch){// objects in group, anykind, are not self modificable,\n// must not return an hovered corner.\nif(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this){return false;}var ex=pointer.x,ey=pointer.y,xPoints,lines,keys=Object.keys(this.oCoords),j=keys.length-1,i;this.__corner=0;// cycle in reverse order so we pick first the one on top\nfor(;j>=0;j--){i=keys[j];if(!this.isControlVisible(i)){continue;}lines=this._getImageLines(forTouch?this.oCoords[i].touchCorner:this.oCoords[i].corner);// debugging\n// this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n// this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n//\n// this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n// this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n//\n// this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n// this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n//\n// this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n// this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\nxPoints=this._findCrossPoints({x:ex,y:ey},lines);if(xPoints!==0&&xPoints%2===1){this.__corner=i;return i;}}return false;},/**\n       * Calls a function for each control. The function gets called,\n       * with the control, the object that is calling the iterator and the control's key\n       * @param {Function} fn function to iterate over the controls over\n       */forEachControl:function(fn){for(var i in this.controls){fn(this.controls[i],i,this);}},/**\n       * Sets the coordinates of the draggable boxes in the corners of\n       * the image used to scale/rotate it.\n       * note: if we would switch to ROUND corner area, all of this would disappear.\n       * everything would resolve to a single point and a pythagorean theorem for the distance\n       * @private\n       */_setCornerCoords:function(){var coords=this.oCoords,newTheta=degreesToRadians(45-this.angle),cosTheta=fabric.util.cos(newTheta),sinTheta=fabric.util.sin(newTheta),/* Math.sqrt(2 * Math.pow(this.cornerSize, 2)) / 2, */ /* 0.707106 stands for sqrt(2)/2 */cornerHypotenuse=this.cornerSize*0.707106,touchHypotenuse=this.touchCornerSize*0.707106,cosHalfOffset=cornerHypotenuse*cosTheta,sinHalfOffset=cornerHypotenuse*sinTheta,touchCosHalfOffset=touchHypotenuse*cosTheta,touchSinHalfOffset=touchHypotenuse*sinTheta,x,y;for(var control in coords){x=coords[control].x;y=coords[control].y;coords[control].corner={tl:{x:x-sinHalfOffset,y:y-cosHalfOffset},tr:{x:x+cosHalfOffset,y:y-sinHalfOffset},bl:{x:x-cosHalfOffset,y:y+sinHalfOffset},br:{x:x+sinHalfOffset,y:y+cosHalfOffset}};coords[control].touchCorner={tl:{x:x-touchSinHalfOffset,y:y-touchCosHalfOffset},tr:{x:x+touchCosHalfOffset,y:y-touchSinHalfOffset},bl:{x:x-touchCosHalfOffset,y:y+touchSinHalfOffset},br:{x:x+touchSinHalfOffset,y:y+touchCosHalfOffset}};}},/**\n       * Draws a colored layer behind the object, inside its selection borders.\n       * Requires public options: padding, selectionBackgroundColor\n       * this function is called when the context is transformed\n       * has checks to be skipped when the object is on a staticCanvas\n       * @param {CanvasRenderingContext2D} ctx Context to draw on\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */drawSelectionBackground:function(ctx){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this){return this;}ctx.save();var center=this.getCenterPoint(),wh=this._calculateCurrentDimensions(),vpt=this.canvas.viewportTransform;ctx.translate(center.x,center.y);ctx.scale(1/vpt[0],1/vpt[3]);ctx.rotate(degreesToRadians(this.angle));ctx.fillStyle=this.selectionBackgroundColor;ctx.fillRect(-wh.x/2,-wh.y/2,wh.x,wh.y);ctx.restore();return this;},/**\n       * Draws borders of an object's bounding box.\n       * Requires public properties: width, height\n       * Requires public options: padding, borderColor\n       * @param {CanvasRenderingContext2D} ctx Context to draw on\n       * @param {Object} styleOverride object to override the object style\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */drawBorders:function(ctx,styleOverride){styleOverride=styleOverride||{};var wh=this._calculateCurrentDimensions(),strokeWidth=this.borderScaleFactor,width=wh.x+strokeWidth,height=wh.y+strokeWidth,hasControls=typeof styleOverride.hasControls!==\"undefined\"?styleOverride.hasControls:this.hasControls,shouldStroke=false;ctx.save();ctx.strokeStyle=styleOverride.borderColor||this.borderColor;this._setLineDash(ctx,styleOverride.borderDashArray||this.borderDashArray,null);ctx.strokeRect(-width/2,-height/2,width,height);if(hasControls){ctx.beginPath();this.forEachControl(function(control,key,fabricObject){// in this moment, the ctx is centered on the object.\n// width and height of the above function are the size of the bbox.\nif(control.withConnection&&control.getVisibility(fabricObject,key)){// reset movement for each control\nshouldStroke=true;ctx.moveTo(control.x*width,control.y*height);ctx.lineTo(control.x*width+control.offsetX,control.y*height+control.offsetY);}});if(shouldStroke){ctx.stroke();}}ctx.restore();return this;},/**\n       * Draws borders of an object's bounding box when it is inside a group.\n       * Requires public properties: width, height\n       * Requires public options: padding, borderColor\n       * @param {CanvasRenderingContext2D} ctx Context to draw on\n       * @param {object} options object representing current object parameters\n       * @param {Object} styleOverride object to override the object style\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */drawBordersInGroup:function(ctx,options,styleOverride){styleOverride=styleOverride||{};var bbox=fabric.util.sizeAfterTransform(this.width,this.height,options),strokeWidth=this.strokeWidth,strokeUniform=this.strokeUniform,borderScaleFactor=this.borderScaleFactor,width=bbox.x+strokeWidth*(strokeUniform?this.canvas.getZoom():options.scaleX)+borderScaleFactor,height=bbox.y+strokeWidth*(strokeUniform?this.canvas.getZoom():options.scaleY)+borderScaleFactor;ctx.save();this._setLineDash(ctx,styleOverride.borderDashArray||this.borderDashArray,null);ctx.strokeStyle=styleOverride.borderColor||this.borderColor;ctx.strokeRect(-width/2,-height/2,width,height);ctx.restore();return this;},/**\n       * Draws corners of an object's bounding box.\n       * Requires public properties: width, height\n       * Requires public options: cornerSize, padding\n       * @param {CanvasRenderingContext2D} ctx Context to draw on\n       * @param {Object} styleOverride object to override the object style\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */drawControls:function(ctx,styleOverride){styleOverride=styleOverride||{};ctx.save();ctx.setTransform(this.canvas.getRetinaScaling(),0,0,this.canvas.getRetinaScaling(),0,0);ctx.strokeStyle=ctx.fillStyle=styleOverride.cornerColor||this.cornerColor;if(!this.transparentCorners){ctx.strokeStyle=styleOverride.cornerStrokeColor||this.cornerStrokeColor;}this._setLineDash(ctx,styleOverride.cornerDashArray||this.cornerDashArray,null);this.setCoords();this.forEachControl(function(control,key,fabricObject){if(control.getVisibility(fabricObject,key)){control.render(ctx,fabricObject.oCoords[key].x,fabricObject.oCoords[key].y,styleOverride,fabricObject);}});ctx.restore();return this;},/**\n       * Returns true if the specified control is visible, false otherwise.\n       * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n       * @returns {Boolean} true if the specified control is visible, false otherwise\n       */isControlVisible:function(controlKey){return this.controls[controlKey]&&this.controls[controlKey].getVisibility(this,controlKey);},/**\n       * Sets the visibility of the specified control.\n       * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n       * @param {Boolean} visible true to set the specified control visible, false otherwise\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */setControlVisible:function(controlKey,visible){if(!this._controlsVisibility){this._controlsVisibility={};}this._controlsVisibility[controlKey]=visible;return this;},/**\n       * Sets the visibility state of object controls.\n       * @param {Object} [options] Options object\n       * @param {Boolean} [options.bl] true to enable the bottom-left control, false to disable it\n       * @param {Boolean} [options.br] true to enable the bottom-right control, false to disable it\n       * @param {Boolean} [options.mb] true to enable the middle-bottom control, false to disable it\n       * @param {Boolean} [options.ml] true to enable the middle-left control, false to disable it\n       * @param {Boolean} [options.mr] true to enable the middle-right control, false to disable it\n       * @param {Boolean} [options.mt] true to enable the middle-top control, false to disable it\n       * @param {Boolean} [options.tl] true to enable the top-left control, false to disable it\n       * @param {Boolean} [options.tr] true to enable the top-right control, false to disable it\n       * @param {Boolean} [options.mtr] true to enable the middle-top-rotate control, false to disable it\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */setControlsVisibility:function(options){options||(options={});for(var p in options){this.setControlVisible(p,options[p]);}return this;},/**\n       * This callback function is called every time _discardActiveObject or _setActiveObject\n       * try to to deselect this object. If the function returns true, the process is cancelled\n       * @param {Object} [options] options sent from the upper functions\n       * @param {Event} [options.e] event if the process is generated by an event\n       */onDeselect:function(){// implemented by sub-classes, as needed.\n},/**\n       * This callback function is called every time _discardActiveObject or _setActiveObject\n       * try to to select this object. If the function returns true, the process is cancelled\n       * @param {Object} [options] options sent from the upper functions\n       * @param {Event} [options.e] event if the process is generated by an event\n       */onSelect:function(){// implemented by sub-classes, as needed.\n}});})();fabric.util.object.extend(fabric.StaticCanvas.prototype,/** @lends fabric.StaticCanvas.prototype */{/**\n     * Animation duration (in ms) for fx* methods\n     * @type Number\n     * @default\n     */FX_DURATION:500,/**\n     * Centers object horizontally with animation.\n     * @param {fabric.Object} object Object to center\n     * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n     * @param {Function} [callbacks.onComplete] Invoked on completion\n     * @param {Function} [callbacks.onChange] Invoked on every step of animation\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */fxCenterObjectH:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:object.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(value){object.set(\"left\",value);_this.requestRenderAll();onChange();},onComplete:function(){object.setCoords();onComplete();}});return this;},/**\n     * Centers object vertically with animation.\n     * @param {fabric.Object} object Object to center\n     * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n     * @param {Function} [callbacks.onComplete] Invoked on completion\n     * @param {Function} [callbacks.onChange] Invoked on every step of animation\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */fxCenterObjectV:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:object.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(value){object.set(\"top\",value);_this.requestRenderAll();onChange();},onComplete:function(){object.setCoords();onComplete();}});return this;},/**\n     * Same as `fabric.Canvas#remove` but animated\n     * @param {fabric.Object} object Object to remove\n     * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n     * @param {Function} [callbacks.onComplete] Invoked on completion\n     * @param {Function} [callbacks.onChange] Invoked on every step of animation\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */fxRemove:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:object.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(value){object.set(\"opacity\",value);_this.requestRenderAll();onChange();},onComplete:function(){_this.remove(object);onComplete();}});return this;}});fabric.util.object.extend(fabric.Object.prototype,/** @lends fabric.Object.prototype */{/**\n     * Animates object's properties\n     * @param {String|Object} property Property to animate (if string) or properties to animate (if object)\n     * @param {Number|Object} value Value to animate property to (if string was given first) or options object\n     * @return {fabric.Object} thisArg\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#animation}\n     * @chainable\n     *\n     * As object — multiple properties\n     *\n     * object.animate({ left: ..., top: ... });\n     * object.animate({ left: ..., top: ... }, { duration: ... });\n     *\n     * As string — one property\n     *\n     * object.animate('left', ...);\n     * object.animate('left', { duration: ... });\n     *\n     */animate:function(){if(arguments[0]&&typeof arguments[0]===\"object\"){var propsToAnimate=[],prop,skipCallbacks;for(prop in arguments[0]){propsToAnimate.push(prop);}for(var i=0,len=propsToAnimate.length;i<len;i++){prop=propsToAnimate[i];skipCallbacks=i!==len-1;this._animate(prop,arguments[0][prop],arguments[1],skipCallbacks);}}else{this._animate.apply(this,arguments);}return this;},/**\n     * @private\n     * @param {String} property Property to animate\n     * @param {String} to Value to animate to\n     * @param {Object} [options] Options object\n     * @param {Boolean} [skipCallbacks] When true, callbacks like onchange and oncomplete are not invoked\n     */_animate:function(property,to,options,skipCallbacks){var _this=this,propPair;to=to.toString();if(!options){options={};}else{options=fabric.util.object.clone(options);}if(~property.indexOf(\".\")){propPair=property.split(\".\");}var propIsColor=_this.colorProperties.indexOf(property)>-1||propPair&&_this.colorProperties.indexOf(propPair[1])>-1;var currentValue=propPair?this.get(propPair[0])[propPair[1]]:this.get(property);if(!(\"from\"in options)){options.from=currentValue;}if(!propIsColor){if(~to.indexOf(\"=\")){to=currentValue+parseFloat(to.replace(\"=\",\"\"));}else{to=parseFloat(to);}}var _options={startValue:options.from,endValue:to,byValue:options.by,easing:options.easing,duration:options.duration,abort:options.abort&&function(){return options.abort.call(_this);},onChange:function(value,valueProgress,timeProgress){if(propPair){_this[propPair[0]][propPair[1]]=value;}else{_this.set(property,value);}if(skipCallbacks){return;}options.onChange&&options.onChange(value,valueProgress,timeProgress);},onComplete:function(value,valueProgress,timeProgress){if(skipCallbacks){return;}_this.setCoords();options.onComplete&&options.onComplete(value,valueProgress,timeProgress);}};if(propIsColor){fabric.util.animateColor(_options.startValue,_options.endValue,_options.duration,_options);}else{fabric.util.animate(_options);}}});(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,clone=fabric.util.object.clone,coordProps={x1:1,x2:1,y1:1,y2:1},supportsLineDash=fabric.StaticCanvas.supports(\"setLineDash\");if(fabric.Line){fabric.warn(\"fabric.Line is already defined\");return;}/**\n   * Line class\n   * @class fabric.Line\n   * @extends fabric.Object\n   * @see {@link fabric.Line#initialize} for constructor definition\n   */fabric.Line=fabric.util.createClass(fabric.Object,/** @lends fabric.Line.prototype */{/**\n       * Type of an object\n       * @type String\n       * @default\n       */type:\"line\",/**\n       * x value or first line edge\n       * @type Number\n       * @default\n       */x1:0,/**\n       * y value or first line edge\n       * @type Number\n       * @default\n       */y1:0,/**\n       * x value or second line edge\n       * @type Number\n       * @default\n       */x2:0,/**\n       * y value or second line edge\n       * @type Number\n       * @default\n       */y2:0,cacheProperties:fabric.Object.prototype.cacheProperties.concat(\"x1\",\"x2\",\"y1\",\"y2\"),/**\n       * Constructor\n       * @param {Array} [points] Array of points\n       * @param {Object} [options] Options object\n       * @return {fabric.Line} thisArg\n       */initialize:function(points,options){if(!points){points=[0,0,0,0];}this.callSuper(\"initialize\",options);this.set(\"x1\",points[0]);this.set(\"y1\",points[1]);this.set(\"x2\",points[2]);this.set(\"y2\",points[3]);this._setWidthHeight(options);},/**\n       * @private\n       * @param {Object} [options] Options\n       */_setWidthHeight:function(options){options||(options={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left=\"left\"in options?options.left:this._getLeftToOriginX();this.top=\"top\"in options?options.top:this._getTopToOriginY();},/**\n       * @private\n       * @param {String} key\n       * @param {*} value\n       */_set:function(key,value){this.callSuper(\"_set\",key,value);if(typeof coordProps[key]!==\"undefined\"){this._setWidthHeight();}return this;},/**\n       * @private\n       * @return {Number} leftToOriginX Distance from left edge of canvas to originX of Line.\n       */_getLeftToOriginX:makeEdgeToOriginGetter({// property names\norigin:\"originX\",axis1:\"x1\",axis2:\"x2\",dimension:\"width\"},{// possible values of origin\nnearest:\"left\",center:\"center\",farthest:\"right\"}),/**\n       * @private\n       * @return {Number} topToOriginY Distance from top edge of canvas to originY of Line.\n       */_getTopToOriginY:makeEdgeToOriginGetter({// property names\norigin:\"originY\",axis1:\"y1\",axis2:\"y2\",dimension:\"height\"},{// possible values of origin\nnearest:\"top\",center:\"center\",farthest:\"bottom\"}),/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_render:function(ctx){ctx.beginPath();if(!this.strokeDashArray||this.strokeDashArray&&supportsLineDash){// move from center (of virtual box) to its left/top corner\n// we can't assume x1, y1 is top left and x2, y2 is bottom right\nvar p=this.calcLinePoints();ctx.moveTo(p.x1,p.y1);ctx.lineTo(p.x2,p.y2);}ctx.lineWidth=this.strokeWidth;// TODO: test this\n// make sure setting \"fill\" changes color of a line\n// (by copying fillStyle to strokeStyle, since line is stroked, not filled)\nvar origStrokeStyle=ctx.strokeStyle;ctx.strokeStyle=this.stroke||ctx.fillStyle;this.stroke&&this._renderStroke(ctx);ctx.strokeStyle=origStrokeStyle;},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderDashedStroke:function(ctx){var p=this.calcLinePoints();ctx.beginPath();fabric.util.drawDashedLine(ctx,p.x1,p.y1,p.x2,p.y2,this.strokeDashArray);ctx.closePath();},/**\n       * This function is an helper for svg import. it returns the center of the object in the svg\n       * untransformed coordinates\n       * @private\n       * @return {Object} center point from element coordinates\n       */_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2};},/**\n       * Returns object representation of an instance\n       * @methd toObject\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */toObject:function(propertiesToInclude){return extend(this.callSuper(\"toObject\",propertiesToInclude),this.calcLinePoints());},/*\n       * Calculate object dimensions from its properties\n       * @private\n       */_getNonTransformedDimensions:function(){var dim=this.callSuper(\"_getNonTransformedDimensions\");if(this.strokeLineCap===\"butt\"){if(this.width===0){dim.y-=this.strokeWidth;}if(this.height===0){dim.x-=this.strokeWidth;}}return dim;},/**\n       * Recalculates line points given width and height\n       * @private\n       */calcLinePoints:function(){var xMult=this.x1<=this.x2?-1:1,yMult=this.y1<=this.y2?-1:1,x1=xMult*this.width*0.5,y1=yMult*this.height*0.5,x2=xMult*this.width*-0.5,y2=yMult*this.height*-0.5;return{x1:x1,x2:x2,y1:y1,y2:y2};},/* _TO_SVG_START_ */ /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */_toSVG:function(){var p=this.calcLinePoints();return[\"<line \",\"COMMON_PARTS\",'x1=\"',p.x1,'\" y1=\"',p.y1,'\" x2=\"',p.x2,'\" y2=\"',p.y2,'\" />\\n'];}/* _TO_SVG_END_ */});/* _FROM_SVG_START_ */ /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Line.fromElement})\n   * @static\n   * @memberOf fabric.Line\n   * @see http://www.w3.org/TR/SVG/shapes.html#LineElement\n   */fabric.Line.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(\"x1 y1 x2 y2\".split(\" \"));/**\n   * Returns fabric.Line instance from an SVG element\n   * @static\n   * @memberOf fabric.Line\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] callback function invoked after parsing\n   */fabric.Line.fromElement=function(element,callback,options){options=options||{};var parsedAttributes=fabric.parseAttributes(element,fabric.Line.ATTRIBUTE_NAMES),points=[parsedAttributes.x1||0,parsedAttributes.y1||0,parsedAttributes.x2||0,parsedAttributes.y2||0];callback(new fabric.Line(points,extend(parsedAttributes,options)));};/* _FROM_SVG_END_ */ /**\n   * Returns fabric.Line instance from an object representation\n   * @static\n   * @memberOf fabric.Line\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */fabric.Line.fromObject=function(object,callback){function _callback(instance){delete instance.points;callback&&callback(instance);}var options=clone(object,true);options.points=[object.x1,object.y1,object.x2,object.y2];fabric.Object._fromObject(\"Line\",options,_callback,\"points\");};/**\n   * Produces a function that calculates distance from canvas edge to Line origin.\n   */function makeEdgeToOriginGetter(propertyNames,originValues){var origin=propertyNames.origin,axis1=propertyNames.axis1,axis2=propertyNames.axis2,dimension=propertyNames.dimension,nearest=originValues.nearest,center=originValues.center,farthest=originValues.farthest;return function(){switch(this.get(origin)){case nearest:return Math.min(this.get(axis1),this.get(axis2));case center:return Math.min(this.get(axis1),this.get(axis2))+0.5*this.get(dimension);case farthest:return Math.max(this.get(axis1),this.get(axis2));}};}})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),pi=Math.PI;if(fabric.Circle){fabric.warn(\"fabric.Circle is already defined.\");return;}/**\n   * Circle class\n   * @class fabric.Circle\n   * @extends fabric.Object\n   * @see {@link fabric.Circle#initialize} for constructor definition\n   */fabric.Circle=fabric.util.createClass(fabric.Object,/** @lends fabric.Circle.prototype */{/**\n       * Type of an object\n       * @type String\n       * @default\n       */type:\"circle\",/**\n       * Radius of this circle\n       * @type Number\n       * @default\n       */radius:0,/**\n       * Start angle of the circle, moving clockwise\n       * deprectated type, this should be in degree, this was an oversight.\n       * probably will change to degrees in next major version\n       * @type Number\n       * @default 0\n       */startAngle:0,/**\n       * End angle of the circle\n       * deprectated type, this should be in degree, this was an oversight.\n       * probably will change to degrees in next major version\n       * @type Number\n       * @default 2Pi\n       */endAngle:pi*2,cacheProperties:fabric.Object.prototype.cacheProperties.concat(\"radius\",\"startAngle\",\"endAngle\"),/**\n       * @private\n       * @param {String} key\n       * @param {*} value\n       * @return {fabric.Circle} thisArg\n       */_set:function(key,value){this.callSuper(\"_set\",key,value);if(key===\"radius\"){this.setRadius(value);}return this;},/**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */toObject:function(propertiesToInclude){return this.callSuper(\"toObject\",[\"radius\",\"startAngle\",\"endAngle\"].concat(propertiesToInclude));},/* _TO_SVG_START_ */ /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */_toSVG:function(){var svgString,x=0,y=0,angle=(this.endAngle-this.startAngle)%(2*pi);if(angle===0){svgString=[\"<circle \",\"COMMON_PARTS\",'cx=\"'+x+'\" cy=\"'+y+'\" ','r=\"',this.radius,'\" />\\n'];}else{var startX=fabric.util.cos(this.startAngle)*this.radius,startY=fabric.util.sin(this.startAngle)*this.radius,endX=fabric.util.cos(this.endAngle)*this.radius,endY=fabric.util.sin(this.endAngle)*this.radius,largeFlag=angle>pi?\"1\":\"0\";svgString=['<path d=\"M '+startX+\" \"+startY,\" A \"+this.radius+\" \"+this.radius,\" 0 \",+largeFlag+\" 1\",\" \"+endX+\" \"+endY,'\" ',\"COMMON_PARTS\",\" />\\n\"];}return svgString;},/* _TO_SVG_END_ */ /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx context to render on\n       */_render:function(ctx){ctx.beginPath();ctx.arc(0,0,this.radius,this.startAngle,this.endAngle,false);this._renderPaintInOrder(ctx);},/**\n       * Returns horizontal radius of an object (according to how an object is scaled)\n       * @return {Number}\n       */getRadiusX:function(){return this.get(\"radius\")*this.get(\"scaleX\");},/**\n       * Returns vertical radius of an object (according to how an object is scaled)\n       * @return {Number}\n       */getRadiusY:function(){return this.get(\"radius\")*this.get(\"scaleY\");},/**\n       * Sets radius of an object (and updates width accordingly)\n       * @return {fabric.Circle} thisArg\n       */setRadius:function(value){this.radius=value;return this.set(\"width\",value*2).set(\"height\",value*2);}});/* _FROM_SVG_START_ */ /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Circle.fromElement})\n   * @static\n   * @memberOf fabric.Circle\n   * @see: http://www.w3.org/TR/SVG/shapes.html#CircleElement\n   */fabric.Circle.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(\"cx cy r\".split(\" \"));/**\n   * Returns {@link fabric.Circle} instance from an SVG element\n   * @static\n   * @memberOf fabric.Circle\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @param {Object} [options] Options object\n   * @throws {Error} If value of `r` attribute is missing or invalid\n   */fabric.Circle.fromElement=function(element,callback){var parsedAttributes=fabric.parseAttributes(element,fabric.Circle.ATTRIBUTE_NAMES);if(!isValidRadius(parsedAttributes)){throw new Error(\"value of `r` attribute is required and can not be negative\");}parsedAttributes.left=(parsedAttributes.left||0)-parsedAttributes.radius;parsedAttributes.top=(parsedAttributes.top||0)-parsedAttributes.radius;callback(new fabric.Circle(parsedAttributes));};/**\n   * @private\n   */function isValidRadius(attributes){return\"radius\"in attributes&&attributes.radius>=0;}/* _FROM_SVG_END_ */ /**\n   * Returns {@link fabric.Circle} instance from an object representation\n   * @static\n   * @memberOf fabric.Circle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {Object} Instance of fabric.Circle\n   */fabric.Circle.fromObject=function(object,callback){return fabric.Object._fromObject(\"Circle\",object,callback);};})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={});if(fabric.Triangle){fabric.warn(\"fabric.Triangle is already defined\");return;}/**\n   * Triangle class\n   * @class fabric.Triangle\n   * @extends fabric.Object\n   * @return {fabric.Triangle} thisArg\n   * @see {@link fabric.Triangle#initialize} for constructor definition\n   */fabric.Triangle=fabric.util.createClass(fabric.Object,/** @lends fabric.Triangle.prototype */{/**\n       * Type of an object\n       * @type String\n       * @default\n       */type:\"triangle\",/**\n       * Width is set to 100 to compensate the old initialize code that was setting it to 100\n       * @type Number\n       * @default\n       */width:100,/**\n       * Height is set to 100 to compensate the old initialize code that was setting it to 100\n       * @type Number\n       * @default\n       */height:100,/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_render:function(ctx){var widthBy2=this.width/2,heightBy2=this.height/2;ctx.beginPath();ctx.moveTo(-widthBy2,heightBy2);ctx.lineTo(0,-heightBy2);ctx.lineTo(widthBy2,heightBy2);ctx.closePath();this._renderPaintInOrder(ctx);},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderDashedStroke:function(ctx){var widthBy2=this.width/2,heightBy2=this.height/2;ctx.beginPath();fabric.util.drawDashedLine(ctx,-widthBy2,heightBy2,0,-heightBy2,this.strokeDashArray);fabric.util.drawDashedLine(ctx,0,-heightBy2,widthBy2,heightBy2,this.strokeDashArray);fabric.util.drawDashedLine(ctx,widthBy2,heightBy2,-widthBy2,heightBy2,this.strokeDashArray);ctx.closePath();},/* _TO_SVG_START_ */ /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */_toSVG:function(){var widthBy2=this.width/2,heightBy2=this.height/2,points=[-widthBy2+\" \"+heightBy2,\"0 \"+-heightBy2,widthBy2+\" \"+heightBy2].join(\",\");return[\"<polygon \",\"COMMON_PARTS\",'points=\"',points,'\" />'];}/* _TO_SVG_END_ */});/**\n   * Returns {@link fabric.Triangle} instance from an object representation\n   * @static\n   * @memberOf fabric.Triangle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */fabric.Triangle.fromObject=function(object,callback){return fabric.Object._fromObject(\"Triangle\",object,callback);};})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),piBy2=Math.PI*2;if(fabric.Ellipse){fabric.warn(\"fabric.Ellipse is already defined.\");return;}/**\n   * Ellipse class\n   * @class fabric.Ellipse\n   * @extends fabric.Object\n   * @return {fabric.Ellipse} thisArg\n   * @see {@link fabric.Ellipse#initialize} for constructor definition\n   */fabric.Ellipse=fabric.util.createClass(fabric.Object,/** @lends fabric.Ellipse.prototype */{/**\n       * Type of an object\n       * @type String\n       * @default\n       */type:\"ellipse\",/**\n       * Horizontal radius\n       * @type Number\n       * @default\n       */rx:0,/**\n       * Vertical radius\n       * @type Number\n       * @default\n       */ry:0,cacheProperties:fabric.Object.prototype.cacheProperties.concat(\"rx\",\"ry\"),/**\n       * Constructor\n       * @param {Object} [options] Options object\n       * @return {fabric.Ellipse} thisArg\n       */initialize:function(options){this.callSuper(\"initialize\",options);this.set(\"rx\",options&&options.rx||0);this.set(\"ry\",options&&options.ry||0);},/**\n       * @private\n       * @param {String} key\n       * @param {*} value\n       * @return {fabric.Ellipse} thisArg\n       */_set:function(key,value){this.callSuper(\"_set\",key,value);switch(key){case\"rx\":this.rx=value;this.set(\"width\",value*2);break;case\"ry\":this.ry=value;this.set(\"height\",value*2);break;}return this;},/**\n       * Returns horizontal radius of an object (according to how an object is scaled)\n       * @return {Number}\n       */getRx:function(){return this.get(\"rx\")*this.get(\"scaleX\");},/**\n       * Returns Vertical radius of an object (according to how an object is scaled)\n       * @return {Number}\n       */getRy:function(){return this.get(\"ry\")*this.get(\"scaleY\");},/**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */toObject:function(propertiesToInclude){return this.callSuper(\"toObject\",[\"rx\",\"ry\"].concat(propertiesToInclude));},/* _TO_SVG_START_ */ /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */_toSVG:function(){return[\"<ellipse \",\"COMMON_PARTS\",'cx=\"0\" cy=\"0\" ','rx=\"',this.rx,'\" ry=\"',this.ry,'\" />\\n'];},/* _TO_SVG_END_ */ /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx context to render on\n       */_render:function(ctx){ctx.beginPath();ctx.save();ctx.transform(1,0,0,this.ry/this.rx,0,0);ctx.arc(0,0,this.rx,0,piBy2,false);ctx.restore();this._renderPaintInOrder(ctx);}});/* _FROM_SVG_START_ */ /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Ellipse.fromElement})\n   * @static\n   * @memberOf fabric.Ellipse\n   * @see http://www.w3.org/TR/SVG/shapes.html#EllipseElement\n   */fabric.Ellipse.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(\"cx cy rx ry\".split(\" \"));/**\n   * Returns {@link fabric.Ellipse} instance from an SVG element\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @return {fabric.Ellipse}\n   */fabric.Ellipse.fromElement=function(element,callback){var parsedAttributes=fabric.parseAttributes(element,fabric.Ellipse.ATTRIBUTE_NAMES);parsedAttributes.left=(parsedAttributes.left||0)-parsedAttributes.rx;parsedAttributes.top=(parsedAttributes.top||0)-parsedAttributes.ry;callback(new fabric.Ellipse(parsedAttributes));};/* _FROM_SVG_END_ */ /**\n   * Returns {@link fabric.Ellipse} instance from an object representation\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {fabric.Ellipse}\n   */fabric.Ellipse.fromObject=function(object,callback){return fabric.Object._fromObject(\"Ellipse\",object,callback);};})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;if(fabric.Rect){fabric.warn(\"fabric.Rect is already defined\");return;}/**\n   * Rectangle class\n   * @class fabric.Rect\n   * @extends fabric.Object\n   * @return {fabric.Rect} thisArg\n   * @see {@link fabric.Rect#initialize} for constructor definition\n   */fabric.Rect=fabric.util.createClass(fabric.Object,/** @lends fabric.Rect.prototype */{/**\n       * List of properties to consider when checking if state of an object is changed ({@link fabric.Object#hasStateChanged})\n       * as well as for history (undo/redo) purposes\n       * @type Array\n       */stateProperties:fabric.Object.prototype.stateProperties.concat(\"rx\",\"ry\"),/**\n       * Type of an object\n       * @type String\n       * @default\n       */type:\"rect\",/**\n       * Horizontal border radius\n       * @type Number\n       * @default\n       */rx:0,/**\n       * Vertical border radius\n       * @type Number\n       * @default\n       */ry:0,cacheProperties:fabric.Object.prototype.cacheProperties.concat(\"rx\",\"ry\"),/**\n       * Constructor\n       * @param {Object} [options] Options object\n       * @return {Object} thisArg\n       */initialize:function(options){this.callSuper(\"initialize\",options);this._initRxRy();},/**\n       * Initializes rx/ry attributes\n       * @private\n       */_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx;}else if(this.ry&&!this.rx){this.rx=this.ry;}},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_render:function(ctx){// 1x1 case (used in spray brush) optimization was removed because\n// with caching and higher zoom level this makes more damage than help\nvar rx=this.rx?Math.min(this.rx,this.width/2):0,ry=this.ry?Math.min(this.ry,this.height/2):0,w=this.width,h=this.height,x=-this.width/2,y=-this.height/2,isRounded=rx!==0||ry!==0,/* \"magic number\" for bezier approximations of arcs (http://itc.ktu.lt/itc354/Riskus354.pdf) */k=1-0.5522847498;ctx.beginPath();ctx.moveTo(x+rx,y);ctx.lineTo(x+w-rx,y);isRounded&&ctx.bezierCurveTo(x+w-k*rx,y,x+w,y+k*ry,x+w,y+ry);ctx.lineTo(x+w,y+h-ry);isRounded&&ctx.bezierCurveTo(x+w,y+h-k*ry,x+w-k*rx,y+h,x+w-rx,y+h);ctx.lineTo(x+rx,y+h);isRounded&&ctx.bezierCurveTo(x+k*rx,y+h,x,y+h-k*ry,x,y+h-ry);ctx.lineTo(x,y+ry);isRounded&&ctx.bezierCurveTo(x,y+k*ry,x+k*rx,y,x+rx,y);ctx.closePath();this._renderPaintInOrder(ctx);},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderDashedStroke:function(ctx){var x=-this.width/2,y=-this.height/2,w=this.width,h=this.height;ctx.beginPath();fabric.util.drawDashedLine(ctx,x,y,x+w,y,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x+w,y,x+w,y+h,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x+w,y+h,x,y+h,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x,y+h,x,y,this.strokeDashArray);ctx.closePath();},/**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */toObject:function(propertiesToInclude){return this.callSuper(\"toObject\",[\"rx\",\"ry\"].concat(propertiesToInclude));},/* _TO_SVG_START_ */ /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */_toSVG:function(){var x=-this.width/2,y=-this.height/2;return[\"<rect \",\"COMMON_PARTS\",'x=\"',x,'\" y=\"',y,'\" rx=\"',this.rx,'\" ry=\"',this.ry,'\" width=\"',this.width,'\" height=\"',this.height,'\" />\\n'];}/* _TO_SVG_END_ */});/* _FROM_SVG_START_ */ /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Rect.fromElement`)\n   * @static\n   * @memberOf fabric.Rect\n   * @see: http://www.w3.org/TR/SVG/shapes.html#RectElement\n   */fabric.Rect.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(\"x y rx ry width height\".split(\" \"));/**\n   * Returns {@link fabric.Rect} instance from an SVG element\n   * @static\n   * @memberOf fabric.Rect\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */fabric.Rect.fromElement=function(element,callback,options){if(!element){return callback(null);}options=options||{};var parsedAttributes=fabric.parseAttributes(element,fabric.Rect.ATTRIBUTE_NAMES);parsedAttributes.left=parsedAttributes.left||0;parsedAttributes.top=parsedAttributes.top||0;parsedAttributes.height=parsedAttributes.height||0;parsedAttributes.width=parsedAttributes.width||0;var rect=new fabric.Rect(extend(options?fabric.util.object.clone(options):{},parsedAttributes));rect.visible=rect.visible&&rect.width>0&&rect.height>0;callback(rect);};/* _FROM_SVG_END_ */ /**\n   * Returns {@link fabric.Rect} instance from an object representation\n   * @static\n   * @memberOf fabric.Rect\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Rect instance is created\n   */fabric.Rect.fromObject=function(object,callback){return fabric.Object._fromObject(\"Rect\",object,callback);};})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,min=fabric.util.array.min,max=fabric.util.array.max,toFixed=fabric.util.toFixed;if(fabric.Polyline){fabric.warn(\"fabric.Polyline is already defined\");return;}/**\n   * Polyline class\n   * @class fabric.Polyline\n   * @extends fabric.Object\n   * @see {@link fabric.Polyline#initialize} for constructor definition\n   */fabric.Polyline=fabric.util.createClass(fabric.Object,/** @lends fabric.Polyline.prototype */{/**\n       * Type of an object\n       * @type String\n       * @default\n       */type:\"polyline\",/**\n       * Points array\n       * @type Array\n       * @default\n       */points:null,cacheProperties:fabric.Object.prototype.cacheProperties.concat(\"points\"),/**\n       * Constructor\n       * @param {Array} points Array of points (where each point is an object with x and y)\n       * @param {Object} [options] Options object\n       * @return {fabric.Polyline} thisArg\n       * @example\n       * var poly = new fabric.Polyline([\n       *     { x: 10, y: 10 },\n       *     { x: 50, y: 30 },\n       *     { x: 40, y: 70 },\n       *     { x: 60, y: 50 },\n       *     { x: 100, y: 150 },\n       *     { x: 40, y: 100 }\n       *   ], {\n       *   stroke: 'red',\n       *   left: 100,\n       *   top: 100\n       * });\n       */initialize:function(points,options){options=options||{};this.points=points||[];this.callSuper(\"initialize\",options);this._setPositionDimensions(options);},_setPositionDimensions:function(options){var calcDim=this._calcDimensions(options),correctLeftTop;this.width=calcDim.width;this.height=calcDim.height;if(!options.fromSVG){correctLeftTop=this.translateToGivenOrigin({x:calcDim.left-this.strokeWidth/2,y:calcDim.top-this.strokeWidth/2},\"left\",\"top\",this.originX,this.originY);}if(typeof options.left===\"undefined\"){this.left=options.fromSVG?calcDim.left:correctLeftTop.x;}if(typeof options.top===\"undefined\"){this.top=options.fromSVG?calcDim.top:correctLeftTop.y;}this.pathOffset={x:calcDim.left+this.width/2,y:calcDim.top+this.height/2};},/**\n       * Calculate the polygon min and max point from points array,\n       * returning an object with left, top, widht, height to measure the\n       * polygon size\n       * @return {Object} object.left X coordinate of the polygon leftmost point\n       * @return {Object} object.top Y coordinate of the polygon topmost point\n       * @return {Object} object.width distance between X coordinates of the polygon leftmost and rightmost point\n       * @return {Object} object.height distance between Y coordinates of the polygon topmost and bottommost point\n       * @private\n       */_calcDimensions:function(){var points=this.points,minX=min(points,\"x\")||0,minY=min(points,\"y\")||0,maxX=max(points,\"x\")||0,maxY=max(points,\"y\")||0,width=maxX-minX,height=maxY-minY;return{left:minX,top:minY,width:width,height:height};},/**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} Object representation of an instance\n       */toObject:function(propertiesToInclude){return extend(this.callSuper(\"toObject\",propertiesToInclude),{points:this.points.concat()});},/* _TO_SVG_START_ */ /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */_toSVG:function(){var points=[],diffX=this.pathOffset.x,diffY=this.pathOffset.y,NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;for(var i=0,len=this.points.length;i<len;i++){points.push(toFixed(this.points[i].x-diffX,NUM_FRACTION_DIGITS),\",\",toFixed(this.points[i].y-diffY,NUM_FRACTION_DIGITS),\" \");}return[\"<\"+this.type+\" \",\"COMMON_PARTS\",'points=\"',points.join(\"\"),'\" />\\n'];},/* _TO_SVG_END_ */ /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */commonRender:function(ctx){var point,len=this.points.length,x=this.pathOffset.x,y=this.pathOffset.y;if(!len||isNaN(this.points[len-1].y)){// do not draw if no points or odd points\n// NaN comes from parseFloat of a empty string in parser\nreturn false;}ctx.beginPath();ctx.moveTo(this.points[0].x-x,this.points[0].y-y);for(var i=0;i<len;i++){point=this.points[i];ctx.lineTo(point.x-x,point.y-y);}return true;},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_render:function(ctx){if(!this.commonRender(ctx)){return;}this._renderPaintInOrder(ctx);},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderDashedStroke:function(ctx){var p1,p2;ctx.beginPath();for(var i=0,len=this.points.length;i<len;i++){p1=this.points[i];p2=this.points[i+1]||p1;fabric.util.drawDashedLine(ctx,p1.x,p1.y,p2.x,p2.y,this.strokeDashArray);}},/**\n       * Returns complexity of an instance\n       * @return {Number} complexity of this instance\n       */complexity:function(){return this.get(\"points\").length;}});/* _FROM_SVG_START_ */ /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Polyline.fromElement})\n   * @static\n   * @memberOf fabric.Polyline\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolylineElement\n   */fabric.Polyline.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat();/**\n   * Returns fabric.Polyline instance from an SVG element\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {SVGElement} element Element to parser\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */fabric.Polyline.fromElementGenerator=function(_class){return function(element,callback,options){if(!element){return callback(null);}options||(options={});var points=fabric.parsePointsAttribute(element.getAttribute(\"points\")),parsedAttributes=fabric.parseAttributes(element,fabric[_class].ATTRIBUTE_NAMES);parsedAttributes.fromSVG=true;callback(new fabric[_class](points,extend(parsedAttributes,options)));};};fabric.Polyline.fromElement=fabric.Polyline.fromElementGenerator(\"Polyline\");/* _FROM_SVG_END_ */ /**\n   * Returns fabric.Polyline instance from an object representation\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */fabric.Polyline.fromObject=function(object,callback){return fabric.Object._fromObject(\"Polyline\",object,callback,\"points\");};})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={});if(fabric.Polygon){fabric.warn(\"fabric.Polygon is already defined\");return;}/**\n   * Polygon class\n   * @class fabric.Polygon\n   * @extends fabric.Polyline\n   * @see {@link fabric.Polygon#initialize} for constructor definition\n   */fabric.Polygon=fabric.util.createClass(fabric.Polyline,/** @lends fabric.Polygon.prototype */{/**\n       * Type of an object\n       * @type String\n       * @default\n       */type:\"polygon\",/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_render:function(ctx){if(!this.commonRender(ctx)){return;}ctx.closePath();this._renderPaintInOrder(ctx);},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderDashedStroke:function(ctx){this.callSuper(\"_renderDashedStroke\",ctx);ctx.closePath();}});/* _FROM_SVG_START_ */ /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Polygon.fromElement`)\n   * @static\n   * @memberOf fabric.Polygon\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolygonElement\n   */fabric.Polygon.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat();/**\n   * Returns {@link fabric.Polygon} instance from an SVG element\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */fabric.Polygon.fromElement=fabric.Polyline.fromElementGenerator(\"Polygon\");/* _FROM_SVG_END_ */ /**\n   * Returns fabric.Polygon instance from an object representation\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */fabric.Polygon.fromObject=function(object,callback){return fabric.Object._fromObject(\"Polygon\",object,callback,\"points\");};})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),min=fabric.util.array.min,max=fabric.util.array.max,extend=fabric.util.object.extend,_toString=Object.prototype.toString,drawArc=fabric.util.drawArc,toFixed=fabric.util.toFixed,commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},repeatedCommands={m:\"l\",M:\"L\"};if(fabric.Path){fabric.warn(\"fabric.Path is already defined\");return;}/**\n   * Path class\n   * @class fabric.Path\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#path_and_pathgroup}\n   * @see {@link fabric.Path#initialize} for constructor definition\n   */fabric.Path=fabric.util.createClass(fabric.Object,/** @lends fabric.Path.prototype */{/**\n       * Type of an object\n       * @type String\n       * @default\n       */type:\"path\",/**\n       * Array of path points\n       * @type Array\n       * @default\n       */path:null,cacheProperties:fabric.Object.prototype.cacheProperties.concat(\"path\",\"fillRule\"),stateProperties:fabric.Object.prototype.stateProperties.concat(\"path\"),/**\n       * Constructor\n       * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n       * @param {Object} [options] Options object\n       * @return {fabric.Path} thisArg\n       */initialize:function(path,options){options=options||{};this.callSuper(\"initialize\",options);if(!path){path=[];}var fromArray=_toString.call(path)===\"[object Array]\";this.path=fromArray?path:// one of commands (m,M,l,L,q,Q,c,C,etc.) followed by non-command characters (i.e. command values)\npath.match&&path.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path){return;}if(!fromArray){this.path=this._parsePath();}fabric.Polyline.prototype._setPositionDimensions.call(this,options);},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx context to render path on\n       */_renderPathCommands:function(ctx){var current,// current instruction\nprevious=null,subpathStartX=0,subpathStartY=0,x=0,// current x\ny=0,// current y\ncontrolX=0,// current control point x\ncontrolY=0,// current control point y\ntempX,tempY,l=-this.pathOffset.x,t=-this.pathOffset.y;ctx.beginPath();for(var i=0,len=this.path.length;i<len;++i){current=this.path[i];switch(current[0]// first letter\n){case\"l\":// lineto, relative\nx+=current[1];y+=current[2];ctx.lineTo(x+l,y+t);break;case\"L\":// lineto, absolute\nx=current[1];y=current[2];ctx.lineTo(x+l,y+t);break;case\"h\":// horizontal lineto, relative\nx+=current[1];ctx.lineTo(x+l,y+t);break;case\"H\":// horizontal lineto, absolute\nx=current[1];ctx.lineTo(x+l,y+t);break;case\"v\":// vertical lineto, relative\ny+=current[1];ctx.lineTo(x+l,y+t);break;case\"V\":// verical lineto, absolute\ny=current[1];ctx.lineTo(x+l,y+t);break;case\"m\":// moveTo, relative\nx+=current[1];y+=current[2];subpathStartX=x;subpathStartY=y;ctx.moveTo(x+l,y+t);break;case\"M\":// moveTo, absolute\nx=current[1];y=current[2];subpathStartX=x;subpathStartY=y;ctx.moveTo(x+l,y+t);break;case\"c\":// bezierCurveTo, relative\ntempX=x+current[5];tempY=y+current[6];controlX=x+current[3];controlY=y+current[4];ctx.bezierCurveTo(x+current[1]+l,// x1\ny+current[2]+t,// y1\ncontrolX+l,// x2\ncontrolY+t,// y2\ntempX+l,tempY+t);x=tempX;y=tempY;break;case\"C\":// bezierCurveTo, absolute\nx=current[5];y=current[6];controlX=current[3];controlY=current[4];ctx.bezierCurveTo(current[1]+l,current[2]+t,controlX+l,controlY+t,x+l,y+t);break;case\"s\":// shorthand cubic bezierCurveTo, relative\n// transform to absolute x,y\ntempX=x+current[3];tempY=y+current[4];if(previous[0].match(/[CcSs]/)===null){// If there is no previous command or if the previous command was not a C, c, S, or s,\n// the control point is coincident with the current point\ncontrolX=x;controlY=y;}else{// calculate reflection of previous control points\ncontrolX=2*x-controlX;controlY=2*y-controlY;}ctx.bezierCurveTo(controlX+l,controlY+t,x+current[1]+l,y+current[2]+t,tempX+l,tempY+t);// set control point to 2nd one of this command\n// \"... the first control point is assumed to be\n// the reflection of the second control point on\n// the previous command relative to the current point.\"\ncontrolX=x+current[1];controlY=y+current[2];x=tempX;y=tempY;break;case\"S\":// shorthand cubic bezierCurveTo, absolute\ntempX=current[3];tempY=current[4];if(previous[0].match(/[CcSs]/)===null){// If there is no previous command or if the previous command was not a C, c, S, or s,\n// the control point is coincident with the current point\ncontrolX=x;controlY=y;}else{// calculate reflection of previous control points\ncontrolX=2*x-controlX;controlY=2*y-controlY;}ctx.bezierCurveTo(controlX+l,controlY+t,current[1]+l,current[2]+t,tempX+l,tempY+t);x=tempX;y=tempY;// set control point to 2nd one of this command\n// \"... the first control point is assumed to be\n// the reflection of the second control point on\n// the previous command relative to the current point.\"\ncontrolX=current[1];controlY=current[2];break;case\"q\":// quadraticCurveTo, relative\n// transform to absolute x,y\ntempX=x+current[3];tempY=y+current[4];controlX=x+current[1];controlY=y+current[2];ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case\"Q\":// quadraticCurveTo, absolute\ntempX=current[3];tempY=current[4];ctx.quadraticCurveTo(current[1]+l,current[2]+t,tempX+l,tempY+t);x=tempX;y=tempY;controlX=current[1];controlY=current[2];break;case\"t\":// shorthand quadraticCurveTo, relative\n// transform to absolute x,y\ntempX=x+current[1];tempY=y+current[2];if(previous[0].match(/[QqTt]/)===null){// If there is no previous command or if the previous command was not a Q, q, T or t,\n// assume the control point is coincident with the current point\ncontrolX=x;controlY=y;}else{// calculate reflection of previous control point\ncontrolX=2*x-controlX;controlY=2*y-controlY;}ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case\"T\":tempX=current[1];tempY=current[2];if(previous[0].match(/[QqTt]/)===null){// If there is no previous command or if the previous command was not a Q, q, T or t,\n// assume the control point is coincident with the current point\ncontrolX=x;controlY=y;}else{// calculate reflection of previous control point\ncontrolX=2*x-controlX;controlY=2*y-controlY;}ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case\"a\":// TODO: optimize this\ndrawArc(ctx,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+x+l,current[7]+y+t]);x+=current[6];y+=current[7];break;case\"A\":// TODO: optimize this\ndrawArc(ctx,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+l,current[7]+t]);x=current[6];y=current[7];break;case\"z\":case\"Z\":x=subpathStartX;y=subpathStartY;ctx.closePath();break;}previous=current;}},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx context to render path on\n       */_render:function(ctx){this._renderPathCommands(ctx);this._renderPaintInOrder(ctx);},/**\n       * Returns string representation of an instance\n       * @return {String} string representation of an instance\n       */toString:function(){return\"#<fabric.Path (\"+this.complexity()+'): { \"top\": '+this.top+', \"left\": '+this.left+\" }>\";},/**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */toObject:function(propertiesToInclude){return extend(this.callSuper(\"toObject\",propertiesToInclude),{path:this.path.map(function(item){return item.slice();})});},/**\n       * Returns dataless object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */toDatalessObject:function(propertiesToInclude){var o=this.toObject([\"sourcePath\"].concat(propertiesToInclude));if(o.sourcePath){delete o.path;}return o;},/* _TO_SVG_START_ */ /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */_toSVG:function(){var path=this.path.map(function(path){return path.join(\" \");}).join(\" \");return[\"<path \",\"COMMON_PARTS\",'d=\"',path,'\" stroke-linecap=\"round\" ',\"/>\\n\"];},_getOffsetTransform:function(){var digits=fabric.Object.NUM_FRACTION_DIGITS;return\" translate(\"+toFixed(-this.pathOffset.x,digits)+\", \"+toFixed(-this.pathOffset.y,digits)+\")\";},/**\n       * Returns svg clipPath representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */toClipPathSVG:function(reviver){var additionalTransform=this._getOffsetTransform();return\"\\t\"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:reviver,additionalTransform:additionalTransform});},/**\n       * Returns svg representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */toSVG:function(reviver){var additionalTransform=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:reviver,additionalTransform:additionalTransform});},/* _TO_SVG_END_ */ /**\n       * Returns number representation of an instance complexity\n       * @return {Number} complexity of this instance\n       */complexity:function(){return this.path.length;},/**\n       * @private\n       */_parsePath:function(){var result=[],coords=[],currentPath,parsed,re=fabric.rePathCommand,match,coordsStr;for(var i=0,coordsParsed,len=this.path.length;i<len;i++){currentPath=this.path[i];coordsStr=currentPath.slice(1).trim();coords.length=0;while(match=re.exec(coordsStr)){coords.push(match[0]);}coordsParsed=[currentPath.charAt(0)];for(var j=0,jlen=coords.length;j<jlen;j++){parsed=parseFloat(coords[j]);if(!isNaN(parsed)){coordsParsed.push(parsed);}}var command=coordsParsed[0],commandLength=commandLengths[command.toLowerCase()],repeatedCommand=repeatedCommands[command]||command;if(coordsParsed.length-1>commandLength){for(var k=1,klen=coordsParsed.length;k<klen;k+=commandLength){result.push([command].concat(coordsParsed.slice(k,k+commandLength)));command=repeatedCommand;}}else{result.push(coordsParsed);}}return result;},/**\n       * @private\n       */_calcDimensions:function(){var aX=[],aY=[],current,// current instruction\nprevious=null,subpathStartX=0,subpathStartY=0,x=0,// current x\ny=0,// current y\ncontrolX=0,// current control point x\ncontrolY=0,// current control point y\ntempX,tempY,bounds;for(var i=0,len=this.path.length;i<len;++i){current=this.path[i];switch(current[0]// first letter\n){case\"l\":// lineto, relative\nx+=current[1];y+=current[2];bounds=[];break;case\"L\":// lineto, absolute\nx=current[1];y=current[2];bounds=[];break;case\"h\":// horizontal lineto, relative\nx+=current[1];bounds=[];break;case\"H\":// horizontal lineto, absolute\nx=current[1];bounds=[];break;case\"v\":// vertical lineto, relative\ny+=current[1];bounds=[];break;case\"V\":// verical lineto, absolute\ny=current[1];bounds=[];break;case\"m\":// moveTo, relative\nx+=current[1];y+=current[2];subpathStartX=x;subpathStartY=y;bounds=[];break;case\"M\":// moveTo, absolute\nx=current[1];y=current[2];subpathStartX=x;subpathStartY=y;bounds=[];break;case\"c\":// bezierCurveTo, relative\ntempX=x+current[5];tempY=y+current[6];controlX=x+current[3];controlY=y+current[4];bounds=fabric.util.getBoundsOfCurve(x,y,x+current[1],// x1\ny+current[2],// y1\ncontrolX,// x2\ncontrolY,// y2\ntempX,tempY);x=tempX;y=tempY;break;case\"C\":// bezierCurveTo, absolute\ncontrolX=current[3];controlY=current[4];bounds=fabric.util.getBoundsOfCurve(x,y,current[1],current[2],controlX,controlY,current[5],current[6]);x=current[5];y=current[6];break;case\"s\":// shorthand cubic bezierCurveTo, relative\n// transform to absolute x,y\ntempX=x+current[3];tempY=y+current[4];if(previous[0].match(/[CcSs]/)===null){// If there is no previous command or if the previous command was not a C, c, S, or s,\n// the control point is coincident with the current point\ncontrolX=x;controlY=y;}else{// calculate reflection of previous control points\ncontrolX=2*x-controlX;controlY=2*y-controlY;}bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,x+current[1],y+current[2],tempX,tempY);// set control point to 2nd one of this command\n// \"... the first control point is assumed to be\n// the reflection of the second control point on\n// the previous command relative to the current point.\"\ncontrolX=x+current[1];controlY=y+current[2];x=tempX;y=tempY;break;case\"S\":// shorthand cubic bezierCurveTo, absolute\ntempX=current[3];tempY=current[4];if(previous[0].match(/[CcSs]/)===null){// If there is no previous command or if the previous command was not a C, c, S, or s,\n// the control point is coincident with the current point\ncontrolX=x;controlY=y;}else{// calculate reflection of previous control points\ncontrolX=2*x-controlX;controlY=2*y-controlY;}bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,current[1],current[2],tempX,tempY);x=tempX;y=tempY;// set control point to 2nd one of this command\n// \"... the first control point is assumed to be\n// the reflection of the second control point on\n// the previous command relative to the current point.\"\ncontrolX=current[1];controlY=current[2];break;case\"q\":// quadraticCurveTo, relative\n// transform to absolute x,y\ntempX=x+current[3];tempY=y+current[4];controlX=x+current[1];controlY=y+current[2];bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,tempX,tempY);x=tempX;y=tempY;break;case\"Q\":// quadraticCurveTo, absolute\ncontrolX=current[1];controlY=current[2];bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,current[3],current[4]);x=current[3];y=current[4];break;case\"t\":// shorthand quadraticCurveTo, relative\n// transform to absolute x,y\ntempX=x+current[1];tempY=y+current[2];if(previous[0].match(/[QqTt]/)===null){// If there is no previous command or if the previous command was not a Q, q, T or t,\n// assume the control point is coincident with the current point\ncontrolX=x;controlY=y;}else{// calculate reflection of previous control point\ncontrolX=2*x-controlX;controlY=2*y-controlY;}bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,tempX,tempY);x=tempX;y=tempY;break;case\"T\":tempX=current[1];tempY=current[2];if(previous[0].match(/[QqTt]/)===null){// If there is no previous command or if the previous command was not a Q, q, T or t,\n// assume the control point is coincident with the current point\ncontrolX=x;controlY=y;}else{// calculate reflection of previous control point\ncontrolX=2*x-controlX;controlY=2*y-controlY;}bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,tempX,tempY);x=tempX;y=tempY;break;case\"a\":// TODO: optimize this\nbounds=fabric.util.getBoundsOfArc(x,y,current[1],current[2],current[3],current[4],current[5],current[6]+x,current[7]+y);x+=current[6];y+=current[7];break;case\"A\":// TODO: optimize this\nbounds=fabric.util.getBoundsOfArc(x,y,current[1],current[2],current[3],current[4],current[5],current[6],current[7]);x=current[6];y=current[7];break;case\"z\":case\"Z\":x=subpathStartX;y=subpathStartY;break;}previous=current;bounds.forEach(function(point){aX.push(point.x);aY.push(point.y);});aX.push(x);aY.push(y);}var minX=min(aX)||0,minY=min(aY)||0,maxX=max(aX)||0,maxY=max(aY)||0,deltaX=maxX-minX,deltaY=maxY-minY;return{left:minX,top:minY,width:deltaX,height:deltaY};}});/**\n   * Creates an instance of fabric.Path from an object\n   * @static\n   * @memberOf fabric.Path\n   * @param {Object} object\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */fabric.Path.fromObject=function(object,callback){if(typeof object.sourcePath===\"string\"){var pathUrl=object.sourcePath;fabric.loadSVGFromURL(pathUrl,function(elements){var path=elements[0];path.setOptions(object);callback&&callback(path);});}else{fabric.Object._fromObject(\"Path\",object,callback,\"path\");}};/* _FROM_SVG_START_ */ /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Path.fromElement`)\n   * @static\n   * @memberOf fabric.Path\n   * @see http://www.w3.org/TR/SVG/paths.html#PathElement\n   */fabric.Path.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat([\"d\"]);/**\n   * Creates an instance of fabric.Path from an SVG <path> element\n   * @static\n   * @memberOf fabric.Path\n   * @param {SVGElement} element to parse\n   * @param {Function} callback Callback to invoke when an fabric.Path instance is created\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   */fabric.Path.fromElement=function(element,callback,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Path.ATTRIBUTE_NAMES);parsedAttributes.fromSVG=true;callback(new fabric.Path(parsedAttributes.d,extend(parsedAttributes,options)));};/* _FROM_SVG_END_ */})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),min=fabric.util.array.min,max=fabric.util.array.max;if(fabric.Group){return;}/**\n   * Group class\n   * @class fabric.Group\n   * @extends fabric.Object\n   * @mixes fabric.Collection\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.Group#initialize} for constructor definition\n   */fabric.Group=fabric.util.createClass(fabric.Object,fabric.Collection,/** @lends fabric.Group.prototype */{/**\n       * Type of an object\n       * @type String\n       * @default\n       */type:\"group\",/**\n       * Width of stroke\n       * @type Number\n       * @default\n       */strokeWidth:0,/**\n       * Indicates if click, mouseover, mouseout events & hoverCursor should also check for subtargets\n       * @type Boolean\n       * @default\n       */subTargetCheck:false,/**\n       * Groups are container, do not render anything on theyr own, ence no cache properties\n       * @type Array\n       * @default\n       */cacheProperties:[],/**\n       * setOnGroup is a method used for TextBox that is no more used since 2.0.0 The behavior is still\n       * available setting this boolean to true.\n       * @type Boolean\n       * @since 2.0.0\n       * @default\n       */useSetOnGroup:false,/**\n       * Constructor\n       * @param {Object} objects Group objects\n       * @param {Object} [options] Options object\n       * @param {Boolean} [isAlreadyGrouped] if true, objects have been grouped already.\n       * @return {Object} thisArg\n       */initialize:function(objects,options,isAlreadyGrouped){options=options||{};this._objects=[];// if objects enclosed in a group have been grouped already,\n// we cannot change properties of objects.\n// Thus we need to set options to group without objects,\nisAlreadyGrouped&&this.callSuper(\"initialize\",options);this._objects=objects||[];for(var i=this._objects.length;i--;){this._objects[i].group=this;}if(!isAlreadyGrouped){var center=options&&options.centerPoint;// we want to set origins before calculating the bounding box.\n// so that the topleft can be set with that in mind.\n// if specific top and left are passed, are overwritten later\n// with the callSuper('initialize', options)\nif(options.originX!==undefined){this.originX=options.originX;}if(options.originY!==undefined){this.originY=options.originY;}// if coming from svg i do not want to calc bounds.\n// i assume width and height are passed along options\ncenter||this._calcBounds();this._updateObjectsCoords(center);delete options.centerPoint;this.callSuper(\"initialize\",options);}else{this._updateObjectsACoords();}this.setCoords();},/**\n       * @private\n       * @param {Boolean} [skipCoordsChange] if true, coordinates of objects enclosed in a group do not change\n       */_updateObjectsACoords:function(){var skipControls=true;for(var i=this._objects.length;i--;){this._objects[i].setCoords(skipControls);}},/**\n       * @private\n       * @param {Boolean} [skipCoordsChange] if true, coordinates of objects enclosed in a group do not change\n       */_updateObjectsCoords:function(center){var center=center||this.getCenterPoint();for(var i=this._objects.length;i--;){this._updateObjectCoords(this._objects[i],center);}},/**\n       * @private\n       * @param {Object} object\n       * @param {fabric.Point} center, current center of group.\n       */_updateObjectCoords:function(object,center){var objectLeft=object.left,objectTop=object.top,skipControls=true;object.set({left:objectLeft-center.x,top:objectTop-center.y});object.group=this;object.setCoords(skipControls);},/**\n       * Returns string represenation of a group\n       * @return {String}\n       */toString:function(){return\"#<fabric.Group: (\"+this.complexity()+\")>\";},/**\n       * Adds an object to a group; Then recalculates group's dimension, position.\n       * @param {Object} object\n       * @return {fabric.Group} thisArg\n       * @chainable\n       */addWithUpdate:function(object){this._restoreObjectsState();fabric.util.resetObjectTransform(this);if(object){this._objects.push(object);object.group=this;object._set(\"canvas\",this.canvas);}this._calcBounds();this._updateObjectsCoords();this.setCoords();this.dirty=true;return this;},/**\n       * Removes an object from a group; Then recalculates group's dimension, position.\n       * @param {Object} object\n       * @return {fabric.Group} thisArg\n       * @chainable\n       */removeWithUpdate:function(object){this._restoreObjectsState();fabric.util.resetObjectTransform(this);this.remove(object);this._calcBounds();this._updateObjectsCoords();this.setCoords();this.dirty=true;return this;},/**\n       * @private\n       */_onObjectAdded:function(object){this.dirty=true;object.group=this;object._set(\"canvas\",this.canvas);},/**\n       * @private\n       */_onObjectRemoved:function(object){this.dirty=true;delete object.group;},/**\n       * @private\n       */_set:function(key,value){var i=this._objects.length;if(this.useSetOnGroup){while(i--){this._objects[i].setOnGroup(key,value);}}if(key===\"canvas\"){while(i--){this._objects[i]._set(key,value);}}fabric.Object.prototype._set.call(this,key,value);},/**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */toObject:function(propertiesToInclude){var _includeDefaultValues=this.includeDefaultValues;var objsToObject=this._objects.map(function(obj){var originalDefaults=obj.includeDefaultValues;obj.includeDefaultValues=_includeDefaultValues;var _obj=obj.toObject(propertiesToInclude);obj.includeDefaultValues=originalDefaults;return _obj;});var obj=fabric.Object.prototype.toObject.call(this,propertiesToInclude);obj.objects=objsToObject;return obj;},/**\n       * Returns object representation of an instance, in dataless mode.\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */toDatalessObject:function(propertiesToInclude){var objsToObject,sourcePath=this.sourcePath;if(sourcePath){objsToObject=sourcePath;}else{var _includeDefaultValues=this.includeDefaultValues;objsToObject=this._objects.map(function(obj){var originalDefaults=obj.includeDefaultValues;obj.includeDefaultValues=_includeDefaultValues;var _obj=obj.toDatalessObject(propertiesToInclude);obj.includeDefaultValues=originalDefaults;return _obj;});}var obj=fabric.Object.prototype.toDatalessObject.call(this,propertiesToInclude);obj.objects=objsToObject;return obj;},/**\n       * Renders instance on a given context\n       * @param {CanvasRenderingContext2D} ctx context to render instance on\n       */render:function(ctx){this._transformDone=true;this.callSuper(\"render\",ctx);this._transformDone=false;},/**\n       * Decide if the object should cache or not. Create its own cache level\n       * needsItsOwnCache should be used when the object drawing method requires\n       * a cache step. None of the fabric classes requires it.\n       * Generally you do not cache objects in groups because the group is already cached.\n       * @return {Boolean}\n       */shouldCache:function(){var ownCache=fabric.Object.prototype.shouldCache.call(this);if(ownCache){for(var i=0,len=this._objects.length;i<len;i++){if(this._objects[i].willDrawShadow()){this.ownCaching=false;return false;}}}return ownCache;},/**\n       * Check if this object or a child object will cast a shadow\n       * @return {Boolean}\n       */willDrawShadow:function(){if(fabric.Object.prototype.willDrawShadow.call(this)){return true;}for(var i=0,len=this._objects.length;i<len;i++){if(this._objects[i].willDrawShadow()){return true;}}return false;},/**\n       * Check if this group or its parent group are caching, recursively up\n       * @return {Boolean}\n       */isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache();},/**\n       * Execute the drawing operation for an object on a specified context\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */drawObject:function(ctx){for(var i=0,len=this._objects.length;i<len;i++){this._objects[i].render(ctx);}this._drawClipPath(ctx);},/**\n       * Check if cache is dirty\n       */isCacheDirty:function(skipCanvas){if(this.callSuper(\"isCacheDirty\",skipCanvas)){return true;}if(!this.statefullCache){return false;}for(var i=0,len=this._objects.length;i<len;i++){if(this._objects[i].isCacheDirty(true)){if(this._cacheCanvas){// if this group has not a cache canvas there is nothing to clean\nvar x=this.cacheWidth/this.zoomX,y=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-x/2,-y/2,x,y);}return true;}}return false;},/**\n       * Retores original state of each of group objects (original state is that which was before group was created).\n       * @private\n       * @return {fabric.Group} thisArg\n       * @chainable\n       */_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this;},/**\n       * Realises the transform from this group onto the supplied object\n       * i.e. it tells you what would happen if the supplied object was in\n       * the group, and then the group was destroyed. It mutates the supplied\n       * object.\n       * @param {fabric.Object} object\n       * @return {fabric.Object} transformedObject\n       */realizeTransform:function(object){var matrix=object.calcTransformMatrix(),options=fabric.util.qrDecompose(matrix),center=new fabric.Point(options.translateX,options.translateY);object.flipX=false;object.flipY=false;object.set(\"scaleX\",options.scaleX);object.set(\"scaleY\",options.scaleY);object.skewX=options.skewX;object.skewY=options.skewY;object.angle=options.angle;object.setPositionByOrigin(center,\"center\",\"center\");return object;},/**\n       * Restores original state of a specified object in group\n       * @private\n       * @param {fabric.Object} object\n       * @return {fabric.Group} thisArg\n       */_restoreObjectState:function(object){this.realizeTransform(object);object.setCoords();delete object.group;return this;},/**\n       * Destroys a group (restoring state of its objects)\n       * @return {fabric.Group} thisArg\n       * @chainable\n       */destroy:function(){// when group is destroyed objects needs to get a repaint to be eventually\n// displayed on canvas.\nthis._objects.forEach(function(object){object.set(\"dirty\",true);});return this._restoreObjectsState();},/**\n       * make a group an active selection, remove the group from canvas\n       * the group has to be on canvas for this to work.\n       * @return {fabric.ActiveSelection} thisArg\n       * @chainable\n       */toActiveSelection:function(){if(!this.canvas){return;}var objects=this._objects,canvas=this.canvas;this._objects=[];var options=this.toObject();delete options.objects;var activeSelection=new fabric.ActiveSelection([]);activeSelection.set(options);activeSelection.type=\"activeSelection\";canvas.remove(this);objects.forEach(function(object){object.group=activeSelection;object.dirty=true;canvas.add(object);});activeSelection.canvas=canvas;activeSelection._objects=objects;canvas._activeObject=activeSelection;activeSelection.setCoords();return activeSelection;},/**\n       * Destroys a group (restoring state of its objects)\n       * @return {fabric.Group} thisArg\n       * @chainable\n       */ungroupOnCanvas:function(){return this._restoreObjectsState();},/**\n       * Sets coordinates of all objects inside group\n       * @return {fabric.Group} thisArg\n       * @chainable\n       */setObjectsCoords:function(){var skipControls=true;this.forEachObject(function(object){object.setCoords(skipControls);});return this;},/**\n       * @private\n       */_calcBounds:function(onlyWidthHeight){var aX=[],aY=[],o,prop,props=[\"tr\",\"br\",\"bl\",\"tl\"],i=0,iLen=this._objects.length,j,jLen=props.length;for(;i<iLen;++i){o=this._objects[i];o.aCoords=o.calcACoords();for(j=0;j<jLen;j++){prop=props[j];aX.push(o.aCoords[prop].x);aY.push(o.aCoords[prop].y);}}this._getBounds(aX,aY,onlyWidthHeight);},/**\n       * @private\n       */_getBounds:function(aX,aY,onlyWidthHeight){var minXY=new fabric.Point(min(aX),min(aY)),maxXY=new fabric.Point(max(aX),max(aY)),top=minXY.y||0,left=minXY.x||0,width=maxXY.x-minXY.x||0,height=maxXY.y-minXY.y||0;this.width=width;this.height=height;if(!onlyWidthHeight){// the bounding box always finds the topleft most corner.\n// whatever is the group origin, we set up here the left/top position.\nthis.setPositionByOrigin({x:left,y:top},\"left\",\"top\");}},/* _TO_SVG_START_ */ /**\n       * Returns svg representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */_toSVG:function(reviver){var svgString=[\"<g \",\"COMMON_PARTS\",\" >\\n\"];for(var i=0,len=this._objects.length;i<len;i++){svgString.push(\"\\t\\t\",this._objects[i].toSVG(reviver));}svgString.push(\"</g>\\n\");return svgString;},/**\n       * Returns styles-string for svg-export, specific version for group\n       * @return {String}\n       */getSvgStyles:function(){var opacity=typeof this.opacity!==\"undefined\"&&this.opacity!==1?\"opacity: \"+this.opacity+\";\":\"\",visibility=this.visible?\"\":\" visibility: hidden;\";return[opacity,this.getSvgFilter(),visibility].join(\"\");},/**\n       * Returns svg clipPath representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */toClipPathSVG:function(reviver){var svgString=[];for(var i=0,len=this._objects.length;i<len;i++){svgString.push(\"\\t\",this._objects[i].toClipPathSVG(reviver));}return this._createBaseClipPathSVGMarkup(svgString,{reviver:reviver});}/* _TO_SVG_END_ */});/**\n   * Returns {@link fabric.Group} instance from an object representation\n   * @static\n   * @memberOf fabric.Group\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an group instance is created\n   */fabric.Group.fromObject=function(object,callback){var objects=object.objects,options=fabric.util.object.clone(object,true);delete options.objects;if(typeof objects===\"string\"){// it has to be an url or something went wrong.\nfabric.loadSVGFromURL(objects,function(elements){var group=fabric.util.groupSVGElements(elements,object,objects);group.set(options);callback&&callback(group);});return;}fabric.util.enlivenObjects(objects,function(enlivenedObjects){fabric.util.enlivenObjects([object.clipPath],function(enlivedClipPath){var options=fabric.util.object.clone(object,true);options.clipPath=enlivedClipPath[0];delete options.objects;callback&&callback(new fabric.Group(enlivenedObjects,options,true));});});};})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={});if(fabric.ActiveSelection){return;}/**\n   * Group class\n   * @class fabric.ActiveSelection\n   * @extends fabric.Group\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.ActiveSelection#initialize} for constructor definition\n   */fabric.ActiveSelection=fabric.util.createClass(fabric.Group,/** @lends fabric.ActiveSelection.prototype */{/**\n       * Type of an object\n       * @type String\n       * @default\n       */type:\"activeSelection\",/**\n       * Constructor\n       * @param {Object} objects ActiveSelection objects\n       * @param {Object} [options] Options object\n       * @return {Object} thisArg\n       */initialize:function(objects,options){options=options||{};this._objects=objects||[];for(var i=this._objects.length;i--;){this._objects[i].group=this;}if(options.originX){this.originX=options.originX;}if(options.originY){this.originY=options.originY;}this._calcBounds();this._updateObjectsCoords();fabric.Object.prototype.initialize.call(this,options);this.setCoords();},/**\n       * Change te activeSelection to a normal group,\n       * High level function that automatically adds it to canvas as\n       * active object. no events fired.\n       * @since 2.0.0\n       * @return {fabric.Group}\n       */toGroup:function(){var objects=this._objects.concat();this._objects=[];var options=fabric.Object.prototype.toObject.call(this);var newGroup=new fabric.Group([]);delete options.type;newGroup.set(options);objects.forEach(function(object){object.canvas.remove(object);object.group=newGroup;});newGroup._objects=objects;if(!this.canvas){return newGroup;}var canvas=this.canvas;canvas.add(newGroup);canvas._activeObject=newGroup;newGroup.setCoords();return newGroup;},/**\n       * If returns true, deselection is cancelled.\n       * @since 2.0.0\n       * @return {Boolean} [cancel]\n       */onDeselect:function(){this.destroy();return false;},/**\n       * Returns string representation of a group\n       * @return {String}\n       */toString:function(){return\"#<fabric.ActiveSelection: (\"+this.complexity()+\")>\";},/**\n       * Decide if the object should cache or not. Create its own cache level\n       * objectCaching is a global flag, wins over everything\n       * needsItsOwnCache should be used when the object drawing method requires\n       * a cache step. None of the fabric classes requires it.\n       * Generally you do not cache objects in groups because the group outside is cached.\n       * @return {Boolean}\n       */shouldCache:function(){return false;},/**\n       * Check if this group or its parent group are caching, recursively up\n       * @return {Boolean}\n       */isOnACache:function(){return false;},/**\n       * Renders controls and borders for the object\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {Object} [styleOverride] properties to override the object style\n       * @param {Object} [childrenOverride] properties to override the children overrides\n       */_renderControls:function(ctx,styleOverride,childrenOverride){ctx.save();ctx.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;this.callSuper(\"_renderControls\",ctx,styleOverride);childrenOverride=childrenOverride||{};if(typeof childrenOverride.hasControls===\"undefined\"){childrenOverride.hasControls=false;}childrenOverride.forActiveSelection=true;for(var i=0,len=this._objects.length;i<len;i++){this._objects[i]._renderControls(ctx,childrenOverride);}ctx.restore();}});/**\n   * Returns {@link fabric.ActiveSelection} instance from an object representation\n   * @static\n   * @memberOf fabric.ActiveSelection\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an ActiveSelection instance is created\n   */fabric.ActiveSelection.fromObject=function(object,callback){fabric.util.enlivenObjects(object.objects,function(enlivenedObjects){delete object.objects;callback&&callback(new fabric.ActiveSelection(enlivenedObjects,object,true));});};})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var extend=fabric.util.object.extend;if(!global.fabric){global.fabric={};}if(global.fabric.Image){fabric.warn(\"fabric.Image is already defined.\");return;}/**\n   * Image class\n   * @class fabric.Image\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#images}\n   * @see {@link fabric.Image#initialize} for constructor definition\n   */fabric.Image=fabric.util.createClass(fabric.Object,/** @lends fabric.Image.prototype */{/**\n       * Type of an object\n       * @type String\n       * @default\n       */type:\"image\",/**\n       * Width of a stroke.\n       * For image quality a stroke multiple of 2 gives better results.\n       * @type Number\n       * @default\n       */strokeWidth:0,/**\n       * When calling {@link fabric.Image.getSrc}, return value from element src with `element.getAttribute('src')`.\n       * This allows for relative urls as image src.\n       * @since 2.7.0\n       * @type Boolean\n       * @default\n       */srcFromAttribute:false,/**\n       * private\n       * contains last value of scaleX to detect\n       * if the Image got resized after the last Render\n       * @type Number\n       */_lastScaleX:1,/**\n       * private\n       * contains last value of scaleY to detect\n       * if the Image got resized after the last Render\n       * @type Number\n       */_lastScaleY:1,/**\n       * private\n       * contains last value of scaling applied by the apply filter chain\n       * @type Number\n       */_filterScalingX:1,/**\n       * private\n       * contains last value of scaling applied by the apply filter chain\n       * @type Number\n       */_filterScalingY:1,/**\n       * minimum scale factor under which any resizeFilter is triggered to resize the image\n       * 0 will disable the automatic resize. 1 will trigger automatically always.\n       * number bigger than 1 are not implemented yet.\n       * @type Number\n       */minimumScaleTrigger:0.5,/**\n       * List of properties to consider when checking if\n       * state of an object is changed ({@link fabric.Object#hasStateChanged})\n       * as well as for history (undo/redo) purposes\n       * @type Array\n       */stateProperties:fabric.Object.prototype.stateProperties.concat(\"cropX\",\"cropY\"),/**\n       * key used to retrieve the texture representing this image\n       * @since 2.0.0\n       * @type String\n       * @default\n       */cacheKey:\"\",/**\n       * Image crop in pixels from original image size.\n       * @since 2.0.0\n       * @type Number\n       * @default\n       */cropX:0,/**\n       * Image crop in pixels from original image size.\n       * @since 2.0.0\n       * @type Number\n       * @default\n       */cropY:0,/**\n       * Indicates whether this canvas will use image smoothing when painting this image.\n       * Also influence if the cacheCanvas for this image uses imageSmoothing\n       * @since 4.0.0-beta.11\n       * @type Boolean\n       * @default\n       */imageSmoothing:true,/**\n       * Constructor\n       * @param {HTMLImageElement | String} element Image element\n       * @param {Object} [options] Options object\n       * @param {function} [callback] callback function to call after eventual filters applied.\n       * @return {fabric.Image} thisArg\n       */initialize:function(element,options){options||(options={});this.filters=[];this.cacheKey=\"texture\"+fabric.Object.__uid++;this.callSuper(\"initialize\",options);this._initElement(element,options);},/**\n       * Returns image element which this instance if based on\n       * @return {HTMLImageElement} Image element\n       */getElement:function(){return this._element||{};},/**\n       * Sets image element for this instance to a specified one.\n       * If filters defined they are applied to new image.\n       * You might need to call `canvas.renderAll` and `object.setCoords` after replacing, to render new image and update controls area.\n       * @param {HTMLImageElement} element\n       * @param {Object} [options] Options object\n       * @return {fabric.Image} thisArg\n       * @chainable\n       */setElement:function(element,options){this.removeTexture(this.cacheKey);this.removeTexture(this.cacheKey+\"_filtered\");this._element=element;this._originalElement=element;this._initConfig(options);if(this.filters.length!==0){this.applyFilters();}// resizeFilters work on the already filtered copy.\n// we need to apply resizeFilters AFTER normal filters.\n// applyResizeFilters is run more often than normal fiters\n// and is triggered by user interactions rather than dev code\nif(this.resizeFilter){this.applyResizeFilters();}return this;},/**\n       * Delete a single texture if in webgl mode\n       */removeTexture:function(key){var backend=fabric.filterBackend;if(backend&&backend.evictCachesForKey){backend.evictCachesForKey(key);}},/**\n       * Delete textures, reference to elements and eventually JSDOM cleanup\n       */dispose:function(){this.removeTexture(this.cacheKey);this.removeTexture(this.cacheKey+\"_filtered\");this._cacheContext=undefined;[\"_originalElement\",\"_element\",\"_filteredEl\",\"_cacheCanvas\"].forEach(function(element){fabric.util.cleanUpJsdomNode(this[element]);this[element]=undefined;}.bind(this));},/**\n       * Get the crossOrigin value (of the corresponding image element)\n       */getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null);},/**\n       * Returns original size of an image\n       * @return {Object} Object with \"width\" and \"height\" properties\n       */getOriginalSize:function(){var element=this.getElement();return{width:element.naturalWidth||element.width,height:element.naturalHeight||element.height};},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_stroke:function(ctx){if(!this.stroke||this.strokeWidth===0){return;}var w=this.width/2,h=this.height/2;ctx.beginPath();ctx.moveTo(-w,-h);ctx.lineTo(w,-h);ctx.lineTo(w,h);ctx.lineTo(-w,h);ctx.lineTo(-w,-h);ctx.closePath();},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderDashedStroke:function(ctx){var x=-this.width/2,y=-this.height/2,w=this.width,h=this.height;ctx.save();this._setStrokeStyles(ctx,this);ctx.beginPath();fabric.util.drawDashedLine(ctx,x,y,x+w,y,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x+w,y,x+w,y+h,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x+w,y+h,x,y+h,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x,y+h,x,y,this.strokeDashArray);ctx.closePath();ctx.restore();},/**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} Object representation of an instance\n       */toObject:function(propertiesToInclude){var filters=[];this.filters.forEach(function(filterObj){if(filterObj){filters.push(filterObj.toObject());}});var object=extend(this.callSuper(\"toObject\",[\"cropX\",\"cropY\"].concat(propertiesToInclude)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:filters});if(this.resizeFilter){object.resizeFilter=this.resizeFilter.toObject();}return object;},/**\n       * Returns true if an image has crop applied, inspecting values of cropX,cropY,width,hight.\n       * @return {Boolean}\n       */hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height;},/* _TO_SVG_START_ */ /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */_toSVG:function(){var svgString=[],imageMarkup=[],strokeSvg,element=this._element,x=-this.width/2,y=-this.height/2,clipPath=\"\",imageRendering=\"\";if(!element){return[];}if(this.hasCrop()){var clipPathId=fabric.Object.__uid++;svgString.push('<clipPath id=\"imageCrop_'+clipPathId+'\">\\n','\\t<rect x=\"'+x+'\" y=\"'+y+'\" width=\"'+this.width+'\" height=\"'+this.height+'\" />\\n',\"</clipPath>\\n\");clipPath=' clip-path=\"url(#imageCrop_'+clipPathId+')\" ';}if(!this.imageSmoothing){imageRendering='\" image-rendering=\"optimizeSpeed';}imageMarkup.push(\"\\t<image \",\"COMMON_PARTS\",'xlink:href=\"',this.getSvgSrc(true),'\" x=\"',x-this.cropX,'\" y=\"',y-this.cropY,// we're essentially moving origin of transformation from top/left corner to the center of the shape\n// by wrapping it in container <g> element with actual transformation, then offsetting object to the top/left\n// so that object's center aligns with container's left/top\n'\" width=\"',element.width||element.naturalWidth,'\" height=\"',element.height||element.height,imageRendering,'\"',clipPath,\"></image>\\n\");if(this.stroke||this.strokeDashArray){var origFill=this.fill;this.fill=null;strokeSvg=[\"\\t<rect \",'x=\"',x,'\" y=\"',y,'\" width=\"',this.width,'\" height=\"',this.height,'\" style=\"',this.getSvgStyles(),'\"/>\\n'];this.fill=origFill;}if(this.paintFirst!==\"fill\"){svgString=svgString.concat(strokeSvg,imageMarkup);}else{svgString=svgString.concat(imageMarkup,strokeSvg);}return svgString;},/* _TO_SVG_END_ */ /**\n       * Returns source of an image\n       * @param {Boolean} filtered indicates if the src is needed for svg\n       * @return {String} Source of an image\n       */getSrc:function(filtered){var element=filtered?this._element:this._originalElement;if(element){if(element.toDataURL){return element.toDataURL();}if(this.srcFromAttribute){return element.getAttribute(\"src\");}else{return element.src;}}else{return this.src||\"\";}},/**\n       * Sets source of an image\n       * @param {String} src Source string (URL)\n       * @param {Function} [callback] Callback is invoked when image has been loaded (and all filters have been applied)\n       * @param {Object} [options] Options object\n       * @param {String} [options.crossOrigin] crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n       * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n       * @return {fabric.Image} thisArg\n       * @chainable\n       */setSrc:function(src,callback,options){fabric.util.loadImage(src,function(img,isError){this.setElement(img,options);this._setWidthHeight();callback&&callback(this,isError);},this,options&&options.crossOrigin);return this;},/**\n       * Returns string representation of an instance\n       * @return {String} String representation of an instance\n       */toString:function(){return'#<fabric.Image: { src: \"'+this.getSrc()+'\" }>';},applyResizeFilters:function(){var filter=this.resizeFilter,minimumScale=this.minimumScaleTrigger,objectScale=this.getTotalObjectScaling(),scaleX=objectScale.scaleX,scaleY=objectScale.scaleY,elementToFilter=this._filteredEl||this._originalElement;if(this.group){this.set(\"dirty\",true);}if(!filter||scaleX>minimumScale&&scaleY>minimumScale){this._element=elementToFilter;this._filterScalingX=1;this._filterScalingY=1;this._lastScaleX=scaleX;this._lastScaleY=scaleY;return;}if(!fabric.filterBackend){fabric.filterBackend=fabric.initFilterBackend();}var canvasEl=fabric.util.createCanvasElement(),cacheKey=this._filteredEl?this.cacheKey+\"_filtered\":this.cacheKey,sourceWidth=elementToFilter.width,sourceHeight=elementToFilter.height;canvasEl.width=sourceWidth;canvasEl.height=sourceHeight;this._element=canvasEl;this._lastScaleX=filter.scaleX=scaleX;this._lastScaleY=filter.scaleY=scaleY;fabric.filterBackend.applyFilters([filter],elementToFilter,sourceWidth,sourceHeight,this._element,cacheKey);this._filterScalingX=canvasEl.width/this._originalElement.width;this._filterScalingY=canvasEl.height/this._originalElement.height;},/**\n       * Applies filters assigned to this image (from \"filters\" array) or from filter param\n       * @method applyFilters\n       * @param {Array} filters to be applied\n       * @param {Boolean} forResizing specify if the filter operation is a resize operation\n       * @return {thisArg} return the fabric.Image object\n       * @chainable\n       */applyFilters:function(filters){filters=filters||this.filters||[];filters=filters.filter(function(filter){return filter&&!filter.isNeutralState();});this.set(\"dirty\",true);// needs to clear out or WEBGL will not resize correctly\nthis.removeTexture(this.cacheKey+\"_filtered\");if(filters.length===0){this._element=this._originalElement;this._filteredEl=null;this._filterScalingX=1;this._filterScalingY=1;return this;}var imgElement=this._originalElement,sourceWidth=imgElement.naturalWidth||imgElement.width,sourceHeight=imgElement.naturalHeight||imgElement.height;if(this._element===this._originalElement){// if the element is the same we need to create a new element\nvar canvasEl=fabric.util.createCanvasElement();canvasEl.width=sourceWidth;canvasEl.height=sourceHeight;this._element=canvasEl;this._filteredEl=canvasEl;}else{// clear the existing element to get new filter data\n// also dereference the eventual resized _element\nthis._element=this._filteredEl;this._filteredEl.getContext(\"2d\").clearRect(0,0,sourceWidth,sourceHeight);// we also need to resize again at next renderAll, so remove saved _lastScaleX/Y\nthis._lastScaleX=1;this._lastScaleY=1;}if(!fabric.filterBackend){fabric.filterBackend=fabric.initFilterBackend();}fabric.filterBackend.applyFilters(filters,this._originalElement,sourceWidth,sourceHeight,this._element,this.cacheKey);if(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height){this._filterScalingX=this._element.width/this._originalElement.width;this._filterScalingY=this._element.height/this._originalElement.height;}return this;},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_render:function(ctx){fabric.util.setImageSmoothing(ctx,this.imageSmoothing);if(this.isMoving!==true&&this.resizeFilter&&this._needsResize()){this.applyResizeFilters();}this._stroke(ctx);this._renderPaintInOrder(ctx);},/**\n       * Paint the cached copy of the object on the target context.\n       * it will set the imageSmoothing for the draw operation\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */drawCacheOnCanvas:function(ctx){fabric.util.setImageSmoothing(ctx,this.imageSmoothing);fabric.Object.prototype.drawCacheOnCanvas.call(this,ctx);},/**\n       * Decide if the object should cache or not. Create its own cache level\n       * needsItsOwnCache should be used when the object drawing method requires\n       * a cache step. None of the fabric classes requires it.\n       * Generally you do not cache objects in groups because the group outside is cached.\n       * This is the special image version where we would like to avoid caching where possible.\n       * Essentially images do not benefit from caching. They may require caching, and in that\n       * case we do it. Also caching an image usually ends in a loss of details.\n       * A full performance audit should be done.\n       * @return {Boolean}\n       */shouldCache:function(){return this.needsItsOwnCache();},_renderFill:function(ctx){var elementToDraw=this._element;if(!elementToDraw){return;}var w=this.width,h=this.height,sW=Math.min(elementToDraw.naturalWidth||elementToDraw.width,w*this._filterScalingX),sH=Math.min(elementToDraw.naturalHeight||elementToDraw.height,h*this._filterScalingY),x=-w/2,y=-h/2,sX=Math.max(0,this.cropX*this._filterScalingX),sY=Math.max(0,this.cropY*this._filterScalingY);elementToDraw&&ctx.drawImage(elementToDraw,sX,sY,sW,sH,x,y,w,h);},/**\n       * needed to check if image needs resize\n       * @private\n       */_needsResize:function(){var scale=this.getTotalObjectScaling();return scale.scaleX!==this._lastScaleX||scale.scaleY!==this._lastScaleY;},/**\n       * @private\n       */_resetWidthHeight:function(){this.set(this.getOriginalSize());},/**\n       * The Image class's initialization method. This method is automatically\n       * called by the constructor.\n       * @private\n       * @param {HTMLImageElement|String} element The element representing the image\n       * @param {Object} [options] Options object\n       */_initElement:function(element,options){this.setElement(fabric.util.getById(element),options);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS);},/**\n       * @private\n       * @param {Object} [options] Options object\n       */_initConfig:function(options){options||(options={});this.setOptions(options);this._setWidthHeight(options);},/**\n       * @private\n       * @param {Array} filters to be initialized\n       * @param {Function} callback Callback to invoke when all fabric.Image.filters instances are created\n       */_initFilters:function(filters,callback){if(filters&&filters.length){fabric.util.enlivenObjects(filters,function(enlivenedObjects){callback&&callback(enlivenedObjects);},\"fabric.Image.filters\");}else{callback&&callback();}},/**\n       * @private\n       * Set the width and the height of the image object, using the element or the\n       * options.\n       * @param {Object} [options] Object with width/height properties\n       */_setWidthHeight:function(options){options||(options={});var el=this.getElement();this.width=options.width||el.naturalWidth||el.width||0;this.height=options.height||el.naturalHeight||el.height||0;},/**\n       * Calculate offset for center and scale factor for the image in order to respect\n       * the preserveAspectRatio attribute\n       * @private\n       * @return {Object}\n       */parsePreserveAspectRatioAttribute:function(){var pAR=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||\"\"),rWidth=this._element.width,rHeight=this._element.height,scaleX=1,scaleY=1,offsetLeft=0,offsetTop=0,cropX=0,cropY=0,offset,pWidth=this.width,pHeight=this.height,parsedAttributes={width:pWidth,height:pHeight};if(pAR&&(pAR.alignX!==\"none\"||pAR.alignY!==\"none\")){if(pAR.meetOrSlice===\"meet\"){scaleX=scaleY=fabric.util.findScaleToFit(this._element,parsedAttributes);offset=(pWidth-rWidth*scaleX)/2;if(pAR.alignX===\"Min\"){offsetLeft=-offset;}if(pAR.alignX===\"Max\"){offsetLeft=offset;}offset=(pHeight-rHeight*scaleY)/2;if(pAR.alignY===\"Min\"){offsetTop=-offset;}if(pAR.alignY===\"Max\"){offsetTop=offset;}}if(pAR.meetOrSlice===\"slice\"){scaleX=scaleY=fabric.util.findScaleToCover(this._element,parsedAttributes);offset=rWidth-pWidth/scaleX;if(pAR.alignX===\"Mid\"){cropX=offset/2;}if(pAR.alignX===\"Max\"){cropX=offset;}offset=rHeight-pHeight/scaleY;if(pAR.alignY===\"Mid\"){cropY=offset/2;}if(pAR.alignY===\"Max\"){cropY=offset;}rWidth=pWidth/scaleX;rHeight=pHeight/scaleY;}}else{scaleX=pWidth/rWidth;scaleY=pHeight/rHeight;}return{width:rWidth,height:rHeight,scaleX:scaleX,scaleY:scaleY,offsetLeft:offsetLeft,offsetTop:offsetTop,cropX:cropX,cropY:cropY};}});/**\n   * Default CSS class name for canvas\n   * @static\n   * @type String\n   * @default\n   */fabric.Image.CSS_CANVAS=\"canvas-img\";/**\n   * Alias for getSrc\n   * @static\n   */fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;/**\n   * Creates an instance of fabric.Image from its object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} callback Callback to invoke when an image instance is created\n   */fabric.Image.fromObject=function(_object,callback){var object=fabric.util.object.clone(_object);fabric.util.loadImage(object.src,function(img,isError){if(isError){callback&&callback(null,true);return;}fabric.Image.prototype._initFilters.call(object,object.filters,function(filters){object.filters=filters||[];fabric.Image.prototype._initFilters.call(object,[object.resizeFilter],function(resizeFilters){object.resizeFilter=resizeFilters[0];fabric.util.enlivenObjects([object.clipPath],function(enlivedProps){object.clipPath=enlivedProps[0];var image=new fabric.Image(img,object);callback(image,false);});});});},null,object.crossOrigin);};/**\n   * Creates an instance of fabric.Image from an URL string\n   * @static\n   * @param {String} url URL to create an image from\n   * @param {Function} [callback] Callback to invoke when image is created (newly created image is passed as a first argument). Second argument is a boolean indicating if an error occured or not.\n   * @param {Object} [imgOptions] Options object\n   */fabric.Image.fromURL=function(url,callback,imgOptions){fabric.util.loadImage(url,function(img,isError){callback&&callback(new fabric.Image(img,imgOptions),isError);},null,imgOptions&&imgOptions.crossOrigin);};/* _FROM_SVG_START_ */ /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Image.fromElement})\n   * @static\n   * @see {@link http://www.w3.org/TR/SVG/struct.html#ImageElement}\n   */fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(\"x y width height preserveAspectRatio xlink:href crossOrigin image-rendering\".split(\" \"));/**\n   * Returns {@link fabric.Image} instance from an SVG element\n   * @static\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} callback Callback to execute when fabric.Image object is created\n   * @return {fabric.Image} Instance of fabric.Image\n   */fabric.Image.fromElement=function(element,callback,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(parsedAttributes[\"xlink:href\"],callback,extend(options?fabric.util.object.clone(options):{},parsedAttributes));};/* _FROM_SVG_END_ */})(typeof exports!==\"undefined\"?exports:this);fabric.util.object.extend(fabric.Object.prototype,/** @lends fabric.Object.prototype */{/**\n     * @private\n     * @return {Number} angle value\n     */_getAngleValueForStraighten:function(){var angle=this.angle%360;if(angle>0){return Math.round((angle-1)/90)*90;}return Math.round(angle/90)*90;},/**\n     * Straightens an object (rotating it from current angle to one of 0, 90, 180, 270, etc. depending on which is closer)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */straighten:function(){this.rotate(this._getAngleValueForStraighten());return this;},/**\n     * Same as {@link fabric.Object.prototype.straighten} but with animation\n     * @param {Object} callbacks Object with callback functions\n     * @param {Function} [callbacks.onComplete] Invoked on completion\n     * @param {Function} [callbacks.onChange] Invoked on every step of animation\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */fxStraighten:function(callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:this.get(\"angle\"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(value){_this.rotate(value);onChange();},onComplete:function(){_this.setCoords();onComplete();}});return this;}});fabric.util.object.extend(fabric.StaticCanvas.prototype,/** @lends fabric.StaticCanvas.prototype */{/**\n     * Straightens object, then rerenders canvas\n     * @param {fabric.Object} object Object to straighten\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */straightenObject:function(object){object.straighten();this.requestRenderAll();return this;},/**\n     * Same as {@link fabric.Canvas.prototype.straightenObject}, but animated\n     * @param {fabric.Object} object Object to straighten\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */fxStraightenObject:function(object){object.fxStraighten({onChange:this.requestRenderAllBound});return this;}});(function(){\"use strict\";/**\n   * Tests if webgl supports certain precision\n   * @param {WebGL} Canvas WebGL context to test on\n   * @param {String} Precision to test can be any of following: 'lowp', 'mediump', 'highp'\n   * @returns {Boolean} Whether the user's browser WebGL supports given precision.\n   */function testPrecision(gl,precision){var fragmentSource=\"precision \"+precision+\" float;\\nvoid main(){}\";var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,fragmentSource);gl.compileShader(fragmentShader);if(!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)){return false;}return true;}/**\n   * Indicate whether this filtering backend is supported by the user's browser.\n   * @param {Number} tileSize check if the tileSize is supported\n   * @returns {Boolean} Whether the user's browser supports WebGL.\n   */fabric.isWebglSupported=function(tileSize){if(fabric.isLikelyNode){return false;}tileSize=tileSize||fabric.WebglFilterBackend.prototype.tileSize;var canvas=document.createElement(\"canvas\");var gl=canvas.getContext(\"webgl\")||canvas.getContext(\"experimental-webgl\");var isSupported=false;// eslint-disable-next-line\nif(gl){fabric.maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);isSupported=fabric.maxTextureSize>=tileSize;var precisions=[\"highp\",\"mediump\",\"lowp\"];for(var i=0;i<3;i++){if(testPrecision(gl,precisions[i])){fabric.webGlPrecision=precisions[i];break;}}}this.isSupported=isSupported;return isSupported;};fabric.WebglFilterBackend=WebglFilterBackend;/**\n   * WebGL filter backend.\n   */function WebglFilterBackend(options){if(options&&options.tileSize){this.tileSize=options.tileSize;}this.setupGLContext(this.tileSize,this.tileSize);this.captureGPUInfo();}WebglFilterBackend.prototype=/** @lends fabric.WebglFilterBackend.prototype */{tileSize:2048,/**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you problably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/resources:{},/**\n     * Setup a WebGL context suitable for filtering, and bind any needed event handlers.\n     */setupGLContext:function(width,height){this.dispose();this.createWebGLCanvas(width,height);// eslint-disable-next-line\nthis.aPosition=new Float32Array([0,0,0,1,1,0,1,1]);this.chooseFastestCopyGLTo2DMethod(width,height);},/**\n     * Pick a method to copy data from GL context to 2d canvas.  In some browsers using\n     * putImageData is faster than drawImage for that specific operation.\n     */chooseFastestCopyGLTo2DMethod:function(width,height){var canMeasurePerf=typeof window.performance!==\"undefined\",canUseImageData;try{new ImageData(1,1);canUseImageData=true;}catch(e){canUseImageData=false;}// eslint-disable-next-line no-undef\nvar canUseArrayBuffer=typeof ArrayBuffer!==\"undefined\";// eslint-disable-next-line no-undef\nvar canUseUint8Clamped=typeof Uint8ClampedArray!==\"undefined\";if(!(canMeasurePerf&&canUseImageData&&canUseArrayBuffer&&canUseUint8Clamped)){return;}var targetCanvas=fabric.util.createCanvasElement();// eslint-disable-next-line no-undef\nvar imageBuffer=new ArrayBuffer(width*height*4);if(fabric.forceGLPutImageData){this.imageBuffer=imageBuffer;this.copyGLTo2D=copyGLTo2DPutImageData;return;}var testContext={imageBuffer:imageBuffer,destinationWidth:width,destinationHeight:height,targetCanvas:targetCanvas};var startTime,drawImageTime,putImageDataTime;targetCanvas.width=width;targetCanvas.height=height;startTime=window.performance.now();copyGLTo2DDrawImage.call(testContext,this.gl,testContext);drawImageTime=window.performance.now()-startTime;startTime=window.performance.now();copyGLTo2DPutImageData.call(testContext,this.gl,testContext);putImageDataTime=window.performance.now()-startTime;if(drawImageTime>putImageDataTime){this.imageBuffer=imageBuffer;this.copyGLTo2D=copyGLTo2DPutImageData;}else{this.copyGLTo2D=copyGLTo2DDrawImage;}},/**\n     * Create a canvas element and associated WebGL context and attaches them as\n     * class properties to the GLFilterBackend class.\n     */createWebGLCanvas:function(width,height){var canvas=fabric.util.createCanvasElement();canvas.width=width;canvas.height=height;var glOptions={alpha:true,premultipliedAlpha:false,depth:false,stencil:false,antialias:false},gl=canvas.getContext(\"webgl\",glOptions);if(!gl){gl=canvas.getContext(\"experimental-webgl\",glOptions);}if(!gl){return;}gl.clearColor(0,0,0,0);// this canvas can fire webglcontextlost and webglcontextrestored\nthis.canvas=canvas;this.gl=gl;},/**\n     * Attempts to apply the requested filters to the source provided, drawing the filtered output\n     * to the provided target canvas.\n     *\n     * @param {Array} filters The filters to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} source The source to be filtered.\n     * @param {Number} width The width of the source input.\n     * @param {Number} height The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     * @param {String|undefined} cacheKey A key used to cache resources related to the source. If\n     * omitted, caching will be skipped.\n     */applyFilters:function(filters,source,width,height,targetCanvas,cacheKey){var gl=this.gl;var cachedTexture;if(cacheKey){cachedTexture=this.getCachedTexture(cacheKey,source);}var pipelineState={originalWidth:source.width||source.originalWidth,originalHeight:source.height||source.originalHeight,sourceWidth:width,sourceHeight:height,destinationWidth:width,destinationHeight:height,context:gl,sourceTexture:this.createTexture(gl,width,height,!cachedTexture&&source),targetTexture:this.createTexture(gl,width,height),originalTexture:cachedTexture||this.createTexture(gl,width,height,!cachedTexture&&source),passes:filters.length,webgl:true,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:targetCanvas};var tempFbo=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,tempFbo);filters.forEach(function(filter){filter&&filter.applyTo(pipelineState);});resizeCanvasIfNeeded(pipelineState);this.copyGLTo2D(gl,pipelineState);gl.bindTexture(gl.TEXTURE_2D,null);gl.deleteTexture(pipelineState.sourceTexture);gl.deleteTexture(pipelineState.targetTexture);gl.deleteFramebuffer(tempFbo);targetCanvas.getContext(\"2d\").setTransform(1,0,0,1,0,0);return pipelineState;},/**\n     * Detach event listeners, remove references, and clean up caches.\n     */dispose:function(){if(this.canvas){this.canvas=null;this.gl=null;}this.clearWebGLCaches();},/**\n     * Wipe out WebGL-related caches.\n     */clearWebGLCaches:function(){this.programCache={};this.textureCache={};},/**\n     * Create a WebGL texture object.\n     *\n     * Accepts specific dimensions to initialize the textuer to or a source image.\n     *\n     * @param {WebGLRenderingContext} gl The GL context to use for creating the texture.\n     * @param {Number} width The width to initialize the texture at.\n     * @param {Number} height The height to initialize the texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source for the texture data.\n     * @returns {WebGLTexture}\n     */createTexture:function(gl,width,height,textureImageSource){var texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);if(textureImageSource){gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,textureImageSource);}else{gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);}return texture;},/**\n     * Can be optionally used to get a texture from the cache array\n     *\n     * If an existing texture is not found, a new texture is created and cached.\n     *\n     * @param {String} uniqueId A cache key to use to find an existing texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source to use to create the\n     * texture cache entry if one does not already exist.\n     */getCachedTexture:function(uniqueId,textureImageSource){if(this.textureCache[uniqueId]){return this.textureCache[uniqueId];}else{var texture=this.createTexture(this.gl,textureImageSource.width,textureImageSource.height,textureImageSource);this.textureCache[uniqueId]=texture;return texture;}},/**\n     * Clear out cached resources related to a source image that has been\n     * filtered previously.\n     *\n     * @param {String} cacheKey The cache key provided when the source image was filtered.\n     */evictCachesForKey:function(cacheKey){if(this.textureCache[cacheKey]){this.gl.deleteTexture(this.textureCache[cacheKey]);delete this.textureCache[cacheKey];}},copyGLTo2D:copyGLTo2DDrawImage,/**\n     * Attempt to extract GPU information strings from a WebGL context.\n     *\n     * Useful information when debugging or blacklisting specific GPUs.\n     *\n     * @returns {Object} A GPU info object with renderer and vendor strings.\n     */captureGPUInfo:function(){if(this.gpuInfo){return this.gpuInfo;}var gl=this.gl,gpuInfo={renderer:\"\",vendor:\"\"};if(!gl){return gpuInfo;}var ext=gl.getExtension(\"WEBGL_debug_renderer_info\");if(ext){var renderer=gl.getParameter(ext.UNMASKED_RENDERER_WEBGL);var vendor=gl.getParameter(ext.UNMASKED_VENDOR_WEBGL);if(renderer){gpuInfo.renderer=renderer.toLowerCase();}if(vendor){gpuInfo.vendor=vendor.toLowerCase();}}this.gpuInfo=gpuInfo;return gpuInfo;}};})();function resizeCanvasIfNeeded(pipelineState){var targetCanvas=pipelineState.targetCanvas,width=targetCanvas.width,height=targetCanvas.height,dWidth=pipelineState.destinationWidth,dHeight=pipelineState.destinationHeight;if(width!==dWidth||height!==dHeight){targetCanvas.width=dWidth;targetCanvas.height=dHeight;}}/**\n * Copy an input WebGL canvas on to an output 2D canvas.\n *\n * The WebGL canvas is assumed to be upside down, with the top-left pixel of the\n * desired output image appearing in the bottom-left corner of the WebGL canvas.\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */function copyGLTo2DDrawImage(gl,pipelineState){var glCanvas=gl.canvas,targetCanvas=pipelineState.targetCanvas,ctx=targetCanvas.getContext(\"2d\");ctx.translate(0,targetCanvas.height);// move it down again\nctx.scale(1,-1);// vertical flip\n// where is my image on the big glcanvas?\nvar sourceY=glCanvas.height-targetCanvas.height;ctx.drawImage(glCanvas,0,sourceY,targetCanvas.width,targetCanvas.height,0,0,targetCanvas.width,targetCanvas.height);}/**\n * Copy an input WebGL canvas on to an output 2D canvas using 2d canvas' putImageData\n * API. Measurably faster than using ctx.drawImage in Firefox (version 54 on OSX Sierra).\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */function copyGLTo2DPutImageData(gl,pipelineState){var targetCanvas=pipelineState.targetCanvas,ctx=targetCanvas.getContext(\"2d\"),dWidth=pipelineState.destinationWidth,dHeight=pipelineState.destinationHeight,numBytes=dWidth*dHeight*4;// eslint-disable-next-line no-undef\nvar u8=new Uint8Array(this.imageBuffer,0,numBytes);// eslint-disable-next-line no-undef\nvar u8Clamped=new Uint8ClampedArray(this.imageBuffer,0,numBytes);gl.readPixels(0,0,dWidth,dHeight,gl.RGBA,gl.UNSIGNED_BYTE,u8);var imgData=new ImageData(u8Clamped,dWidth,dHeight);ctx.putImageData(imgData,0,0);}(function(){\"use strict\";var noop=function(){};fabric.Canvas2dFilterBackend=Canvas2dFilterBackend;/**\n   * Canvas 2D filter backend.\n   */function Canvas2dFilterBackend(){}Canvas2dFilterBackend.prototype=/** @lends fabric.Canvas2dFilterBackend.prototype */{evictCachesForKey:noop,dispose:noop,clearWebGLCaches:noop,/**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you probably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/resources:{},/**\n     * Apply a set of filters against a source image and draw the filtered output\n     * to the provided destination canvas.\n     *\n     * @param {EnhancedFilter} filters The filter to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} sourceElement The source to be filtered.\n     * @param {Number} sourceWidth The width of the source input.\n     * @param {Number} sourceHeight The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     */applyFilters:function(filters,sourceElement,sourceWidth,sourceHeight,targetCanvas){var ctx=targetCanvas.getContext(\"2d\");ctx.drawImage(sourceElement,0,0,sourceWidth,sourceHeight);var imageData=ctx.getImageData(0,0,sourceWidth,sourceHeight);var originalImageData=ctx.getImageData(0,0,sourceWidth,sourceHeight);var pipelineState={sourceWidth:sourceWidth,sourceHeight:sourceHeight,imageData:imageData,originalEl:sourceElement,originalImageData:originalImageData,canvasEl:targetCanvas,ctx:ctx,filterBackend:this};filters.forEach(function(filter){filter.applyTo(pipelineState);});if(pipelineState.imageData.width!==sourceWidth||pipelineState.imageData.height!==sourceHeight){targetCanvas.width=pipelineState.imageData.width;targetCanvas.height=pipelineState.imageData.height;}ctx.putImageData(pipelineState.imageData,0,0);return pipelineState;}};})();/**\n * @namespace fabric.Image.filters\n * @memberOf fabric.Image\n * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#image_filters}\n * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n */fabric.Image=fabric.Image||{};fabric.Image.filters=fabric.Image.filters||{};/**\n * Root filter class from which all filter classes inherit from\n * @class fabric.Image.filters.BaseFilter\n * @memberOf fabric.Image.filters\n */fabric.Image.filters.BaseFilter=fabric.util.createClass(/** @lends fabric.Image.filters.BaseFilter.prototype */{/**\n     * Filter type\n     * @param {String} type\n     * @default\n     */type:\"BaseFilter\",/**\n     * Array of attributes to send with buffers. do not modify\n     * @private\n     */vertexSource:\"attribute vec2 aPosition;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vTexCoord = aPosition;\\n\"+\"gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n\"+\"}\",fragmentSource:\"precision highp float;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"void main() {\\n\"+\"gl_FragColor = texture2D(uTexture, vTexCoord);\\n\"+\"}\",/**\n     * Constructor\n     * @param {Object} [options] Options object\n     */initialize:function(options){if(options){this.setOptions(options);}},/**\n     * Sets filter's properties from options\n     * @param {Object} [options] Options object\n     */setOptions:function(options){for(var prop in options){this[prop]=options[prop];}},/**\n     * Compile this filter's shader program.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context to use for shader compilation.\n     * @param {String} fragmentSource fragmentShader source for compilation\n     * @param {String} vertexSource vertexShader source for compilation\n     */createProgram:function(gl,fragmentSource,vertexSource){fragmentSource=fragmentSource||this.fragmentSource;vertexSource=vertexSource||this.vertexSource;if(fabric.webGlPrecision!==\"highp\"){fragmentSource=fragmentSource.replace(/precision highp float/g,\"precision \"+fabric.webGlPrecision+\" float\");}var vertexShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertexShader,vertexSource);gl.compileShader(vertexShader);if(!gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)){throw new Error(// eslint-disable-next-line prefer-template\n\"Vertex shader compile error for \"+this.type+\": \"+gl.getShaderInfoLog(vertexShader));}var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,fragmentSource);gl.compileShader(fragmentShader);if(!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)){throw new Error(// eslint-disable-next-line prefer-template\n\"Fragment shader compile error for \"+this.type+\": \"+gl.getShaderInfoLog(fragmentShader));}var program=gl.createProgram();gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){throw new Error(// eslint-disable-next-line prefer-template\n'Shader link error for \"${this.type}\" '+gl.getProgramInfoLog(program));}var attributeLocations=this.getAttributeLocations(gl,program);var uniformLocations=this.getUniformLocations(gl,program)||{};uniformLocations.uStepW=gl.getUniformLocation(program,\"uStepW\");uniformLocations.uStepH=gl.getUniformLocation(program,\"uStepH\");return{program:program,attributeLocations:attributeLocations,uniformLocations:uniformLocations};},/**\n     * Return a map of attribute names to WebGLAttributeLocation objects.\n     *\n     * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n     * @param {WebGLShaderProgram} program The shader program from which to take attribute locations.\n     * @returns {Object} A map of attribute names to attribute locations.\n     */getAttributeLocations:function(gl,program){return{aPosition:gl.getAttribLocation(program,\"aPosition\")};},/**\n     * Return a map of uniform names to WebGLUniformLocation objects.\n     *\n     * Intended to be overridden by subclasses.\n     *\n     * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n     * @param {WebGLShaderProgram} program The shader program from which to take uniform locations.\n     * @returns {Object} A map of uniform names to uniform locations.\n     */getUniformLocations:function/* gl, program */(){// in case i do not need any special uniform i need to return an empty object\nreturn{};},/**\n     * Send attribute data from this filter to its shader program on the GPU.\n     *\n     * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n     * @param {Object} attributeLocations A map of shader attribute names to their locations.\n     */sendAttributeData:function(gl,attributeLocations,aPositionData){var attributeLocation=attributeLocations.aPosition;var buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.enableVertexAttribArray(attributeLocation);gl.vertexAttribPointer(attributeLocation,2,gl.FLOAT,false,0,0);gl.bufferData(gl.ARRAY_BUFFER,aPositionData,gl.STATIC_DRAW);},_setupFrameBuffer:function(options){var gl=options.context,width,height;if(options.passes>1){width=options.destinationWidth;height=options.destinationHeight;if(options.sourceWidth!==width||options.sourceHeight!==height){gl.deleteTexture(options.targetTexture);options.targetTexture=options.filterBackend.createTexture(gl,width,height);}gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,options.targetTexture,0);}else{// draw last filter on canvas and not to framebuffer.\ngl.bindFramebuffer(gl.FRAMEBUFFER,null);gl.finish();}},_swapTextures:function(options){options.passes--;options.pass++;var temp=options.targetTexture;options.targetTexture=options.sourceTexture;options.sourceTexture=temp;},/**\n     * Generic isNeutral implementation for one parameter based filters.\n     * Used only in image applyFilters to discard filters that will not have an effect\n     * on the image\n     * Other filters may need their own verison ( ColorMatrix, HueRotation, gamma, ComposedFilter )\n     * @param {Object} options\n     **/isNeutralState:function/* options */(){var main=this.mainParameter,_class=fabric.Image.filters[this.type].prototype;if(main){if(Array.isArray(_class[main])){for(var i=_class[main].length;i--;){if(this[main][i]!==_class[main][i]){return false;}}return true;}else{return _class[main]===this[main];}}else{return false;}},/**\n     * Apply this filter to the input image data provided.\n     *\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */applyTo:function(options){if(options.webgl){this._setupFrameBuffer(options);this.applyToWebGL(options);this._swapTextures(options);}else{this.applyTo2d(options);}},/**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */retrieveShader:function(options){if(!options.programCache.hasOwnProperty(this.type)){options.programCache[this.type]=this.createProgram(options.context);}return options.programCache[this.type];},/**\n     * Apply this filter using webgl.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.originalTexture The texture of the original input image.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */applyToWebGL:function(options){var gl=options.context;var shader=this.retrieveShader(options);if(options.pass===0&&options.originalTexture){gl.bindTexture(gl.TEXTURE_2D,options.originalTexture);}else{gl.bindTexture(gl.TEXTURE_2D,options.sourceTexture);}gl.useProgram(shader.program);this.sendAttributeData(gl,shader.attributeLocations,options.aPosition);gl.uniform1f(shader.uniformLocations.uStepW,1/options.sourceWidth);gl.uniform1f(shader.uniformLocations.uStepH,1/options.sourceHeight);this.sendUniformData(gl,shader.uniformLocations);gl.viewport(0,0,options.destinationWidth,options.destinationHeight);gl.drawArrays(gl.TRIANGLE_STRIP,0,4);},bindAdditionalTexture:function(gl,texture,textureUnit){gl.activeTexture(textureUnit);gl.bindTexture(gl.TEXTURE_2D,texture);// reset active texture to 0 as usual\ngl.activeTexture(gl.TEXTURE0);},unbindAdditionalTexture:function(gl,textureUnit){gl.activeTexture(textureUnit);gl.bindTexture(gl.TEXTURE_2D,null);gl.activeTexture(gl.TEXTURE0);},getMainParameter:function(){return this[this.mainParameter];},setMainParameter:function(value){this[this.mainParameter]=value;},/**\n     * Send uniform data from this filter to its shader program on the GPU.\n     *\n     * Intended to be overridden by subclasses.\n     *\n     * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n     * @param {Object} uniformLocations A map of shader uniform names to their locations.\n     */sendUniformData:function/* gl, uniformLocations */(){// Intentionally left blank.  Override me in subclasses.\n},/**\n     * If needed by a 2d filter, this functions can create an helper canvas to be used\n     * remember that options.targetCanvas is available for use till end of chain.\n     */createHelpLayer:function(options){if(!options.helpLayer){var helpLayer=document.createElement(\"canvas\");helpLayer.width=options.sourceWidth;helpLayer.height=options.sourceHeight;options.helpLayer=helpLayer;}},/**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */toObject:function(){var object={type:this.type},mainP=this.mainParameter;if(mainP){object[mainP]=this[mainP];}return object;},/**\n     * Returns a JSON representation of an instance\n     * @return {Object} JSON\n     */toJSON:function(){// delegate, not alias\nreturn this.toObject();}});fabric.Image.filters.BaseFilter.fromObject=function(object,callback){var filter=new fabric.Image.filters[object.type](object);callback&&callback(filter);return filter;};(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n     * Color Matrix filter class\n     * @class fabric.Image.filters.ColorMatrix\n     * @memberOf fabric.Image.filters\n     * @extends fabric.Image.filters.BaseFilter\n     * @see {@link fabric.Image.filters.ColorMatrix#initialize} for constructor definition\n     * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n     * @see {@Link http://www.webwasp.co.uk/tutorials/219/Color_Matrix_Filter.php}\n     * @see {@Link http://phoboslab.org/log/2013/11/fast-image-filters-with-webgl}\n     * @example <caption>Kodachrome filter</caption>\n     * var filter = new fabric.Image.filters.ColorMatrix({\n     *  matrix: [\n         1.1285582396593525, -0.3967382283601348, -0.03992559172921793, 0, 63.72958762196502,\n         -0.16404339962244616, 1.0835251566291304, -0.05498805115633132, 0, 24.732407896706203,\n         -0.16786010706155763, -0.5603416277695248, 1.6014850761964943, 0, 35.62982807460946,\n         0, 0, 0, 1, 0\n        ]\n     * });\n     * object.filters.push(filter);\n     * object.applyFilters();\n     */filters.ColorMatrix=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.ColorMatrix.prototype */{/**\n       * Filter type\n       * @param {String} type\n       * @default\n       */type:\"ColorMatrix\",fragmentSource:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"uniform mat4 uColorMatrix;\\n\"+\"uniform vec4 uConstants;\\n\"+\"void main() {\\n\"+\"vec4 color = texture2D(uTexture, vTexCoord);\\n\"+\"color *= uColorMatrix;\\n\"+\"color += uConstants;\\n\"+\"gl_FragColor = color;\\n\"+\"}\",/**\n       * Colormatrix for pixels.\n       * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n       * outside the -1, 1 range.\n       * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n       * @param {Array} matrix array of 20 numbers.\n       * @default\n       */matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:\"matrix\",/**\n       * Lock the colormatrix on the color part, skipping alpha, manly for non webgl scenario\n       * to save some calculation\n       */colorsOnly:true,/**\n       * Constructor\n       * @param {Object} [options] Options object\n       */initialize:function(options){this.callSuper(\"initialize\",options);// create a new array instead mutating the prototype with push\nthis.matrix=this.matrix.slice(0);},/**\n       * Apply the ColorMatrix operation to a Uint8Array representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8Array to be filtered.\n       */applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,iLen=data.length,m=this.matrix,r,g,b,a,i,colorsOnly=this.colorsOnly;for(i=0;i<iLen;i+=4){r=data[i];g=data[i+1];b=data[i+2];if(colorsOnly){data[i]=r*m[0]+g*m[1]+b*m[2]+m[4]*255;data[i+1]=r*m[5]+g*m[6]+b*m[7]+m[9]*255;data[i+2]=r*m[10]+g*m[11]+b*m[12]+m[14]*255;}else{a=data[i+3];data[i]=r*m[0]+g*m[1]+b*m[2]+a*m[3]+m[4]*255;data[i+1]=r*m[5]+g*m[6]+b*m[7]+a*m[8]+m[9]*255;data[i+2]=r*m[10]+g*m[11]+b*m[12]+a*m[13]+m[14]*255;data[i+3]=r*m[15]+g*m[16]+b*m[17]+a*m[18]+m[19]*255;}}},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uColorMatrix:gl.getUniformLocation(program,\"uColorMatrix\"),uConstants:gl.getUniformLocation(program,\"uConstants\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){var m=this.matrix,matrix=[m[0],m[1],m[2],m[3],m[5],m[6],m[7],m[8],m[10],m[11],m[12],m[13],m[15],m[16],m[17],m[18]],constants=[m[4],m[9],m[14],m[19]];gl.uniformMatrix4fv(uniformLocations.uColorMatrix,false,matrix);gl.uniform4fv(uniformLocations.uConstants,constants);}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] function to invoke after filter creation\n   * @return {fabric.Image.filters.ColorMatrix} Instance of fabric.Image.filters.ColorMatrix\n   */fabric.Image.filters.ColorMatrix.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Brightness filter class\n   * @class fabric.Image.filters.Brightness\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Brightness#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Brightness({\n   *   brightness: 0.05\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */filters.Brightness=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.Brightness.prototype */{/**\n       * Filter type\n       * @param {String} type\n       * @default\n       */type:\"Brightness\",/**\n       * Fragment source for the brightness program\n       */fragmentSource:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform float uBrightness;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = texture2D(uTexture, vTexCoord);\\n\"+\"color.rgb += uBrightness;\\n\"+\"gl_FragColor = color;\\n\"+\"}\",/**\n       * Brightness value, from -1 to 1.\n       * translated to -255 to 255 for 2d\n       * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n       * @param {Number} brightness\n       * @default\n       */brightness:0,/**\n       * Describe the property that is the filter parameter\n       * @param {String} m\n       * @default\n       */mainParameter:\"brightness\",/**\n       * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */applyTo2d:function(options){if(this.brightness===0){return;}var imageData=options.imageData,data=imageData.data,i,len=data.length,brightness=Math.round(this.brightness*255);for(i=0;i<len;i+=4){data[i]=data[i]+brightness;data[i+1]=data[i+1]+brightness;data[i+2]=data[i+2]+brightness;}},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uBrightness:gl.getUniformLocation(program,\"uBrightness\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uBrightness,this.brightness);}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Brightness} Instance of fabric.Image.filters.Brightness\n   */fabric.Image.filters.Brightness.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Adapted from <a href=\"http://www.html5rocks.com/en/tutorials/canvas/imagefilters/\">html5rocks article</a>\n   * @class fabric.Image.filters.Convolute\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Convolute#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example <caption>Sharpen filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 0, -1,  0,\n   *            -1,  5, -1,\n   *             0, -1,  0 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Blur filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter with opaqueness</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   opaque: true,\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */filters.Convolute=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.Convolute.prototype */{/**\n       * Filter type\n       * @param {String} type\n       * @default\n       */type:\"Convolute\",/*\n       * Opaque value (true/false)\n       */opaque:false,/*\n       * matrix for the filter, max 9x9\n       */matrix:[0,0,0,0,1,0,0,0,0],/**\n       * Fragment source for the brightness program\n       */fragmentSource:{Convolute_3_1:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform float uMatrix[9];\\n\"+\"uniform float uStepW;\\n\"+\"uniform float uStepH;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = vec4(0, 0, 0, 0);\\n\"+\"for (float h = 0.0; h < 3.0; h+=1.0) {\\n\"+\"for (float w = 0.0; w < 3.0; w+=1.0) {\\n\"+\"vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\\n\"+\"color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\\n\"+\"}\\n\"+\"}\\n\"+\"gl_FragColor = color;\\n\"+\"}\",Convolute_3_0:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform float uMatrix[9];\\n\"+\"uniform float uStepW;\\n\"+\"uniform float uStepH;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = vec4(0, 0, 0, 1);\\n\"+\"for (float h = 0.0; h < 3.0; h+=1.0) {\\n\"+\"for (float w = 0.0; w < 3.0; w+=1.0) {\\n\"+\"vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\\n\"+\"color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\\n\"+\"}\\n\"+\"}\\n\"+\"float alpha = texture2D(uTexture, vTexCoord).a;\\n\"+\"gl_FragColor = color;\\n\"+\"gl_FragColor.a = alpha;\\n\"+\"}\",Convolute_5_1:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform float uMatrix[25];\\n\"+\"uniform float uStepW;\\n\"+\"uniform float uStepH;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = vec4(0, 0, 0, 0);\\n\"+\"for (float h = 0.0; h < 5.0; h+=1.0) {\\n\"+\"for (float w = 0.0; w < 5.0; w+=1.0) {\\n\"+\"vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n\"+\"color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\\n\"+\"}\\n\"+\"}\\n\"+\"gl_FragColor = color;\\n\"+\"}\",Convolute_5_0:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform float uMatrix[25];\\n\"+\"uniform float uStepW;\\n\"+\"uniform float uStepH;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = vec4(0, 0, 0, 1);\\n\"+\"for (float h = 0.0; h < 5.0; h+=1.0) {\\n\"+\"for (float w = 0.0; w < 5.0; w+=1.0) {\\n\"+\"vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n\"+\"color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\\n\"+\"}\\n\"+\"}\\n\"+\"float alpha = texture2D(uTexture, vTexCoord).a;\\n\"+\"gl_FragColor = color;\\n\"+\"gl_FragColor.a = alpha;\\n\"+\"}\",Convolute_7_1:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform float uMatrix[49];\\n\"+\"uniform float uStepW;\\n\"+\"uniform float uStepH;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = vec4(0, 0, 0, 0);\\n\"+\"for (float h = 0.0; h < 7.0; h+=1.0) {\\n\"+\"for (float w = 0.0; w < 7.0; w+=1.0) {\\n\"+\"vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n\"+\"color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\\n\"+\"}\\n\"+\"}\\n\"+\"gl_FragColor = color;\\n\"+\"}\",Convolute_7_0:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform float uMatrix[49];\\n\"+\"uniform float uStepW;\\n\"+\"uniform float uStepH;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = vec4(0, 0, 0, 1);\\n\"+\"for (float h = 0.0; h < 7.0; h+=1.0) {\\n\"+\"for (float w = 0.0; w < 7.0; w+=1.0) {\\n\"+\"vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n\"+\"color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\\n\"+\"}\\n\"+\"}\\n\"+\"float alpha = texture2D(uTexture, vTexCoord).a;\\n\"+\"gl_FragColor = color;\\n\"+\"gl_FragColor.a = alpha;\\n\"+\"}\",Convolute_9_1:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform float uMatrix[81];\\n\"+\"uniform float uStepW;\\n\"+\"uniform float uStepH;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = vec4(0, 0, 0, 0);\\n\"+\"for (float h = 0.0; h < 9.0; h+=1.0) {\\n\"+\"for (float w = 0.0; w < 9.0; w+=1.0) {\\n\"+\"vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n\"+\"color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\\n\"+\"}\\n\"+\"}\\n\"+\"gl_FragColor = color;\\n\"+\"}\",Convolute_9_0:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform float uMatrix[81];\\n\"+\"uniform float uStepW;\\n\"+\"uniform float uStepH;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = vec4(0, 0, 0, 1);\\n\"+\"for (float h = 0.0; h < 9.0; h+=1.0) {\\n\"+\"for (float w = 0.0; w < 9.0; w+=1.0) {\\n\"+\"vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n\"+\"color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\\n\"+\"}\\n\"+\"}\\n\"+\"float alpha = texture2D(uTexture, vTexCoord).a;\\n\"+\"gl_FragColor = color;\\n\"+\"gl_FragColor.a = alpha;\\n\"+\"}\"},/**\n       * Constructor\n       * @memberOf fabric.Image.filters.Convolute.prototype\n       * @param {Object} [options] Options object\n       * @param {Boolean} [options.opaque=false] Opaque value (true/false)\n       * @param {Array} [options.matrix] Filter matrix\n       */ /**\n       * Retrieves the cached shader.\n       * @param {Object} options\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */retrieveShader:function(options){var size=Math.sqrt(this.matrix.length);var cacheKey=this.type+\"_\"+size+\"_\"+(this.opaque?1:0);var shaderSource=this.fragmentSource[cacheKey];if(!options.programCache.hasOwnProperty(cacheKey)){options.programCache[cacheKey]=this.createProgram(options.context,shaderSource);}return options.programCache[cacheKey];},/**\n       * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,weights=this.matrix,side=Math.round(Math.sqrt(weights.length)),halfSide=Math.floor(side/2),sw=imageData.width,sh=imageData.height,output=options.ctx.createImageData(sw,sh),dst=output.data,// go through the destination image pixels\nalphaFac=this.opaque?1:0,r,g,b,a,dstOff,scx,scy,srcOff,wt,x,y,cx,cy;for(y=0;y<sh;y++){for(x=0;x<sw;x++){dstOff=(y*sw+x)*4;// calculate the weighed sum of the source image pixels that\n// fall under the convolution matrix\nr=0;g=0;b=0;a=0;for(cy=0;cy<side;cy++){for(cx=0;cx<side;cx++){scy=y+cy-halfSide;scx=x+cx-halfSide;// eslint-disable-next-line max-depth\nif(scy<0||scy>=sh||scx<0||scx>=sw){continue;}srcOff=(scy*sw+scx)*4;wt=weights[cy*side+cx];r+=data[srcOff]*wt;g+=data[srcOff+1]*wt;b+=data[srcOff+2]*wt;// eslint-disable-next-line max-depth\nif(!alphaFac){a+=data[srcOff+3]*wt;}}}dst[dstOff]=r;dst[dstOff+1]=g;dst[dstOff+2]=b;if(!alphaFac){dst[dstOff+3]=a;}else{dst[dstOff+3]=data[dstOff+3];}}}options.imageData=output;},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uMatrix:gl.getUniformLocation(program,\"uMatrix\"),uOpaque:gl.getUniformLocation(program,\"uOpaque\"),uHalfSize:gl.getUniformLocation(program,\"uHalfSize\"),uSize:gl.getUniformLocation(program,\"uSize\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){gl.uniform1fv(uniformLocations.uMatrix,this.matrix);},/**\n       * Returns object representation of an instance\n       * @return {Object} Object representation of an instance\n       */toObject:function(){return extend(this.callSuper(\"toObject\"),{opaque:this.opaque,matrix:this.matrix});}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Convolute} Instance of fabric.Image.filters.Convolute\n   */fabric.Image.filters.Convolute.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Grayscale image filter class\n   * @class fabric.Image.filters.Grayscale\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Grayscale();\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */filters.Grayscale=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.Grayscale.prototype */{/**\n       * Filter type\n       * @param {String} type\n       * @default\n       */type:\"Grayscale\",fragmentSource:{average:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = texture2D(uTexture, vTexCoord);\\n\"+\"float average = (color.r + color.b + color.g) / 3.0;\\n\"+\"gl_FragColor = vec4(average, average, average, color.a);\\n\"+\"}\",lightness:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform int uMode;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 col = texture2D(uTexture, vTexCoord);\\n\"+\"float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\\n\"+\"gl_FragColor = vec4(average, average, average, col.a);\\n\"+\"}\",luminosity:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform int uMode;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 col = texture2D(uTexture, vTexCoord);\\n\"+\"float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\\n\"+\"gl_FragColor = vec4(average, average, average, col.a);\\n\"+\"}\"},/**\n       * Grayscale mode, between 'average', 'lightness', 'luminosity'\n       * @param {String} type\n       * @default\n       */mode:\"average\",mainParameter:\"mode\",/**\n       * Apply the Grayscale operation to a Uint8Array representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8Array to be filtered.\n       */applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,i,len=data.length,value,mode=this.mode;for(i=0;i<len;i+=4){if(mode===\"average\"){value=(data[i]+data[i+1]+data[i+2])/3;}else if(mode===\"lightness\"){value=(Math.min(data[i],data[i+1],data[i+2])+Math.max(data[i],data[i+1],data[i+2]))/2;}else if(mode===\"luminosity\"){value=0.21*data[i]+0.72*data[i+1]+0.07*data[i+2];}data[i]=value;data[i+1]=value;data[i+2]=value;}},/**\n       * Retrieves the cached shader.\n       * @param {Object} options\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */retrieveShader:function(options){var cacheKey=this.type+\"_\"+this.mode;if(!options.programCache.hasOwnProperty(cacheKey)){var shaderSource=this.fragmentSource[this.mode];options.programCache[cacheKey]=this.createProgram(options.context,shaderSource);}return options.programCache[cacheKey];},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uMode:gl.getUniformLocation(program,\"uMode\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){// default average mode.\nvar mode=1;gl.uniform1i(uniformLocations.uMode,mode);},/**\n       * Grayscale filter isNeutralState implementation\n       * The filter is never neutral\n       * on the image\n       **/isNeutralState:function(){return false;}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Grayscale} Instance of fabric.Image.filters.Grayscale\n   */fabric.Image.filters.Grayscale.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Invert filter class\n   * @class fabric.Image.filters.Invert\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Invert();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */filters.Invert=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.Invert.prototype */{/**\n       * Filter type\n       * @param {String} type\n       * @default\n       */type:\"Invert\",fragmentSource:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform int uInvert;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = texture2D(uTexture, vTexCoord);\\n\"+\"if (uInvert == 1) {\\n\"+\"gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\\n\"+\"} else {\\n\"+\"gl_FragColor = color;\\n\"+\"}\\n\"+\"}\",/**\n       * Filter invert. if false, does nothing\n       * @param {Boolean} invert\n       * @default\n       */invert:true,mainParameter:\"invert\",/**\n       * Apply the Invert operation to a Uint8Array representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8Array to be filtered.\n       */applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,i,len=data.length;for(i=0;i<len;i+=4){data[i]=255-data[i];data[i+1]=255-data[i+1];data[i+2]=255-data[i+2];}},/**\n       * Invert filter isNeutralState implementation\n       * Used only in image applyFilters to discard filters that will not have an effect\n       * on the image\n       * @param {Object} options\n       **/isNeutralState:function(){return!this.invert;},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uInvert:gl.getUniformLocation(program,\"uInvert\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){gl.uniform1i(uniformLocations.uInvert,this.invert);}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Invert} Instance of fabric.Image.filters.Invert\n   */fabric.Image.filters.Invert.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Noise filter class\n   * @class fabric.Image.filters.Noise\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Noise#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Noise({\n   *   noise: 700\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */filters.Noise=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.Noise.prototype */{/**\n       * Filter type\n       * @param {String} type\n       * @default\n       */type:\"Noise\",/**\n       * Fragment source for the noise program\n       */fragmentSource:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform float uStepH;\\n\"+\"uniform float uNoise;\\n\"+\"uniform float uSeed;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"float rand(vec2 co, float seed, float vScale) {\\n\"+\"return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\\n\"+\"}\\n\"+\"void main() {\\n\"+\"vec4 color = texture2D(uTexture, vTexCoord);\\n\"+\"color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\\n\"+\"gl_FragColor = color;\\n\"+\"}\",/**\n       * Describe the property that is the filter parameter\n       * @param {String} m\n       * @default\n       */mainParameter:\"noise\",/**\n       * Noise value, from\n       * @param {Number} noise\n       * @default\n       */noise:0,/**\n       * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */applyTo2d:function(options){if(this.noise===0){return;}var imageData=options.imageData,data=imageData.data,i,len=data.length,noise=this.noise,rand;for(i=0,len=data.length;i<len;i+=4){rand=(0.5-Math.random())*noise;data[i]+=rand;data[i+1]+=rand;data[i+2]+=rand;}},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uNoise:gl.getUniformLocation(program,\"uNoise\"),uSeed:gl.getUniformLocation(program,\"uSeed\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uNoise,this.noise/255);gl.uniform1f(uniformLocations.uSeed,Math.random());},/**\n       * Returns object representation of an instance\n       * @return {Object} Object representation of an instance\n       */toObject:function(){return extend(this.callSuper(\"toObject\"),{noise:this.noise});}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Noise} Instance of fabric.Image.filters.Noise\n   */fabric.Image.filters.Noise.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Pixelate filter class\n   * @class fabric.Image.filters.Pixelate\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Pixelate#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Pixelate({\n   *   blocksize: 8\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */filters.Pixelate=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.Pixelate.prototype */{/**\n       * Filter type\n       * @param {String} type\n       * @default\n       */type:\"Pixelate\",blocksize:4,mainParameter:\"blocksize\",/**\n       * Fragment source for the Pixelate program\n       */fragmentSource:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform float uBlocksize;\\n\"+\"uniform float uStepW;\\n\"+\"uniform float uStepH;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"float blockW = uBlocksize * uStepW;\\n\"+\"float blockH = uBlocksize * uStepW;\\n\"+\"int posX = int(vTexCoord.x / blockW);\\n\"+\"int posY = int(vTexCoord.y / blockH);\\n\"+\"float fposX = float(posX);\\n\"+\"float fposY = float(posY);\\n\"+\"vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\\n\"+\"vec4 color = texture2D(uTexture, squareCoords);\\n\"+\"gl_FragColor = color;\\n\"+\"}\",/**\n       * Apply the Pixelate operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,iLen=imageData.height,jLen=imageData.width,index,i,j,r,g,b,a,_i,_j,_iLen,_jLen;for(i=0;i<iLen;i+=this.blocksize){for(j=0;j<jLen;j+=this.blocksize){index=i*4*jLen+j*4;r=data[index];g=data[index+1];b=data[index+2];a=data[index+3];_iLen=Math.min(i+this.blocksize,iLen);_jLen=Math.min(j+this.blocksize,jLen);for(_i=i;_i<_iLen;_i++){for(_j=j;_j<_jLen;_j++){index=_i*4*jLen+_j*4;data[index]=r;data[index+1]=g;data[index+2]=b;data[index+3]=a;}}}}},/**\n       * Indicate when the filter is not gonna apply changes to the image\n       **/isNeutralState:function(){return this.blocksize===1;},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uBlocksize:gl.getUniformLocation(program,\"uBlocksize\"),uStepW:gl.getUniformLocation(program,\"uStepW\"),uStepH:gl.getUniformLocation(program,\"uStepH\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uBlocksize,this.blocksize);}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Pixelate} Instance of fabric.Image.filters.Pixelate\n   */fabric.Image.filters.Pixelate.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Remove white filter class\n   * @class fabric.Image.filters.RemoveColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.RemoveColor#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.RemoveColor({\n   *   threshold: 0.2,\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */filters.RemoveColor=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.RemoveColor.prototype */{/**\n       * Filter type\n       * @param {String} type\n       * @default\n       */type:\"RemoveColor\",/**\n       * Color to remove, in any format understood by fabric.Color.\n       * @param {String} type\n       * @default\n       */color:\"#FFFFFF\",/**\n       * Fragment source for the brightness program\n       */fragmentSource:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform vec4 uLow;\\n\"+\"uniform vec4 uHigh;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"gl_FragColor = texture2D(uTexture, vTexCoord);\\n\"+\"if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\\n\"+\"gl_FragColor.a = 0.0;\\n\"+\"}\\n\"+\"}\",/**\n       * distance to actual color, as value up or down from each r,g,b\n       * between 0 and 1\n       **/distance:0.02,/**\n       * For color to remove inside distance, use alpha channel for a smoother deletion\n       * NOT IMPLEMENTED YET\n       **/useAlpha:false,/**\n       * Constructor\n       * @memberOf fabric.Image.filters.RemoveWhite.prototype\n       * @param {Object} [options] Options object\n       * @param {Number} [options.color=#RRGGBB] Threshold value\n       * @param {Number} [options.distance=10] Distance value\n       */ /**\n       * Applies filter to canvas element\n       * @param {Object} canvasEl Canvas element to apply filter to\n       */applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,i,distance=this.distance*255,r,g,b,source=new fabric.Color(this.color).getSource(),lowC=[source[0]-distance,source[1]-distance,source[2]-distance],highC=[source[0]+distance,source[1]+distance,source[2]+distance];for(i=0;i<data.length;i+=4){r=data[i];g=data[i+1];b=data[i+2];if(r>lowC[0]&&g>lowC[1]&&b>lowC[2]&&r<highC[0]&&g<highC[1]&&b<highC[2]){data[i+3]=0;}}},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uLow:gl.getUniformLocation(program,\"uLow\"),uHigh:gl.getUniformLocation(program,\"uHigh\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){var source=new fabric.Color(this.color).getSource(),distance=parseFloat(this.distance),lowC=[0+source[0]/255-distance,0+source[1]/255-distance,0+source[2]/255-distance,1],highC=[source[0]/255+distance,source[1]/255+distance,source[2]/255+distance,1];gl.uniform4fv(uniformLocations.uLow,lowC);gl.uniform4fv(uniformLocations.uHigh,highC);},/**\n       * Returns object representation of an instance\n       * @return {Object} Object representation of an instance\n       */toObject:function(){return extend(this.callSuper(\"toObject\"),{color:this.color,distance:this.distance});}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.RemoveColor} Instance of fabric.Image.filters.RemoveWhite\n   */fabric.Image.filters.RemoveColor.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;var matrices={Brownie:[0.5997,0.34553,-0.27082,0,0.186,-0.0377,0.86095,0.15059,0,-0.1449,0.24113,-0.07441,0.44972,0,-0.02965,0,0,0,1,0],Vintage:[0.62793,0.32021,-0.03965,0,0.03784,0.02578,0.64411,0.03259,0,0.02926,0.0466,-0.08512,0.52416,0,0.02023,0,0,0,1,0],Kodachrome:[1.12855,-0.39673,-0.03992,0,0.24991,-0.16404,1.08352,-0.05498,0,0.09698,-0.16786,-0.56034,1.60148,0,0.13972,0,0,0,1,0],Technicolor:[1.91252,-0.85453,-0.09155,0,0.04624,-0.30878,1.76589,-0.10601,0,-0.27589,-0.2311,-0.75018,1.84759,0,0.12137,0,0,0,1,0],Polaroid:[1.438,-0.062,-0.062,0,0,-0.122,1.378,-0.122,0,0,-0.016,-0.016,1.483,0,0,0,0,0,1,0],Sepia:[0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var key in matrices){filters[key]=createClass(filters.ColorMatrix,/** @lends fabric.Image.filters.Sepia.prototype */{/**\n         * Filter type\n         * @param {String} type\n         * @default\n         */type:key,/**\n         * Colormatrix for the effect\n         * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n         * outside the -1, 1 range.\n         * @param {Array} matrix array of 20 numbers.\n         * @default\n         */matrix:matrices[key],/**\n         * Lock the matrix export for this kind of static, parameter less filters.\n         */mainParameter:false,/**\n         * Lock the colormatrix on the color part, skipping alpha\n         */colorsOnly:true});fabric.Image.filters[key].fromObject=fabric.Image.filters.BaseFilter.fromObject;}})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric,filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Color Blend filter class\n   * @class fabric.Image.filter.BlendColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */filters.BlendColor=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.Blend.prototype */{type:\"BlendColor\",/**\n       * Color to make the blend operation with. default to a reddish color since black or white\n       * gives always strong result.\n       **/color:\"#F95C63\",/**\n       * Blend mode for the filter: one of multiply, add, diff, screen, subtract,\n       * darken, lighten, overlay, exclusion, tint.\n       **/mode:\"multiply\",/**\n       * alpha value. represent the strength of the blend color operation.\n       **/alpha:1,/**\n       * Fragment source for the Multiply program\n       */fragmentSource:{multiply:\"gl_FragColor.rgb *= uColor.rgb;\\n\",screen:\"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\\n\",add:\"gl_FragColor.rgb += uColor.rgb;\\n\",diff:\"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\\n\",subtract:\"gl_FragColor.rgb -= uColor.rgb;\\n\",lighten:\"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\\n\",darken:\"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\\n\",exclusion:\"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\\n\",overlay:\"if (uColor.r < 0.5) {\\n\"+\"gl_FragColor.r *= 2.0 * uColor.r;\\n\"+\"} else {\\n\"+\"gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\\n\"+\"}\\n\"+\"if (uColor.g < 0.5) {\\n\"+\"gl_FragColor.g *= 2.0 * uColor.g;\\n\"+\"} else {\\n\"+\"gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\\n\"+\"}\\n\"+\"if (uColor.b < 0.5) {\\n\"+\"gl_FragColor.b *= 2.0 * uColor.b;\\n\"+\"} else {\\n\"+\"gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\\n\"+\"}\\n\",tint:\"gl_FragColor.rgb *= (1.0 - uColor.a);\\n\"+\"gl_FragColor.rgb += uColor.rgb;\\n\"},/**\n       * build the fragment source for the filters, joining the common part with\n       * the specific one.\n       * @param {String} mode the mode of the filter, a key of this.fragmentSource\n       * @return {String} the source to be compiled\n       * @private\n       */buildSource:function(mode){return\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform vec4 uColor;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = texture2D(uTexture, vTexCoord);\\n\"+\"gl_FragColor = color;\\n\"+\"if (color.a > 0.0) {\\n\"+this.fragmentSource[mode]+\"}\\n\"+\"}\";},/**\n       * Retrieves the cached shader.\n       * @param {Object} options\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */retrieveShader:function(options){var cacheKey=this.type+\"_\"+this.mode,shaderSource;if(!options.programCache.hasOwnProperty(cacheKey)){shaderSource=this.buildSource(this.mode);options.programCache[cacheKey]=this.createProgram(options.context,shaderSource);}return options.programCache[cacheKey];},/**\n       * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,iLen=data.length,tr,tg,tb,r,g,b,source,alpha1=1-this.alpha;source=new fabric.Color(this.color).getSource();tr=source[0]*this.alpha;tg=source[1]*this.alpha;tb=source[2]*this.alpha;for(var i=0;i<iLen;i+=4){r=data[i];g=data[i+1];b=data[i+2];switch(this.mode){case\"multiply\":data[i]=r*tr/255;data[i+1]=g*tg/255;data[i+2]=b*tb/255;break;case\"screen\":data[i]=255-(255-r)*(255-tr)/255;data[i+1]=255-(255-g)*(255-tg)/255;data[i+2]=255-(255-b)*(255-tb)/255;break;case\"add\":data[i]=r+tr;data[i+1]=g+tg;data[i+2]=b+tb;break;case\"diff\":case\"difference\":data[i]=Math.abs(r-tr);data[i+1]=Math.abs(g-tg);data[i+2]=Math.abs(b-tb);break;case\"subtract\":data[i]=r-tr;data[i+1]=g-tg;data[i+2]=b-tb;break;case\"darken\":data[i]=Math.min(r,tr);data[i+1]=Math.min(g,tg);data[i+2]=Math.min(b,tb);break;case\"lighten\":data[i]=Math.max(r,tr);data[i+1]=Math.max(g,tg);data[i+2]=Math.max(b,tb);break;case\"overlay\":data[i]=tr<128?2*r*tr/255:255-2*(255-r)*(255-tr)/255;data[i+1]=tg<128?2*g*tg/255:255-2*(255-g)*(255-tg)/255;data[i+2]=tb<128?2*b*tb/255:255-2*(255-b)*(255-tb)/255;break;case\"exclusion\":data[i]=tr+r-2*tr*r/255;data[i+1]=tg+g-2*tg*g/255;data[i+2]=tb+b-2*tb*b/255;break;case\"tint\":data[i]=tr+r*alpha1;data[i+1]=tg+g*alpha1;data[i+2]=tb+b*alpha1;}}},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uColor:gl.getUniformLocation(program,\"uColor\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){var source=new fabric.Color(this.color).getSource();source[0]=this.alpha*source[0]/255;source[1]=this.alpha*source[1]/255;source[2]=this.alpha*source[2]/255;source[3]=this.alpha;gl.uniform4fv(uniformLocations.uColor,source);},/**\n       * Returns object representation of an instance\n       * @return {Object} Object representation of an instance\n       */toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha};}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendColor} Instance of fabric.Image.filters.BlendColor\n   */fabric.Image.filters.BlendColor.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric,filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Image Blend filter class\n   * @class fabric.Image.filter.BlendImage\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */filters.BlendImage=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.BlendImage.prototype */{type:\"BlendImage\",/**\n       * Color to make the blend operation with. default to a reddish color since black or white\n       * gives always strong result.\n       **/image:null,/**\n       * Blend mode for the filter: one of multiply, add, diff, screen, subtract,\n       * darken, lighten, overlay, exclusion, tint.\n       **/mode:\"multiply\",/**\n       * alpha value. represent the strength of the blend image operation.\n       * not implemented.\n       **/alpha:1,vertexSource:\"attribute vec2 aPosition;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"varying vec2 vTexCoord2;\\n\"+\"uniform mat3 uTransformMatrix;\\n\"+\"void main() {\\n\"+\"vTexCoord = aPosition;\\n\"+\"vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\\n\"+\"gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n\"+\"}\",/**\n       * Fragment source for the Multiply program\n       */fragmentSource:{multiply:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform sampler2D uImage;\\n\"+\"uniform vec4 uColor;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"varying vec2 vTexCoord2;\\n\"+\"void main() {\\n\"+\"vec4 color = texture2D(uTexture, vTexCoord);\\n\"+\"vec4 color2 = texture2D(uImage, vTexCoord2);\\n\"+\"color.rgba *= color2.rgba;\\n\"+\"gl_FragColor = color;\\n\"+\"}\",mask:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform sampler2D uImage;\\n\"+\"uniform vec4 uColor;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"varying vec2 vTexCoord2;\\n\"+\"void main() {\\n\"+\"vec4 color = texture2D(uTexture, vTexCoord);\\n\"+\"vec4 color2 = texture2D(uImage, vTexCoord2);\\n\"+\"color.a = color2.a;\\n\"+\"gl_FragColor = color;\\n\"+\"}\"},/**\n       * Retrieves the cached shader.\n       * @param {Object} options\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */retrieveShader:function(options){var cacheKey=this.type+\"_\"+this.mode;var shaderSource=this.fragmentSource[this.mode];if(!options.programCache.hasOwnProperty(cacheKey)){options.programCache[cacheKey]=this.createProgram(options.context,shaderSource);}return options.programCache[cacheKey];},applyToWebGL:function(options){// load texture to blend.\nvar gl=options.context,texture=this.createTexture(options.filterBackend,this.image);this.bindAdditionalTexture(gl,texture,gl.TEXTURE1);this.callSuper(\"applyToWebGL\",options);this.unbindAdditionalTexture(gl,gl.TEXTURE1);},createTexture:function(backend,image){return backend.getCachedTexture(image.cacheKey,image._element);},/**\n       * Calculate a transformMatrix to adapt the image to blend over\n       * @param {Object} options\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */calculateMatrix:function(){var image=this.image,width=image._element.width,height=image._element.height;return[1/image.scaleX,0,0,0,1/image.scaleY,0,-image.left/width,-image.top/height,1];},/**\n       * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */applyTo2d:function(options){var imageData=options.imageData,resources=options.filterBackend.resources,data=imageData.data,iLen=data.length,width=imageData.width,height=imageData.height,tr,tg,tb,ta,r,g,b,a,canvas1,context,image=this.image,blendData;if(!resources.blendImage){resources.blendImage=fabric.util.createCanvasElement();}canvas1=resources.blendImage;context=canvas1.getContext(\"2d\");if(canvas1.width!==width||canvas1.height!==height){canvas1.width=width;canvas1.height=height;}else{context.clearRect(0,0,width,height);}context.setTransform(image.scaleX,0,0,image.scaleY,image.left,image.top);context.drawImage(image._element,0,0,width,height);blendData=context.getImageData(0,0,width,height).data;for(var i=0;i<iLen;i+=4){r=data[i];g=data[i+1];b=data[i+2];a=data[i+3];tr=blendData[i];tg=blendData[i+1];tb=blendData[i+2];ta=blendData[i+3];switch(this.mode){case\"multiply\":data[i]=r*tr/255;data[i+1]=g*tg/255;data[i+2]=b*tb/255;data[i+3]=a*ta/255;break;case\"mask\":data[i+3]=ta;break;}}},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uTransformMatrix:gl.getUniformLocation(program,\"uTransformMatrix\"),uImage:gl.getUniformLocation(program,\"uImage\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){var matrix=this.calculateMatrix();gl.uniform1i(uniformLocations.uImage,1);// texture unit 1.\ngl.uniformMatrix3fv(uniformLocations.uTransformMatrix,false,matrix);},/**\n       * Returns object representation of an instance\n       * @return {Object} Object representation of an instance\n       */toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha};}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} callback to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendImage} Instance of fabric.Image.filters.BlendImage\n   */fabric.Image.filters.BlendImage.fromObject=function(object,callback){fabric.Image.fromObject(object.image,function(image){var options=fabric.util.object.clone(object);options.image=image;callback(new fabric.Image.filters.BlendImage(options));});};})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),pow=Math.pow,floor=Math.floor,sqrt=Math.sqrt,abs=Math.abs,round=Math.round,sin=Math.sin,ceil=Math.ceil,filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Resize image filter class\n   * @class fabric.Image.filters.Resize\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Resize();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */filters.Resize=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.Resize.prototype */{/**\n       * Filter type\n       * @param {String} type\n       * @default\n       */type:\"Resize\",/**\n       * Resize type\n       * for webgl resizeType is just lanczos, for canvas2d can be:\n       * bilinear, hermite, sliceHack, lanczos.\n       * @param {String} resizeType\n       * @default\n       */resizeType:\"hermite\",/**\n       * Scale factor for resizing, x axis\n       * @param {Number} scaleX\n       * @default\n       */scaleX:1,/**\n       * Scale factor for resizing, y axis\n       * @param {Number} scaleY\n       * @default\n       */scaleY:1,/**\n       * LanczosLobes parameter for lanczos filter, valid for resizeType lanczos\n       * @param {Number} lanczosLobes\n       * @default\n       */lanczosLobes:3,/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uDelta:gl.getUniformLocation(program,\"uDelta\"),uTaps:gl.getUniformLocation(program,\"uTaps\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){gl.uniform2fv(uniformLocations.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]);gl.uniform1fv(uniformLocations.uTaps,this.taps);},/**\n       * Retrieves the cached shader.\n       * @param {Object} options\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */retrieveShader:function(options){var filterWindow=this.getFilterWindow(),cacheKey=this.type+\"_\"+filterWindow;if(!options.programCache.hasOwnProperty(cacheKey)){var fragmentShader=this.generateShader(filterWindow);options.programCache[cacheKey]=this.createProgram(options.context,fragmentShader);}return options.programCache[cacheKey];},getFilterWindow:function(){var scale=this.tempScale;return Math.ceil(this.lanczosLobes/scale);},getTaps:function(){var lobeFunction=this.lanczosCreate(this.lanczosLobes),scale=this.tempScale,filterWindow=this.getFilterWindow(),taps=new Array(filterWindow);for(var i=1;i<=filterWindow;i++){taps[i-1]=lobeFunction(i*scale);}return taps;},/**\n       * Generate vertex and shader sources from the necessary steps numbers\n       * @param {Number} filterWindow\n       */generateShader:function(filterWindow){var offsets=new Array(filterWindow),fragmentShader=this.fragmentSourceTOP,filterWindow;for(var i=1;i<=filterWindow;i++){offsets[i-1]=i+\".0 * uDelta\";}fragmentShader+=\"uniform float uTaps[\"+filterWindow+\"];\\n\";fragmentShader+=\"void main() {\\n\";fragmentShader+=\"  vec4 color = texture2D(uTexture, vTexCoord);\\n\";fragmentShader+=\"  float sum = 1.0;\\n\";offsets.forEach(function(offset,i){fragmentShader+=\"  color += texture2D(uTexture, vTexCoord + \"+offset+\") * uTaps[\"+i+\"];\\n\";fragmentShader+=\"  color += texture2D(uTexture, vTexCoord - \"+offset+\") * uTaps[\"+i+\"];\\n\";fragmentShader+=\"  sum += 2.0 * uTaps[\"+i+\"];\\n\";});fragmentShader+=\"  gl_FragColor = color / sum;\\n\";fragmentShader+=\"}\";return fragmentShader;},fragmentSourceTOP:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform vec2 uDelta;\\n\"+\"varying vec2 vTexCoord;\\n\",/**\n       * Apply the resize filter to the image\n       * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n       *\n       * @param {Object} options\n       * @param {Number} options.passes The number of filters remaining to be executed\n       * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n       * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n       * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */applyTo:function(options){if(options.webgl){options.passes++;this.width=options.sourceWidth;this.horizontal=true;this.dW=Math.round(this.width*this.scaleX);this.dH=options.sourceHeight;this.tempScale=this.dW/this.width;this.taps=this.getTaps();options.destinationWidth=this.dW;this._setupFrameBuffer(options);this.applyToWebGL(options);this._swapTextures(options);options.sourceWidth=options.destinationWidth;this.height=options.sourceHeight;this.horizontal=false;this.dH=Math.round(this.height*this.scaleY);this.tempScale=this.dH/this.height;this.taps=this.getTaps();options.destinationHeight=this.dH;this._setupFrameBuffer(options);this.applyToWebGL(options);this._swapTextures(options);options.sourceHeight=options.destinationHeight;}else{this.applyTo2d(options);}},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1;},lanczosCreate:function(lobes){return function(x){if(x>=lobes||x<=-lobes){return 0.0;}if(x<1.1920929e-7&&x>-1.1920929e-7){return 1.0;}x*=Math.PI;var xx=x/lobes;return sin(x)/x*sin(xx)/xx;};},/**\n       * Applies filter to canvas element\n       * @memberOf fabric.Image.filters.Resize.prototype\n       * @param {Object} canvasEl Canvas element to apply filter to\n       * @param {Number} scaleX\n       * @param {Number} scaleY\n       */applyTo2d:function(options){var imageData=options.imageData,scaleX=this.scaleX,scaleY=this.scaleY;this.rcpScaleX=1/scaleX;this.rcpScaleY=1/scaleY;var oW=imageData.width,oH=imageData.height,dW=round(oW*scaleX),dH=round(oH*scaleY),newData;if(this.resizeType===\"sliceHack\"){newData=this.sliceByTwo(options,oW,oH,dW,dH);}else if(this.resizeType===\"hermite\"){newData=this.hermiteFastResize(options,oW,oH,dW,dH);}else if(this.resizeType===\"bilinear\"){newData=this.bilinearFiltering(options,oW,oH,dW,dH);}else if(this.resizeType===\"lanczos\"){newData=this.lanczosResize(options,oW,oH,dW,dH);}options.imageData=newData;},/**\n       * Filter sliceByTwo\n       * @param {Object} canvasEl Canvas element to apply filter to\n       * @param {Number} oW Original Width\n       * @param {Number} oH Original Height\n       * @param {Number} dW Destination Width\n       * @param {Number} dH Destination Height\n       * @returns {ImageData}\n       */sliceByTwo:function(options,oW,oH,dW,dH){var imageData=options.imageData,mult=0.5,doneW=false,doneH=false,stepW=oW*mult,stepH=oH*mult,resources=fabric.filterBackend.resources,tmpCanvas,ctx,sX=0,sY=0,dX=oW,dY=0;if(!resources.sliceByTwo){resources.sliceByTwo=document.createElement(\"canvas\");}tmpCanvas=resources.sliceByTwo;if(tmpCanvas.width<oW*1.5||tmpCanvas.height<oH){tmpCanvas.width=oW*1.5;tmpCanvas.height=oH;}ctx=tmpCanvas.getContext(\"2d\");ctx.clearRect(0,0,oW*1.5,oH);ctx.putImageData(imageData,0,0);dW=floor(dW);dH=floor(dH);while(!doneW||!doneH){oW=stepW;oH=stepH;if(dW<floor(stepW*mult)){stepW=floor(stepW*mult);}else{stepW=dW;doneW=true;}if(dH<floor(stepH*mult)){stepH=floor(stepH*mult);}else{stepH=dH;doneH=true;}ctx.drawImage(tmpCanvas,sX,sY,oW,oH,dX,dY,stepW,stepH);sX=dX;sY=dY;dY+=stepH;}return ctx.getImageData(sX,sY,dW,dH);},/**\n       * Filter lanczosResize\n       * @param {Object} canvasEl Canvas element to apply filter to\n       * @param {Number} oW Original Width\n       * @param {Number} oH Original Height\n       * @param {Number} dW Destination Width\n       * @param {Number} dH Destination Height\n       * @returns {ImageData}\n       */lanczosResize:function(options,oW,oH,dW,dH){function process(u){var v,i,weight,idx,a,red,green,blue,alpha,fX,fY;center.x=(u+0.5)*ratioX;icenter.x=floor(center.x);for(v=0;v<dH;v++){center.y=(v+0.5)*ratioY;icenter.y=floor(center.y);a=0;red=0;green=0;blue=0;alpha=0;for(i=icenter.x-range2X;i<=icenter.x+range2X;i++){if(i<0||i>=oW){continue;}fX=floor(1000*abs(i-center.x));if(!cacheLanc[fX]){cacheLanc[fX]={};}for(var j=icenter.y-range2Y;j<=icenter.y+range2Y;j++){if(j<0||j>=oH){continue;}fY=floor(1000*abs(j-center.y));if(!cacheLanc[fX][fY]){cacheLanc[fX][fY]=lanczos(sqrt(pow(fX*rcpRatioX,2)+pow(fY*rcpRatioY,2))/1000);}weight=cacheLanc[fX][fY];if(weight>0){idx=(j*oW+i)*4;a+=weight;red+=weight*srcData[idx];green+=weight*srcData[idx+1];blue+=weight*srcData[idx+2];alpha+=weight*srcData[idx+3];}}}idx=(v*dW+u)*4;destData[idx]=red/a;destData[idx+1]=green/a;destData[idx+2]=blue/a;destData[idx+3]=alpha/a;}if(++u<dW){return process(u);}else{return destImg;}}var srcData=options.imageData.data,destImg=options.ctx.createImageData(dW,dH),destData=destImg.data,lanczos=this.lanczosCreate(this.lanczosLobes),ratioX=this.rcpScaleX,ratioY=this.rcpScaleY,rcpRatioX=2/this.rcpScaleX,rcpRatioY=2/this.rcpScaleY,range2X=ceil(ratioX*this.lanczosLobes/2),range2Y=ceil(ratioY*this.lanczosLobes/2),cacheLanc={},center={},icenter={};return process(0);},/**\n       * bilinearFiltering\n       * @param {Object} canvasEl Canvas element to apply filter to\n       * @param {Number} oW Original Width\n       * @param {Number} oH Original Height\n       * @param {Number} dW Destination Width\n       * @param {Number} dH Destination Height\n       * @returns {ImageData}\n       */bilinearFiltering:function(options,oW,oH,dW,dH){var a,b,c,d,x,y,i,j,xDiff,yDiff,chnl,color,offset=0,origPix,ratioX=this.rcpScaleX,ratioY=this.rcpScaleY,w4=4*(oW-1),img=options.imageData,pixels=img.data,destImage=options.ctx.createImageData(dW,dH),destPixels=destImage.data;for(i=0;i<dH;i++){for(j=0;j<dW;j++){x=floor(ratioX*j);y=floor(ratioY*i);xDiff=ratioX*j-x;yDiff=ratioY*i-y;origPix=4*(y*oW+x);for(chnl=0;chnl<4;chnl++){a=pixels[origPix+chnl];b=pixels[origPix+4+chnl];c=pixels[origPix+w4+chnl];d=pixels[origPix+w4+4+chnl];color=a*(1-xDiff)*(1-yDiff)+b*xDiff*(1-yDiff)+c*yDiff*(1-xDiff)+d*xDiff*yDiff;destPixels[offset++]=color;}}}return destImage;},/**\n       * hermiteFastResize\n       * @param {Object} canvasEl Canvas element to apply filter to\n       * @param {Number} oW Original Width\n       * @param {Number} oH Original Height\n       * @param {Number} dW Destination Width\n       * @param {Number} dH Destination Height\n       * @returns {ImageData}\n       */hermiteFastResize:function(options,oW,oH,dW,dH){var ratioW=this.rcpScaleX,ratioH=this.rcpScaleY,ratioWHalf=ceil(ratioW/2),ratioHHalf=ceil(ratioH/2),img=options.imageData,data=img.data,img2=options.ctx.createImageData(dW,dH),data2=img2.data;for(var j=0;j<dH;j++){for(var i=0;i<dW;i++){var x2=(i+j*dW)*4,weight=0,weights=0,weightsAlpha=0,gxR=0,gxG=0,gxB=0,gxA=0,centerY=(j+0.5)*ratioH;for(var yy=floor(j*ratioH);yy<(j+1)*ratioH;yy++){var dy=abs(centerY-(yy+0.5))/ratioHHalf,centerX=(i+0.5)*ratioW,w0=dy*dy;for(var xx=floor(i*ratioW);xx<(i+1)*ratioW;xx++){var dx=abs(centerX-(xx+0.5))/ratioWHalf,w=sqrt(w0+dx*dx);/* eslint-disable max-depth */if(w>1&&w<-1){continue;}//hermite filter\nweight=2*w*w*w-3*w*w+1;if(weight>0){dx=4*(xx+yy*oW);//alpha\ngxA+=weight*data[dx+3];weightsAlpha+=weight;//colors\nif(data[dx+3]<255){weight=weight*data[dx+3]/250;}gxR+=weight*data[dx];gxG+=weight*data[dx+1];gxB+=weight*data[dx+2];weights+=weight;}/* eslint-enable max-depth */}}data2[x2]=gxR/weights;data2[x2+1]=gxG/weights;data2[x2+2]=gxB/weights;data2[x2+3]=gxA/weightsAlpha;}}return img2;},/**\n       * Returns object representation of an instance\n       * @return {Object} Object representation of an instance\n       */toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes};}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Resize} Instance of fabric.Image.filters.Resize\n   */fabric.Image.filters.Resize.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Contrast filter class\n   * @class fabric.Image.filters.Contrast\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Contrast#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Contrast({\n   *   contrast: 0.25\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */filters.Contrast=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.Contrast.prototype */{/**\n       * Filter type\n       * @param {String} type\n       * @default\n       */type:\"Contrast\",fragmentSource:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform float uContrast;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = texture2D(uTexture, vTexCoord);\\n\"+\"float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\\n\"+\"color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\\n\"+\"gl_FragColor = color;\\n\"+\"}\",/**\n       * contrast value, range from -1 to 1.\n       * @param {Number} contrast\n       * @default 0\n       */contrast:0,mainParameter:\"contrast\",/**\n       * Constructor\n       * @memberOf fabric.Image.filters.Contrast.prototype\n       * @param {Object} [options] Options object\n       * @param {Number} [options.contrast=0] Value to contrast the image up (-1...1)\n       */ /**\n       * Apply the Contrast operation to a Uint8Array representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8Array to be filtered.\n       */applyTo2d:function(options){if(this.contrast===0){return;}var imageData=options.imageData,i,len,data=imageData.data,len=data.length,contrast=Math.floor(this.contrast*255),contrastF=259*(contrast+255)/(255*(259-contrast));for(i=0;i<len;i+=4){data[i]=contrastF*(data[i]-128)+128;data[i+1]=contrastF*(data[i+1]-128)+128;data[i+2]=contrastF*(data[i+2]-128)+128;}},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uContrast:gl.getUniformLocation(program,\"uContrast\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uContrast,this.contrast);}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Contrast} Instance of fabric.Image.filters.Contrast\n   */fabric.Image.filters.Contrast.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Saturate filter class\n   * @class fabric.Image.filters.Saturation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Saturation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Saturation({\n   *   saturation: 100\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */filters.Saturation=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.Saturation.prototype */{/**\n       * Filter type\n       * @param {String} type\n       * @default\n       */type:\"Saturation\",fragmentSource:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform float uSaturation;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = texture2D(uTexture, vTexCoord);\\n\"+\"float rgMax = max(color.r, color.g);\\n\"+\"float rgbMax = max(rgMax, color.b);\\n\"+\"color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\\n\"+\"color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\\n\"+\"color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\\n\"+\"gl_FragColor = color;\\n\"+\"}\",saturation:0,mainParameter:\"saturation\",/**\n       * Constructor\n       * @memberOf fabric.Image.filters.Saturate.prototype\n       * @param {Object} [options] Options object\n       * @param {Number} [options.saturate=0] Value to saturate the image (-1...1)\n       */ /**\n       * Apply the Saturation operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */applyTo2d:function(options){if(this.saturation===0){return;}var imageData=options.imageData,data=imageData.data,len=data.length,adjust=-this.saturation,i,max;for(i=0;i<len;i+=4){max=Math.max(data[i],data[i+1],data[i+2]);data[i]+=max!==data[i]?(max-data[i])*adjust:0;data[i+1]+=max!==data[i+1]?(max-data[i+1])*adjust:0;data[i+2]+=max!==data[i+2]?(max-data[i+2])*adjust:0;}},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uSaturation:gl.getUniformLocation(program,\"uSaturation\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uSaturation,-this.saturation);}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Saturation} Instance of fabric.Image.filters.Saturate\n   */fabric.Image.filters.Saturation.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Blur filter class\n   * @class fabric.Image.filters.Blur\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Blur#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Blur({\n   *   blur: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */filters.Blur=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.Blur.prototype */{type:\"Blur\",/*\n    'gl_FragColor = vec4(0.0);',\n    'gl_FragColor += texture2D(texture, vTexCoord + -7 * uDelta)*0.0044299121055113265;',\n    'gl_FragColor += texture2D(texture, vTexCoord + -6 * uDelta)*0.00895781211794;',\n    'gl_FragColor += texture2D(texture, vTexCoord + -5 * uDelta)*0.0215963866053;',\n    'gl_FragColor += texture2D(texture, vTexCoord + -4 * uDelta)*0.0443683338718;',\n    'gl_FragColor += texture2D(texture, vTexCoord + -3 * uDelta)*0.0776744219933;',\n    'gl_FragColor += texture2D(texture, vTexCoord + -2 * uDelta)*0.115876621105;',\n    'gl_FragColor += texture2D(texture, vTexCoord + -1 * uDelta)*0.147308056121;',\n    'gl_FragColor += texture2D(texture, vTexCoord              )*0.159576912161;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 1 * uDelta)*0.147308056121;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 2 * uDelta)*0.115876621105;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 3 * uDelta)*0.0776744219933;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 4 * uDelta)*0.0443683338718;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 5 * uDelta)*0.0215963866053;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 6 * uDelta)*0.00895781211794;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 7 * uDelta)*0.0044299121055113265;',\n    */ /* eslint-disable max-len */fragmentSource:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform vec2 uDelta;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"const float nSamples = 15.0;\\n\"+\"vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\\n\"+\"float random(vec3 scale) {\\n\"+/* use the fragment position for a different seed per-pixel */\"return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\\n\"+\"}\\n\"+\"void main() {\\n\"+\"vec4 color = vec4(0.0);\\n\"+\"float total = 0.0;\\n\"+\"float offset = random(v3offset);\\n\"+\"for (float t = -nSamples; t <= nSamples; t++) {\\n\"+\"float percent = (t + offset - 0.5) / nSamples;\\n\"+\"float weight = 1.0 - abs(percent);\\n\"+\"color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\\n\"+\"total += weight;\\n\"+\"}\\n\"+\"gl_FragColor = color / total;\\n\"+\"}\",/* eslint-enable max-len */ /**\n       * blur value, in percentage of image dimensions.\n       * specific to keep the image blur constant at different resolutions\n       * range bewteen 0 and 1.\n       */blur:0,mainParameter:\"blur\",applyTo:function(options){if(options.webgl){// this aspectRatio is used to give the same blur to vertical and horizontal\nthis.aspectRatio=options.sourceWidth/options.sourceHeight;options.passes++;this._setupFrameBuffer(options);this.horizontal=true;this.applyToWebGL(options);this._swapTextures(options);this._setupFrameBuffer(options);this.horizontal=false;this.applyToWebGL(options);this._swapTextures(options);}else{this.applyTo2d(options);}},applyTo2d:function(options){// paint canvasEl with current image data.\n//options.ctx.putImageData(options.imageData, 0, 0);\noptions.imageData=this.simpleBlur(options);},simpleBlur:function(options){var resources=options.filterBackend.resources,canvas1,canvas2,width=options.imageData.width,height=options.imageData.height;if(!resources.blurLayer1){resources.blurLayer1=fabric.util.createCanvasElement();resources.blurLayer2=fabric.util.createCanvasElement();}canvas1=resources.blurLayer1;canvas2=resources.blurLayer2;if(canvas1.width!==width||canvas1.height!==height){canvas2.width=canvas1.width=width;canvas2.height=canvas1.height=height;}var ctx1=canvas1.getContext(\"2d\"),ctx2=canvas2.getContext(\"2d\"),nSamples=15,random,percent,j,i,blur=this.blur*0.06*0.5;// load first canvas\nctx1.putImageData(options.imageData,0,0);ctx2.clearRect(0,0,width,height);for(i=-nSamples;i<=nSamples;i++){random=(Math.random()-0.5)/4;percent=i/nSamples;j=blur*percent*width+random;ctx2.globalAlpha=1-Math.abs(percent);ctx2.drawImage(canvas1,j,random);ctx1.drawImage(canvas2,0,0);ctx2.globalAlpha=1;ctx2.clearRect(0,0,canvas2.width,canvas2.height);}for(i=-nSamples;i<=nSamples;i++){random=(Math.random()-0.5)/4;percent=i/nSamples;j=blur*percent*height+random;ctx2.globalAlpha=1-Math.abs(percent);ctx2.drawImage(canvas1,random,j);ctx1.drawImage(canvas2,0,0);ctx2.globalAlpha=1;ctx2.clearRect(0,0,canvas2.width,canvas2.height);}options.ctx.drawImage(canvas1,0,0);var newImageData=options.ctx.getImageData(0,0,canvas1.width,canvas1.height);ctx1.globalAlpha=1;ctx1.clearRect(0,0,canvas1.width,canvas1.height);return newImageData;},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{delta:gl.getUniformLocation(program,\"uDelta\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){var delta=this.chooseRightDelta();gl.uniform2fv(uniformLocations.delta,delta);},/**\n       * choose right value of image percentage to blur with\n       * @returns {Array} a numeric array with delta values\n       */chooseRightDelta:function(){var blurScale=1,delta=[0,0],blur;if(this.horizontal){if(this.aspectRatio>1){// image is wide, i want to shrink radius horizontal\nblurScale=1/this.aspectRatio;}}else{if(this.aspectRatio<1){// image is tall, i want to shrink radius vertical\nblurScale=this.aspectRatio;}}blur=blurScale*this.blur*0.12;if(this.horizontal){delta[0]=blur;}else{delta[1]=blur;}return delta;}});/**\n   * Deserialize a JSON definition of a BlurFilter into a concrete instance.\n   */filters.Blur.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * Gamma filter class\n   * @class fabric.Image.filters.Gamma\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Gamma#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Gamma({\n   *   brightness: 200\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */filters.Gamma=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.Gamma.prototype */{/**\n       * Filter type\n       * @param {String} type\n       * @default\n       */type:\"Gamma\",fragmentSource:\"precision highp float;\\n\"+\"uniform sampler2D uTexture;\\n\"+\"uniform vec3 uGamma;\\n\"+\"varying vec2 vTexCoord;\\n\"+\"void main() {\\n\"+\"vec4 color = texture2D(uTexture, vTexCoord);\\n\"+\"vec3 correction = (1.0 / uGamma);\\n\"+\"color.r = pow(color.r, correction.r);\\n\"+\"color.g = pow(color.g, correction.g);\\n\"+\"color.b = pow(color.b, correction.b);\\n\"+\"gl_FragColor = color;\\n\"+\"gl_FragColor.rgb *= color.a;\\n\"+\"}\",/**\n       * Gamma array value, from 0.01 to 2.2.\n       * @param {Array} gamma\n       * @default\n       */gamma:[1,1,1],/**\n       * Describe the property that is the filter parameter\n       * @param {String} m\n       * @default\n       */mainParameter:\"gamma\",/**\n       * Constructor\n       * @param {Object} [options] Options object\n       */initialize:function(options){this.gamma=[1,1,1];filters.BaseFilter.prototype.initialize.call(this,options);},/**\n       * Apply the Gamma operation to a Uint8Array representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8Array to be filtered.\n       */applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,gamma=this.gamma,len=data.length,rInv=1/gamma[0],gInv=1/gamma[1],bInv=1/gamma[2],i;if(!this.rVals){// eslint-disable-next-line\nthis.rVals=new Uint8Array(256);// eslint-disable-next-line\nthis.gVals=new Uint8Array(256);// eslint-disable-next-line\nthis.bVals=new Uint8Array(256);}// This is an optimization - pre-compute a look-up table for each color channel\n// instead of performing these pow calls for each pixel in the image.\nfor(i=0,len=256;i<len;i++){this.rVals[i]=Math.pow(i/255,rInv)*255;this.gVals[i]=Math.pow(i/255,gInv)*255;this.bVals[i]=Math.pow(i/255,bInv)*255;}for(i=0,len=data.length;i<len;i+=4){data[i]=this.rVals[data[i]];data[i+1]=this.gVals[data[i+1]];data[i+2]=this.bVals[data[i+2]];}},/**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */getUniformLocations:function(gl,program){return{uGamma:gl.getUniformLocation(program,\"uGamma\")};},/**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */sendUniformData:function(gl,uniformLocations){gl.uniform3fv(uniformLocations.uGamma,this.gamma);}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Gamma} Instance of fabric.Image.filters.Gamma\n   */fabric.Image.filters.Gamma.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * A container class that knows how to apply a sequence of filters to an input image.\n   */filters.Composed=createClass(filters.BaseFilter,/** @lends fabric.Image.filters.Composed.prototype */{type:\"Composed\",/**\n       * A non sparse array of filters to apply\n       */subFilters:[],/**\n       * Constructor\n       * @param {Object} [options] Options object\n       */initialize:function(options){this.callSuper(\"initialize\",options);// create a new array instead mutating the prototype with push\nthis.subFilters=this.subFilters.slice(0);},/**\n       * Apply this container's filters to the input image provided.\n       *\n       * @param {Object} options\n       * @param {Number} options.passes The number of filters remaining to be applied.\n       */applyTo:function(options){options.passes+=this.subFilters.length-1;this.subFilters.forEach(function(filter){filter.applyTo(options);});},/**\n       * Serialize this filter into JSON.\n       *\n       * @returns {Object} A JSON representation of this filter.\n       */toObject:function(){return fabric.util.object.extend(this.callSuper(\"toObject\"),{subFilters:this.subFilters.map(function(filter){return filter.toObject();})});},isNeutralState:function(){return!this.subFilters.some(function(filter){return!filter.isNeutralState();});}});/**\n   * Deserialize a JSON definition of a ComposedFilter into a concrete instance.\n   */fabric.Image.filters.Composed.fromObject=function(object,callback){var filters=object.subFilters||[],subFilters=filters.map(function(filter){return new fabric.Image.filters[filter.type](filter);}),instance=new fabric.Image.filters.Composed({subFilters:subFilters});callback&&callback(instance);return instance;};})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;/**\n   * HueRotation filter class\n   * @class fabric.Image.filters.HueRotation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.HueRotation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.HueRotation({\n   *   rotation: -0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */filters.HueRotation=createClass(filters.ColorMatrix,/** @lends fabric.Image.filters.HueRotation.prototype */{/**\n       * Filter type\n       * @param {String} type\n       * @default\n       */type:\"HueRotation\",/**\n       * HueRotation value, from -1 to 1.\n       * the unit is radians\n       * @param {Number} myParameter\n       * @default\n       */rotation:0,/**\n       * Describe the property that is the filter parameter\n       * @param {String} m\n       * @default\n       */mainParameter:\"rotation\",calculateMatrix:function(){var rad=this.rotation*Math.PI,cos=fabric.util.cos(rad),sin=fabric.util.sin(rad),aThird=1/3,aThirdSqtSin=Math.sqrt(aThird)*sin,OneMinusCos=1-cos;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this.matrix[0]=cos+OneMinusCos/3;this.matrix[1]=aThird*OneMinusCos-aThirdSqtSin;this.matrix[2]=aThird*OneMinusCos+aThirdSqtSin;this.matrix[5]=aThird*OneMinusCos+aThirdSqtSin;this.matrix[6]=cos+aThird*OneMinusCos;this.matrix[7]=aThird*OneMinusCos-aThirdSqtSin;this.matrix[10]=aThird*OneMinusCos-aThirdSqtSin;this.matrix[11]=aThird*OneMinusCos+aThirdSqtSin;this.matrix[12]=cos+aThird*OneMinusCos;},/**\n       * HueRotation isNeutralState implementation\n       * Used only in image applyFilters to discard filters that will not have an effect\n       * on the image\n       * @param {Object} options\n       **/isNeutralState:function(options){this.calculateMatrix();return filters.BaseFilter.prototype.isNeutralState.call(this,options);},/**\n       * Apply this filter to the input image data provided.\n       *\n       * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n       *\n       * @param {Object} options\n       * @param {Number} options.passes The number of filters remaining to be executed\n       * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n       * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n       * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */applyTo:function(options){this.calculateMatrix();filters.BaseFilter.prototype.applyTo.call(this,options);}});/**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.HueRotation} Instance of fabric.Image.filters.HueRotation\n   */fabric.Image.filters.HueRotation.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!==\"undefined\"?exports:this);(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={}),clone=fabric.util.object.clone;if(fabric.Text){fabric.warn(\"fabric.Text is already defined\");return;}/**\n   * Text class\n   * @class fabric.Text\n   * @extends fabric.Object\n   * @return {fabric.Text} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#text}\n   * @see {@link fabric.Text#initialize} for constructor definition\n   */fabric.Text=fabric.util.createClass(fabric.Object,/** @lends fabric.Text.prototype */{/**\n       * Properties which when set cause object to change dimensions\n       * @type Array\n       * @private\n       */_dimensionAffectingProps:[\"fontSize\",\"fontWeight\",\"fontFamily\",\"fontStyle\",\"lineHeight\",\"text\",\"charSpacing\",\"textAlign\",\"styles\"],/**\n       * @private\n       */_reNewline:/\\r?\\n/,/**\n       * Use this regular expression to filter for whitespaces that is not a new line.\n       * Mostly used when text is 'justify' aligned.\n       * @private\n       */_reSpacesAndTabs:/[ \\t\\r]/g,/**\n       * Use this regular expression to filter for whitespace that is not a new line.\n       * Mostly used when text is 'justify' aligned.\n       * @private\n       */_reSpaceAndTab:/[ \\t\\r]/,/**\n       * Use this regular expression to filter consecutive groups of non spaces.\n       * Mostly used when text is 'justify' aligned.\n       * @private\n       */_reWords:/\\S+/g,/**\n       * Type of an object\n       * @type String\n       * @default\n       */type:\"text\",/**\n       * Font size (in pixels)\n       * @type Number\n       * @default\n       */fontSize:40,/**\n       * Font weight (e.g. bold, normal, 400, 600, 800)\n       * @type {(Number|String)}\n       * @default\n       */fontWeight:\"normal\",/**\n       * Font family\n       * @type String\n       * @default\n       */fontFamily:\"Times New Roman\",/**\n       * Text decoration underline.\n       * @type Boolean\n       * @default\n       */underline:false,/**\n       * Text decoration overline.\n       * @type Boolean\n       * @default\n       */overline:false,/**\n       * Text decoration linethrough.\n       * @type Boolean\n       * @default\n       */linethrough:false,/**\n       * Text alignment. Possible values: \"left\", \"center\", \"right\", \"justify\",\n       * \"justify-left\", \"justify-center\" or \"justify-right\".\n       * @type String\n       * @default\n       */textAlign:\"left\",/**\n       * Font style . Possible values: \"\", \"normal\", \"italic\" or \"oblique\".\n       * @type String\n       * @default\n       */fontStyle:\"normal\",/**\n       * Line height\n       * @type Number\n       * @default\n       */lineHeight:1.16,/**\n       * Superscript schema object (minimum overlap)\n       * @type {Object}\n       * @default\n       */superscript:{size:0.6,// fontSize factor\nbaseline:-0.35// baseline-shift factor (upwards)\n},/**\n       * Subscript schema object (minimum overlap)\n       * @type {Object}\n       * @default\n       */subscript:{size:0.6,// fontSize factor\nbaseline:0.11// baseline-shift factor (downwards)\n},/**\n       * Background color of text lines\n       * @type String\n       * @default\n       */textBackgroundColor:\"\",/**\n       * List of properties to consider when checking if\n       * state of an object is changed ({@link fabric.Object#hasStateChanged})\n       * as well as for history (undo/redo) purposes\n       * @type Array\n       */stateProperties:fabric.Object.prototype.stateProperties.concat(\"fontFamily\",\"fontWeight\",\"fontSize\",\"text\",\"underline\",\"overline\",\"linethrough\",\"textAlign\",\"fontStyle\",\"lineHeight\",\"textBackgroundColor\",\"charSpacing\",\"styles\"),/**\n       * List of properties to consider when checking if cache needs refresh\n       * @type Array\n       */cacheProperties:fabric.Object.prototype.cacheProperties.concat(\"fontFamily\",\"fontWeight\",\"fontSize\",\"text\",\"underline\",\"overline\",\"linethrough\",\"textAlign\",\"fontStyle\",\"lineHeight\",\"textBackgroundColor\",\"charSpacing\",\"styles\"),/**\n       * When defined, an object is rendered via stroke and this property specifies its color.\n       * <b>Backwards incompatibility note:</b> This property was named \"strokeStyle\" until v1.1.6\n       * @type String\n       * @default\n       */stroke:null,/**\n       * Shadow object representing shadow of this shape.\n       * <b>Backwards incompatibility note:</b> This property was named \"textShadow\" (String) until v1.2.11\n       * @type fabric.Shadow\n       * @default\n       */shadow:null,/**\n       * @private\n       */_fontSizeFraction:0.222,/**\n       * @private\n       */offsets:{underline:0.1,linethrough:-0.315,overline:-0.88},/**\n       * Text Line proportion to font Size (in pixels)\n       * @type Number\n       * @default\n       */_fontSizeMult:1.13,/**\n       * additional space between characters\n       * expressed in thousands of em unit\n       * @type Number\n       * @default\n       */charSpacing:0,/**\n       * Object containing character styles - top-level properties -> line numbers,\n       * 2nd-level properties - charater numbers\n       * @type Object\n       * @default\n       */styles:null,/**\n       * Reference to a context to measure text char or couple of chars\n       * the cacheContext of the canvas will be used or a freshly created one if the object is not on canvas\n       * once created it will be referenced on fabric._measuringContext to avoide creating a canvas for every\n       * text object created.\n       * @type {CanvasRenderingContext2D}\n       * @default\n       */_measuringContext:null,/**\n       * Baseline shift, stlyes only, keep at 0 for the main text object\n       * @type {Number}\n       * @default\n       */deltaY:0,/**\n       * Array of properties that define a style unit (of 'styles').\n       * @type {Array}\n       * @default\n       */_styleProperties:[\"stroke\",\"strokeWidth\",\"fill\",\"fontFamily\",\"fontSize\",\"fontWeight\",\"fontStyle\",\"underline\",\"overline\",\"linethrough\",\"deltaY\",\"textBackgroundColor\"],/**\n       * contains characters bounding boxes\n       */__charBounds:[],/**\n       * use this size when measuring text. To avoid IE11 rounding errors\n       * @type {Number}\n       * @default\n       * @readonly\n       * @private\n       */CACHE_FONT_SIZE:400,/**\n       * contains the min text width to avoid getting 0\n       * @type {Number}\n       * @default\n       */MIN_TEXT_WIDTH:2,/**\n       * Constructor\n       * @param {String} text Text string\n       * @param {Object} [options] Options object\n       * @return {fabric.Text} thisArg\n       */initialize:function(text,options){this.styles=options?options.styles||{}:{};this.text=text;this.__skipDimension=true;this.callSuper(\"initialize\",options);this.__skipDimension=false;this.initDimensions();this.setCoords();this.setupState({propertySet:\"_dimensionAffectingProps\"});},/**\n       * Return a contex for measurement of text string.\n       * if created it gets stored for reuse\n       * @param {String} text Text string\n       * @param {Object} [options] Options object\n       * @return {fabric.Text} thisArg\n       */getMeasuringContext:function(){// if we did not return we have to measure something.\nif(!fabric._measuringContext){fabric._measuringContext=this.canvas&&this.canvas.contextCache||fabric.util.createCanvasElement().getContext(\"2d\");}return fabric._measuringContext;},/**\n       * @private\n       * Divides text into lines of text and lines of graphemes.\n       */_splitText:function(){var newLines=this._splitTextIntoLines(this.text);this.textLines=newLines.lines;this._textLines=newLines.graphemeLines;this._unwrappedTextLines=newLines._unwrappedLines;this._text=newLines.graphemeText;return newLines;},/**\n       * Initialize or update text dimensions.\n       * Updates this.width and this.height with the proper values.\n       * Does not return dimensions.\n       */initDimensions:function(){if(this.__skipDimension){return;}this._splitText();this._clearCache();this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH;if(this.textAlign.indexOf(\"justify\")!==-1){// once text is measured we need to make space fatter to make justified text.\nthis.enlargeSpaces();}this.height=this.calcTextHeight();this.saveState({propertySet:\"_dimensionAffectingProps\"});},/**\n       * Enlarge space boxes and shift the others\n       */enlargeSpaces:function(){var diffSpace,currentLineWidth,numberOfSpaces,accumulatedSpace,line,charBound,spaces;for(var i=0,len=this._textLines.length;i<len;i++){if(this.textAlign!==\"justify\"&&(i===len-1||this.isEndOfWrapping(i))){continue;}accumulatedSpace=0;line=this._textLines[i];currentLineWidth=this.getLineWidth(i);if(currentLineWidth<this.width&&(spaces=this.textLines[i].match(this._reSpacesAndTabs))){numberOfSpaces=spaces.length;diffSpace=(this.width-currentLineWidth)/numberOfSpaces;for(var j=0,jlen=line.length;j<=jlen;j++){charBound=this.__charBounds[i][j];if(this._reSpaceAndTab.test(line[j])){charBound.width+=diffSpace;charBound.kernedWidth+=diffSpace;charBound.left+=accumulatedSpace;accumulatedSpace+=diffSpace;}else{charBound.left+=accumulatedSpace;}}}}},/**\n       * Detect if the text line is ended with an hard break\n       * text and itext do not have wrapping, return false\n       * @return {Boolean}\n       */isEndOfWrapping:function(lineIndex){return lineIndex===this._textLines.length-1;},/**\n       * Detect if a line has a linebreak and so we need to account for it when moving\n       * and counting style.\n       * It return always for text and Itext.\n       * @return Number\n       */missingNewlineOffset:function(){return 1;},/**\n       * Returns string representation of an instance\n       * @return {String} String representation of text object\n       */toString:function(){return\"#<fabric.Text (\"+this.complexity()+'): { \"text\": \"'+this.text+'\", \"fontFamily\": \"'+this.fontFamily+'\" }>';},/**\n       * Return the dimension and the zoom level needed to create a cache canvas\n       * big enough to host the object to be cached.\n       * @private\n       * @param {Object} dim.x width of object to be cached\n       * @param {Object} dim.y height of object to be cached\n       * @return {Object}.width width of canvas\n       * @return {Object}.height height of canvas\n       * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n       * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n       */_getCacheCanvasDimensions:function(){var dims=this.callSuper(\"_getCacheCanvasDimensions\");var fontSize=this.fontSize;dims.width+=fontSize*dims.zoomX;dims.height+=fontSize*dims.zoomY;return dims;},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_render:function(ctx){this._setTextStyles(ctx);this._renderTextLinesBackground(ctx);this._renderTextDecoration(ctx,\"underline\");this._renderText(ctx);this._renderTextDecoration(ctx,\"overline\");this._renderTextDecoration(ctx,\"linethrough\");},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderText:function(ctx){if(this.paintFirst===\"stroke\"){this._renderTextStroke(ctx);this._renderTextFill(ctx);}else{this._renderTextFill(ctx);this._renderTextStroke(ctx);}},/**\n       * Set the font parameter of the context with the object properties or with charStyle\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {Object} [charStyle] object with font style properties\n       * @param {String} [charStyle.fontFamily] Font Family\n       * @param {Number} [charStyle.fontSize] Font size in pixels. ( without px suffix )\n       * @param {String} [charStyle.fontWeight] Font weight\n       * @param {String} [charStyle.fontStyle] Font style (italic|normal)\n       */_setTextStyles:function(ctx,charStyle,forMeasuring){ctx.textBaseline=\"alphabetic\";ctx.font=this._getFontDeclaration(charStyle,forMeasuring);},/**\n       * calculate and return the text Width measuring each line.\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @return {Number} Maximum width of fabric.Text object\n       */calcTextWidth:function(){var maxWidth=this.getLineWidth(0);for(var i=1,len=this._textLines.length;i<len;i++){var currentLineWidth=this.getLineWidth(i);if(currentLineWidth>maxWidth){maxWidth=currentLineWidth;}}return maxWidth;},/**\n       * @private\n       * @param {String} method Method name (\"fillText\" or \"strokeText\")\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {String} line Text to render\n       * @param {Number} left Left position of text\n       * @param {Number} top Top position of text\n       * @param {Number} lineIndex Index of a line in a text\n       */_renderTextLine:function(method,ctx,line,left,top,lineIndex){this._renderChars(method,ctx,line,left,top,lineIndex);},/**\n       * Renders the text background for lines, taking care of style\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderTextLinesBackground:function(ctx){if(!this.textBackgroundColor&&!this.styleHas(\"textBackgroundColor\")){return;}var lineTopOffset=0,heightOfLine,lineLeftOffset,originalFill=ctx.fillStyle,line,lastColor,leftOffset=this._getLeftOffset(),topOffset=this._getTopOffset(),boxStart=0,boxWidth=0,charBox,currentColor;for(var i=0,len=this._textLines.length;i<len;i++){heightOfLine=this.getHeightOfLine(i);if(!this.textBackgroundColor&&!this.styleHas(\"textBackgroundColor\",i)){lineTopOffset+=heightOfLine;continue;}line=this._textLines[i];lineLeftOffset=this._getLineLeftOffset(i);boxWidth=0;boxStart=0;lastColor=this.getValueOfPropertyAt(i,0,\"textBackgroundColor\");for(var j=0,jlen=line.length;j<jlen;j++){charBox=this.__charBounds[i][j];currentColor=this.getValueOfPropertyAt(i,j,\"textBackgroundColor\");if(currentColor!==lastColor){ctx.fillStyle=lastColor;lastColor&&ctx.fillRect(leftOffset+lineLeftOffset+boxStart,topOffset+lineTopOffset,boxWidth,heightOfLine/this.lineHeight);boxStart=charBox.left;boxWidth=charBox.width;lastColor=currentColor;}else{boxWidth+=charBox.kernedWidth;}}if(currentColor){ctx.fillStyle=currentColor;ctx.fillRect(leftOffset+lineLeftOffset+boxStart,topOffset+lineTopOffset,boxWidth,heightOfLine/this.lineHeight);}lineTopOffset+=heightOfLine;}ctx.fillStyle=originalFill;// if there is text background color no\n// other shadows should be casted\nthis._removeShadow(ctx);},/**\n       * @private\n       * @param {Object} decl style declaration for cache\n       * @param {String} decl.fontFamily fontFamily\n       * @param {String} decl.fontStyle fontStyle\n       * @param {String} decl.fontWeight fontWeight\n       * @return {Object} reference to cache\n       */getFontCache:function(decl){var fontFamily=decl.fontFamily.toLowerCase();if(!fabric.charWidthsCache[fontFamily]){fabric.charWidthsCache[fontFamily]={};}var cache=fabric.charWidthsCache[fontFamily],cacheProp=decl.fontStyle.toLowerCase()+\"_\"+(decl.fontWeight+\"\").toLowerCase();if(!cache[cacheProp]){cache[cacheProp]={};}return cache[cacheProp];},/**\n       * apply all the character style to canvas for rendering\n       * @private\n       * @param {String} _char\n       * @param {Number} lineIndex\n       * @param {Number} charIndex\n       * @param {Object} [decl]\n       */_applyCharStyles:function(method,ctx,lineIndex,charIndex,styleDeclaration){this._setFillStyles(ctx,styleDeclaration);this._setStrokeStyles(ctx,styleDeclaration);ctx.font=this._getFontDeclaration(styleDeclaration);},/**\n       * measure and return the width of a single character.\n       * possibly overridden to accommodate different measure logic or\n       * to hook some external lib for character measurement\n       * @private\n       * @param {String} _char, char to be measured\n       * @param {Object} charStyle style of char to be measured\n       * @param {String} [previousChar] previous char\n       * @param {Object} [prevCharStyle] style of previous char\n       */_measureChar:function(_char,charStyle,previousChar,prevCharStyle){// first i try to return from cache\nvar fontCache=this.getFontCache(charStyle),fontDeclaration=this._getFontDeclaration(charStyle),previousFontDeclaration=this._getFontDeclaration(prevCharStyle),couple=previousChar+_char,stylesAreEqual=fontDeclaration===previousFontDeclaration,width,coupleWidth,previousWidth,fontMultiplier=charStyle.fontSize/this.CACHE_FONT_SIZE,kernedWidth;if(previousChar&&fontCache[previousChar]!==undefined){previousWidth=fontCache[previousChar];}if(fontCache[_char]!==undefined){kernedWidth=width=fontCache[_char];}if(stylesAreEqual&&fontCache[couple]!==undefined){coupleWidth=fontCache[couple];kernedWidth=coupleWidth-previousWidth;}if(width===undefined||previousWidth===undefined||coupleWidth===undefined){var ctx=this.getMeasuringContext();// send a TRUE to specify measuring font size CACHE_FONT_SIZE\nthis._setTextStyles(ctx,charStyle,true);}if(width===undefined){kernedWidth=width=ctx.measureText(_char).width;fontCache[_char]=width;}if(previousWidth===undefined&&stylesAreEqual&&previousChar){previousWidth=ctx.measureText(previousChar).width;fontCache[previousChar]=previousWidth;}if(stylesAreEqual&&coupleWidth===undefined){// we can measure the kerning couple and subtract the width of the previous character\ncoupleWidth=ctx.measureText(couple).width;fontCache[couple]=coupleWidth;kernedWidth=coupleWidth-previousWidth;}return{width:width*fontMultiplier,kernedWidth:kernedWidth*fontMultiplier};},/**\n       * Computes height of character at given position\n       * @param {Number} line the line index number\n       * @param {Number} _char the character index number\n       * @return {Number} fontSize of the character\n       */getHeightOfChar:function(line,_char){return this.getValueOfPropertyAt(line,_char,\"fontSize\");},/**\n       * measure a text line measuring all characters.\n       * @param {Number} lineIndex line number\n       * @return {Number} Line width\n       */measureLine:function(lineIndex){var lineInfo=this._measureLine(lineIndex);if(this.charSpacing!==0){lineInfo.width-=this._getWidthOfCharSpacing();}if(lineInfo.width<0){lineInfo.width=0;}return lineInfo;},/**\n       * measure every grapheme of a line, populating __charBounds\n       * @param {Number} lineIndex\n       * @return {Object} object.width total width of characters\n       * @return {Object} object.widthOfSpaces length of chars that match this._reSpacesAndTabs\n       */_measureLine:function(lineIndex){var width=0,i,grapheme,line=this._textLines[lineIndex],prevGrapheme,graphemeInfo,numOfSpaces=0,lineBounds=new Array(line.length);this.__charBounds[lineIndex]=lineBounds;for(i=0;i<line.length;i++){grapheme=line[i];graphemeInfo=this._getGraphemeBox(grapheme,lineIndex,i,prevGrapheme);lineBounds[i]=graphemeInfo;width+=graphemeInfo.kernedWidth;prevGrapheme=grapheme;}// this latest bound box represent the last character of the line\n// to simplify cursor handling in interactive mode.\nlineBounds[i]={left:graphemeInfo?graphemeInfo.left+graphemeInfo.width:0,width:0,kernedWidth:0,height:this.fontSize};return{width:width,numOfSpaces:numOfSpaces};},/**\n       * Measure and return the info of a single grapheme.\n       * needs the the info of previous graphemes already filled\n       * @private\n       * @param {String} grapheme to be measured\n       * @param {Number} lineIndex index of the line where the char is\n       * @param {Number} charIndex position in the line\n       * @param {String} [prevGrapheme] character preceding the one to be measured\n       */_getGraphemeBox:function(grapheme,lineIndex,charIndex,prevGrapheme,skipLeft){var style=this.getCompleteStyleDeclaration(lineIndex,charIndex),prevStyle=prevGrapheme?this.getCompleteStyleDeclaration(lineIndex,charIndex-1):{},info=this._measureChar(grapheme,style,prevGrapheme,prevStyle),kernedWidth=info.kernedWidth,width=info.width,charSpacing;if(this.charSpacing!==0){charSpacing=this._getWidthOfCharSpacing();width+=charSpacing;kernedWidth+=charSpacing;}var box={width:width,left:0,height:style.fontSize,kernedWidth:kernedWidth,deltaY:style.deltaY};if(charIndex>0&&!skipLeft){var previousBox=this.__charBounds[lineIndex][charIndex-1];box.left=previousBox.left+previousBox.width+info.kernedWidth-info.width;}return box;},/**\n       * Calculate height of line at 'lineIndex'\n       * @param {Number} lineIndex index of line to calculate\n       * @return {Number}\n       */getHeightOfLine:function(lineIndex){if(this.__lineHeights[lineIndex]){return this.__lineHeights[lineIndex];}var line=this._textLines[lineIndex],// char 0 is measured before the line cycle because it nneds to char\n// emptylines\nmaxHeight=this.getHeightOfChar(lineIndex,0);for(var i=1,len=line.length;i<len;i++){maxHeight=Math.max(this.getHeightOfChar(lineIndex,i),maxHeight);}return this.__lineHeights[lineIndex]=maxHeight*this.lineHeight*this._fontSizeMult;},/**\n       * Calculate text box height\n       */calcTextHeight:function(){var lineHeight,height=0;for(var i=0,len=this._textLines.length;i<len;i++){lineHeight=this.getHeightOfLine(i);height+=i===len-1?lineHeight/this.lineHeight:lineHeight;}return height;},/**\n       * @private\n       * @return {Number} Left offset\n       */_getLeftOffset:function(){return-this.width/2;},/**\n       * @private\n       * @return {Number} Top offset\n       */_getTopOffset:function(){return-this.height/2;},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {String} method Method name (\"fillText\" or \"strokeText\")\n       */_renderTextCommon:function(ctx,method){ctx.save();var lineHeights=0,left=this._getLeftOffset(),top=this._getTopOffset(),offsets=this._applyPatternGradientTransform(ctx,method===\"fillText\"?this.fill:this.stroke);for(var i=0,len=this._textLines.length;i<len;i++){var heightOfLine=this.getHeightOfLine(i),maxHeight=heightOfLine/this.lineHeight,leftOffset=this._getLineLeftOffset(i);this._renderTextLine(method,ctx,this._textLines[i],left+leftOffset-offsets.offsetX,top+lineHeights+maxHeight-offsets.offsetY,i);lineHeights+=heightOfLine;}ctx.restore();},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderTextFill:function(ctx){if(!this.fill&&!this.styleHas(\"fill\")){return;}this._renderTextCommon(ctx,\"fillText\");},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderTextStroke:function(ctx){if((!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()){return;}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(ctx);}ctx.save();this._setLineDash(ctx,this.strokeDashArray);ctx.beginPath();this._renderTextCommon(ctx,\"strokeText\");ctx.closePath();ctx.restore();},/**\n       * @private\n       * @param {String} method\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {String} line Content of the line\n       * @param {Number} left\n       * @param {Number} top\n       * @param {Number} lineIndex\n       * @param {Number} charOffset\n       */_renderChars:function(method,ctx,line,left,top,lineIndex){// set proper line offset\nvar lineHeight=this.getHeightOfLine(lineIndex),isJustify=this.textAlign.indexOf(\"justify\")!==-1,actualStyle,nextStyle,charsToRender=\"\",charBox,boxWidth=0,timeToRender,shortCut=!isJustify&&this.charSpacing===0&&this.isEmptyStyles(lineIndex);ctx.save();top-=lineHeight*this._fontSizeFraction/this.lineHeight;if(shortCut){// render all the line in one pass without checking\nthis._renderChar(method,ctx,lineIndex,0,this.textLines[lineIndex],left,top,lineHeight);ctx.restore();return;}for(var i=0,len=line.length-1;i<=len;i++){timeToRender=i===len||this.charSpacing;charsToRender+=line[i];charBox=this.__charBounds[lineIndex][i];if(boxWidth===0){left+=charBox.kernedWidth-charBox.width;boxWidth+=charBox.width;}else{boxWidth+=charBox.kernedWidth;}if(isJustify&&!timeToRender){if(this._reSpaceAndTab.test(line[i])){timeToRender=true;}}if(!timeToRender){// if we have charSpacing, we render char by char\nactualStyle=actualStyle||this.getCompleteStyleDeclaration(lineIndex,i);nextStyle=this.getCompleteStyleDeclaration(lineIndex,i+1);timeToRender=this._hasStyleChanged(actualStyle,nextStyle);}if(timeToRender){this._renderChar(method,ctx,lineIndex,i,charsToRender,left,top,lineHeight);charsToRender=\"\";actualStyle=nextStyle;left+=boxWidth;boxWidth=0;}}ctx.restore();},/**\n       * @private\n       * @param {String} method\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {Number} lineIndex\n       * @param {Number} charIndex\n       * @param {String} _char\n       * @param {Number} left Left coordinate\n       * @param {Number} top Top coordinate\n       * @param {Number} lineHeight Height of the line\n       */_renderChar:function(method,ctx,lineIndex,charIndex,_char,left,top){var decl=this._getStyleDeclaration(lineIndex,charIndex),fullDecl=this.getCompleteStyleDeclaration(lineIndex,charIndex),shouldFill=method===\"fillText\"&&fullDecl.fill,shouldStroke=method===\"strokeText\"&&fullDecl.stroke&&fullDecl.strokeWidth;if(!shouldStroke&&!shouldFill){return;}decl&&ctx.save();this._applyCharStyles(method,ctx,lineIndex,charIndex,fullDecl);if(decl&&decl.textBackgroundColor){this._removeShadow(ctx);}if(decl&&decl.deltaY){top+=decl.deltaY;}shouldFill&&ctx.fillText(_char,left,top);shouldStroke&&ctx.strokeText(_char,left,top);decl&&ctx.restore();},/**\n       * Turns the character into a 'superior figure' (i.e. 'superscript')\n       * @param {Number} start selection start\n       * @param {Number} end selection end\n       * @returns {fabric.Text} thisArg\n       * @chainable\n       */setSuperscript:function(start,end){return this._setScript(start,end,this.superscript);},/**\n       * Turns the character into an 'inferior figure' (i.e. 'subscript')\n       * @param {Number} start selection start\n       * @param {Number} end selection end\n       * @returns {fabric.Text} thisArg\n       * @chainable\n       */setSubscript:function(start,end){return this._setScript(start,end,this.subscript);},/**\n       * Applies 'schema' at given position\n       * @private\n       * @param {Number} start selection start\n       * @param {Number} end selection end\n       * @param {Number} schema\n       * @returns {fabric.Text} thisArg\n       * @chainable\n       */_setScript:function(start,end,schema){var loc=this.get2DCursorLocation(start,true),fontSize=this.getValueOfPropertyAt(loc.lineIndex,loc.charIndex,\"fontSize\"),dy=this.getValueOfPropertyAt(loc.lineIndex,loc.charIndex,\"deltaY\"),style={fontSize:fontSize*schema.size,deltaY:dy+fontSize*schema.baseline};this.setSelectionStyles(style,start,end);return this;},/**\n       * @private\n       * @param {Object} prevStyle\n       * @param {Object} thisStyle\n       */_hasStyleChanged:function(prevStyle,thisStyle){return prevStyle.fill!==thisStyle.fill||prevStyle.stroke!==thisStyle.stroke||prevStyle.strokeWidth!==thisStyle.strokeWidth||prevStyle.fontSize!==thisStyle.fontSize||prevStyle.fontFamily!==thisStyle.fontFamily||prevStyle.fontWeight!==thisStyle.fontWeight||prevStyle.fontStyle!==thisStyle.fontStyle||prevStyle.deltaY!==thisStyle.deltaY;},/**\n       * @private\n       * @param {Object} prevStyle\n       * @param {Object} thisStyle\n       */_hasStyleChangedForSvg:function(prevStyle,thisStyle){return this._hasStyleChanged(prevStyle,thisStyle)||prevStyle.overline!==thisStyle.overline||prevStyle.underline!==thisStyle.underline||prevStyle.linethrough!==thisStyle.linethrough;},/**\n       * @private\n       * @param {Number} lineIndex index text line\n       * @return {Number} Line left offset\n       */_getLineLeftOffset:function(lineIndex){var lineWidth=this.getLineWidth(lineIndex);if(this.textAlign===\"center\"){return(this.width-lineWidth)/2;}if(this.textAlign===\"right\"){return this.width-lineWidth;}if(this.textAlign===\"justify-center\"&&this.isEndOfWrapping(lineIndex)){return(this.width-lineWidth)/2;}if(this.textAlign===\"justify-right\"&&this.isEndOfWrapping(lineIndex)){return this.width-lineWidth;}return 0;},/**\n       * @private\n       */_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__charBounds=[];},/**\n       * @private\n       */_shouldClearDimensionCache:function(){var shouldClear=this._forceClearCache;shouldClear||(shouldClear=this.hasStateChanged(\"_dimensionAffectingProps\"));if(shouldClear){this.dirty=true;this._forceClearCache=false;}return shouldClear;},/**\n       * Measure a single line given its index. Used to calculate the initial\n       * text bounding box. The values are calculated and stored in __lineWidths cache.\n       * @private\n       * @param {Number} lineIndex line number\n       * @return {Number} Line width\n       */getLineWidth:function(lineIndex){if(this.__lineWidths[lineIndex]){return this.__lineWidths[lineIndex];}var width,line=this._textLines[lineIndex],lineInfo;if(line===\"\"){width=0;}else{lineInfo=this.measureLine(lineIndex);width=lineInfo.width;}this.__lineWidths[lineIndex]=width;return width;},_getWidthOfCharSpacing:function(){if(this.charSpacing!==0){return this.fontSize*this.charSpacing/1000;}return 0;},/**\n       * Retrieves the value of property at given character position\n       * @param {Number} lineIndex the line number\n       * @param {Number} charIndex the charater number\n       * @param {String} property the property name\n       * @returns the value of 'property'\n       */getValueOfPropertyAt:function(lineIndex,charIndex,property){var charStyle=this._getStyleDeclaration(lineIndex,charIndex);if(charStyle&&typeof charStyle[property]!==\"undefined\"){return charStyle[property];}return this[property];},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_renderTextDecoration:function(ctx,type){if(!this[type]&&!this.styleHas(type)){return;}var heightOfLine,size,_size,lineLeftOffset,dy,_dy,line,lastDecoration,leftOffset=this._getLeftOffset(),topOffset=this._getTopOffset(),top,boxStart,boxWidth,charBox,currentDecoration,maxHeight,currentFill,lastFill,charSpacing=this._getWidthOfCharSpacing();for(var i=0,len=this._textLines.length;i<len;i++){heightOfLine=this.getHeightOfLine(i);if(!this[type]&&!this.styleHas(type,i)){topOffset+=heightOfLine;continue;}line=this._textLines[i];maxHeight=heightOfLine/this.lineHeight;lineLeftOffset=this._getLineLeftOffset(i);boxStart=0;boxWidth=0;lastDecoration=this.getValueOfPropertyAt(i,0,type);lastFill=this.getValueOfPropertyAt(i,0,\"fill\");top=topOffset+maxHeight*(1-this._fontSizeFraction);size=this.getHeightOfChar(i,0);dy=this.getValueOfPropertyAt(i,0,\"deltaY\");for(var j=0,jlen=line.length;j<jlen;j++){charBox=this.__charBounds[i][j];currentDecoration=this.getValueOfPropertyAt(i,j,type);currentFill=this.getValueOfPropertyAt(i,j,\"fill\");_size=this.getHeightOfChar(i,j);_dy=this.getValueOfPropertyAt(i,j,\"deltaY\");if((currentDecoration!==lastDecoration||currentFill!==lastFill||_size!==size||_dy!==dy)&&boxWidth>0){ctx.fillStyle=lastFill;lastDecoration&&lastFill&&ctx.fillRect(leftOffset+lineLeftOffset+boxStart,top+this.offsets[type]*size+dy,boxWidth,this.fontSize/15);boxStart=charBox.left;boxWidth=charBox.width;lastDecoration=currentDecoration;lastFill=currentFill;size=_size;dy=_dy;}else{boxWidth+=charBox.kernedWidth;}}ctx.fillStyle=currentFill;currentDecoration&&currentFill&&ctx.fillRect(leftOffset+lineLeftOffset+boxStart,top+this.offsets[type]*size+dy,boxWidth-charSpacing,this.fontSize/15);topOffset+=heightOfLine;}// if there is text background color no\n// other shadows should be casted\nthis._removeShadow(ctx);},/**\n       * return font declaration string for canvas context\n       * @param {Object} [styleObject] object\n       * @returns {String} font declaration formatted for canvas context.\n       */_getFontDeclaration:function(styleObject,forMeasuring){var style=styleObject||this,family=this.fontFamily,fontIsGeneric=fabric.Text.genericFonts.indexOf(family.toLowerCase())>-1;var fontFamily=family===undefined||family.indexOf(\"'\")>-1||family.indexOf(\",\")>-1||family.indexOf('\"')>-1||fontIsGeneric?style.fontFamily:'\"'+style.fontFamily+'\"';return[// node-canvas needs \"weight style\", while browsers need \"style weight\"\n// verify if this can be fixed in JSDOM\nfabric.isLikelyNode?style.fontWeight:style.fontStyle,fabric.isLikelyNode?style.fontStyle:style.fontWeight,forMeasuring?this.CACHE_FONT_SIZE+\"px\":style.fontSize+\"px\",fontFamily].join(\" \");},/**\n       * Renders text instance on a specified context\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */render:function(ctx){// do not render if object is not visible\nif(!this.visible){return;}if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()){return;}if(this._shouldClearDimensionCache()){this.initDimensions();}this.callSuper(\"render\",ctx);},/**\n       * Returns the text as an array of lines.\n       * @param {String} text text to split\n       * @returns {Array} Lines in the text\n       */_splitTextIntoLines:function(text){var lines=text.split(this._reNewline),newLines=new Array(lines.length),newLine=[\"\\n\"],newText=[];for(var i=0;i<lines.length;i++){newLines[i]=fabric.util.string.graphemeSplit(lines[i]);newText=newText.concat(newLines[i],newLine);}newText.pop();return{_unwrappedLines:newLines,lines:lines,graphemeText:newText,graphemeLines:newLines};},/**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} Object representation of an instance\n       */toObject:function(propertiesToInclude){var additionalProperties=[\"text\",\"fontSize\",\"fontWeight\",\"fontFamily\",\"fontStyle\",\"lineHeight\",\"underline\",\"overline\",\"linethrough\",\"textAlign\",\"textBackgroundColor\",\"charSpacing\"].concat(propertiesToInclude);var obj=this.callSuper(\"toObject\",additionalProperties);obj.styles=clone(this.styles,true);return obj;},/**\n       * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n       * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n       * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */set:function(key,value){this.callSuper(\"set\",key,value);var needsDims=false;if(typeof key===\"object\"){for(var _key in key){needsDims=needsDims||this._dimensionAffectingProps.indexOf(_key)!==-1;}}else{needsDims=this._dimensionAffectingProps.indexOf(key)!==-1;}if(needsDims){this.initDimensions();this.setCoords();}return this;},/**\n       * Returns complexity of an instance\n       * @return {Number} complexity\n       */complexity:function(){return 1;}});/* _FROM_SVG_START_ */ /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Text.fromElement})\n   * @static\n   * @memberOf fabric.Text\n   * @see: http://www.w3.org/TR/SVG/text.html#TextElement\n   */fabric.Text.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(\"x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor\".split(\" \"));/**\n   * Default SVG font size\n   * @static\n   * @memberOf fabric.Text\n   */fabric.Text.DEFAULT_SVG_FONT_SIZE=16;/**\n   * Returns fabric.Text instance from an SVG element (<b>not yet implemented</b>)\n   * @static\n   * @memberOf fabric.Text\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */fabric.Text.fromElement=function(element,callback,options){if(!element){return callback(null);}var parsedAttributes=fabric.parseAttributes(element,fabric.Text.ATTRIBUTE_NAMES),parsedAnchor=parsedAttributes.textAnchor||\"left\";options=fabric.util.object.extend(options?clone(options):{},parsedAttributes);options.top=options.top||0;options.left=options.left||0;if(parsedAttributes.textDecoration){var textDecoration=parsedAttributes.textDecoration;if(textDecoration.indexOf(\"underline\")!==-1){options.underline=true;}if(textDecoration.indexOf(\"overline\")!==-1){options.overline=true;}if(textDecoration.indexOf(\"line-through\")!==-1){options.linethrough=true;}delete options.textDecoration;}if(\"dx\"in parsedAttributes){options.left+=parsedAttributes.dx;}if(\"dy\"in parsedAttributes){options.top+=parsedAttributes.dy;}if(!(\"fontSize\"in options)){options.fontSize=fabric.Text.DEFAULT_SVG_FONT_SIZE;}var textContent=\"\";// The XML is not properly parsed in IE9 so a workaround to get\n// textContent is through firstChild.data. Another workaround would be\n// to convert XML loaded from a file to be converted using DOMParser (same way loadSVGFromString() does)\nif(!(\"textContent\"in element)){if(\"firstChild\"in element&&element.firstChild!==null){if(\"data\"in element.firstChild&&element.firstChild.data!==null){textContent=element.firstChild.data;}}}else{textContent=element.textContent;}textContent=textContent.replace(/^\\s+|\\s+$|\\n+/g,\"\").replace(/\\s+/g,\" \");var originalStrokeWidth=options.strokeWidth;options.strokeWidth=0;var text=new fabric.Text(textContent,options),textHeightScaleFactor=text.getScaledHeight()/text.height,lineHeightDiff=(text.height+text.strokeWidth)*text.lineHeight-text.height,scaledDiff=lineHeightDiff*textHeightScaleFactor,textHeight=text.getScaledHeight()+scaledDiff,offX=0;/*\n          Adjust positioning:\n            x/y attributes in SVG correspond to the bottom-left corner of text bounding box\n            fabric output by default at top, left.\n        */if(parsedAnchor===\"center\"){offX=text.getScaledWidth()/2;}if(parsedAnchor===\"right\"){offX=text.getScaledWidth();}text.set({left:text.left-offX,top:text.top-(textHeight-text.fontSize*(0.07+text._fontSizeFraction))/text.lineHeight,strokeWidth:typeof originalStrokeWidth!==\"undefined\"?originalStrokeWidth:1});callback(text);};/* _FROM_SVG_END_ */ /**\n   * Returns fabric.Text instance from an object representation\n   * @static\n   * @memberOf fabric.Text\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Text instance is created\n   */fabric.Text.fromObject=function(object,callback){return fabric.Object._fromObject(\"Text\",object,callback,\"text\");};fabric.Text.genericFonts=[\"sans-serif\",\"serif\",\"cursive\",\"fantasy\",\"monospace\"];fabric.util.createAccessors&&fabric.util.createAccessors(fabric.Text);})(typeof exports!==\"undefined\"?exports:this);(function(){fabric.util.object.extend(fabric.Text.prototype,/** @lends fabric.Text.prototype */{/**\n       * Returns true if object has no styling or no styling in a line\n       * @param {Number} lineIndex , lineIndex is on wrapped lines.\n       * @return {Boolean}\n       */isEmptyStyles:function(lineIndex){if(!this.styles){return true;}if(typeof lineIndex!==\"undefined\"&&!this.styles[lineIndex]){return true;}var obj=typeof lineIndex===\"undefined\"?this.styles:{line:this.styles[lineIndex]};for(var p1 in obj){for(var p2 in obj[p1]){// eslint-disable-next-line no-unused-vars\nfor(var p3 in obj[p1][p2]){return false;}}}return true;},/**\n       * Returns true if object has a style property or has it ina specified line\n       * This function is used to detect if a text will use a particular property or not.\n       * @param {String} property to check for\n       * @param {Number} lineIndex to check the style on\n       * @return {Boolean}\n       */styleHas:function(property,lineIndex){if(!this.styles||!property||property===\"\"){return false;}if(typeof lineIndex!==\"undefined\"&&!this.styles[lineIndex]){return false;}var obj=typeof lineIndex===\"undefined\"?this.styles:{0:this.styles[lineIndex]};// eslint-disable-next-line\nfor(var p1 in obj){// eslint-disable-next-line\nfor(var p2 in obj[p1]){if(typeof obj[p1][p2][property]!==\"undefined\"){return true;}}}return false;},/**\n       * Check if characters in a text have a value for a property\n       * whose value matches the textbox's value for that property.  If so,\n       * the character-level property is deleted.  If the character\n       * has no other properties, then it is also deleted.  Finally,\n       * if the line containing that character has no other characters\n       * then it also is deleted.\n       *\n       * @param {string} property The property to compare between characters and text.\n       */cleanStyle:function(property){if(!this.styles||!property||property===\"\"){return false;}var obj=this.styles,stylesCount=0,letterCount,stylePropertyValue,allStyleObjectPropertiesMatch=true,graphemeCount=0,styleObject;// eslint-disable-next-line\nfor(var p1 in obj){letterCount=0;// eslint-disable-next-line\nfor(var p2 in obj[p1]){var styleObject=obj[p1][p2],stylePropertyHasBeenSet=styleObject.hasOwnProperty(property);stylesCount++;if(stylePropertyHasBeenSet){if(!stylePropertyValue){stylePropertyValue=styleObject[property];}else if(styleObject[property]!==stylePropertyValue){allStyleObjectPropertiesMatch=false;}if(styleObject[property]===this[property]){delete styleObject[property];}}else{allStyleObjectPropertiesMatch=false;}if(Object.keys(styleObject).length!==0){letterCount++;}else{delete obj[p1][p2];}}if(letterCount===0){delete obj[p1];}}// if every grapheme has the same style set then\n// delete those styles and set it on the parent\nfor(var i=0;i<this._textLines.length;i++){graphemeCount+=this._textLines[i].length;}if(allStyleObjectPropertiesMatch&&stylesCount===graphemeCount){this[property]=stylePropertyValue;this.removeStyle(property);}},/**\n       * Remove a style property or properties from all individual character styles\n       * in a text object.  Deletes the character style object if it contains no other style\n       * props.  Deletes a line style object if it contains no other character styles.\n       *\n       * @param {String} props The property to remove from character styles.\n       */removeStyle:function(property){if(!this.styles||!property||property===\"\"){return;}var obj=this.styles,line,lineNum,charNum;for(lineNum in obj){line=obj[lineNum];for(charNum in line){delete line[charNum][property];if(Object.keys(line[charNum]).length===0){delete line[charNum];}}if(Object.keys(line).length===0){delete obj[lineNum];}}},/**\n       * @private\n       */_extendStyles:function(index,styles){var loc=this.get2DCursorLocation(index);if(!this._getLineStyle(loc.lineIndex)){this._setLineStyle(loc.lineIndex);}if(!this._getStyleDeclaration(loc.lineIndex,loc.charIndex)){this._setStyleDeclaration(loc.lineIndex,loc.charIndex,{});}fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex,loc.charIndex),styles);},/**\n       * Returns 2d representation (lineIndex and charIndex) of cursor (or selection start)\n       * @param {Number} [selectionStart] Optional index. When not given, current selectionStart is used.\n       * @param {Boolean} [skipWrapping] consider the location for unwrapped lines. useful to manage styles.\n       */get2DCursorLocation:function(selectionStart,skipWrapping){if(typeof selectionStart===\"undefined\"){selectionStart=this.selectionStart;}var lines=skipWrapping?this._unwrappedTextLines:this._textLines,len=lines.length;for(var i=0;i<len;i++){if(selectionStart<=lines[i].length){return{lineIndex:i,charIndex:selectionStart};}selectionStart-=lines[i].length+this.missingNewlineOffset(i);}return{lineIndex:i-1,charIndex:lines[i-1].length<selectionStart?lines[i-1].length:selectionStart};},/**\n       * Gets style of a current selection/cursor (at the start position)\n       * if startIndex or endIndex are not provided, slectionStart or selectionEnd will be used.\n       * @param {Number} [startIndex] Start index to get styles at\n       * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n       * @param {Boolean} [complete] get full style or not\n       * @return {Array} styles an array with one, zero or more Style objects\n       */getSelectionStyles:function(startIndex,endIndex,complete){if(typeof startIndex===\"undefined\"){startIndex=this.selectionStart||0;}if(typeof endIndex===\"undefined\"){endIndex=this.selectionEnd||startIndex;}var styles=[];for(var i=startIndex;i<endIndex;i++){styles.push(this.getStyleAtPosition(i,complete));}return styles;},/**\n       * Gets style of a current selection/cursor position\n       * @param {Number} position  to get styles at\n       * @param {Boolean} [complete] full style if true\n       * @return {Object} style Style object at a specified index\n       * @private\n       */getStyleAtPosition:function(position,complete){var loc=this.get2DCursorLocation(position),style=complete?this.getCompleteStyleDeclaration(loc.lineIndex,loc.charIndex):this._getStyleDeclaration(loc.lineIndex,loc.charIndex);return style||{};},/**\n       * Sets style of a current selection, if no selection exist, do not set anything.\n       * @param {Object} [styles] Styles object\n       * @param {Number} [startIndex] Start index to get styles at\n       * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n       * @return {fabric.IText} thisArg\n       * @chainable\n       */setSelectionStyles:function(styles,startIndex,endIndex){if(typeof startIndex===\"undefined\"){startIndex=this.selectionStart||0;}if(typeof endIndex===\"undefined\"){endIndex=this.selectionEnd||startIndex;}for(var i=startIndex;i<endIndex;i++){this._extendStyles(i,styles);}/* not included in _extendStyles to avoid clearing cache more than once */this._forceClearCache=true;return this;},/**\n       * get the reference, not a clone, of the style object for a given character\n       * @param {Number} lineIndex\n       * @param {Number} charIndex\n       * @return {Object} style object\n       */_getStyleDeclaration:function(lineIndex,charIndex){var lineStyle=this.styles&&this.styles[lineIndex];if(!lineStyle){return null;}return lineStyle[charIndex];},/**\n       * return a new object that contains all the style property for a character\n       * the object returned is newly created\n       * @param {Number} lineIndex of the line where the character is\n       * @param {Number} charIndex position of the character on the line\n       * @return {Object} style object\n       */getCompleteStyleDeclaration:function(lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,charIndex)||{},styleObject={},prop;for(var i=0;i<this._styleProperties.length;i++){prop=this._styleProperties[i];styleObject[prop]=typeof style[prop]===\"undefined\"?this[prop]:style[prop];}return styleObject;},/**\n       * @param {Number} lineIndex\n       * @param {Number} charIndex\n       * @param {Object} style\n       * @private\n       */_setStyleDeclaration:function(lineIndex,charIndex,style){this.styles[lineIndex][charIndex]=style;},/**\n       *\n       * @param {Number} lineIndex\n       * @param {Number} charIndex\n       * @private\n       */_deleteStyleDeclaration:function(lineIndex,charIndex){delete this.styles[lineIndex][charIndex];},/**\n       * @param {Number} lineIndex\n       * @return {Boolean} if the line exists or not\n       * @private\n       */_getLineStyle:function(lineIndex){return!!this.styles[lineIndex];},/**\n       * Set the line style to an empty object so that is initialized\n       * @param {Number} lineIndex\n       * @private\n       */_setLineStyle:function(lineIndex){this.styles[lineIndex]={};},/**\n       * @param {Number} lineIndex\n       * @private\n       */_deleteLineStyle:function(lineIndex){delete this.styles[lineIndex];}});})();(function(){function parseDecoration(object){if(object.textDecoration){object.textDecoration.indexOf(\"underline\")>-1&&(object.underline=true);object.textDecoration.indexOf(\"line-through\")>-1&&(object.linethrough=true);object.textDecoration.indexOf(\"overline\")>-1&&(object.overline=true);delete object.textDecoration;}}/**\n   * IText class (introduced in <b>v1.4</b>) Events are also fired with \"text:\"\n   * prefix when observing canvas.\n   * @class fabric.IText\n   * @extends fabric.Text\n   * @mixes fabric.Observable\n   *\n   * @fires changed\n   * @fires selection:changed\n   * @fires editing:entered\n   * @fires editing:exited\n   *\n   * @return {fabric.IText} thisArg\n   * @see {@link fabric.IText#initialize} for constructor definition\n   *\n   * <p>Supported key combinations:</p>\n   * <pre>\n   *   Move cursor:                    left, right, up, down\n   *   Select character:               shift + left, shift + right\n   *   Select text vertically:         shift + up, shift + down\n   *   Move cursor by word:            alt + left, alt + right\n   *   Select words:                   shift + alt + left, shift + alt + right\n   *   Move cursor to line start/end:  cmd + left, cmd + right or home, end\n   *   Select till start/end of line:  cmd + shift + left, cmd + shift + right or shift + home, shift + end\n   *   Jump to start/end of text:      cmd + up, cmd + down\n   *   Select till start/end of text:  cmd + shift + up, cmd + shift + down or shift + pgUp, shift + pgDown\n   *   Delete character:               backspace\n   *   Delete word:                    alt + backspace\n   *   Delete line:                    cmd + backspace\n   *   Forward delete:                 delete\n   *   Copy text:                      ctrl/cmd + c\n   *   Paste text:                     ctrl/cmd + v\n   *   Cut text:                       ctrl/cmd + x\n   *   Select entire text:             ctrl/cmd + a\n   *   Quit editing                    tab or esc\n   * </pre>\n   *\n   * <p>Supported mouse/touch combination</p>\n   * <pre>\n   *   Position cursor:                click/touch\n   *   Create selection:               click/touch & drag\n   *   Create selection:               click & shift + click\n   *   Select word:                    double click\n   *   Select line:                    triple click\n   * </pre>\n   */fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,/** @lends fabric.IText.prototype */{/**\n       * Type of an object\n       * @type String\n       * @default\n       */type:\"i-text\",/**\n       * Index where text selection starts (or where cursor is when there is no selection)\n       * @type Number\n       * @default\n       */selectionStart:0,/**\n       * Index where text selection ends\n       * @type Number\n       * @default\n       */selectionEnd:0,/**\n       * Color of text selection\n       * @type String\n       * @default\n       */selectionColor:\"rgba(17,119,255,0.3)\",/**\n       * Indicates whether text is in editing mode\n       * @type Boolean\n       * @default\n       */isEditing:false,/**\n       * Indicates whether a text can be edited\n       * @type Boolean\n       * @default\n       */editable:true,/**\n       * Border color of text object while it's in editing mode\n       * @type String\n       * @default\n       */editingBorderColor:\"rgba(102,153,255,0.25)\",/**\n       * Width of cursor (in px)\n       * @type Number\n       * @default\n       */cursorWidth:2,/**\n       * Color of text cursor color in editing mode.\n       * if not set (default) will take color from the text.\n       * if set to a color value that fabric can understand, it will\n       * be used instead of the color of the text at the current position.\n       * @type String\n       * @default\n       */cursorColor:\"\",/**\n       * Delay between cursor blink (in ms)\n       * @type Number\n       * @default\n       */cursorDelay:1000,/**\n       * Duration of cursor fadein (in ms)\n       * @type Number\n       * @default\n       */cursorDuration:600,/**\n       * Indicates whether internal text char widths can be cached\n       * @type Boolean\n       * @default\n       */caching:true,/**\n       * @private\n       */_reSpace:/\\s|\\n/,/**\n       * @private\n       */_currentCursorOpacity:0,/**\n       * @private\n       */_selectionDirection:null,/**\n       * @private\n       */_abortCursorAnimation:false,/**\n       * @private\n       */__widthOfSpace:[],/**\n       * Helps determining when the text is in composition, so that the cursor\n       * rendering is altered.\n       */inCompositionMode:false,/**\n       * Constructor\n       * @param {String} text Text string\n       * @param {Object} [options] Options object\n       * @return {fabric.IText} thisArg\n       */initialize:function(text,options){this.callSuper(\"initialize\",text,options);this.initBehavior();},/**\n       * Sets selection start (left boundary of a selection)\n       * @param {Number} index Index to set selection start to\n       */setSelectionStart:function(index){index=Math.max(index,0);this._updateAndFire(\"selectionStart\",index);},/**\n       * Sets selection end (right boundary of a selection)\n       * @param {Number} index Index to set selection end to\n       */setSelectionEnd:function(index){index=Math.min(index,this.text.length);this._updateAndFire(\"selectionEnd\",index);},/**\n       * @private\n       * @param {String} property 'selectionStart' or 'selectionEnd'\n       * @param {Number} index new position of property\n       */_updateAndFire:function(property,index){if(this[property]!==index){this._fireSelectionChanged();this[property]=index;}this._updateTextarea();},/**\n       * Fires the even of selection changed\n       * @private\n       */_fireSelectionChanged:function(){this.fire(\"selection:changed\");this.canvas&&this.canvas.fire(\"text:selection:changed\",{target:this});},/**\n       * Initialize text dimensions. Render all text on given context\n       * or on a offscreen canvas to get the text width with measureText.\n       * Updates this.width and this.height with the proper values.\n       * Does not return dimensions.\n       * @private\n       */initDimensions:function(){this.isEditing&&this.initDelayedCursor();this.clearContextTop();this.callSuper(\"initDimensions\");},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */render:function(ctx){this.clearContextTop();this.callSuper(\"render\",ctx);// clear the cursorOffsetCache, so we ensure to calculate once per renderCursor\n// the correct position but not at every cursor animation.\nthis.cursorOffsetCache={};this.renderCursorOrSelection();},/**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */_render:function(ctx){this.callSuper(\"_render\",ctx);},/**\n       * Prepare and clean the contextTop\n       */clearContextTop:function(skipRestore){if(!this.isEditing||!this.canvas||!this.canvas.contextTop){return;}var ctx=this.canvas.contextTop,v=this.canvas.viewportTransform;ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);this.transform(ctx);this._clearTextArea(ctx);skipRestore||ctx.restore();},/**\n       * Renders cursor or selection (depending on what exists)\n       * it does on the contextTop. If contextTop is not available, do nothing.\n       */renderCursorOrSelection:function(){if(!this.isEditing||!this.canvas||!this.canvas.contextTop){return;}var boundaries=this._getCursorBoundaries(),ctx=this.canvas.contextTop;this.clearContextTop(true);if(this.selectionStart===this.selectionEnd){this.renderCursor(boundaries,ctx);}else{this.renderSelection(boundaries,ctx);}ctx.restore();},_clearTextArea:function(ctx){// we add 4 pixel, to be sure to do not leave any pixel out\nvar width=this.width+4,height=this.height+4;ctx.clearRect(-width/2,-height/2,width,height);},/**\n       * Returns cursor boundaries (left, top, leftOffset, topOffset)\n       * @private\n       * @param {Array} chars Array of characters\n       * @param {String} typeOfBoundaries\n       */_getCursorBoundaries:function(position){// left/top are left/top of entire text box\n// leftOffset/topOffset are offset from that left/top point of a text box\nif(typeof position===\"undefined\"){position=this.selectionStart;}var left=this._getLeftOffset(),top=this._getTopOffset(),offsets=this._getCursorBoundariesOffsets(position);return{left:left,top:top,leftOffset:offsets.left,topOffset:offsets.top};},/**\n       * @private\n       */_getCursorBoundariesOffsets:function(position){if(this.cursorOffsetCache&&\"top\"in this.cursorOffsetCache){return this.cursorOffsetCache;}var lineLeftOffset,lineIndex,charIndex,topOffset=0,leftOffset=0,boundaries,cursorPosition=this.get2DCursorLocation(position);charIndex=cursorPosition.charIndex;lineIndex=cursorPosition.lineIndex;for(var i=0;i<lineIndex;i++){topOffset+=this.getHeightOfLine(i);}lineLeftOffset=this._getLineLeftOffset(lineIndex);var bound=this.__charBounds[lineIndex][charIndex];bound&&(leftOffset=bound.left);if(this.charSpacing!==0&&charIndex===this._textLines[lineIndex].length){leftOffset-=this._getWidthOfCharSpacing();}boundaries={top:topOffset,left:lineLeftOffset+(leftOffset>0?leftOffset:0)};this.cursorOffsetCache=boundaries;return this.cursorOffsetCache;},/**\n       * Renders cursor\n       * @param {Object} boundaries\n       * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n       */renderCursor:function(boundaries,ctx){var cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex>0?cursorLocation.charIndex-1:0,charHeight=this.getValueOfPropertyAt(lineIndex,charIndex,\"fontSize\"),multiplier=this.scaleX*this.canvas.getZoom(),cursorWidth=this.cursorWidth/multiplier,topOffset=boundaries.topOffset,dy=this.getValueOfPropertyAt(lineIndex,charIndex,\"deltaY\");topOffset+=(1-this._fontSizeFraction)*this.getHeightOfLine(lineIndex)/this.lineHeight-charHeight*(1-this._fontSizeFraction);if(this.inCompositionMode){this.renderSelection(boundaries,ctx);}ctx.fillStyle=this.cursorColor||this.getValueOfPropertyAt(lineIndex,charIndex,\"fill\");ctx.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;ctx.fillRect(boundaries.left+boundaries.leftOffset-cursorWidth/2,topOffset+boundaries.top+dy,cursorWidth,charHeight);},/**\n       * Renders text selection\n       * @param {Object} boundaries Object with left/top/leftOffset/topOffset\n       * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n       */renderSelection:function(boundaries,ctx){var selectionStart=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,isJustify=this.textAlign.indexOf(\"justify\")!==-1,start=this.get2DCursorLocation(selectionStart),end=this.get2DCursorLocation(selectionEnd),startLine=start.lineIndex,endLine=end.lineIndex,startChar=start.charIndex<0?0:start.charIndex,endChar=end.charIndex<0?0:end.charIndex;for(var i=startLine;i<=endLine;i++){var lineOffset=this._getLineLeftOffset(i)||0,lineHeight=this.getHeightOfLine(i),realLineHeight=0,boxStart=0,boxEnd=0;if(i===startLine){boxStart=this.__charBounds[startLine][startChar].left;}if(i>=startLine&&i<endLine){boxEnd=isJustify&&!this.isEndOfWrapping(i)?this.width:this.getLineWidth(i)||5;// WTF is this 5?\n}else if(i===endLine){if(endChar===0){boxEnd=this.__charBounds[endLine][endChar].left;}else{var charSpacing=this._getWidthOfCharSpacing();boxEnd=this.__charBounds[endLine][endChar-1].left+this.__charBounds[endLine][endChar-1].width-charSpacing;}}realLineHeight=lineHeight;if(this.lineHeight<1||i===endLine&&this.lineHeight>1){lineHeight/=this.lineHeight;}if(this.inCompositionMode){ctx.fillStyle=this.compositionColor||\"black\";ctx.fillRect(boundaries.left+lineOffset+boxStart,boundaries.top+boundaries.topOffset+lineHeight,boxEnd-boxStart,1);}else{ctx.fillStyle=this.selectionColor;ctx.fillRect(boundaries.left+lineOffset+boxStart,boundaries.top+boundaries.topOffset,boxEnd-boxStart,lineHeight);}boundaries.topOffset+=realLineHeight;}},/**\n       * High level function to know the height of the cursor.\n       * the currentChar is the one that precedes the cursor\n       * Returns fontSize of char at the current cursor\n       * Unused from the library, is for the end user\n       * @return {Number} Character font size\n       */getCurrentCharFontSize:function(){var cp=this._getCurrentCharIndex();return this.getValueOfPropertyAt(cp.l,cp.c,\"fontSize\");},/**\n       * High level function to know the color of the cursor.\n       * the currentChar is the one that precedes the cursor\n       * Returns color (fill) of char at the current cursor\n       * Unused from the library, is for the end user\n       * @return {String} Character color (fill)\n       */getCurrentCharColor:function(){var cp=this._getCurrentCharIndex();return this.getValueOfPropertyAt(cp.l,cp.c,\"fill\");},/**\n       * Returns the cursor position for the getCurrent.. functions\n       * @private\n       */_getCurrentCharIndex:function(){var cursorPosition=this.get2DCursorLocation(this.selectionStart,true),charIndex=cursorPosition.charIndex>0?cursorPosition.charIndex-1:0;return{l:cursorPosition.lineIndex,c:charIndex};}});/**\n   * Returns fabric.IText instance from an object representation\n   * @static\n   * @memberOf fabric.IText\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as argument\n   */fabric.IText.fromObject=function(object,callback){parseDecoration(object);if(object.styles){for(var i in object.styles){for(var j in object.styles[i]){parseDecoration(object.styles[i][j]);}}}fabric.Object._fromObject(\"IText\",object,callback,\"text\");};})();(function(){var clone=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,/** @lends fabric.IText.prototype */{/**\n       * Initializes all the interactive behavior of IText\n       */initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation();this.mouseMoveHandler=this.mouseMoveHandler.bind(this);},onDeselect:function(){this.isEditing&&this.exitEditing();this.selected=false;},/**\n       * Initializes \"added\" event handler\n       */initAddedHandler:function(){var _this=this;this.on(\"added\",function(){var canvas=_this.canvas;if(canvas){if(!canvas._hasITextHandlers){canvas._hasITextHandlers=true;_this._initCanvasHandlers(canvas);}canvas._iTextInstances=canvas._iTextInstances||[];canvas._iTextInstances.push(_this);}});},initRemovedHandler:function(){var _this=this;this.on(\"removed\",function(){var canvas=_this.canvas;if(canvas){canvas._iTextInstances=canvas._iTextInstances||[];fabric.util.removeFromArray(canvas._iTextInstances,_this);if(canvas._iTextInstances.length===0){canvas._hasITextHandlers=false;_this._removeCanvasHandlers(canvas);}}});},/**\n       * register canvas event to manage exiting on other instances\n       * @private\n       */_initCanvasHandlers:function(canvas){canvas._mouseUpITextHandler=function(){if(canvas._iTextInstances){canvas._iTextInstances.forEach(function(obj){obj.__isMousedown=false;});}};canvas.on(\"mouse:up\",canvas._mouseUpITextHandler);},/**\n       * remove canvas event to manage exiting on other instances\n       * @private\n       */_removeCanvasHandlers:function(canvas){canvas.off(\"mouse:up\",canvas._mouseUpITextHandler);},/**\n       * @private\n       */_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,\"_onTickComplete\");},/**\n       * @private\n       */_animateCursor:function(obj,targetOpacity,duration,completeMethod){var tickState;tickState={isAborted:false,abort:function(){this.isAborted=true;}};obj.animate(\"_currentCursorOpacity\",targetOpacity,{duration:duration,onComplete:function(){if(!tickState.isAborted){obj[completeMethod]();}},onChange:function(){// we do not want to animate a selection, only cursor\nif(obj.canvas&&obj.selectionStart===obj.selectionEnd){obj.renderCursorOrSelection();}},abort:function(){return tickState.isAborted;}});return tickState;},/**\n       * @private\n       */_onTickComplete:function(){var _this=this;if(this._cursorTimeout1){clearTimeout(this._cursorTimeout1);}this._cursorTimeout1=setTimeout(function(){_this._currentTickCompleteState=_this._animateCursor(_this,0,this.cursorDuration/2,\"_tick\");},100);},/**\n       * Initializes delayed cursor\n       */initDelayedCursor:function(restart){var _this=this,delay=restart?0:this.cursorDelay;this.abortCursorAnimation();this._currentCursorOpacity=1;this._cursorTimeout2=setTimeout(function(){_this._tick();},delay);},/**\n       * Aborts cursor animation and clears all timeouts\n       */abortCursorAnimation:function(){var shouldClear=this._currentTickState||this._currentTickCompleteState,canvas=this.canvas;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;// to clear just itext area we need to transform the context\n// it may not be worth it\nif(shouldClear&&canvas){canvas.clearContext(canvas.contextTop||canvas.contextContainer);}},/**\n       * Selects entire text\n       * @return {fabric.IText} thisArg\n       * @chainable\n       */selectAll:function(){this.selectionStart=0;this.selectionEnd=this._text.length;this._fireSelectionChanged();this._updateTextarea();return this;},/**\n       * Returns selected text\n       * @return {String}\n       */getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join(\"\");},/**\n       * Find new selection index representing start of current word according to current selection index\n       * @param {Number} startFrom Current selection index\n       * @return {Number} New selection index\n       */findWordBoundaryLeft:function(startFrom){var offset=0,index=startFrom-1;// remove space before cursor first\nif(this._reSpace.test(this._text[index])){while(this._reSpace.test(this._text[index])){offset++;index--;}}while(/\\S/.test(this._text[index])&&index>-1){offset++;index--;}return startFrom-offset;},/**\n       * Find new selection index representing end of current word according to current selection index\n       * @param {Number} startFrom Current selection index\n       * @return {Number} New selection index\n       */findWordBoundaryRight:function(startFrom){var offset=0,index=startFrom;// remove space after cursor first\nif(this._reSpace.test(this._text[index])){while(this._reSpace.test(this._text[index])){offset++;index++;}}while(/\\S/.test(this._text[index])&&index<this._text.length){offset++;index++;}return startFrom+offset;},/**\n       * Find new selection index representing start of current line according to current selection index\n       * @param {Number} startFrom Current selection index\n       * @return {Number} New selection index\n       */findLineBoundaryLeft:function(startFrom){var offset=0,index=startFrom-1;while(!/\\n/.test(this._text[index])&&index>-1){offset++;index--;}return startFrom-offset;},/**\n       * Find new selection index representing end of current line according to current selection index\n       * @param {Number} startFrom Current selection index\n       * @return {Number} New selection index\n       */findLineBoundaryRight:function(startFrom){var offset=0,index=startFrom;while(!/\\n/.test(this._text[index])&&index<this._text.length){offset++;index++;}return startFrom+offset;},/**\n       * Finds index corresponding to beginning or end of a word\n       * @param {Number} selectionStart Index of a character\n       * @param {Number} direction 1 or -1\n       * @return {Number} Index of the beginning or end of a word\n       */searchWordBoundary:function(selectionStart,direction){var text=this._text,index=this._reSpace.test(text[selectionStart])?selectionStart-1:selectionStart,_char=text[index],// wrong\nreNonWord=fabric.reNonWord;while(!reNonWord.test(_char)&&index>0&&index<text.length){index+=direction;_char=text[index];}if(reNonWord.test(_char)){index+=direction===1?0:1;}return index;},/**\n       * Selects a word based on the index\n       * @param {Number} selectionStart Index of a character\n       */selectWord:function(selectionStart){selectionStart=selectionStart||this.selectionStart;var newSelectionStart=this.searchWordBoundary(selectionStart,-1)/* search backwards */,newSelectionEnd=this.searchWordBoundary(selectionStart,1);/* search forward */this.selectionStart=newSelectionStart;this.selectionEnd=newSelectionEnd;this._fireSelectionChanged();this._updateTextarea();this.renderCursorOrSelection();},/**\n       * Selects a line based on the index\n       * @param {Number} selectionStart Index of a character\n       * @return {fabric.IText} thisArg\n       * @chainable\n       */selectLine:function(selectionStart){selectionStart=selectionStart||this.selectionStart;var newSelectionStart=this.findLineBoundaryLeft(selectionStart),newSelectionEnd=this.findLineBoundaryRight(selectionStart);this.selectionStart=newSelectionStart;this.selectionEnd=newSelectionEnd;this._fireSelectionChanged();this._updateTextarea();return this;},/**\n       * Enters editing state\n       * @return {fabric.IText} thisArg\n       * @chainable\n       */enterEditing:function(e){if(this.isEditing||!this.editable){return;}if(this.canvas){this.canvas.calcOffset();this.exitEditingOnOthers(this.canvas);}this.isEditing=true;this.initHiddenTextarea(e);this.hiddenTextarea.focus();this.hiddenTextarea.value=this.text;this._updateTextarea();this._saveEditingProps();this._setEditingProps();this._textBeforeEdit=this.text;this._tick();this.fire(\"editing:entered\");this._fireSelectionChanged();if(!this.canvas){return this;}this.canvas.fire(\"text:editing:entered\",{target:this});this.initMouseMoveHandler();this.canvas.requestRenderAll();return this;},exitEditingOnOthers:function(canvas){if(canvas._iTextInstances){canvas._iTextInstances.forEach(function(obj){obj.selected=false;if(obj.isEditing){obj.exitEditing();}});}},/**\n       * Initializes \"mousemove\" event handler\n       */initMouseMoveHandler:function(){this.canvas.on(\"mouse:move\",this.mouseMoveHandler);},/**\n       * @private\n       */mouseMoveHandler:function(options){if(!this.__isMousedown||!this.isEditing){return;}var newSelectionStart=this.getSelectionStartFromPointer(options.e),currentStart=this.selectionStart,currentEnd=this.selectionEnd;if((newSelectionStart!==this.__selectionStartOnMouseDown||currentStart===currentEnd)&&(currentStart===newSelectionStart||currentEnd===newSelectionStart)){return;}if(newSelectionStart>this.__selectionStartOnMouseDown){this.selectionStart=this.__selectionStartOnMouseDown;this.selectionEnd=newSelectionStart;}else{this.selectionStart=newSelectionStart;this.selectionEnd=this.__selectionStartOnMouseDown;}if(this.selectionStart!==currentStart||this.selectionEnd!==currentEnd){this.restartCursorIfNeeded();this._fireSelectionChanged();this._updateTextarea();this.renderCursorOrSelection();}},/**\n       * @private\n       */_setEditingProps:function(){this.hoverCursor=\"text\";if(this.canvas){this.canvas.defaultCursor=this.canvas.moveCursor=\"text\";}this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=false;this.lockMovementX=this.lockMovementY=true;},/**\n       * convert from textarea to grapheme indexes\n       */fromStringToGraphemeSelection:function(start,end,text){var smallerTextStart=text.slice(0,start),graphemeStart=fabric.util.string.graphemeSplit(smallerTextStart).length;if(start===end){return{selectionStart:graphemeStart,selectionEnd:graphemeStart};}var smallerTextEnd=text.slice(start,end),graphemeEnd=fabric.util.string.graphemeSplit(smallerTextEnd).length;return{selectionStart:graphemeStart,selectionEnd:graphemeStart+graphemeEnd};},/**\n       * convert from fabric to textarea values\n       */fromGraphemeToStringSelection:function(start,end,_text){var smallerTextStart=_text.slice(0,start),graphemeStart=smallerTextStart.join(\"\").length;if(start===end){return{selectionStart:graphemeStart,selectionEnd:graphemeStart};}var smallerTextEnd=_text.slice(start,end),graphemeEnd=smallerTextEnd.join(\"\").length;return{selectionStart:graphemeStart,selectionEnd:graphemeStart+graphemeEnd};},/**\n       * @private\n       */_updateTextarea:function(){this.cursorOffsetCache={};if(!this.hiddenTextarea){return;}if(!this.inCompositionMode){var newSelection=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=newSelection.selectionStart;this.hiddenTextarea.selectionEnd=newSelection.selectionEnd;}this.updateTextareaPosition();},/**\n       * @private\n       */updateFromTextArea:function(){if(!this.hiddenTextarea){return;}this.cursorOffsetCache={};this.text=this.hiddenTextarea.value;if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords();}var newSelection=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=newSelection.selectionEnd;if(!this.inCompositionMode){this.selectionStart=newSelection.selectionStart;}this.updateTextareaPosition();},/**\n       * @private\n       */updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var style=this._calcTextareaPosition();this.hiddenTextarea.style.left=style.left;this.hiddenTextarea.style.top=style.top;}},/**\n       * @private\n       * @return {Object} style contains style for hiddenTextarea\n       */_calcTextareaPosition:function(){if(!this.canvas){return{x:1,y:1};}var desiredPosition=this.inCompositionMode?this.compositionStart:this.selectionStart,boundaries=this._getCursorBoundaries(desiredPosition),cursorLocation=this.get2DCursorLocation(desiredPosition),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex,charHeight=this.getValueOfPropertyAt(lineIndex,charIndex,\"fontSize\")*this.lineHeight,leftOffset=boundaries.leftOffset,m=this.calcTransformMatrix(),p={x:boundaries.left+leftOffset,y:boundaries.top+boundaries.topOffset+charHeight},retinaScaling=this.canvas.getRetinaScaling(),upperCanvas=this.canvas.upperCanvasEl,upperCanvasWidth=upperCanvas.width/retinaScaling,upperCanvasHeight=upperCanvas.height/retinaScaling,maxWidth=upperCanvasWidth-charHeight,maxHeight=upperCanvasHeight-charHeight,scaleX=upperCanvas.clientWidth/upperCanvasWidth,scaleY=upperCanvas.clientHeight/upperCanvasHeight;p=fabric.util.transformPoint(p,m);p=fabric.util.transformPoint(p,this.canvas.viewportTransform);p.x*=scaleX;p.y*=scaleY;if(p.x<0){p.x=0;}if(p.x>maxWidth){p.x=maxWidth;}if(p.y<0){p.y=0;}if(p.y>maxHeight){p.y=maxHeight;}// add canvas offset on document\np.x+=this.canvas._offset.left;p.y+=this.canvas._offset.top;return{left:p.x+\"px\",top:p.y+\"px\",fontSize:charHeight+\"px\",charHeight:charHeight};},/**\n       * @private\n       */_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor};},/**\n       * @private\n       */_restoreEditingProps:function(){if(!this._savedProps){return;}this.hoverCursor=this._savedProps.hoverCursor;this.hasControls=this._savedProps.hasControls;this.borderColor=this._savedProps.borderColor;this.selectable=this._savedProps.selectable;this.lockMovementX=this._savedProps.lockMovementX;this.lockMovementY=this._savedProps.lockMovementY;if(this.canvas){this.canvas.defaultCursor=this._savedProps.defaultCursor;this.canvas.moveCursor=this._savedProps.moveCursor;}},/**\n       * Exits from editing state\n       * @return {fabric.IText} thisArg\n       * @chainable\n       */exitEditing:function(){var isTextChanged=this._textBeforeEdit!==this.text;var hiddenTextarea=this.hiddenTextarea;this.selected=false;this.isEditing=false;this.selectionEnd=this.selectionStart;if(hiddenTextarea){hiddenTextarea.blur&&hiddenTextarea.blur();hiddenTextarea.parentNode&&hiddenTextarea.parentNode.removeChild(hiddenTextarea);}this.hiddenTextarea=null;this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords();}this.fire(\"editing:exited\");isTextChanged&&this.fire(\"modified\");if(this.canvas){this.canvas.off(\"mouse:move\",this.mouseMoveHandler);this.canvas.fire(\"text:editing:exited\",{target:this});isTextChanged&&this.canvas.fire(\"object:modified\",{target:this});}return this;},/**\n       * @private\n       */_removeExtraneousStyles:function(){for(var prop in this.styles){if(!this._textLines[prop]){delete this.styles[prop];}}},/**\n       * remove and reflow a style block from start to end.\n       * @param {Number} start linear start position for removal (included in removal)\n       * @param {Number} end linear end position for removal ( excluded from removal )\n       */removeStyleFromTo:function(start,end){var cursorStart=this.get2DCursorLocation(start,true),cursorEnd=this.get2DCursorLocation(end,true),lineStart=cursorStart.lineIndex,charStart=cursorStart.charIndex,lineEnd=cursorEnd.lineIndex,charEnd=cursorEnd.charIndex,i,styleObj;if(lineStart!==lineEnd){// step1 remove the trailing of lineStart\nif(this.styles[lineStart]){for(i=charStart;i<this._unwrappedTextLines[lineStart].length;i++){delete this.styles[lineStart][i];}}// step2 move the trailing of lineEnd to lineStart if needed\nif(this.styles[lineEnd]){for(i=charEnd;i<this._unwrappedTextLines[lineEnd].length;i++){styleObj=this.styles[lineEnd][i];if(styleObj){this.styles[lineStart]||(this.styles[lineStart]={});this.styles[lineStart][charStart+i-charEnd]=styleObj;}}}// step3 detects lines will be completely removed.\nfor(i=lineStart+1;i<=lineEnd;i++){delete this.styles[i];}// step4 shift remaining lines.\nthis.shiftLineStyles(lineEnd,lineStart-lineEnd);}else{// remove and shift left on the same line\nif(this.styles[lineStart]){styleObj=this.styles[lineStart];var diff=charEnd-charStart,numericChar,_char;for(i=charStart;i<charEnd;i++){delete styleObj[i];}for(_char in this.styles[lineStart]){numericChar=parseInt(_char,10);if(numericChar>=charEnd){styleObj[numericChar-diff]=styleObj[_char];delete styleObj[_char];}}}}},/**\n       * Shifts line styles up or down\n       * @param {Number} lineIndex Index of a line\n       * @param {Number} offset Can any number?\n       */shiftLineStyles:function(lineIndex,offset){// shift all line styles by offset upward or downward\n// do not clone deep. we need new array, not new style objects\nvar clonedStyles=clone(this.styles);for(var line in this.styles){var numericLine=parseInt(line,10);if(numericLine>lineIndex){this.styles[numericLine+offset]=clonedStyles[numericLine];if(!clonedStyles[numericLine-offset]){delete this.styles[numericLine];}}}},restartCursorIfNeeded:function(){if(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted){this.initDelayedCursor();}},/**\n       * Handle insertion of more consecutive style lines for when one or more\n       * newlines gets added to the text. Since current style needs to be shifted\n       * first we shift the current style of the number lines needed, then we add\n       * new lines from the last to the first.\n       * @param {Number} lineIndex Index of a line\n       * @param {Number} charIndex Index of a char\n       * @param {Number} qty number of lines to add\n       * @param {Array} copiedStyle Array of objects styles\n       */insertNewlineStyleObject:function(lineIndex,charIndex,qty,copiedStyle){var currentCharStyle,newLineStyles={},somethingAdded=false,isEndOfLine=this._unwrappedTextLines[lineIndex].length===charIndex;qty||(qty=1);this.shiftLineStyles(lineIndex,qty);if(this.styles[lineIndex]){currentCharStyle=this.styles[lineIndex][charIndex===0?charIndex:charIndex-1];}// we clone styles of all chars\n// after cursor onto the current line\nfor(var index in this.styles[lineIndex]){var numIndex=parseInt(index,10);if(numIndex>=charIndex){somethingAdded=true;newLineStyles[numIndex-charIndex]=this.styles[lineIndex][index];// remove lines from the previous line since they're on a new line now\nif(!(isEndOfLine&&charIndex===0)){delete this.styles[lineIndex][index];}}}var styleCarriedOver=false;if(somethingAdded&&!isEndOfLine){// if is end of line, the extra style we copied\n// is probably not something we want\nthis.styles[lineIndex+qty]=newLineStyles;styleCarriedOver=true;}if(styleCarriedOver){// skip the last line of since we already prepared it.\nqty--;}// for the all the lines or all the other lines\n// we clone current char style onto the next (otherwise empty) line\nwhile(qty>0){if(copiedStyle&&copiedStyle[qty-1]){this.styles[lineIndex+qty]={0:clone(copiedStyle[qty-1])};}else if(currentCharStyle){this.styles[lineIndex+qty]={0:clone(currentCharStyle)};}else{delete this.styles[lineIndex+qty];}qty--;}this._forceClearCache=true;},/**\n       * Inserts style object for a given line/char index\n       * @param {Number} lineIndex Index of a line\n       * @param {Number} charIndex Index of a char\n       * @param {Number} quantity number Style object to insert, if given\n       * @param {Array} copiedStyle array of style objects\n       */insertCharStyleObject:function(lineIndex,charIndex,quantity,copiedStyle){if(!this.styles){this.styles={};}var currentLineStyles=this.styles[lineIndex],currentLineStylesCloned=currentLineStyles?clone(currentLineStyles):{};quantity||(quantity=1);// shift all char styles by quantity forward\n// 0,1,2,3 -> (charIndex=2) -> 0,1,3,4 -> (insert 2) -> 0,1,2,3,4\nfor(var index in currentLineStylesCloned){var numericIndex=parseInt(index,10);if(numericIndex>=charIndex){currentLineStyles[numericIndex+quantity]=currentLineStylesCloned[numericIndex];// only delete the style if there was nothing moved there\nif(!currentLineStylesCloned[numericIndex-quantity]){delete currentLineStyles[numericIndex];}}}this._forceClearCache=true;if(copiedStyle){while(quantity--){if(!Object.keys(copiedStyle[quantity]).length){continue;}if(!this.styles[lineIndex]){this.styles[lineIndex]={};}this.styles[lineIndex][charIndex+quantity]=clone(copiedStyle[quantity]);}return;}if(!currentLineStyles){return;}var newStyle=currentLineStyles[charIndex?charIndex-1:1];while(newStyle&&quantity--){this.styles[lineIndex][charIndex+quantity]=clone(newStyle);}},/**\n       * Inserts style object(s)\n       * @param {Array} insertedText Characters at the location where style is inserted\n       * @param {Number} start cursor index for inserting style\n       * @param {Array} [copiedStyle] array of style objects to insert.\n       */insertNewStyleBlock:function(insertedText,start,copiedStyle){var cursorLoc=this.get2DCursorLocation(start,true),addedLines=[0],linesLength=0;// get an array of how many char per lines are being added.\nfor(var i=0;i<insertedText.length;i++){if(insertedText[i]===\"\\n\"){linesLength++;addedLines[linesLength]=0;}else{addedLines[linesLength]++;}}// for the first line copy the style from the current char position.\nif(addedLines[0]>0){this.insertCharStyleObject(cursorLoc.lineIndex,cursorLoc.charIndex,addedLines[0],copiedStyle);copiedStyle=copiedStyle&&copiedStyle.slice(addedLines[0]+1);}linesLength&&this.insertNewlineStyleObject(cursorLoc.lineIndex,cursorLoc.charIndex+addedLines[0],linesLength);for(var i=1;i<linesLength;i++){if(addedLines[i]>0){this.insertCharStyleObject(cursorLoc.lineIndex+i,0,addedLines[i],copiedStyle);}else if(copiedStyle){this.styles[cursorLoc.lineIndex+i][0]=copiedStyle[0];}copiedStyle=copiedStyle&&copiedStyle.slice(addedLines[i]+1);}// we use i outside the loop to get it like linesLength\nif(addedLines[i]>0){this.insertCharStyleObject(cursorLoc.lineIndex+i,0,addedLines[i],copiedStyle);}},/**\n       * Set the selectionStart and selectionEnd according to the new position of cursor\n       * mimic the key - mouse navigation when shift is pressed.\n       */setSelectionStartEndWithShift:function(start,end,newSelection){if(newSelection<=start){if(end===start){this._selectionDirection=\"left\";}else if(this._selectionDirection===\"right\"){this._selectionDirection=\"left\";this.selectionEnd=start;}this.selectionStart=newSelection;}else if(newSelection>start&&newSelection<end){if(this._selectionDirection===\"right\"){this.selectionEnd=newSelection;}else{this.selectionStart=newSelection;}}else{// newSelection is > selection start and end\nif(end===start){this._selectionDirection=\"right\";}else if(this._selectionDirection===\"left\"){this._selectionDirection=\"right\";this.selectionStart=end;}this.selectionEnd=newSelection;}},setSelectionInBoundaries:function(){var length=this.text.length;if(this.selectionStart>length){this.selectionStart=length;}else if(this.selectionStart<0){this.selectionStart=0;}if(this.selectionEnd>length){this.selectionEnd=length;}else if(this.selectionEnd<0){this.selectionEnd=0;}}});})();// adapted\nfabric.util.object.extend(fabric.IText.prototype,/** @lends fabric.IText.prototype */{/**\n     * Initializes \"dbclick\" event handler\n     * adapted AA\n     */initDoubleClickSimulation:function(){// for double click\nthis.__lastClickTime=+new Date();// for triple click\nthis.__lastLastClickTime=+new Date();this.__lastPointer={};this.on(\"mousedown\",this.onMouseDown);},/**\n     * Default event handler to simulate triple click\n     * @private\n     */onMouseDown:function(options){if(!this.canvas){return;}this.__newClickTime=+new Date();var newPointer=options.pointer;if(this.isTripleClick(newPointer)){this.fire(\"tripleclick\",options);this._stopEvent(options.e);}this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=newPointer;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected;},isTripleClick:function(newPointer){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===newPointer.x&&this.__lastPointer.y===newPointer.y;},/**\n     * @private\n     */_stopEvent:function(e){e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();},/**\n     * Initializes event handlers related to cursor or selection\n     */initCursorSelectionHandlers:function(){this.initMousedownHandler();this.initMouseupHandler();this.initClicks();},/**\n     * Default handler for double click, select a word\n     */doubleClickHandler:function(options){if(!this.isEditing){return;}this.selectWord(this.getSelectionStartFromPointer(options.e));},/**\n     * Default handler for triple click, select a line\n     */tripleClickHandler:function(options){if(!this.isEditing){return;}this.selectLine(this.getSelectionStartFromPointer(options.e));},/**\n     * Initializes double and triple click event handlers\n     */initClicks:function(){this.on(\"mousedblclick\",this.doubleClickHandler);this.on(\"tripleclick\",this.tripleClickHandler);},/**\n     * Default event handler for the basic functionalities needed on _mouseDown\n     * can be overridden to do something different.\n     * Scope of this implementation is: find the click position, set selectionStart\n     * find selectionEnd, initialize the drawing of either cursor or selection area\n     * initializing a mousedDown on a text area will cancel fabricjs knowledge of\n     * current compositionMode. It will be set to false.\n     */_mouseDownHandler:function(options){if(!this.canvas||!this.editable||options.e.button&&options.e.button!==1){return;}this.__isMousedown=true;if(this.selected){this.inCompositionMode=false;this.setCursorByClick(options.e);}if(this.isEditing){this.__selectionStartOnMouseDown=this.selectionStart;if(this.selectionStart===this.selectionEnd){this.abortCursorAnimation();}this.renderCursorOrSelection();}},/**\n     * Default event handler for the basic functionalities needed on mousedown:before\n     * can be overridden to do something different.\n     * Scope of this implementation is: verify the object is already selected when mousing down\n     */_mouseDownHandlerBefore:function(options){if(!this.canvas||!this.editable||options.e.button&&options.e.button!==1){return;}// we want to avoid that an object that was selected and then becomes unselectable,\n// may trigger editing mode in some way.\nthis.selected=this===this.canvas._activeObject;},/**\n     * Initializes \"mousedown\" event handler\n     * adapted\n     * adapted AA\n     */initMousedownHandler:function(){this.on(\"mousedown\",this._mouseDownHandler);this.on(\"mousedown:before\",this._mouseDownHandlerBefore);},/**\n     * Initializes \"mouseup\" event handler\n     * adapted AA\n     */initMouseupHandler:function(){this.on(\"mouseup\",this.mouseUpHandler);},/**\n     * standard hander for mouse up, overridable\n     * @private\n     */mouseUpHandler:function(options){this.__isMousedown=false;if(!this.editable||this.group||options.transform&&options.transform.actionPerformed||options.e.button&&options.e.button!==1){return;}if(this.canvas){var currentActive=this.canvas._activeObject;if(currentActive&&currentActive!==this){// avoid running this logic when there is an active object\n// this because is possible with shift click and fast clicks,\n// to rapidly deselect and reselect this object and trigger an enterEdit\nreturn;}}if(this.__lastSelected&&!this.__corner){this.selected=false;this.__lastSelected=false;this.enterEditing(options.e);if(this.selectionStart===this.selectionEnd){this.initDelayedCursor(true);}else{this.renderCursorOrSelection();}}else{this.selected=true;}},/**\n     * Changes cursor location in a text depending on passed pointer (x/y) object\n     * @param {Event} e Event object\n     */setCursorByClick:function(e){var newSelection=this.getSelectionStartFromPointer(e),start=this.selectionStart,end=this.selectionEnd;if(e.shiftKey){this.setSelectionStartEndWithShift(start,end,newSelection);}else{this.selectionStart=newSelection;this.selectionEnd=newSelection;}if(this.isEditing){this._fireSelectionChanged();this._updateTextarea();}},/**\n     * Returns index of a character corresponding to where an object was clicked\n     * @param {Event} e Event object\n     * @return {Number} Index of a character\n     */getSelectionStartFromPointer:function(e){var mouseOffset=this.getLocalPointer(e),prevWidth=0,width=0,height=0,charIndex=0,lineIndex=0,lineLeftOffset,line;for(var i=0,len=this._textLines.length;i<len;i++){if(height<=mouseOffset.y){height+=this.getHeightOfLine(i)*this.scaleY;lineIndex=i;if(i>0){charIndex+=this._textLines[i-1].length+this.missingNewlineOffset(i-1);}}else{break;}}lineLeftOffset=this._getLineLeftOffset(lineIndex);width=lineLeftOffset*this.scaleX;line=this._textLines[lineIndex];for(var j=0,jlen=line.length;j<jlen;j++){prevWidth=width;// i removed something about flipX here, check.\nwidth+=this.__charBounds[lineIndex][j].kernedWidth*this.scaleX;if(width<=mouseOffset.x){charIndex++;}else{break;}}return this._getNewSelectionStartFromOffset(mouseOffset,prevWidth,width,charIndex,jlen);},/**\n     * @private\n     */_getNewSelectionStartFromOffset:function(mouseOffset,prevWidth,width,index,jlen){// we need Math.abs because when width is after the last char, the offset is given as 1, while is 0\nvar distanceBtwLastCharAndCursor=mouseOffset.x-prevWidth,distanceBtwNextCharAndCursor=width-mouseOffset.x,offset=distanceBtwNextCharAndCursor>distanceBtwLastCharAndCursor||distanceBtwNextCharAndCursor<0?0:1,newSelectionStart=index+offset;// if object is horizontally flipped, mirror cursor location from the end\nif(this.flipX){newSelectionStart=jlen-newSelectionStart;}if(newSelectionStart>this._text.length){newSelectionStart=this._text.length;}return newSelectionStart;}});fabric.util.object.extend(fabric.IText.prototype,/** @lends fabric.IText.prototype */{/**\n     * Initializes hidden textarea (needed to bring up keyboard in iOS)\n     */initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement(\"textarea\");this.hiddenTextarea.setAttribute(\"autocapitalize\",\"off\");this.hiddenTextarea.setAttribute(\"autocorrect\",\"off\");this.hiddenTextarea.setAttribute(\"autocomplete\",\"off\");this.hiddenTextarea.setAttribute(\"spellcheck\",\"false\");this.hiddenTextarea.setAttribute(\"data-fabric-hiddentextarea\",\"\");this.hiddenTextarea.setAttribute(\"wrap\",\"off\");var style=this._calcTextareaPosition();// line-height: 1px; was removed from the style to fix this:\n// https://bugs.chromium.org/p/chromium/issues/detail?id=870966\nthis.hiddenTextarea.style.cssText=\"position: absolute; top: \"+style.top+\"; left: \"+style.left+\"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px;\"+\" paddingｰtop: \"+style.fontSize+\";\";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,\"keydown\",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,\"keyup\",this.onKeyUp.bind(this));fabric.util.addListener(this.hiddenTextarea,\"input\",this.onInput.bind(this));fabric.util.addListener(this.hiddenTextarea,\"copy\",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,\"cut\",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,\"paste\",this.paste.bind(this));fabric.util.addListener(this.hiddenTextarea,\"compositionstart\",this.onCompositionStart.bind(this));fabric.util.addListener(this.hiddenTextarea,\"compositionupdate\",this.onCompositionUpdate.bind(this));fabric.util.addListener(this.hiddenTextarea,\"compositionend\",this.onCompositionEnd.bind(this));if(!this._clickHandlerInitialized&&this.canvas){fabric.util.addListener(this.canvas.upperCanvasEl,\"click\",this.onClick.bind(this));this._clickHandlerInitialized=true;}},/**\n     * For functionalities on keyDown\n     * Map a special key to a function of the instance/prototype\n     * If you need different behaviour for ESC or TAB or arrows, you have to change\n     * this map setting the name of a function that you build on the fabric.Itext or\n     * your prototype.\n     * the map change will affect all Instances unless you need for only some text Instances\n     * in that case you have to clone this object and assign your Instance.\n     * this.keysMap = fabric.util.object.clone(this.keysMap);\n     * The function must be in fabric.Itext.prototype.myFunction And will receive event as args[0]\n     */keysMap:{9:\"exitEditing\",27:\"exitEditing\",33:\"moveCursorUp\",34:\"moveCursorDown\",35:\"moveCursorRight\",36:\"moveCursorLeft\",37:\"moveCursorLeft\",38:\"moveCursorUp\",39:\"moveCursorRight\",40:\"moveCursorDown\"},/**\n     * For functionalities on keyUp + ctrl || cmd\n     */ctrlKeysMapUp:{67:\"copy\",88:\"cut\"},/**\n     * For functionalities on keyDown + ctrl || cmd\n     */ctrlKeysMapDown:{65:\"selectAll\"},onClick:function(){// No need to trigger click event here, focus is enough to have the keyboard appear on Android\nthis.hiddenTextarea&&this.hiddenTextarea.focus();},/**\n     * Handles keydown event\n     * only used for arrows and combination of modifier keys.\n     * @param {Event} e Event object\n     */onKeyDown:function(e){if(!this.isEditing){return;}if(e.keyCode in this.keysMap){this[this.keysMap[e.keyCode]](e);}else if(e.keyCode in this.ctrlKeysMapDown&&(e.ctrlKey||e.metaKey)){this[this.ctrlKeysMapDown[e.keyCode]](e);}else{return;}e.stopImmediatePropagation();e.preventDefault();if(e.keyCode>=33&&e.keyCode<=40){// if i press an arrow key just update selection\nthis.inCompositionMode=false;this.clearContextTop();this.renderCursorOrSelection();}else{this.canvas&&this.canvas.requestRenderAll();}},/**\n     * Handles keyup event\n     * We handle KeyUp because ie11 and edge have difficulties copy/pasting\n     * if a copy/cut event fired, keyup is dismissed\n     * @param {Event} e Event object\n     */onKeyUp:function(e){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=false;return;}if(e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey)){this[this.ctrlKeysMapUp[e.keyCode]](e);}else{return;}e.stopImmediatePropagation();e.preventDefault();this.canvas&&this.canvas.requestRenderAll();},/**\n     * Handles onInput event\n     * @param {Event} e Event object\n     */onInput:function(e){var fromPaste=this.fromPaste;this.fromPaste=false;e&&e.stopPropagation();if(!this.isEditing){return;}// decisions about style changes.\nvar nextText=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,charCount=this._text.length,nextCharCount=nextText.length,removedText,insertedText,charDiff=nextCharCount-charCount,selectionStart=this.selectionStart,selectionEnd=this.selectionEnd,selection=selectionStart!==selectionEnd,copiedStyle,removeFrom,removeTo;if(this.hiddenTextarea.value===\"\"){this.styles={};this.updateFromTextArea();this.fire(\"changed\");if(this.canvas){this.canvas.fire(\"text:changed\",{target:this});this.canvas.requestRenderAll();}return;}var textareaSelection=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);var backDelete=selectionStart>textareaSelection.selectionStart;if(selection){removedText=this._text.slice(selectionStart,selectionEnd);charDiff+=selectionEnd-selectionStart;}else if(nextCharCount<charCount){if(backDelete){removedText=this._text.slice(selectionEnd+charDiff,selectionEnd);}else{removedText=this._text.slice(selectionStart,selectionStart-charDiff);}}insertedText=nextText.slice(textareaSelection.selectionEnd-charDiff,textareaSelection.selectionEnd);if(removedText&&removedText.length){if(insertedText.length){// let's copy some style before deleting.\n// we want to copy the style before the cursor OR the style at the cursor if selection\n// is bigger than 0.\ncopiedStyle=this.getSelectionStyles(selectionStart,selectionStart+1,false);// now duplicate the style one for each inserted text.\ncopiedStyle=insertedText.map(function(){// this return an array of references, but that is fine since we are\n// copying the style later.\nreturn copiedStyle[0];});}if(selection){removeFrom=selectionStart;removeTo=selectionEnd;}else if(backDelete){// detect differencies between forwardDelete and backDelete\nremoveFrom=selectionEnd-removedText.length;removeTo=selectionEnd;}else{removeFrom=selectionEnd;removeTo=selectionEnd+removedText.length;}this.removeStyleFromTo(removeFrom,removeTo);}if(insertedText.length){if(fromPaste&&insertedText.join(\"\")===fabric.copiedText&&!fabric.disableStyleCopyPaste){copiedStyle=fabric.copiedTextStyle;}this.insertNewStyleBlock(insertedText,selectionStart,copiedStyle);}this.updateFromTextArea();this.fire(\"changed\");if(this.canvas){this.canvas.fire(\"text:changed\",{target:this});this.canvas.requestRenderAll();}},/**\n     * Composition start\n     */onCompositionStart:function(){this.inCompositionMode=true;},/**\n     * Composition end\n     */onCompositionEnd:function(){this.inCompositionMode=false;},// /**\n//  * Composition update\n//  */\nonCompositionUpdate:function(e){this.compositionStart=e.target.selectionStart;this.compositionEnd=e.target.selectionEnd;this.updateTextareaPosition();},/**\n     * Copies selected text\n     * @param {Event} e Event object\n     */copy:function(){if(this.selectionStart===this.selectionEnd){//do not cut-copy if no selection\nreturn;}fabric.copiedText=this.getSelectedText();if(!fabric.disableStyleCopyPaste){fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,true);}else{fabric.copiedTextStyle=null;}this._copyDone=true;},/**\n     * Pastes text\n     * @param {Event} e Event object\n     */paste:function(){this.fromPaste=true;},/**\n     * @private\n     * @param {Event} e Event object\n     * @return {Object} Clipboard data object\n     */_getClipboardData:function(e){return e&&e.clipboardData||fabric.window.clipboardData;},/**\n     * Finds the width in pixels before the cursor on the same line\n     * @private\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @return {Number} widthBeforeCursor width before cursor\n     */_getWidthBeforeCursor:function(lineIndex,charIndex){var widthBeforeCursor=this._getLineLeftOffset(lineIndex),bound;if(charIndex>0){bound=this.__charBounds[lineIndex][charIndex-1];widthBeforeCursor+=bound.left+bound.width;}return widthBeforeCursor;},/**\n     * Gets start offset of a selection\n     * @param {Event} e Event object\n     * @param {Boolean} isRight\n     * @return {Number}\n     */getDownCursorOffset:function(e,isRight){var selectionProp=this._getSelectionForOffset(e,isRight),cursorLocation=this.get2DCursorLocation(selectionProp),lineIndex=cursorLocation.lineIndex;// if on last line, down cursor goes to end of line\nif(lineIndex===this._textLines.length-1||e.metaKey||e.keyCode===34){// move to the end of a text\nreturn this._text.length-selectionProp;}var charIndex=cursorLocation.charIndex,widthBeforeCursor=this._getWidthBeforeCursor(lineIndex,charIndex),indexOnOtherLine=this._getIndexOnLine(lineIndex+1,widthBeforeCursor),textAfterCursor=this._textLines[lineIndex].slice(charIndex);return textAfterCursor.length+indexOnOtherLine+1+this.missingNewlineOffset(lineIndex);},/**\n     * private\n     * Helps finding if the offset should be counted from Start or End\n     * @param {Event} e Event object\n     * @param {Boolean} isRight\n     * @return {Number}\n     */_getSelectionForOffset:function(e,isRight){if(e.shiftKey&&this.selectionStart!==this.selectionEnd&&isRight){return this.selectionEnd;}else{return this.selectionStart;}},/**\n     * @param {Event} e Event object\n     * @param {Boolean} isRight\n     * @return {Number}\n     */getUpCursorOffset:function(e,isRight){var selectionProp=this._getSelectionForOffset(e,isRight),cursorLocation=this.get2DCursorLocation(selectionProp),lineIndex=cursorLocation.lineIndex;if(lineIndex===0||e.metaKey||e.keyCode===33){// if on first line, up cursor goes to start of line\nreturn-selectionProp;}var charIndex=cursorLocation.charIndex,widthBeforeCursor=this._getWidthBeforeCursor(lineIndex,charIndex),indexOnOtherLine=this._getIndexOnLine(lineIndex-1,widthBeforeCursor),textBeforeCursor=this._textLines[lineIndex].slice(0,charIndex),missingNewlineOffset=this.missingNewlineOffset(lineIndex-1);// return a negative offset\nreturn-this._textLines[lineIndex-1].length+indexOnOtherLine-textBeforeCursor.length+(1-missingNewlineOffset);},/**\n     * for a given width it founds the matching character.\n     * @private\n     */_getIndexOnLine:function(lineIndex,width){var line=this._textLines[lineIndex],lineLeftOffset=this._getLineLeftOffset(lineIndex),widthOfCharsOnLine=lineLeftOffset,indexOnLine=0,charWidth,foundMatch;for(var j=0,jlen=line.length;j<jlen;j++){charWidth=this.__charBounds[lineIndex][j].width;widthOfCharsOnLine+=charWidth;if(widthOfCharsOnLine>width){foundMatch=true;var leftEdge=widthOfCharsOnLine-charWidth,rightEdge=widthOfCharsOnLine,offsetFromLeftEdge=Math.abs(leftEdge-width),offsetFromRightEdge=Math.abs(rightEdge-width);indexOnLine=offsetFromRightEdge<offsetFromLeftEdge?j:j-1;break;}}// reached end\nif(!foundMatch){indexOnLine=line.length-1;}return indexOnLine;},/**\n     * Moves cursor down\n     * @param {Event} e Event object\n     */moveCursorDown:function(e){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length){return;}this._moveCursorUpOrDown(\"Down\",e);},/**\n     * Moves cursor up\n     * @param {Event} e Event object\n     */moveCursorUp:function(e){if(this.selectionStart===0&&this.selectionEnd===0){return;}this._moveCursorUpOrDown(\"Up\",e);},/**\n     * Moves cursor up or down, fires the events\n     * @param {String} direction 'Up' or 'Down'\n     * @param {Event} e Event object\n     */_moveCursorUpOrDown:function(direction,e){// getUpCursorOffset\n// getDownCursorOffset\nvar action=\"get\"+direction+\"CursorOffset\",offset=this[action](e,this._selectionDirection===\"right\");if(e.shiftKey){this.moveCursorWithShift(offset);}else{this.moveCursorWithoutShift(offset);}if(offset!==0){this.setSelectionInBoundaries();this.abortCursorAnimation();this._currentCursorOpacity=1;this.initDelayedCursor();this._fireSelectionChanged();this._updateTextarea();}},/**\n     * Moves cursor with shift\n     * @param {Number} offset\n     */moveCursorWithShift:function(offset){var newSelection=this._selectionDirection===\"left\"?this.selectionStart+offset:this.selectionEnd+offset;this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,newSelection);return offset!==0;},/**\n     * Moves cursor up without shift\n     * @param {Number} offset\n     */moveCursorWithoutShift:function(offset){if(offset<0){this.selectionStart+=offset;this.selectionEnd=this.selectionStart;}else{this.selectionEnd+=offset;this.selectionStart=this.selectionEnd;}return offset!==0;},/**\n     * Moves cursor left\n     * @param {Event} e Event object\n     */moveCursorLeft:function(e){if(this.selectionStart===0&&this.selectionEnd===0){return;}this._moveCursorLeftOrRight(\"Left\",e);},/**\n     * @private\n     * @return {Boolean} true if a change happened\n     */_move:function(e,prop,direction){var newValue;if(e.altKey){newValue=this[\"findWordBoundary\"+direction](this[prop]);}else if(e.metaKey||e.keyCode===35||e.keyCode===36){newValue=this[\"findLineBoundary\"+direction](this[prop]);}else{this[prop]+=direction===\"Left\"?-1:1;return true;}if(typeof newValue!==undefined&&this[prop]!==newValue){this[prop]=newValue;return true;}},/**\n     * @private\n     */_moveLeft:function(e,prop){return this._move(e,prop,\"Left\");},/**\n     * @private\n     */_moveRight:function(e,prop){return this._move(e,prop,\"Right\");},/**\n     * Moves cursor left without keeping selection\n     * @param {Event} e\n     */moveCursorLeftWithoutShift:function(e){var change=true;this._selectionDirection=\"left\";// only move cursor when there is no selection,\n// otherwise we discard it, and leave cursor on same place\nif(this.selectionEnd===this.selectionStart&&this.selectionStart!==0){change=this._moveLeft(e,\"selectionStart\");}this.selectionEnd=this.selectionStart;return change;},/**\n     * Moves cursor left while keeping selection\n     * @param {Event} e\n     */moveCursorLeftWithShift:function(e){if(this._selectionDirection===\"right\"&&this.selectionStart!==this.selectionEnd){return this._moveLeft(e,\"selectionEnd\");}else if(this.selectionStart!==0){this._selectionDirection=\"left\";return this._moveLeft(e,\"selectionStart\");}},/**\n     * Moves cursor right\n     * @param {Event} e Event object\n     */moveCursorRight:function(e){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length){return;}this._moveCursorLeftOrRight(\"Right\",e);},/**\n     * Moves cursor right or Left, fires event\n     * @param {String} direction 'Left', 'Right'\n     * @param {Event} e Event object\n     */_moveCursorLeftOrRight:function(direction,e){var actionName=\"moveCursor\"+direction+\"With\";this._currentCursorOpacity=1;if(e.shiftKey){actionName+=\"Shift\";}else{actionName+=\"outShift\";}if(this[actionName](e)){this.abortCursorAnimation();this.initDelayedCursor();this._fireSelectionChanged();this._updateTextarea();}},/**\n     * Moves cursor right while keeping selection\n     * @param {Event} e\n     */moveCursorRightWithShift:function(e){if(this._selectionDirection===\"left\"&&this.selectionStart!==this.selectionEnd){return this._moveRight(e,\"selectionStart\");}else if(this.selectionEnd!==this._text.length){this._selectionDirection=\"right\";return this._moveRight(e,\"selectionEnd\");}},/**\n     * Moves cursor right without keeping selection\n     * @param {Event} e Event object\n     */moveCursorRightWithoutShift:function(e){var changed=true;this._selectionDirection=\"right\";if(this.selectionStart===this.selectionEnd){changed=this._moveRight(e,\"selectionStart\");this.selectionEnd=this.selectionStart;}else{this.selectionStart=this.selectionEnd;}return changed;},/**\n     * Removes characters from start/end\n     * start/end ar per grapheme position in _text array.\n     *\n     * @param {Number} start\n     * @param {Number} end default to start + 1\n     */removeChars:function(start,end){if(typeof end===\"undefined\"){end=start+1;}this.removeStyleFromTo(start,end);this._text.splice(start,end-start);this.text=this._text.join(\"\");this.set(\"dirty\",true);if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords();}this._removeExtraneousStyles();},/**\n     * insert characters at start position, before start position.\n     * start  equal 1 it means the text get inserted between actual grapheme 0 and 1\n     * if style array is provided, it must be as the same length of text in graphemes\n     * if end is provided and is bigger than start, old text is replaced.\n     * start/end ar per grapheme position in _text array.\n     *\n     * @param {String} text text to insert\n     * @param {Array} style array of style objects\n     * @param {Number} start\n     * @param {Number} end default to start + 1\n     */insertChars:function(text,style,start,end){if(typeof end===\"undefined\"){end=start;}if(end>start){this.removeStyleFromTo(start,end);}var graphemes=fabric.util.string.graphemeSplit(text);this.insertNewStyleBlock(graphemes,start,style);this._text=[].concat(this._text.slice(0,start),graphemes,this._text.slice(end));this.text=this._text.join(\"\");this.set(\"dirty\",true);if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords();}this._removeExtraneousStyles();}});/* _TO_SVG_START_ */(function(){var toFixed=fabric.util.toFixed,multipleSpacesRegex=/  +/g;fabric.util.object.extend(fabric.Text.prototype,/** @lends fabric.Text.prototype */{/**\n       * Returns SVG representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */_toSVG:function(){var offsets=this._getSVGLeftTopOffsets(),textAndBg=this._getSVGTextAndBg(offsets.textTop,offsets.textLeft);return this._wrapSVGTextAndBg(textAndBg);},/**\n       * Returns svg representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */toSVG:function(reviver){return this._createBaseSVGMarkup(this._toSVG(),{reviver:reviver,noStyle:true,withShadow:true});},/**\n       * @private\n       */_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)};},/**\n       * @private\n       */_wrapSVGTextAndBg:function(textAndBg){var noShadow=true,textDecoration=this.getSvgTextDecoration(this);return[textAndBg.textBgRects.join(\"\"),'\\t\\t<text xml:space=\"preserve\" ',this.fontFamily?'font-family=\"'+this.fontFamily.replace(/\"/g,\"'\")+'\" ':\"\",this.fontSize?'font-size=\"'+this.fontSize+'\" ':\"\",this.fontStyle?'font-style=\"'+this.fontStyle+'\" ':\"\",this.fontWeight?'font-weight=\"'+this.fontWeight+'\" ':\"\",textDecoration?'text-decoration=\"'+textDecoration+'\" ':\"\",'style=\"',this.getSvgStyles(noShadow),'\"',this.addPaintOrder(),\" >\",textAndBg.textSpans.join(\"\"),\"</text>\\n\"];},/**\n       * @private\n       * @param {Number} textTopOffset Text top offset\n       * @param {Number} textLeftOffset Text left offset\n       * @return {Object}\n       */_getSVGTextAndBg:function(textTopOffset,textLeftOffset){var textSpans=[],textBgRects=[],height=textTopOffset,lineOffset;// bounding-box background\nthis._setSVGBg(textBgRects);// text and text-background\nfor(var i=0,len=this._textLines.length;i<len;i++){lineOffset=this._getLineLeftOffset(i);if(this.textBackgroundColor||this.styleHas(\"textBackgroundColor\",i)){this._setSVGTextLineBg(textBgRects,i,textLeftOffset+lineOffset,height);}this._setSVGTextLineText(textSpans,i,textLeftOffset+lineOffset,height);height+=this.getHeightOfLine(i);}return{textSpans:textSpans,textBgRects:textBgRects};},/**\n       * @private\n       */_createTextCharSpan:function(_char,styleDecl,left,top){var shouldUseWhitespace=_char!==_char.trim()||_char.match(multipleSpacesRegex),styleProps=this.getSvgSpanStyles(styleDecl,shouldUseWhitespace),fillStyles=styleProps?'style=\"'+styleProps+'\"':\"\",dy=styleDecl.deltaY,dySpan=\"\",NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;if(dy){dySpan=' dy=\"'+toFixed(dy,NUM_FRACTION_DIGITS)+'\" ';}return['<tspan x=\"',toFixed(left,NUM_FRACTION_DIGITS),'\" y=\"',toFixed(top,NUM_FRACTION_DIGITS),'\" ',dySpan,fillStyles,\">\",fabric.util.string.escapeXml(_char),\"</tspan>\"].join(\"\");},_setSVGTextLineText:function(textSpans,lineIndex,textLeftOffset,textTopOffset){// set proper line offset\nvar lineHeight=this.getHeightOfLine(lineIndex),isJustify=this.textAlign.indexOf(\"justify\")!==-1,actualStyle,nextStyle,charsToRender=\"\",charBox,style,boxWidth=0,line=this._textLines[lineIndex],timeToRender;textTopOffset+=lineHeight*(1-this._fontSizeFraction)/this.lineHeight;for(var i=0,len=line.length-1;i<=len;i++){timeToRender=i===len||this.charSpacing;charsToRender+=line[i];charBox=this.__charBounds[lineIndex][i];if(boxWidth===0){textLeftOffset+=charBox.kernedWidth-charBox.width;boxWidth+=charBox.width;}else{boxWidth+=charBox.kernedWidth;}if(isJustify&&!timeToRender){if(this._reSpaceAndTab.test(line[i])){timeToRender=true;}}if(!timeToRender){// if we have charSpacing, we render char by char\nactualStyle=actualStyle||this.getCompleteStyleDeclaration(lineIndex,i);nextStyle=this.getCompleteStyleDeclaration(lineIndex,i+1);timeToRender=this._hasStyleChangedForSvg(actualStyle,nextStyle);}if(timeToRender){style=this._getStyleDeclaration(lineIndex,i)||{};textSpans.push(this._createTextCharSpan(charsToRender,style,textLeftOffset,textTopOffset));charsToRender=\"\";actualStyle=nextStyle;textLeftOffset+=boxWidth;boxWidth=0;}}},_pushTextBgRect:function(textBgRects,color,left,top,width,height){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;textBgRects.push(\"\\t\\t<rect \",this._getFillAttributes(color),' x=\"',toFixed(left,NUM_FRACTION_DIGITS),'\" y=\"',toFixed(top,NUM_FRACTION_DIGITS),'\" width=\"',toFixed(width,NUM_FRACTION_DIGITS),'\" height=\"',toFixed(height,NUM_FRACTION_DIGITS),'\"></rect>\\n');},_setSVGTextLineBg:function(textBgRects,i,leftOffset,textTopOffset){var line=this._textLines[i],heightOfLine=this.getHeightOfLine(i)/this.lineHeight,boxWidth=0,boxStart=0,charBox,currentColor,lastColor=this.getValueOfPropertyAt(i,0,\"textBackgroundColor\");for(var j=0,jlen=line.length;j<jlen;j++){charBox=this.__charBounds[i][j];currentColor=this.getValueOfPropertyAt(i,j,\"textBackgroundColor\");if(currentColor!==lastColor){lastColor&&this._pushTextBgRect(textBgRects,lastColor,leftOffset+boxStart,textTopOffset,boxWidth,heightOfLine);boxStart=charBox.left;boxWidth=charBox.width;lastColor=currentColor;}else{boxWidth+=charBox.kernedWidth;}}currentColor&&this._pushTextBgRect(textBgRects,currentColor,leftOffset+boxStart,textTopOffset,boxWidth,heightOfLine);},/**\n       * Adobe Illustrator (at least CS5) is unable to render rgba()-based fill values\n       * we work around it by \"moving\" alpha channel into opacity attribute and setting fill's alpha to 1\n       *\n       * @private\n       * @param {*} value\n       * @return {String}\n       */_getFillAttributes:function(value){var fillColor=value&&typeof value===\"string\"?new fabric.Color(value):\"\";if(!fillColor||!fillColor.getSource()||fillColor.getAlpha()===1){return'fill=\"'+value+'\"';}return'opacity=\"'+fillColor.getAlpha()+'\" fill=\"'+fillColor.setAlpha(1).toRgb()+'\"';},/**\n       * @private\n       */_getSVGLineTopOffset:function(lineIndex){var lineTopOffset=0,lastHeight=0;for(var j=0;j<lineIndex;j++){lineTopOffset+=this.getHeightOfLine(j);}lastHeight=this.getHeightOfLine(j);return{lineTop:lineTopOffset,offset:(this._fontSizeMult-this._fontSizeFraction)*lastHeight/(this.lineHeight*this._fontSizeMult)};},/**\n       * Returns styles-string for svg-export\n       * @param {Boolean} skipShadow a boolean to skip shadow filter output\n       * @return {String}\n       */getSvgStyles:function(skipShadow){var svgStyle=fabric.Object.prototype.getSvgStyles.call(this,skipShadow);return svgStyle+\" white-space: pre;\";}});})();/* _TO_SVG_END_ */(function(global){\"use strict\";var fabric=global.fabric||(global.fabric={});/**\n   * Textbox class, based on IText, allows the user to resize the text rectangle\n   * and wraps lines automatically. Textboxes have their Y scaling locked, the\n   * user can only change width. Height is adjusted automatically based on the\n   * wrapping of lines.\n   * @class fabric.Textbox\n   * @extends fabric.IText\n   * @mixes fabric.Observable\n   * @return {fabric.Textbox} thisArg\n   * @see {@link fabric.Textbox#initialize} for constructor definition\n   */fabric.Textbox=fabric.util.createClass(fabric.IText,fabric.Observable,{/**\n     * Type of an object\n     * @type String\n     * @default\n     */type:\"textbox\",/**\n     * Minimum width of textbox, in pixels.\n     * @type Number\n     * @default\n     */minWidth:20,/**\n     * Minimum calculated width of a textbox, in pixels.\n     * fixed to 2 so that an empty textbox cannot go to 0\n     * and is still selectable without text.\n     * @type Number\n     * @default\n     */dynamicMinWidth:2,/**\n     * Cached array of text wrapping.\n     * @type Array\n     */__cachedLines:null,/**\n     * Override standard Object class values\n     */lockScalingFlip:true,/**\n     * Override standard Object class values\n     * Textbox needs this on false\n     */noScaleCache:false,/**\n     * Properties which when set cause object to change dimensions\n     * @type Object\n     * @private\n     */_dimensionAffectingProps:fabric.Text.prototype._dimensionAffectingProps.concat(\"width\"),/**\n     * Use this regular expression to split strings in breakable lines\n     * @private\n     */_wordJoiners:/[ \\t\\r]/,/**\n     * Use this boolean property in order to split strings that have no white space concept.\n     * this is a cheap way to help with chinese/japaense\n     * @type Boolean\n     * @since 2.6.0\n     */splitByGrapheme:false,/**\n     * Unlike superclass's version of this function, Textbox does not update\n     * its width.\n     * @private\n     * @override\n     */initDimensions:function(){if(this.__skipDimension){return;}this.isEditing&&this.initDelayedCursor();this.clearContextTop();this._clearCache();// clear dynamicMinWidth as it will be different after we re-wrap line\nthis.dynamicMinWidth=0;// wrap lines\nthis._styleMap=this._generateStyleMap(this._splitText());// if after wrapping, the width is smaller than dynamicMinWidth, change the width and re-wrap\nif(this.dynamicMinWidth>this.width){this._set(\"width\",this.dynamicMinWidth);}if(this.textAlign.indexOf(\"justify\")!==-1){// once text is measured we need to make space fatter to make justified text.\nthis.enlargeSpaces();}// clear cache and re-calculate height\nthis.height=this.calcTextHeight();this.saveState({propertySet:\"_dimensionAffectingProps\"});},/**\n     * Generate an object that translates the style object so that it is\n     * broken up by visual lines (new lines and automatic wrapping).\n     * The original text styles object is broken up by actual lines (new lines only),\n     * which is only sufficient for Text / IText\n     * @private\n     */_generateStyleMap:function(textInfo){var realLineCount=0,realLineCharCount=0,charCount=0,map={};for(var i=0;i<textInfo.graphemeLines.length;i++){if(textInfo.graphemeText[charCount]===\"\\n\"&&i>0){realLineCharCount=0;charCount++;realLineCount++;}else if(!this.splitByGrapheme&&this._reSpaceAndTab.test(textInfo.graphemeText[charCount])&&i>0){// this case deals with space's that are removed from end of lines when wrapping\nrealLineCharCount++;charCount++;}map[i]={line:realLineCount,offset:realLineCharCount};charCount+=textInfo.graphemeLines[i].length;realLineCharCount+=textInfo.graphemeLines[i].length;}return map;},/**\n     * Returns true if object has a style property or has it on a specified line\n     * @param {Number} lineIndex\n     * @return {Boolean}\n     */styleHas:function(property,lineIndex){if(this._styleMap&&!this.isWrapping){var map=this._styleMap[lineIndex];if(map){lineIndex=map.line;}}return fabric.Text.prototype.styleHas.call(this,property,lineIndex);},/**\n     * Returns true if object has no styling or no styling in a line\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\n     * @return {Boolean}\n     */isEmptyStyles:function(lineIndex){if(!this.styles){return true;}var offset=0,nextLineIndex=lineIndex+1,nextOffset,obj,shouldLimit=false,map=this._styleMap[lineIndex],mapNextLine=this._styleMap[lineIndex+1];if(map){lineIndex=map.line;offset=map.offset;}if(mapNextLine){nextLineIndex=mapNextLine.line;shouldLimit=nextLineIndex===lineIndex;nextOffset=mapNextLine.offset;}obj=typeof lineIndex===\"undefined\"?this.styles:{line:this.styles[lineIndex]};for(var p1 in obj){for(var p2 in obj[p1]){if(p2>=offset&&(!shouldLimit||p2<nextOffset)){// eslint-disable-next-line no-unused-vars\nfor(var p3 in obj[p1][p2]){return false;}}}}return true;},/**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */_getStyleDeclaration:function(lineIndex,charIndex){if(this._styleMap&&!this.isWrapping){var map=this._styleMap[lineIndex];if(!map){return null;}lineIndex=map.line;charIndex=map.offset+charIndex;}return this.callSuper(\"_getStyleDeclaration\",lineIndex,charIndex);},/**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */_setStyleDeclaration:function(lineIndex,charIndex,style){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;this.styles[lineIndex][charIndex]=style;},/**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */_deleteStyleDeclaration:function(lineIndex,charIndex){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;delete this.styles[lineIndex][charIndex];},/**\n     * probably broken need a fix\n     * Returns the real style line that correspond to the wrapped lineIndex line\n     * Used just to verify if the line does exist or not.\n     * @param {Number} lineIndex\n     * @returns {Boolean} if the line exists or not\n     * @private\n     */_getLineStyle:function(lineIndex){var map=this._styleMap[lineIndex];return!!this.styles[map.line];},/**\n     * Set the line style to an empty object so that is initialized\n     * @param {Number} lineIndex\n     * @param {Object} style\n     * @private\n     */_setLineStyle:function(lineIndex){var map=this._styleMap[lineIndex];this.styles[map.line]={};},/**\n     * Wraps text using the 'width' property of Textbox. First this function\n     * splits text on newlines, so we preserve newlines entered by the user.\n     * Then it wraps each line using the width of the Textbox by calling\n     * _wrapLine().\n     * @param {Array} lines The string array of text that is split into lines\n     * @param {Number} desiredWidth width you want to wrap to\n     * @returns {Array} Array of lines\n     */_wrapText:function(lines,desiredWidth){var wrapped=[],i;this.isWrapping=true;for(i=0;i<lines.length;i++){wrapped=wrapped.concat(this._wrapLine(lines[i],i,desiredWidth));}this.isWrapping=false;return wrapped;},/**\n     * Helper function to measure a string of text, given its lineIndex and charIndex offset\n     * it gets called when charBounds are not available yet.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {String} text\n     * @param {number} lineIndex\n     * @param {number} charOffset\n     * @returns {number}\n     * @private\n     */_measureWord:function(word,lineIndex,charOffset){var width=0,prevGrapheme,skipLeft=true;charOffset=charOffset||0;for(var i=0,len=word.length;i<len;i++){var box=this._getGraphemeBox(word[i],lineIndex,i+charOffset,prevGrapheme,skipLeft);width+=box.kernedWidth;prevGrapheme=word[i];}return width;},/**\n     * Wraps a line of text using the width of the Textbox and a context.\n     * @param {Array} line The grapheme array that represent the line\n     * @param {Number} lineIndex\n     * @param {Number} desiredWidth width you want to wrap the line to\n     * @param {Number} reservedSpace space to remove from wrapping for custom functionalities\n     * @returns {Array} Array of line(s) into which the given text is wrapped\n     * to.\n     */_wrapLine:function(_line,lineIndex,desiredWidth,reservedSpace){var lineWidth=0,splitByGrapheme=this.splitByGrapheme,graphemeLines=[],line=[],// spaces in different languges?\nwords=splitByGrapheme?fabric.util.string.graphemeSplit(_line):_line.split(this._wordJoiners),word=\"\",offset=0,infix=splitByGrapheme?\"\":\" \",wordWidth=0,infixWidth=0,largestWordWidth=0,lineJustStarted=true,additionalSpace=this._getWidthOfCharSpacing(),reservedSpace=reservedSpace||0;// fix a difference between split and graphemeSplit\nif(words.length===0){words.push([]);}desiredWidth-=reservedSpace;for(var i=0;i<words.length;i++){// if using splitByGrapheme words are already in graphemes.\nword=splitByGrapheme?words[i]:fabric.util.string.graphemeSplit(words[i]);wordWidth=this._measureWord(word,lineIndex,offset);offset+=word.length;lineWidth+=infixWidth+wordWidth-additionalSpace;if(lineWidth>=desiredWidth&&!lineJustStarted){graphemeLines.push(line);line=[];lineWidth=wordWidth;lineJustStarted=true;}else{lineWidth+=additionalSpace;}if(!lineJustStarted&&!splitByGrapheme){line.push(infix);}line=line.concat(word);infixWidth=splitByGrapheme?0:this._measureWord([infix],lineIndex,offset);offset++;lineJustStarted=false;// keep track of largest word\nif(wordWidth>largestWordWidth){largestWordWidth=wordWidth;}}i&&graphemeLines.push(line);if(largestWordWidth+reservedSpace>this.dynamicMinWidth){this.dynamicMinWidth=largestWordWidth-additionalSpace+reservedSpace;}return graphemeLines;},/**\n     * Detect if the text line is ended with an hard break\n     * text and itext do not have wrapping, return false\n     * @param {Number} lineIndex text to split\n     * @return {Boolean}\n     */isEndOfWrapping:function(lineIndex){if(!this._styleMap[lineIndex+1]){// is last line, return true;\nreturn true;}if(this._styleMap[lineIndex+1].line!==this._styleMap[lineIndex].line){// this is last line before a line break, return true;\nreturn true;}return false;},/**\n     * Detect if a line has a linebreak and so we need to account for it when moving\n     * and counting style.\n     * @return Number\n     */missingNewlineOffset:function(lineIndex){if(this.splitByGrapheme){return this.isEndOfWrapping(lineIndex)?1:0;}return 1;},/**\n     * Gets lines of text to render in the Textbox. This function calculates\n     * text wrapping on the fly every time it is called.\n     * @param {String} text text to split\n     * @returns {Array} Array of lines in the Textbox.\n     * @override\n     */_splitTextIntoLines:function(text){var newText=fabric.Text.prototype._splitTextIntoLines.call(this,text),graphemeLines=this._wrapText(newText.lines,this.width),lines=new Array(graphemeLines.length);for(var i=0;i<graphemeLines.length;i++){lines[i]=graphemeLines[i].join(\"\");}newText.lines=lines;newText.graphemeLines=graphemeLines;return newText;},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth);},_removeExtraneousStyles:function(){var linesToKeep={};for(var prop in this._styleMap){if(this._textLines[prop]){linesToKeep[this._styleMap[prop].line]=1;}}for(var prop in this.styles){if(!linesToKeep[prop]){delete this.styles[prop];}}},/**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */toObject:function(propertiesToInclude){return this.callSuper(\"toObject\",[\"minWidth\",\"splitByGrapheme\"].concat(propertiesToInclude));}});/**\n   * Returns fabric.Textbox instance from an object representation\n   * @static\n   * @memberOf fabric.Textbox\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Textbox instance is created\n   */fabric.Textbox.fromObject=function(object,callback){return fabric.Object._fromObject(\"Textbox\",object,callback,\"text\");};})(typeof exports!==\"undefined\"?exports:this);(function(){var controlsUtils=fabric.controlsUtils,scaleSkewStyleHandler=controlsUtils.scaleSkewCursorStyleHandler,scaleStyleHandler=controlsUtils.scaleCursorStyleHandler,scalingEqually=controlsUtils.scalingEqually,scalingYOrSkewingX=controlsUtils.scalingYOrSkewingX,scalingXOrSkewingY=controlsUtils.scalingXOrSkewingY,scaleOrSkewActionName=controlsUtils.scaleOrSkewActionName,objectControls=fabric.Object.prototype.controls;objectControls.ml=new fabric.Control({x:-0.5,y:0,cursorStyleHandler:scaleSkewStyleHandler,actionHandler:scalingXOrSkewingY,getActionName:scaleOrSkewActionName});objectControls.mr=new fabric.Control({x:0.5,y:0,cursorStyleHandler:scaleSkewStyleHandler,actionHandler:scalingXOrSkewingY,getActionName:scaleOrSkewActionName});objectControls.mb=new fabric.Control({x:0,y:0.5,cursorStyleHandler:scaleSkewStyleHandler,actionHandler:scalingYOrSkewingX,getActionName:scaleOrSkewActionName});objectControls.mt=new fabric.Control({x:0,y:-0.5,cursorStyleHandler:scaleSkewStyleHandler,actionHandler:scalingYOrSkewingX,getActionName:scaleOrSkewActionName});objectControls.tl=new fabric.Control({x:-0.5,y:-0.5,cursorStyleHandler:scaleStyleHandler,actionHandler:scalingEqually});objectControls.tr=new fabric.Control({x:0.5,y:-0.5,cursorStyleHandler:scaleStyleHandler,actionHandler:scalingEqually});objectControls.bl=new fabric.Control({x:-0.5,y:0.5,cursorStyleHandler:scaleStyleHandler,actionHandler:scalingEqually});objectControls.br=new fabric.Control({x:0.5,y:0.5,cursorStyleHandler:scaleStyleHandler,actionHandler:scalingEqually});objectControls.mtr=new fabric.Control({x:0,y:-0.5,actionHandler:controlsUtils.rotationWithSnapping,cursorStyleHandler:controlsUtils.rotationStyleHandler,offsetY:-40,withConnection:true,actionName:\"rotate\"});if(fabric.Textbox){// this is breaking the prototype inheritance, no time / ideas to fix it.\n// is important to document that if you want to have all objects to have a\n// specific custom control, you have to add it to Object prototype and to Textbox\n// prototype. The controls are shared as references. So changes to control `tr`\n// can still apply to all objects if needed.\nvar textBoxControls=fabric.Textbox.prototype.controls={};textBoxControls.mtr=objectControls.mtr;textBoxControls.tr=objectControls.tr;textBoxControls.br=objectControls.br;textBoxControls.tl=objectControls.tl;textBoxControls.bl=objectControls.bl;textBoxControls.mt=objectControls.mt;textBoxControls.mb=objectControls.mb;textBoxControls.mr=new fabric.Control({x:0.5,y:0,actionHandler:controlsUtils.changeWidth,cursorStyleHandler:scaleSkewStyleHandler,actionName:\"resizing\"});textBoxControls.ml=new fabric.Control({x:-0.5,y:0,actionHandler:controlsUtils.changeWidth,cursorStyleHandler:scaleSkewStyleHandler,actionName:\"resizing\"});}})();","map":{"version":3,"names":["fabric","version","exports","define","amd","document","window","HTMLDocument","Document","implementation","createHTMLDocument","jsdom","require","virtualWindow","JSDOM","decodeURIComponent","features","FetchExternalResources","resources","jsdomImplForWrapper","implForWrapper","nodeCanvas","Canvas","DOMParser","isTouchSupported","navigator","maxTouchPoints","isLikelyNode","Buffer","SHARED_ATTRIBUTES","DPI","reNum","rePathCommand","reNonWord","fontPaths","iMatrix","svgNS","perfLimitSizeTotal","maxCacheSideLimit","minCacheSideLimit","charWidthsCache","textureSize","disableStyleCopyPaste","enableGLFiltering","devicePixelRatio","webkitDevicePixelRatio","mozDevicePixelRatio","browserShadowBlurConstant","arcToSegmentsCache","boundsOfCurveCache","cachesBoundsOfCurve","forceGLPutImageData","initFilterBackend","isWebglSupported","console","log","maxTextureSize","WebglFilterBackend","tileSize","Canvas2dFilterBackend","_removeEventListener","eventName","handler","__eventListeners","eventListener","indexOf","util","array","fill","on","arguments","length","prop","push","off","call","fire","options","listenersForEvent","i","len","filter","value","Observable","Collection","_objects","add","apply","_onObjectAdded","renderOnAddRemove","requestRenderAll","insertAt","object","index","nonSplicing","objects","splice","remove","somethingRemoved","_onObjectRemoved","forEachObject","callback","context","getObjects","type","concat","o","item","isEmpty","size","contains","complexity","reduce","memo","current","CommonMethods","_setOptions","set","_initGradient","filler","property","colorStops","Gradient","_initPattern","source","Pattern","_setObject","obj","_set","key","toggle","get","global","sqrt","Math","atan2","pow","PiBy180","PI","PiBy2","cos","angle","angleSlice","sin","sign","removeFromArray","idx","getRandomInt","min","max","floor","random","degreesToRadians","degrees","radiansToDegrees","radians","rotatePoint","point","origin","subtractEquals","v","rotateVector","Point","x","y","addEquals","vector","rx","ry","transformPoint","p","t","ignoreOffset","makeBoundingBoxFromPoints","points","transform","xPoints","minX","maxX","width","yPoints","minY","maxY","height","left","top","invertTransform","a","r","toFixed","number","fractionDigits","parseFloat","Number","parseUnit","fontSize","unit","exec","Text","DEFAULT_SVG_FONT_SIZE","falseFunction","getKlass","namespace","string","camelize","charAt","toUpperCase","slice","resolveNamespace","getSvgAttributes","attributes","parts","split","loadImage","url","crossOrigin","img","createImage","onLoadCallback","onload","onerror","src","undefined","substring","loadImageInDom","div","createElement","style","position","appendChild","querySelector","parentNode","removeChild","enlivenObjects","reviver","enlivenedObjects","numLoadedObjects","numTotalObjects","onLoaded","forEach","klass","fromObject","error","enlivenPatterns","patterns","numLoadedPatterns","numPatterns","enlivenedPatterns","pattern","groupSVGElements","elements","path","centerPoint","Group","sourcePath","populateWithProperties","destination","properties","Object","prototype","toString","drawDashedLine","ctx","x2","y2","da","dx","dy","rot","dc","di","draw","save","translate","moveTo","rotate","restore","createCanvasElement","copyCanvasElement","canvas","newCanvas","getContext","drawImage","toDataURL","canvasEl","format","quality","multiplyTransformMatrices","b","is2x2","qrDecompose","denom","scaleX","scaleY","skewX","skewY","translateX","translateY","calcRotateMatrix","theta","calcDimensionsMatrix","scaleMatrix","flipX","flipY","multiply","tan","composeMatrix","matrix","resetObjectTransform","target","saveObjectTransform","isTransparent","tolerance","_isTransparent","temp","imageData","getImageData","l","data","parsePreserveAspectRatioAttribute","attribute","meetOrSlice","alignX","alignY","aspectRatioAttrs","align","pop","clearFabricFontCache","fontFamily","toLowerCase","limitDimsByArea","ar","maximumArea","roughWidth","perfLimitSizeY","capValue","findScaleToFit","findScaleToCover","matrixToSVG","map","NUM_FRACTION_DIGITS","join","sizeAfterTransform","dimX","dimY","transformMatrix","bbox","_join","Array","arcToSegments","toX","toY","large","sweep","rotateX","argsString","th","sinTh","cosTh","fromX","fromY","abs","px","py","rx2","ry2","py2","px2","pl","root","s","cx","cy","cx1","cy1","mTheta","calcVectorAngle","dtheta","segments","ceil","result","mDelta","mT","th3","segmentToBezier","th2","costh2","sinth2","costh3","sinth3","cp1X","cp1Y","cp2X","cp2Y","ux","uy","vx","vy","ta","tb","drawArc","fx","fy","coords","tx","ty","segs","segsNorm","bezierCurveTo","getBoundsOfArc","bound","bounds","getBoundsOfCurve","x0","y0","x1","y1","x3","y3","tvalues","c","t1","t2","b2ac","sqrtb2ac","j","jlen","mt","invoke","method","args","byProperty","find","value1","value2","k","condition","extend","deep","Element","hasOwnProperty","clone","replace","match","character","capitalize","firstLetterOnly","escapeXml","graphemeSplit","textstring","chr","graphemes","getWholeChar","str","code","charCodeAt","isNaN","next","prev","emptyFunction","IS_DONTENUM_BUGGY","addMethods","parent","superclass","constructor","returnValue","valueOf","Subclass","callSuper","methodName","parentMethod","_this","superClassMethod","createClass","shift","initialize","subclasses","couldUseAttachEvent","attachEvent","touchEvents","addListener","element","addEventListener","removeListener","removeEventListener","getTouchInfo","event","touchProp","changedTouches","getPointer","scroll","getScrollLeftTop","_evt","clientX","clientY","isTouchEvent","pointerType","setStyle","styles","elementStyle","cssText","setOpacity","normalizedProperty","styleFloat","parseEl","supportsOpacity","opacity","supportsFilters","reOpacity","es","currentStyle","hasLayout","zoom","test","_slice","getById","id","getElementById","sliceCanConvertNodelists","toArray","arrayLike","childNodes","err","arr","makeElement","tagName","el","className","htmlFor","setAttribute","addClass","wrapElement","wrapper","replaceChild","docElement","documentElement","body","scrollLeft","scrollTop","host","nodeType","getElementOffset","docElem","doc","ownerDocument","box","offset","scrollLeftTop","offsetAttributes","borderLeftWidth","borderTopWidth","paddingLeft","paddingTop","attr","parseInt","getElementStyle","getBoundingClientRect","clientLeft","clientTop","defaultView","getComputedStyle","selectProp","makeElementUnselectable","onselectstart","unselectable","makeElementSelectable","getNodeCanvas","impl","_canvas","_image","cleanUpJsdomNode","_currentSrc","_attributes","_classList","setImageSmoothing","imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","oImageSmoothingEnabled","addParamToUrl","param","emptyFn","request","onComplete","xhr","XMLHttpRequest","parameters","onreadystatechange","readyState","open","setRequestHeader","send","warn","noop","defaultEasing","d","animate","requestAnimFrame","timestamp","start","Date","duration","finish","time","onChange","abort","easing","startValue","endValue","byValue","onStart","tick","ticktime","currentTime","timePerc","valuePerc","_requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","setTimeout","_cancelAnimFrame","cancelAnimationFrame","clearTimeout","cancelAnimFrame","calculateColor","begin","end","pos","color","animateColor","fromColor","toColor","startColor","Color","getSource","endColor","originalOnComplete","originalOnChange","posValue","colorEasing","isArray","normalize","asin","elastic","opts","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInBounce","easeOutBounce","easeInOutBounce","ease","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","svgValidTagNames","svgViewBoxElements","svgInvalidAncestors","svgValidParents","attributesMap","display","visibility","colorAttributes","stroke","fSize","cPath","svgValidTagNamesRegEx","getSvgRegex","svgViewBoxElementsRegEx","svgInvalidAncestorsRegEx","svgValidParentsRegEx","cssRules","gradientDefs","clipPaths","normalizeAttr","normalizeValue","parentAttributes","parsed","parseTransformAttribute","visible","fillIndex","strokeIndex","RegExp","_setStrokeFillOpacity","setAlpha","getAlpha","toRgba","_getMultipleNodes","nodeNames","nodeName","nodeArray","nodeList","getElementsByTagName","rotateMatrix","multiplierX","multiplierY","skewMatrix","translateMatrix","commaWsp","scale","transforms","transformList","reTransformList","reTransform","attributeValue","matrices","m","operation","combinedMatrix","parseStyleString","oStyle","chunk","pair","trim","parseStyleObject","getGlobalStylesForElement","svgUid","rule","elementMatchesRule","selectors","firstMatching","parentMatching","selectorMatches","doesSomeParentMatch","selector","classNames","getAttribute","matcher","elementById","node","nodelist","parseUseDirectives","xlink","substr","el2","cloneNode","currentTrans","oldLength","attrs","applyViewboxTransform","el3","createElementNS","setAttributeNS","nodeValue","firstChild","removeAttribute","reViewBoxAttrValue","viewBoxAttr","viewBoxWidth","viewBoxHeight","widthAttr","heightAttr","preserveAspectRatio","missingViewBox","missingDimAttr","toBeParsed","parsedDim","widthDiff","heightDiff","hasAncestorWithNodeName","parseSVGDocument","parsingOptions","__uid","descendants","selectNodes","getGradientDefs","getCSSRules","parseElements","instances","recursivelyParseGradientsXlink","gradient","gradientsAttrs","xlinkAttr","xLink","referencedGradient","hasAttribute","children","referenceClone","reFontDeclaration","parseFontDeclaration","fontStyle","fontWeight","lineHeight","tagArray","elList","parseAttributes","parentFontSize","ownAttributes","cssAttrs","parseStyleAttribute","normalizedAttr","normalizedValue","normalizedStyle","font","mergedAttrs","ElementsParser","parse","parsePointsAttribute","parsedPoints","allRules","rules","styleContents","textContent","ruleObj","declaration","propertyValuePairs","_rule","loadSVGFromURL","xml","responseXML","results","_options","allElements","loadSVGFromString","parser","parseFromString","regexUrl","proto","numElements","createObjects","createObject","findTag","fromElement","createCallback","checkIfDone","resolveGradient","Image","_originalElement","_removeTransformMatrix","resolveClipPath","extractPropertyDefinition","storage","regex","lastIndex","gradientDef","opacityAttr","createClipPathCallback","container","_newObj","fillRule","clipRule","usingElement","clipPath","objTransformInv","gTransform","calcTransformMatrix","clipPathTag","clipPathOwner","setPositionByOrigin","that","scalarAdd","scalar","scalarAddEquals","subtract","scalarSubtract","scalarSubtractEquals","multiplyEquals","divide","divideEquals","eq","lt","lte","gt","gte","lerp","distanceFrom","midPointFrom","setXY","setX","setY","setFromPoint","swap","Intersection","status","appendPoint","appendPoints","intersectLineLine","a1","a2","b1","b2","uaT","ubT","uB","ua","ub","intersectLinePolygon","inter","intersectPolygonPolygon","points1","points2","intersectPolygonRectangle","r1","r2","topRight","bottomLeft","inter1","inter2","inter3","inter4","setSource","_tryParsingColor","colorNameMap","sourceFromHex","sourceFromRgb","sourceFromHsl","_rgbToHsl","g","h","round","_source","toRgb","toHsl","hsl","toHsla","toHex","toHexa","alpha","toGrayscale","average","currentAlpha","toBlackWhite","threshold","overlayWith","otherColor","otherAlpha","otherSource","reRGBa","reHSLa","reHex","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgrey","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","hue2rgb","q","fromRgb","fromSource","fromRgba","fromHsl","fromHsla","fromHex","isShortNotation","isRGBa","oColor","scaleMap","skewMap","controls","LEFT","TOP","RIGHT","BOTTOM","CENTER","opposite","bottom","right","findCornerQuadrant","fabricObject","control","cornerAngle","fireEvent","canasOptions","assign","scaleIsProportional","eventData","uniScaleKey","uniformIsToggled","uniformScaling","scalingIsForbidden","by","scaleProportionally","lockX","lockScalingX","lockY","lockScalingY","scaleCursorStyleHandler","notAllowed","n","skewCursorStyleHandler","lockSkewingY","lockSkewingX","scaleSkewCursorStyleHandler","altActionKey","scaleOrSkewActionName","isAlternative","rotationStyleHandler","lockRotation","cursorStyle","commonEventInfo","e","pointer","wrapWithFixedAnchor","actionHandler","getCenterPoint","constraint","translateToOriginPoint","originX","originY","actionPerformed","getLocalPoint","corner","getZoom","padding","localPoint","toLocalPoint","offsetX","offsetY","targetHasOneFlip","compensateScaleForSkew","oppositeSkew","scaleToCompoensate","axis","reference","newDim","_getTransformedDimensions","newValue","skewObjectX","dimNoSkew","totalSkewSize","currentSkew","newSkew","hasSkewed","dimBeforeSkewing","skewObjectY","skewHandlerX","localPointFromCenter","finalHandler","skewHandlerY","rotationWithSnapping","pivotPoint","lastAngle","ey","ex","curAngle","hasRotated","snapAngle","snapThreshold","rightAngleLocked","leftAngleLocked","scaleObject","newPoint","dim","forbidScaling","signX","signY","lockScalingFlip","distance","original","originalDistance","hasScaled","oldScaleX","oldScaleY","scaleObjectFromCorner","scaleObjectX","scaleObjectY","scalingYOrSkewingX","scalingY","scalingXOrSkewingY","scalingX","changeWidth","strokePadding","strokeWidth","strokeUniform","newWidth","scalingEqually","controlsUtils","renderCircleControl","styleOverride","cornerSize","transparentCorners","cornerStrokeColor","fillStyle","cornerColor","strokeStyle","lineWidth","beginPath","arc","renderSquareControl","sizeBy2","strokeCornerColor","strokeRect","Control","actionName","withConnection","mouseDownHandler","mouseUpHandler","getActionHandler","getMouseDownHandler","getMouseUpHandler","cursorStyleHandler","getActionName","getVisibility","controlKey","objectVisibility","_controlsVisibility","setVisibility","positionHandler","finalMatrix","render","cornerStyle","getColorStop","multiplier","colorAlpha","keyValuePairs","getLinearCoords","getRadialCoords","gradientTransform","gradientUnits","keys","option","addColorStop","toObject","propertiesToInclude","toSVG","markup","commonAttributes","needsSwap","withViewport","additionalTransform","sort","pathOffset","reverse","minRadius","maxRadius","percentageShift","colorStop","toLive","createLinearGradient","createRadialGradient","instance","svgOptions","colorStopEls","__convertPercentUnitsToValues","propValue","finalValue","repeat","patternTransform","setOptions","isError","patternSource","patternWidth","patternHeight","patternOffsetX","patternOffsetY","patternImgSrc","complete","naturalWidth","naturalHeight","createPattern","Shadow","blur","affectStroke","includeDefaultValues","nonScaling","_parseShadow","shadow","shadowStr","offsetsAndBlur","reOffsetsAndBlur","fBoxX","fBoxY","BLUR_BOX","StaticCanvas","CANVAS_INIT_ERROR","Error","renderAndResetBound","renderAndReset","bind","requestRenderAllBound","_initStatic","backgroundColor","backgroundImage","overlayColor","overlayImage","stateful","controlsAboveOverlay","allowTouchScrolling","viewportTransform","backgroundVpt","overlayVpt","enableRetinaScaling","vptCoords","skipOffscreen","cb","_createLowerCanvas","_initOptions","interactive","_initRetinaScaling","setOverlayImage","setBackgroundImage","setBackgroundColor","setOverlayColor","calcOffset","_isRetinaScaling","getRetinaScaling","scaleRatio","__initRetinaScaling","lowerCanvasEl","contextContainer","upperCanvasEl","contextTop","_offset","image","__setBgOverlayImage","__setBgOverlayColor","_createCanvasElement","_applyCanvasStyle","getWidth","getHeight","setWidth","setDimensions","setHeight","dimensions","cssValue","cssOnly","_setBackstoreDimension","hasLostContext","backstoreOnly","_setCssDimension","_isCurrentlyDrawing","freeDrawingBrush","_setBrushStyles","cacheCanvasEl","wrapperEl","setViewportTransform","vpt","activeObject","_activeObject","group","setCoords","calcViewportBoundaries","zoomToPoint","before","after","setZoom","absolutePan","relativePan","getElement","setupState","clearContext","clearRect","clear","_hasITextHandlers","_mouseUpITextHandler","_iTextInstances","renderAll","canvasToDrawOn","renderCanvas","isRendering","iVpt","tl","br","tr","bl","cancelRequestedRender","_renderBackground","_renderObjects","drawControls","shouldCache","_transformDone","renderCache","forClipping","drawClipPathOnCanvas","_renderOverlay","globalCompositeOperation","zoomX","zoomY","_cacheCanvas","cacheTranslationX","cacheTranslationY","_renderBackgroundOrOverlay","needsVpt","lineTo","closePath","getCenter","centerObjectH","_centerObject","centerObjectV","centerObject","center","viewportCenterObject","vpCenter","getVpCenter","viewportCenterObjectH","viewportCenterObjectV","toDatalessJSON","toDatalessObject","_toObjectMethod","_toObjects","_toObject","__serializeBgOverlay","excludeFromExport","originalValue","bgImage","overlay","background","svgViewportTransformation","_setSVGPreamble","_setSVGHeader","clipPathId","_setSVGBgOverlayColor","_setSVGBgOverlayImage","_setSVGObjects","suppressPreamble","encoding","viewBox","createSVGFontFacesMarkup","createSVGRefElementsMarkup","createSVGClipPathMarkup","toClipPathSVG","shouldTransform","fontList","row","rowIndex","_char","charIndex","_setSVGObject","finalWidth","finalHeight","shouldInvert","sendToBack","activeSelection","objs","unshift","bringToFront","sendBackwards","intersecting","newIdx","objsMoved","_findNewLowerIndex","isIntersecting","intersectsWithObject","isContainedWithinObject","bringForward","_findNewUpperIndex","dispose","DataURLExporter","EMPTY_JSON","supports","setLineDash","toJSON","createPNGStream","createJPEGStream","BaseBrush","strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeDashArray","lineCap","miterLimit","lineJoin","_saveAndTransform","_setShadow","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","needsFullRender","_resetShadow","PencilBrush","decimate","_points","_drawSegment","p1","p2","midPoint","quadraticCurveTo","onMouseDown","_isMainEvent","_prepareForDrawing","_captureDrawingPath","_render","onMouseMove","oldEnd","onMouseUp","_finalizeAndAddPath","_reset","_addPoint","pointerPoint","convertPointsToSVGPath","multSignX","multSignY","manyPoints","createPath","pathData","Path","decimatePoints","adjustedDistance","lastPoint","newPoints","cDistance","CircleBrush","drawDot","addPoint","dot","radius","originalRenderOnAddRemove","circles","circle","Circle","circleRadius","circleColor","SprayBrush","density","dotWidth","dotWidthVariance","randomOpacity","optimizeOverlapping","sprayChunks","addSprayChunk","sprayChunkPoints","rects","ilen","sprayChunk","rect","Rect","_getOptimizedRects","uniqueRects","uniqueRectsArray","globalAlpha","fillRect","PatternBrush","getPatternSrc","dotDistance","patternCanvas","patternCtx","getPatternSrcFunction","String","getPattern","topLeft","_getLeftTopCoords","supportLineDash","STROKE_OFFSET","_initInteractive","_createCacheCanvas","centeredScaling","centeredRotation","centeredKey","selection","selectionKey","altSelectionKey","selectionColor","selectionDashArray","selectionBorderColor","selectionLineWidth","selectionFullyContained","hoverCursor","moveCursor","defaultCursor","freeDrawingCursor","rotationCursor","notAllowedCursor","containerClass","perPixelTargetFind","targetFindTolerance","skipTargetFind","isDrawingMode","preserveObjectStacking","stopContextMenu","fireRightClick","fireMiddleClick","targets","_hoveredTarget","_hoveredTargets","_currentTransform","_groupSelector","_initWrapperElement","_createUpperCanvas","_initEventListeners","_chooseObjectsToRender","activeObjects","getActiveObjects","objsToRender","activeGroupObjects","contextTopDirty","renderTopLayer","_drawSelection","renderTop","containsPoint","ignoreZoom","xy","isTouch","_normalizePointer","_findTargetCorner","invertedM","vptPointer","restorePointerVpt","isTargetTransparent","normalizedPointer","targetRelativeX","targetRelativeY","_cacheContext","contextCache","originalColor","selectionBackgroundColor","_renderControls","hasBorders","_isSelectionKeyPressed","selectionKeyPressed","_shouldClearSelection","evented","selectable","_shouldCenterTransform","action","altKey","centerTransform","_getOriginFromCorner","_getActionFromCorner","alreadySelected","_setupCurrentTransform","__corner","lastX","lastY","shiftKey","_beforeTransform","_translateObject","newLeft","newTop","moveX","moveY","setCursor","cursor","groupSelector","aleft","atop","_setLineDash","findTarget","skipGroup","aObjects","activeTarget","activeTargetSubs","_searchPossibleTargets","_checkTarget","globalPointer","isEditing","subTarget","objToCheck","pointerToUse","subTargetCheck","_absolutePointer","_pointer","boundsWidth","boundsHeight","cssScale","retinaScaling","lowerCanvasClass","_copyCanvasStyle","class","fromEl","toEl","getSelectionContext","getSelectionElement","getActiveObject","active","_discardActiveObject","_fireSelectionEvents","oldObjects","somethingChanged","added","removed","opt","oldObject","selected","deselected","updated","setActiveObject","currentActives","_setActiveObject","onSelect","onDeselect","discardActiveObject","removeListeners","originalProperties","_realizeGroupTransformOnObject","_unwindGroupTransformOnObject","layoutProps","originalValues","realizeTransform","clearContextTop","RIGHT_CLICK","MIDDLE_CLICK","LEFT_CLICK","addEventOptions","passive","checkClick","button","mainTouchId","eventMapping","PointerEvent","down","up","enter","leave","over","out","move","MSPointerEvent","msPointerEnabled","_bindEvents","addOrRemove","_getEventPrefix","enablePointerEvents","functor","eventjsFunctor","canvasElement","eventTypePrefix","_onResize","_onMouseDown","_onMouseMove","_onMouseOut","_onMouseEnter","_onMouseWheel","_onContextMenu","_onDoubleClick","_onDragOver","_onDragEnter","_onDragLeave","_onDrop","_onTouchStart","eventjs","_onGesture","_onDrag","_onOrientationChange","_onShake","_onLongPress","_onMouseUp","_onTouchEnd","eventsBound","_simpleEventHandler","self","__onTransformGesture","__onDrag","__onMouseWheel","_target","hiddenTextarea","focus","currentTransform","__onOrientationChange","__onShake","__onLongPress","preventDefault","_fireEnterLeaveEvents","stopPropagation","_cacheTransformEventData","_handleEvent","_resetTransformEventData","getPointerId","evt","identifier","pointerId","isPrimary","touches","__onMouseDown","__onMouseUp","_willAddMouseDown","__onMouseMove","_shouldRender","shouldRender","isClick","_onMouseUpInDrawingMode","_finalizeCurrentTransform","targetWasActive","_maybeGroupObjects","isMoving","_setCursorFromEvent","eventType","subTargets","absolutePointer","_scaling","hasStateChanged","_addEventOptions","_fire","_onMouseDownInDrawingMode","_onMouseMoveInDrawingMode","_previousPointer","shouldGroup","_shouldGroup","_handleGrouping","saveState","_fireOverOutEvents","_transformObject","fireSyntheticInOutEvents","oldTarget","evtOut","canvasEvtOut","evtIn","canvasEvtIn","_draggedoverTarget","config","inOpt","outOpt","outFires","inFires","targetChanged","previousTarget","nextTarget","reset","_performTransformAction","getCornerCursor","_updateActiveSelection","_createActiveSelection","currentActiveObjects","removeWithUpdate","addWithUpdate","_createGroup","isActiveLower","groupObjects","exitEditing","ActiveSelection","_groupSelectedObjects","_collectObjects","aGroup","currentObject","selectionX1Y1","selectionX2Y2","allowIntersect","intersectsWithRect","isContainedWithinRect","toCanvasElement","cropping","scaledWidth","scaledHeight","originalWidth","originalHeight","newZoom","vp","originalInteractive","newVp","originalRetina","originalContextTop","loadFromJSON","json","serialized","JSON","_enlivenObjects","_setBgOverlay","enlivenedCanvasClip","__setupCanvas","loaded","cbIfLoaded","__setBgOverlay","enlivedObject","_toDataURL","_toDataURLWithMultiplier","toDataURLWithMultiplier","stringify","cloneWithoutData","backgroundImageOpacity","backgroundImageStretch","supportsLineDash","objectCaching","ALIASING_LIMIT","touchCornerSize","borderColor","borderDashArray","cornerDashArray","strokeDashOffset","borderOpacityWhenMoving","borderScaleFactor","minScaleLimit","hasControls","lockMovementX","lockMovementY","statefullCache","noScaleCache","dirty","paintFirst","stateProperties","cacheProperties","colorProperties","inverted","absolutePositioned","_cacheProperties","_updateCacheCanvas","_limitCacheSize","dims","limitedDims","capped","_getCacheCanvasDimensions","objectScale","getTotalObjectScaling","neededX","neededY","targetCanvas","minCacheSize","drawingWidth","drawingHeight","dimensionsChanged","cacheWidth","cacheHeight","zoomChanged","shouldRedraw","additionalWidth","additionalHeight","shouldResizeCanvas","canvasWidth","canvasHeight","sizeGrowing","sizeShrinking","setTransform","needFullTransform","_removeDefaultValues","getObjectScaling","retina","getObjectOpacity","shouldConstrainValue","isChanged","groupNeedsUpdate","_constrainScale","isOnACache","setOnGroup","getViewportTransform","isNotVisible","isOnScreen","_setupCompositeOperation","drawSelectionBackground","_setOpacity","drawCacheOnCanvas","_removeCacheCanvas","drawObject","propertySet","isCacheDirty","hasStroke","hasFill","needsItsOwnCache","ownCaching","willDrawShadow","drawClipPathOnCache","originalFill","originalStroke","_setClippingProperties","_setStrokeStyles","_setFillStyles","_drawClipPath","skipCanvas","_getNonTransformedDimensions","_removeShadow","decl","lineDashOffset","dashArray","alternative","drawBorders","forActiveSelection","drawBordersInGroup","scaling","multX","multY","_applyPatternGradientTransform","_renderPaintInOrder","_renderStroke","_renderFill","_renderDashedStroke","_applyPatternForTransformedGradient","pCanvas","pCtx","_findCenterFromElement","_assignTransformMatrixProps","preserveAspectRatioOptions","cropX","cropY","offsetLeft","offsetTop","objectForm","_fromObject","cloneAsImage","utils","origParams","originalGroup","originalShadow","withoutTransform","withoutShadow","boundingRect","getBoundingRect","shadowOffset","originalCanvas","isType","shouldCenterOrigin","_setOriginToCenter","_resetOrigin","centerH","viewportCenterH","centerV","viewportCenterV","viewportCenter","getLocalPointer","pClicked","objectLeftTop","createAccessors","extraParam","enlivedProps","originXOffset","originYOffset","translateToGivenOrigin","fromOriginX","fromOriginY","toOriginX","toOriginY","translateToCenterPoint","leftTop","getPointByOrigin","adjustPosition","to","hypotFull","getScaledWidth","xFull","yFull","offsetFrom","offsetTo","_originalOriginX","_originalOriginY","originPoint","arrayFromCoords","multiplyMatrices","oCoords","aCoords","lineCoords","ownMatrixCache","matrixCache","_getCoords","absolute","calculate","calcACoords","calcLineCoords","getCoords","pointTL","pointBR","intersection","other","otherCoords","lines","_getImageLines","_findCrossPoints","some","_containsCenterOfCanvas","isPartiallyOnScreen","allPointsAreOutside","every","topline","rightline","bottomline","leftline","xi","xcount","iLine","lineKey","getScaledHeight","scaleToWidth","boundingRectFactor","scaleToHeight","calcCoords","calcOCoords","cosP","sinP","cosPSinP","cosPMinusSinP","_calcRotateMatrix","_calcTranslateMatrix","startMatrix","_calculateCurrentDimensions","forEachControl","w","skipCorners","_setCornerCoords","transformMatrixKey","sep","prefix","calcOwnMatrix","cache","tMatrix","_calcDimensionsTransformMatrix","flipping","noSkew","_finalizeDimensions","getSvgColorString","getSvgStyles","skipShadow","getSvgFilter","getSvgSpanStyles","useWhiteSpace","term","textDecoration","getSvgTextDecoration","deltaY","decoration","getSvgCommons","getSvgTransform","full","svgTransform","_setSVGBg","textBgRects","_getFillAttributes","_createBaseSVGMarkup","_toSVG","_createBaseClipPathSVGMarkup","objectMarkup","commonPieces","noStyle","styleInfo","shadowInfo","withShadow","vectorEffect","absoluteClipPath","clipPathMarkup","addPaintOrder","originalSet","saveProps","props","tmpObj","_isEqual","origValue","currentValue","firstPass","dashedPropertySet","forTouch","isControlVisible","touchCorner","fn","newTheta","cosTheta","sinTheta","cornerHypotenuse","touchHypotenuse","cosHalfOffset","sinHalfOffset","touchCosHalfOffset","touchSinHalfOffset","wh","shouldStroke","setControlVisible","setControlsVisibility","FX_DURATION","fxCenterObjectH","callbacks","empty","fxCenterObjectV","fxRemove","propsToAnimate","skipCallbacks","_animate","propPair","propIsColor","from","valueProgress","timeProgress","coordProps","Line","_setWidthHeight","_getLeftToOriginX","_getTopToOriginY","makeEdgeToOriginGetter","axis1","axis2","dimension","nearest","farthest","calcLinePoints","origStrokeStyle","xMult","yMult","ATTRIBUTE_NAMES","parsedAttributes","_callback","propertyNames","originValues","pi","startAngle","endAngle","setRadius","svgString","startX","startY","endX","endY","largeFlag","getRadiusX","getRadiusY","isValidRadius","Triangle","widthBy2","heightBy2","piBy2","Ellipse","getRx","getRy","_initRxRy","isRounded","Polyline","_setPositionDimensions","calcDim","_calcDimensions","correctLeftTop","fromSVG","diffX","diffY","commonRender","fromElementGenerator","_class","Polygon","_toString","commandLengths","repeatedCommands","M","fromArray","_parsePath","_renderPathCommands","previous","subpathStartX","subpathStartY","controlX","controlY","tempX","tempY","_getOffsetTransform","digits","currentPath","re","coordsStr","coordsParsed","command","commandLength","repeatedCommand","klen","aX","aY","deltaX","pathUrl","useSetOnGroup","isAlreadyGrouped","_calcBounds","_updateObjectsCoords","_updateObjectsACoords","skipControls","_updateObjectCoords","objectLeft","objectTop","_restoreObjectsState","_includeDefaultValues","objsToObject","originalDefaults","_obj","ownCache","_restoreObjectState","destroy","toActiveSelection","ungroupOnCanvas","setObjectsCoords","onlyWidthHeight","iLen","jLen","_getBounds","minXY","maxXY","enlivedClipPath","toGroup","newGroup","childrenOverride","srcFromAttribute","_lastScaleX","_lastScaleY","_filterScalingX","_filterScalingY","minimumScaleTrigger","cacheKey","imageSmoothing","filters","_initElement","_element","setElement","removeTexture","_initConfig","applyFilters","resizeFilter","applyResizeFilters","backend","filterBackend","evictCachesForKey","getCrossOrigin","getOriginalSize","_stroke","filterObj","getSrc","hasCrop","imageMarkup","strokeSvg","imageRendering","getSvgSrc","origFill","filtered","setSrc","minimumScale","elementToFilter","_filteredEl","sourceWidth","sourceHeight","isNeutralState","imgElement","_needsResize","elementToDraw","sW","sH","sX","sY","_resetWidthHeight","CSS_CANVAS","_initFilters","pAR","rWidth","rHeight","pWidth","pHeight","_object","resizeFilters","fromURL","imgOptions","_getAngleValueForStraighten","straighten","fxStraighten","straightenObject","fxStraightenObject","testPrecision","gl","precision","fragmentSource","fragmentShader","createShader","FRAGMENT_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","isSupported","getParameter","MAX_TEXTURE_SIZE","precisions","webGlPrecision","setupGLContext","captureGPUInfo","createWebGLCanvas","aPosition","Float32Array","chooseFastestCopyGLTo2DMethod","canMeasurePerf","performance","canUseImageData","ImageData","canUseArrayBuffer","ArrayBuffer","canUseUint8Clamped","Uint8ClampedArray","imageBuffer","copyGLTo2D","copyGLTo2DPutImageData","testContext","destinationWidth","destinationHeight","startTime","drawImageTime","putImageDataTime","now","copyGLTo2DDrawImage","glOptions","premultipliedAlpha","depth","stencil","antialias","clearColor","cachedTexture","getCachedTexture","pipelineState","sourceTexture","createTexture","targetTexture","originalTexture","passes","webgl","programCache","pass","tempFbo","createFramebuffer","bindFramebuffer","FRAMEBUFFER","applyTo","resizeCanvasIfNeeded","bindTexture","TEXTURE_2D","deleteTexture","deleteFramebuffer","clearWebGLCaches","textureCache","textureImageSource","texture","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","RGBA","UNSIGNED_BYTE","uniqueId","gpuInfo","renderer","vendor","ext","getExtension","UNMASKED_RENDERER_WEBGL","UNMASKED_VENDOR_WEBGL","dWidth","dHeight","glCanvas","sourceY","numBytes","u8","Uint8Array","u8Clamped","readPixels","imgData","putImageData","sourceElement","originalImageData","originalEl","BaseFilter","vertexSource","createProgram","vertexShader","VERTEX_SHADER","getShaderInfoLog","program","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","attributeLocations","getAttributeLocations","uniformLocations","getUniformLocations","uStepW","getUniformLocation","uStepH","getAttribLocation","sendAttributeData","aPositionData","attributeLocation","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","enableVertexAttribArray","vertexAttribPointer","FLOAT","bufferData","STATIC_DRAW","_setupFrameBuffer","framebufferTexture2D","COLOR_ATTACHMENT0","_swapTextures","main","mainParameter","applyToWebGL","applyTo2d","retrieveShader","shader","useProgram","uniform1f","sendUniformData","viewport","drawArrays","TRIANGLE_STRIP","bindAdditionalTexture","textureUnit","activeTexture","TEXTURE0","unbindAdditionalTexture","getMainParameter","setMainParameter","createHelpLayer","helpLayer","mainP","ColorMatrix","colorsOnly","uColorMatrix","uConstants","constants","uniformMatrix4fv","uniform4fv","Brightness","brightness","uBrightness","Convolute","opaque","Convolute_3_1","Convolute_3_0","Convolute_5_1","Convolute_5_0","Convolute_7_1","Convolute_7_0","Convolute_9_1","Convolute_9_0","weights","side","halfSide","sw","sh","output","createImageData","dst","alphaFac","dstOff","scx","scy","srcOff","wt","uMatrix","uOpaque","uHalfSize","uSize","uniform1fv","Grayscale","lightness","luminosity","mode","uMode","uniform1i","Invert","invert","uInvert","Noise","noise","rand","uNoise","uSeed","Pixelate","blocksize","_i","_j","_iLen","_jLen","uBlocksize","RemoveColor","useAlpha","lowC","highC","uLow","uHigh","Brownie","Vintage","Kodachrome","Technicolor","Polaroid","Sepia","BlackWhite","BlendColor","screen","diff","lighten","darken","exclusion","tint","buildSource","tg","alpha1","uColor","BlendImage","mask","TEXTURE1","calculateMatrix","canvas1","blendData","blendImage","uTransformMatrix","uImage","uniformMatrix3fv","Resize","resizeType","lanczosLobes","uDelta","uTaps","uniform2fv","horizontal","taps","filterWindow","getFilterWindow","generateShader","tempScale","getTaps","lobeFunction","lanczosCreate","offsets","fragmentSourceTOP","dW","dH","lobes","xx","rcpScaleX","rcpScaleY","oW","oH","newData","sliceByTwo","hermiteFastResize","bilinearFiltering","lanczosResize","mult","doneW","doneH","stepW","stepH","tmpCanvas","dX","dY","process","u","weight","fX","fY","ratioX","icenter","ratioY","range2X","cacheLanc","range2Y","lanczos","rcpRatioX","rcpRatioY","srcData","destData","destImg","xDiff","yDiff","chnl","origPix","w4","pixels","destImage","destPixels","ratioW","ratioH","ratioWHalf","ratioHHalf","img2","data2","weightsAlpha","gxR","gxG","gxB","gxA","centerY","yy","centerX","w0","Contrast","contrast","contrastF","uContrast","Saturation","saturation","adjust","uSaturation","Blur","aspectRatio","simpleBlur","canvas2","blurLayer1","blurLayer2","ctx1","ctx2","nSamples","percent","newImageData","delta","chooseRightDelta","blurScale","Gamma","gamma","rInv","gInv","bInv","rVals","gVals","bVals","uGamma","uniform3fv","Composed","subFilters","HueRotation","rotation","rad","aThird","aThirdSqtSin","OneMinusCos","_dimensionAffectingProps","_reNewline","_reSpacesAndTabs","_reSpaceAndTab","_reWords","underline","overline","linethrough","textAlign","superscript","baseline","subscript","textBackgroundColor","_fontSizeFraction","_fontSizeMult","charSpacing","_measuringContext","_styleProperties","__charBounds","CACHE_FONT_SIZE","MIN_TEXT_WIDTH","text","__skipDimension","initDimensions","getMeasuringContext","_splitText","newLines","_splitTextIntoLines","textLines","_textLines","graphemeLines","_unwrappedTextLines","_unwrappedLines","_text","graphemeText","_clearCache","calcTextWidth","cursorWidth","enlargeSpaces","calcTextHeight","diffSpace","currentLineWidth","numberOfSpaces","accumulatedSpace","line","charBound","spaces","isEndOfWrapping","getLineWidth","kernedWidth","lineIndex","missingNewlineOffset","_setTextStyles","_renderTextLinesBackground","_renderTextDecoration","_renderText","_renderTextStroke","_renderTextFill","charStyle","forMeasuring","textBaseline","_getFontDeclaration","maxWidth","_renderTextLine","_renderChars","styleHas","lineTopOffset","heightOfLine","lineLeftOffset","lastColor","leftOffset","_getLeftOffset","topOffset","_getTopOffset","boxStart","boxWidth","charBox","currentColor","getHeightOfLine","_getLineLeftOffset","getValueOfPropertyAt","getFontCache","cacheProp","_applyCharStyles","styleDeclaration","_measureChar","previousChar","prevCharStyle","fontCache","fontDeclaration","previousFontDeclaration","couple","stylesAreEqual","coupleWidth","previousWidth","fontMultiplier","measureText","getHeightOfChar","measureLine","lineInfo","_measureLine","_getWidthOfCharSpacing","grapheme","prevGrapheme","graphemeInfo","numOfSpaces","lineBounds","_getGraphemeBox","skipLeft","getCompleteStyleDeclaration","prevStyle","info","previousBox","__lineHeights","maxHeight","_renderTextCommon","lineHeights","isEmptyStyles","isJustify","actualStyle","nextStyle","charsToRender","timeToRender","shortCut","_renderChar","_hasStyleChanged","_getStyleDeclaration","fullDecl","shouldFill","fillText","strokeText","setSuperscript","_setScript","setSubscript","schema","loc","get2DCursorLocation","setSelectionStyles","thisStyle","_hasStyleChangedForSvg","__lineWidths","_shouldClearDimensionCache","shouldClear","_forceClearCache","_size","_dy","lastDecoration","currentDecoration","currentFill","lastFill","styleObject","family","fontIsGeneric","genericFonts","newLine","newText","additionalProperties","needsDims","_key","parsedAnchor","textAnchor","originalStrokeWidth","textHeightScaleFactor","lineHeightDiff","scaledDiff","textHeight","offX","p3","cleanStyle","stylesCount","letterCount","stylePropertyValue","allStyleObjectPropertiesMatch","graphemeCount","stylePropertyHasBeenSet","removeStyle","lineNum","charNum","_extendStyles","_getLineStyle","_setLineStyle","_setStyleDeclaration","selectionStart","skipWrapping","getSelectionStyles","startIndex","endIndex","selectionEnd","getStyleAtPosition","lineStyle","_deleteStyleDeclaration","_deleteLineStyle","parseDecoration","IText","editable","editingBorderColor","cursorColor","cursorDelay","cursorDuration","caching","_reSpace","_currentCursorOpacity","_selectionDirection","_abortCursorAnimation","__widthOfSpace","inCompositionMode","initBehavior","setSelectionStart","_updateAndFire","setSelectionEnd","_fireSelectionChanged","_updateTextarea","initDelayedCursor","cursorOffsetCache","renderCursorOrSelection","skipRestore","_clearTextArea","boundaries","_getCursorBoundaries","renderCursor","renderSelection","_getCursorBoundariesOffsets","cursorPosition","cursorLocation","charHeight","__isMousedown","startLine","endLine","startChar","endChar","lineOffset","realLineHeight","boxEnd","compositionColor","getCurrentCharFontSize","cp","_getCurrentCharIndex","getCurrentCharColor","initAddedHandler","initRemovedHandler","initCursorSelectionHandlers","initDoubleClickSimulation","mouseMoveHandler","_initCanvasHandlers","_removeCanvasHandlers","_tick","_currentTickState","_animateCursor","targetOpacity","completeMethod","tickState","isAborted","_onTickComplete","_cursorTimeout1","_currentTickCompleteState","restart","delay","abortCursorAnimation","_cursorTimeout2","selectAll","getSelectedText","findWordBoundaryLeft","startFrom","findWordBoundaryRight","findLineBoundaryLeft","findLineBoundaryRight","searchWordBoundary","direction","selectWord","newSelectionStart","newSelectionEnd","selectLine","enterEditing","exitEditingOnOthers","initHiddenTextarea","_saveEditingProps","_setEditingProps","_textBeforeEdit","initMouseMoveHandler","getSelectionStartFromPointer","currentStart","currentEnd","__selectionStartOnMouseDown","restartCursorIfNeeded","fromStringToGraphemeSelection","smallerTextStart","graphemeStart","smallerTextEnd","graphemeEnd","fromGraphemeToStringSelection","newSelection","updateTextareaPosition","updateFromTextArea","_calcTextareaPosition","desiredPosition","compositionStart","upperCanvas","upperCanvasWidth","upperCanvasHeight","clientWidth","clientHeight","_savedProps","_restoreEditingProps","isTextChanged","_removeExtraneousStyles","removeStyleFromTo","cursorStart","cursorEnd","lineStart","charStart","lineEnd","charEnd","styleObj","shiftLineStyles","numericChar","clonedStyles","numericLine","insertNewlineStyleObject","qty","copiedStyle","currentCharStyle","newLineStyles","somethingAdded","isEndOfLine","numIndex","styleCarriedOver","insertCharStyleObject","quantity","currentLineStyles","currentLineStylesCloned","numericIndex","newStyle","insertNewStyleBlock","insertedText","cursorLoc","addedLines","linesLength","setSelectionStartEndWithShift","setSelectionInBoundaries","__lastClickTime","__lastLastClickTime","__lastPointer","__newClickTime","newPointer","isTripleClick","_stopEvent","__lastIsEditing","__lastSelected","initMousedownHandler","initMouseupHandler","initClicks","doubleClickHandler","tripleClickHandler","_mouseDownHandler","setCursorByClick","_mouseDownHandlerBefore","currentActive","mouseOffset","prevWidth","_getNewSelectionStartFromOffset","distanceBtwLastCharAndCursor","distanceBtwNextCharAndCursor","onKeyDown","onKeyUp","onInput","copy","paste","onCompositionStart","onCompositionUpdate","onCompositionEnd","_clickHandlerInitialized","onClick","keysMap","ctrlKeysMapUp","ctrlKeysMapDown","keyCode","ctrlKey","metaKey","stopImmediatePropagation","_copyDone","fromPaste","nextText","charCount","nextCharCount","removedText","charDiff","removeFrom","removeTo","textareaSelection","backDelete","copiedText","copiedTextStyle","compositionEnd","_getClipboardData","clipboardData","_getWidthBeforeCursor","widthBeforeCursor","getDownCursorOffset","isRight","selectionProp","_getSelectionForOffset","indexOnOtherLine","_getIndexOnLine","textAfterCursor","getUpCursorOffset","textBeforeCursor","widthOfCharsOnLine","indexOnLine","charWidth","foundMatch","leftEdge","rightEdge","offsetFromLeftEdge","offsetFromRightEdge","moveCursorDown","_moveCursorUpOrDown","moveCursorUp","moveCursorWithShift","moveCursorWithoutShift","moveCursorLeft","_moveCursorLeftOrRight","_move","_moveLeft","_moveRight","moveCursorLeftWithoutShift","change","moveCursorLeftWithShift","moveCursorRight","moveCursorRightWithShift","moveCursorRightWithoutShift","changed","removeChars","insertChars","multipleSpacesRegex","_getSVGLeftTopOffsets","textAndBg","_getSVGTextAndBg","textTop","textLeft","_wrapSVGTextAndBg","lineTop","noShadow","textSpans","textTopOffset","textLeftOffset","_setSVGTextLineBg","_setSVGTextLineText","_createTextCharSpan","styleDecl","shouldUseWhitespace","styleProps","fillStyles","dySpan","_pushTextBgRect","fillColor","_getSVGLineTopOffset","lastHeight","svgStyle","Textbox","minWidth","dynamicMinWidth","__cachedLines","_wordJoiners","splitByGrapheme","_styleMap","_generateStyleMap","textInfo","realLineCount","realLineCharCount","isWrapping","nextLineIndex","nextOffset","shouldLimit","mapNextLine","_wrapText","desiredWidth","wrapped","_wrapLine","_measureWord","word","charOffset","_line","reservedSpace","words","infix","wordWidth","infixWidth","largestWordWidth","lineJustStarted","additionalSpace","getMinWidth","linesToKeep","scaleSkewStyleHandler","scaleStyleHandler","objectControls","ml","mr","mb","mtr","textBoxControls"],"sources":["C:/Users/Danil/Desktop/project1/node_modules/@adamjarling/openseadragon-fabricjs-overlay/fabric/fabric.adapted-4.0.0-rc.1-itext-fix.js"],"sourcesContent":["/* build: `node build.js modules=ALL exclude=gestures,accessors requirejs minifier=uglifyjs` */\n/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */\n// Version 4.0.0-rc.1\n\nvar fabric = fabric || { version: \"4.0.0-rc.1\" };\nif (typeof exports !== \"undefined\") {\n  exports.fabric = fabric;\n} else if (typeof define === \"function\" && define.amd) {\n  /* _AMD_START_ */\n  define([], function () {\n    return fabric;\n  });\n}\n/* _AMD_END_ */\nif (typeof document !== \"undefined\" && typeof window !== \"undefined\") {\n  if (\n    document instanceof\n    (typeof HTMLDocument !== \"undefined\" ? HTMLDocument : Document)\n  ) {\n    fabric.document = document;\n  } else {\n    fabric.document = document.implementation.createHTMLDocument(\"\");\n  }\n  fabric.window = window;\n} else {\n  // assume we're running under node.js when document/window are not present\n  var jsdom = require(\"jsdom\");\n  var virtualWindow = new jsdom.JSDOM(\n    decodeURIComponent(\n      \"%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E\"\n    ),\n    {\n      features: {\n        FetchExternalResources: [\"img\"],\n      },\n      resources: \"usable\",\n    }\n  ).window;\n  fabric.document = virtualWindow.document;\n  fabric.jsdomImplForWrapper = require(\"jsdom/lib/jsdom/living/generated/utils\").implForWrapper;\n  fabric.nodeCanvas = require(\"jsdom/lib/jsdom/utils\").Canvas;\n  fabric.window = virtualWindow;\n  DOMParser = fabric.window.DOMParser;\n}\n\n/**\n * True when in environment that supports touch events\n * @type boolean\n */\nfabric.isTouchSupported =\n  \"ontouchstart\" in fabric.window ||\n  \"ontouchstart\" in fabric.document ||\n  (fabric.window &&\n    fabric.window.navigator &&\n    fabric.window.navigator.maxTouchPoints > 0);\n\n/**\n * True when in environment that's probably Node.js\n * @type boolean\n */\nfabric.isLikelyNode =\n  typeof Buffer !== \"undefined\" && typeof window === \"undefined\";\n\n/* _FROM_SVG_START_ */\n/**\n * Attributes parsed from all SVG elements\n * @type array\n */\nfabric.SHARED_ATTRIBUTES = [\n  \"display\",\n  \"transform\",\n  \"fill\",\n  \"fill-opacity\",\n  \"fill-rule\",\n  \"opacity\",\n  \"stroke\",\n  \"stroke-dasharray\",\n  \"stroke-linecap\",\n  \"stroke-dashoffset\",\n  \"stroke-linejoin\",\n  \"stroke-miterlimit\",\n  \"stroke-opacity\",\n  \"stroke-width\",\n  \"id\",\n  \"paint-order\",\n  \"vector-effect\",\n  \"instantiated_by_use\",\n  \"clip-path\",\n];\n/* _FROM_SVG_END_ */\n\n/**\n * Pixel per Inch as a default value set to 96. Can be changed for more realistic conversion.\n */\nfabric.DPI = 96;\nfabric.reNum = \"(?:[-+]?(?:\\\\d+|\\\\d*\\\\.\\\\d+)(?:[eE][-+]?\\\\d+)?)\";\nfabric.rePathCommand = /([-+]?((\\d+\\.\\d+)|((\\d+)|(\\.\\d+)))(?:[eE][-+]?\\d+)?)/gi;\nfabric.reNonWord = /[ \\n\\.,;!\\?\\-]/;\nfabric.fontPaths = {};\nfabric.iMatrix = [1, 0, 0, 1, 0, 0];\nfabric.svgNS = \"http://www.w3.org/2000/svg\";\n\n/**\n * Pixel limit for cache canvases. 1Mpx , 4Mpx should be fine.\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.perfLimitSizeTotal = 2097152;\n\n/**\n * Pixel limit for cache canvases width or height. IE fixes the maximum at 5000\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.maxCacheSideLimit = 4096;\n\n/**\n * Lowest pixel limit for cache canvases, set at 256PX\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.minCacheSideLimit = 256;\n\n/**\n * Cache Object for widths of chars in text rendering.\n */\nfabric.charWidthsCache = {};\n\n/**\n * if webgl is enabled and available, textureSize will determine the size\n * of the canvas backend\n * @since 2.0.0\n * @type Number\n * @default\n */\nfabric.textureSize = 2048;\n\n/**\n * When 'true', style information is not retained when copy/pasting text, making\n * pasted text use destination style.\n * Defaults to 'false'.\n * @type Boolean\n * @default\n */\nfabric.disableStyleCopyPaste = false;\n\n/**\n * Enable webgl for filtering picture is available\n * A filtering backend will be initialized, this will both take memory and\n * time since a default 2048x2048 canvas will be created for the gl context\n * @since 2.0.0\n * @type Boolean\n * @default\n */\nfabric.enableGLFiltering = true;\n\n/**\n * Device Pixel Ratio\n * @see https://developer.apple.com/library/safari/documentation/AudioVideo/Conceptual/HTML-canvas-guide/SettingUptheCanvas/SettingUptheCanvas.html\n */\nfabric.devicePixelRatio =\n  fabric.window.devicePixelRatio ||\n  fabric.window.webkitDevicePixelRatio ||\n  fabric.window.mozDevicePixelRatio ||\n  1;\n/**\n * Browser-specific constant to adjust CanvasRenderingContext2D.shadowBlur value,\n * which is unitless and not rendered equally across browsers.\n *\n * Values that work quite well (as of October 2017) are:\n * - Chrome: 1.5\n * - Edge: 1.75\n * - Firefox: 0.9\n * - Safari: 0.95\n *\n * @since 2.0.0\n * @type Number\n * @default 1\n */\nfabric.browserShadowBlurConstant = 1;\n\n/**\n * This object contains the result of arc to beizer conversion for faster retrieving if the same arc needs to be converted again.\n * It was an internal variable, is accessible since version 2.3.4\n */\nfabric.arcToSegmentsCache = {};\n\n/**\n * This object keeps the results of the boundsOfCurve calculation mapped by the joined arguments necessary to calculate it.\n * It does speed up calculation, if you parse and add always the same paths, but in case of heavy usage of freedrawing\n * you do not get any speed benefit and you get a big object in memory.\n * The object was a private variable before, while now is appended to the lib so that you have access to it and you\n * can eventually clear it.\n * It was an internal variable, is accessible since version 2.3.4\n */\nfabric.boundsOfCurveCache = {};\n\n/**\n * If disabled boundsOfCurveCache is not used. For apps that make heavy usage of pencil drawing probably disabling it is better\n * @default true\n */\nfabric.cachesBoundsOfCurve = true;\n\n/**\n * Skip performance testing of setupGLContext and force the use of putImageData that seems to be the one that works best on\n * Chrome + old hardware. if your users are experiencing empty images after filtering you may try to force this to true\n * this has to be set before instantiating the filtering backend ( before filtering the first image )\n * @type Boolean\n * @default false\n */\nfabric.forceGLPutImageData = false;\n\nfabric.initFilterBackend = function () {\n  if (\n    fabric.enableGLFiltering &&\n    fabric.isWebglSupported &&\n    fabric.isWebglSupported(fabric.textureSize)\n  ) {\n    console.log(\"max texture size: \" + fabric.maxTextureSize);\n    return new fabric.WebglFilterBackend({ tileSize: fabric.textureSize });\n  } else if (fabric.Canvas2dFilterBackend) {\n    return new fabric.Canvas2dFilterBackend();\n  }\n};\n\nif (typeof document !== \"undefined\" && typeof window !== \"undefined\") {\n  // ensure globality even if entire library were function wrapped (as in Meteor.js packaging system)\n  window.fabric = fabric;\n}\n\n(function () {\n  /**\n   * @private\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  function _removeEventListener(eventName, handler) {\n    if (!this.__eventListeners[eventName]) {\n      return;\n    }\n    var eventListener = this.__eventListeners[eventName];\n    if (handler) {\n      eventListener[eventListener.indexOf(handler)] = false;\n    } else {\n      fabric.util.array.fill(eventListener, false);\n    }\n  }\n\n  /**\n   * Observes specified event\n   * @memberOf fabric.Observable\n   * @alias on\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function that receives a notification when an event of the specified type occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function on(eventName, handler) {\n    if (!this.__eventListeners) {\n      this.__eventListeners = {};\n    }\n    // one object with key/value pairs was passed\n    if (arguments.length === 1) {\n      for (var prop in eventName) {\n        this.on(prop, eventName[prop]);\n      }\n    } else {\n      if (!this.__eventListeners[eventName]) {\n        this.__eventListeners[eventName] = [];\n      }\n      this.__eventListeners[eventName].push(handler);\n    }\n    return this;\n  }\n\n  /**\n   * Stops event observing for a particular event handler. Calling this method\n   * without arguments removes all handlers for all events\n   * @memberOf fabric.Observable\n   * @alias off\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function to be deleted from EventListeners\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function off(eventName, handler) {\n    if (!this.__eventListeners) {\n      return this;\n    }\n\n    // remove all key/value pairs (event name -> event handler)\n    if (arguments.length === 0) {\n      for (eventName in this.__eventListeners) {\n        _removeEventListener.call(this, eventName);\n      }\n    }\n    // one object with key/value pairs was passed\n    else if (arguments.length === 1 && typeof arguments[0] === \"object\") {\n      for (var prop in eventName) {\n        _removeEventListener.call(this, prop, eventName[prop]);\n      }\n    } else {\n      _removeEventListener.call(this, eventName, handler);\n    }\n    return this;\n  }\n\n  /**\n   * Fires event with an optional options object\n   * @memberOf fabric.Observable\n   * @param {String} eventName Event name to fire\n   * @param {Object} [options] Options object\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function fire(eventName, options) {\n    if (!this.__eventListeners) {\n      return this;\n    }\n\n    var listenersForEvent = this.__eventListeners[eventName];\n    if (!listenersForEvent) {\n      return this;\n    }\n\n    for (var i = 0, len = listenersForEvent.length; i < len; i++) {\n      listenersForEvent[i] && listenersForEvent[i].call(this, options || {});\n    }\n    this.__eventListeners[eventName] = listenersForEvent.filter(function (\n      value\n    ) {\n      return value !== false;\n    });\n    return this;\n  }\n\n  /**\n   * @namespace fabric.Observable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#events}\n   * @see {@link http://fabricjs.com/events|Events demo}\n   */\n  fabric.Observable = {\n    fire: fire,\n    on: on,\n    off: off,\n  };\n})();\n\n/**\n * @namespace fabric.Collection\n */\nfabric.Collection = {\n  _objects: [],\n\n  /**\n   * Adds objects to collection, Canvas or Group, then renders canvas\n   * (if `renderOnAddRemove` is not `false`).\n   * in case of Group no changes to bounding box are made.\n   * Objects should be instances of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the add method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  add: function () {\n    this._objects.push.apply(this._objects, arguments);\n    if (this._onObjectAdded) {\n      for (var i = 0, length = arguments.length; i < length; i++) {\n        this._onObjectAdded(arguments[i]);\n      }\n    }\n    this.renderOnAddRemove && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Inserts an object into collection at specified index, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * An object should be an instance of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the insertAt method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {Object} object Object to insert\n   * @param {Number} index Index to insert object at\n   * @param {Boolean} nonSplicing When `true`, no splicing (shifting) of objects occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  insertAt: function (object, index, nonSplicing) {\n    var objects = this._objects;\n    if (nonSplicing) {\n      objects[index] = object;\n    } else {\n      objects.splice(index, 0, object);\n    }\n    this._onObjectAdded && this._onObjectAdded(object);\n    this.renderOnAddRemove && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Removes objects from a collection, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  remove: function () {\n    var objects = this._objects,\n      index,\n      somethingRemoved = false;\n\n    for (var i = 0, length = arguments.length; i < length; i++) {\n      index = objects.indexOf(arguments[i]);\n\n      // only call onObjectRemoved if an object was actually removed\n      if (index !== -1) {\n        somethingRemoved = true;\n        objects.splice(index, 1);\n        this._onObjectRemoved && this._onObjectRemoved(arguments[i]);\n      }\n    }\n\n    this.renderOnAddRemove && somethingRemoved && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Executes given function for each object in this group\n   * @param {Function} callback\n   *                   Callback invoked with current object as first argument,\n   *                   index - as second and an array of all objects - as third.\n   *                   Callback is invoked in a context of Global Object (e.g. `window`)\n   *                   when no `context` argument is given\n   *\n   * @param {Object} context Context (aka thisObject)\n   * @return {Self} thisArg\n   * @chainable\n   */\n  forEachObject: function (callback, context) {\n    var objects = this.getObjects();\n    for (var i = 0, len = objects.length; i < len; i++) {\n      callback.call(context, objects[i], i, objects);\n    }\n    return this;\n  },\n\n  /**\n   * Returns an array of children objects of this instance\n   * Type parameter introduced in 1.3.10\n   * since 2.3.5 this method return always a COPY of the array;\n   * @param {String} [type] When specified, only objects of this type are returned\n   * @return {Array}\n   */\n  getObjects: function (type) {\n    if (typeof type === \"undefined\") {\n      return this._objects.concat();\n    }\n    return this._objects.filter(function (o) {\n      return o.type === type;\n    });\n  },\n\n  /**\n   * Returns object at specified index\n   * @param {Number} index\n   * @return {Self} thisArg\n   */\n  item: function (index) {\n    return this._objects[index];\n  },\n\n  /**\n   * Returns true if collection contains no objects\n   * @return {Boolean} true if collection is empty\n   */\n  isEmpty: function () {\n    return this._objects.length === 0;\n  },\n\n  /**\n   * Returns a size of a collection (i.e: length of an array containing its objects)\n   * @return {Number} Collection size\n   */\n  size: function () {\n    return this._objects.length;\n  },\n\n  /**\n   * Returns true if collection contains an object\n   * @param {Object} object Object to check against\n   * @return {Boolean} `true` if collection contains an object\n   */\n  contains: function (object) {\n    return this._objects.indexOf(object) > -1;\n  },\n\n  /**\n   * Returns number representation of a collection complexity\n   * @return {Number} complexity\n   */\n  complexity: function () {\n    return this._objects.reduce(function (memo, current) {\n      memo += current.complexity ? current.complexity() : 0;\n      return memo;\n    }, 0);\n  },\n};\n\n/**\n * @namespace fabric.CommonMethods\n */\nfabric.CommonMethods = {\n  /**\n   * Sets object's properties from options\n   * @param {Object} [options] Options object\n   */\n  _setOptions: function (options) {\n    for (var prop in options) {\n      this.set(prop, options[prop]);\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Gradient to\n   */\n  _initGradient: function (filler, property) {\n    if (filler && filler.colorStops && !(filler instanceof fabric.Gradient)) {\n      this.set(property, new fabric.Gradient(filler));\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Pattern to\n   * @param {Function} [callback] callback to invoke after pattern load\n   */\n  _initPattern: function (filler, property, callback) {\n    if (filler && filler.source && !(filler instanceof fabric.Pattern)) {\n      this.set(property, new fabric.Pattern(filler, callback));\n    } else {\n      callback && callback();\n    }\n  },\n\n  /**\n   * @private\n   */\n  _setObject: function (obj) {\n    for (var prop in obj) {\n      this._set(prop, obj[prop]);\n    }\n  },\n\n  /**\n   * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n   * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n   * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  set: function (key, value) {\n    if (typeof key === \"object\") {\n      this._setObject(key);\n    } else {\n      this._set(key, value);\n    }\n    return this;\n  },\n\n  _set: function (key, value) {\n    this[key] = value;\n  },\n\n  /**\n   * Toggles specified property from `true` to `false` or from `false` to `true`\n   * @param {String} property Property to toggle\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  toggle: function (property) {\n    var value = this.get(property);\n    if (typeof value === \"boolean\") {\n      this.set(property, !value);\n    }\n    return this;\n  },\n\n  /**\n   * Basic getter\n   * @param {String} property Property name\n   * @return {*} value of a property\n   */\n  get: function (property) {\n    return this[property];\n  },\n};\n\n(function (global) {\n  var sqrt = Math.sqrt,\n    atan2 = Math.atan2,\n    pow = Math.pow,\n    PiBy180 = Math.PI / 180,\n    PiBy2 = Math.PI / 2;\n\n  /**\n   * @namespace fabric.util\n   */\n  fabric.util = {\n    /**\n     * Calculate the cos of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */\n    cos: function (angle) {\n      if (angle === 0) {\n        return 1;\n      }\n      if (angle < 0) {\n        // cos(a) = cos(-a)\n        angle = -angle;\n      }\n      var angleSlice = angle / PiBy2;\n      switch (angleSlice) {\n        case 1:\n        case 3:\n          return 0;\n        case 2:\n          return -1;\n      }\n      return Math.cos(angle);\n    },\n\n    /**\n     * Calculate the sin of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */\n    sin: function (angle) {\n      if (angle === 0) {\n        return 0;\n      }\n      var angleSlice = angle / PiBy2,\n        sign = 1;\n      if (angle < 0) {\n        // sin(-a) = -sin(a)\n        sign = -1;\n      }\n      switch (angleSlice) {\n        case 1:\n          return sign;\n        case 2:\n          return 0;\n        case 3:\n          return -sign;\n      }\n      return Math.sin(angle);\n    },\n\n    /**\n     * Removes value from an array.\n     * Presence of value (and its position in an array) is determined via `Array.prototype.indexOf`\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} array\n     * @param {*} value\n     * @return {Array} original array\n     */\n    removeFromArray: function (array, value) {\n      var idx = array.indexOf(value);\n      if (idx !== -1) {\n        array.splice(idx, 1);\n      }\n      return array;\n    },\n\n    /**\n     * Returns random number between 2 specified ones.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} min lower limit\n     * @param {Number} max upper limit\n     * @return {Number} random value (between min and max)\n     */\n    getRandomInt: function (min, max) {\n      return Math.floor(Math.random() * (max - min + 1)) + min;\n    },\n\n    /**\n     * Transforms degrees to radians.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} degrees value in degrees\n     * @return {Number} value in radians\n     */\n    degreesToRadians: function (degrees) {\n      return degrees * PiBy180;\n    },\n\n    /**\n     * Transforms radians to degrees.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} radians value in radians\n     * @return {Number} value in degrees\n     */\n    radiansToDegrees: function (radians) {\n      return radians / PiBy180;\n    },\n\n    /**\n     * Rotates `point` around `origin` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {fabric.Point} point The point to rotate\n     * @param {fabric.Point} origin The origin of the rotation\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {fabric.Point} The new rotated point\n     */\n    rotatePoint: function (point, origin, radians) {\n      point.subtractEquals(origin);\n      var v = fabric.util.rotateVector(point, radians);\n      return new fabric.Point(v.x, v.y).addEquals(origin);\n    },\n\n    /**\n     * Rotates `vector` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} vector The vector to rotate (x and y)\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {Object} The new rotated point\n     */\n    rotateVector: function (vector, radians) {\n      var sin = fabric.util.sin(radians),\n        cos = fabric.util.cos(radians),\n        rx = vector.x * cos - vector.y * sin,\n        ry = vector.x * sin + vector.y * cos;\n      return {\n        x: rx,\n        y: ry,\n      };\n    },\n\n    /**\n     * Apply transform t to point p\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Point} p The point to transform\n     * @param  {Array} t The transform\n     * @param  {Boolean} [ignoreOffset] Indicates that the offset should not be applied\n     * @return {fabric.Point} The transformed point\n     */\n    transformPoint: function (p, t, ignoreOffset) {\n      if (ignoreOffset) {\n        return new fabric.Point(\n          t[0] * p.x + t[2] * p.y,\n          t[1] * p.x + t[3] * p.y\n        );\n      }\n      return new fabric.Point(\n        t[0] * p.x + t[2] * p.y + t[4],\n        t[1] * p.x + t[3] * p.y + t[5]\n      );\n    },\n\n    /**\n     * Returns coordinates of points's bounding rectangle (left, top, width, height)\n     * @param {Array} points 4 points array\n     * @param {Array} [transform] an array of 6 numbers representing a 2x3 transform matrix\n     * @return {Object} Object with left, top, width, height properties\n     */\n    makeBoundingBoxFromPoints: function (points, transform) {\n      if (transform) {\n        for (var i = 0; i < points.length; i++) {\n          points[i] = fabric.util.transformPoint(points[i], transform);\n        }\n      }\n      var xPoints = [points[0].x, points[1].x, points[2].x, points[3].x],\n        minX = fabric.util.array.min(xPoints),\n        maxX = fabric.util.array.max(xPoints),\n        width = maxX - minX,\n        yPoints = [points[0].y, points[1].y, points[2].y, points[3].y],\n        minY = fabric.util.array.min(yPoints),\n        maxY = fabric.util.array.max(yPoints),\n        height = maxY - minY;\n\n      return {\n        left: minX,\n        top: minY,\n        width: width,\n        height: height,\n      };\n    },\n\n    /**\n     * Invert transformation t\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} t The transform\n     * @return {Array} The inverted transform\n     */\n    invertTransform: function (t) {\n      var a = 1 / (t[0] * t[3] - t[1] * t[2]),\n        r = [a * t[3], -a * t[1], -a * t[2], a * t[0]],\n        o = fabric.util.transformPoint({ x: t[4], y: t[5] }, r, true);\n      r[4] = -o.x;\n      r[5] = -o.y;\n      return r;\n    },\n\n    /**\n     * A wrapper around Number#toFixed, which contrary to native method returns number, not string.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number|String} number number to operate on\n     * @param {Number} fractionDigits number of fraction digits to \"leave\"\n     * @return {Number}\n     */\n    toFixed: function (number, fractionDigits) {\n      return parseFloat(Number(number).toFixed(fractionDigits));\n    },\n\n    /**\n     * Converts from attribute value to pixel value if applicable.\n     * Returns converted pixels or original value not converted.\n     * @param {Number|String} value number to operate on\n     * @param {Number} fontSize\n     * @return {Number|String}\n     */\n    parseUnit: function (value, fontSize) {\n      var unit = /\\D{0,2}$/.exec(value),\n        number = parseFloat(value);\n      if (!fontSize) {\n        fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      }\n      switch (unit[0]) {\n        case \"mm\":\n          return (number * fabric.DPI) / 25.4;\n\n        case \"cm\":\n          return (number * fabric.DPI) / 2.54;\n\n        case \"in\":\n          return number * fabric.DPI;\n\n        case \"pt\":\n          return (number * fabric.DPI) / 72; // or * 4 / 3\n\n        case \"pc\":\n          return ((number * fabric.DPI) / 72) * 12; // or * 16\n\n        case \"em\":\n          return number * fontSize;\n\n        default:\n          return number;\n      }\n    },\n\n    /**\n     * Function which always returns `false`.\n     * @static\n     * @memberOf fabric.util\n     * @return {Boolean}\n     */\n    falseFunction: function () {\n      return false;\n    },\n\n    /**\n     * Returns klass \"Class\" object of given namespace\n     * @memberOf fabric.util\n     * @param {String} type Type of object (eg. 'circle')\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @return {Object} klass \"Class\"\n     */\n    getKlass: function (type, namespace) {\n      // capitalize first letter only\n      type = fabric.util.string.camelize(\n        type.charAt(0).toUpperCase() + type.slice(1)\n      );\n      return fabric.util.resolveNamespace(namespace)[type];\n    },\n\n    /**\n     * Returns array of attributes for given svg that fabric parses\n     * @memberOf fabric.util\n     * @param {String} type Type of svg element (eg. 'circle')\n     * @return {Array} string names of supported attributes\n     */\n    getSvgAttributes: function (type) {\n      var attributes = [\"instantiated_by_use\", \"style\", \"id\", \"class\"];\n      switch (type) {\n        case \"linearGradient\":\n          attributes = attributes.concat([\n            \"x1\",\n            \"y1\",\n            \"x2\",\n            \"y2\",\n            \"gradientUnits\",\n            \"gradientTransform\",\n          ]);\n          break;\n        case \"radialGradient\":\n          attributes = attributes.concat([\n            \"gradientUnits\",\n            \"gradientTransform\",\n            \"cx\",\n            \"cy\",\n            \"r\",\n            \"fx\",\n            \"fy\",\n            \"fr\",\n          ]);\n          break;\n        case \"stop\":\n          attributes = attributes.concat([\n            \"offset\",\n            \"stop-color\",\n            \"stop-opacity\",\n          ]);\n          break;\n      }\n      return attributes;\n    },\n\n    /**\n     * Returns object of given namespace\n     * @memberOf fabric.util\n     * @param {String} namespace Namespace string e.g. 'fabric.Image.filter' or 'fabric'\n     * @return {Object} Object for given namespace (default fabric)\n     */\n    resolveNamespace: function (namespace) {\n      if (!namespace) {\n        return fabric;\n      }\n\n      var parts = namespace.split(\".\"),\n        len = parts.length,\n        i,\n        obj = global || fabric.window;\n\n      for (i = 0; i < len; ++i) {\n        obj = obj[parts[i]];\n      }\n\n      return obj;\n    },\n\n    /**\n     * Loads image element from given url and passes it to a callback\n     * @memberOf fabric.util\n     * @param {String} url URL representing an image\n     * @param {Function} callback Callback; invoked with loaded image\n     * @param {*} [context] Context to invoke callback in\n     * @param {Object} [crossOrigin] crossOrigin value to set image element to\n     */\n    loadImage: function (url, callback, context, crossOrigin) {\n      if (!url) {\n        callback && callback.call(context, url);\n        return;\n      }\n\n      var img = fabric.util.createImage();\n\n      /** @ignore */\n      var onLoadCallback = function () {\n        callback && callback.call(context, img, false);\n        img = img.onload = img.onerror = null;\n      };\n\n      img.onload = onLoadCallback;\n      /** @ignore */\n      img.onerror = function () {\n        fabric.log(\"Error loading \" + img.src);\n        callback && callback.call(context, null, true);\n        img = img.onload = img.onerror = null;\n      };\n\n      // data-urls appear to be buggy with crossOrigin\n      // https://github.com/kangax/fabric.js/commit/d0abb90f1cd5c5ef9d2a94d3fb21a22330da3e0a#commitcomment-4513767\n      // see https://code.google.com/p/chromium/issues/detail?id=315152\n      //     https://bugzilla.mozilla.org/show_bug.cgi?id=935069\n      // crossOrigin null is the same as not set.\n      if (\n        url.indexOf(\"data\") !== 0 &&\n        crossOrigin !== undefined &&\n        crossOrigin !== null\n      ) {\n        img.crossOrigin = crossOrigin;\n      }\n\n      // IE10 / IE11-Fix: SVG contents from data: URI\n      // will only be available if the IMG is present\n      // in the DOM (and visible)\n      if (url.substring(0, 14) === \"data:image/svg\") {\n        img.onload = null;\n        fabric.util.loadImageInDom(img, onLoadCallback);\n      }\n\n      img.src = url;\n    },\n\n    /**\n     * Attaches SVG image with data: URL to the dom\n     * @memberOf fabric.util\n     * @param {Object} img Image object with data:image/svg src\n     * @param {Function} callback Callback; invoked with loaded image\n     * @return {Object} DOM element (div containing the SVG image)\n     */\n    loadImageInDom: function (img, onLoadCallback) {\n      var div = fabric.document.createElement(\"div\");\n      div.style.width = div.style.height = \"1px\";\n      div.style.left = div.style.top = \"-100%\";\n      div.style.position = \"absolute\";\n      div.appendChild(img);\n      fabric.document.querySelector(\"body\").appendChild(div);\n      /**\n       * Wrap in function to:\n       *   1. Call existing callback\n       *   2. Cleanup DOM\n       */\n      img.onload = function () {\n        onLoadCallback();\n        div.parentNode.removeChild(div);\n        div = null;\n      };\n    },\n\n    /**\n     * Creates corresponding fabric instances from their object representations\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} objects Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @param {Function} reviver Method for further parsing of object elements,\n     * called after each fabric object created.\n     */\n    enlivenObjects: function (objects, callback, namespace, reviver) {\n      objects = objects || [];\n\n      var enlivenedObjects = [],\n        numLoadedObjects = 0,\n        numTotalObjects = objects.length;\n\n      function onLoaded() {\n        if (++numLoadedObjects === numTotalObjects) {\n          callback &&\n            callback(\n              enlivenedObjects.filter(function (obj) {\n                // filter out undefined objects (objects that gave error)\n                return obj;\n              })\n            );\n        }\n      }\n\n      if (!numTotalObjects) {\n        callback && callback(enlivenedObjects);\n        return;\n      }\n\n      objects.forEach(function (o, index) {\n        // if sparse array\n        if (!o || !o.type) {\n          onLoaded();\n          return;\n        }\n        var klass = fabric.util.getKlass(o.type, namespace);\n        klass.fromObject(o, function (obj, error) {\n          error || (enlivenedObjects[index] = obj);\n          reviver && reviver(o, obj, error);\n          onLoaded();\n        });\n      });\n    },\n\n    /**\n     * Create and wait for loading of patterns\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} patterns Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * called after each fabric object created.\n     */\n    enlivenPatterns: function (patterns, callback) {\n      patterns = patterns || [];\n\n      function onLoaded() {\n        if (++numLoadedPatterns === numPatterns) {\n          callback && callback(enlivenedPatterns);\n        }\n      }\n\n      var enlivenedPatterns = [],\n        numLoadedPatterns = 0,\n        numPatterns = patterns.length;\n\n      if (!numPatterns) {\n        callback && callback(enlivenedPatterns);\n        return;\n      }\n\n      patterns.forEach(function (p, index) {\n        if (p && p.source) {\n          new fabric.Pattern(p, function (pattern) {\n            enlivenedPatterns[index] = pattern;\n            onLoaded();\n          });\n        } else {\n          enlivenedPatterns[index] = p;\n          onLoaded();\n        }\n      });\n    },\n\n    /**\n     * Groups SVG elements (usually those retrieved from SVG document)\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} elements SVG elements to group\n     * @param {Object} [options] Options object\n     * @param {String} path Value to set sourcePath to\n     * @return {fabric.Object|fabric.Group}\n     */\n    groupSVGElements: function (elements, options, path) {\n      var object;\n      if (elements && elements.length === 1) {\n        return elements[0];\n      }\n      if (options) {\n        if (options.width && options.height) {\n          options.centerPoint = {\n            x: options.width / 2,\n            y: options.height / 2,\n          };\n        } else {\n          delete options.width;\n          delete options.height;\n        }\n      }\n      object = new fabric.Group(elements, options);\n      if (typeof path !== \"undefined\") {\n        object.sourcePath = path;\n      }\n      return object;\n    },\n\n    /**\n     * Populates an object with properties of another object\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} source Source object\n     * @param {Object} destination Destination object\n     * @return {Array} properties Properties names to include\n     */\n    populateWithProperties: function (source, destination, properties) {\n      if (\n        properties &&\n        Object.prototype.toString.call(properties) === \"[object Array]\"\n      ) {\n        for (var i = 0, len = properties.length; i < len; i++) {\n          if (properties[i] in source) {\n            destination[properties[i]] = source[properties[i]];\n          }\n        }\n      }\n    },\n\n    /**\n     * Draws a dashed line between two points\n     *\n     * This method is used to draw dashed line around selection area.\n     * See <a href=\"http://stackoverflow.com/questions/4576724/dotted-stroke-in-canvas\">dotted stroke in canvas</a>\n     *\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x  start x coordinate\n     * @param {Number} y start y coordinate\n     * @param {Number} x2 end x coordinate\n     * @param {Number} y2 end y coordinate\n     * @param {Array} da dash array pattern\n     */\n    drawDashedLine: function (ctx, x, y, x2, y2, da) {\n      var dx = x2 - x,\n        dy = y2 - y,\n        len = sqrt(dx * dx + dy * dy),\n        rot = atan2(dy, dx),\n        dc = da.length,\n        di = 0,\n        draw = true;\n\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.moveTo(0, 0);\n      ctx.rotate(rot);\n\n      x = 0;\n      while (len > x) {\n        x += da[di++ % dc];\n        if (x > len) {\n          x = len;\n        }\n        ctx[draw ? \"lineTo\" : \"moveTo\"](x, 0);\n        draw = !draw;\n      }\n\n      ctx.restore();\n    },\n\n    /**\n     * Creates canvas element\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */\n    createCanvasElement: function () {\n      return fabric.document.createElement(\"canvas\");\n    },\n\n    /**\n     * Creates a canvas element that is a copy of another and is also painted\n     * @param {CanvasElement} canvas to copy size and content of\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */\n    copyCanvasElement: function (canvas) {\n      var newCanvas = fabric.util.createCanvasElement();\n      newCanvas.width = canvas.width;\n      newCanvas.height = canvas.height;\n      newCanvas.getContext(\"2d\").drawImage(canvas, 0, 0);\n      return newCanvas;\n    },\n\n    /**\n     * since 2.6.0 moved from canvas instance to utility.\n     * @param {CanvasElement} canvasEl to copy size and content of\n     * @param {String} format 'jpeg' or 'png', in some browsers 'webp' is ok too\n     * @param {Number} quality <= 1 and > 0\n     * @static\n     * @memberOf fabric.util\n     * @return {String} data url\n     */\n    toDataURL: function (canvasEl, format, quality) {\n      return canvasEl.toDataURL(\"image/\" + format, quality);\n    },\n\n    /**\n     * Creates image element (works on client and node)\n     * @static\n     * @memberOf fabric.util\n     * @return {HTMLImageElement} HTML image element\n     */\n    createImage: function () {\n      return fabric.document.createElement(\"img\");\n    },\n\n    /**\n     * Multiply matrix A by matrix B to nest transformations\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a First transformMatrix\n     * @param  {Array} b Second transformMatrix\n     * @param  {Boolean} is2x2 flag to multiply matrices as 2x2 matrices\n     * @return {Array} The product of the two transform matrices\n     */\n    multiplyTransformMatrices: function (a, b, is2x2) {\n      // Matrix multiply a * b\n      return [\n        a[0] * b[0] + a[2] * b[1],\n        a[1] * b[0] + a[3] * b[1],\n        a[0] * b[2] + a[2] * b[3],\n        a[1] * b[2] + a[3] * b[3],\n        is2x2 ? 0 : a[0] * b[4] + a[2] * b[5] + a[4],\n        is2x2 ? 0 : a[1] * b[4] + a[3] * b[5] + a[5],\n      ];\n    },\n\n    /**\n     * Decomposes standard 2x3 matrix into transform components\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a transformMatrix\n     * @return {Object} Components of transform\n     */\n    qrDecompose: function (a) {\n      var angle = atan2(a[1], a[0]),\n        denom = pow(a[0], 2) + pow(a[1], 2),\n        scaleX = sqrt(denom),\n        scaleY = (a[0] * a[3] - a[2] * a[1]) / scaleX,\n        skewX = atan2(a[0] * a[2] + a[1] * a[3], denom);\n      return {\n        angle: angle / PiBy180,\n        scaleX: scaleX,\n        scaleY: scaleY,\n        skewX: skewX / PiBy180,\n        skewY: 0,\n        translateX: a[4],\n        translateY: a[5],\n      };\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.angle] angle in degrees\n     * @return {Number[]} transform matrix\n     */\n    calcRotateMatrix: function (options) {\n      if (!options.angle) {\n        return fabric.iMatrix.concat();\n      }\n      var theta = fabric.util.degreesToRadians(options.angle),\n        cos = fabric.util.cos(theta),\n        sin = fabric.util.sin(theta);\n      return [cos, sin, -sin, cos, 0, 0];\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet.\n     * is called DimensionsTransformMatrix because those properties are the one that influence\n     * the size of the resulting box of the object.\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.scaleX]\n     * @param  {Number} [options.scaleY]\n     * @param  {Boolean} [options.flipX]\n     * @param  {Boolean} [options.flipY]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.skewX]\n     * @return {Number[]} transform matrix\n     */\n    calcDimensionsMatrix: function (options) {\n      var scaleX = typeof options.scaleX === \"undefined\" ? 1 : options.scaleX,\n        scaleY = typeof options.scaleY === \"undefined\" ? 1 : options.scaleY,\n        scaleMatrix = [\n          options.flipX ? -scaleX : scaleX,\n          0,\n          0,\n          options.flipY ? -scaleY : scaleY,\n          0,\n          0,\n        ],\n        multiply = fabric.util.multiplyTransformMatrices,\n        degreesToRadians = fabric.util.degreesToRadians;\n      if (options.skewX) {\n        scaleMatrix = multiply(\n          scaleMatrix,\n          [1, 0, Math.tan(degreesToRadians(options.skewX)), 1],\n          true\n        );\n      }\n      if (options.skewY) {\n        scaleMatrix = multiply(\n          scaleMatrix,\n          [1, Math.tan(degreesToRadians(options.skewY)), 0, 1],\n          true\n        );\n      }\n      return scaleMatrix;\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.angle]\n     * @param  {Number} [options.scaleX]\n     * @param  {Number} [options.scaleY]\n     * @param  {Boolean} [options.flipX]\n     * @param  {Boolean} [options.flipY]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.translateX]\n     * @param  {Number} [options.translateY]\n     * @return {Number[]} transform matrix\n     */\n    composeMatrix: function (options) {\n      var matrix = [\n          1,\n          0,\n          0,\n          1,\n          options.translateX || 0,\n          options.translateY || 0,\n        ],\n        multiply = fabric.util.multiplyTransformMatrices;\n      if (options.angle) {\n        matrix = multiply(matrix, fabric.util.calcRotateMatrix(options));\n      }\n      if (\n        options.scaleX !== 1 ||\n        options.scaleY !== 1 ||\n        options.skewX ||\n        options.skewY ||\n        options.flipX ||\n        options.flipY\n      ) {\n        matrix = multiply(matrix, fabric.util.calcDimensionsMatrix(options));\n      }\n      return matrix;\n    },\n\n    /**\n     * reset an object transform state to neutral. Top and left are not accounted for\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to transform\n     */\n    resetObjectTransform: function (target) {\n      target.scaleX = 1;\n      target.scaleY = 1;\n      target.skewX = 0;\n      target.skewY = 0;\n      target.flipX = false;\n      target.flipY = false;\n      target.rotate(0);\n    },\n\n    /**\n     * Extract Object transform values\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to read from\n     * @return {Object} Components of transform\n     */\n    saveObjectTransform: function (target) {\n      return {\n        scaleX: target.scaleX,\n        scaleY: target.scaleY,\n        skewX: target.skewX,\n        skewY: target.skewY,\n        angle: target.angle,\n        left: target.left,\n        flipX: target.flipX,\n        flipY: target.flipY,\n        top: target.top,\n      };\n    },\n\n    /**\n     * Returns true if context has transparent pixel\n     * at specified location (taking tolerance into account)\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x x coordinate\n     * @param {Number} y y coordinate\n     * @param {Number} tolerance Tolerance\n     */\n    isTransparent: function (ctx, x, y, tolerance) {\n      // If tolerance is > 0 adjust start coords to take into account.\n      // If moves off Canvas fix to 0\n      if (tolerance > 0) {\n        if (x > tolerance) {\n          x -= tolerance;\n        } else {\n          x = 0;\n        }\n        if (y > tolerance) {\n          y -= tolerance;\n        } else {\n          y = 0;\n        }\n      }\n\n      var _isTransparent = true,\n        i,\n        temp,\n        imageData = ctx.getImageData(\n          x,\n          y,\n          tolerance * 2 || 1,\n          tolerance * 2 || 1\n        ),\n        l = imageData.data.length;\n\n      // Split image data - for tolerance > 1, pixelDataSize = 4;\n      for (i = 3; i < l; i += 4) {\n        temp = imageData.data[i];\n        _isTransparent = temp <= 0;\n        if (_isTransparent === false) {\n          break; // Stop if colour found\n        }\n      }\n\n      imageData = null;\n\n      return _isTransparent;\n    },\n\n    /**\n     * Parse preserveAspectRatio attribute from element\n     * @param {string} attribute to be parsed\n     * @return {Object} an object containing align and meetOrSlice attribute\n     */\n    parsePreserveAspectRatioAttribute: function (attribute) {\n      var meetOrSlice = \"meet\",\n        alignX = \"Mid\",\n        alignY = \"Mid\",\n        aspectRatioAttrs = attribute.split(\" \"),\n        align;\n\n      if (aspectRatioAttrs && aspectRatioAttrs.length) {\n        meetOrSlice = aspectRatioAttrs.pop();\n        if (meetOrSlice !== \"meet\" && meetOrSlice !== \"slice\") {\n          align = meetOrSlice;\n          meetOrSlice = \"meet\";\n        } else if (aspectRatioAttrs.length) {\n          align = aspectRatioAttrs.pop();\n        }\n      }\n      //divide align in alignX and alignY\n      alignX = align !== \"none\" ? align.slice(1, 4) : \"none\";\n      alignY = align !== \"none\" ? align.slice(5, 8) : \"none\";\n      return {\n        meetOrSlice: meetOrSlice,\n        alignX: alignX,\n        alignY: alignY,\n      };\n    },\n\n    /**\n     * Clear char widths cache for the given font family or all the cache if no\n     * fontFamily is specified.\n     * Use it if you know you are loading fonts in a lazy way and you are not waiting\n     * for custom fonts to load properly when adding text objects to the canvas.\n     * If a text object is added when its own font is not loaded yet, you will get wrong\n     * measurement and so wrong bounding boxes.\n     * After the font cache is cleared, either change the textObject text content or call\n     * initDimensions() to trigger a recalculation\n     * @memberOf fabric.util\n     * @param {String} [fontFamily] font family to clear\n     */\n    clearFabricFontCache: function (fontFamily) {\n      fontFamily = (fontFamily || \"\").toLowerCase();\n      if (!fontFamily) {\n        fabric.charWidthsCache = {};\n      } else if (fabric.charWidthsCache[fontFamily]) {\n        delete fabric.charWidthsCache[fontFamily];\n      }\n    },\n\n    /**\n     * Given current aspect ratio, determines the max width and height that can\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Number} ar aspect ratio\n     * @param {Number} maximumArea Maximum area you want to achieve\n     * @return {Object.x} Limited dimensions by X\n     * @return {Object.y} Limited dimensions by Y\n     */\n    limitDimsByArea: function (ar, maximumArea) {\n      var roughWidth = Math.sqrt(maximumArea * ar),\n        perfLimitSizeY = Math.floor(maximumArea / roughWidth);\n      return { x: Math.floor(roughWidth), y: perfLimitSizeY };\n    },\n\n    capValue: function (min, value, max) {\n      return Math.max(min, Math.min(value, max));\n    },\n\n    /**\n     * Finds the scale for the object source to fit inside the object destination,\n     * keeping aspect ratio intact.\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Object | fabric.Object} source\n     * @param {Number} source.height natural unscaled height of the object\n     * @param {Number} source.width natural unscaled width of the object\n     * @param {Object | fabric.Object} destination\n     * @param {Number} destination.height natural unscaled height of the object\n     * @param {Number} destination.width natural unscaled width of the object\n     * @return {Number} scale factor to apply to source to fit into destination\n     */\n    findScaleToFit: function (source, destination) {\n      return Math.min(\n        destination.width / source.width,\n        destination.height / source.height\n      );\n    },\n\n    /**\n     * Finds the scale for the object source to cover entirely the object destination,\n     * keeping aspect ratio intact.\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Object | fabric.Object} source\n     * @param {Number} source.height natural unscaled height of the object\n     * @param {Number} source.width natural unscaled width of the object\n     * @param {Object | fabric.Object} destination\n     * @param {Number} destination.height natural unscaled height of the object\n     * @param {Number} destination.width natural unscaled width of the object\n     * @return {Number} scale factor to apply to source to cover destination\n     */\n    findScaleToCover: function (source, destination) {\n      return Math.max(\n        destination.width / source.width,\n        destination.height / source.height\n      );\n    },\n\n    /**\n     * given an array of 6 number returns something like `\"matrix(...numbers)\"`\n     * @memberOf fabric.util\n     * @param {Array} trasnform an array with 6 numbers\n     * @return {String} transform matrix for svg\n     * @return {Object.y} Limited dimensions by Y\n     */\n    matrixToSVG: function (transform) {\n      return (\n        \"matrix(\" +\n        transform\n          .map(function (value) {\n            return fabric.util.toFixed(\n              value,\n              fabric.Object.NUM_FRACTION_DIGITS\n            );\n          })\n          .join(\" \") +\n        \")\"\n      );\n    },\n\n    /**\n     * given a width and height, return the size of the bounding box\n     * that can contains the box with width/height with applied transform\n     * described in options.\n     * Use to calculate the boxes around objects for controls.\n     * @memberOf fabric.util\n     * @param {Number} width\n     * @param {Number} height\n     * @param {Object} options\n     * @param {Number} options.scaleX\n     * @param {Number} options.scaleY\n     * @param {Number} options.skewX\n     * @param {Number} options.skewY\n     * @return {Object.x} width of containing\n     * @return {Object.y} height of containing\n     */\n    sizeAfterTransform: function (width, height, options) {\n      var dimX = width / 2,\n        dimY = height / 2,\n        points = [\n          {\n            x: -dimX,\n            y: -dimY,\n          },\n          {\n            x: dimX,\n            y: -dimY,\n          },\n          {\n            x: -dimX,\n            y: dimY,\n          },\n          {\n            x: dimX,\n            y: dimY,\n          },\n        ],\n        transformMatrix = fabric.util.calcDimensionsMatrix(options),\n        bbox = fabric.util.makeBoundingBoxFromPoints(points, transformMatrix);\n      return {\n        x: bbox.width,\n        y: bbox.height,\n      };\n    },\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function () {\n  var _join = Array.prototype.join;\n\n  /* Adapted from http://dxr.mozilla.org/mozilla-central/source/content/svg/content/src/nsSVGPathDataParser.cpp\n   * by Andrea Bogazzi code is under MPL. if you don't have a copy of the license you can take it here\n   * http://mozilla.org/MPL/2.0/\n   */\n  function arcToSegments(toX, toY, rx, ry, large, sweep, rotateX) {\n    var argsString = _join.call(arguments);\n    if (fabric.arcToSegmentsCache[argsString]) {\n      return fabric.arcToSegmentsCache[argsString];\n    }\n\n    var PI = Math.PI,\n      th = (rotateX * PI) / 180,\n      sinTh = fabric.util.sin(th),\n      cosTh = fabric.util.cos(th),\n      fromX = 0,\n      fromY = 0;\n\n    rx = Math.abs(rx);\n    ry = Math.abs(ry);\n\n    var px = -cosTh * toX * 0.5 - sinTh * toY * 0.5,\n      py = -cosTh * toY * 0.5 + sinTh * toX * 0.5,\n      rx2 = rx * rx,\n      ry2 = ry * ry,\n      py2 = py * py,\n      px2 = px * px,\n      pl = rx2 * ry2 - rx2 * py2 - ry2 * px2,\n      root = 0;\n\n    if (pl < 0) {\n      var s = Math.sqrt(1 - pl / (rx2 * ry2));\n      rx *= s;\n      ry *= s;\n    } else {\n      root =\n        (large === sweep ? -1.0 : 1.0) *\n        Math.sqrt(pl / (rx2 * py2 + ry2 * px2));\n    }\n\n    var cx = (root * rx * py) / ry,\n      cy = (-root * ry * px) / rx,\n      cx1 = cosTh * cx - sinTh * cy + toX * 0.5,\n      cy1 = sinTh * cx + cosTh * cy + toY * 0.5,\n      mTheta = calcVectorAngle(1, 0, (px - cx) / rx, (py - cy) / ry),\n      dtheta = calcVectorAngle(\n        (px - cx) / rx,\n        (py - cy) / ry,\n        (-px - cx) / rx,\n        (-py - cy) / ry\n      );\n\n    if (sweep === 0 && dtheta > 0) {\n      dtheta -= 2 * PI;\n    } else if (sweep === 1 && dtheta < 0) {\n      dtheta += 2 * PI;\n    }\n\n    // Convert into cubic bezier segments <= 90deg\n    var segments = Math.ceil(Math.abs((dtheta / PI) * 2)),\n      result = [],\n      mDelta = dtheta / segments,\n      mT =\n        ((8 / 3) * Math.sin(mDelta / 4) * Math.sin(mDelta / 4)) /\n        Math.sin(mDelta / 2),\n      th3 = mTheta + mDelta;\n\n    for (var i = 0; i < segments; i++) {\n      result[i] = segmentToBezier(\n        mTheta,\n        th3,\n        cosTh,\n        sinTh,\n        rx,\n        ry,\n        cx1,\n        cy1,\n        mT,\n        fromX,\n        fromY\n      );\n      fromX = result[i][4];\n      fromY = result[i][5];\n      mTheta = th3;\n      th3 += mDelta;\n    }\n    fabric.arcToSegmentsCache[argsString] = result;\n    return result;\n  }\n\n  function segmentToBezier(\n    th2,\n    th3,\n    cosTh,\n    sinTh,\n    rx,\n    ry,\n    cx1,\n    cy1,\n    mT,\n    fromX,\n    fromY\n  ) {\n    var costh2 = fabric.util.cos(th2),\n      sinth2 = fabric.util.sin(th2),\n      costh3 = fabric.util.cos(th3),\n      sinth3 = fabric.util.sin(th3),\n      toX = cosTh * rx * costh3 - sinTh * ry * sinth3 + cx1,\n      toY = sinTh * rx * costh3 + cosTh * ry * sinth3 + cy1,\n      cp1X = fromX + mT * (-cosTh * rx * sinth2 - sinTh * ry * costh2),\n      cp1Y = fromY + mT * (-sinTh * rx * sinth2 + cosTh * ry * costh2),\n      cp2X = toX + mT * (cosTh * rx * sinth3 + sinTh * ry * costh3),\n      cp2Y = toY + mT * (sinTh * rx * sinth3 - cosTh * ry * costh3);\n\n    return [cp1X, cp1Y, cp2X, cp2Y, toX, toY];\n  }\n\n  /*\n   * Private\n   */\n  function calcVectorAngle(ux, uy, vx, vy) {\n    var ta = Math.atan2(uy, ux),\n      tb = Math.atan2(vy, vx);\n    if (tb >= ta) {\n      return tb - ta;\n    } else {\n      return 2 * Math.PI - (ta - tb);\n    }\n  }\n\n  /**\n   * Draws arc\n   * @param {CanvasRenderingContext2D} ctx\n   * @param {Number} fx\n   * @param {Number} fy\n   * @param {Array} coords\n   */\n  fabric.util.drawArc = function (ctx, fx, fy, coords) {\n    var rx = coords[0],\n      ry = coords[1],\n      rot = coords[2],\n      large = coords[3],\n      sweep = coords[4],\n      tx = coords[5],\n      ty = coords[6],\n      segs = [[], [], [], []],\n      segsNorm = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segsNorm.length; i < len; i++) {\n      segs[i][0] = segsNorm[i][0] + fx;\n      segs[i][1] = segsNorm[i][1] + fy;\n      segs[i][2] = segsNorm[i][2] + fx;\n      segs[i][3] = segsNorm[i][3] + fy;\n      segs[i][4] = segsNorm[i][4] + fx;\n      segs[i][5] = segsNorm[i][5] + fy;\n      ctx.bezierCurveTo.apply(ctx, segs[i]);\n    }\n  };\n\n  /**\n   * Calculate bounding box of a elliptic-arc\n   * @param {Number} fx start point of arc\n   * @param {Number} fy\n   * @param {Number} rx horizontal radius\n   * @param {Number} ry vertical radius\n   * @param {Number} rot angle of horizontal axe\n   * @param {Number} large 1 or 0, whatever the arc is the big or the small on the 2 points\n   * @param {Number} sweep 1 or 0, 1 clockwise or counterclockwise direction\n   * @param {Number} tx end point of arc\n   * @param {Number} ty\n   */\n  fabric.util.getBoundsOfArc = function (\n    fx,\n    fy,\n    rx,\n    ry,\n    rot,\n    large,\n    sweep,\n    tx,\n    ty\n  ) {\n    var fromX = 0,\n      fromY = 0,\n      bound,\n      bounds = [],\n      segs = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segs.length; i < len; i++) {\n      bound = getBoundsOfCurve(\n        fromX,\n        fromY,\n        segs[i][0],\n        segs[i][1],\n        segs[i][2],\n        segs[i][3],\n        segs[i][4],\n        segs[i][5]\n      );\n      bounds.push({ x: bound[0].x + fx, y: bound[0].y + fy });\n      bounds.push({ x: bound[1].x + fx, y: bound[1].y + fy });\n      fromX = segs[i][4];\n      fromY = segs[i][5];\n    }\n    return bounds;\n  };\n\n  /**\n   * Calculate bounding box of a beziercurve\n   * @param {Number} x0 starting point\n   * @param {Number} y0\n   * @param {Number} x1 first control point\n   * @param {Number} y1\n   * @param {Number} x2 secondo control point\n   * @param {Number} y2\n   * @param {Number} x3 end of beizer\n   * @param {Number} y3\n   */\n  // taken from http://jsbin.com/ivomiq/56/edit  no credits available for that.\n  function getBoundsOfCurve(x0, y0, x1, y1, x2, y2, x3, y3) {\n    var argsString;\n    if (fabric.cachesBoundsOfCurve) {\n      argsString = _join.call(arguments);\n      if (fabric.boundsOfCurveCache[argsString]) {\n        return fabric.boundsOfCurveCache[argsString];\n      }\n    }\n\n    var sqrt = Math.sqrt,\n      min = Math.min,\n      max = Math.max,\n      abs = Math.abs,\n      tvalues = [],\n      bounds = [[], []],\n      a,\n      b,\n      c,\n      t,\n      t1,\n      t2,\n      b2ac,\n      sqrtb2ac;\n\n    b = 6 * x0 - 12 * x1 + 6 * x2;\n    a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n    c = 3 * x1 - 3 * x0;\n\n    for (var i = 0; i < 2; ++i) {\n      if (i > 0) {\n        b = 6 * y0 - 12 * y1 + 6 * y2;\n        a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n        c = 3 * y1 - 3 * y0;\n      }\n\n      if (abs(a) < 1e-12) {\n        if (abs(b) < 1e-12) {\n          continue;\n        }\n        t = -c / b;\n        if (0 < t && t < 1) {\n          tvalues.push(t);\n        }\n        continue;\n      }\n      b2ac = b * b - 4 * c * a;\n      if (b2ac < 0) {\n        continue;\n      }\n      sqrtb2ac = sqrt(b2ac);\n      t1 = (-b + sqrtb2ac) / (2 * a);\n      if (0 < t1 && t1 < 1) {\n        tvalues.push(t1);\n      }\n      t2 = (-b - sqrtb2ac) / (2 * a);\n      if (0 < t2 && t2 < 1) {\n        tvalues.push(t2);\n      }\n    }\n\n    var x,\n      y,\n      j = tvalues.length,\n      jlen = j,\n      mt;\n    while (j--) {\n      t = tvalues[j];\n      mt = 1 - t;\n      x =\n        mt * mt * mt * x0 +\n        3 * mt * mt * t * x1 +\n        3 * mt * t * t * x2 +\n        t * t * t * x3;\n      bounds[0][j] = x;\n\n      y =\n        mt * mt * mt * y0 +\n        3 * mt * mt * t * y1 +\n        3 * mt * t * t * y2 +\n        t * t * t * y3;\n      bounds[1][j] = y;\n    }\n\n    bounds[0][jlen] = x0;\n    bounds[1][jlen] = y0;\n    bounds[0][jlen + 1] = x3;\n    bounds[1][jlen + 1] = y3;\n    var result = [\n      {\n        x: min.apply(null, bounds[0]),\n        y: min.apply(null, bounds[1]),\n      },\n      {\n        x: max.apply(null, bounds[0]),\n        y: max.apply(null, bounds[1]),\n      },\n    ];\n    if (fabric.cachesBoundsOfCurve) {\n      fabric.boundsOfCurveCache[argsString] = result;\n    }\n    return result;\n  }\n\n  fabric.util.getBoundsOfCurve = getBoundsOfCurve;\n})();\n\n(function () {\n  var slice = Array.prototype.slice;\n\n  /**\n   * Invokes method on all items in a given array\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} method Name of a method to invoke\n   * @return {Array}\n   */\n  function invoke(array, method) {\n    var args = slice.call(arguments, 2),\n      result = [];\n    for (var i = 0, len = array.length; i < len; i++) {\n      result[i] = args.length\n        ? array[i][method].apply(array[i], args)\n        : array[i][method].call(array[i]);\n    }\n    return result;\n  }\n\n  /**\n   * Finds maximum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function max(array, byProperty) {\n    return find(array, byProperty, function (value1, value2) {\n      return value1 >= value2;\n    });\n  }\n\n  /**\n   * Finds minimum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function min(array, byProperty) {\n    return find(array, byProperty, function (value1, value2) {\n      return value1 < value2;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function fill(array, value) {\n    var k = array.length;\n    while (k--) {\n      array[k] = value;\n    }\n    return array;\n  }\n\n  /**\n   * @private\n   */\n  function find(array, byProperty, condition) {\n    if (!array || array.length === 0) {\n      return;\n    }\n\n    var i = array.length - 1,\n      result = byProperty ? array[i][byProperty] : array[i];\n    if (byProperty) {\n      while (i--) {\n        if (condition(array[i][byProperty], result)) {\n          result = array[i][byProperty];\n        }\n      }\n    } else {\n      while (i--) {\n        if (condition(array[i], result)) {\n          result = array[i];\n        }\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @namespace fabric.util.array\n   */\n  fabric.util.array = {\n    fill: fill,\n    invoke: invoke,\n    min: min,\n    max: max,\n  };\n})();\n\n(function () {\n  /**\n   * Copies all enumerable properties of one js object to another\n   * this does not and cannot compete with generic utils.\n   * Does not clone or extend fabric.Object subclasses.\n   * This is mostly for internal use and has extra handling for fabricJS objects\n   * it skips the canvas and group properties in deep cloning.\n   * @memberOf fabric.util.object\n   * @param {Object} destination Where to copy to\n   * @param {Object} source Where to copy from\n   * @return {Object}\n   */\n\n  function extend(destination, source, deep) {\n    // JScript DontEnum bug is not taken care of\n    // the deep clone is for internal use, is not meant to avoid\n    // javascript traps or cloning html element or self referenced objects.\n    if (deep) {\n      if (!fabric.isLikelyNode && source instanceof Element) {\n        // avoid cloning deep images, canvases,\n        destination = source;\n      } else if (source instanceof Array) {\n        destination = [];\n        for (var i = 0, len = source.length; i < len; i++) {\n          destination[i] = extend({}, source[i], deep);\n        }\n      } else if (source && typeof source === \"object\") {\n        for (var property in source) {\n          if (property === \"canvas\" || property === \"group\") {\n            // we do not want to clone this props at all.\n            // we want to keep the keys in the copy\n            destination[property] = null;\n          } else if (source.hasOwnProperty(property)) {\n            destination[property] = extend({}, source[property], deep);\n          }\n        }\n      } else {\n        // this sounds odd for an extend but is ok for recursive use\n        destination = source;\n      }\n    } else {\n      for (var property in source) {\n        destination[property] = source[property];\n      }\n    }\n    return destination;\n  }\n\n  /**\n   * Creates an empty object and copies all enumerable properties of another object to it\n   * @memberOf fabric.util.object\n   * TODO: this function return an empty object if you try to clone null\n   * @param {Object} object Object to clone\n   * @return {Object}\n   */\n  function clone(object, deep) {\n    return extend({}, object, deep);\n  }\n\n  /** @namespace fabric.util.object */\n  fabric.util.object = {\n    extend: extend,\n    clone: clone,\n  };\n  fabric.util.object.extend(fabric.util, fabric.Observable);\n})();\n\n(function () {\n  /**\n   * Camelizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to camelize\n   * @return {String} Camelized version of a string\n   */\n  function camelize(string) {\n    return string.replace(/-+(.)?/g, function (match, character) {\n      return character ? character.toUpperCase() : \"\";\n    });\n  }\n\n  /**\n   * Capitalizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to capitalize\n   * @param {Boolean} [firstLetterOnly] If true only first letter is capitalized\n   * and other letters stay untouched, if false first letter is capitalized\n   * and other letters are converted to lowercase.\n   * @return {String} Capitalized version of a string\n   */\n  function capitalize(string, firstLetterOnly) {\n    return (\n      string.charAt(0).toUpperCase() +\n      (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase())\n    );\n  }\n\n  /**\n   * Escapes XML in a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to escape\n   * @return {String} Escaped version of a string\n   */\n  function escapeXml(string) {\n    return string\n      .replace(/&/g, \"&amp;\")\n      .replace(/\"/g, \"&quot;\")\n      .replace(/'/g, \"&apos;\")\n      .replace(/</g, \"&lt;\")\n      .replace(/>/g, \"&gt;\");\n  }\n\n  /**\n   * Divide a string in the user perceived single units\n   * @memberOf fabric.util.string\n   * @param {String} textstring String to escape\n   * @return {Array} array containing the graphemes\n   */\n  function graphemeSplit(textstring) {\n    var i = 0,\n      chr,\n      graphemes = [];\n    for (i = 0, chr; i < textstring.length; i++) {\n      if ((chr = getWholeChar(textstring, i)) === false) {\n        continue;\n      }\n      graphemes.push(chr);\n    }\n    return graphemes;\n  }\n\n  // taken from mdn in the charAt doc page.\n  function getWholeChar(str, i) {\n    var code = str.charCodeAt(i);\n\n    if (isNaN(code)) {\n      return \"\"; // Position not found\n    }\n    if (code < 0xd800 || code > 0xdfff) {\n      return str.charAt(i);\n    }\n\n    // High surrogate (could change last hex to 0xDB7F to treat high private\n    // surrogates as single characters)\n    if (0xd800 <= code && code <= 0xdbff) {\n      if (str.length <= i + 1) {\n        throw \"High surrogate without following low surrogate\";\n      }\n      var next = str.charCodeAt(i + 1);\n      if (0xdc00 > next || next > 0xdfff) {\n        throw \"High surrogate without following low surrogate\";\n      }\n      return str.charAt(i) + str.charAt(i + 1);\n    }\n    // Low surrogate (0xDC00 <= code && code <= 0xDFFF)\n    if (i === 0) {\n      throw \"Low surrogate without preceding high surrogate\";\n    }\n    var prev = str.charCodeAt(i - 1);\n\n    // (could change last hex to 0xDB7F to treat high private\n    // surrogates as single characters)\n    if (0xd800 > prev || prev > 0xdbff) {\n      throw \"Low surrogate without preceding high surrogate\";\n    }\n    // We can pass over low surrogates now as the second component\n    // in a pair which we have already processed\n    return false;\n  }\n\n  /**\n   * String utilities\n   * @namespace fabric.util.string\n   */\n  fabric.util.string = {\n    camelize: camelize,\n    capitalize: capitalize,\n    escapeXml: escapeXml,\n    graphemeSplit: graphemeSplit,\n  };\n})();\n\n(function () {\n  var slice = Array.prototype.slice,\n    emptyFunction = function () {},\n    IS_DONTENUM_BUGGY = (function () {\n      for (var p in { toString: 1 }) {\n        if (p === \"toString\") {\n          return false;\n        }\n      }\n      return true;\n    })(),\n    /** @ignore */\n    addMethods = function (klass, source, parent) {\n      for (var property in source) {\n        if (\n          property in klass.prototype &&\n          typeof klass.prototype[property] === \"function\" &&\n          (source[property] + \"\").indexOf(\"callSuper\") > -1\n        ) {\n          klass.prototype[property] = (function (property) {\n            return function () {\n              var superclass = this.constructor.superclass;\n              this.constructor.superclass = parent;\n              var returnValue = source[property].apply(this, arguments);\n              this.constructor.superclass = superclass;\n\n              if (property !== \"initialize\") {\n                return returnValue;\n              }\n            };\n          })(property);\n        } else {\n          klass.prototype[property] = source[property];\n        }\n\n        if (IS_DONTENUM_BUGGY) {\n          if (source.toString !== Object.prototype.toString) {\n            klass.prototype.toString = source.toString;\n          }\n          if (source.valueOf !== Object.prototype.valueOf) {\n            klass.prototype.valueOf = source.valueOf;\n          }\n        }\n      }\n    };\n\n  function Subclass() {}\n\n  function callSuper(methodName) {\n    var parentMethod = null,\n      _this = this;\n\n    // climb prototype chain to find method not equal to callee's method\n    while (_this.constructor.superclass) {\n      var superClassMethod = _this.constructor.superclass.prototype[methodName];\n      if (_this[methodName] !== superClassMethod) {\n        parentMethod = superClassMethod;\n        break;\n      }\n      // eslint-disable-next-line\n      _this = _this.constructor.superclass.prototype;\n    }\n\n    if (!parentMethod) {\n      return console.log(\n        \"tried to callSuper \" +\n          methodName +\n          \", method not found in prototype chain\",\n        this\n      );\n    }\n\n    return arguments.length > 1\n      ? parentMethod.apply(this, slice.call(arguments, 1))\n      : parentMethod.call(this);\n  }\n\n  /**\n   * Helper for creation of \"classes\".\n   * @memberOf fabric.util\n   * @param {Function} [parent] optional \"Class\" to inherit from\n   * @param {Object} [properties] Properties shared by all instances of this class\n   *                  (be careful modifying objects defined here as this would affect all instances)\n   */\n  function createClass() {\n    var parent = null,\n      properties = slice.call(arguments, 0);\n\n    if (typeof properties[0] === \"function\") {\n      parent = properties.shift();\n    }\n    function klass() {\n      this.initialize.apply(this, arguments);\n    }\n\n    klass.superclass = parent;\n    klass.subclasses = [];\n\n    if (parent) {\n      Subclass.prototype = parent.prototype;\n      klass.prototype = new Subclass();\n      parent.subclasses.push(klass);\n    }\n    for (var i = 0, length = properties.length; i < length; i++) {\n      addMethods(klass, properties[i], parent);\n    }\n    if (!klass.prototype.initialize) {\n      klass.prototype.initialize = emptyFunction;\n    }\n    klass.prototype.constructor = klass;\n    klass.prototype.callSuper = callSuper;\n    return klass;\n  }\n\n  fabric.util.createClass = createClass;\n})();\n\n(function () {\n  // since ie11 can use addEventListener but they do not support options, i need to check\n  var couldUseAttachEvent = !!fabric.document.createElement(\"div\").attachEvent,\n    touchEvents = [\"touchstart\", \"touchmove\", \"touchend\"];\n  /**\n   * Adds an event listener to an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.addListener = function (element, eventName, handler, options) {\n    element &&\n      element.addEventListener(\n        eventName,\n        handler,\n        couldUseAttachEvent ? false : options\n      );\n  };\n\n  /**\n   * Removes an event listener from an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.removeListener = function (element, eventName, handler, options) {\n    element &&\n      element.removeEventListener(\n        eventName,\n        handler,\n        couldUseAttachEvent ? false : options\n      );\n  };\n\n  function getTouchInfo(event) {\n    var touchProp = event.changedTouches;\n    if (touchProp && touchProp[0]) {\n      return touchProp[0];\n    }\n    return event;\n  }\n\n  fabric.util.getPointer = function (event) {\n    var element = event.target,\n      scroll = fabric.util.getScrollLeftTop(element),\n      _evt = getTouchInfo(event);\n    return {\n      x: _evt.clientX + scroll.left,\n      y: _evt.clientY + scroll.top,\n    };\n  };\n\n  fabric.util.isTouchEvent = function (event) {\n    return (\n      touchEvents.indexOf(event.type) > -1 || event.pointerType === \"touch\"\n    );\n  };\n})();\n\n(function () {\n  /**\n   * Cross-browser wrapper for setting element's style\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {Object} styles\n   * @return {HTMLElement} Element that was passed as a first argument\n   */\n  function setStyle(element, styles) {\n    var elementStyle = element.style;\n    if (!elementStyle) {\n      return element;\n    }\n    if (typeof styles === \"string\") {\n      element.style.cssText += \";\" + styles;\n      return styles.indexOf(\"opacity\") > -1\n        ? setOpacity(element, styles.match(/opacity:\\s*(\\d?\\.?\\d*)/)[1])\n        : element;\n    }\n    for (var property in styles) {\n      if (property === \"opacity\") {\n        setOpacity(element, styles[property]);\n      } else {\n        var normalizedProperty =\n          property === \"float\" || property === \"cssFloat\"\n            ? typeof elementStyle.styleFloat === \"undefined\"\n              ? \"cssFloat\"\n              : \"styleFloat\"\n            : property;\n        elementStyle[normalizedProperty] = styles[property];\n      }\n    }\n    return element;\n  }\n\n  var parseEl = fabric.document.createElement(\"div\"),\n    supportsOpacity = typeof parseEl.style.opacity === \"string\",\n    supportsFilters = typeof parseEl.style.filter === \"string\",\n    reOpacity = /alpha\\s*\\(\\s*opacity\\s*=\\s*([^\\)]+)\\)/,\n    /** @ignore */\n    setOpacity = function (element) {\n      return element;\n    };\n\n  if (supportsOpacity) {\n    /** @ignore */\n    setOpacity = function (element, value) {\n      element.style.opacity = value;\n      return element;\n    };\n  } else if (supportsFilters) {\n    /** @ignore */\n    setOpacity = function (element, value) {\n      var es = element.style;\n      if (element.currentStyle && !element.currentStyle.hasLayout) {\n        es.zoom = 1;\n      }\n      if (reOpacity.test(es.filter)) {\n        value = value >= 0.9999 ? \"\" : \"alpha(opacity=\" + value * 100 + \")\";\n        es.filter = es.filter.replace(reOpacity, value);\n      } else {\n        es.filter += \" alpha(opacity=\" + value * 100 + \")\";\n      }\n      return element;\n    };\n  }\n\n  fabric.util.setStyle = setStyle;\n})();\n\n(function () {\n  var _slice = Array.prototype.slice;\n\n  /**\n   * Takes id and returns an element with that id (if one exists in a document)\n   * @memberOf fabric.util\n   * @param {String|HTMLElement} id\n   * @return {HTMLElement|null}\n   */\n  function getById(id) {\n    return typeof id === \"string\" ? fabric.document.getElementById(id) : id;\n  }\n\n  var sliceCanConvertNodelists,\n    /**\n     * Converts an array-like object (e.g. arguments or NodeList) to an array\n     * @memberOf fabric.util\n     * @param {Object} arrayLike\n     * @return {Array}\n     */\n    toArray = function (arrayLike) {\n      return _slice.call(arrayLike, 0);\n    };\n\n  try {\n    sliceCanConvertNodelists =\n      toArray(fabric.document.childNodes) instanceof Array;\n  } catch (err) {}\n\n  if (!sliceCanConvertNodelists) {\n    toArray = function (arrayLike) {\n      var arr = new Array(arrayLike.length),\n        i = arrayLike.length;\n      while (i--) {\n        arr[i] = arrayLike[i];\n      }\n      return arr;\n    };\n  }\n\n  /**\n   * Creates specified element with specified attributes\n   * @memberOf fabric.util\n   * @param {String} tagName Type of an element to create\n   * @param {Object} [attributes] Attributes to set on an element\n   * @return {HTMLElement} Newly created element\n   */\n  function makeElement(tagName, attributes) {\n    var el = fabric.document.createElement(tagName);\n    for (var prop in attributes) {\n      if (prop === \"class\") {\n        el.className = attributes[prop];\n      } else if (prop === \"for\") {\n        el.htmlFor = attributes[prop];\n      } else {\n        el.setAttribute(prop, attributes[prop]);\n      }\n    }\n    return el;\n  }\n\n  /**\n   * Adds class to an element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to add class to\n   * @param {String} className Class to add to an element\n   */\n  function addClass(element, className) {\n    if (\n      element &&\n      (\" \" + element.className + \" \").indexOf(\" \" + className + \" \") === -1\n    ) {\n      element.className += (element.className ? \" \" : \"\") + className;\n    }\n  }\n\n  /**\n   * Wraps element with another element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to wrap\n   * @param {HTMLElement|String} wrapper Element to wrap with\n   * @param {Object} [attributes] Attributes to set on a wrapper\n   * @return {HTMLElement} wrapper\n   */\n  function wrapElement(element, wrapper, attributes) {\n    if (typeof wrapper === \"string\") {\n      wrapper = makeElement(wrapper, attributes);\n    }\n    if (element.parentNode) {\n      element.parentNode.replaceChild(wrapper, element);\n    }\n    wrapper.appendChild(element);\n    return wrapper;\n  }\n\n  /**\n   * Returns element scroll offsets\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to operate on\n   * @return {Object} Object with left/top values\n   */\n  function getScrollLeftTop(element) {\n    var left = 0,\n      top = 0,\n      docElement = fabric.document.documentElement,\n      body = fabric.document.body || {\n        scrollLeft: 0,\n        scrollTop: 0,\n      };\n\n    // While loop checks (and then sets element to) .parentNode OR .host\n    //  to account for ShadowDOM. We still want to traverse up out of ShadowDOM,\n    //  but the .parentNode of a root ShadowDOM node will always be null, instead\n    //  it should be accessed through .host. See http://stackoverflow.com/a/24765528/4383938\n    while (element && (element.parentNode || element.host)) {\n      // Set element to element parent, or 'host' in case of ShadowDOM\n      element = element.parentNode || element.host;\n\n      if (element === fabric.document) {\n        left = body.scrollLeft || docElement.scrollLeft || 0;\n        top = body.scrollTop || docElement.scrollTop || 0;\n      } else {\n        left += element.scrollLeft || 0;\n        top += element.scrollTop || 0;\n      }\n\n      if (element.nodeType === 1 && element.style.position === \"fixed\") {\n        break;\n      }\n    }\n\n    return { left: left, top: top };\n  }\n\n  /**\n   * Returns offset for a given element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get offset for\n   * @return {Object} Object with \"left\" and \"top\" properties\n   */\n  function getElementOffset(element) {\n    var docElem,\n      doc = element && element.ownerDocument,\n      box = { left: 0, top: 0 },\n      offset = { left: 0, top: 0 },\n      scrollLeftTop,\n      offsetAttributes = {\n        borderLeftWidth: \"left\",\n        borderTopWidth: \"top\",\n        paddingLeft: \"left\",\n        paddingTop: \"top\",\n      };\n\n    if (!doc) {\n      return offset;\n    }\n\n    for (var attr in offsetAttributes) {\n      offset[offsetAttributes[attr]] +=\n        parseInt(getElementStyle(element, attr), 10) || 0;\n    }\n\n    docElem = doc.documentElement;\n    if (typeof element.getBoundingClientRect !== \"undefined\") {\n      box = element.getBoundingClientRect();\n    }\n\n    scrollLeftTop = getScrollLeftTop(element);\n\n    return {\n      left:\n        box.left + scrollLeftTop.left - (docElem.clientLeft || 0) + offset.left,\n      top: box.top + scrollLeftTop.top - (docElem.clientTop || 0) + offset.top,\n    };\n  }\n\n  /**\n   * Returns style attribute value of a given element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get style attribute for\n   * @param {String} attr Style attribute to get for element\n   * @return {String} Style attribute value of the given element.\n   */\n  var getElementStyle;\n  if (\n    fabric.document.defaultView &&\n    fabric.document.defaultView.getComputedStyle\n  ) {\n    getElementStyle = function (element, attr) {\n      var style = fabric.document.defaultView.getComputedStyle(element, null);\n      return style ? style[attr] : undefined;\n    };\n  } else {\n    getElementStyle = function (element, attr) {\n      var value = element.style[attr];\n      if (!value && element.currentStyle) {\n        value = element.currentStyle[attr];\n      }\n      return value;\n    };\n  }\n\n  (function () {\n    var style = fabric.document.documentElement.style,\n      selectProp =\n        \"userSelect\" in style\n          ? \"userSelect\"\n          : \"MozUserSelect\" in style\n          ? \"MozUserSelect\"\n          : \"WebkitUserSelect\" in style\n          ? \"WebkitUserSelect\"\n          : \"KhtmlUserSelect\" in style\n          ? \"KhtmlUserSelect\"\n          : \"\";\n\n    /**\n     * Makes element unselectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make unselectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementUnselectable(element) {\n      if (typeof element.onselectstart !== \"undefined\") {\n        element.onselectstart = fabric.util.falseFunction;\n      }\n      if (selectProp) {\n        element.style[selectProp] = \"none\";\n      } else if (typeof element.unselectable === \"string\") {\n        element.unselectable = \"on\";\n      }\n      return element;\n    }\n\n    /**\n     * Makes element selectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make selectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementSelectable(element) {\n      if (typeof element.onselectstart !== \"undefined\") {\n        element.onselectstart = null;\n      }\n      if (selectProp) {\n        element.style[selectProp] = \"\";\n      } else if (typeof element.unselectable === \"string\") {\n        element.unselectable = \"\";\n      }\n      return element;\n    }\n\n    fabric.util.makeElementUnselectable = makeElementUnselectable;\n    fabric.util.makeElementSelectable = makeElementSelectable;\n  })();\n\n  function getNodeCanvas(element) {\n    var impl = fabric.jsdomImplForWrapper(element);\n    return impl._canvas || impl._image;\n  }\n\n  function cleanUpJsdomNode(element) {\n    if (!fabric.isLikelyNode) {\n      return;\n    }\n    var impl = fabric.jsdomImplForWrapper(element);\n    if (impl) {\n      impl._image = null;\n      impl._canvas = null;\n      // unsure if necessary\n      impl._currentSrc = null;\n      impl._attributes = null;\n      impl._classList = null;\n    }\n  }\n\n  function setImageSmoothing(ctx, value) {\n    ctx.imageSmoothingEnabled =\n      ctx.imageSmoothingEnabled ||\n      ctx.webkitImageSmoothingEnabled ||\n      ctx.mozImageSmoothingEnabled ||\n      ctx.msImageSmoothingEnabled ||\n      ctx.oImageSmoothingEnabled;\n    ctx.imageSmoothingEnabled = value;\n  }\n\n  /**\n   * setImageSmoothing sets the context imageSmoothingEnabled property.\n   * Used by canvas and by ImageObject.\n   * @memberOf fabric.util\n   * @since 4.0.0\n   * @param {HTMLRenderingContext2D} ctx to set on\n   * @param {Boolean} value true or false\n   */\n  fabric.util.setImageSmoothing = setImageSmoothing;\n  fabric.util.getById = getById;\n  fabric.util.toArray = toArray;\n  fabric.util.addClass = addClass;\n  fabric.util.makeElement = makeElement;\n  fabric.util.wrapElement = wrapElement;\n  fabric.util.getScrollLeftTop = getScrollLeftTop;\n  fabric.util.getElementOffset = getElementOffset;\n  fabric.util.getNodeCanvas = getNodeCanvas;\n  fabric.util.cleanUpJsdomNode = cleanUpJsdomNode;\n})();\n\n(function () {\n  function addParamToUrl(url, param) {\n    return url + (/\\?/.test(url) ? \"&\" : \"?\") + param;\n  }\n\n  function emptyFn() {}\n\n  /**\n   * Cross-browser abstraction for sending XMLHttpRequest\n   * @memberOf fabric.util\n   * @param {String} url URL to send XMLHttpRequest to\n   * @param {Object} [options] Options object\n   * @param {String} [options.method=\"GET\"]\n   * @param {String} [options.parameters] parameters to append to url in GET or in body\n   * @param {String} [options.body] body to send with POST or PUT request\n   * @param {Function} options.onComplete Callback to invoke when request is completed\n   * @return {XMLHttpRequest} request\n   */\n  function request(url, options) {\n    options || (options = {});\n\n    var method = options.method ? options.method.toUpperCase() : \"GET\",\n      onComplete = options.onComplete || function () {},\n      xhr = new fabric.window.XMLHttpRequest(),\n      body = options.body || options.parameters;\n\n    /** @ignore */\n    xhr.onreadystatechange = function () {\n      if (xhr.readyState === 4) {\n        onComplete(xhr);\n        xhr.onreadystatechange = emptyFn;\n      }\n    };\n\n    if (method === \"GET\") {\n      body = null;\n      if (typeof options.parameters === \"string\") {\n        url = addParamToUrl(url, options.parameters);\n      }\n    }\n\n    xhr.open(method, url, true);\n\n    if (method === \"POST\" || method === \"PUT\") {\n      xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n    }\n\n    xhr.send(body);\n    return xhr;\n  }\n\n  fabric.util.request = request;\n})();\n\n/**\n * Wrapper around `console.log` (when available)\n * @param {*} [values] Values to log\n */\nfabric.log = console.log;\n\n/**\n * Wrapper around `console.warn` (when available)\n * @param {*} [values] Values to log as a warning\n */\nfabric.warn = console.warn;\n\n(function () {\n  function noop() {\n    return false;\n  }\n\n  function defaultEasing(t, b, c, d) {\n    return -c * Math.cos((t / d) * (Math.PI / 2)) + c + b;\n  }\n\n  /**\n   * Changes value from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Number} [options.startValue=0] Starting value\n   * @param {Number} [options.endValue=100] Ending value\n   * @param {Number} [options.byValue=100] Value to modify the property by\n   * @param {Function} [options.easing] Easing function\n   * @param {Number} [options.duration=500] Duration of change (in ms)\n   * @param {Function} [options.abort] Additional function with logic. If returns true, onComplete is called.\n   */\n  function animate(options) {\n    requestAnimFrame(function (timestamp) {\n      options || (options = {});\n\n      var start = timestamp || +new Date(),\n        duration = options.duration || 500,\n        finish = start + duration,\n        time,\n        onChange = options.onChange || noop,\n        abort = options.abort || noop,\n        onComplete = options.onComplete || noop,\n        easing = options.easing || defaultEasing,\n        startValue = \"startValue\" in options ? options.startValue : 0,\n        endValue = \"endValue\" in options ? options.endValue : 100,\n        byValue = options.byValue || endValue - startValue;\n\n      options.onStart && options.onStart();\n\n      (function tick(ticktime) {\n        // TODO: move abort call after calculation\n        // and pass (current,valuePerc, timePerc) as arguments\n        time = ticktime || +new Date();\n        var currentTime = time > finish ? duration : time - start,\n          timePerc = currentTime / duration,\n          current = easing(currentTime, startValue, byValue, duration),\n          valuePerc = Math.abs((current - startValue) / byValue);\n        if (abort()) {\n          onComplete(endValue, 1, 1);\n          return;\n        }\n        if (time > finish) {\n          onChange(endValue, 1, 1);\n          onComplete(endValue, 1, 1);\n          return;\n        } else {\n          onChange(current, valuePerc, timePerc);\n          requestAnimFrame(tick);\n        }\n      })(start);\n    });\n  }\n\n  var _requestAnimFrame =\n    fabric.window.requestAnimationFrame ||\n    fabric.window.webkitRequestAnimationFrame ||\n    fabric.window.mozRequestAnimationFrame ||\n    fabric.window.oRequestAnimationFrame ||\n    fabric.window.msRequestAnimationFrame ||\n    function (callback) {\n      return fabric.window.setTimeout(callback, 1000 / 60);\n    };\n\n  var _cancelAnimFrame =\n    fabric.window.cancelAnimationFrame || fabric.window.clearTimeout;\n\n  /**\n   * requestAnimationFrame polyfill based on http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n   * In order to get a precise start time, `requestAnimFrame` should be called as an entry into the method\n   * @memberOf fabric.util\n   * @param {Function} callback Callback to invoke\n   * @param {DOMElement} element optional Element to associate with animation\n   */\n  function requestAnimFrame() {\n    return _requestAnimFrame.apply(fabric.window, arguments);\n  }\n\n  function cancelAnimFrame() {\n    return _cancelAnimFrame.apply(fabric.window, arguments);\n  }\n\n  fabric.util.animate = animate;\n  fabric.util.requestAnimFrame = requestAnimFrame;\n  fabric.util.cancelAnimFrame = cancelAnimFrame;\n})();\n\n(function () {\n  // Calculate an in-between color. Returns a \"rgba()\" string.\n  // Credit: Edwin Martin <edwin@bitstorm.org>\n  //         http://www.bitstorm.org/jquery/color-animation/jquery.animate-colors.js\n  function calculateColor(begin, end, pos) {\n    var color =\n      \"rgba(\" +\n      parseInt(begin[0] + pos * (end[0] - begin[0]), 10) +\n      \",\" +\n      parseInt(begin[1] + pos * (end[1] - begin[1]), 10) +\n      \",\" +\n      parseInt(begin[2] + pos * (end[2] - begin[2]), 10);\n\n    color +=\n      \",\" +\n      (begin && end ? parseFloat(begin[3] + pos * (end[3] - begin[3])) : 1);\n    color += \")\";\n    return color;\n  }\n\n  /**\n   * Changes the color from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {String} fromColor The starting color in hex or rgb(a) format.\n   * @param {String} toColor The starting color in hex or rgb(a) format.\n   * @param {Number} [duration] Duration of change (in ms).\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Function} [options.colorEasing] Easing function. Note that this function only take two arguments (currentTime, duration). Thus the regular animation easing functions cannot be used.\n   * @param {Function} [options.abort] Additional function with logic. If returns true, onComplete is called.\n   */\n  function animateColor(fromColor, toColor, duration, options) {\n    var startColor = new fabric.Color(fromColor).getSource(),\n      endColor = new fabric.Color(toColor).getSource(),\n      originalOnComplete = options.onComplete,\n      originalOnChange = options.onChange;\n    options = options || {};\n\n    fabric.util.animate(\n      fabric.util.object.extend(options, {\n        duration: duration || 500,\n        startValue: startColor,\n        endValue: endColor,\n        byValue: endColor,\n        easing: function (currentTime, startValue, byValue, duration) {\n          var posValue = options.colorEasing\n            ? options.colorEasing(currentTime, duration)\n            : 1 - Math.cos((currentTime / duration) * (Math.PI / 2));\n          return calculateColor(startValue, byValue, posValue);\n        },\n        // has to take in account for color restoring;\n        onComplete: function (current, valuePerc, timePerc) {\n          if (originalOnComplete) {\n            return originalOnComplete(\n              calculateColor(endColor, endColor, 0),\n              valuePerc,\n              timePerc\n            );\n          }\n        },\n        onChange: function (current, valuePerc, timePerc) {\n          if (originalOnChange) {\n            if (Array.isArray(current)) {\n              return originalOnChange(\n                calculateColor(current, current, 0),\n                valuePerc,\n                timePerc\n              );\n            }\n            originalOnChange(current, valuePerc, timePerc);\n          }\n        },\n      })\n    );\n  }\n\n  fabric.util.animateColor = animateColor;\n})();\n\n(function () {\n  function normalize(a, c, p, s) {\n    if (a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    } else {\n      //handle the 0/0 case:\n      if (c === 0 && a === 0) {\n        s = (p / (2 * Math.PI)) * Math.asin(1);\n      } else {\n        s = (p / (2 * Math.PI)) * Math.asin(c / a);\n      }\n    }\n    return { a: a, c: c, p: p, s: s };\n  }\n\n  function elastic(opts, t, d) {\n    return (\n      opts.a *\n      Math.pow(2, 10 * (t -= 1)) *\n      Math.sin(((t * d - opts.s) * (2 * Math.PI)) / opts.p)\n    );\n  }\n\n  /**\n   * Cubic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCubic(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t + 1) + b;\n  }\n\n  /**\n   * Cubic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCubic(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return (c / 2) * t * t * t + b;\n    }\n    return (c / 2) * ((t -= 2) * t * t + 2) + b;\n  }\n\n  /**\n   * Quartic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuart(t, b, c, d) {\n    return c * (t /= d) * t * t * t + b;\n  }\n\n  /**\n   * Quartic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuart(t, b, c, d) {\n    return -c * ((t = t / d - 1) * t * t * t - 1) + b;\n  }\n\n  /**\n   * Quartic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuart(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return (c / 2) * t * t * t * t + b;\n    }\n    return (-c / 2) * ((t -= 2) * t * t * t - 2) + b;\n  }\n\n  /**\n   * Quintic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuint(t, b, c, d) {\n    return c * (t /= d) * t * t * t * t + b;\n  }\n\n  /**\n   * Quintic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuint(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n  }\n\n  /**\n   * Quintic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuint(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return (c / 2) * t * t * t * t * t + b;\n    }\n    return (c / 2) * ((t -= 2) * t * t * t * t + 2) + b;\n  }\n\n  /**\n   * Sinusoidal easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInSine(t, b, c, d) {\n    return -c * Math.cos((t / d) * (Math.PI / 2)) + c + b;\n  }\n\n  /**\n   * Sinusoidal easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutSine(t, b, c, d) {\n    return c * Math.sin((t / d) * (Math.PI / 2)) + b;\n  }\n\n  /**\n   * Sinusoidal easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutSine(t, b, c, d) {\n    return (-c / 2) * (Math.cos((Math.PI * t) / d) - 1) + b;\n  }\n\n  /**\n   * Exponential easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInExpo(t, b, c, d) {\n    return t === 0 ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;\n  }\n\n  /**\n   * Exponential easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutExpo(t, b, c, d) {\n    return t === d ? b + c : c * (-Math.pow(2, (-10 * t) / d) + 1) + b;\n  }\n\n  /**\n   * Exponential easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutExpo(t, b, c, d) {\n    if (t === 0) {\n      return b;\n    }\n    if (t === d) {\n      return b + c;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return (c / 2) * Math.pow(2, 10 * (t - 1)) + b;\n    }\n    return (c / 2) * (-Math.pow(2, -10 * --t) + 2) + b;\n  }\n\n  /**\n   * Circular easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInCirc(t, b, c, d) {\n    return -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\n  }\n\n  /**\n   * Circular easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCirc(t, b, c, d) {\n    return c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\n  }\n\n  /**\n   * Circular easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCirc(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return (-c / 2) * (Math.sqrt(1 - t * t) - 1) + b;\n    }\n    return (c / 2) * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\n  }\n\n  /**\n   * Elastic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInElastic(t, b, c, d) {\n    var s = 1.70158,\n      p = 0,\n      a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return -elastic(opts, t, d) + b;\n  }\n\n  /**\n   * Elastic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutElastic(t, b, c, d) {\n    var s = 1.70158,\n      p = 0,\n      a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return (\n      opts.a *\n        Math.pow(2, -10 * t) *\n        Math.sin(((t * d - opts.s) * (2 * Math.PI)) / opts.p) +\n      opts.c +\n      b\n    );\n  }\n\n  /**\n   * Elastic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutElastic(t, b, c, d) {\n    var s = 1.70158,\n      p = 0,\n      a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d / 2;\n    if (t === 2) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * (0.3 * 1.5);\n    }\n    var opts = normalize(a, c, p, s);\n    if (t < 1) {\n      return -0.5 * elastic(opts, t, d) + b;\n    }\n    return (\n      opts.a *\n        Math.pow(2, -10 * (t -= 1)) *\n        Math.sin(((t * d - opts.s) * (2 * Math.PI)) / opts.p) *\n        0.5 +\n      opts.c +\n      b\n    );\n  }\n\n  /**\n   * Backwards easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * (t /= d) * t * ((s + 1) * t - s) + b;\n  }\n\n  /**\n   * Backwards easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n  }\n\n  /**\n   * Backwards easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return (c / 2) * (t * t * (((s *= 1.525) + 1) * t - s)) + b;\n    }\n    return (c / 2) * ((t -= 2) * t * (((s *= 1.525) + 1) * t + s) + 2) + b;\n  }\n\n  /**\n   * Bouncing easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBounce(t, b, c, d) {\n    return c - easeOutBounce(d - t, 0, c, d) + b;\n  }\n\n  /**\n   * Bouncing easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBounce(t, b, c, d) {\n    if ((t /= d) < 1 / 2.75) {\n      return c * (7.5625 * t * t) + b;\n    } else if (t < 2 / 2.75) {\n      return c * (7.5625 * (t -= 1.5 / 2.75) * t + 0.75) + b;\n    } else if (t < 2.5 / 2.75) {\n      return c * (7.5625 * (t -= 2.25 / 2.75) * t + 0.9375) + b;\n    } else {\n      return c * (7.5625 * (t -= 2.625 / 2.75) * t + 0.984375) + b;\n    }\n  }\n\n  /**\n   * Bouncing easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBounce(t, b, c, d) {\n    if (t < d / 2) {\n      return easeInBounce(t * 2, 0, c, d) * 0.5 + b;\n    }\n    return easeOutBounce(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n  }\n\n  /**\n   * Easing functions\n   * See <a href=\"http://gizma.com/easing/\">Easing Equations by Robert Penner</a>\n   * @namespace fabric.util.ease\n   */\n  fabric.util.ease = {\n    /**\n     * Quadratic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInQuad: function (t, b, c, d) {\n      return c * (t /= d) * t + b;\n    },\n\n    /**\n     * Quadratic easing out\n     * @memberOf fabric.util.ease\n     */\n    easeOutQuad: function (t, b, c, d) {\n      return -c * (t /= d) * (t - 2) + b;\n    },\n\n    /**\n     * Quadratic easing in and out\n     * @memberOf fabric.util.ease\n     */\n    easeInOutQuad: function (t, b, c, d) {\n      t /= d / 2;\n      if (t < 1) {\n        return (c / 2) * t * t + b;\n      }\n      return (-c / 2) * (--t * (t - 2) - 1) + b;\n    },\n\n    /**\n     * Cubic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInCubic: function (t, b, c, d) {\n      return c * (t /= d) * t * t + b;\n    },\n\n    easeOutCubic: easeOutCubic,\n    easeInOutCubic: easeInOutCubic,\n    easeInQuart: easeInQuart,\n    easeOutQuart: easeOutQuart,\n    easeInOutQuart: easeInOutQuart,\n    easeInQuint: easeInQuint,\n    easeOutQuint: easeOutQuint,\n    easeInOutQuint: easeInOutQuint,\n    easeInSine: easeInSine,\n    easeOutSine: easeOutSine,\n    easeInOutSine: easeInOutSine,\n    easeInExpo: easeInExpo,\n    easeOutExpo: easeOutExpo,\n    easeInOutExpo: easeInOutExpo,\n    easeInCirc: easeInCirc,\n    easeOutCirc: easeOutCirc,\n    easeInOutCirc: easeInOutCirc,\n    easeInElastic: easeInElastic,\n    easeOutElastic: easeOutElastic,\n    easeInOutElastic: easeInOutElastic,\n    easeInBack: easeInBack,\n    easeOutBack: easeOutBack,\n    easeInOutBack: easeInOutBack,\n    easeInBounce: easeInBounce,\n    easeOutBounce: easeOutBounce,\n    easeInOutBounce: easeInOutBounce,\n  };\n})();\n\n(function (global) {\n  \"use strict\";\n\n  /**\n   * @name fabric\n   * @namespace\n   */\n\n  var fabric = global.fabric || (global.fabric = {}),\n    extend = fabric.util.object.extend,\n    clone = fabric.util.object.clone,\n    toFixed = fabric.util.toFixed,\n    parseUnit = fabric.util.parseUnit,\n    multiplyTransformMatrices = fabric.util.multiplyTransformMatrices,\n    svgValidTagNames = [\n      \"path\",\n      \"circle\",\n      \"polygon\",\n      \"polyline\",\n      \"ellipse\",\n      \"rect\",\n      \"line\",\n      \"image\",\n      \"text\",\n    ],\n    svgViewBoxElements = [\n      \"symbol\",\n      \"image\",\n      \"marker\",\n      \"pattern\",\n      \"view\",\n      \"svg\",\n    ],\n    svgInvalidAncestors = [\n      \"pattern\",\n      \"defs\",\n      \"symbol\",\n      \"metadata\",\n      \"clipPath\",\n      \"mask\",\n      \"desc\",\n    ],\n    svgValidParents = [\"symbol\", \"g\", \"a\", \"svg\", \"clipPath\", \"defs\"],\n    attributesMap = {\n      cx: \"left\",\n      x: \"left\",\n      r: \"radius\",\n      cy: \"top\",\n      y: \"top\",\n      display: \"visible\",\n      visibility: \"visible\",\n      transform: \"transformMatrix\",\n      \"fill-opacity\": \"fillOpacity\",\n      \"fill-rule\": \"fillRule\",\n      \"font-family\": \"fontFamily\",\n      \"font-size\": \"fontSize\",\n      \"font-style\": \"fontStyle\",\n      \"font-weight\": \"fontWeight\",\n      \"letter-spacing\": \"charSpacing\",\n      \"paint-order\": \"paintFirst\",\n      \"stroke-dasharray\": \"strokeDashArray\",\n      \"stroke-dashoffset\": \"strokeDashOffset\",\n      \"stroke-linecap\": \"strokeLineCap\",\n      \"stroke-linejoin\": \"strokeLineJoin\",\n      \"stroke-miterlimit\": \"strokeMiterLimit\",\n      \"stroke-opacity\": \"strokeOpacity\",\n      \"stroke-width\": \"strokeWidth\",\n      \"text-decoration\": \"textDecoration\",\n      \"text-anchor\": \"textAnchor\",\n      opacity: \"opacity\",\n      \"clip-path\": \"clipPath\",\n      \"clip-rule\": \"clipRule\",\n      \"vector-effect\": \"strokeUniform\",\n      \"image-rendering\": \"imageSmoothing\",\n    },\n    colorAttributes = {\n      stroke: \"strokeOpacity\",\n      fill: \"fillOpacity\",\n    },\n    fSize = \"font-size\",\n    cPath = \"clip-path\";\n\n  fabric.svgValidTagNamesRegEx = getSvgRegex(svgValidTagNames);\n  fabric.svgViewBoxElementsRegEx = getSvgRegex(svgViewBoxElements);\n  fabric.svgInvalidAncestorsRegEx = getSvgRegex(svgInvalidAncestors);\n  fabric.svgValidParentsRegEx = getSvgRegex(svgValidParents);\n\n  fabric.cssRules = {};\n  fabric.gradientDefs = {};\n  fabric.clipPaths = {};\n\n  function normalizeAttr(attr) {\n    // transform attribute names\n    if (attr in attributesMap) {\n      return attributesMap[attr];\n    }\n    return attr;\n  }\n\n  function normalizeValue(attr, value, parentAttributes, fontSize) {\n    var isArray = Object.prototype.toString.call(value) === \"[object Array]\",\n      parsed;\n\n    if ((attr === \"fill\" || attr === \"stroke\") && value === \"none\") {\n      value = \"\";\n    } else if (attr === \"strokeUniform\") {\n      return value === \"non-scaling-stroke\";\n    } else if (attr === \"strokeDashArray\") {\n      if (value === \"none\") {\n        value = null;\n      } else {\n        value = value.replace(/,/g, \" \").split(/\\s+/).map(parseFloat);\n      }\n    } else if (attr === \"transformMatrix\") {\n      if (parentAttributes && parentAttributes.transformMatrix) {\n        value = multiplyTransformMatrices(\n          parentAttributes.transformMatrix,\n          fabric.parseTransformAttribute(value)\n        );\n      } else {\n        value = fabric.parseTransformAttribute(value);\n      }\n    } else if (attr === \"visible\") {\n      value = value !== \"none\" && value !== \"hidden\";\n      // display=none on parent element always takes precedence over child element\n      if (parentAttributes && parentAttributes.visible === false) {\n        value = false;\n      }\n    } else if (attr === \"opacity\") {\n      value = parseFloat(value);\n      if (parentAttributes && typeof parentAttributes.opacity !== \"undefined\") {\n        value *= parentAttributes.opacity;\n      }\n    } else if (attr === \"textAnchor\" /* text-anchor */) {\n      value = value === \"start\" ? \"left\" : value === \"end\" ? \"right\" : \"center\";\n    } else if (attr === \"charSpacing\") {\n      // parseUnit returns px and we convert it to em\n      parsed = (parseUnit(value, fontSize) / fontSize) * 1000;\n    } else if (attr === \"paintFirst\") {\n      var fillIndex = value.indexOf(\"fill\");\n      var strokeIndex = value.indexOf(\"stroke\");\n      var value = \"fill\";\n      if (fillIndex > -1 && strokeIndex > -1 && strokeIndex < fillIndex) {\n        value = \"stroke\";\n      } else if (fillIndex === -1 && strokeIndex > -1) {\n        value = \"stroke\";\n      }\n    } else if (attr === \"href\" || attr === \"xlink:href\" || attr === \"font\") {\n      return value;\n    } else if (attr === \"imageSmoothing\") {\n      return value === \"optimizeQuality\" ? true : false;\n    } else {\n      parsed = isArray ? value.map(parseUnit) : parseUnit(value, fontSize);\n    }\n\n    return !isArray && isNaN(parsed) ? value : parsed;\n  }\n\n  /**\n   * @private\n   */\n  function getSvgRegex(arr) {\n    return new RegExp(\"^(\" + arr.join(\"|\") + \")\\\\b\", \"i\");\n  }\n\n  /**\n   * @private\n   * @param {Object} attributes Array of attributes to parse\n   */\n  function _setStrokeFillOpacity(attributes) {\n    for (var attr in colorAttributes) {\n      if (\n        typeof attributes[colorAttributes[attr]] === \"undefined\" ||\n        attributes[attr] === \"\"\n      ) {\n        continue;\n      }\n\n      if (typeof attributes[attr] === \"undefined\") {\n        if (!fabric.Object.prototype[attr]) {\n          continue;\n        }\n        attributes[attr] = fabric.Object.prototype[attr];\n      }\n\n      if (attributes[attr].indexOf(\"url(\") === 0) {\n        continue;\n      }\n\n      var color = new fabric.Color(attributes[attr]);\n      attributes[attr] = color\n        .setAlpha(\n          toFixed(color.getAlpha() * attributes[colorAttributes[attr]], 2)\n        )\n        .toRgba();\n    }\n    return attributes;\n  }\n\n  /**\n   * @private\n   */\n  function _getMultipleNodes(doc, nodeNames) {\n    var nodeName,\n      nodeArray = [],\n      nodeList,\n      i,\n      len;\n    for (i = 0, len = nodeNames.length; i < len; i++) {\n      nodeName = nodeNames[i];\n      nodeList = doc.getElementsByTagName(nodeName);\n      nodeArray = nodeArray.concat(Array.prototype.slice.call(nodeList));\n    }\n    return nodeArray;\n  }\n\n  /**\n   * Parses \"transform\" attribute, returning an array of values\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {String} attributeValue String containing attribute value\n   * @return {Array} Array of 6 elements representing transformation matrix\n   */\n  fabric.parseTransformAttribute = (function () {\n    function rotateMatrix(matrix, args) {\n      var cos = fabric.util.cos(args[0]),\n        sin = fabric.util.sin(args[0]),\n        x = 0,\n        y = 0;\n      if (args.length === 3) {\n        x = args[1];\n        y = args[2];\n      }\n\n      matrix[0] = cos;\n      matrix[1] = sin;\n      matrix[2] = -sin;\n      matrix[3] = cos;\n      matrix[4] = x - (cos * x - sin * y);\n      matrix[5] = y - (sin * x + cos * y);\n    }\n\n    function scaleMatrix(matrix, args) {\n      var multiplierX = args[0],\n        multiplierY = args.length === 2 ? args[1] : args[0];\n\n      matrix[0] = multiplierX;\n      matrix[3] = multiplierY;\n    }\n\n    function skewMatrix(matrix, args, pos) {\n      matrix[pos] = Math.tan(fabric.util.degreesToRadians(args[0]));\n    }\n\n    function translateMatrix(matrix, args) {\n      matrix[4] = args[0];\n      if (args.length === 2) {\n        matrix[5] = args[1];\n      }\n    }\n\n    // identity matrix\n    var iMatrix = fabric.iMatrix,\n      // == begin transform regexp\n      number = fabric.reNum,\n      commaWsp = \"(?:\\\\s+,?\\\\s*|,\\\\s*)\",\n      skewX = \"(?:(skewX)\\\\s*\\\\(\\\\s*(\" + number + \")\\\\s*\\\\))\",\n      skewY = \"(?:(skewY)\\\\s*\\\\(\\\\s*(\" + number + \")\\\\s*\\\\))\",\n      rotate =\n        \"(?:(rotate)\\\\s*\\\\(\\\\s*(\" +\n        number +\n        \")(?:\" +\n        commaWsp +\n        \"(\" +\n        number +\n        \")\" +\n        commaWsp +\n        \"(\" +\n        number +\n        \"))?\\\\s*\\\\))\",\n      scale =\n        \"(?:(scale)\\\\s*\\\\(\\\\s*(\" +\n        number +\n        \")(?:\" +\n        commaWsp +\n        \"(\" +\n        number +\n        \"))?\\\\s*\\\\))\",\n      translate =\n        \"(?:(translate)\\\\s*\\\\(\\\\s*(\" +\n        number +\n        \")(?:\" +\n        commaWsp +\n        \"(\" +\n        number +\n        \"))?\\\\s*\\\\))\",\n      matrix =\n        \"(?:(matrix)\\\\s*\\\\(\\\\s*\" +\n        \"(\" +\n        number +\n        \")\" +\n        commaWsp +\n        \"(\" +\n        number +\n        \")\" +\n        commaWsp +\n        \"(\" +\n        number +\n        \")\" +\n        commaWsp +\n        \"(\" +\n        number +\n        \")\" +\n        commaWsp +\n        \"(\" +\n        number +\n        \")\" +\n        commaWsp +\n        \"(\" +\n        number +\n        \")\" +\n        \"\\\\s*\\\\))\",\n      transform =\n        \"(?:\" +\n        matrix +\n        \"|\" +\n        translate +\n        \"|\" +\n        scale +\n        \"|\" +\n        rotate +\n        \"|\" +\n        skewX +\n        \"|\" +\n        skewY +\n        \")\",\n      transforms =\n        \"(?:\" + transform + \"(?:\" + commaWsp + \"*\" + transform + \")*\" + \")\",\n      transformList = \"^\\\\s*(?:\" + transforms + \"?)\\\\s*$\",\n      // http://www.w3.org/TR/SVG/coords.html#TransformAttribute\n      reTransformList = new RegExp(transformList),\n      // == end transform regexp\n\n      reTransform = new RegExp(transform, \"g\");\n\n    return function (attributeValue) {\n      // start with identity matrix\n      var matrix = iMatrix.concat(),\n        matrices = [];\n\n      // return if no argument was given or\n      // an argument does not match transform attribute regexp\n      if (\n        !attributeValue ||\n        (attributeValue && !reTransformList.test(attributeValue))\n      ) {\n        return matrix;\n      }\n\n      attributeValue.replace(reTransform, function (match) {\n        var m = new RegExp(transform).exec(match).filter(function (match) {\n            // match !== '' && match != null\n            return !!match;\n          }),\n          operation = m[1],\n          args = m.slice(2).map(parseFloat);\n\n        switch (operation) {\n          case \"translate\":\n            translateMatrix(matrix, args);\n            break;\n          case \"rotate\":\n            args[0] = fabric.util.degreesToRadians(args[0]);\n            rotateMatrix(matrix, args);\n            break;\n          case \"scale\":\n            scaleMatrix(matrix, args);\n            break;\n          case \"skewX\":\n            skewMatrix(matrix, args, 2);\n            break;\n          case \"skewY\":\n            skewMatrix(matrix, args, 1);\n            break;\n          case \"matrix\":\n            matrix = args;\n            break;\n        }\n\n        // snapshot current matrix into matrices array\n        matrices.push(matrix.concat());\n        // reset\n        matrix = iMatrix.concat();\n      });\n\n      var combinedMatrix = matrices[0];\n      while (matrices.length > 1) {\n        matrices.shift();\n        combinedMatrix = fabric.util.multiplyTransformMatrices(\n          combinedMatrix,\n          matrices[0]\n        );\n      }\n      return combinedMatrix;\n    };\n  })();\n\n  /**\n   * @private\n   */\n  function parseStyleString(style, oStyle) {\n    var attr, value;\n    style\n      .replace(/;\\s*$/, \"\")\n      .split(\";\")\n      .forEach(function (chunk) {\n        var pair = chunk.split(\":\");\n\n        attr = pair[0].trim().toLowerCase();\n        value = pair[1].trim();\n\n        oStyle[attr] = value;\n      });\n  }\n\n  /**\n   * @private\n   */\n  function parseStyleObject(style, oStyle) {\n    var attr, value;\n    for (var prop in style) {\n      if (typeof style[prop] === \"undefined\") {\n        continue;\n      }\n\n      attr = prop.toLowerCase();\n      value = style[prop];\n\n      oStyle[attr] = value;\n    }\n  }\n\n  /**\n   * @private\n   */\n  function getGlobalStylesForElement(element, svgUid) {\n    var styles = {};\n    for (var rule in fabric.cssRules[svgUid]) {\n      if (elementMatchesRule(element, rule.split(\" \"))) {\n        for (var property in fabric.cssRules[svgUid][rule]) {\n          styles[property] = fabric.cssRules[svgUid][rule][property];\n        }\n      }\n    }\n    return styles;\n  }\n\n  /**\n   * @private\n   */\n  function elementMatchesRule(element, selectors) {\n    var firstMatching,\n      parentMatching = true;\n    //start from rightmost selector.\n    firstMatching = selectorMatches(element, selectors.pop());\n    if (firstMatching && selectors.length) {\n      parentMatching = doesSomeParentMatch(element, selectors);\n    }\n    return firstMatching && parentMatching && selectors.length === 0;\n  }\n\n  function doesSomeParentMatch(element, selectors) {\n    var selector,\n      parentMatching = true;\n    while (\n      element.parentNode &&\n      element.parentNode.nodeType === 1 &&\n      selectors.length\n    ) {\n      if (parentMatching) {\n        selector = selectors.pop();\n      }\n      element = element.parentNode;\n      parentMatching = selectorMatches(element, selector);\n    }\n    return selectors.length === 0;\n  }\n\n  /**\n   * @private\n   */\n  function selectorMatches(element, selector) {\n    var nodeName = element.nodeName,\n      classNames = element.getAttribute(\"class\"),\n      id = element.getAttribute(\"id\"),\n      matcher,\n      i;\n    // i check if a selector matches slicing away part from it.\n    // if i get empty string i should match\n    matcher = new RegExp(\"^\" + nodeName, \"i\");\n    selector = selector.replace(matcher, \"\");\n    if (id && selector.length) {\n      matcher = new RegExp(\"#\" + id + \"(?![a-zA-Z\\\\-]+)\", \"i\");\n      selector = selector.replace(matcher, \"\");\n    }\n    if (classNames && selector.length) {\n      classNames = classNames.split(\" \");\n      for (i = classNames.length; i--; ) {\n        matcher = new RegExp(\"\\\\.\" + classNames[i] + \"(?![a-zA-Z\\\\-]+)\", \"i\");\n        selector = selector.replace(matcher, \"\");\n      }\n    }\n    return selector.length === 0;\n  }\n\n  /**\n   * @private\n   * to support IE8 missing getElementById on SVGdocument and on node xmlDOM\n   */\n  function elementById(doc, id) {\n    var el;\n    doc.getElementById && (el = doc.getElementById(id));\n    if (el) {\n      return el;\n    }\n    var node,\n      i,\n      len,\n      nodelist = doc.getElementsByTagName(\"*\");\n    for (i = 0, len = nodelist.length; i < len; i++) {\n      node = nodelist[i];\n      if (id === node.getAttribute(\"id\")) {\n        return node;\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  function parseUseDirectives(doc) {\n    var nodelist = _getMultipleNodes(doc, [\"use\", \"svg:use\"]),\n      i = 0;\n    while (nodelist.length && i < nodelist.length) {\n      var el = nodelist[i],\n        xlink = (\n          el.getAttribute(\"xlink:href\") || el.getAttribute(\"href\")\n        ).substr(1),\n        x = el.getAttribute(\"x\") || 0,\n        y = el.getAttribute(\"y\") || 0,\n        el2 = elementById(doc, xlink).cloneNode(true),\n        currentTrans =\n          (el2.getAttribute(\"transform\") || \"\") +\n          \" translate(\" +\n          x +\n          \", \" +\n          y +\n          \")\",\n        parentNode,\n        oldLength = nodelist.length,\n        attr,\n        j,\n        attrs,\n        len,\n        namespace = fabric.svgNS;\n\n      applyViewboxTransform(el2);\n      if (/^svg$/i.test(el2.nodeName)) {\n        var el3 = el2.ownerDocument.createElementNS(namespace, \"g\");\n        for (j = 0, attrs = el2.attributes, len = attrs.length; j < len; j++) {\n          attr = attrs.item(j);\n          el3.setAttributeNS(namespace, attr.nodeName, attr.nodeValue);\n        }\n        // el2.firstChild != null\n        while (el2.firstChild) {\n          el3.appendChild(el2.firstChild);\n        }\n        el2 = el3;\n      }\n\n      for (j = 0, attrs = el.attributes, len = attrs.length; j < len; j++) {\n        attr = attrs.item(j);\n        if (\n          attr.nodeName === \"x\" ||\n          attr.nodeName === \"y\" ||\n          attr.nodeName === \"xlink:href\" ||\n          attr.nodeName === \"href\"\n        ) {\n          continue;\n        }\n\n        if (attr.nodeName === \"transform\") {\n          currentTrans = attr.nodeValue + \" \" + currentTrans;\n        } else {\n          el2.setAttribute(attr.nodeName, attr.nodeValue);\n        }\n      }\n\n      el2.setAttribute(\"transform\", currentTrans);\n      el2.setAttribute(\"instantiated_by_use\", \"1\");\n      el2.removeAttribute(\"id\");\n      parentNode = el.parentNode;\n      parentNode.replaceChild(el2, el);\n      // some browsers do not shorten nodelist after replaceChild (IE8)\n      if (nodelist.length === oldLength) {\n        i++;\n      }\n    }\n  }\n\n  // http://www.w3.org/TR/SVG/coords.html#ViewBoxAttribute\n  // matches, e.g.: +14.56e-12, etc.\n  var reViewBoxAttrValue = new RegExp(\n    \"^\" +\n      \"\\\\s*(\" +\n      fabric.reNum +\n      \"+)\\\\s*,?\" +\n      \"\\\\s*(\" +\n      fabric.reNum +\n      \"+)\\\\s*,?\" +\n      \"\\\\s*(\" +\n      fabric.reNum +\n      \"+)\\\\s*,?\" +\n      \"\\\\s*(\" +\n      fabric.reNum +\n      \"+)\\\\s*\" +\n      \"$\"\n  );\n\n  /**\n   * Add a <g> element that envelop all child elements and makes the viewbox transformMatrix descend on all elements\n   */\n  function applyViewboxTransform(element) {\n    if (!fabric.svgViewBoxElementsRegEx.test(element.nodeName)) {\n      return;\n    }\n    var viewBoxAttr = element.getAttribute(\"viewBox\"),\n      scaleX = 1,\n      scaleY = 1,\n      minX = 0,\n      minY = 0,\n      viewBoxWidth,\n      viewBoxHeight,\n      matrix,\n      el,\n      widthAttr = element.getAttribute(\"width\"),\n      heightAttr = element.getAttribute(\"height\"),\n      x = element.getAttribute(\"x\") || 0,\n      y = element.getAttribute(\"y\") || 0,\n      preserveAspectRatio = element.getAttribute(\"preserveAspectRatio\") || \"\",\n      missingViewBox =\n        !viewBoxAttr || !(viewBoxAttr = viewBoxAttr.match(reViewBoxAttrValue)),\n      missingDimAttr =\n        !widthAttr ||\n        !heightAttr ||\n        widthAttr === \"100%\" ||\n        heightAttr === \"100%\",\n      toBeParsed = missingViewBox && missingDimAttr,\n      parsedDim = {},\n      translateMatrix = \"\",\n      widthDiff = 0,\n      heightDiff = 0;\n\n    parsedDim.width = 0;\n    parsedDim.height = 0;\n    parsedDim.toBeParsed = toBeParsed;\n\n    if (missingViewBox) {\n      if ((x || y) && element.parentNode.nodeName !== \"#document\") {\n        translateMatrix =\n          \" translate(\" + parseUnit(x) + \" \" + parseUnit(y) + \") \";\n        matrix = (element.getAttribute(\"transform\") || \"\") + translateMatrix;\n        element.setAttribute(\"transform\", matrix);\n        element.removeAttribute(\"x\");\n        element.removeAttribute(\"y\");\n      }\n    }\n\n    if (toBeParsed) {\n      return parsedDim;\n    }\n\n    if (missingViewBox) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      // set a transform for elements that have x y and are inner(only) SVGs\n      return parsedDim;\n    }\n    minX = -parseFloat(viewBoxAttr[1]);\n    minY = -parseFloat(viewBoxAttr[2]);\n    viewBoxWidth = parseFloat(viewBoxAttr[3]);\n    viewBoxHeight = parseFloat(viewBoxAttr[4]);\n    parsedDim.minX = minX;\n    parsedDim.minY = minY;\n    parsedDim.viewBoxWidth = viewBoxWidth;\n    parsedDim.viewBoxHeight = viewBoxHeight;\n    if (!missingDimAttr) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      scaleX = parsedDim.width / viewBoxWidth;\n      scaleY = parsedDim.height / viewBoxHeight;\n    } else {\n      parsedDim.width = viewBoxWidth;\n      parsedDim.height = viewBoxHeight;\n    }\n\n    // default is to preserve aspect ratio\n    preserveAspectRatio = fabric.util.parsePreserveAspectRatioAttribute(\n      preserveAspectRatio\n    );\n    if (preserveAspectRatio.alignX !== \"none\") {\n      //translate all container for the effect of Mid, Min, Max\n      if (preserveAspectRatio.meetOrSlice === \"meet\") {\n        scaleY = scaleX = scaleX > scaleY ? scaleY : scaleX;\n        // calculate additional translation to move the viewbox\n      }\n      if (preserveAspectRatio.meetOrSlice === \"slice\") {\n        scaleY = scaleX = scaleX > scaleY ? scaleX : scaleY;\n        // calculate additional translation to move the viewbox\n      }\n      widthDiff = parsedDim.width - viewBoxWidth * scaleX;\n      heightDiff = parsedDim.height - viewBoxHeight * scaleX;\n      if (preserveAspectRatio.alignX === \"Mid\") {\n        widthDiff /= 2;\n      }\n      if (preserveAspectRatio.alignY === \"Mid\") {\n        heightDiff /= 2;\n      }\n      if (preserveAspectRatio.alignX === \"Min\") {\n        widthDiff = 0;\n      }\n      if (preserveAspectRatio.alignY === \"Min\") {\n        heightDiff = 0;\n      }\n    }\n\n    if (\n      scaleX === 1 &&\n      scaleY === 1 &&\n      minX === 0 &&\n      minY === 0 &&\n      x === 0 &&\n      y === 0\n    ) {\n      return parsedDim;\n    }\n    if ((x || y) && element.parentNode.nodeName !== \"#document\") {\n      translateMatrix =\n        \" translate(\" + parseUnit(x) + \" \" + parseUnit(y) + \") \";\n    }\n\n    matrix =\n      translateMatrix +\n      \" matrix(\" +\n      scaleX +\n      \" 0\" +\n      \" 0 \" +\n      scaleY +\n      \" \" +\n      (minX * scaleX + widthDiff) +\n      \" \" +\n      (minY * scaleY + heightDiff) +\n      \") \";\n    // seems unused.\n    // parsedDim.viewboxTransform = fabric.parseTransformAttribute(matrix);\n    if (element.nodeName === \"svg\") {\n      el = element.ownerDocument.createElementNS(fabric.svgNS, \"g\");\n      // element.firstChild != null\n      while (element.firstChild) {\n        el.appendChild(element.firstChild);\n      }\n      element.appendChild(el);\n    } else {\n      el = element;\n      el.removeAttribute(\"x\");\n      el.removeAttribute(\"y\");\n      matrix = el.getAttribute(\"transform\") + matrix;\n    }\n    el.setAttribute(\"transform\", matrix);\n    return parsedDim;\n  }\n\n  function hasAncestorWithNodeName(element, nodeName) {\n    while (element && (element = element.parentNode)) {\n      if (\n        element.nodeName &&\n        nodeName.test(element.nodeName.replace(\"svg:\", \"\")) &&\n        !element.getAttribute(\"instantiated_by_use\")\n      ) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Parses an SVG document, converts it to an array of corresponding fabric.* instances and passes them to a callback\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {SVGDocument} doc SVG document to parse\n   * @param {Function} callback Callback to call when parsing is finished;\n   * It's being passed an array of elements (parsed from a document).\n   * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n   * @param {Object} [parsingOptions] options for parsing document\n   * @param {String} [parsingOptions.crossOrigin] crossOrigin settings\n   */\n  fabric.parseSVGDocument = function (doc, callback, reviver, parsingOptions) {\n    if (!doc) {\n      return;\n    }\n\n    parseUseDirectives(doc);\n\n    var svgUid = fabric.Object.__uid++,\n      i,\n      len,\n      options = applyViewboxTransform(doc),\n      descendants = fabric.util.toArray(doc.getElementsByTagName(\"*\"));\n    options.crossOrigin = parsingOptions && parsingOptions.crossOrigin;\n    options.svgUid = svgUid;\n\n    if (descendants.length === 0 && fabric.isLikelyNode) {\n      // we're likely in node, where \"o3-xml\" library fails to gEBTN(\"*\")\n      // https://github.com/ajaxorg/node-o3-xml/issues/21\n      descendants = doc.selectNodes('//*[name(.)!=\"svg\"]');\n      var arr = [];\n      for (i = 0, len = descendants.length; i < len; i++) {\n        arr[i] = descendants[i];\n      }\n      descendants = arr;\n    }\n\n    var elements = descendants.filter(function (el) {\n      applyViewboxTransform(el);\n      return (\n        fabric.svgValidTagNamesRegEx.test(el.nodeName.replace(\"svg:\", \"\")) &&\n        !hasAncestorWithNodeName(el, fabric.svgInvalidAncestorsRegEx)\n      ); // http://www.w3.org/TR/SVG/struct.html#DefsElement\n    });\n    if (!elements || (elements && !elements.length)) {\n      callback && callback([], {});\n      return;\n    }\n    var clipPaths = {};\n    descendants\n      .filter(function (el) {\n        return el.nodeName.replace(\"svg:\", \"\") === \"clipPath\";\n      })\n      .forEach(function (el) {\n        var id = el.getAttribute(\"id\");\n        clipPaths[id] = fabric.util\n          .toArray(el.getElementsByTagName(\"*\"))\n          .filter(function (el) {\n            return fabric.svgValidTagNamesRegEx.test(\n              el.nodeName.replace(\"svg:\", \"\")\n            );\n          });\n      });\n    fabric.gradientDefs[svgUid] = fabric.getGradientDefs(doc);\n    fabric.cssRules[svgUid] = fabric.getCSSRules(doc);\n    fabric.clipPaths[svgUid] = clipPaths;\n    // Precedence of rules:   style > class > attribute\n    fabric.parseElements(\n      elements,\n      function (instances, elements) {\n        if (callback) {\n          callback(instances, options, elements, descendants);\n          delete fabric.gradientDefs[svgUid];\n          delete fabric.cssRules[svgUid];\n          delete fabric.clipPaths[svgUid];\n        }\n      },\n      clone(options),\n      reviver,\n      parsingOptions\n    );\n  };\n\n  function recursivelyParseGradientsXlink(doc, gradient) {\n    var gradientsAttrs = [\n        \"gradientTransform\",\n        \"x1\",\n        \"x2\",\n        \"y1\",\n        \"y2\",\n        \"gradientUnits\",\n        \"cx\",\n        \"cy\",\n        \"r\",\n        \"fx\",\n        \"fy\",\n      ],\n      xlinkAttr = \"xlink:href\",\n      xLink = gradient.getAttribute(xlinkAttr).substr(1),\n      referencedGradient = elementById(doc, xLink);\n    if (referencedGradient && referencedGradient.getAttribute(xlinkAttr)) {\n      recursivelyParseGradientsXlink(doc, referencedGradient);\n    }\n    gradientsAttrs.forEach(function (attr) {\n      if (\n        referencedGradient &&\n        !gradient.hasAttribute(attr) &&\n        referencedGradient.hasAttribute(attr)\n      ) {\n        gradient.setAttribute(attr, referencedGradient.getAttribute(attr));\n      }\n    });\n    if (!gradient.children.length) {\n      var referenceClone = referencedGradient.cloneNode(true);\n      while (referenceClone.firstChild) {\n        gradient.appendChild(referenceClone.firstChild);\n      }\n    }\n    gradient.removeAttribute(xlinkAttr);\n  }\n\n  var reFontDeclaration = new RegExp(\n    \"(normal|italic)?\\\\s*(normal|small-caps)?\\\\s*\" +\n      \"(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\\\s*(\" +\n      fabric.reNum +\n      \"(?:px|cm|mm|em|pt|pc|in)*)(?:\\\\/(normal|\" +\n      fabric.reNum +\n      \"))?\\\\s+(.*)\"\n  );\n\n  extend(fabric, {\n    /**\n     * Parses a short font declaration, building adding its properties to a style object\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {String} value font declaration\n     * @param {Object} oStyle definition\n     */\n    parseFontDeclaration: function (value, oStyle) {\n      var match = value.match(reFontDeclaration);\n\n      if (!match) {\n        return;\n      }\n      var fontStyle = match[1],\n        // font variant is not used\n        // fontVariant = match[2],\n        fontWeight = match[3],\n        fontSize = match[4],\n        lineHeight = match[5],\n        fontFamily = match[6];\n\n      if (fontStyle) {\n        oStyle.fontStyle = fontStyle;\n      }\n      if (fontWeight) {\n        oStyle.fontWeight = isNaN(parseFloat(fontWeight))\n          ? fontWeight\n          : parseFloat(fontWeight);\n      }\n      if (fontSize) {\n        oStyle.fontSize = parseUnit(fontSize);\n      }\n      if (fontFamily) {\n        oStyle.fontFamily = fontFamily;\n      }\n      if (lineHeight) {\n        oStyle.lineHeight = lineHeight === \"normal\" ? 1 : lineHeight;\n      }\n    },\n\n    /**\n     * Parses an SVG document, returning all of the gradient declarations found in it\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} Gradient definitions; key corresponds to element id, value -- to gradient definition element\n     */\n    getGradientDefs: function (doc) {\n      var tagArray = [\n          \"linearGradient\",\n          \"radialGradient\",\n          \"svg:linearGradient\",\n          \"svg:radialGradient\",\n        ],\n        elList = _getMultipleNodes(doc, tagArray),\n        el,\n        j = 0,\n        gradientDefs = {};\n      j = elList.length;\n      while (j--) {\n        el = elList[j];\n        if (el.getAttribute(\"xlink:href\")) {\n          recursivelyParseGradientsXlink(doc, el);\n        }\n        gradientDefs[el.getAttribute(\"id\")] = el;\n      }\n      return gradientDefs;\n    },\n\n    /**\n     * Returns an object of attributes' name/value, given element and an array of attribute names;\n     * Parses parent \"g\" nodes recursively upwards.\n     * @static\n     * @memberOf fabric\n     * @param {DOMElement} element Element to parse\n     * @param {Array} attributes Array of attributes to parse\n     * @return {Object} object containing parsed attributes' names/values\n     */\n    parseAttributes: function (element, attributes, svgUid) {\n      if (!element) {\n        return;\n      }\n\n      var value,\n        parentAttributes = {},\n        fontSize,\n        parentFontSize;\n\n      if (typeof svgUid === \"undefined\") {\n        svgUid = element.getAttribute(\"svgUid\");\n      }\n      // if there's a parent container (`g` or `a` or `symbol` node), parse its attributes recursively upwards\n      if (\n        element.parentNode &&\n        fabric.svgValidParentsRegEx.test(element.parentNode.nodeName)\n      ) {\n        parentAttributes = fabric.parseAttributes(\n          element.parentNode,\n          attributes,\n          svgUid\n        );\n      }\n\n      var ownAttributes = attributes.reduce(function (memo, attr) {\n        value = element.getAttribute(attr);\n        if (value) {\n          // eslint-disable-line\n          memo[attr] = value;\n        }\n        return memo;\n      }, {});\n      // add values parsed from style, which take precedence over attributes\n      // (see: http://www.w3.org/TR/SVG/styling.html#UsingPresentationAttributes)\n      var cssAttrs = extend(\n        getGlobalStylesForElement(element, svgUid),\n        fabric.parseStyleAttribute(element)\n      );\n      ownAttributes = extend(ownAttributes, cssAttrs);\n      if (cssAttrs[cPath]) {\n        element.setAttribute(cPath, cssAttrs[cPath]);\n      }\n      fontSize = parentFontSize =\n        parentAttributes.fontSize || fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      if (ownAttributes[fSize]) {\n        // looks like the minimum should be 9px when dealing with ems. this is what looks like in browsers.\n        ownAttributes[fSize] = fontSize = parseUnit(\n          ownAttributes[fSize],\n          parentFontSize\n        );\n      }\n\n      var normalizedAttr,\n        normalizedValue,\n        normalizedStyle = {};\n      for (var attr in ownAttributes) {\n        normalizedAttr = normalizeAttr(attr);\n        normalizedValue = normalizeValue(\n          normalizedAttr,\n          ownAttributes[attr],\n          parentAttributes,\n          fontSize\n        );\n        normalizedStyle[normalizedAttr] = normalizedValue;\n      }\n      if (normalizedStyle && normalizedStyle.font) {\n        fabric.parseFontDeclaration(normalizedStyle.font, normalizedStyle);\n      }\n      var mergedAttrs = extend(parentAttributes, normalizedStyle);\n      return fabric.svgValidParentsRegEx.test(element.nodeName)\n        ? mergedAttrs\n        : _setStrokeFillOpacity(mergedAttrs);\n    },\n\n    /**\n     * Transforms an array of svg elements to corresponding fabric.* instances\n     * @static\n     * @memberOf fabric\n     * @param {Array} elements Array of elements to parse\n     * @param {Function} callback Being passed an array of fabric instances (transformed from SVG elements)\n     * @param {Object} [options] Options object\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     */\n    parseElements: function (\n      elements,\n      callback,\n      options,\n      reviver,\n      parsingOptions\n    ) {\n      new fabric.ElementsParser(\n        elements,\n        callback,\n        options,\n        reviver,\n        parsingOptions\n      ).parse();\n    },\n\n    /**\n     * Parses \"style\" attribute, retuning an object with values\n     * @static\n     * @memberOf fabric\n     * @param {SVGElement} element Element to parse\n     * @return {Object} Objects with values parsed from style attribute of an element\n     */\n    parseStyleAttribute: function (element) {\n      var oStyle = {},\n        style = element.getAttribute(\"style\");\n\n      if (!style) {\n        return oStyle;\n      }\n\n      if (typeof style === \"string\") {\n        parseStyleString(style, oStyle);\n      } else {\n        parseStyleObject(style, oStyle);\n      }\n\n      return oStyle;\n    },\n\n    /**\n     * Parses \"points\" attribute, returning an array of values\n     * @static\n     * @memberOf fabric\n     * @param {String} points points attribute string\n     * @return {Array} array of points\n     */\n    parsePointsAttribute: function (points) {\n      // points attribute is required and must not be empty\n      if (!points) {\n        return null;\n      }\n\n      // replace commas with whitespace and remove bookending whitespace\n      points = points.replace(/,/g, \" \").trim();\n\n      points = points.split(/\\s+/);\n      var parsedPoints = [],\n        i,\n        len;\n\n      for (i = 0, len = points.length; i < len; i += 2) {\n        parsedPoints.push({\n          x: parseFloat(points[i]),\n          y: parseFloat(points[i + 1]),\n        });\n      }\n\n      // odd number of points is an error\n      // if (parsedPoints.length % 2 !== 0) {\n      //   return null;\n      // }\n\n      return parsedPoints;\n    },\n\n    /**\n     * Returns CSS rules for a given SVG document\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} CSS rules of this document\n     */\n    getCSSRules: function (doc) {\n      var styles = doc.getElementsByTagName(\"style\"),\n        i,\n        len,\n        allRules = {},\n        rules;\n\n      // very crude parsing of style contents\n      for (i = 0, len = styles.length; i < len; i++) {\n        // <style/> could produce `undefined`, covering this case with ''\n        var styleContents = styles[i].textContent || \"\";\n\n        // remove comments\n        styleContents = styleContents.replace(/\\/\\*[\\s\\S]*?\\*\\//g, \"\");\n        if (styleContents.trim() === \"\") {\n          continue;\n        }\n        rules = styleContents.match(/[^{]*\\{[\\s\\S]*?\\}/g);\n        rules = rules.map(function (rule) {\n          return rule.trim();\n        });\n        // eslint-disable-next-line no-loop-func\n        rules.forEach(function (rule) {\n          var match = rule.match(/([\\s\\S]*?)\\s*\\{([^}]*)\\}/),\n            ruleObj = {},\n            declaration = match[2].trim(),\n            propertyValuePairs = declaration.replace(/;$/, \"\").split(/\\s*;\\s*/);\n\n          for (i = 0, len = propertyValuePairs.length; i < len; i++) {\n            var pair = propertyValuePairs[i].split(/\\s*:\\s*/),\n              property = pair[0],\n              value = pair[1];\n            ruleObj[property] = value;\n          }\n          rule = match[1];\n          rule.split(\",\").forEach(function (_rule) {\n            _rule = _rule.replace(/^svg/i, \"\").trim();\n            if (_rule === \"\") {\n              return;\n            }\n            if (allRules[_rule]) {\n              fabric.util.object.extend(allRules[_rule], ruleObj);\n            } else {\n              allRules[_rule] = fabric.util.object.clone(ruleObj);\n            }\n          });\n        });\n      }\n      return allRules;\n    },\n\n    /**\n     * Takes url corresponding to an SVG document, and parses it into a set of fabric objects.\n     * Note that SVG is fetched via XMLHttpRequest, so it needs to conform to SOP (Same Origin Policy)\n     * @memberOf fabric\n     * @param {String} url\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromURL: function (url, callback, reviver, options) {\n      url = url.replace(/^\\n\\s*/, \"\").trim();\n      new fabric.util.request(url, {\n        method: \"get\",\n        onComplete: onComplete,\n      });\n\n      function onComplete(r) {\n        var xml = r.responseXML;\n        if (!xml || !xml.documentElement) {\n          callback && callback(null);\n          return false;\n        }\n\n        fabric.parseSVGDocument(\n          xml.documentElement,\n          function (results, _options, elements, allElements) {\n            callback && callback(results, _options, elements, allElements);\n          },\n          reviver,\n          options\n        );\n      }\n    },\n\n    /**\n     * Takes string corresponding to an SVG document, and parses it into a set of fabric objects\n     * @memberOf fabric\n     * @param {String} string\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromString: function (string, callback, reviver, options) {\n      var parser = new fabric.window.DOMParser(),\n        doc = parser.parseFromString(string.trim(), \"text/xml\");\n      fabric.parseSVGDocument(\n        doc.documentElement,\n        function (results, _options, elements, allElements) {\n          callback(results, _options, elements, allElements);\n        },\n        reviver,\n        options\n      );\n    },\n  });\n})(typeof exports !== \"undefined\" ? exports : this);\n\nfabric.ElementsParser = function (\n  elements,\n  callback,\n  options,\n  reviver,\n  parsingOptions,\n  doc\n) {\n  this.elements = elements;\n  this.callback = callback;\n  this.options = options;\n  this.reviver = reviver;\n  this.svgUid = (options && options.svgUid) || 0;\n  this.parsingOptions = parsingOptions;\n  this.regexUrl = /^url\\(['\"]?#([^'\"]+)['\"]?\\)/g;\n  this.doc = doc;\n};\n\n(function (proto) {\n  proto.parse = function () {\n    this.instances = new Array(this.elements.length);\n    this.numElements = this.elements.length;\n    this.createObjects();\n  };\n\n  proto.createObjects = function () {\n    var _this = this;\n    this.elements.forEach(function (element, i) {\n      element.setAttribute(\"svgUid\", _this.svgUid);\n      _this.createObject(element, i);\n    });\n  };\n\n  proto.findTag = function (el) {\n    return fabric[\n      fabric.util.string.capitalize(el.tagName.replace(\"svg:\", \"\"))\n    ];\n  };\n\n  proto.createObject = function (el, index) {\n    var klass = this.findTag(el);\n    if (klass && klass.fromElement) {\n      try {\n        klass.fromElement(el, this.createCallback(index, el), this.options);\n      } catch (err) {\n        fabric.log(err);\n      }\n    } else {\n      this.checkIfDone();\n    }\n  };\n\n  proto.createCallback = function (index, el) {\n    var _this = this;\n    return function (obj) {\n      var _options;\n      _this.resolveGradient(obj, el, \"fill\");\n      _this.resolveGradient(obj, el, \"stroke\");\n      if (obj instanceof fabric.Image && obj._originalElement) {\n        _options = obj.parsePreserveAspectRatioAttribute(el);\n      }\n      obj._removeTransformMatrix(_options);\n      _this.resolveClipPath(obj, el);\n      _this.reviver && _this.reviver(el, obj);\n      _this.instances[index] = obj;\n      _this.checkIfDone();\n    };\n  };\n\n  proto.extractPropertyDefinition = function (obj, property, storage) {\n    var value = obj[property],\n      regex = this.regexUrl;\n    if (!regex.test(value)) {\n      return;\n    }\n    regex.lastIndex = 0;\n    var id = regex.exec(value)[1];\n    regex.lastIndex = 0;\n    return fabric[storage][this.svgUid][id];\n  };\n\n  proto.resolveGradient = function (obj, el, property) {\n    var gradientDef = this.extractPropertyDefinition(\n      obj,\n      property,\n      \"gradientDefs\"\n    );\n    if (gradientDef) {\n      var opacityAttr = el.getAttribute(property + \"-opacity\");\n      var gradient = fabric.Gradient.fromElement(\n        gradientDef,\n        obj,\n        opacityAttr,\n        this.options\n      );\n      obj.set(property, gradient);\n    }\n  };\n\n  proto.createClipPathCallback = function (obj, container) {\n    return function (_newObj) {\n      _newObj._removeTransformMatrix();\n      _newObj.fillRule = _newObj.clipRule;\n      container.push(_newObj);\n    };\n  };\n\n  proto.resolveClipPath = function (obj, usingElement) {\n    var clipPath = this.extractPropertyDefinition(obj, \"clipPath\", \"clipPaths\"),\n      element,\n      klass,\n      objTransformInv,\n      container,\n      gTransform,\n      options;\n    if (clipPath) {\n      container = [];\n      objTransformInv = fabric.util.invertTransform(obj.calcTransformMatrix());\n      // move the clipPath tag as sibling to the real element that is using it\n      var clipPathTag = clipPath[0].parentNode;\n      var clipPathOwner = usingElement;\n      while (\n        clipPathOwner.parentNode &&\n        clipPathOwner.getAttribute(\"clip-path\") !== obj.clipPath\n      ) {\n        clipPathOwner = clipPathOwner.parentNode;\n      }\n      clipPathOwner.parentNode.appendChild(clipPathTag);\n      for (var i = 0; i < clipPath.length; i++) {\n        element = clipPath[i];\n        klass = this.findTag(element);\n        klass.fromElement(\n          element,\n          this.createClipPathCallback(obj, container),\n          this.options\n        );\n      }\n      if (container.length === 1) {\n        clipPath = container[0];\n      } else {\n        clipPath = new fabric.Group(container);\n      }\n      gTransform = fabric.util.multiplyTransformMatrices(\n        objTransformInv,\n        clipPath.calcTransformMatrix()\n      );\n      if (clipPath.clipPath) {\n        this.resolveClipPath(clipPath, clipPathOwner);\n      }\n      var options = fabric.util.qrDecompose(gTransform);\n      clipPath.flipX = false;\n      clipPath.flipY = false;\n      clipPath.set(\"scaleX\", options.scaleX);\n      clipPath.set(\"scaleY\", options.scaleY);\n      clipPath.angle = options.angle;\n      clipPath.skewX = options.skewX;\n      clipPath.skewY = 0;\n      clipPath.setPositionByOrigin(\n        { x: options.translateX, y: options.translateY },\n        \"center\",\n        \"center\"\n      );\n      obj.clipPath = clipPath;\n    } else {\n      // if clip-path does not resolve to any element, delete the property.\n      delete obj.clipPath;\n    }\n  };\n\n  proto.checkIfDone = function () {\n    if (--this.numElements === 0) {\n      this.instances = this.instances.filter(function (el) {\n        // eslint-disable-next-line no-eq-null, eqeqeq\n        return el != null;\n      });\n      this.callback(this.instances, this.elements);\n    }\n  };\n})(fabric.ElementsParser.prototype);\n\n(function (global) {\n  \"use strict\";\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  if (fabric.Point) {\n    fabric.warn(\"fabric.Point is already defined\");\n    return;\n  }\n\n  fabric.Point = Point;\n\n  /**\n   * Point class\n   * @class fabric.Point\n   * @memberOf fabric\n   * @constructor\n   * @param {Number} x\n   * @param {Number} y\n   * @return {fabric.Point} thisArg\n   */\n  function Point(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  Point.prototype = /** @lends fabric.Point.prototype */ {\n    type: \"point\",\n\n    constructor: Point,\n\n    /**\n     * Adds another point to this one and returns another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point instance with added values\n     */\n    add: function (that) {\n      return new Point(this.x + that.x, this.y + that.y);\n    },\n\n    /**\n     * Adds another point to this one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    addEquals: function (that) {\n      this.x += that.x;\n      this.y += that.y;\n      return this;\n    },\n\n    /**\n     * Adds value to this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point} new Point with added value\n     */\n    scalarAdd: function (scalar) {\n      return new Point(this.x + scalar, this.y + scalar);\n    },\n\n    /**\n     * Adds value to this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarAddEquals: function (scalar) {\n      this.x += scalar;\n      this.y += scalar;\n      return this;\n    },\n\n    /**\n     * Subtracts another point from this point and returns a new one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point object with subtracted values\n     */\n    subtract: function (that) {\n      return new Point(this.x - that.x, this.y - that.y);\n    },\n\n    /**\n     * Subtracts another point from this point\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    subtractEquals: function (that) {\n      this.x -= that.x;\n      this.y -= that.y;\n      return this;\n    },\n\n    /**\n     * Subtracts value from this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    scalarSubtract: function (scalar) {\n      return new Point(this.x - scalar, this.y - scalar);\n    },\n\n    /**\n     * Subtracts value from this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarSubtractEquals: function (scalar) {\n      this.x -= scalar;\n      this.y -= scalar;\n      return this;\n    },\n\n    /**\n     * Multiplies this point by a value and returns a new one\n     * TODO: rename in scalarMultiply in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    multiply: function (scalar) {\n      return new Point(this.x * scalar, this.y * scalar);\n    },\n\n    /**\n     * Multiplies this point by a value\n     * TODO: rename in scalarMultiplyEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    multiplyEquals: function (scalar) {\n      this.x *= scalar;\n      this.y *= scalar;\n      return this;\n    },\n\n    /**\n     * Divides this point by a value and returns a new one\n     * TODO: rename in scalarDivide in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    divide: function (scalar) {\n      return new Point(this.x / scalar, this.y / scalar);\n    },\n\n    /**\n     * Divides this point by a value\n     * TODO: rename in scalarDivideEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    divideEquals: function (scalar) {\n      this.x /= scalar;\n      this.y /= scalar;\n      return this;\n    },\n\n    /**\n     * Returns true if this point is equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    eq: function (that) {\n      return this.x === that.x && this.y === that.y;\n    },\n\n    /**\n     * Returns true if this point is less than another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lt: function (that) {\n      return this.x < that.x && this.y < that.y;\n    },\n\n    /**\n     * Returns true if this point is less than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lte: function (that) {\n      return this.x <= that.x && this.y <= that.y;\n    },\n\n    /**\n    \n         * Returns true if this point is greater another one\n         * @param {fabric.Point} that\n         * @return {Boolean}\n         */\n    gt: function (that) {\n      return this.x > that.x && this.y > that.y;\n    },\n\n    /**\n     * Returns true if this point is greater than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gte: function (that) {\n      return this.x >= that.x && this.y >= that.y;\n    },\n\n    /**\n     * Returns new point which is the result of linear interpolation with this one and another one\n     * @param {fabric.Point} that\n     * @param {Number} t , position of interpolation, between 0 and 1 default 0.5\n     * @return {fabric.Point}\n     */\n    lerp: function (that, t) {\n      if (typeof t === \"undefined\") {\n        t = 0.5;\n      }\n      t = Math.max(Math.min(1, t), 0);\n      return new Point(\n        this.x + (that.x - this.x) * t,\n        this.y + (that.y - this.y) * t\n      );\n    },\n\n    /**\n     * Returns distance from this point and another one\n     * @param {fabric.Point} that\n     * @return {Number}\n     */\n    distanceFrom: function (that) {\n      var dx = this.x - that.x,\n        dy = this.y - that.y;\n      return Math.sqrt(dx * dx + dy * dy);\n    },\n\n    /**\n     * Returns the point between this point and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    midPointFrom: function (that) {\n      return this.lerp(that);\n    },\n\n    /**\n     * Returns a new point which is the min of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    min: function (that) {\n      return new Point(Math.min(this.x, that.x), Math.min(this.y, that.y));\n    },\n\n    /**\n     * Returns a new point which is the max of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    max: function (that) {\n      return new Point(Math.max(this.x, that.x), Math.max(this.y, that.y));\n    },\n\n    /**\n     * Returns string representation of this point\n     * @return {String}\n     */\n    toString: function () {\n      return this.x + \",\" + this.y;\n    },\n\n    /**\n     * Sets x/y of this point\n     * @param {Number} x\n     * @param {Number} y\n     * @chainable\n     */\n    setXY: function (x, y) {\n      this.x = x;\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x of this point\n     * @param {Number} x\n     * @chainable\n     */\n    setX: function (x) {\n      this.x = x;\n      return this;\n    },\n\n    /**\n     * Sets y of this point\n     * @param {Number} y\n     * @chainable\n     */\n    setY: function (y) {\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x/y of this point from another point\n     * @param {fabric.Point} that\n     * @chainable\n     */\n    setFromPoint: function (that) {\n      this.x = that.x;\n      this.y = that.y;\n      return this;\n    },\n\n    /**\n     * Swaps x/y of this point and another point\n     * @param {fabric.Point} that\n     */\n    swap: function (that) {\n      var x = this.x,\n        y = this.y;\n      this.x = that.x;\n      this.y = that.y;\n      that.x = x;\n      that.y = y;\n    },\n\n    /**\n     * return a cloned instance of the point\n     * @return {fabric.Point}\n     */\n    clone: function () {\n      return new Point(this.x, this.y);\n    },\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n  var fabric = global.fabric || (global.fabric = {});\n\n  if (fabric.Intersection) {\n    fabric.warn(\"fabric.Intersection is already defined\");\n    return;\n  }\n\n  /**\n   * Intersection class\n   * @class fabric.Intersection\n   * @memberOf fabric\n   * @constructor\n   */\n  function Intersection(status) {\n    this.status = status;\n    this.points = [];\n  }\n\n  fabric.Intersection = Intersection;\n\n  fabric.Intersection.prototype = /** @lends fabric.Intersection.prototype */ {\n    constructor: Intersection,\n\n    /**\n     * Appends a point to intersection\n     * @param {fabric.Point} point\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoint: function (point) {\n      this.points.push(point);\n      return this;\n    },\n\n    /**\n     * Appends points to intersection\n     * @param {Array} points\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoints: function (points) {\n      this.points = this.points.concat(points);\n      return this;\n    },\n  };\n\n  /**\n   * Checks if one line intersects another\n   * TODO: rename in intersectSegmentSegment\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {fabric.Point} b1\n   * @param {fabric.Point} b2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLineLine = function (a1, a2, b1, b2) {\n    var result,\n      uaT = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x),\n      ubT = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x),\n      uB = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);\n    if (uB !== 0) {\n      var ua = uaT / uB,\n        ub = ubT / uB;\n      if (0 <= ua && ua <= 1 && 0 <= ub && ub <= 1) {\n        result = new Intersection(\"Intersection\");\n        result.appendPoint(\n          new fabric.Point(a1.x + ua * (a2.x - a1.x), a1.y + ua * (a2.y - a1.y))\n        );\n      } else {\n        result = new Intersection();\n      }\n    } else {\n      if (uaT === 0 || ubT === 0) {\n        result = new Intersection(\"Coincident\");\n      } else {\n        result = new Intersection(\"Parallel\");\n      }\n    }\n    return result;\n  };\n\n  /**\n   * Checks if line intersects polygon\n   * TODO: rename in intersectSegmentPolygon\n   * fix detection of coincident\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {Array} points\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLinePolygon = function (a1, a2, points) {\n    var result = new Intersection(),\n      length = points.length,\n      b1,\n      b2,\n      inter,\n      i;\n\n    for (i = 0; i < length; i++) {\n      b1 = points[i];\n      b2 = points[(i + 1) % length];\n      inter = Intersection.intersectLineLine(a1, a2, b1, b2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = \"Intersection\";\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects another polygon\n   * @static\n   * @param {Array} points1\n   * @param {Array} points2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonPolygon = function (points1, points2) {\n    var result = new Intersection(),\n      length = points1.length,\n      i;\n\n    for (i = 0; i < length; i++) {\n      var a1 = points1[i],\n        a2 = points1[(i + 1) % length],\n        inter = Intersection.intersectLinePolygon(a1, a2, points2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = \"Intersection\";\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects rectangle\n   * @static\n   * @param {Array} points\n   * @param {fabric.Point} r1\n   * @param {fabric.Point} r2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonRectangle = function (points, r1, r2) {\n    var min = r1.min(r2),\n      max = r1.max(r2),\n      topRight = new fabric.Point(max.x, min.y),\n      bottomLeft = new fabric.Point(min.x, max.y),\n      inter1 = Intersection.intersectLinePolygon(min, topRight, points),\n      inter2 = Intersection.intersectLinePolygon(topRight, max, points),\n      inter3 = Intersection.intersectLinePolygon(max, bottomLeft, points),\n      inter4 = Intersection.intersectLinePolygon(bottomLeft, min, points),\n      result = new Intersection();\n\n    result.appendPoints(inter1.points);\n    result.appendPoints(inter2.points);\n    result.appendPoints(inter3.points);\n    result.appendPoints(inter4.points);\n\n    if (result.points.length > 0) {\n      result.status = \"Intersection\";\n    }\n    return result;\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  if (fabric.Color) {\n    fabric.warn(\"fabric.Color is already defined.\");\n    return;\n  }\n\n  /**\n   * Color class\n   * The purpose of {@link fabric.Color} is to abstract and encapsulate common color operations;\n   * {@link fabric.Color} is a constructor and creates instances of {@link fabric.Color} objects.\n   *\n   * @class fabric.Color\n   * @param {String} color optional in hex or rgb(a) or hsl format or from known color list\n   * @return {fabric.Color} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#colors}\n   */\n  function Color(color) {\n    if (!color) {\n      this.setSource([0, 0, 0, 1]);\n    } else {\n      this._tryParsingColor(color);\n    }\n  }\n\n  fabric.Color = Color;\n\n  fabric.Color.prototype = /** @lends fabric.Color.prototype */ {\n    /**\n     * @private\n     * @param {String|Array} color Color value to parse\n     */\n    _tryParsingColor: function (color) {\n      var source;\n\n      if (color in Color.colorNameMap) {\n        color = Color.colorNameMap[color];\n      }\n\n      if (color === \"transparent\") {\n        source = [255, 255, 255, 0];\n      }\n\n      if (!source) {\n        source = Color.sourceFromHex(color);\n      }\n      if (!source) {\n        source = Color.sourceFromRgb(color);\n      }\n      if (!source) {\n        source = Color.sourceFromHsl(color);\n      }\n      if (!source) {\n        //if color is not recognize let's make black as canvas does\n        source = [0, 0, 0, 1];\n      }\n      if (source) {\n        this.setSource(source);\n      }\n    },\n\n    /**\n     * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n     * @private\n     * @param {Number} r Red color value\n     * @param {Number} g Green color value\n     * @param {Number} b Blue color value\n     * @return {Array} Hsl color\n     */\n    _rgbToHsl: function (r, g, b) {\n      r /= 255;\n      g /= 255;\n      b /= 255;\n\n      var h,\n        s,\n        l,\n        max = fabric.util.array.max([r, g, b]),\n        min = fabric.util.array.min([r, g, b]);\n\n      l = (max + min) / 2;\n\n      if (max === min) {\n        h = s = 0; // achromatic\n      } else {\n        var d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch (max) {\n          case r:\n            h = (g - b) / d + (g < b ? 6 : 0);\n            break;\n          case g:\n            h = (b - r) / d + 2;\n            break;\n          case b:\n            h = (r - g) / d + 4;\n            break;\n        }\n        h /= 6;\n      }\n\n      return [Math.round(h * 360), Math.round(s * 100), Math.round(l * 100)];\n    },\n\n    /**\n     * Returns source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @return {Array}\n     */\n    getSource: function () {\n      return this._source;\n    },\n\n    /**\n     * Sets source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @param {Array} source\n     */\n    setSource: function (source) {\n      this._source = source;\n    },\n\n    /**\n     * Returns color representation in RGB format\n     * @return {String} ex: rgb(0-255,0-255,0-255)\n     */\n    toRgb: function () {\n      var source = this.getSource();\n      return \"rgb(\" + source[0] + \",\" + source[1] + \",\" + source[2] + \")\";\n    },\n\n    /**\n     * Returns color representation in RGBA format\n     * @return {String} ex: rgba(0-255,0-255,0-255,0-1)\n     */\n    toRgba: function () {\n      var source = this.getSource();\n      return (\n        \"rgba(\" +\n        source[0] +\n        \",\" +\n        source[1] +\n        \",\" +\n        source[2] +\n        \",\" +\n        source[3] +\n        \")\"\n      );\n    },\n\n    /**\n     * Returns color representation in HSL format\n     * @return {String} ex: hsl(0-360,0%-100%,0%-100%)\n     */\n    toHsl: function () {\n      var source = this.getSource(),\n        hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return \"hsl(\" + hsl[0] + \",\" + hsl[1] + \"%,\" + hsl[2] + \"%)\";\n    },\n\n    /**\n     * Returns color representation in HSLA format\n     * @return {String} ex: hsla(0-360,0%-100%,0%-100%,0-1)\n     */\n    toHsla: function () {\n      var source = this.getSource(),\n        hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return (\n        \"hsla(\" + hsl[0] + \",\" + hsl[1] + \"%,\" + hsl[2] + \"%,\" + source[3] + \")\"\n      );\n    },\n\n    /**\n     * Returns color representation in HEX format\n     * @return {String} ex: FF5555\n     */\n    toHex: function () {\n      var source = this.getSource(),\n        r,\n        g,\n        b;\n\n      r = source[0].toString(16);\n      r = r.length === 1 ? \"0\" + r : r;\n\n      g = source[1].toString(16);\n      g = g.length === 1 ? \"0\" + g : g;\n\n      b = source[2].toString(16);\n      b = b.length === 1 ? \"0\" + b : b;\n\n      return r.toUpperCase() + g.toUpperCase() + b.toUpperCase();\n    },\n\n    /**\n     * Returns color representation in HEXA format\n     * @return {String} ex: FF5555CC\n     */\n    toHexa: function () {\n      var source = this.getSource(),\n        a;\n\n      a = Math.round(source[3] * 255);\n      a = a.toString(16);\n      a = a.length === 1 ? \"0\" + a : a;\n\n      return this.toHex() + a.toUpperCase();\n    },\n\n    /**\n     * Gets value of alpha channel for this color\n     * @return {Number} 0-1\n     */\n    getAlpha: function () {\n      return this.getSource()[3];\n    },\n\n    /**\n     * Sets value of alpha channel for this color\n     * @param {Number} alpha Alpha value 0-1\n     * @return {fabric.Color} thisArg\n     */\n    setAlpha: function (alpha) {\n      var source = this.getSource();\n      source[3] = alpha;\n      this.setSource(source);\n      return this;\n    },\n\n    /**\n     * Transforms color to its grayscale representation\n     * @return {fabric.Color} thisArg\n     */\n    toGrayscale: function () {\n      var source = this.getSource(),\n        average = parseInt(\n          (source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0),\n          10\n        ),\n        currentAlpha = source[3];\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Transforms color to its black and white representation\n     * @param {Number} threshold\n     * @return {fabric.Color} thisArg\n     */\n    toBlackWhite: function (threshold) {\n      var source = this.getSource(),\n        average = (\n          source[0] * 0.3 +\n          source[1] * 0.59 +\n          source[2] * 0.11\n        ).toFixed(0),\n        currentAlpha = source[3];\n\n      threshold = threshold || 127;\n\n      average = Number(average) < Number(threshold) ? 0 : 255;\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Overlays color with another color\n     * @param {String|fabric.Color} otherColor\n     * @return {fabric.Color} thisArg\n     */\n    overlayWith: function (otherColor) {\n      if (!(otherColor instanceof Color)) {\n        otherColor = new Color(otherColor);\n      }\n\n      var result = [],\n        alpha = this.getAlpha(),\n        otherAlpha = 0.5,\n        source = this.getSource(),\n        otherSource = otherColor.getSource(),\n        i;\n\n      for (i = 0; i < 3; i++) {\n        result.push(\n          Math.round(source[i] * (1 - otherAlpha) + otherSource[i] * otherAlpha)\n        );\n      }\n\n      result[3] = alpha;\n      this.setSource(result);\n      return this;\n    },\n  };\n\n  /**\n   * Regex matching color in RGB or RGBA formats (ex: rgb(0, 0, 0), rgba(255, 100, 10, 0.5), rgba( 255 , 100 , 10 , 0.5 ), rgb(1,1,1), rgba(100%, 60%, 10%, 0.5))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  // eslint-disable-next-line max-len\n  fabric.Color.reRGBa = /^rgba?\\(\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*(?:\\s*,\\s*((?:\\d*\\.?\\d+)?)\\s*)?\\)$/i;\n\n  /**\n   * Regex matching color in HSL or HSLA formats (ex: hsl(200, 80%, 10%), hsla(300, 50%, 80%, 0.5), hsla( 300 , 50% , 80% , 0.5 ))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHSLa = /^hsla?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3}\\%)\\s*,\\s*(\\d{1,3}\\%)\\s*(?:\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)$/i;\n\n  /**\n   * Regex matching color in HEX format (ex: #FF5544CC, #FF5555, 010155, aff)\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHex = /^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;\n\n  /**\n   * Map of the 148 color names with HEX code\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   * @see: https://www.w3.org/TR/css3-color/#svg-color\n   */\n  fabric.Color.colorNameMap = {\n    aliceblue: \"#F0F8FF\",\n    antiquewhite: \"#FAEBD7\",\n    aqua: \"#00FFFF\",\n    aquamarine: \"#7FFFD4\",\n    azure: \"#F0FFFF\",\n    beige: \"#F5F5DC\",\n    bisque: \"#FFE4C4\",\n    black: \"#000000\",\n    blanchedalmond: \"#FFEBCD\",\n    blue: \"#0000FF\",\n    blueviolet: \"#8A2BE2\",\n    brown: \"#A52A2A\",\n    burlywood: \"#DEB887\",\n    cadetblue: \"#5F9EA0\",\n    chartreuse: \"#7FFF00\",\n    chocolate: \"#D2691E\",\n    coral: \"#FF7F50\",\n    cornflowerblue: \"#6495ED\",\n    cornsilk: \"#FFF8DC\",\n    crimson: \"#DC143C\",\n    cyan: \"#00FFFF\",\n    darkblue: \"#00008B\",\n    darkcyan: \"#008B8B\",\n    darkgoldenrod: \"#B8860B\",\n    darkgray: \"#A9A9A9\",\n    darkgrey: \"#A9A9A9\",\n    darkgreen: \"#006400\",\n    darkkhaki: \"#BDB76B\",\n    darkmagenta: \"#8B008B\",\n    darkolivegreen: \"#556B2F\",\n    darkorange: \"#FF8C00\",\n    darkorchid: \"#9932CC\",\n    darkred: \"#8B0000\",\n    darksalmon: \"#E9967A\",\n    darkseagreen: \"#8FBC8F\",\n    darkslateblue: \"#483D8B\",\n    darkslategray: \"#2F4F4F\",\n    darkslategrey: \"#2F4F4F\",\n    darkturquoise: \"#00CED1\",\n    darkviolet: \"#9400D3\",\n    deeppink: \"#FF1493\",\n    deepskyblue: \"#00BFFF\",\n    dimgray: \"#696969\",\n    dimgrey: \"#696969\",\n    dodgerblue: \"#1E90FF\",\n    firebrick: \"#B22222\",\n    floralwhite: \"#FFFAF0\",\n    forestgreen: \"#228B22\",\n    fuchsia: \"#FF00FF\",\n    gainsboro: \"#DCDCDC\",\n    ghostwhite: \"#F8F8FF\",\n    gold: \"#FFD700\",\n    goldenrod: \"#DAA520\",\n    gray: \"#808080\",\n    grey: \"#808080\",\n    green: \"#008000\",\n    greenyellow: \"#ADFF2F\",\n    honeydew: \"#F0FFF0\",\n    hotpink: \"#FF69B4\",\n    indianred: \"#CD5C5C\",\n    indigo: \"#4B0082\",\n    ivory: \"#FFFFF0\",\n    khaki: \"#F0E68C\",\n    lavender: \"#E6E6FA\",\n    lavenderblush: \"#FFF0F5\",\n    lawngreen: \"#7CFC00\",\n    lemonchiffon: \"#FFFACD\",\n    lightblue: \"#ADD8E6\",\n    lightcoral: \"#F08080\",\n    lightcyan: \"#E0FFFF\",\n    lightgoldenrodyellow: \"#FAFAD2\",\n    lightgray: \"#D3D3D3\",\n    lightgrey: \"#D3D3D3\",\n    lightgreen: \"#90EE90\",\n    lightpink: \"#FFB6C1\",\n    lightsalmon: \"#FFA07A\",\n    lightseagreen: \"#20B2AA\",\n    lightskyblue: \"#87CEFA\",\n    lightslategray: \"#778899\",\n    lightslategrey: \"#778899\",\n    lightsteelblue: \"#B0C4DE\",\n    lightyellow: \"#FFFFE0\",\n    lime: \"#00FF00\",\n    limegreen: \"#32CD32\",\n    linen: \"#FAF0E6\",\n    magenta: \"#FF00FF\",\n    maroon: \"#800000\",\n    mediumaquamarine: \"#66CDAA\",\n    mediumblue: \"#0000CD\",\n    mediumorchid: \"#BA55D3\",\n    mediumpurple: \"#9370DB\",\n    mediumseagreen: \"#3CB371\",\n    mediumslateblue: \"#7B68EE\",\n    mediumspringgreen: \"#00FA9A\",\n    mediumturquoise: \"#48D1CC\",\n    mediumvioletred: \"#C71585\",\n    midnightblue: \"#191970\",\n    mintcream: \"#F5FFFA\",\n    mistyrose: \"#FFE4E1\",\n    moccasin: \"#FFE4B5\",\n    navajowhite: \"#FFDEAD\",\n    navy: \"#000080\",\n    oldlace: \"#FDF5E6\",\n    olive: \"#808000\",\n    olivedrab: \"#6B8E23\",\n    orange: \"#FFA500\",\n    orangered: \"#FF4500\",\n    orchid: \"#DA70D6\",\n    palegoldenrod: \"#EEE8AA\",\n    palegreen: \"#98FB98\",\n    paleturquoise: \"#AFEEEE\",\n    palevioletred: \"#DB7093\",\n    papayawhip: \"#FFEFD5\",\n    peachpuff: \"#FFDAB9\",\n    peru: \"#CD853F\",\n    pink: \"#FFC0CB\",\n    plum: \"#DDA0DD\",\n    powderblue: \"#B0E0E6\",\n    purple: \"#800080\",\n    rebeccapurple: \"#663399\",\n    red: \"#FF0000\",\n    rosybrown: \"#BC8F8F\",\n    royalblue: \"#4169E1\",\n    saddlebrown: \"#8B4513\",\n    salmon: \"#FA8072\",\n    sandybrown: \"#F4A460\",\n    seagreen: \"#2E8B57\",\n    seashell: \"#FFF5EE\",\n    sienna: \"#A0522D\",\n    silver: \"#C0C0C0\",\n    skyblue: \"#87CEEB\",\n    slateblue: \"#6A5ACD\",\n    slategray: \"#708090\",\n    slategrey: \"#708090\",\n    snow: \"#FFFAFA\",\n    springgreen: \"#00FF7F\",\n    steelblue: \"#4682B4\",\n    tan: \"#D2B48C\",\n    teal: \"#008080\",\n    thistle: \"#D8BFD8\",\n    tomato: \"#FF6347\",\n    turquoise: \"#40E0D0\",\n    violet: \"#EE82EE\",\n    wheat: \"#F5DEB3\",\n    white: \"#FFFFFF\",\n    whitesmoke: \"#F5F5F5\",\n    yellow: \"#FFFF00\",\n    yellowgreen: \"#9ACD32\",\n  };\n\n  /**\n   * @private\n   * @param {Number} p\n   * @param {Number} q\n   * @param {Number} t\n   * @return {Number}\n   */\n  function hue2rgb(p, q, t) {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  /**\n   * Returns new color object, when given a color in RGB format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255)\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgb = function (color) {\n    return Color.fromSource(Color.sourceFromRgb(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in RGB or RGBA format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255), rgb(0%-100%,0%-100%,0%-100%)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromRgb = function (color) {\n    var match = color.match(Color.reRGBa);\n    if (match) {\n      var r =\n          (parseInt(match[1], 10) / (/%$/.test(match[1]) ? 100 : 1)) *\n          (/%$/.test(match[1]) ? 255 : 1),\n        g =\n          (parseInt(match[2], 10) / (/%$/.test(match[2]) ? 100 : 1)) *\n          (/%$/.test(match[2]) ? 255 : 1),\n        b =\n          (parseInt(match[3], 10) / (/%$/.test(match[3]) ? 100 : 1)) *\n          (/%$/.test(match[3]) ? 255 : 1);\n\n      return [\n        parseInt(r, 10),\n        parseInt(g, 10),\n        parseInt(b, 10),\n        match[4] ? parseFloat(match[4]) : 1,\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given a color in RGBA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgba = Color.fromRgb;\n\n  /**\n   * Returns new color object, when given a color in HSL format\n   * @param {String} color Color value ex: hsl(0-260,0%-100%,0%-100%)\n   * @memberOf fabric.Color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsl = function (color) {\n    return Color.fromSource(Color.sourceFromHsl(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HSL or HSLA format.\n   * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: hsl(0-360,0%-100%,0%-100%) or hsla(0-360,0%-100%,0%-100%, 0-1)\n   * @return {Array} source\n   * @see http://http://www.w3.org/TR/css3-color/#hsl-color\n   */\n  fabric.Color.sourceFromHsl = function (color) {\n    var match = color.match(Color.reHSLa);\n    if (!match) {\n      return;\n    }\n\n    var h = (((parseFloat(match[1]) % 360) + 360) % 360) / 360,\n      s = parseFloat(match[2]) / (/%$/.test(match[2]) ? 100 : 1),\n      l = parseFloat(match[3]) / (/%$/.test(match[3]) ? 100 : 1),\n      r,\n      g,\n      b;\n\n    if (s === 0) {\n      r = g = b = l;\n    } else {\n      var q = l <= 0.5 ? l * (s + 1) : l + s - l * s,\n        p = l * 2 - q;\n\n      r = hue2rgb(p, q, h + 1 / 3);\n      g = hue2rgb(p, q, h);\n      b = hue2rgb(p, q, h - 1 / 3);\n    }\n\n    return [\n      Math.round(r * 255),\n      Math.round(g * 255),\n      Math.round(b * 255),\n      match[4] ? parseFloat(match[4]) : 1,\n    ];\n  };\n\n  /**\n   * Returns new color object, when given a color in HSLA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsla = Color.fromHsl;\n\n  /**\n   * Returns new color object, when given a color in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: FF5555\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHex = function (color) {\n    return Color.fromSource(Color.sourceFromHex(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color ex: FF5555 or FF5544CC (RGBa)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromHex = function (color) {\n    if (color.match(Color.reHex)) {\n      var value = color.slice(color.indexOf(\"#\") + 1),\n        isShortNotation = value.length === 3 || value.length === 4,\n        isRGBa = value.length === 8 || value.length === 4,\n        r = isShortNotation\n          ? value.charAt(0) + value.charAt(0)\n          : value.substring(0, 2),\n        g = isShortNotation\n          ? value.charAt(1) + value.charAt(1)\n          : value.substring(2, 4),\n        b = isShortNotation\n          ? value.charAt(2) + value.charAt(2)\n          : value.substring(4, 6),\n        a = isRGBa\n          ? isShortNotation\n            ? value.charAt(3) + value.charAt(3)\n            : value.substring(6, 8)\n          : \"FF\";\n\n      return [\n        parseInt(r, 16),\n        parseInt(g, 16),\n        parseInt(b, 16),\n        parseFloat((parseInt(a, 16) / 255).toFixed(2)),\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given color in array representation (ex: [200, 100, 100, 0.5])\n   * @static\n   * @memberOf fabric.Color\n   * @param {Array} source\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromSource = function (source) {\n    var oColor = new Color();\n    oColor.setSource(source);\n    return oColor;\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    scaleMap = [\"e\", \"se\", \"s\", \"sw\", \"w\", \"nw\", \"n\", \"ne\", \"e\"],\n    skewMap = [\"ns\", \"nesw\", \"ew\", \"nwse\"],\n    controls = {},\n    LEFT = \"left\",\n    TOP = \"top\",\n    RIGHT = \"right\",\n    BOTTOM = \"bottom\",\n    CENTER = \"center\",\n    opposite = {\n      top: BOTTOM,\n      bottom: TOP,\n      left: RIGHT,\n      right: LEFT,\n    },\n    radiansToDegrees = fabric.util.radiansToDegrees,\n    sign =\n      Math.sign ||\n      function (x) {\n        return (x > 0) - (x < 0) || +x;\n      };\n\n  /**\n   * Combine control position and object angle to find the control direction compared\n   * to the object center.\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   * @param {fabric.Control} control the control class\n   * @return {Number} 0 - 7 a quadrant number\n   */\n  function findCornerQuadrant(fabricObject, control) {\n    var cornerAngle =\n      fabricObject.angle +\n      radiansToDegrees(Math.atan2(control.y, control.x)) +\n      360;\n    return Math.round((cornerAngle % 360) / 45);\n  }\n\n  function fireEvent(eventName, options) {\n    var target = options.transform.target,\n      canvas = target.canvas,\n      canasOptions = Object.assign({}, options, { target: target });\n    canvas && canvas.fire(\"object:\" + eventName, canasOptions);\n    target.fire(eventName, options);\n  }\n\n  /**\n   * Inspect event and fabricObject properties to understand if the scaling action\n   * @param {Event} eventData from the user action\n   * @param {fabric.Object} fabricObject the fabric object about to scale\n   * @return {Boolean} true if scale is proportional\n   */\n  function scaleIsProportional(eventData, fabricObject) {\n    var canvas = fabricObject.canvas,\n      uniScaleKey = canvas.uniScaleKey,\n      uniformIsToggled = eventData[uniScaleKey];\n    return (\n      (canvas.uniformScaling && !uniformIsToggled) ||\n      (!canvas.uniformScaling && uniformIsToggled)\n    );\n  }\n\n  /**\n   * Inspect fabricObject to understand if the current scaling action is allowed\n   * @param {fabric.Object} fabricObject the fabric object about to scale\n   * @param {String} by 'x' or 'y' or ''\n   * @param {Boolean} scaleProportionally true if we are trying to scale proportionally\n   * @return {Boolean} true if scaling is not allowed at current conditions\n   */\n  function scalingIsForbidden(fabricObject, by, scaleProportionally) {\n    var lockX = fabricObject.lockScalingX,\n      lockY = fabricObject.lockScalingY;\n    if (lockX && lockY) {\n      return true;\n    }\n    if (!by && (lockX || lockY) && scaleProportionally) {\n      return true;\n    }\n    if (lockX && by === \"x\") {\n      return true;\n    }\n    if (lockY && by === \"y\") {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * return the correct cursor style for the scale action\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function scaleCursorStyleHandler(eventData, control, fabricObject) {\n    var notAllowed = \"not-allowed\",\n      scaleProportionally = scaleIsProportional(eventData, fabricObject),\n      by = \"\";\n    if (control.x !== 0 && control.y === 0) {\n      by = \"x\";\n    } else if (control.x === 0 && control.y !== 0) {\n      by = \"y\";\n    }\n    if (scalingIsForbidden(fabricObject, by, scaleProportionally)) {\n      return notAllowed;\n    }\n    var n = findCornerQuadrant(fabricObject, control);\n    return scaleMap[n] + \"-resize\";\n  }\n\n  /**\n   * return the correct cursor style for the skew action\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function skewCursorStyleHandler(eventData, control, fabricObject) {\n    var notAllowed = \"not-allowed\";\n    if (control.x !== 0 && fabricObject.lockSkewingY) {\n      return notAllowed;\n    }\n    if (control.y !== 0 && fabricObject.lockSkewingX) {\n      return notAllowed;\n    }\n    var n = findCornerQuadrant(fabricObject, control) % 4;\n    return skewMap[n] + \"-resize\";\n  }\n\n  /**\n   * Combine skew and scale style handlers to cover fabric standard use case\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function scaleSkewCursorStyleHandler(eventData, control, fabricObject) {\n    if (eventData[fabricObject.canvas.altActionKey]) {\n      return controls.skewCursorStyleHandler(eventData, control, fabricObject);\n    }\n    return controls.scaleCursorStyleHandler(eventData, control, fabricObject);\n  }\n\n  /**\n   * Inspect event , control and fabricObject to return the correct action name\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} an action name\n   */\n  function scaleOrSkewActionName(eventData, control, fabricObject) {\n    var isAlternative = eventData[fabricObject.canvas.altActionKey];\n    if (control.x === 0) {\n      // then is scaleY or skewX\n      return isAlternative ? \"skewX\" : \"scaleY\";\n    }\n    if (control.y === 0) {\n      // then is scaleY or skewX\n      return isAlternative ? \"skewY\" : \"scaleX\";\n    }\n  }\n\n  /**\n   * Find the correct style for the control that is used for rotation.\n   * this function is very simple and it just take care of not-allowed or standard cursor\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function rotationStyleHandler(eventData, control, fabricObject) {\n    if (fabricObject.lockRotation) {\n      return \"not-allowed\";\n    }\n    return control.cursorStyle;\n  }\n\n  function commonEventInfo(eventData, transform, x, y) {\n    return {\n      e: eventData,\n      transform: transform,\n      pointer: {\n        x: x,\n        y: y,\n      },\n    };\n  }\n\n  /**\n   * Wrap an action handler with saving/restoring object position on the transform.\n   * this is the code that permits to obects to keep their position while transforming.\n   * @param {Function} actionHandler the function to wrap\n   * @return {Function} a function with an action handler signature\n   */\n  function wrapWithFixedAnchor(actionHandler) {\n    return function (eventData, transform, x, y) {\n      var target = transform.target,\n        centerPoint = target.getCenterPoint(),\n        constraint = target.translateToOriginPoint(\n          centerPoint,\n          transform.originX,\n          transform.originY\n        ),\n        actionPerformed = actionHandler(eventData, transform, x, y);\n      target.setPositionByOrigin(\n        constraint,\n        transform.originX,\n        transform.originY\n      );\n      return actionPerformed;\n    };\n  }\n\n  /**\n   * Transforms a point described by x and y in a distance from the top left corner of the object\n   * bounding box.\n   * @param {Object} transform\n   * @param {String} originX\n   * @param {String} originY\n   * @param {number} x\n   * @param {number} y\n   * @return {Fabric.Point} the normalized point\n   */\n  function getLocalPoint(transform, originX, originY, x, y) {\n    var target = transform.target,\n      control = target.controls[transform.corner],\n      zoom = target.canvas.getZoom(),\n      padding = target.padding / zoom,\n      localPoint = target.toLocalPoint(\n        new fabric.Point(x, y),\n        originX,\n        originY\n      );\n    if (localPoint.x >= padding) {\n      localPoint.x -= padding;\n    }\n    if (localPoint.x <= -padding) {\n      localPoint.x += padding;\n    }\n    if (localPoint.y >= padding) {\n      localPoint.y -= padding;\n    }\n    if (localPoint.y <= padding) {\n      localPoint.y += padding;\n    }\n    localPoint.x -= control.offsetX;\n    localPoint.y -= control.offsetY;\n    return localPoint;\n  }\n\n  /**\n   * Detect if the fabric object is flipped on one side.\n   * @param {fabric.Object} target\n   * @return {Boolean} true if one flip, but not two.\n   */\n  function targetHasOneFlip(target) {\n    return (target.flipX && !target.flipY) || (!target.flipX && target.flipY);\n  }\n\n  /**\n   * Utility function to componsate the scale factor when skew is applied on both axes\n   * @private\n   */\n  function compensateScaleForSkew(\n    target,\n    oppositeSkew,\n    scaleToCompoensate,\n    axis,\n    reference\n  ) {\n    if (target[oppositeSkew] !== 0) {\n      var newDim = target._getTransformedDimensions()[axis];\n      var newValue = (reference / newDim) * target[scaleToCompoensate];\n      target.set(scaleToCompoensate, newValue);\n    }\n  }\n\n  /**\n   * Action handler for skewing on the X axis\n   * @private\n   */\n  function skewObjectX(eventData, transform, x, y) {\n    var target = transform.target,\n      // find how big the object would be, if there was no skewX. takes in account scaling\n      dimNoSkew = target._getTransformedDimensions(0, target.skewY),\n      localPoint = getLocalPoint(\n        transform,\n        transform.originX,\n        transform.originY,\n        x,\n        y\n      ),\n      // the mouse is in the center of the object, and we want it to stay there.\n      // so the object will grow twice as much as the mouse.\n      // this makes the skew growth to localPoint * 2 - dimNoSkew.\n      totalSkewSize = Math.abs(localPoint.x * 2) - dimNoSkew.x,\n      currentSkew = target.skewX,\n      newSkew;\n    if (totalSkewSize < 2) {\n      // let's make it easy to go back to position 0.\n      newSkew = 0;\n    } else {\n      newSkew = radiansToDegrees(\n        Math.atan2(totalSkewSize / target.scaleX, dimNoSkew.y / target.scaleY)\n      );\n      // now we have to find the sign of the skew.\n      // it mostly depend on the origin of transformation.\n      if (transform.originX === LEFT && transform.originY === BOTTOM) {\n        newSkew = -newSkew;\n      }\n      if (transform.originX === RIGHT && transform.originY === TOP) {\n        newSkew = -newSkew;\n      }\n      if (targetHasOneFlip(target)) {\n        newSkew = -newSkew;\n      }\n    }\n    var hasSkewed = currentSkew !== newSkew;\n    if (hasSkewed) {\n      var dimBeforeSkewing = target._getTransformedDimensions().y;\n      target.set(\"skewX\", newSkew);\n      compensateScaleForSkew(target, \"skewY\", \"scaleY\", \"y\", dimBeforeSkewing);\n      fireEvent(\"skewing\", commonEventInfo(eventData, transform, x, y));\n    }\n    return hasSkewed;\n  }\n\n  /**\n   * Action handler for skewing on the Y axis\n   * @private\n   */\n  function skewObjectY(eventData, transform, x, y) {\n    var target = transform.target,\n      // find how big the object would be, if there was no skewX. takes in account scaling\n      dimNoSkew = target._getTransformedDimensions(target.skewX, 0),\n      localPoint = getLocalPoint(\n        transform,\n        transform.originX,\n        transform.originY,\n        x,\n        y\n      ),\n      // the mouse is in the center of the object, and we want it to stay there.\n      // so the object will grow twice as much as the mouse.\n      // this makes the skew growth to localPoint * 2 - dimNoSkew.\n      totalSkewSize = Math.abs(localPoint.y * 2) - dimNoSkew.y,\n      currentSkew = target.skewY,\n      newSkew;\n    if (totalSkewSize < 2) {\n      // let's make it easy to go back to position 0.\n      newSkew = 0;\n    } else {\n      newSkew = radiansToDegrees(\n        Math.atan2(totalSkewSize / target.scaleY, dimNoSkew.x / target.scaleX)\n      );\n      // now we have to find the sign of the skew.\n      // it mostly depend on the origin of transformation.\n      if (transform.originX === LEFT && transform.originY === BOTTOM) {\n        newSkew = -newSkew;\n      }\n      if (transform.originX === RIGHT && transform.originY === TOP) {\n        newSkew = -newSkew;\n      }\n      if (targetHasOneFlip(target)) {\n        newSkew = -newSkew;\n      }\n    }\n    var hasSkewed = currentSkew !== newSkew;\n    if (hasSkewed) {\n      var dimBeforeSkewing = target._getTransformedDimensions().x;\n      target.set(\"skewY\", newSkew);\n      compensateScaleForSkew(target, \"skewX\", \"scaleX\", \"x\", dimBeforeSkewing);\n      fireEvent(\"skewing\", commonEventInfo(eventData, transform, x, y));\n    }\n    return hasSkewed;\n  }\n\n  /**\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\n   * skew direction and determine the correct transform origin for the anchor point\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function skewHandlerX(eventData, transform, x, y) {\n    // step1 figure out and change transform origin.\n    // if skewX > 0 and originY bottom we anchor on right\n    // if skewX > 0 and originY top we anchor on left\n    // if skewX < 0 and originY bottom we anchor on left\n    // if skewX < 0 and originY top we anchor on right\n    // if skewX is 0, we look for mouse position to understand where are we going.\n    var target = transform.target,\n      currentSkew = target.skewX,\n      originX,\n      originY = transform.originY;\n    if (target.lockSkewingX) {\n      return false;\n    }\n    if (currentSkew === 0) {\n      var localPointFromCenter = getLocalPoint(transform, CENTER, CENTER, x, y);\n      if (localPointFromCenter.x > 0) {\n        // we are pulling right, anchor left;\n        originX = LEFT;\n      } else {\n        // we are pulling right, anchor right\n        originX = RIGHT;\n      }\n    } else {\n      if (currentSkew > 0) {\n        originX = originY === TOP ? LEFT : RIGHT;\n      }\n      if (currentSkew < 0) {\n        originX = originY === TOP ? RIGHT : LEFT;\n      }\n      // is the object flipped on one side only? swap the origin.\n      if (targetHasOneFlip(target)) {\n        originX = originX === LEFT ? RIGHT : LEFT;\n      }\n    }\n\n    // once we have the origin, we find the anchor point\n    transform.originX = originX;\n    var finalHandler = wrapWithFixedAnchor(skewObjectX);\n    return finalHandler(eventData, transform, x, y);\n  }\n\n  /**\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\n   * skew direction and determine the correct transform origin for the anchor point\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function skewHandlerY(eventData, transform, x, y) {\n    // step1 figure out and change transform origin.\n    // if skewY > 0 and originX left we anchor on top\n    // if skewY > 0 and originX right we anchor on bottom\n    // if skewY < 0 and originX left we anchor on bottom\n    // if skewY < 0 and originX right we anchor on top\n    // if skewY is 0, we look for mouse position to understand where are we going.\n    var target = transform.target,\n      currentSkew = target.skewY,\n      originY,\n      originX = transform.originX;\n    if (target.lockSkewingY) {\n      return false;\n    }\n    if (currentSkew === 0) {\n      var localPointFromCenter = getLocalPoint(transform, CENTER, CENTER, x, y);\n      if (localPointFromCenter.y > 0) {\n        // we are pulling down, anchor up;\n        originY = TOP;\n      } else {\n        // we are pulling up, anchor down\n        originY = BOTTOM;\n      }\n    } else {\n      if (currentSkew > 0) {\n        originY = originX === LEFT ? TOP : BOTTOM;\n      }\n      if (currentSkew < 0) {\n        originY = originX === LEFT ? BOTTOM : TOP;\n      }\n      // is the object flipped on one side only? swap the origin.\n      if (targetHasOneFlip(target)) {\n        originY = originY === TOP ? BOTTOM : TOP;\n      }\n    }\n\n    // once we have the origin, we find the anchor point\n    transform.originY = originY;\n    var finalHandler = wrapWithFixedAnchor(skewObjectY);\n    return finalHandler(eventData, transform, x, y);\n  }\n\n  /**\n   * Action handler for rotation and snapping, without anchor point.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   * @private\n   */\n  function rotationWithSnapping(eventData, transform, x, y) {\n    var t = transform,\n      target = t.target,\n      pivotPoint = target.translateToOriginPoint(\n        target.getCenterPoint(),\n        t.originX,\n        t.originY\n      );\n\n    if (target.lockRotation) {\n      return false;\n    }\n\n    var lastAngle = Math.atan2(t.ey - pivotPoint.y, t.ex - pivotPoint.x),\n      curAngle = Math.atan2(y - pivotPoint.y, x - pivotPoint.x),\n      angle = radiansToDegrees(curAngle - lastAngle + t.theta),\n      hasRotated = true;\n\n    if (target.snapAngle > 0) {\n      var snapAngle = target.snapAngle,\n        snapThreshold = target.snapThreshold || snapAngle,\n        rightAngleLocked = Math.ceil(angle / snapAngle) * snapAngle,\n        leftAngleLocked = Math.floor(angle / snapAngle) * snapAngle;\n\n      if (Math.abs(angle - leftAngleLocked) < snapThreshold) {\n        angle = leftAngleLocked;\n      } else if (Math.abs(angle - rightAngleLocked) < snapThreshold) {\n        angle = rightAngleLocked;\n      }\n    }\n\n    // normalize angle to positive value\n    if (angle < 0) {\n      angle = 360 + angle;\n    }\n    angle %= 360;\n\n    hasRotated = target.angle !== angle;\n    target.angle = angle;\n    if (hasRotated) {\n      fireEvent(\"rotating\", commonEventInfo(eventData, transform, x, y));\n    }\n    return hasRotated;\n  }\n\n  /**\n   * Basic scaling logic, reused with differnt constrain for scaling X,Y, freely or equally.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @param {Object} options additional information for scaling\n   * @param {String} options.by 'x', 'y', 'equally' or '' to indicate type of scaling\n   * @return {Boolean} true if some change happened\n   * @private\n   */\n  function scaleObject(eventData, transform, x, y, options) {\n    options = options || {};\n    var target = transform.target,\n      lockScalingX = target.lockScalingX,\n      lockScalingY = target.lockScalingY,\n      by = options.by,\n      newPoint,\n      scaleX,\n      scaleY,\n      dim,\n      scaleProportionally = scaleIsProportional(eventData, target),\n      forbidScaling = scalingIsForbidden(target, by, scaleProportionally),\n      signX,\n      signY;\n\n    if (forbidScaling) {\n      return false;\n    }\n    newPoint = getLocalPoint(\n      transform,\n      transform.originX,\n      transform.originY,\n      x,\n      y\n    );\n    signX = sign(newPoint.x);\n    signY = sign(newPoint.y);\n    if (!transform.signX) {\n      transform.signX = signX;\n    }\n    if (!transform.signY) {\n      transform.signY = signY;\n    }\n\n    if (\n      target.lockScalingFlip &&\n      (transform.signX !== signX || transform.signY !== signY)\n    ) {\n      return false;\n    }\n\n    dim = target._getTransformedDimensions();\n    // missing detection of flip and logic to switch the origin\n    if (scaleProportionally && !by) {\n      // uniform scaling\n      var distance = Math.abs(newPoint.x) + Math.abs(newPoint.y),\n        original = transform.original,\n        originalDistance =\n          Math.abs((dim.x * original.scaleX) / target.scaleX) +\n          Math.abs((dim.y * original.scaleY) / target.scaleY),\n        scale = distance / originalDistance,\n        hasScaled;\n      scaleX = original.scaleX * scale;\n      scaleY = original.scaleY * scale;\n    } else {\n      scaleX = Math.abs((newPoint.x * target.scaleX) / dim.x);\n      scaleY = Math.abs((newPoint.y * target.scaleY) / dim.y);\n    }\n    // if we are scaling by center, we need to double the scale\n    if (transform.originX === CENTER && transform.originY === CENTER) {\n      scaleX *= 2;\n      scaleY *= 2;\n    }\n    if (transform.signX !== signX) {\n      transform.originX = opposite[transform.originX];\n      scaleX *= -1;\n      transform.signX = signX;\n    }\n    if (transform.signY !== signY) {\n      transform.originY = opposite[transform.originY];\n      scaleY *= -1;\n      transform.signY = signY;\n    }\n    // minScale is taken are in the setter.\n    var oldScaleX = target.scaleX,\n      oldScaleY = target.scaleY;\n    if (!by) {\n      !lockScalingX && target.set(\"scaleX\", scaleX);\n      !lockScalingY && target.set(\"scaleY\", scaleY);\n    } else {\n      // forbidden cases already handled on top here.\n      by === \"x\" && target.set(\"scaleX\", scaleX);\n      by === \"y\" && target.set(\"scaleY\", scaleY);\n    }\n    hasScaled = oldScaleX !== target.scaleX || oldScaleY !== target.scaleY;\n    if (hasScaled) {\n      fireEvent(\"scaling\", commonEventInfo(eventData, transform, x, y));\n    }\n    return hasScaled;\n  }\n\n  /**\n   * Generic scaling logic, to scale from corners either equally or freely.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectFromCorner(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y);\n  }\n\n  /**\n   * Scaling logic for the X axis.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectX(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y, { by: \"x\" });\n  }\n\n  /**\n   * Scaling logic for the Y axis.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectY(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y, { by: \"y\" });\n  }\n\n  /**\n   * Composed action handler to either scale Y or skew X\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scalingYOrSkewingX(eventData, transform, x, y) {\n    // ok some safety needed here.\n    if (eventData[transform.target.canvas.altActionKey]) {\n      return controls.skewHandlerX(eventData, transform, x, y);\n    }\n    return controls.scalingY(eventData, transform, x, y);\n  }\n\n  /**\n   * Composed action handler to either scale X or skew Y\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scalingXOrSkewingY(eventData, transform, x, y) {\n    // ok some safety needed here.\n    if (eventData[transform.target.canvas.altActionKey]) {\n      return controls.skewHandlerY(eventData, transform, x, y);\n    }\n    return controls.scalingX(eventData, transform, x, y);\n  }\n\n  /**\n   * Action handler to change textbox width\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function changeWidth(eventData, transform, x, y) {\n    var target = transform.target,\n      localPoint = getLocalPoint(\n        transform,\n        transform.originX,\n        transform.originY,\n        x,\n        y\n      ),\n      strokePadding =\n        target.strokeWidth / (target.strokeUniform ? target.scaleX : 1),\n      newWidth = Math.abs(localPoint.x / target.scaleX) - strokePadding;\n    target.set(\"width\", Math.max(newWidth, 0));\n    return true;\n  }\n\n  controls.scaleCursorStyleHandler = scaleCursorStyleHandler;\n  controls.skewCursorStyleHandler = skewCursorStyleHandler;\n  controls.scaleSkewCursorStyleHandler = scaleSkewCursorStyleHandler;\n  controls.rotationWithSnapping = wrapWithFixedAnchor(rotationWithSnapping);\n  controls.scalingEqually = wrapWithFixedAnchor(scaleObjectFromCorner);\n  controls.scalingX = wrapWithFixedAnchor(scaleObjectX);\n  controls.scalingY = wrapWithFixedAnchor(scaleObjectY);\n  controls.scalingYOrSkewingX = scalingYOrSkewingX;\n  controls.scalingXOrSkewingY = scalingXOrSkewingY;\n  controls.changeWidth = wrapWithFixedAnchor(changeWidth);\n  controls.skewHandlerX = skewHandlerX;\n  controls.skewHandlerY = skewHandlerY;\n  controls.scaleOrSkewActionName = scaleOrSkewActionName;\n  controls.rotationStyleHandler = rotationStyleHandler;\n  controls.fireEvent = fireEvent;\n  controls.wrapWithFixedAnchor = wrapWithFixedAnchor;\n  controls.getLocalPoint = getLocalPoint;\n  fabric.controlsUtils = controls;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    degreesToRadians = fabric.util.degreesToRadians,\n    controls = fabric.controlsUtils;\n\n  /**\n   * Render a round control, as per fabric features.\n   * This function is written to respect object properties like transparentCorners, cornerSize\n   * cornerColor, cornerStrokeColor\n   * plus the addition of offsetY and offsetX.\n   * @param {CanvasRenderingContext2D} ctx context to render on\n   * @param {Number} left x coordinate where the control center should be\n   * @param {Number} top y coordinate where the control center should be\n   * @param {Object} styleOverride override for fabric.Object controls style\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   */\n  function renderCircleControl(ctx, left, top, styleOverride, fabricObject) {\n    styleOverride = styleOverride || {};\n    var size = styleOverride.cornerSize || fabricObject.cornerSize,\n      transparentCorners =\n        typeof styleOverride.transparentCorners !== \"undefined\"\n          ? styleOverride.transparentCorners\n          : this.transparentCorners,\n      methodName = transparentCorners ? \"stroke\" : \"fill\",\n      stroke =\n        !transparentCorners &&\n        (styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor);\n    ctx.save();\n    ctx.fillStyle = styleOverride.cornerColor || fabricObject.cornerColor;\n    ctx.strokeStyle =\n      styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor;\n    // this is still wrong\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.arc(left, top, size / 2, 0, 2 * Math.PI, false);\n    ctx[methodName]();\n    if (stroke) {\n      ctx.stroke();\n    }\n    ctx.restore();\n  }\n\n  /**\n   * Render a square control, as per fabric features.\n   * This function is written to respect object properties like transparentCorners, cornerSize\n   * cornerColor, cornerStrokeColor\n   * plus the addition of offsetY and offsetX.\n   * @param {CanvasRenderingContext2D} ctx context to render on\n   * @param {Number} left x coordinate where the control center should be\n   * @param {Number} top y coordinate where the control center should be\n   * @param {Object} styleOverride override for fabric.Object controls style\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   */\n  function renderSquareControl(ctx, left, top, styleOverride, fabricObject) {\n    styleOverride = styleOverride || {};\n    var size = styleOverride.cornerSize || fabricObject.cornerSize,\n      transparentCorners =\n        typeof styleOverride.transparentCorners !== \"undefined\"\n          ? styleOverride.transparentCorners\n          : fabricObject.transparentCorners,\n      methodName = transparentCorners ? \"stroke\" : \"fill\",\n      stroke =\n        !transparentCorners &&\n        (styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor),\n      sizeBy2 = size / 2;\n    ctx.save();\n    ctx.fillStyle = styleOverride.cornerColor || fabricObject.cornerColor;\n    ctx.strokeStyle =\n      styleOverride.strokeCornerColor || fabricObject.strokeCornerColor;\n    // this is still wrong\n    ctx.lineWidth = 1;\n    ctx.translate(left, top);\n    ctx.rotate(degreesToRadians(fabricObject.angle));\n    // this does not work, and fixed with ( && ) does not make sense.\n    // to have real transparent corners we need the controls on upperCanvas\n    // transparentCorners || ctx.clearRect(-sizeBy2, -sizeBy2, size, size);\n    ctx[methodName + \"Rect\"](-sizeBy2, -sizeBy2, size, size);\n    if (stroke) {\n      ctx.strokeRect(-sizeBy2, -sizeBy2, size, size);\n    }\n    ctx.restore();\n  }\n\n  controls.renderCircleControl = renderCircleControl;\n  controls.renderSquareControl = renderSquareControl;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  function Control(options) {\n    for (var i in options) {\n      this[i] = options[i];\n    }\n  }\n\n  fabric.Control = Control;\n\n  fabric.Control.prototype = /** @lends fabric.Control.prototype */ {\n    /**\n     * keep track of control visibility.\n     * mainly for backward compatibility.\n     * if you do not want to see a control, you can remove it\n     * from the controlset.\n     * @type {Boolean}\n     * @default true\n     */\n    visible: true,\n\n    /**\n     * Name of the action that the controll will likely execute.\n     * This is optional. FabricJS uses to identify what the user is doing for some\n     * extra optimizations. If you are writing a custom control and you want to know\n     * somewhere else in the code what is going on, you can use this string here.\n     * you can also provide a custom getActionName if your control run multiple actions\n     * depending on some external state.\n     * default to scale since is the most common, used on 4 corners by default\n     * @type {String}\n     * @default 'scale'\n     */\n    actionName: \"scale\",\n\n    /**\n     * Drawing angle of the control.\n     * NOT used for now, but name marked as needed for internal logic\n     * example: to reuse the same drawing function for different rotated controls\n     * @type {Number}\n     * @default 0\n     */\n    angle: 0,\n\n    /**\n     * Relative position of the control. X\n     * 0,0 is the center of the Object, while -0.5 (left) or 0.5 (right) are the extremities\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    x: 0,\n\n    /**\n     * Relative position of the control. Y\n     * 0,0 is the center of the Object, while -0.5 (top) or 0.5 (bottom) are the extremities\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    y: 0,\n\n    /**\n     * Horizontal offset of the control from the defined position. In pixels\n     * Positive offset moves the control to the right, negative to the left.\n     * It used when you want to have position of control that does not scale with\n     * the bounding box. Example: rotation control is placed at x:0, y: 0.5 on\n     * the boundindbox, with an offset of 30 pixels vertivally. Those 30 pixels will\n     * stay 30 pixels no matter how the object is big. Another example is having 2\n     * controls in the corner, that stay in the same position when the object scale.\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    offsetX: 0,\n\n    /**\n     * Vertical offset of the control from the defined position. In pixels\n     * Positive offset moves the control to the bottom, negative to the top.\n     * @type {Number}\n     * @default 0\n     */\n    offsetY: 0,\n\n    /**\n     * Css cursor style to display when the control is hovered.\n     * if the method `cursorStyleHandler` is provided, this property is ignored.\n     * @type {String}\n     * @default 'crosshair'\n     */\n    cursorStyle: \"crosshair\",\n\n    /**\n     * If controls has an offsetY or offsetX, draw a line that connects\n     * the control to the bounding box\n     * @type {Boolean}\n     * @default false\n     */\n    withConnection: false,\n\n    /**\n     * The control actionHandler, provide one to handle action ( control being moved )\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */\n    actionHandler: function (/* eventData, transformData, fabricObject */) {},\n\n    /**\n     * The control handler for mouse down, provide one to handle mouse down on control\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */\n    mouseDownHandler: function (/* eventData, transformData, fabricObject */) {},\n\n    /**\n     * The control mouseUpHandler, provide one to handle an effect on mouse up.\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */\n    mouseUpHandler: function (/* eventData, transformData, fabricObject */) {},\n\n    /**\n     * Returns control actionHandler\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */\n    getActionHandler: function (/* eventData, transformData, fabricObject */) {\n      return this.actionHandler;\n    },\n\n    /**\n     * Returns control mouseDown handler\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */\n    getMouseDownHandler: function (/* eventData, fabricObject, control */) {\n      return this.mouseDownHandler;\n    },\n\n    /**\n     * Returns control mouseUp handler\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {Function}\n     */\n    getMouseUpHandler: function (/* eventData, fabricObject, control */) {\n      return this.mouseUpHandler;\n    },\n\n    /**\n     * Returns control cursorStyle for css using cursorStyle. If you need a more elaborate\n     * function you can pass one in the constructor\n     * the cursorStyle property\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Control} control the current control ( likely this)\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {String}\n     */\n    cursorStyleHandler: function (eventData, control /* fabricObject */) {\n      return control.cursorStyle;\n    },\n\n    /**\n     * Returns the action name. The basic implementation just return the actionName property.\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Control} control the current control ( likely this)\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {String}\n     */\n    getActionName: function (eventData, control /* fabricObject */) {\n      return control.actionName;\n    },\n\n    /**\n     * Returns controls visibility\n     * @param {fabric.Object} object on which the control is displayed\n     * @param {String} controlKey key where the control is memorized on the\n     * @return {Boolean}\n     */\n    getVisibility: function (fabricObject, controlKey) {\n      var objectVisibility = fabricObject._controlsVisibility;\n      if (\n        objectVisibility &&\n        typeof objectVisibility[controlKey] !== \"undefined\"\n      ) {\n        return objectVisibility[controlKey];\n      }\n      return this.visible;\n    },\n\n    /**\n     * Sets controls visibility\n     * @param {Boolean} visibility for the object\n     * @return {Void}\n     */\n    setVisibility: function (visibility /* name, fabricObject */) {\n      this.visible = visibility;\n    },\n\n    positionHandler: function (\n      dim,\n      finalMatrix /*, fabricObject, currentControl */\n    ) {\n      var point = fabric.util.transformPoint(\n        {\n          x: this.x * dim.x + this.offsetX,\n          y: this.y * dim.y + this.offsetY,\n        },\n        finalMatrix\n      );\n      return point;\n    },\n\n    /**\n     * Render function for the control.\n     * When this function runs the context is unscaled. unrotate. Just retina scaled.\n     * all the functions will have to translate to the point left,top before starting Drawing\n     * if they want to draw a control where the position is detected.\n     * left and top are the result of the positionHandler function\n     * @param {RenderingContext2D} ctx the context where the control will be drawn\n     * @param {Number} left position of the canvas where we are about to render the control.\n     * @param {Number} top position of the canvas where we are about to render the control.\n     * @param {Object} styleOverride\n     * @param {fabric.Object} fabricObject the object where the control is about to be rendered\n     */\n    render: function (ctx, left, top, styleOverride, fabricObject) {\n      styleOverride = styleOverride || {};\n      switch (styleOverride.cornerStyle || fabricObject.cornerStyle) {\n        case \"circle\":\n          fabric.controlsUtils.renderCircleControl.call(\n            this,\n            ctx,\n            left,\n            top,\n            styleOverride,\n            fabricObject\n          );\n          break;\n        default:\n          fabric.controlsUtils.renderSquareControl.call(\n            this,\n            ctx,\n            left,\n            top,\n            styleOverride,\n            fabricObject\n          );\n      }\n    },\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function () {\n  /* _FROM_SVG_START_ */\n  function getColorStop(el, multiplier) {\n    var style = el.getAttribute(\"style\"),\n      offset = el.getAttribute(\"offset\") || 0,\n      color,\n      colorAlpha,\n      opacity,\n      i;\n\n    // convert percents to absolute values\n    offset = parseFloat(offset) / (/%$/.test(offset) ? 100 : 1);\n    offset = offset < 0 ? 0 : offset > 1 ? 1 : offset;\n    if (style) {\n      var keyValuePairs = style.split(/\\s*;\\s*/);\n\n      if (keyValuePairs[keyValuePairs.length - 1] === \"\") {\n        keyValuePairs.pop();\n      }\n\n      for (i = keyValuePairs.length; i--; ) {\n        var split = keyValuePairs[i].split(/\\s*:\\s*/),\n          key = split[0].trim(),\n          value = split[1].trim();\n\n        if (key === \"stop-color\") {\n          color = value;\n        } else if (key === \"stop-opacity\") {\n          opacity = value;\n        }\n      }\n    }\n\n    if (!color) {\n      color = el.getAttribute(\"stop-color\") || \"rgb(0,0,0)\";\n    }\n    if (!opacity) {\n      opacity = el.getAttribute(\"stop-opacity\");\n    }\n\n    color = new fabric.Color(color);\n    colorAlpha = color.getAlpha();\n    opacity = isNaN(parseFloat(opacity)) ? 1 : parseFloat(opacity);\n    opacity *= colorAlpha * multiplier;\n\n    return {\n      offset: offset,\n      color: color.toRgb(),\n      opacity: opacity,\n    };\n  }\n\n  function getLinearCoords(el) {\n    return {\n      x1: el.getAttribute(\"x1\") || 0,\n      y1: el.getAttribute(\"y1\") || 0,\n      x2: el.getAttribute(\"x2\") || \"100%\",\n      y2: el.getAttribute(\"y2\") || 0,\n    };\n  }\n\n  function getRadialCoords(el) {\n    return {\n      x1: el.getAttribute(\"fx\") || el.getAttribute(\"cx\") || \"50%\",\n      y1: el.getAttribute(\"fy\") || el.getAttribute(\"cy\") || \"50%\",\n      r1: 0,\n      x2: el.getAttribute(\"cx\") || \"50%\",\n      y2: el.getAttribute(\"cy\") || \"50%\",\n      r2: el.getAttribute(\"r\") || \"50%\",\n    };\n  }\n  /* _FROM_SVG_END_ */\n\n  var clone = fabric.util.object.clone;\n\n  /**\n   * Gradient class\n   * @class fabric.Gradient\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#gradients}\n   * @see {@link fabric.Gradient#initialize} for constructor definition\n   */\n  fabric.Gradient = fabric.util.createClass(\n    /** @lends fabric.Gradient.prototype */ {\n      /**\n       * Horizontal offset for aligning gradients coming from SVG when outside pathgroups\n       * @type Number\n       * @default 0\n       */\n      offsetX: 0,\n\n      /**\n       * Vertical offset for aligning gradients coming from SVG when outside pathgroups\n       * @type Number\n       * @default 0\n       */\n      offsetY: 0,\n\n      /**\n       * A transform matrix to apply to the gradient before painting.\n       * Imported from svg gradients, is not applied with the current transform in the center.\n       * Before this transform is applied, the origin point is at the top left corner of the object\n       * plus the addition of offsetY and offsetX.\n       * @type Number[]\n       * @default null\n       */\n      gradientTransform: null,\n\n      /**\n       * coordinates units for coords.\n       * If `pixels`, the number of coords are in the same unit of width / height.\n       * If set as `percentage` the coords are still a number, but 1 means 100% of width\n       * for the X and 100% of the height for the y. It can be bigger than 1 and negative.\n       * allowed values pixels or percentage.\n       * @type String\n       * @default 'pixels'\n       */\n      gradientUnits: \"pixels\",\n\n      /**\n       * Gradient type linear or radial\n       * @type String\n       * @default 'pixels'\n       */\n      type: \"linear\",\n\n      /**\n       * Constructor\n       * @param {Object} options Options object with type, coords, gradientUnits and colorStops\n       * @param {Object} [options.type] gradient type linear or radial\n       * @param {Object} [options.gradientUnits] gradient units\n       * @param {Object} [options.offsetX] SVG import compatibility\n       * @param {Object} [options.offsetY] SVG import compatibility\n       * @param {Object[]} options.colorStops contains the colorstops.\n       * @param {Object} options.coords contains the coords of the gradient\n       * @param {Number} [options.coords.x1] X coordiante of the first point for linear or of the focal point for radial\n       * @param {Number} [options.coords.y1] Y coordiante of the first point for linear or of the focal point for radial\n       * @param {Number} [options.coords.x2] X coordiante of the second point for linear or of the center point for radial\n       * @param {Number} [options.coords.y2] Y coordiante of the second point for linear or of the center point for radial\n       * @param {Number} [options.coords.r1] only for radial gradient, radius of the inner circle\n       * @param {Number} [options.coords.r2] only for radial gradient, radius of the external circle\n       * @return {fabric.Gradient} thisArg\n       */\n      initialize: function (options) {\n        options || (options = {});\n        options.coords || (options.coords = {});\n\n        var coords,\n          _this = this;\n\n        // sets everything, then coords and colorstops get sets again\n        Object.keys(options).forEach(function (option) {\n          _this[option] = options[option];\n        });\n\n        if (this.id) {\n          this.id += \"_\" + fabric.Object.__uid++;\n        } else {\n          this.id = fabric.Object.__uid++;\n        }\n\n        coords = {\n          x1: options.coords.x1 || 0,\n          y1: options.coords.y1 || 0,\n          x2: options.coords.x2 || 0,\n          y2: options.coords.y2 || 0,\n        };\n\n        if (this.type === \"radial\") {\n          coords.r1 = options.coords.r1 || 0;\n          coords.r2 = options.coords.r2 || 0;\n        }\n\n        this.coords = coords;\n        this.colorStops = options.colorStops.slice();\n      },\n\n      /**\n       * Adds another colorStop\n       * @param {Object} colorStop Object with offset and color\n       * @return {fabric.Gradient} thisArg\n       */\n      addColorStop: function (colorStops) {\n        for (var position in colorStops) {\n          var color = new fabric.Color(colorStops[position]);\n          this.colorStops.push({\n            offset: parseFloat(position),\n            color: color.toRgb(),\n            opacity: color.getAlpha(),\n          });\n        }\n        return this;\n      },\n\n      /**\n       * Returns object representation of a gradient\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object}\n       */\n      toObject: function (propertiesToInclude) {\n        var object = {\n          type: this.type,\n          coords: this.coords,\n          colorStops: this.colorStops,\n          offsetX: this.offsetX,\n          offsetY: this.offsetY,\n          gradientUnits: this.gradientUnits,\n          gradientTransform: this.gradientTransform\n            ? this.gradientTransform.concat()\n            : this.gradientTransform,\n        };\n        fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n        return object;\n      },\n\n      /* _TO_SVG_START_ */\n      /**\n       * Returns SVG representation of an gradient\n       * @param {Object} object Object to create a gradient for\n       * @return {String} SVG representation of an gradient (linear/radial)\n       */\n      toSVG: function (object, options) {\n        var coords = clone(this.coords, true),\n          i,\n          len,\n          options = options || {},\n          markup,\n          commonAttributes,\n          colorStops = clone(this.colorStops, true),\n          needsSwap = coords.r1 > coords.r2,\n          transform = this.gradientTransform\n            ? this.gradientTransform.concat()\n            : fabric.iMatrix.concat(),\n          offsetX = -this.offsetX,\n          offsetY = -this.offsetY,\n          withViewport = !!options.additionalTransform,\n          gradientUnits =\n            this.gradientUnits === \"pixels\"\n              ? \"userSpaceOnUse\"\n              : \"objectBoundingBox\";\n        // colorStops must be sorted ascending\n        colorStops.sort(function (a, b) {\n          return a.offset - b.offset;\n        });\n\n        if (gradientUnits === \"objectBoundingBox\") {\n          offsetX /= object.width;\n          offsetY /= object.height;\n        } else {\n          offsetX += object.width / 2;\n          offsetY += object.height / 2;\n        }\n        if (object.type === \"path\") {\n          offsetX -= object.pathOffset.x;\n          offsetY -= object.pathOffset.y;\n        }\n\n        transform[4] -= offsetX;\n        transform[5] -= offsetY;\n\n        commonAttributes =\n          'id=\"SVGID_' + this.id + '\" gradientUnits=\"' + gradientUnits + '\"';\n        commonAttributes +=\n          ' gradientTransform=\"' +\n          (withViewport ? options.additionalTransform + \" \" : \"\") +\n          fabric.util.matrixToSVG(transform) +\n          '\" ';\n\n        if (this.type === \"linear\") {\n          markup = [\n            \"<linearGradient \",\n            commonAttributes,\n            ' x1=\"',\n            coords.x1,\n            '\" y1=\"',\n            coords.y1,\n            '\" x2=\"',\n            coords.x2,\n            '\" y2=\"',\n            coords.y2,\n            '\">\\n',\n          ];\n        } else if (this.type === \"radial\") {\n          // svg radial gradient has just 1 radius. the biggest.\n          markup = [\n            \"<radialGradient \",\n            commonAttributes,\n            ' cx=\"',\n            needsSwap ? coords.x1 : coords.x2,\n            '\" cy=\"',\n            needsSwap ? coords.y1 : coords.y2,\n            '\" r=\"',\n            needsSwap ? coords.r1 : coords.r2,\n            '\" fx=\"',\n            needsSwap ? coords.x2 : coords.x1,\n            '\" fy=\"',\n            needsSwap ? coords.y2 : coords.y1,\n            '\">\\n',\n          ];\n        }\n\n        if (this.type === \"radial\") {\n          if (needsSwap) {\n            // svg goes from internal to external radius. if radius are inverted, swap color stops.\n            colorStops = colorStops.concat();\n            colorStops.reverse();\n            for (i = 0, len = colorStops.length; i < len; i++) {\n              colorStops[i].offset = 1 - colorStops[i].offset;\n            }\n          }\n          var minRadius = Math.min(coords.r1, coords.r2);\n          if (minRadius > 0) {\n            // i have to shift all colorStops and add new one in 0.\n            var maxRadius = Math.max(coords.r1, coords.r2),\n              percentageShift = minRadius / maxRadius;\n            for (i = 0, len = colorStops.length; i < len; i++) {\n              colorStops[i].offset +=\n                percentageShift * (1 - colorStops[i].offset);\n            }\n          }\n        }\n\n        for (i = 0, len = colorStops.length; i < len; i++) {\n          var colorStop = colorStops[i];\n          markup.push(\n            \"<stop \",\n            'offset=\"',\n            colorStop.offset * 100 + \"%\",\n            '\" style=\"stop-color:',\n            colorStop.color,\n            typeof colorStop.opacity !== \"undefined\"\n              ? \";stop-opacity: \" + colorStop.opacity\n              : \";\",\n            '\"/>\\n'\n          );\n        }\n\n        markup.push(\n          this.type === \"linear\" ? \"</linearGradient>\\n\" : \"</radialGradient>\\n\"\n        );\n\n        return markup.join(\"\");\n      },\n      /* _TO_SVG_END_ */\n\n      /**\n       * Returns an instance of CanvasGradient\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @return {CanvasGradient}\n       */\n      toLive: function (ctx) {\n        var gradient,\n          coords = fabric.util.object.clone(this.coords),\n          i,\n          len;\n\n        if (!this.type) {\n          return;\n        }\n\n        if (this.type === \"linear\") {\n          gradient = ctx.createLinearGradient(\n            coords.x1,\n            coords.y1,\n            coords.x2,\n            coords.y2\n          );\n        } else if (this.type === \"radial\") {\n          gradient = ctx.createRadialGradient(\n            coords.x1,\n            coords.y1,\n            coords.r1,\n            coords.x2,\n            coords.y2,\n            coords.r2\n          );\n        }\n\n        for (i = 0, len = this.colorStops.length; i < len; i++) {\n          var color = this.colorStops[i].color,\n            opacity = this.colorStops[i].opacity,\n            offset = this.colorStops[i].offset;\n\n          if (typeof opacity !== \"undefined\") {\n            color = new fabric.Color(color).setAlpha(opacity).toRgba();\n          }\n          gradient.addColorStop(offset, color);\n        }\n\n        return gradient;\n      },\n    }\n  );\n\n  fabric.util.object.extend(fabric.Gradient, {\n    /* _FROM_SVG_START_ */\n    /**\n     * Returns {@link fabric.Gradient} instance from an SVG element\n     * @static\n     * @memberOf fabric.Gradient\n     * @param {SVGGradientElement} el SVG gradient element\n     * @param {fabric.Object} instance\n     * @param {String} opacityAttr A fill-opacity or stroke-opacity attribute to multiply to each stop's opacity.\n     * @param {Object} svgOptions an object containing the size of the SVG in order to parse correctly graidents\n     * that uses gradientUnits as 'userSpaceOnUse' and percentages.\n     * @param {Object.number} viewBoxWidth width part of the viewBox attribute on svg\n     * @param {Object.number} viewBoxHeight height part of the viewBox attribute on svg\n     * @param {Object.number} width width part of the svg tag if viewBox is not specified\n     * @param {Object.number} height height part of the svg tag if viewBox is not specified\n     * @return {fabric.Gradient} Gradient instance\n     * @see http://www.w3.org/TR/SVG/pservers.html#LinearGradientElement\n     * @see http://www.w3.org/TR/SVG/pservers.html#RadialGradientElement\n     */\n    fromElement: function (el, instance, opacityAttr, svgOptions) {\n      /**\n       *  @example:\n       *\n       *  <linearGradient id=\"linearGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\"/>\n       *    <stop offset=\"100%\" stop-color=\"black\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <linearGradient id=\"linearGrad2\">\n       *    <stop offset=\"0\" style=\"stop-color:rgb(255,255,255)\"/>\n       *    <stop offset=\"1\" style=\"stop-color:rgb(0,0,0)\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *    <stop offset=\"50%\" stop-color=\"black\" stop-opacity=\"0.5\" />\n       *    <stop offset=\"100%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *  </radialGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad2\">\n       *    <stop offset=\"0\" stop-color=\"rgb(255,255,255)\" />\n       *    <stop offset=\"0.5\" stop-color=\"rgb(0,0,0)\" />\n       *    <stop offset=\"1\" stop-color=\"rgb(255,255,255)\" />\n       *  </radialGradient>\n       *\n       */\n\n      var multiplier =\n        parseFloat(opacityAttr) / (/%$/.test(opacityAttr) ? 100 : 1);\n      multiplier = multiplier < 0 ? 0 : multiplier > 1 ? 1 : multiplier;\n      if (isNaN(multiplier)) {\n        multiplier = 1;\n      }\n\n      var colorStopEls = el.getElementsByTagName(\"stop\"),\n        type,\n        gradientUnits =\n          el.getAttribute(\"gradientUnits\") === \"userSpaceOnUse\"\n            ? \"pixels\"\n            : \"percentage\",\n        gradientTransform = el.getAttribute(\"gradientTransform\") || \"\",\n        colorStops = [],\n        coords,\n        i,\n        offsetX = 0,\n        offsetY = 0,\n        transformMatrix;\n      if (\n        el.nodeName === \"linearGradient\" ||\n        el.nodeName === \"LINEARGRADIENT\"\n      ) {\n        type = \"linear\";\n        coords = getLinearCoords(el);\n      } else {\n        type = \"radial\";\n        coords = getRadialCoords(el);\n      }\n\n      for (i = colorStopEls.length; i--; ) {\n        colorStops.push(getColorStop(colorStopEls[i], multiplier));\n      }\n\n      transformMatrix = fabric.parseTransformAttribute(gradientTransform);\n\n      __convertPercentUnitsToValues(\n        instance,\n        coords,\n        svgOptions,\n        gradientUnits\n      );\n\n      if (gradientUnits === \"pixels\") {\n        offsetX = -instance.left;\n        offsetY = -instance.top;\n      }\n\n      var gradient = new fabric.Gradient({\n        id: el.getAttribute(\"id\"),\n        type: type,\n        coords: coords,\n        colorStops: colorStops,\n        gradientUnits: gradientUnits,\n        gradientTransform: transformMatrix,\n        offsetX: offsetX,\n        offsetY: offsetY,\n      });\n\n      return gradient;\n    },\n    /* _FROM_SVG_END_ */\n  });\n\n  /**\n   * @private\n   */\n  function __convertPercentUnitsToValues(\n    instance,\n    options,\n    svgOptions,\n    gradientUnits\n  ) {\n    var propValue, finalValue;\n    Object.keys(options).forEach(function (prop) {\n      propValue = options[prop];\n      if (propValue === \"Infinity\") {\n        finalValue = 1;\n      } else if (propValue === \"-Infinity\") {\n        finalValue = 0;\n      } else {\n        finalValue = parseFloat(options[prop], 10);\n        if (\n          typeof propValue === \"string\" &&\n          /^(\\d+\\.\\d+)%|(\\d+)%$/.test(propValue)\n        ) {\n          finalValue *= 0.01;\n          if (gradientUnits === \"pixels\") {\n            // then we need to fix those percentages here in svg parsing\n            if (prop === \"x1\" || prop === \"x2\" || prop === \"r2\") {\n              finalValue *= svgOptions.viewBoxWidth || svgOptions.width;\n            }\n            if (prop === \"y1\" || prop === \"y2\") {\n              finalValue *= svgOptions.viewBoxHeight || svgOptions.height;\n            }\n          }\n        }\n      }\n      options[prop] = finalValue;\n    });\n  }\n})();\n\n(function () {\n  \"use strict\";\n\n  var toFixed = fabric.util.toFixed;\n\n  /**\n   * Pattern class\n   * @class fabric.Pattern\n   * @see {@link http://fabricjs.com/patterns|Pattern demo}\n   * @see {@link http://fabricjs.com/dynamic-patterns|DynamicPattern demo}\n   * @see {@link fabric.Pattern#initialize} for constructor definition\n   */\n\n  fabric.Pattern = fabric.util.createClass(\n    /** @lends fabric.Pattern.prototype */ {\n      /**\n       * Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)\n       * @type String\n       * @default\n       */\n      repeat: \"repeat\",\n\n      /**\n       * Pattern horizontal offset from object's left/top corner\n       * @type Number\n       * @default\n       */\n      offsetX: 0,\n\n      /**\n       * Pattern vertical offset from object's left/top corner\n       * @type Number\n       * @default\n       */\n      offsetY: 0,\n\n      /**\n       * crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n       * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n       * @type String\n       * @default\n       */\n      crossOrigin: \"\",\n\n      /**\n       * transform matrix to change the pattern, imported from svgs.\n       * @type Array\n       * @default\n       */\n      patternTransform: null,\n\n      /**\n       * Constructor\n       * @param {Object} [options] Options object\n       * @param {Function} [callback] function to invoke after callback init.\n       * @return {fabric.Pattern} thisArg\n       */\n      initialize: function (options, callback) {\n        options || (options = {});\n\n        this.id = fabric.Object.__uid++;\n        this.setOptions(options);\n        if (\n          !options.source ||\n          (options.source && typeof options.source !== \"string\")\n        ) {\n          callback && callback(this);\n          return;\n        } else {\n          // img src string\n          var _this = this;\n          this.source = fabric.util.createImage();\n          fabric.util.loadImage(\n            options.source,\n            function (img, isError) {\n              _this.source = img;\n              callback && callback(_this, isError);\n            },\n            null,\n            this.crossOrigin\n          );\n        }\n      },\n\n      /**\n       * Returns object representation of a pattern\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} Object representation of a pattern instance\n       */\n      toObject: function (propertiesToInclude) {\n        var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          source,\n          object;\n\n        // <img> element\n        if (typeof this.source.src === \"string\") {\n          source = this.source.src;\n        }\n        // <canvas> element\n        else if (typeof this.source === \"object\" && this.source.toDataURL) {\n          source = this.source.toDataURL();\n        }\n\n        object = {\n          type: \"pattern\",\n          source: source,\n          repeat: this.repeat,\n          crossOrigin: this.crossOrigin,\n          offsetX: toFixed(this.offsetX, NUM_FRACTION_DIGITS),\n          offsetY: toFixed(this.offsetY, NUM_FRACTION_DIGITS),\n          patternTransform: this.patternTransform\n            ? this.patternTransform.concat()\n            : null,\n        };\n        fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n        return object;\n      },\n\n      /* _TO_SVG_START_ */\n      /**\n       * Returns SVG representation of a pattern\n       * @param {fabric.Object} object\n       * @return {String} SVG representation of a pattern\n       */\n      toSVG: function (object) {\n        var patternSource =\n            typeof this.source === \"function\" ? this.source() : this.source,\n          patternWidth = patternSource.width / object.width,\n          patternHeight = patternSource.height / object.height,\n          patternOffsetX = this.offsetX / object.width,\n          patternOffsetY = this.offsetY / object.height,\n          patternImgSrc = \"\";\n        if (this.repeat === \"repeat-x\" || this.repeat === \"no-repeat\") {\n          patternHeight = 1;\n          if (patternOffsetY) {\n            patternHeight += Math.abs(patternOffsetY);\n          }\n        }\n        if (this.repeat === \"repeat-y\" || this.repeat === \"no-repeat\") {\n          patternWidth = 1;\n          if (patternOffsetX) {\n            patternWidth += Math.abs(patternOffsetX);\n          }\n        }\n        if (patternSource.src) {\n          patternImgSrc = patternSource.src;\n        } else if (patternSource.toDataURL) {\n          patternImgSrc = patternSource.toDataURL();\n        }\n\n        return (\n          '<pattern id=\"SVGID_' +\n          this.id +\n          '\" x=\"' +\n          patternOffsetX +\n          '\" y=\"' +\n          patternOffsetY +\n          '\" width=\"' +\n          patternWidth +\n          '\" height=\"' +\n          patternHeight +\n          '\">\\n' +\n          '<image x=\"0\" y=\"0\"' +\n          ' width=\"' +\n          patternSource.width +\n          '\" height=\"' +\n          patternSource.height +\n          '\" xlink:href=\"' +\n          patternImgSrc +\n          '\"></image>\\n' +\n          \"</pattern>\\n\"\n        );\n      },\n      /* _TO_SVG_END_ */\n\n      setOptions: function (options) {\n        for (var prop in options) {\n          this[prop] = options[prop];\n        }\n      },\n\n      /**\n       * Returns an instance of CanvasPattern\n       * @param {CanvasRenderingContext2D} ctx Context to create pattern\n       * @return {CanvasPattern}\n       */\n      toLive: function (ctx) {\n        var source = this.source;\n        // if the image failed to load, return, and allow rest to continue loading\n        if (!source) {\n          return \"\";\n        }\n\n        // if an image\n        if (typeof source.src !== \"undefined\") {\n          if (!source.complete) {\n            return \"\";\n          }\n          if (source.naturalWidth === 0 || source.naturalHeight === 0) {\n            return \"\";\n          }\n        }\n        return ctx.createPattern(source, this.repeat);\n      },\n    }\n  );\n})();\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    toFixed = fabric.util.toFixed;\n\n  if (fabric.Shadow) {\n    fabric.warn(\"fabric.Shadow is already defined.\");\n    return;\n  }\n\n  /**\n   * Shadow class\n   * @class fabric.Shadow\n   * @see {@link http://fabricjs.com/shadows|Shadow demo}\n   * @see {@link fabric.Shadow#initialize} for constructor definition\n   */\n  fabric.Shadow = fabric.util.createClass(\n    /** @lends fabric.Shadow.prototype */ {\n      /**\n       * Shadow color\n       * @type String\n       * @default\n       */\n      color: \"rgb(0,0,0)\",\n\n      /**\n       * Shadow blur\n       * @type Number\n       */\n      blur: 0,\n\n      /**\n       * Shadow horizontal offset\n       * @type Number\n       * @default\n       */\n      offsetX: 0,\n\n      /**\n       * Shadow vertical offset\n       * @type Number\n       * @default\n       */\n      offsetY: 0,\n\n      /**\n       * Whether the shadow should affect stroke operations\n       * @type Boolean\n       * @default\n       */\n      affectStroke: false,\n\n      /**\n       * Indicates whether toObject should include default values\n       * @type Boolean\n       * @default\n       */\n      includeDefaultValues: true,\n\n      /**\n       * When `false`, the shadow will scale with the object.\n       * When `true`, the shadow's offsetX, offsetY, and blur will not be affected by the object's scale.\n       * default to false\n       * @type Boolean\n       * @default\n       */\n      nonScaling: false,\n\n      /**\n       * Constructor\n       * @param {Object|String} [options] Options object with any of color, blur, offsetX, offsetY properties or string (e.g. \"rgba(0,0,0,0.2) 2px 2px 10px\")\n       * @return {fabric.Shadow} thisArg\n       */\n      initialize: function (options) {\n        if (typeof options === \"string\") {\n          options = this._parseShadow(options);\n        }\n\n        for (var prop in options) {\n          this[prop] = options[prop];\n        }\n\n        this.id = fabric.Object.__uid++;\n      },\n\n      /**\n       * @private\n       * @param {String} shadow Shadow value to parse\n       * @return {Object} Shadow object with color, offsetX, offsetY and blur\n       */\n      _parseShadow: function (shadow) {\n        var shadowStr = shadow.trim(),\n          offsetsAndBlur = fabric.Shadow.reOffsetsAndBlur.exec(shadowStr) || [],\n          color =\n            shadowStr.replace(fabric.Shadow.reOffsetsAndBlur, \"\") ||\n            \"rgb(0,0,0)\";\n\n        return {\n          color: color.trim(),\n          offsetX: parseInt(offsetsAndBlur[1], 10) || 0,\n          offsetY: parseInt(offsetsAndBlur[2], 10) || 0,\n          blur: parseInt(offsetsAndBlur[3], 10) || 0,\n        };\n      },\n\n      /**\n       * Returns a string representation of an instance\n       * @see http://www.w3.org/TR/css-text-decor-3/#text-shadow\n       * @return {String} Returns CSS3 text-shadow declaration\n       */\n      toString: function () {\n        return [this.offsetX, this.offsetY, this.blur, this.color].join(\"px \");\n      },\n\n      /* _TO_SVG_START_ */\n      /**\n       * Returns SVG representation of a shadow\n       * @param {fabric.Object} object\n       * @return {String} SVG representation of a shadow\n       */\n      toSVG: function (object) {\n        var fBoxX = 40,\n          fBoxY = 40,\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          offset = fabric.util.rotateVector(\n            { x: this.offsetX, y: this.offsetY },\n            fabric.util.degreesToRadians(-object.angle)\n          ),\n          BLUR_BOX = 20,\n          color = new fabric.Color(this.color);\n\n        if (object.width && object.height) {\n          //http://www.w3.org/TR/SVG/filters.html#FilterEffectsRegion\n          // we add some extra space to filter box to contain the blur ( 20 )\n          fBoxX =\n            toFixed(\n              (Math.abs(offset.x) + this.blur) / object.width,\n              NUM_FRACTION_DIGITS\n            ) *\n              100 +\n            BLUR_BOX;\n          fBoxY =\n            toFixed(\n              (Math.abs(offset.y) + this.blur) / object.height,\n              NUM_FRACTION_DIGITS\n            ) *\n              100 +\n            BLUR_BOX;\n        }\n        if (object.flipX) {\n          offset.x *= -1;\n        }\n        if (object.flipY) {\n          offset.y *= -1;\n        }\n\n        return (\n          '<filter id=\"SVGID_' +\n          this.id +\n          '\" y=\"-' +\n          fBoxY +\n          '%\" height=\"' +\n          (100 + 2 * fBoxY) +\n          '%\" ' +\n          'x=\"-' +\n          fBoxX +\n          '%\" width=\"' +\n          (100 + 2 * fBoxX) +\n          '%\" ' +\n          \">\\n\" +\n          '\\t<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"' +\n          toFixed(this.blur ? this.blur / 2 : 0, NUM_FRACTION_DIGITS) +\n          '\"></feGaussianBlur>\\n' +\n          '\\t<feOffset dx=\"' +\n          toFixed(offset.x, NUM_FRACTION_DIGITS) +\n          '\" dy=\"' +\n          toFixed(offset.y, NUM_FRACTION_DIGITS) +\n          '\" result=\"oBlur\" ></feOffset>\\n' +\n          '\\t<feFlood flood-color=\"' +\n          color.toRgb() +\n          '\" flood-opacity=\"' +\n          color.getAlpha() +\n          '\"/>\\n' +\n          '\\t<feComposite in2=\"oBlur\" operator=\"in\" />\\n' +\n          \"\\t<feMerge>\\n\" +\n          \"\\t\\t<feMergeNode></feMergeNode>\\n\" +\n          '\\t\\t<feMergeNode in=\"SourceGraphic\"></feMergeNode>\\n' +\n          \"\\t</feMerge>\\n\" +\n          \"</filter>\\n\"\n        );\n      },\n      /* _TO_SVG_END_ */\n\n      /**\n       * Returns object representation of a shadow\n       * @return {Object} Object representation of a shadow instance\n       */\n      toObject: function () {\n        if (this.includeDefaultValues) {\n          return {\n            color: this.color,\n            blur: this.blur,\n            offsetX: this.offsetX,\n            offsetY: this.offsetY,\n            affectStroke: this.affectStroke,\n            nonScaling: this.nonScaling,\n          };\n        }\n        var obj = {},\n          proto = fabric.Shadow.prototype;\n\n        [\n          \"color\",\n          \"blur\",\n          \"offsetX\",\n          \"offsetY\",\n          \"affectStroke\",\n          \"nonScaling\",\n        ].forEach(function (prop) {\n          if (this[prop] !== proto[prop]) {\n            obj[prop] = this[prop];\n          }\n        }, this);\n\n        return obj;\n      },\n    }\n  );\n\n  /**\n   * Regex matching shadow offsetX, offsetY and blur (ex: \"2px 2px 10px rgba(0,0,0,0.2)\", \"rgb(0,255,0) 2px 2px\")\n   * @static\n   * @field\n   * @memberOf fabric.Shadow\n   */\n  // eslint-disable-next-line max-len\n  fabric.Shadow.reOffsetsAndBlur = /(?:\\s|^)(-?\\d+(?:px)?(?:\\s?|$))?(-?\\d+(?:px)?(?:\\s?|$))?(\\d+(?:px)?)?(?:\\s?|$)(?:$|\\s)/;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function () {\n  \"use strict\";\n\n  if (fabric.StaticCanvas) {\n    fabric.warn(\"fabric.StaticCanvas is already defined.\");\n    return;\n  }\n\n  // aliases for faster resolution\n  var extend = fabric.util.object.extend,\n    getElementOffset = fabric.util.getElementOffset,\n    removeFromArray = fabric.util.removeFromArray,\n    toFixed = fabric.util.toFixed,\n    transformPoint = fabric.util.transformPoint,\n    invertTransform = fabric.util.invertTransform,\n    getNodeCanvas = fabric.util.getNodeCanvas,\n    createCanvasElement = fabric.util.createCanvasElement,\n    CANVAS_INIT_ERROR = new Error(\"Could not initialize `canvas` element\");\n\n  /**\n   * Static canvas class\n   * @class fabric.StaticCanvas\n   * @mixes fabric.Collection\n   * @mixes fabric.Observable\n   * @see {@link http://fabricjs.com/static_canvas|StaticCanvas demo}\n   * @see {@link fabric.StaticCanvas#initialize} for constructor definition\n   * @fires before:render\n   * @fires after:render\n   * @fires canvas:cleared\n   * @fires object:added\n   * @fires object:removed\n   */\n  fabric.StaticCanvas = fabric.util.createClass(\n    fabric.CommonMethods,\n    /** @lends fabric.StaticCanvas.prototype */ {\n      /**\n       * Constructor\n       * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n       * @param {Object} [options] Options object\n       * @return {Object} thisArg\n       */\n      initialize: function (el, options) {\n        options || (options = {});\n        this.renderAndResetBound = this.renderAndReset.bind(this);\n        this.requestRenderAllBound = this.requestRenderAll.bind(this);\n        this._initStatic(el, options);\n      },\n\n      /**\n       * Background color of canvas instance.\n       * Should be set via {@link fabric.StaticCanvas#setBackgroundColor}.\n       * @type {(String|fabric.Pattern)}\n       * @default\n       */\n      backgroundColor: \"\",\n\n      /**\n       * Background image of canvas instance.\n       * since 2.4.0 image caching is active, please when putting an image as background, add to the\n       * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n       * vale. As an alternative you can disable image objectCaching\n       * @type fabric.Image\n       * @default\n       */\n      backgroundImage: null,\n\n      /**\n       * Overlay color of canvas instance.\n       * Should be set via {@link fabric.StaticCanvas#setOverlayColor}\n       * @since 1.3.9\n       * @type {(String|fabric.Pattern)}\n       * @default\n       */\n      overlayColor: \"\",\n\n      /**\n       * Overlay image of canvas instance.\n       * since 2.4.0 image caching is active, please when putting an image as overlay, add to the\n       * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n       * vale. As an alternative you can disable image objectCaching\n       * @type fabric.Image\n       * @default\n       */\n      overlayImage: null,\n\n      /**\n       * Indicates whether toObject/toDatalessObject should include default values\n       * if set to false, takes precedence over the object value.\n       * @type Boolean\n       * @default\n       */\n      includeDefaultValues: true,\n\n      /**\n       * Indicates whether objects' state should be saved\n       * @type Boolean\n       * @default\n       */\n      stateful: false,\n\n      /**\n       * Indicates whether {@link fabric.Collection.add}, {@link fabric.Collection.insertAt} and {@link fabric.Collection.remove},\n       * {@link fabric.StaticCanvas.moveTo}, {@link fabric.StaticCanvas.clear} and many more, should also re-render canvas.\n       * Disabling this option will not give a performance boost when adding/removing a lot of objects to/from canvas at once\n       * since the renders are quequed and executed one per frame.\n       * Disabling is suggested anyway and managing the renders of the app manually is not a big effort ( canvas.requestRenderAll() )\n       * Left default to true to do not break documentation and old app, fiddles.\n       * @type Boolean\n       * @default\n       */\n      renderOnAddRemove: true,\n\n      /**\n       * Indicates whether object controls (borders/controls) are rendered above overlay image\n       * @type Boolean\n       * @default\n       */\n      controlsAboveOverlay: false,\n\n      /**\n       * Indicates whether the browser can be scrolled when using a touchscreen and dragging on the canvas\n       * @type Boolean\n       * @default\n       */\n      allowTouchScrolling: false,\n\n      /**\n       * Indicates whether this canvas will use image smoothing, this is on by default in browsers\n       * @type Boolean\n       * @default\n       */\n      imageSmoothingEnabled: true,\n\n      /**\n       * The transformation (in the format of Canvas transform) which focuses the viewport\n       * @type Array\n       * @default\n       */\n      viewportTransform: fabric.iMatrix.concat(),\n\n      /**\n       * if set to false background image is not affected by viewport transform\n       * @since 1.6.3\n       * @type Boolean\n       * @default\n       */\n      backgroundVpt: true,\n\n      /**\n       * if set to false overlya image is not affected by viewport transform\n       * @since 1.6.3\n       * @type Boolean\n       * @default\n       */\n      overlayVpt: true,\n\n      /**\n       * When true, canvas is scaled by devicePixelRatio for better rendering on retina screens\n       * @type Boolean\n       * @default\n       */\n      enableRetinaScaling: true,\n\n      /**\n       * Describe canvas element extension over design\n       * properties are tl,tr,bl,br.\n       * if canvas is not zoomed/panned those points are the four corner of canvas\n       * if canvas is viewportTransformed you those points indicate the extension\n       * of canvas element in plain untrasformed coordinates\n       * The coordinates get updated with @method calcViewportBoundaries.\n       * @memberOf fabric.StaticCanvas.prototype\n       */\n      vptCoords: {},\n\n      /**\n       * Based on vptCoords and object.aCoords, skip rendering of objects that\n       * are not included in current viewport.\n       * May greatly help in applications with crowded canvas and use of zoom/pan\n       * If One of the corner of the bounding box of the object is on the canvas\n       * the objects get rendered.\n       * @memberOf fabric.StaticCanvas.prototype\n       * @type Boolean\n       * @default\n       */\n      skipOffscreen: true,\n\n      /**\n       * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n       * the clipPath object gets used when the canvas has rendered, and the context is placed in the\n       * top left corner of the canvas.\n       * clipPath will clip away controls, if you do not want this to happen use controlsAboveOverlay = true\n       * @type fabric.Object\n       */\n      clipPath: undefined,\n\n      /**\n       * @private\n       * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n       * @param {Object} [options] Options object\n       */\n      _initStatic: function (el, options) {\n        var cb = this.requestRenderAllBound;\n        this._objects = [];\n        this._createLowerCanvas(el);\n        this._initOptions(options);\n        // only initialize retina scaling once\n        if (!this.interactive) {\n          this._initRetinaScaling();\n        }\n\n        if (options.overlayImage) {\n          this.setOverlayImage(options.overlayImage, cb);\n        }\n        if (options.backgroundImage) {\n          this.setBackgroundImage(options.backgroundImage, cb);\n        }\n        if (options.backgroundColor) {\n          this.setBackgroundColor(options.backgroundColor, cb);\n        }\n        if (options.overlayColor) {\n          this.setOverlayColor(options.overlayColor, cb);\n        }\n        this.calcOffset();\n      },\n\n      /**\n       * @private\n       */\n      _isRetinaScaling: function () {\n        return fabric.devicePixelRatio !== 1 && this.enableRetinaScaling;\n      },\n\n      /**\n       * @private\n       * @return {Number} retinaScaling if applied, otherwise 1;\n       */\n      getRetinaScaling: function () {\n        return this._isRetinaScaling() ? fabric.devicePixelRatio : 1;\n      },\n\n      /**\n       * @private\n       */\n      _initRetinaScaling: function () {\n        if (!this._isRetinaScaling()) {\n          return;\n        }\n        var scaleRatio = fabric.devicePixelRatio;\n        this.__initRetinaScaling(\n          scaleRatio,\n          this.lowerCanvasEl,\n          this.contextContainer\n        );\n        if (this.upperCanvasEl) {\n          this.__initRetinaScaling(\n            scaleRatio,\n            this.upperCanvasEl,\n            this.contextTop\n          );\n        }\n      },\n\n      __initRetinaScaling: function (scaleRatio, canvas, context) {\n        canvas.setAttribute(\"width\", this.width * scaleRatio);\n        canvas.setAttribute(\"height\", this.height * scaleRatio);\n        context.scale(scaleRatio, scaleRatio);\n      },\n\n      /**\n       * Calculates canvas element offset relative to the document\n       * This method is also attached as \"resize\" event handler of window\n       * @return {fabric.Canvas} instance\n       * @chainable\n       */\n      calcOffset: function () {\n        this._offset = getElementOffset(this.lowerCanvasEl);\n        return this;\n      },\n\n      /**\n       * Sets {@link fabric.StaticCanvas#overlayImage|overlay image} for this canvas\n       * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set overlay to\n       * @param {Function} callback callback to invoke when image is loaded and set as an overlay\n       * @param {Object} [options] Optional options to set for the {@link fabric.Image|overlay image}.\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       * @see {@link http://jsfiddle.net/fabricjs/MnzHT/|jsFiddle demo}\n       * @example <caption>Normal overlayImage with left/top = 0</caption>\n       * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n       *   // Needed to position overlayImage at 0/0\n       *   originX: 'left',\n       *   originY: 'top'\n       * });\n       * @example <caption>overlayImage with different properties</caption>\n       * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n       *   opacity: 0.5,\n       *   angle: 45,\n       *   left: 400,\n       *   top: 400,\n       *   originX: 'left',\n       *   originY: 'top'\n       * });\n       * @example <caption>Stretched overlayImage #1 - width/height correspond to canvas width/height</caption>\n       * fabric.Image.fromURL('http://fabricjs.com/assets/jail_cell_bars.png', function(img, isError) {\n       *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n       *    canvas.setOverlayImage(img, canvas.renderAll.bind(canvas));\n       * });\n       * @example <caption>Stretched overlayImage #2 - width/height correspond to canvas width/height</caption>\n       * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n       *   width: canvas.width,\n       *   height: canvas.height,\n       *   // Needed to position overlayImage at 0/0\n       *   originX: 'left',\n       *   originY: 'top'\n       * });\n       * @example <caption>overlayImage loaded from cross-origin</caption>\n       * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n       *   opacity: 0.5,\n       *   angle: 45,\n       *   left: 400,\n       *   top: 400,\n       *   originX: 'left',\n       *   originY: 'top',\n       *   crossOrigin: 'anonymous'\n       * });\n       */\n      setOverlayImage: function (image, callback, options) {\n        return this.__setBgOverlayImage(\n          \"overlayImage\",\n          image,\n          callback,\n          options\n        );\n      },\n\n      /**\n       * Sets {@link fabric.StaticCanvas#backgroundImage|background image} for this canvas\n       * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set background to\n       * @param {Function} callback Callback to invoke when image is loaded and set as background\n       * @param {Object} [options] Optional options to set for the {@link fabric.Image|background image}.\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       * @see {@link http://jsfiddle.net/djnr8o7a/28/|jsFiddle demo}\n       * @example <caption>Normal backgroundImage with left/top = 0</caption>\n       * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n       *   // Needed to position backgroundImage at 0/0\n       *   originX: 'left',\n       *   originY: 'top'\n       * });\n       * @example <caption>backgroundImage with different properties</caption>\n       * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n       *   opacity: 0.5,\n       *   angle: 45,\n       *   left: 400,\n       *   top: 400,\n       *   originX: 'left',\n       *   originY: 'top'\n       * });\n       * @example <caption>Stretched backgroundImage #1 - width/height correspond to canvas width/height</caption>\n       * fabric.Image.fromURL('http://fabricjs.com/assets/honey_im_subtle.png', function(img, isError) {\n       *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n       *    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));\n       * });\n       * @example <caption>Stretched backgroundImage #2 - width/height correspond to canvas width/height</caption>\n       * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n       *   width: canvas.width,\n       *   height: canvas.height,\n       *   // Needed to position backgroundImage at 0/0\n       *   originX: 'left',\n       *   originY: 'top'\n       * });\n       * @example <caption>backgroundImage loaded from cross-origin</caption>\n       * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n       *   opacity: 0.5,\n       *   angle: 45,\n       *   left: 400,\n       *   top: 400,\n       *   originX: 'left',\n       *   originY: 'top',\n       *   crossOrigin: 'anonymous'\n       * });\n       */\n      // TODO: fix stretched examples\n      setBackgroundImage: function (image, callback, options) {\n        return this.__setBgOverlayImage(\n          \"backgroundImage\",\n          image,\n          callback,\n          options\n        );\n      },\n\n      /**\n       * Sets {@link fabric.StaticCanvas#overlayColor|foreground color} for this canvas\n       * @param {(String|fabric.Pattern)} overlayColor Color or pattern to set foreground color to\n       * @param {Function} callback Callback to invoke when foreground color is set\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       * @see {@link http://jsfiddle.net/fabricjs/pB55h/|jsFiddle demo}\n       * @example <caption>Normal overlayColor - color value</caption>\n       * canvas.setOverlayColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n       * @example <caption>fabric.Pattern used as overlayColor</caption>\n       * canvas.setOverlayColor({\n       *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n       * }, canvas.renderAll.bind(canvas));\n       * @example <caption>fabric.Pattern used as overlayColor with repeat and offset</caption>\n       * canvas.setOverlayColor({\n       *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n       *   repeat: 'repeat',\n       *   offsetX: 200,\n       *   offsetY: 100\n       * }, canvas.renderAll.bind(canvas));\n       */\n      setOverlayColor: function (overlayColor, callback) {\n        return this.__setBgOverlayColor(\"overlayColor\", overlayColor, callback);\n      },\n\n      /**\n       * Sets {@link fabric.StaticCanvas#backgroundColor|background color} for this canvas\n       * @param {(String|fabric.Pattern)} backgroundColor Color or pattern to set background color to\n       * @param {Function} callback Callback to invoke when background color is set\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       * @see {@link http://jsfiddle.net/fabricjs/hXzvk/|jsFiddle demo}\n       * @example <caption>Normal backgroundColor - color value</caption>\n       * canvas.setBackgroundColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n       * @example <caption>fabric.Pattern used as backgroundColor</caption>\n       * canvas.setBackgroundColor({\n       *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n       * }, canvas.renderAll.bind(canvas));\n       * @example <caption>fabric.Pattern used as backgroundColor with repeat and offset</caption>\n       * canvas.setBackgroundColor({\n       *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n       *   repeat: 'repeat',\n       *   offsetX: 200,\n       *   offsetY: 100\n       * }, canvas.renderAll.bind(canvas));\n       */\n      setBackgroundColor: function (backgroundColor, callback) {\n        return this.__setBgOverlayColor(\n          \"backgroundColor\",\n          backgroundColor,\n          callback\n        );\n      },\n\n      /**\n       * @private\n       * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundImage|backgroundImage}\n       * or {@link fabric.StaticCanvas#overlayImage|overlayImage})\n       * @param {(fabric.Image|String|null)} image fabric.Image instance, URL of an image or null to set background or overlay to\n       * @param {Function} callback Callback to invoke when image is loaded and set as background or overlay. The first argument is the created image, the second argument is a flag indicating whether an error occured or not.\n       * @param {Object} [options] Optional options to set for the {@link fabric.Image|image}.\n       */\n      __setBgOverlayImage: function (property, image, callback, options) {\n        if (typeof image === \"string\") {\n          fabric.util.loadImage(\n            image,\n            function (img, isError) {\n              if (img) {\n                var instance = new fabric.Image(img, options);\n                this[property] = instance;\n                instance.canvas = this;\n              }\n              callback && callback(img, isError);\n            },\n            this,\n            options && options.crossOrigin\n          );\n        } else {\n          options && image.setOptions(options);\n          this[property] = image;\n          image && (image.canvas = this);\n          callback && callback(image, false);\n        }\n\n        return this;\n      },\n\n      /**\n       * @private\n       * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundColor|backgroundColor}\n       * or {@link fabric.StaticCanvas#overlayColor|overlayColor})\n       * @param {(Object|String|null)} color Object with pattern information, color value or null\n       * @param {Function} [callback] Callback is invoked when color is set\n       */\n      __setBgOverlayColor: function (property, color, callback) {\n        this[property] = color;\n        this._initGradient(color, property);\n        this._initPattern(color, property, callback);\n        return this;\n      },\n\n      /**\n       * @private\n       */\n      _createCanvasElement: function () {\n        var element = createCanvasElement();\n        if (!element) {\n          throw CANVAS_INIT_ERROR;\n        }\n        if (!element.style) {\n          element.style = {};\n        }\n        if (typeof element.getContext === \"undefined\") {\n          throw CANVAS_INIT_ERROR;\n        }\n        return element;\n      },\n\n      /**\n       * @private\n       * @param {Object} [options] Options object\n       */\n      _initOptions: function (options) {\n        var lowerCanvasEl = this.lowerCanvasEl;\n        this._setOptions(options);\n\n        this.width = this.width || parseInt(lowerCanvasEl.width, 10) || 0;\n        this.height = this.height || parseInt(lowerCanvasEl.height, 10) || 0;\n\n        if (!this.lowerCanvasEl.style) {\n          return;\n        }\n\n        lowerCanvasEl.width = this.width;\n        lowerCanvasEl.height = this.height;\n\n        lowerCanvasEl.style.width = this.width + \"px\";\n        lowerCanvasEl.style.height = this.height + \"px\";\n\n        this.viewportTransform = this.viewportTransform.slice();\n      },\n\n      /**\n       * Creates a bottom canvas\n       * @private\n       * @param {HTMLElement} [canvasEl]\n       */\n      _createLowerCanvas: function (canvasEl) {\n        // canvasEl === 'HTMLCanvasElement' does not work on jsdom/node\n        if (canvasEl && canvasEl.getContext) {\n          this.lowerCanvasEl = canvasEl;\n        } else {\n          this.lowerCanvasEl =\n            fabric.util.getById(canvasEl) || this._createCanvasElement();\n        }\n\n        fabric.util.addClass(this.lowerCanvasEl, \"lower-canvas\");\n\n        if (this.interactive) {\n          this._applyCanvasStyle(this.lowerCanvasEl);\n        }\n\n        this.contextContainer = this.lowerCanvasEl.getContext(\"2d\");\n      },\n\n      /**\n       * Returns canvas width (in px)\n       * @return {Number}\n       */\n      getWidth: function () {\n        return this.width;\n      },\n\n      /**\n       * Returns canvas height (in px)\n       * @return {Number}\n       */\n      getHeight: function () {\n        return this.height;\n      },\n\n      /**\n       * Sets width of this canvas instance\n       * @param {Number|String} value                         Value to set width to\n       * @param {Object}        [options]                     Options object\n       * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n       * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */\n      setWidth: function (value, options) {\n        return this.setDimensions({ width: value }, options);\n      },\n\n      /**\n       * Sets height of this canvas instance\n       * @param {Number|String} value                         Value to set height to\n       * @param {Object}        [options]                     Options object\n       * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n       * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */\n      setHeight: function (value, options) {\n        return this.setDimensions({ height: value }, options);\n      },\n\n      /**\n       * Sets dimensions (width, height) of this canvas instance. when options.cssOnly flag active you should also supply the unit of measure (px/%/em)\n       * @param {Object}        dimensions                    Object with width/height properties\n       * @param {Number|String} [dimensions.width]            Width of canvas element\n       * @param {Number|String} [dimensions.height]           Height of canvas element\n       * @param {Object}        [options]                     Options object\n       * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n       * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      setDimensions: function (dimensions, options) {\n        var cssValue;\n\n        options = options || {};\n\n        for (var prop in dimensions) {\n          cssValue = dimensions[prop];\n\n          if (!options.cssOnly) {\n            this._setBackstoreDimension(prop, dimensions[prop]);\n            cssValue += \"px\";\n            this.hasLostContext = true;\n          }\n\n          if (!options.backstoreOnly) {\n            this._setCssDimension(prop, cssValue);\n          }\n        }\n        if (this._isCurrentlyDrawing) {\n          this.freeDrawingBrush && this.freeDrawingBrush._setBrushStyles();\n        }\n        this._initRetinaScaling();\n        this.calcOffset();\n\n        if (!options.cssOnly) {\n          this.requestRenderAll();\n        }\n\n        return this;\n      },\n\n      /**\n       * Helper for setting width/height\n       * @private\n       * @param {String} prop property (width|height)\n       * @param {Number} value value to set property to\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */\n      _setBackstoreDimension: function (prop, value) {\n        this.lowerCanvasEl[prop] = value;\n\n        if (this.upperCanvasEl) {\n          this.upperCanvasEl[prop] = value;\n        }\n\n        if (this.cacheCanvasEl) {\n          this.cacheCanvasEl[prop] = value;\n        }\n\n        this[prop] = value;\n\n        return this;\n      },\n\n      /**\n       * Helper for setting css width/height\n       * @private\n       * @param {String} prop property (width|height)\n       * @param {String} value value to set property to\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */\n      _setCssDimension: function (prop, value) {\n        this.lowerCanvasEl.style[prop] = value;\n\n        if (this.upperCanvasEl) {\n          this.upperCanvasEl.style[prop] = value;\n        }\n\n        if (this.wrapperEl) {\n          this.wrapperEl.style[prop] = value;\n        }\n\n        return this;\n      },\n\n      /**\n       * Returns canvas zoom level\n       * @return {Number}\n       */\n      getZoom: function () {\n        return this.viewportTransform[0];\n      },\n\n      /**\n       * Sets viewport transform of this canvas instance\n       * @param {Array} vpt the transform in the form of context.transform\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */\n      setViewportTransform: function (vpt) {\n        var activeObject = this._activeObject,\n          object,\n          i,\n          len;\n        this.viewportTransform = vpt;\n        for (i = 0, len = this._objects.length; i < len; i++) {\n          object = this._objects[i];\n          object.group || object.setCoords(true);\n        }\n        if (activeObject) {\n          activeObject.setCoords();\n        }\n        this.calcViewportBoundaries();\n        this.renderOnAddRemove && this.requestRenderAll();\n        return this;\n      },\n\n      /**\n       * Sets zoom level of this canvas instance, zoom centered around point\n       * @param {fabric.Point} point to zoom with respect to\n       * @param {Number} value to set zoom to, less than 1 zooms out\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */\n      zoomToPoint: function (point, value) {\n        // TODO: just change the scale, preserve other transformations\n        var before = point,\n          vpt = this.viewportTransform.slice(0);\n        point = transformPoint(point, invertTransform(this.viewportTransform));\n        vpt[0] = value;\n        vpt[3] = value;\n        var after = transformPoint(point, vpt);\n        vpt[4] += before.x - after.x;\n        vpt[5] += before.y - after.y;\n        return this.setViewportTransform(vpt);\n      },\n\n      /**\n       * Sets zoom level of this canvas instance\n       * @param {Number} value to set zoom to, less than 1 zooms out\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */\n      setZoom: function (value) {\n        this.zoomToPoint(new fabric.Point(0, 0), value);\n        return this;\n      },\n\n      /**\n       * Pan viewport so as to place point at top left corner of canvas\n       * @param {fabric.Point} point to move to\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */\n      absolutePan: function (point) {\n        var vpt = this.viewportTransform.slice(0);\n        vpt[4] = -point.x;\n        vpt[5] = -point.y;\n        return this.setViewportTransform(vpt);\n      },\n\n      /**\n       * Pans viewpoint relatively\n       * @param {fabric.Point} point (position vector) to move by\n       * @return {fabric.Canvas} instance\n       * @chainable true\n       */\n      relativePan: function (point) {\n        return this.absolutePan(\n          new fabric.Point(\n            -point.x - this.viewportTransform[4],\n            -point.y - this.viewportTransform[5]\n          )\n        );\n      },\n\n      /**\n       * Returns &lt;canvas> element corresponding to this instance\n       * @return {HTMLCanvasElement}\n       */\n      getElement: function () {\n        return this.lowerCanvasEl;\n      },\n\n      /**\n       * @private\n       * @param {fabric.Object} obj Object that was added\n       */\n      _onObjectAdded: function (obj) {\n        this.stateful && obj.setupState();\n        obj._set(\"canvas\", this);\n        obj.setCoords();\n        this.fire(\"object:added\", { target: obj });\n        obj.fire(\"added\");\n      },\n\n      /**\n       * @private\n       * @param {fabric.Object} obj Object that was removed\n       */\n      _onObjectRemoved: function (obj) {\n        this.fire(\"object:removed\", { target: obj });\n        obj.fire(\"removed\");\n        delete obj.canvas;\n      },\n\n      /**\n       * Clears specified context of canvas element\n       * @param {CanvasRenderingContext2D} ctx Context to clear\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      clearContext: function (ctx) {\n        ctx.clearRect(0, 0, this.width, this.height);\n        return this;\n      },\n\n      /**\n       * Returns context of canvas where objects are drawn\n       * @return {CanvasRenderingContext2D}\n       */\n      getContext: function () {\n        return this.contextContainer;\n      },\n\n      /**\n       * Clears all contexts (background, main, top) of an instance\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      clear: function () {\n        this._objects.length = 0;\n        this.backgroundImage = null;\n        this.overlayImage = null;\n        this.backgroundColor = \"\";\n        this.overlayColor = \"\";\n        if (this._hasITextHandlers) {\n          this.off(\"mouse:up\", this._mouseUpITextHandler);\n          this._iTextInstances = null;\n          this._hasITextHandlers = false;\n        }\n        this.clearContext(this.contextContainer);\n        this.fire(\"canvas:cleared\");\n        this.renderOnAddRemove && this.requestRenderAll();\n        return this;\n      },\n\n      /**\n       * Renders the canvas\n       * @return {fabric.Canvas} instance\n       * @chainable\n       */\n      renderAll: function () {\n        var canvasToDrawOn = this.contextContainer;\n        this.renderCanvas(canvasToDrawOn, this._objects);\n        return this;\n      },\n\n      /**\n       * Function created to be instance bound at initialization\n       * used in requestAnimationFrame rendering\n       * Let the fabricJS call it. If you call it manually you could have more\n       * animationFrame stacking on to of each other\n       * for an imperative rendering, use canvas.renderAll\n       * @private\n       * @return {fabric.Canvas} instance\n       * @chainable\n       */\n      renderAndReset: function () {\n        this.isRendering = 0;\n        this.renderAll();\n      },\n\n      /**\n       * Append a renderAll request to next animation frame.\n       * unless one is already in progress, in that case nothing is done\n       * a boolean flag will avoid appending more.\n       * @return {fabric.Canvas} instance\n       * @chainable\n       */\n      requestRenderAll: function () {\n        if (!this.isRendering) {\n          this.isRendering = fabric.util.requestAnimFrame(\n            this.renderAndResetBound\n          );\n        }\n        return this;\n      },\n\n      /**\n       * Calculate the position of the 4 corner of canvas with current viewportTransform.\n       * helps to determinate when an object is in the current rendering viewport using\n       * object absolute coordinates ( aCoords )\n       * @return {Object} points.tl\n       * @chainable\n       */\n      calcViewportBoundaries: function () {\n        var points = {},\n          width = this.width,\n          height = this.height,\n          iVpt = invertTransform(this.viewportTransform);\n        points.tl = transformPoint({ x: 0, y: 0 }, iVpt);\n        points.br = transformPoint({ x: width, y: height }, iVpt);\n        points.tr = new fabric.Point(points.br.x, points.tl.y);\n        points.bl = new fabric.Point(points.tl.x, points.br.y);\n        this.vptCoords = points;\n        return points;\n      },\n\n      cancelRequestedRender: function () {\n        if (this.isRendering) {\n          fabric.util.cancelAnimFrame(this.isRendering);\n          this.isRendering = 0;\n        }\n      },\n\n      /**\n       * Renders background, objects, overlay and controls.\n       * @param {CanvasRenderingContext2D} ctx\n       * @param {Array} objects to render\n       * @return {fabric.Canvas} instance\n       * @chainable\n       */\n      renderCanvas: function (ctx, objects) {\n        var v = this.viewportTransform,\n          path = this.clipPath;\n        this.cancelRequestedRender();\n        this.calcViewportBoundaries();\n        this.clearContext(ctx);\n        fabric.util.setImageSmoothing(ctx, this.imageSmoothingEnabled);\n        this.fire(\"before:render\", { ctx: ctx });\n        this._renderBackground(ctx);\n\n        ctx.save();\n        //apply viewport transform once for all rendering process\n        ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        this._renderObjects(ctx, objects);\n        ctx.restore();\n        if (!this.controlsAboveOverlay && this.interactive) {\n          this.drawControls(ctx);\n        }\n        if (path) {\n          path.canvas = this;\n          // needed to setup a couple of variables\n          path.shouldCache();\n          path._transformDone = true;\n          path.renderCache({ forClipping: true });\n          this.drawClipPathOnCanvas(ctx);\n        }\n        this._renderOverlay(ctx);\n        if (this.controlsAboveOverlay && this.interactive) {\n          this.drawControls(ctx);\n        }\n        this.fire(\"after:render\", { ctx: ctx });\n      },\n\n      /**\n       * Paint the cached clipPath on the lowerCanvasEl\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      drawClipPathOnCanvas: function (ctx) {\n        var v = this.viewportTransform,\n          path = this.clipPath;\n        ctx.save();\n        ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        // DEBUG: uncomment this line, comment the following\n        // ctx.globalAlpha = 0.4;\n        ctx.globalCompositeOperation = \"destination-in\";\n        path.transform(ctx);\n        ctx.scale(1 / path.zoomX, 1 / path.zoomY);\n        ctx.drawImage(\n          path._cacheCanvas,\n          -path.cacheTranslationX,\n          -path.cacheTranslationY\n        );\n        ctx.restore();\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {Array} objects to render\n       */\n      _renderObjects: function (ctx, objects) {\n        var i, len;\n        for (i = 0, len = objects.length; i < len; ++i) {\n          objects[i] && objects[i].render(ctx);\n        }\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {string} property 'background' or 'overlay'\n       */\n      _renderBackgroundOrOverlay: function (ctx, property) {\n        var fill = this[property + \"Color\"],\n          object = this[property + \"Image\"],\n          v = this.viewportTransform,\n          needsVpt = this[property + \"Vpt\"];\n        if (!fill && !object) {\n          return;\n        }\n        if (fill) {\n          ctx.save();\n          ctx.beginPath();\n          ctx.moveTo(0, 0);\n          ctx.lineTo(this.width, 0);\n          ctx.lineTo(this.width, this.height);\n          ctx.lineTo(0, this.height);\n          ctx.closePath();\n          ctx.fillStyle = fill.toLive ? fill.toLive(ctx, this) : fill;\n          if (needsVpt) {\n            ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n          }\n          ctx.transform(1, 0, 0, 1, fill.offsetX || 0, fill.offsetY || 0);\n          var m = fill.gradientTransform || fill.patternTransform;\n          m && ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n          ctx.fill();\n          ctx.restore();\n        }\n        if (object) {\n          ctx.save();\n          if (needsVpt) {\n            ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n          }\n          object.render(ctx);\n          ctx.restore();\n        }\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderBackground: function (ctx) {\n        this._renderBackgroundOrOverlay(ctx, \"background\");\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderOverlay: function (ctx) {\n        this._renderBackgroundOrOverlay(ctx, \"overlay\");\n      },\n\n      /**\n       * Returns coordinates of a center of canvas.\n       * Returned value is an object with top and left properties\n       * @return {Object} object with \"top\" and \"left\" number values\n       */\n      getCenter: function () {\n        return {\n          top: this.height / 2,\n          left: this.width / 2,\n        };\n      },\n\n      /**\n       * Centers object horizontally in the canvas\n       * @param {fabric.Object} object Object to center horizontally\n       * @return {fabric.Canvas} thisArg\n       */\n      centerObjectH: function (object) {\n        return this._centerObject(\n          object,\n          new fabric.Point(this.getCenter().left, object.getCenterPoint().y)\n        );\n      },\n\n      /**\n       * Centers object vertically in the canvas\n       * @param {fabric.Object} object Object to center vertically\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      centerObjectV: function (object) {\n        return this._centerObject(\n          object,\n          new fabric.Point(object.getCenterPoint().x, this.getCenter().top)\n        );\n      },\n\n      /**\n       * Centers object vertically and horizontally in the canvas\n       * @param {fabric.Object} object Object to center vertically and horizontally\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      centerObject: function (object) {\n        var center = this.getCenter();\n\n        return this._centerObject(\n          object,\n          new fabric.Point(center.left, center.top)\n        );\n      },\n\n      /**\n       * Centers object vertically and horizontally in the viewport\n       * @param {fabric.Object} object Object to center vertically and horizontally\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      viewportCenterObject: function (object) {\n        var vpCenter = this.getVpCenter();\n\n        return this._centerObject(object, vpCenter);\n      },\n\n      /**\n       * Centers object horizontally in the viewport, object.top is unchanged\n       * @param {fabric.Object} object Object to center vertically and horizontally\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      viewportCenterObjectH: function (object) {\n        var vpCenter = this.getVpCenter();\n        this._centerObject(\n          object,\n          new fabric.Point(vpCenter.x, object.getCenterPoint().y)\n        );\n        return this;\n      },\n\n      /**\n       * Centers object Vertically in the viewport, object.top is unchanged\n       * @param {fabric.Object} object Object to center vertically and horizontally\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      viewportCenterObjectV: function (object) {\n        var vpCenter = this.getVpCenter();\n\n        return this._centerObject(\n          object,\n          new fabric.Point(object.getCenterPoint().x, vpCenter.y)\n        );\n      },\n\n      /**\n       * Calculate the point in canvas that correspond to the center of actual viewport.\n       * @return {fabric.Point} vpCenter, viewport center\n       * @chainable\n       */\n      getVpCenter: function () {\n        var center = this.getCenter(),\n          iVpt = invertTransform(this.viewportTransform);\n        return transformPoint({ x: center.left, y: center.top }, iVpt);\n      },\n\n      /**\n       * @private\n       * @param {fabric.Object} object Object to center\n       * @param {fabric.Point} center Center point\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      _centerObject: function (object, center) {\n        object.setPositionByOrigin(center, \"center\", \"center\");\n        object.setCoords();\n        this.renderOnAddRemove && this.requestRenderAll();\n        return this;\n      },\n\n      /**\n       * Returs dataless JSON representation of canvas\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {String} json string\n       */\n      toDatalessJSON: function (propertiesToInclude) {\n        return this.toDatalessObject(propertiesToInclude);\n      },\n\n      /**\n       * Returns object representation of canvas\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */\n      toObject: function (propertiesToInclude) {\n        return this._toObjectMethod(\"toObject\", propertiesToInclude);\n      },\n\n      /**\n       * Returns dataless object representation of canvas\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */\n      toDatalessObject: function (propertiesToInclude) {\n        return this._toObjectMethod(\"toDatalessObject\", propertiesToInclude);\n      },\n\n      /**\n       * @private\n       */\n      _toObjectMethod: function (methodName, propertiesToInclude) {\n        var clipPath = this.clipPath,\n          data = {\n            version: fabric.version,\n            objects: this._toObjects(methodName, propertiesToInclude),\n          };\n        if (clipPath) {\n          data.clipPath = this._toObject(\n            this.clipPath,\n            methodName,\n            propertiesToInclude\n          );\n        }\n        extend(\n          data,\n          this.__serializeBgOverlay(methodName, propertiesToInclude)\n        );\n\n        fabric.util.populateWithProperties(this, data, propertiesToInclude);\n\n        return data;\n      },\n\n      /**\n       * @private\n       */\n      _toObjects: function (methodName, propertiesToInclude) {\n        return this._objects\n          .filter(function (object) {\n            return !object.excludeFromExport;\n          })\n          .map(function (instance) {\n            return this._toObject(instance, methodName, propertiesToInclude);\n          }, this);\n      },\n\n      /**\n       * @private\n       */\n      _toObject: function (instance, methodName, propertiesToInclude) {\n        var originalValue;\n\n        if (!this.includeDefaultValues) {\n          originalValue = instance.includeDefaultValues;\n          instance.includeDefaultValues = false;\n        }\n\n        var object = instance[methodName](propertiesToInclude);\n        if (!this.includeDefaultValues) {\n          instance.includeDefaultValues = originalValue;\n        }\n        return object;\n      },\n\n      /**\n       * @private\n       */\n      __serializeBgOverlay: function (methodName, propertiesToInclude) {\n        var data = {},\n          bgImage = this.backgroundImage,\n          overlay = this.overlayImage;\n\n        if (this.backgroundColor) {\n          data.background = this.backgroundColor.toObject\n            ? this.backgroundColor.toObject(propertiesToInclude)\n            : this.backgroundColor;\n        }\n\n        if (this.overlayColor) {\n          data.overlay = this.overlayColor.toObject\n            ? this.overlayColor.toObject(propertiesToInclude)\n            : this.overlayColor;\n        }\n        if (bgImage && !bgImage.excludeFromExport) {\n          data.backgroundImage = this._toObject(\n            bgImage,\n            methodName,\n            propertiesToInclude\n          );\n        }\n        if (overlay && !overlay.excludeFromExport) {\n          data.overlayImage = this._toObject(\n            overlay,\n            methodName,\n            propertiesToInclude\n          );\n        }\n\n        return data;\n      },\n\n      /* _TO_SVG_START_ */\n      /**\n       * When true, getSvgTransform() will apply the StaticCanvas.viewportTransform to the SVG transformation. When true,\n       * a zoomed canvas will then produce zoomed SVG output.\n       * @type Boolean\n       * @default\n       */\n      svgViewportTransformation: true,\n\n      /**\n       * Returns SVG representation of canvas\n       * @function\n       * @param {Object} [options] Options object for SVG output\n       * @param {Boolean} [options.suppressPreamble=false] If true xml tag is not included\n       * @param {Object} [options.viewBox] SVG viewbox object\n       * @param {Number} [options.viewBox.x] x-cooridnate of viewbox\n       * @param {Number} [options.viewBox.y] y-coordinate of viewbox\n       * @param {Number} [options.viewBox.width] Width of viewbox\n       * @param {Number} [options.viewBox.height] Height of viewbox\n       * @param {String} [options.encoding=UTF-8] Encoding of SVG output\n       * @param {String} [options.width] desired width of svg with or without units\n       * @param {String} [options.height] desired height of svg with or without units\n       * @param {Function} [reviver] Method for further parsing of svg elements, called after each fabric object converted into svg representation.\n       * @return {String} SVG string\n       * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n       * @see {@link http://jsfiddle.net/fabricjs/jQ3ZZ/|jsFiddle demo}\n       * @example <caption>Normal SVG output</caption>\n       * var svg = canvas.toSVG();\n       * @example <caption>SVG output without preamble (without &lt;?xml ../>)</caption>\n       * var svg = canvas.toSVG({suppressPreamble: true});\n       * @example <caption>SVG output with viewBox attribute</caption>\n       * var svg = canvas.toSVG({\n       *   viewBox: {\n       *     x: 100,\n       *     y: 100,\n       *     width: 200,\n       *     height: 300\n       *   }\n       * });\n       * @example <caption>SVG output with different encoding (default: UTF-8)</caption>\n       * var svg = canvas.toSVG({encoding: 'ISO-8859-1'});\n       * @example <caption>Modify SVG output with reviver function</caption>\n       * var svg = canvas.toSVG(null, function(svg) {\n       *   return svg.replace('stroke-dasharray: ; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; ', '');\n       * });\n       */\n      toSVG: function (options, reviver) {\n        options || (options = {});\n        options.reviver = reviver;\n        var markup = [];\n\n        this._setSVGPreamble(markup, options);\n        this._setSVGHeader(markup, options);\n        if (this.clipPath) {\n          markup.push(\n            '<g clip-path=\"url(#' + this.clipPath.clipPathId + ')\" >\\n'\n          );\n        }\n        this._setSVGBgOverlayColor(markup, \"background\");\n        this._setSVGBgOverlayImage(markup, \"backgroundImage\", reviver);\n        this._setSVGObjects(markup, reviver);\n        if (this.clipPath) {\n          markup.push(\"</g>\\n\");\n        }\n        this._setSVGBgOverlayColor(markup, \"overlay\");\n        this._setSVGBgOverlayImage(markup, \"overlayImage\", reviver);\n\n        markup.push(\"</svg>\");\n\n        return markup.join(\"\");\n      },\n\n      /**\n       * @private\n       */\n      _setSVGPreamble: function (markup, options) {\n        if (options.suppressPreamble) {\n          return;\n        }\n        markup.push(\n          '<?xml version=\"1.0\" encoding=\"',\n          options.encoding || \"UTF-8\",\n          '\" standalone=\"no\" ?>\\n',\n          '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" ',\n          '\"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n'\n        );\n      },\n\n      /**\n       * @private\n       */\n      _setSVGHeader: function (markup, options) {\n        var width = options.width || this.width,\n          height = options.height || this.height,\n          vpt,\n          viewBox = 'viewBox=\"0 0 ' + this.width + \" \" + this.height + '\" ',\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n        if (options.viewBox) {\n          viewBox =\n            'viewBox=\"' +\n            options.viewBox.x +\n            \" \" +\n            options.viewBox.y +\n            \" \" +\n            options.viewBox.width +\n            \" \" +\n            options.viewBox.height +\n            '\" ';\n        } else {\n          if (this.svgViewportTransformation) {\n            vpt = this.viewportTransform;\n            viewBox =\n              'viewBox=\"' +\n              toFixed(-vpt[4] / vpt[0], NUM_FRACTION_DIGITS) +\n              \" \" +\n              toFixed(-vpt[5] / vpt[3], NUM_FRACTION_DIGITS) +\n              \" \" +\n              toFixed(this.width / vpt[0], NUM_FRACTION_DIGITS) +\n              \" \" +\n              toFixed(this.height / vpt[3], NUM_FRACTION_DIGITS) +\n              '\" ';\n          }\n        }\n\n        markup.push(\n          \"<svg \",\n          'xmlns=\"http://www.w3.org/2000/svg\" ',\n          'xmlns:xlink=\"http://www.w3.org/1999/xlink\" ',\n          'version=\"1.1\" ',\n          'width=\"',\n          width,\n          '\" ',\n          'height=\"',\n          height,\n          '\" ',\n          viewBox,\n          'xml:space=\"preserve\">\\n',\n          \"<desc>Created with Fabric.js \",\n          fabric.version,\n          \"</desc>\\n\",\n          \"<defs>\\n\",\n          this.createSVGFontFacesMarkup(),\n          this.createSVGRefElementsMarkup(),\n          this.createSVGClipPathMarkup(options),\n          \"</defs>\\n\"\n        );\n      },\n\n      createSVGClipPathMarkup: function (options) {\n        var clipPath = this.clipPath;\n        if (clipPath) {\n          clipPath.clipPathId = \"CLIPPATH_\" + fabric.Object.__uid++;\n          return (\n            '<clipPath id=\"' +\n            clipPath.clipPathId +\n            '\" >\\n' +\n            this.clipPath.toClipPathSVG(options.reviver) +\n            \"</clipPath>\\n\"\n          );\n        }\n        return \"\";\n      },\n\n      /**\n       * Creates markup containing SVG referenced elements like patterns, gradients etc.\n       * @return {String}\n       */\n      createSVGRefElementsMarkup: function () {\n        var _this = this,\n          markup = [\"background\", \"overlay\"].map(function (prop) {\n            var fill = _this[prop + \"Color\"];\n            if (fill && fill.toLive) {\n              var shouldTransform = _this[prop + \"Vpt\"],\n                vpt = _this.viewportTransform,\n                object = {\n                  width: _this.width / (shouldTransform ? vpt[0] : 1),\n                  height: _this.height / (shouldTransform ? vpt[3] : 1),\n                };\n              return fill.toSVG(object, {\n                additionalTransform: shouldTransform\n                  ? fabric.util.matrixToSVG(vpt)\n                  : \"\",\n              });\n            }\n          });\n        return markup.join(\"\");\n      },\n\n      /**\n       * Creates markup containing SVG font faces,\n       * font URLs for font faces must be collected by developers\n       * and are not extracted from the DOM by fabricjs\n       * @param {Array} objects Array of fabric objects\n       * @return {String}\n       */\n      createSVGFontFacesMarkup: function () {\n        var markup = \"\",\n          fontList = {},\n          obj,\n          fontFamily,\n          style,\n          row,\n          rowIndex,\n          _char,\n          charIndex,\n          i,\n          len,\n          fontPaths = fabric.fontPaths,\n          objects = [];\n\n        this._objects.forEach(function add(object) {\n          objects.push(object);\n          if (object._objects) {\n            object._objects.forEach(add);\n          }\n        });\n\n        for (i = 0, len = objects.length; i < len; i++) {\n          obj = objects[i];\n          fontFamily = obj.fontFamily;\n          if (\n            obj.type.indexOf(\"text\") === -1 ||\n            fontList[fontFamily] ||\n            !fontPaths[fontFamily]\n          ) {\n            continue;\n          }\n          fontList[fontFamily] = true;\n          if (!obj.styles) {\n            continue;\n          }\n          style = obj.styles;\n          for (rowIndex in style) {\n            row = style[rowIndex];\n            for (charIndex in row) {\n              _char = row[charIndex];\n              fontFamily = _char.fontFamily;\n              if (!fontList[fontFamily] && fontPaths[fontFamily]) {\n                fontList[fontFamily] = true;\n              }\n            }\n          }\n        }\n\n        for (var j in fontList) {\n          markup += [\n            \"\\t\\t@font-face {\\n\",\n            \"\\t\\t\\tfont-family: '\",\n            j,\n            \"';\\n\",\n            \"\\t\\t\\tsrc: url('\",\n            fontPaths[j],\n            \"');\\n\",\n            \"\\t\\t}\\n\",\n          ].join(\"\");\n        }\n\n        if (markup) {\n          markup = [\n            '\\t<style type=\"text/css\">',\n            \"<![CDATA[\\n\",\n            markup,\n            \"]]>\",\n            \"</style>\\n\",\n          ].join(\"\");\n        }\n\n        return markup;\n      },\n\n      /**\n       * @private\n       */\n      _setSVGObjects: function (markup, reviver) {\n        var instance,\n          i,\n          len,\n          objects = this._objects;\n        for (i = 0, len = objects.length; i < len; i++) {\n          instance = objects[i];\n          if (instance.excludeFromExport) {\n            continue;\n          }\n          this._setSVGObject(markup, instance, reviver);\n        }\n      },\n\n      /**\n       * @private\n       */\n      _setSVGObject: function (markup, instance, reviver) {\n        markup.push(instance.toSVG(reviver));\n      },\n\n      /**\n       * @private\n       */\n      _setSVGBgOverlayImage: function (markup, property, reviver) {\n        if (\n          this[property] &&\n          !this[property].excludeFromExport &&\n          this[property].toSVG\n        ) {\n          markup.push(this[property].toSVG(reviver));\n        }\n      },\n\n      /**\n       * @private\n       */\n      _setSVGBgOverlayColor: function (markup, property) {\n        var filler = this[property + \"Color\"],\n          vpt = this.viewportTransform,\n          finalWidth = this.width,\n          finalHeight = this.height;\n        if (!filler) {\n          return;\n        }\n        if (filler.toLive) {\n          var repeat = filler.repeat,\n            iVpt = fabric.util.invertTransform(vpt),\n            shouldInvert = this[property + \"Vpt\"],\n            additionalTransform = shouldInvert\n              ? fabric.util.matrixToSVG(iVpt)\n              : \"\";\n          markup.push(\n            '<rect transform=\"' + additionalTransform + \" translate(\",\n            finalWidth / 2,\n            \",\",\n            finalHeight / 2,\n            ')\"',\n            ' x=\"',\n            filler.offsetX - finalWidth / 2,\n            '\" y=\"',\n            filler.offsetY - finalHeight / 2,\n            '\" ',\n            'width=\"',\n            repeat === \"repeat-y\" || repeat === \"no-repeat\"\n              ? filler.source.width\n              : finalWidth,\n            '\" height=\"',\n            repeat === \"repeat-x\" || repeat === \"no-repeat\"\n              ? filler.source.height\n              : finalHeight,\n            '\" fill=\"url(#SVGID_' + filler.id + ')\"',\n            \"></rect>\\n\"\n          );\n        } else {\n          markup.push(\n            '<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" ',\n            'fill=\"',\n            filler,\n            '\"',\n            \"></rect>\\n\"\n          );\n        }\n      },\n      /* _TO_SVG_END_ */\n\n      /**\n       * Moves an object or the objects of a multiple selection\n       * to the bottom of the stack of drawn objects\n       * @param {fabric.Object} object Object to send to back\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      sendToBack: function (object) {\n        if (!object) {\n          return this;\n        }\n        var activeSelection = this._activeObject,\n          i,\n          obj,\n          objs;\n        if (object === activeSelection && object.type === \"activeSelection\") {\n          objs = activeSelection._objects;\n          for (i = objs.length; i--; ) {\n            obj = objs[i];\n            removeFromArray(this._objects, obj);\n            this._objects.unshift(obj);\n          }\n        } else {\n          removeFromArray(this._objects, object);\n          this._objects.unshift(object);\n        }\n        this.renderOnAddRemove && this.requestRenderAll();\n        return this;\n      },\n\n      /**\n       * Moves an object or the objects of a multiple selection\n       * to the top of the stack of drawn objects\n       * @param {fabric.Object} object Object to send\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      bringToFront: function (object) {\n        if (!object) {\n          return this;\n        }\n        var activeSelection = this._activeObject,\n          i,\n          obj,\n          objs;\n        if (object === activeSelection && object.type === \"activeSelection\") {\n          objs = activeSelection._objects;\n          for (i = 0; i < objs.length; i++) {\n            obj = objs[i];\n            removeFromArray(this._objects, obj);\n            this._objects.push(obj);\n          }\n        } else {\n          removeFromArray(this._objects, object);\n          this._objects.push(object);\n        }\n        this.renderOnAddRemove && this.requestRenderAll();\n        return this;\n      },\n\n      /**\n       * Moves an object or a selection down in stack of drawn objects\n       * An optional paramter, intersecting allowes to move the object in behind\n       * the first intersecting object. Where intersection is calculated with\n       * bounding box. If no intersection is found, there will not be change in the\n       * stack.\n       * @param {fabric.Object} object Object to send\n       * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      sendBackwards: function (object, intersecting) {\n        if (!object) {\n          return this;\n        }\n        var activeSelection = this._activeObject,\n          i,\n          obj,\n          idx,\n          newIdx,\n          objs,\n          objsMoved = 0;\n\n        if (object === activeSelection && object.type === \"activeSelection\") {\n          objs = activeSelection._objects;\n          for (i = 0; i < objs.length; i++) {\n            obj = objs[i];\n            idx = this._objects.indexOf(obj);\n            if (idx > 0 + objsMoved) {\n              newIdx = idx - 1;\n              removeFromArray(this._objects, obj);\n              this._objects.splice(newIdx, 0, obj);\n            }\n            objsMoved++;\n          }\n        } else {\n          idx = this._objects.indexOf(object);\n          if (idx !== 0) {\n            // if object is not on the bottom of stack\n            newIdx = this._findNewLowerIndex(object, idx, intersecting);\n            removeFromArray(this._objects, object);\n            this._objects.splice(newIdx, 0, object);\n          }\n        }\n        this.renderOnAddRemove && this.requestRenderAll();\n        return this;\n      },\n\n      /**\n       * @private\n       */\n      _findNewLowerIndex: function (object, idx, intersecting) {\n        var newIdx, i;\n\n        if (intersecting) {\n          newIdx = idx;\n\n          // traverse down the stack looking for the nearest intersecting object\n          for (i = idx - 1; i >= 0; --i) {\n            var isIntersecting =\n              object.intersectsWithObject(this._objects[i]) ||\n              object.isContainedWithinObject(this._objects[i]) ||\n              this._objects[i].isContainedWithinObject(object);\n\n            if (isIntersecting) {\n              newIdx = i;\n              break;\n            }\n          }\n        } else {\n          newIdx = idx - 1;\n        }\n\n        return newIdx;\n      },\n\n      /**\n       * Moves an object or a selection up in stack of drawn objects\n       * An optional paramter, intersecting allowes to move the object in front\n       * of the first intersecting object. Where intersection is calculated with\n       * bounding box. If no intersection is found, there will not be change in the\n       * stack.\n       * @param {fabric.Object} object Object to send\n       * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      bringForward: function (object, intersecting) {\n        if (!object) {\n          return this;\n        }\n        var activeSelection = this._activeObject,\n          i,\n          obj,\n          idx,\n          newIdx,\n          objs,\n          objsMoved = 0;\n\n        if (object === activeSelection && object.type === \"activeSelection\") {\n          objs = activeSelection._objects;\n          for (i = objs.length; i--; ) {\n            obj = objs[i];\n            idx = this._objects.indexOf(obj);\n            if (idx < this._objects.length - 1 - objsMoved) {\n              newIdx = idx + 1;\n              removeFromArray(this._objects, obj);\n              this._objects.splice(newIdx, 0, obj);\n            }\n            objsMoved++;\n          }\n        } else {\n          idx = this._objects.indexOf(object);\n          if (idx !== this._objects.length - 1) {\n            // if object is not on top of stack (last item in an array)\n            newIdx = this._findNewUpperIndex(object, idx, intersecting);\n            removeFromArray(this._objects, object);\n            this._objects.splice(newIdx, 0, object);\n          }\n        }\n        this.renderOnAddRemove && this.requestRenderAll();\n        return this;\n      },\n\n      /**\n       * @private\n       */\n      _findNewUpperIndex: function (object, idx, intersecting) {\n        var newIdx, i, len;\n\n        if (intersecting) {\n          newIdx = idx;\n\n          // traverse up the stack looking for the nearest intersecting object\n          for (i = idx + 1, len = this._objects.length; i < len; ++i) {\n            var isIntersecting =\n              object.intersectsWithObject(this._objects[i]) ||\n              object.isContainedWithinObject(this._objects[i]) ||\n              this._objects[i].isContainedWithinObject(object);\n\n            if (isIntersecting) {\n              newIdx = i;\n              break;\n            }\n          }\n        } else {\n          newIdx = idx + 1;\n        }\n\n        return newIdx;\n      },\n\n      /**\n       * Moves an object to specified level in stack of drawn objects\n       * @param {fabric.Object} object Object to send\n       * @param {Number} index Position to move to\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      moveTo: function (object, index) {\n        removeFromArray(this._objects, object);\n        this._objects.splice(index, 0, object);\n        return this.renderOnAddRemove && this.requestRenderAll();\n      },\n\n      /**\n       * Clears a canvas element and dispose objects\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      dispose: function () {\n        // cancel eventually ongoing renders\n        if (this.isRendering) {\n          fabric.util.cancelAnimFrame(this.isRendering);\n          this.isRendering = 0;\n        }\n        this.forEachObject(function (object) {\n          object.dispose && object.dispose();\n        });\n        this._objects = [];\n        if (this.backgroundImage && this.backgroundImage.dispose) {\n          this.backgroundImage.dispose();\n        }\n        this.backgroundImage = null;\n        if (this.overlayImage && this.overlayImage.dispose) {\n          this.overlayImage.dispose();\n        }\n        this.overlayImage = null;\n        this._iTextInstances = null;\n        this.contextContainer = null;\n        fabric.util.cleanUpJsdomNode(this.lowerCanvasEl);\n        this.lowerCanvasEl = undefined;\n        return this;\n      },\n\n      /**\n       * Returns a string representation of an instance\n       * @return {String} string representation of an instance\n       */\n      toString: function () {\n        return (\n          \"#<fabric.Canvas (\" +\n          this.complexity() +\n          \"): \" +\n          \"{ objects: \" +\n          this._objects.length +\n          \" }>\"\n        );\n      },\n    }\n  );\n\n  extend(fabric.StaticCanvas.prototype, fabric.Observable);\n  extend(fabric.StaticCanvas.prototype, fabric.Collection);\n  extend(fabric.StaticCanvas.prototype, fabric.DataURLExporter);\n\n  extend(\n    fabric.StaticCanvas,\n    /** @lends fabric.StaticCanvas */ {\n      /**\n       * @static\n       * @type String\n       * @default\n       */\n      EMPTY_JSON: '{\"objects\": [], \"background\": \"white\"}',\n\n      /**\n       * Provides a way to check support of some of the canvas methods\n       * (either those of HTMLCanvasElement itself, or rendering context)\n       *\n       * @param {String} methodName Method to check support for;\n       *                            Could be one of \"setLineDash\"\n       * @return {Boolean | null} `true` if method is supported (or at least exists),\n       *                          `null` if canvas element or context can not be initialized\n       */\n      supports: function (methodName) {\n        var el = createCanvasElement();\n\n        if (!el || !el.getContext) {\n          return null;\n        }\n\n        var ctx = el.getContext(\"2d\");\n        if (!ctx) {\n          return null;\n        }\n\n        switch (methodName) {\n          case \"setLineDash\":\n            return typeof ctx.setLineDash !== \"undefined\";\n\n          default:\n            return null;\n        }\n      },\n    }\n  );\n\n  /**\n   * Returns JSON representation of canvas\n   * @function\n   * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n   * @return {String} JSON string\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n   * @see {@link http://jsfiddle.net/fabricjs/pec86/|jsFiddle demo}\n   * @example <caption>JSON without additional properties</caption>\n   * var json = canvas.toJSON();\n   * @example <caption>JSON with additional properties included</caption>\n   * var json = canvas.toJSON(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY']);\n   * @example <caption>JSON without default values</caption>\n   * canvas.includeDefaultValues = false;\n   * var json = canvas.toJSON();\n   */\n  fabric.StaticCanvas.prototype.toJSON = fabric.StaticCanvas.prototype.toObject;\n\n  if (fabric.isLikelyNode) {\n    fabric.StaticCanvas.prototype.createPNGStream = function () {\n      var impl = getNodeCanvas(this.lowerCanvasEl);\n      return impl && impl.createPNGStream();\n    };\n    fabric.StaticCanvas.prototype.createJPEGStream = function (opts) {\n      var impl = getNodeCanvas(this.lowerCanvasEl);\n      return impl && impl.createJPEGStream(opts);\n    };\n  }\n})();\n\n/**\n * BaseBrush class\n * @class fabric.BaseBrush\n * @see {@link http://fabricjs.com/freedrawing|Freedrawing demo}\n */\nfabric.BaseBrush = fabric.util.createClass(\n  /** @lends fabric.BaseBrush.prototype */ {\n    /**\n     * Color of a brush\n     * @type String\n     * @default\n     */\n    color: \"rgb(0, 0, 0)\",\n\n    /**\n     * Width of a brush, has to be a Number, no string literals\n     * @type Number\n     * @default\n     */\n    width: 1,\n\n    /**\n     * Shadow object representing shadow of this shape.\n     * <b>Backwards incompatibility note:</b> This property replaces \"shadowColor\" (String), \"shadowOffsetX\" (Number),\n     * \"shadowOffsetY\" (Number) and \"shadowBlur\" (Number) since v1.2.12\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow: null,\n\n    /**\n     * Line endings style of a brush (one of \"butt\", \"round\", \"square\")\n     * @type String\n     * @default\n     */\n    strokeLineCap: \"round\",\n\n    /**\n     * Corner style of a brush (one of \"bevel\", \"round\", \"miter\")\n     * @type String\n     * @default\n     */\n    strokeLineJoin: \"round\",\n\n    /**\n     * Maximum miter length (used for strokeLineJoin = \"miter\") of a brush's\n     * @type Number\n     * @default\n     */\n    strokeMiterLimit: 10,\n\n    /**\n     * Stroke Dash Array.\n     * @type Array\n     * @default\n     */\n    strokeDashArray: null,\n\n    /**\n     * Sets brush styles\n     * @private\n     */\n    _setBrushStyles: function () {\n      var ctx = this.canvas.contextTop;\n      ctx.strokeStyle = this.color;\n      ctx.lineWidth = this.width;\n      ctx.lineCap = this.strokeLineCap;\n      ctx.miterLimit = this.strokeMiterLimit;\n      ctx.lineJoin = this.strokeLineJoin;\n      if (fabric.StaticCanvas.supports(\"setLineDash\")) {\n        ctx.setLineDash(this.strokeDashArray || []);\n      }\n    },\n\n    /**\n     * Sets the transformation on given context\n     * @param {RenderingContext2d} ctx context to render on\n     * @private\n     */\n    _saveAndTransform: function (ctx) {\n      var v = this.canvas.viewportTransform;\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n    },\n\n    /**\n     * Sets brush shadow styles\n     * @private\n     */\n    _setShadow: function () {\n      if (!this.shadow) {\n        return;\n      }\n\n      var canvas = this.canvas,\n        shadow = this.shadow,\n        ctx = canvas.contextTop,\n        zoom = canvas.getZoom();\n      if (canvas && canvas._isRetinaScaling()) {\n        zoom *= fabric.devicePixelRatio;\n      }\n\n      ctx.shadowColor = shadow.color;\n      ctx.shadowBlur = shadow.blur * zoom;\n      ctx.shadowOffsetX = shadow.offsetX * zoom;\n      ctx.shadowOffsetY = shadow.offsetY * zoom;\n    },\n\n    needsFullRender: function () {\n      var color = new fabric.Color(this.color);\n      return color.getAlpha() < 1 || !!this.shadow;\n    },\n\n    /**\n     * Removes brush shadow styles\n     * @private\n     */\n    _resetShadow: function () {\n      var ctx = this.canvas.contextTop;\n\n      ctx.shadowColor = \"\";\n      ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n    },\n  }\n);\n\n(function () {\n  /**\n   * PencilBrush class\n   * @class fabric.PencilBrush\n   * @extends fabric.BaseBrush\n   */\n  fabric.PencilBrush = fabric.util.createClass(\n    fabric.BaseBrush,\n    /** @lends fabric.PencilBrush.prototype */ {\n      /**\n       * Discard points that are less than `decimate` pixel distant from each other\n       * @type Number\n       * @default 0.4\n       */\n      decimate: 0.4,\n\n      /**\n       * Constructor\n       * @param {fabric.Canvas} canvas\n       * @return {fabric.PencilBrush} Instance of a pencil brush\n       */\n      initialize: function (canvas) {\n        this.canvas = canvas;\n        this._points = [];\n      },\n\n      /**\n       * Invoked inside on mouse down and mouse move\n       * @param {Object} pointer\n       */\n      _drawSegment: function (ctx, p1, p2) {\n        var midPoint = p1.midPointFrom(p2);\n        ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);\n        return midPoint;\n      },\n\n      /**\n       * Invoked on mouse down\n       * @param {Object} pointer\n       */\n      onMouseDown: function (pointer, options) {\n        if (!this.canvas._isMainEvent(options.e)) {\n          return;\n        }\n        this._prepareForDrawing(pointer);\n        // capture coordinates immediately\n        // this allows to draw dots (when movement never occurs)\n        this._captureDrawingPath(pointer);\n        this._render();\n      },\n\n      /**\n       * Invoked on mouse move\n       * @param {Object} pointer\n       */\n      onMouseMove: function (pointer, options) {\n        if (!this.canvas._isMainEvent(options.e)) {\n          return;\n        }\n        if (this._captureDrawingPath(pointer) && this._points.length > 1) {\n          if (this.needsFullRender()) {\n            // redraw curve\n            // clear top canvas\n            this.canvas.clearContext(this.canvas.contextTop);\n            this._render();\n          } else {\n            var points = this._points,\n              length = points.length,\n              ctx = this.canvas.contextTop;\n            // draw the curve update\n            this._saveAndTransform(ctx);\n            if (this.oldEnd) {\n              ctx.beginPath();\n              ctx.moveTo(this.oldEnd.x, this.oldEnd.y);\n            }\n            this.oldEnd = this._drawSegment(\n              ctx,\n              points[length - 2],\n              points[length - 1],\n              true\n            );\n            ctx.stroke();\n            ctx.restore();\n          }\n        }\n      },\n\n      /**\n       * Invoked on mouse up\n       */\n      onMouseUp: function (options) {\n        if (!this.canvas._isMainEvent(options.e)) {\n          return true;\n        }\n        this.oldEnd = undefined;\n        this._finalizeAndAddPath();\n        return false;\n      },\n\n      /**\n       * @private\n       * @param {Object} pointer Actual mouse position related to the canvas.\n       */\n      _prepareForDrawing: function (pointer) {\n        var p = new fabric.Point(pointer.x, pointer.y);\n\n        this._reset();\n        this._addPoint(p);\n        this.canvas.contextTop.moveTo(p.x, p.y);\n      },\n\n      /**\n       * @private\n       * @param {fabric.Point} point Point to be added to points array\n       */\n      _addPoint: function (point) {\n        if (\n          this._points.length > 1 &&\n          point.eq(this._points[this._points.length - 1])\n        ) {\n          return false;\n        }\n        this._points.push(point);\n        return true;\n      },\n\n      /**\n       * Clear points array and set contextTop canvas style.\n       * @private\n       */\n      _reset: function () {\n        this._points = [];\n        this._setBrushStyles();\n        this._setShadow();\n      },\n\n      /**\n       * @private\n       * @param {Object} pointer Actual mouse position related to the canvas.\n       */\n      _captureDrawingPath: function (pointer) {\n        var pointerPoint = new fabric.Point(pointer.x, pointer.y);\n        return this._addPoint(pointerPoint);\n      },\n\n      /**\n       * Draw a smooth path on the topCanvas using quadraticCurveTo\n       * @private\n       */\n      _render: function () {\n        var ctx = this.canvas.contextTop,\n          i,\n          len,\n          p1 = this._points[0],\n          p2 = this._points[1];\n\n        this._saveAndTransform(ctx);\n        ctx.beginPath();\n        //if we only have 2 points in the path and they are the same\n        //it means that the user only clicked the canvas without moving the mouse\n        //then we should be drawing a dot. A path isn't drawn between two identical dots\n        //that's why we set them apart a bit\n        if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {\n          var width = this.width / 1000;\n          p1 = new fabric.Point(p1.x, p1.y);\n          p2 = new fabric.Point(p2.x, p2.y);\n          p1.x -= width;\n          p2.x += width;\n        }\n        ctx.moveTo(p1.x, p1.y);\n\n        for (i = 1, len = this._points.length; i < len; i++) {\n          // we pick the point between pi + 1 & pi + 2 as the\n          // end point and p1 as our control point.\n          this._drawSegment(ctx, p1, p2);\n          p1 = this._points[i];\n          p2 = this._points[i + 1];\n        }\n        // Draw last line as a straight line while\n        // we wait for the next point to be able to calculate\n        // the bezier control point\n        ctx.lineTo(p1.x, p1.y);\n        ctx.stroke();\n        ctx.restore();\n      },\n\n      /**\n       * Converts points to SVG path\n       * @param {Array} points Array of points\n       * @return {String} SVG path\n       */\n      convertPointsToSVGPath: function (points) {\n        var path = [],\n          i,\n          width = this.width / 1000,\n          p1 = new fabric.Point(points[0].x, points[0].y),\n          p2 = new fabric.Point(points[1].x, points[1].y),\n          len = points.length,\n          multSignX = 1,\n          multSignY = 0,\n          manyPoints = len > 2;\n\n        if (manyPoints) {\n          multSignX = points[2].x < p2.x ? -1 : points[2].x === p2.x ? 0 : 1;\n          multSignY = points[2].y < p2.y ? -1 : points[2].y === p2.y ? 0 : 1;\n        }\n        path.push(\n          \"M \",\n          p1.x - multSignX * width,\n          \" \",\n          p1.y - multSignY * width,\n          \" \"\n        );\n        for (i = 1; i < len; i++) {\n          if (!p1.eq(p2)) {\n            var midPoint = p1.midPointFrom(p2);\n            // p1 is our bezier control point\n            // midpoint is our endpoint\n            // start point is p(i-1) value.\n            path.push(\n              \"Q \",\n              p1.x,\n              \" \",\n              p1.y,\n              \" \",\n              midPoint.x,\n              \" \",\n              midPoint.y,\n              \" \"\n            );\n          }\n          p1 = points[i];\n          if (i + 1 < points.length) {\n            p2 = points[i + 1];\n          }\n        }\n        if (manyPoints) {\n          multSignX =\n            p1.x > points[i - 2].x ? 1 : p1.x === points[i - 2].x ? 0 : -1;\n          multSignY =\n            p1.y > points[i - 2].y ? 1 : p1.y === points[i - 2].y ? 0 : -1;\n        }\n        path.push(\n          \"L \",\n          p1.x + multSignX * width,\n          \" \",\n          p1.y + multSignY * width\n        );\n        return path;\n      },\n\n      /**\n       * Creates fabric.Path object to add on canvas\n       * @param {String} pathData Path data\n       * @return {fabric.Path} Path to add on canvas\n       */\n      createPath: function (pathData) {\n        var path = new fabric.Path(pathData, {\n          fill: null,\n          stroke: this.color,\n          strokeWidth: this.width,\n          strokeLineCap: this.strokeLineCap,\n          strokeMiterLimit: this.strokeMiterLimit,\n          strokeLineJoin: this.strokeLineJoin,\n          strokeDashArray: this.strokeDashArray,\n        });\n        if (this.shadow) {\n          this.shadow.affectStroke = true;\n          path.shadow = new fabric.Shadow(this.shadow);\n        }\n\n        return path;\n      },\n\n      /**\n       * Decimate poins array with the decimate value\n       */\n      decimatePoints: function (points, distance) {\n        if (points.length <= 2) {\n          return points;\n        }\n        var zoom = this.canvas.getZoom(),\n          adjustedDistance = Math.pow(distance / zoom, 2),\n          i,\n          l = points.length - 1,\n          lastPoint = points[0],\n          newPoints = [lastPoint],\n          cDistance;\n        for (i = 1; i < l; i++) {\n          cDistance =\n            Math.pow(lastPoint.x - points[i].x, 2) +\n            Math.pow(lastPoint.y - points[i].y, 2);\n          if (cDistance >= adjustedDistance) {\n            lastPoint = points[i];\n            newPoints.push(lastPoint);\n          }\n        }\n        if (newPoints.length === 1) {\n          newPoints.push(new fabric.Point(newPoints[0].x, newPoints[0].y));\n        }\n        return newPoints;\n      },\n\n      /**\n       * On mouseup after drawing the path on contextTop canvas\n       * we use the points captured to create an new fabric path object\n       * and add it to the fabric canvas.\n       */\n      _finalizeAndAddPath: function () {\n        var ctx = this.canvas.contextTop;\n        ctx.closePath();\n        if (this.decimate) {\n          this._points = this.decimatePoints(this._points, this.decimate);\n        }\n        var pathData = this.convertPointsToSVGPath(this._points).join(\"\");\n        if (pathData === \"M 0 0 Q 0 0 0 0 L 0 0\") {\n          // do not create 0 width/height paths, as they are\n          // rendered inconsistently across browsers\n          // Firefox 4, for example, renders a dot,\n          // whereas Chrome 10 renders nothing\n          this.canvas.requestRenderAll();\n          return;\n        }\n\n        var path = this.createPath(pathData);\n        this.canvas.clearContext(this.canvas.contextTop);\n        this.canvas.add(path);\n        this.canvas.requestRenderAll();\n        path.setCoords();\n        this._resetShadow();\n\n        // fire event 'path' created\n        this.canvas.fire(\"path:created\", { path: path });\n      },\n    }\n  );\n})();\n\n/**\n * CircleBrush class\n * @class fabric.CircleBrush\n */\nfabric.CircleBrush = fabric.util.createClass(\n  fabric.BaseBrush,\n  /** @lends fabric.CircleBrush.prototype */ {\n    /**\n     * Width of a brush\n     * @type Number\n     * @default\n     */\n    width: 10,\n\n    /**\n     * Constructor\n     * @param {fabric.Canvas} canvas\n     * @return {fabric.CircleBrush} Instance of a circle brush\n     */\n    initialize: function (canvas) {\n      this.canvas = canvas;\n      this.points = [];\n    },\n\n    /**\n     * Invoked inside on mouse down and mouse move\n     * @param {Object} pointer\n     */\n    drawDot: function (pointer) {\n      var point = this.addPoint(pointer),\n        ctx = this.canvas.contextTop;\n      this._saveAndTransform(ctx);\n      this.dot(ctx, point);\n      ctx.restore();\n    },\n\n    dot: function (ctx, point) {\n      ctx.fillStyle = point.fill;\n      ctx.beginPath();\n      ctx.arc(point.x, point.y, point.radius, 0, Math.PI * 2, false);\n      ctx.closePath();\n      ctx.fill();\n    },\n\n    /**\n     * Invoked on mouse down\n     */\n    onMouseDown: function (pointer) {\n      this.points.length = 0;\n      this.canvas.clearContext(this.canvas.contextTop);\n      this._setShadow();\n      this.drawDot(pointer);\n    },\n\n    /**\n     * Render the full state of the brush\n     * @private\n     */\n    _render: function () {\n      var ctx = this.canvas.contextTop,\n        i,\n        len,\n        points = this.points;\n      this._saveAndTransform(ctx);\n      for (i = 0, len = points.length; i < len; i++) {\n        this.dot(ctx, points[i]);\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Invoked on mouse move\n     * @param {Object} pointer\n     */\n    onMouseMove: function (pointer) {\n      if (this.needsFullRender()) {\n        this.canvas.clearContext(this.canvas.contextTop);\n        this.addPoint(pointer);\n        this._render();\n      } else {\n        this.drawDot(pointer);\n      }\n    },\n\n    /**\n     * Invoked on mouse up\n     */\n    onMouseUp: function () {\n      var originalRenderOnAddRemove = this.canvas.renderOnAddRemove,\n        i,\n        len;\n      this.canvas.renderOnAddRemove = false;\n\n      var circles = [];\n\n      for (i = 0, len = this.points.length; i < len; i++) {\n        var point = this.points[i],\n          circle = new fabric.Circle({\n            radius: point.radius,\n            left: point.x,\n            top: point.y,\n            originX: \"center\",\n            originY: \"center\",\n            fill: point.fill,\n          });\n\n        this.shadow && (circle.shadow = new fabric.Shadow(this.shadow));\n\n        circles.push(circle);\n      }\n      var group = new fabric.Group(circles);\n      group.canvas = this.canvas;\n\n      this.canvas.add(group);\n      this.canvas.fire(\"path:created\", { path: group });\n\n      this.canvas.clearContext(this.canvas.contextTop);\n      this._resetShadow();\n      this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n      this.canvas.requestRenderAll();\n    },\n\n    /**\n     * @param {Object} pointer\n     * @return {fabric.Point} Just added pointer point\n     */\n    addPoint: function (pointer) {\n      var pointerPoint = new fabric.Point(pointer.x, pointer.y),\n        circleRadius =\n          fabric.util.getRandomInt(\n            Math.max(0, this.width - 20),\n            this.width + 20\n          ) / 2,\n        circleColor = new fabric.Color(this.color)\n          .setAlpha(fabric.util.getRandomInt(0, 100) / 100)\n          .toRgba();\n\n      pointerPoint.radius = circleRadius;\n      pointerPoint.fill = circleColor;\n\n      this.points.push(pointerPoint);\n\n      return pointerPoint;\n    },\n  }\n);\n\n/**\n * SprayBrush class\n * @class fabric.SprayBrush\n */\nfabric.SprayBrush = fabric.util.createClass(\n  fabric.BaseBrush,\n  /** @lends fabric.SprayBrush.prototype */ {\n    /**\n     * Width of a spray\n     * @type Number\n     * @default\n     */\n    width: 10,\n\n    /**\n     * Density of a spray (number of dots per chunk)\n     * @type Number\n     * @default\n     */\n    density: 20,\n\n    /**\n     * Width of spray dots\n     * @type Number\n     * @default\n     */\n    dotWidth: 1,\n\n    /**\n     * Width variance of spray dots\n     * @type Number\n     * @default\n     */\n    dotWidthVariance: 1,\n\n    /**\n     * Whether opacity of a dot should be random\n     * @type Boolean\n     * @default\n     */\n    randomOpacity: false,\n\n    /**\n     * Whether overlapping dots (rectangles) should be removed (for performance reasons)\n     * @type Boolean\n     * @default\n     */\n    optimizeOverlapping: true,\n\n    /**\n     * Constructor\n     * @param {fabric.Canvas} canvas\n     * @return {fabric.SprayBrush} Instance of a spray brush\n     */\n    initialize: function (canvas) {\n      this.canvas = canvas;\n      this.sprayChunks = [];\n    },\n\n    /**\n     * Invoked on mouse down\n     * @param {Object} pointer\n     */\n    onMouseDown: function (pointer) {\n      this.sprayChunks.length = 0;\n      this.canvas.clearContext(this.canvas.contextTop);\n      this._setShadow();\n\n      this.addSprayChunk(pointer);\n      this.render(this.sprayChunkPoints);\n    },\n\n    /**\n     * Invoked on mouse move\n     * @param {Object} pointer\n     */\n    onMouseMove: function (pointer) {\n      this.addSprayChunk(pointer);\n      this.render(this.sprayChunkPoints);\n    },\n\n    /**\n     * Invoked on mouse up\n     */\n    onMouseUp: function () {\n      var originalRenderOnAddRemove = this.canvas.renderOnAddRemove;\n      this.canvas.renderOnAddRemove = false;\n\n      var rects = [];\n\n      for (var i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n        var sprayChunk = this.sprayChunks[i];\n\n        for (var j = 0, jlen = sprayChunk.length; j < jlen; j++) {\n          var rect = new fabric.Rect({\n            width: sprayChunk[j].width,\n            height: sprayChunk[j].width,\n            left: sprayChunk[j].x + 1,\n            top: sprayChunk[j].y + 1,\n            originX: \"center\",\n            originY: \"center\",\n            fill: this.color,\n          });\n          rects.push(rect);\n        }\n      }\n\n      if (this.optimizeOverlapping) {\n        rects = this._getOptimizedRects(rects);\n      }\n\n      var group = new fabric.Group(rects);\n      this.shadow && group.set(\"shadow\", new fabric.Shadow(this.shadow));\n      this.canvas.add(group);\n      this.canvas.fire(\"path:created\", { path: group });\n\n      this.canvas.clearContext(this.canvas.contextTop);\n      this._resetShadow();\n      this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n      this.canvas.requestRenderAll();\n    },\n\n    /**\n     * @private\n     * @param {Array} rects\n     */\n    _getOptimizedRects: function (rects) {\n      // avoid creating duplicate rects at the same coordinates\n      var uniqueRects = {},\n        key,\n        i,\n        len;\n\n      for (i = 0, len = rects.length; i < len; i++) {\n        key = rects[i].left + \"\" + rects[i].top;\n        if (!uniqueRects[key]) {\n          uniqueRects[key] = rects[i];\n        }\n      }\n      var uniqueRectsArray = [];\n      for (key in uniqueRects) {\n        uniqueRectsArray.push(uniqueRects[key]);\n      }\n\n      return uniqueRectsArray;\n    },\n\n    /**\n     * Render new chunk of spray brush\n     */\n    render: function (sprayChunk) {\n      var ctx = this.canvas.contextTop,\n        i,\n        len;\n      ctx.fillStyle = this.color;\n\n      this._saveAndTransform(ctx);\n\n      for (i = 0, len = sprayChunk.length; i < len; i++) {\n        var point = sprayChunk[i];\n        if (typeof point.opacity !== \"undefined\") {\n          ctx.globalAlpha = point.opacity;\n        }\n        ctx.fillRect(point.x, point.y, point.width, point.width);\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Render all spray chunks\n     */\n    _render: function () {\n      var ctx = this.canvas.contextTop,\n        i,\n        ilen;\n      ctx.fillStyle = this.color;\n\n      this._saveAndTransform(ctx);\n\n      for (i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n        this.render(this.sprayChunks[i]);\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @param {Object} pointer\n     */\n    addSprayChunk: function (pointer) {\n      this.sprayChunkPoints = [];\n\n      var x,\n        y,\n        width,\n        radius = this.width / 2,\n        i;\n\n      for (i = 0; i < this.density; i++) {\n        x = fabric.util.getRandomInt(pointer.x - radius, pointer.x + radius);\n        y = fabric.util.getRandomInt(pointer.y - radius, pointer.y + radius);\n\n        if (this.dotWidthVariance) {\n          width = fabric.util.getRandomInt(\n            // bottom clamp width to 1\n            Math.max(1, this.dotWidth - this.dotWidthVariance),\n            this.dotWidth + this.dotWidthVariance\n          );\n        } else {\n          width = this.dotWidth;\n        }\n\n        var point = new fabric.Point(x, y);\n        point.width = width;\n\n        if (this.randomOpacity) {\n          point.opacity = fabric.util.getRandomInt(0, 100) / 100;\n        }\n\n        this.sprayChunkPoints.push(point);\n      }\n\n      this.sprayChunks.push(this.sprayChunkPoints);\n    },\n  }\n);\n\n/**\n * PatternBrush class\n * @class fabric.PatternBrush\n * @extends fabric.BaseBrush\n */\nfabric.PatternBrush = fabric.util.createClass(\n  fabric.PencilBrush,\n  /** @lends fabric.PatternBrush.prototype */ {\n    getPatternSrc: function () {\n      var dotWidth = 20,\n        dotDistance = 5,\n        patternCanvas = fabric.util.createCanvasElement(),\n        patternCtx = patternCanvas.getContext(\"2d\");\n\n      patternCanvas.width = patternCanvas.height = dotWidth + dotDistance;\n\n      patternCtx.fillStyle = this.color;\n      patternCtx.beginPath();\n      patternCtx.arc(\n        dotWidth / 2,\n        dotWidth / 2,\n        dotWidth / 2,\n        0,\n        Math.PI * 2,\n        false\n      );\n      patternCtx.closePath();\n      patternCtx.fill();\n\n      return patternCanvas;\n    },\n\n    getPatternSrcFunction: function () {\n      return String(this.getPatternSrc).replace(\n        \"this.color\",\n        '\"' + this.color + '\"'\n      );\n    },\n\n    /**\n     * Creates \"pattern\" instance property\n     */\n    getPattern: function () {\n      return this.canvas.contextTop.createPattern(\n        this.source || this.getPatternSrc(),\n        \"repeat\"\n      );\n    },\n\n    /**\n     * Sets brush styles\n     */\n    _setBrushStyles: function () {\n      this.callSuper(\"_setBrushStyles\");\n      this.canvas.contextTop.strokeStyle = this.getPattern();\n    },\n\n    /**\n     * Creates path\n     */\n    createPath: function (pathData) {\n      var path = this.callSuper(\"createPath\", pathData),\n        topLeft = path._getLeftTopCoords().scalarAdd(path.strokeWidth / 2);\n\n      path.stroke = new fabric.Pattern({\n        source: this.source || this.getPatternSrcFunction(),\n        offsetX: -topLeft.x,\n        offsetY: -topLeft.y,\n      });\n      return path;\n    },\n  }\n);\n\n(function () {\n  var getPointer = fabric.util.getPointer,\n    degreesToRadians = fabric.util.degreesToRadians,\n    abs = Math.abs,\n    supportLineDash = fabric.StaticCanvas.supports(\"setLineDash\"),\n    isTouchEvent = fabric.util.isTouchEvent,\n    STROKE_OFFSET = 0.5;\n\n  /**\n   * Canvas class\n   * @class fabric.Canvas\n   * @extends fabric.StaticCanvas\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#canvas}\n   * @see {@link fabric.Canvas#initialize} for constructor definition\n   *\n   * @fires object:modified at the end of a transform or any change when statefull is true\n   * @fires object:rotated at the end of a rotation transform\n   * @fires object:scaled at the end of a scale transform\n   * @fires object:moved at the end of translation transform\n   * @fires object:skewed at the end of a skew transform\n   * @fires object:rotating while an object is being rotated from the control\n   * @fires object:scaling while an object is being scaled by controls\n   * @fires object:moving while an object is being dragged\n   * @fires object:skewing while an object is being skewed from the controls\n   *\n   * @fires before:transform before a transform is is started\n   * @fires before:selection:cleared\n   * @fires selection:cleared\n   * @fires selection:updated\n   * @fires selection:created\n   *\n   * @fires path:created after a drawing operation ends and the path is added\n   * @fires mouse:down\n   * @fires mouse:move\n   * @fires mouse:up\n   * @fires mouse:down:before  on mouse down, before the inner fabric logic runs\n   * @fires mouse:move:before on mouse move, before the inner fabric logic runs\n   * @fires mouse:up:before on mouse up, before the inner fabric logic runs\n   * @fires mouse:over\n   * @fires mouse:out\n   * @fires mouse:dblclick whenever a native dbl click event fires on the canvas.\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop\n   * @fires after:render at the end of the render process, receives the context in the callback\n   * @fires before:render at start the render process, receives the context in the callback\n   *\n   */\n  fabric.Canvas = fabric.util.createClass(\n    fabric.StaticCanvas,\n    /** @lends fabric.Canvas.prototype */ {\n      /**\n       * Constructor\n       * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n       * @param {Object} [options] Options object\n       * @return {Object} thisArg\n       */\n      initialize: function (el, options) {\n        options || (options = {});\n        this.renderAndResetBound = this.renderAndReset.bind(this);\n        this.requestRenderAllBound = this.requestRenderAll.bind(this);\n        this._initStatic(el, options);\n        this._initInteractive();\n        this._createCacheCanvas();\n      },\n\n      /**\n       * When true, objects can be transformed by one side (unproportionally)\n       * when dragged on the corners that normally would not do that.\n       * @type Boolean\n       * @default\n       * @since fabric 4.0 // changed name and default value\n       */\n      uniformScaling: true,\n\n      /**\n       * Indicates which key switches uniform scaling.\n       * values: 'altKey', 'shiftKey', 'ctrlKey'.\n       * If `null` or 'none' or any other string that is not a modifier key\n       * feature is disabled.\n       * totally wrong named. this sounds like `uniform scaling`\n       * if Canvas.uniformScaling is true, pressing this will set it to false\n       * and viceversa.\n       * @since 1.6.2\n       * @type String\n       * @default\n       */\n      uniScaleKey: \"shiftKey\",\n\n      /**\n       * When true, objects use center point as the origin of scale transformation.\n       * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n       * @since 1.3.4\n       * @type Boolean\n       * @default\n       */\n      centeredScaling: false,\n\n      /**\n       * When true, objects use center point as the origin of rotate transformation.\n       * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n       * @since 1.3.4\n       * @type Boolean\n       * @default\n       */\n      centeredRotation: false,\n\n      /**\n       * Indicates which key enable centered Transform\n       * values: 'altKey', 'shiftKey', 'ctrlKey'.\n       * If `null` or 'none' or any other string that is not a modifier key\n       * feature is disabled feature disabled.\n       * @since 1.6.2\n       * @type String\n       * @default\n       */\n      centeredKey: \"altKey\",\n\n      /**\n       * Indicates which key enable alternate action on corner\n       * values: 'altKey', 'shiftKey', 'ctrlKey'.\n       * If `null` or 'none' or any other string that is not a modifier key\n       * feature is disabled feature disabled.\n       * @since 1.6.2\n       * @type String\n       * @default\n       */\n      altActionKey: \"shiftKey\",\n\n      /**\n       * Indicates that canvas is interactive. This property should not be changed.\n       * @type Boolean\n       * @default\n       */\n      interactive: true,\n\n      /**\n       * Indicates whether group selection should be enabled\n       * @type Boolean\n       * @default\n       */\n      selection: true,\n\n      /**\n       * Indicates which key or keys enable multiple click selection\n       * Pass value as a string or array of strings\n       * values: 'altKey', 'shiftKey', 'ctrlKey'.\n       * If `null` or empty or containing any other string that is not a modifier key\n       * feature is disabled.\n       * @since 1.6.2\n       * @type String|Array\n       * @default\n       */\n      selectionKey: \"shiftKey\",\n\n      /**\n       * Indicates which key enable alternative selection\n       * in case of target overlapping with active object\n       * values: 'altKey', 'shiftKey', 'ctrlKey'.\n       * For a series of reason that come from the general expectations on how\n       * things should work, this feature works only for preserveObjectStacking true.\n       * If `null` or 'none' or any other string that is not a modifier key\n       * feature is disabled.\n       * @since 1.6.5\n       * @type null|String\n       * @default\n       */\n      altSelectionKey: null,\n\n      /**\n       * Color of selection\n       * @type String\n       * @default\n       */\n      selectionColor: \"rgba(100, 100, 255, 0.3)\", // blue\n\n      /**\n       * Default dash array pattern\n       * If not empty the selection border is dashed\n       * @type Array\n       */\n      selectionDashArray: [],\n\n      /**\n       * Color of the border of selection (usually slightly darker than color of selection itself)\n       * @type String\n       * @default\n       */\n      selectionBorderColor: \"rgba(255, 255, 255, 0.3)\",\n\n      /**\n       * Width of a line used in object/group selection\n       * @type Number\n       * @default\n       */\n      selectionLineWidth: 1,\n\n      /**\n       * Select only shapes that are fully contained in the dragged selection rectangle.\n       * @type Boolean\n       * @default\n       */\n      selectionFullyContained: false,\n\n      /**\n       * Default cursor value used when hovering over an object on canvas\n       * @type String\n       * @default\n       */\n      hoverCursor: \"move\",\n\n      /**\n       * Default cursor value used when moving an object on canvas\n       * @type String\n       * @default\n       */\n      moveCursor: \"move\",\n\n      /**\n       * Default cursor value used for the entire canvas\n       * @type String\n       * @default\n       */\n      defaultCursor: \"default\",\n\n      /**\n       * Cursor value used during free drawing\n       * @type String\n       * @default\n       */\n      freeDrawingCursor: \"crosshair\",\n\n      /**\n       * Cursor value used for rotation point\n       * @type String\n       * @default\n       */\n      rotationCursor: \"crosshair\",\n\n      /**\n       * Cursor value used for disabled elements ( corners with disabled action )\n       * @type String\n       * @since 2.0.0\n       * @default\n       */\n      notAllowedCursor: \"not-allowed\",\n\n      /**\n       * Default element class that's given to wrapper (div) element of canvas\n       * @type String\n       * @default\n       */\n      containerClass: \"canvas-container\",\n\n      /**\n       * When true, object detection happens on per-pixel basis rather than on per-bounding-box\n       * @type Boolean\n       * @default\n       */\n      perPixelTargetFind: false,\n\n      /**\n       * Number of pixels around target pixel to tolerate (consider active) during object detection\n       * @type Number\n       * @default\n       */\n      targetFindTolerance: 0,\n\n      /**\n       * When true, target detection is skipped when hovering over canvas. This can be used to improve performance.\n       * @type Boolean\n       * @default\n       */\n      skipTargetFind: false,\n\n      /**\n       * When true, mouse events on canvas (mousedown/mousemove/mouseup) result in free drawing.\n       * After mousedown, mousemove creates a shape,\n       * and then mouseup finalizes it and adds an instance of `fabric.Path` onto canvas.\n       * @tutorial {@link http://fabricjs.com/fabric-intro-part-4#free_drawing}\n       * @type Boolean\n       * @default\n       */\n      isDrawingMode: false,\n\n      /**\n       * Indicates whether objects should remain in current stack position when selected.\n       * When false objects are brought to top and rendered as part of the selection group\n       * @type Boolean\n       * @default\n       */\n      preserveObjectStacking: false,\n\n      /**\n       * Indicates the angle that an object will lock to while rotating.\n       * @type Number\n       * @since 1.6.7\n       * @default\n       */\n      snapAngle: 0,\n\n      /**\n       * Indicates the distance from the snapAngle the rotation will lock to the snapAngle.\n       * When `null`, the snapThreshold will default to the snapAngle.\n       * @type null|Number\n       * @since 1.6.7\n       * @default\n       */\n      snapThreshold: null,\n\n      /**\n       * Indicates if the right click on canvas can output the context menu or not\n       * @type Boolean\n       * @since 1.6.5\n       * @default\n       */\n      stopContextMenu: false,\n\n      /**\n       * Indicates if the canvas can fire right click events\n       * @type Boolean\n       * @since 1.6.5\n       * @default\n       */\n      fireRightClick: false,\n\n      /**\n       * Indicates if the canvas can fire middle click events\n       * @type Boolean\n       * @since 1.7.8\n       * @default\n       */\n      fireMiddleClick: false,\n\n      /**\n       * Keep track of the subTargets for Mouse Events\n       * @type fabric.Object[]\n       */\n      targets: [],\n\n      /**\n       * Keep track of the hovered target\n       * @type fabric.Object\n       * @private\n       */\n      _hoveredTarget: null,\n\n      /**\n       * hold the list of nested targets hovered\n       * @type fabric.Object[]\n       * @private\n       */\n      _hoveredTargets: [],\n\n      /**\n       * @private\n       */\n      _initInteractive: function () {\n        this._currentTransform = null;\n        this._groupSelector = null;\n        this._initWrapperElement();\n        this._createUpperCanvas();\n        this._initEventListeners();\n\n        this._initRetinaScaling();\n\n        this.freeDrawingBrush =\n          fabric.PencilBrush && new fabric.PencilBrush(this);\n\n        this.calcOffset();\n      },\n\n      /**\n       * Divides objects in two groups, one to render immediately\n       * and one to render as activeGroup.\n       * @return {Array} objects to render immediately and pushes the other in the activeGroup.\n       */\n      _chooseObjectsToRender: function () {\n        var activeObjects = this.getActiveObjects(),\n          object,\n          objsToRender,\n          activeGroupObjects;\n\n        if (activeObjects.length > 0 && !this.preserveObjectStacking) {\n          objsToRender = [];\n          activeGroupObjects = [];\n          for (var i = 0, length = this._objects.length; i < length; i++) {\n            object = this._objects[i];\n            if (activeObjects.indexOf(object) === -1) {\n              objsToRender.push(object);\n            } else {\n              activeGroupObjects.push(object);\n            }\n          }\n          if (activeObjects.length > 1) {\n            this._activeObject._objects = activeGroupObjects;\n          }\n          objsToRender.push.apply(objsToRender, activeGroupObjects);\n        } else {\n          objsToRender = this._objects;\n        }\n        return objsToRender;\n      },\n\n      /**\n       * Renders both the top canvas and the secondary container canvas.\n       * @return {fabric.Canvas} instance\n       * @chainable\n       */\n      renderAll: function () {\n        if (\n          this.contextTopDirty &&\n          !this._groupSelector &&\n          !this.isDrawingMode\n        ) {\n          this.clearContext(this.contextTop);\n          this.contextTopDirty = false;\n        }\n        if (this.hasLostContext) {\n          this.renderTopLayer(this.contextTop);\n        }\n        var canvasToDrawOn = this.contextContainer;\n        this.renderCanvas(canvasToDrawOn, this._chooseObjectsToRender());\n        return this;\n      },\n\n      renderTopLayer: function (ctx) {\n        ctx.save();\n        if (this.isDrawingMode && this._isCurrentlyDrawing) {\n          this.freeDrawingBrush && this.freeDrawingBrush._render();\n          this.contextTopDirty = true;\n        }\n        // we render the top context - last object\n        if (this.selection && this._groupSelector) {\n          this._drawSelection(ctx);\n          this.contextTopDirty = true;\n        }\n        ctx.restore();\n      },\n\n      /**\n       * Method to render only the top canvas.\n       * Also used to render the group selection box.\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      renderTop: function () {\n        var ctx = this.contextTop;\n        this.clearContext(ctx);\n        this.renderTopLayer(ctx);\n        this.fire(\"after:render\");\n        return this;\n      },\n\n      /**\n       * Checks if point is contained within an area of given object\n       * @param {Event} e Event object\n       * @param {fabric.Object} target Object to test against\n       * @param {Object} [point] x,y object of point coordinates we want to check.\n       * @return {Boolean} true if point is contained within an area of given object\n       */\n      containsPoint: function (e, target, point) {\n        var ignoreZoom = true,\n          pointer = point || this.getPointer(e, ignoreZoom),\n          xy,\n          isTouch = e ? isTouchEvent(e) : false;\n\n        if (\n          target.group &&\n          target.group === this._activeObject &&\n          target.group.type === \"activeSelection\"\n        ) {\n          xy = this._normalizePointer(target.group, pointer);\n        } else {\n          xy = { x: pointer.x, y: pointer.y };\n        }\n        // http://www.geog.ubc.ca/courses/klink/gis.notes/ncgia/u32.html\n        // http://idav.ucdavis.edu/~okreylos/TAship/Spring2000/PointInPolygon.html\n        return (\n          target.containsPoint(xy) ||\n          !!target._findTargetCorner(pointer, isTouch)\n        );\n      },\n\n      /**\n       * @private\n       */\n      _normalizePointer: function (object, pointer) {\n        var m = object.calcTransformMatrix(),\n          invertedM = fabric.util.invertTransform(m),\n          vptPointer = this.restorePointerVpt(pointer);\n        return fabric.util.transformPoint(vptPointer, invertedM);\n      },\n\n      /**\n       * Returns true if object is transparent at a certain location\n       * @param {fabric.Object} target Object to check\n       * @param {Number} x Left coordinate\n       * @param {Number} y Top coordinate\n       * @return {Boolean}\n       */\n      isTargetTransparent: function (target, x, y) {\n        // in case the target is the activeObject, we cannot execute this optimization\n        // because we need to draw controls too.\n        if (\n          target.shouldCache() &&\n          target._cacheCanvas &&\n          target !== this._activeObject\n        ) {\n          var normalizedPointer = this._normalizePointer(target, {\n              x: x,\n              y: y,\n            }),\n            targetRelativeX = Math.max(\n              target.cacheTranslationX + normalizedPointer.x * target.zoomX,\n              0\n            ),\n            targetRelativeY = Math.max(\n              target.cacheTranslationY + normalizedPointer.y * target.zoomY,\n              0\n            );\n\n          var isTransparent = fabric.util.isTransparent(\n            target._cacheContext,\n            Math.round(targetRelativeX),\n            Math.round(targetRelativeY),\n            this.targetFindTolerance\n          );\n\n          return isTransparent;\n        }\n\n        var ctx = this.contextCache,\n          originalColor = target.selectionBackgroundColor,\n          v = this.viewportTransform;\n\n        target.selectionBackgroundColor = \"\";\n\n        this.clearContext(ctx);\n\n        ctx.save();\n        ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        target.render(ctx);\n        ctx.restore();\n\n        target === this._activeObject &&\n          target._renderControls(\n            ctx,\n            {\n              hasBorders: false,\n              transparentCorners: false,\n            },\n            {\n              hasBorders: false,\n            }\n          );\n\n        target.selectionBackgroundColor = originalColor;\n\n        var isTransparent = fabric.util.isTransparent(\n          ctx,\n          x,\n          y,\n          this.targetFindTolerance\n        );\n\n        return isTransparent;\n      },\n\n      /**\n       * takes an event and determins if selection key has been pressed\n       * @private\n       * @param {Event} e Event object\n       */\n      _isSelectionKeyPressed: function (e) {\n        var selectionKeyPressed = false;\n\n        if (\n          Object.prototype.toString.call(this.selectionKey) === \"[object Array]\"\n        ) {\n          selectionKeyPressed = !!this.selectionKey.find(function (key) {\n            return e[key] === true;\n          });\n        } else {\n          selectionKeyPressed = e[this.selectionKey];\n        }\n\n        return selectionKeyPressed;\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object\n       * @param {fabric.Object} target\n       */\n      _shouldClearSelection: function (e, target) {\n        var activeObjects = this.getActiveObjects(),\n          activeObject = this._activeObject;\n\n        return (\n          !target ||\n          (target &&\n            activeObject &&\n            activeObjects.length > 1 &&\n            activeObjects.indexOf(target) === -1 &&\n            activeObject !== target &&\n            !this._isSelectionKeyPressed(e)) ||\n          (target && !target.evented) ||\n          (target &&\n            !target.selectable &&\n            activeObject &&\n            activeObject !== target)\n        );\n      },\n\n      /**\n       * centeredScaling from object can't override centeredScaling from canvas.\n       * this should be fixed, since object setting should take precedence over canvas.\n       * also this should be something that will be migrated in the control properties.\n       * as ability to define the origin of the transformation that the control provide.\n       * @private\n       * @param {fabric.Object} target\n       * @param {String} action\n       */\n      _shouldCenterTransform: function (target, action, altKey) {\n        if (!target) {\n          return;\n        }\n\n        var centerTransform;\n\n        if (action === \"scale\" || action === \"scaleX\" || action === \"scaleY\") {\n          centerTransform = this.centeredScaling || target.centeredScaling;\n        } else if (action === \"rotate\") {\n          centerTransform = this.centeredRotation || target.centeredRotation;\n        }\n\n        return centerTransform ? !altKey : altKey;\n      },\n\n      /**\n       * should disappear before release 4.0\n       * @private\n       */\n      _getOriginFromCorner: function (target, corner) {\n        var origin = {\n          x: target.originX,\n          y: target.originY,\n        };\n\n        if (corner === \"ml\" || corner === \"tl\" || corner === \"bl\") {\n          origin.x = \"right\";\n        } else if (corner === \"mr\" || corner === \"tr\" || corner === \"br\") {\n          origin.x = \"left\";\n        }\n\n        if (corner === \"tl\" || corner === \"mt\" || corner === \"tr\") {\n          origin.y = \"bottom\";\n        } else if (corner === \"bl\" || corner === \"mb\" || corner === \"br\") {\n          origin.y = \"top\";\n        } else if (corner === \"mtr\") {\n          origin.x = \"center\";\n          origin.y = \"center\";\n        }\n        return origin;\n      },\n\n      /**\n       * @private\n       * @param {Boolean} alreadySelected true if target is already selected\n       * @param {String} corner a string representing the corner ml, mr, tl ...\n       * @param {Event} e Event object\n       * @param {fabric.Object} [target] inserted back to help overriding. Unused\n       */\n      _getActionFromCorner: function (alreadySelected, corner, e, target) {\n        if (!corner || !alreadySelected) {\n          return \"drag\";\n        }\n        var control = target.controls[corner];\n        return control.getActionName(e, control, target);\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object\n       * @param {fabric.Object} target\n       */\n      _setupCurrentTransform: function (e, target, alreadySelected) {\n        if (!target) {\n          return;\n        }\n\n        var pointer = this.getPointer(e),\n          corner = target.__corner,\n          actionHandler =\n            !!corner && target.controls[corner].getActionHandler(),\n          action = this._getActionFromCorner(\n            alreadySelected,\n            corner,\n            e,\n            target\n          ),\n          origin = this._getOriginFromCorner(target, corner),\n          altKey = e[this.centeredKey],\n          transform = {\n            target: target,\n            action: action,\n            actionHandler: actionHandler,\n            corner: corner,\n            scaleX: target.scaleX,\n            scaleY: target.scaleY,\n            skewX: target.skewX,\n            skewY: target.skewY,\n            // used by transation\n            offsetX: pointer.x - target.left,\n            offsetY: pointer.y - target.top,\n            originX: origin.x,\n            originY: origin.y,\n            ex: pointer.x,\n            ey: pointer.y,\n            lastX: pointer.x,\n            lastY: pointer.y,\n            // unsure they are useful anymore.\n            // left: target.left,\n            // top: target.top,\n            theta: degreesToRadians(target.angle),\n            // end of unsure\n            width: target.width * target.scaleX,\n            shiftKey: e.shiftKey,\n            altKey: altKey,\n            original: fabric.util.saveObjectTransform(target),\n          };\n\n        if (this._shouldCenterTransform(target, action, altKey)) {\n          transform.originX = \"center\";\n          transform.originY = \"center\";\n        }\n        transform.original.originX = origin.x;\n        transform.original.originY = origin.y;\n        this._currentTransform = transform;\n        this._beforeTransform(e);\n      },\n\n      /**\n       * Translates object by \"setting\" its left/top\n       * @private\n       * @param {Number} x pointer's x coordinate\n       * @param {Number} y pointer's y coordinate\n       * @return {Boolean} true if the translation occurred\n       */\n      _translateObject: function (x, y) {\n        var transform = this._currentTransform,\n          target = transform.target,\n          newLeft = x - transform.offsetX,\n          newTop = y - transform.offsetY,\n          moveX = !target.get(\"lockMovementX\") && target.left !== newLeft,\n          moveY = !target.get(\"lockMovementY\") && target.top !== newTop;\n\n        moveX && target.set(\"left\", newLeft);\n        moveY && target.set(\"top\", newTop);\n        return moveX || moveY;\n      },\n\n      /**\n       * Set the cursor type of the canvas element\n       * @param {String} value Cursor type of the canvas element.\n       * @see http://www.w3.org/TR/css3-ui/#cursor\n       */\n      setCursor: function (value) {\n        this.upperCanvasEl.style.cursor = value;\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx to draw the selection on\n       */\n      _drawSelection: function (ctx) {\n        var groupSelector = this._groupSelector,\n          left = groupSelector.left,\n          top = groupSelector.top,\n          aleft = abs(left),\n          atop = abs(top);\n\n        if (this.selectionColor) {\n          ctx.fillStyle = this.selectionColor;\n\n          ctx.fillRect(\n            groupSelector.ex - (left > 0 ? 0 : -left),\n            groupSelector.ey - (top > 0 ? 0 : -top),\n            aleft,\n            atop\n          );\n        }\n\n        if (!this.selectionLineWidth || !this.selectionBorderColor) {\n          return;\n        }\n        ctx.lineWidth = this.selectionLineWidth;\n        ctx.strokeStyle = this.selectionBorderColor;\n\n        // selection border\n        if (this.selectionDashArray.length > 1 && !supportLineDash) {\n          var px = groupSelector.ex + STROKE_OFFSET - (left > 0 ? 0 : aleft),\n            py = groupSelector.ey + STROKE_OFFSET - (top > 0 ? 0 : atop);\n\n          ctx.beginPath();\n\n          fabric.util.drawDashedLine(\n            ctx,\n            px,\n            py,\n            px + aleft,\n            py,\n            this.selectionDashArray\n          );\n          fabric.util.drawDashedLine(\n            ctx,\n            px,\n            py + atop - 1,\n            px + aleft,\n            py + atop - 1,\n            this.selectionDashArray\n          );\n          fabric.util.drawDashedLine(\n            ctx,\n            px,\n            py,\n            px,\n            py + atop,\n            this.selectionDashArray\n          );\n          fabric.util.drawDashedLine(\n            ctx,\n            px + aleft - 1,\n            py,\n            px + aleft - 1,\n            py + atop,\n            this.selectionDashArray\n          );\n\n          ctx.closePath();\n          ctx.stroke();\n        } else {\n          fabric.Object.prototype._setLineDash.call(\n            this,\n            ctx,\n            this.selectionDashArray\n          );\n          ctx.strokeRect(\n            groupSelector.ex + STROKE_OFFSET - (left > 0 ? 0 : aleft),\n            groupSelector.ey + STROKE_OFFSET - (top > 0 ? 0 : atop),\n            aleft,\n            atop\n          );\n        }\n      },\n\n      /**\n       * Method that determines what object we are clicking on\n       * the skipGroup parameter is for internal use, is needed for shift+click action\n       * 11/09/2018 TODO: would be cool if findTarget could discern between being a full target\n       * or the outside part of the corner.\n       * @param {Event} e mouse event\n       * @param {Boolean} skipGroup when true, activeGroup is skipped and only objects are traversed through\n       * @return {fabric.Object} the target found\n       */\n      findTarget: function (e, skipGroup) {\n        if (this.skipTargetFind) {\n          return;\n        }\n\n        var ignoreZoom = true,\n          pointer = this.getPointer(e, ignoreZoom),\n          activeObject = this._activeObject,\n          aObjects = this.getActiveObjects(),\n          activeTarget,\n          activeTargetSubs,\n          isTouch = isTouchEvent(e);\n\n        // first check current group (if one exists)\n        // active group does not check sub targets like normal groups.\n        // if active group just exits.\n        this.targets = [];\n\n        if (\n          aObjects.length > 1 &&\n          !skipGroup &&\n          activeObject === this._searchPossibleTargets([activeObject], pointer)\n        ) {\n          return activeObject;\n        }\n        // if we hit the corner of an activeObject, let's return that.\n        if (\n          aObjects.length === 1 &&\n          activeObject._findTargetCorner(pointer, isTouch)\n        ) {\n          return activeObject;\n        }\n        if (\n          aObjects.length === 1 &&\n          activeObject === this._searchPossibleTargets([activeObject], pointer)\n        ) {\n          if (!this.preserveObjectStacking) {\n            return activeObject;\n          } else {\n            activeTarget = activeObject;\n            activeTargetSubs = this.targets;\n            this.targets = [];\n          }\n        }\n        var target = this._searchPossibleTargets(this._objects, pointer);\n        if (\n          e[this.altSelectionKey] &&\n          target &&\n          activeTarget &&\n          target !== activeTarget\n        ) {\n          target = activeTarget;\n          this.targets = activeTargetSubs;\n        }\n        return target;\n      },\n\n      /**\n       * Checks point is inside the object.\n       * @param {Object} [pointer] x,y object of point coordinates we want to check.\n       * @param {fabric.Object} obj Object to test against\n       * @param {Object} [globalPointer] x,y object of point coordinates relative to canvas used to search per pixel target.\n       * @return {Boolean} true if point is contained within an area of given object\n       * @private\n       */\n      _checkTarget: function (pointer, obj, globalPointer) {\n        if (\n          obj &&\n          obj.visible &&\n          obj.evented &&\n          this.containsPoint(null, obj, pointer)\n        ) {\n          if (\n            (this.perPixelTargetFind || obj.perPixelTargetFind) &&\n            !obj.isEditing\n          ) {\n            var isTransparent = this.isTargetTransparent(\n              obj,\n              globalPointer.x,\n              globalPointer.y\n            );\n            if (!isTransparent) {\n              return true;\n            }\n          } else {\n            return true;\n          }\n        }\n      },\n\n      /**\n       * Function used to search inside objects an object that contains pointer in bounding box or that contains pointerOnCanvas when painted\n       * @param {Array} [objects] objects array to look into\n       * @param {Object} [pointer] x,y object of point coordinates we want to check.\n       * @return {fabric.Object} object that contains pointer\n       * @private\n       */\n      _searchPossibleTargets: function (objects, pointer) {\n        // Cache all targets where their bounding box contains point.\n        var target,\n          i = objects.length,\n          subTarget;\n        // Do not check for currently grouped objects, since we check the parent group itself.\n        // until we call this function specifically to search inside the activeGroup\n        while (i--) {\n          var objToCheck = objects[i];\n          var pointerToUse =\n            objToCheck.group && objToCheck.group.type !== \"activeSelection\"\n              ? this._normalizePointer(objToCheck.group, pointer)\n              : pointer;\n          if (this._checkTarget(pointerToUse, objToCheck, pointer)) {\n            target = objects[i];\n            if (target.subTargetCheck && target instanceof fabric.Group) {\n              subTarget = this._searchPossibleTargets(target._objects, pointer);\n              subTarget && this.targets.push(subTarget);\n            }\n            break;\n          }\n        }\n        return target;\n      },\n\n      /**\n       * Returns pointer coordinates without the effect of the viewport\n       * @param {Object} pointer with \"x\" and \"y\" number values\n       * @return {Object} object with \"x\" and \"y\" number values\n       */\n      restorePointerVpt: function (pointer) {\n        return fabric.util.transformPoint(\n          pointer,\n          fabric.util.invertTransform(this.viewportTransform)\n        );\n      },\n\n      /**\n       * Returns pointer coordinates relative to canvas.\n       * Can return coordinates with or without viewportTransform.\n       * ignoreZoom false gives back coordinates that represent\n       * the point clicked on canvas element.\n       * ignoreZoom true gives back coordinates after being processed\n       * by the viewportTransform ( sort of coordinates of what is displayed\n       * on the canvas where you are clicking.\n       * ignoreZoom true = HTMLElement coordinates relative to top,left\n       * ignoreZoom false, default = fabric space coordinates, the same used for shape position\n       * To interact with your shapes top and left you want to use ignoreZoom true\n       * most of the time, while ignoreZoom false will give you coordinates\n       * compatible with the object.oCoords system.\n       * of the time.\n       * @param {Event} e\n       * @param {Boolean} ignoreZoom\n       * @return {Object} object with \"x\" and \"y\" number values\n       */\n      getPointer: function (e, ignoreZoom) {\n        // return cached values if we are in the event processing chain\n        if (this._absolutePointer && !ignoreZoom) {\n          return this._absolutePointer;\n        }\n        if (this._pointer && ignoreZoom) {\n          return this._pointer;\n        }\n\n        var pointer = getPointer(e),\n          upperCanvasEl = this.upperCanvasEl,\n          bounds = upperCanvasEl.getBoundingClientRect(),\n          boundsWidth = bounds.width || 0,\n          boundsHeight = bounds.height || 0,\n          cssScale;\n\n        if (!boundsWidth || !boundsHeight) {\n          if (\"top\" in bounds && \"bottom\" in bounds) {\n            boundsHeight = Math.abs(bounds.top - bounds.bottom);\n          }\n          if (\"right\" in bounds && \"left\" in bounds) {\n            boundsWidth = Math.abs(bounds.right - bounds.left);\n          }\n        }\n\n        this.calcOffset();\n        pointer.x = pointer.x - this._offset.left;\n        pointer.y = pointer.y - this._offset.top;\n        if (!ignoreZoom) {\n          pointer = this.restorePointerVpt(pointer);\n        }\n\n        var retinaScaling = this.getRetinaScaling();\n        if (retinaScaling !== 1) {\n          pointer.x /= retinaScaling;\n          pointer.y /= retinaScaling;\n        }\n\n        if (boundsWidth === 0 || boundsHeight === 0) {\n          // If bounds are not available (i.e. not visible), do not apply scale.\n          cssScale = { width: 1, height: 1 };\n        } else {\n          cssScale = {\n            width: upperCanvasEl.width / boundsWidth,\n            height: upperCanvasEl.height / boundsHeight,\n          };\n        }\n\n        return {\n          x: pointer.x * cssScale.width,\n          y: pointer.y * cssScale.height,\n        };\n      },\n\n      /**\n       * @private\n       * @throws {CANVAS_INIT_ERROR} If canvas can not be initialized\n       */\n      _createUpperCanvas: function () {\n        var lowerCanvasClass = this.lowerCanvasEl.className.replace(\n            /\\s*lower-canvas\\s*/,\n            \"\"\n          ),\n          lowerCanvasEl = this.lowerCanvasEl,\n          upperCanvasEl = this.upperCanvasEl;\n\n        // there is no need to create a new upperCanvas element if we have already one.\n        if (upperCanvasEl) {\n          upperCanvasEl.className = \"\";\n        } else {\n          upperCanvasEl = this._createCanvasElement();\n          this.upperCanvasEl = upperCanvasEl;\n        }\n        fabric.util.addClass(upperCanvasEl, \"upper-canvas \" + lowerCanvasClass);\n\n        this.wrapperEl.appendChild(upperCanvasEl);\n\n        this._copyCanvasStyle(lowerCanvasEl, upperCanvasEl);\n        this._applyCanvasStyle(upperCanvasEl);\n        this.contextTop = upperCanvasEl.getContext(\"2d\");\n      },\n\n      /**\n       * @private\n       */\n      _createCacheCanvas: function () {\n        this.cacheCanvasEl = this._createCanvasElement();\n        this.cacheCanvasEl.setAttribute(\"width\", this.width);\n        this.cacheCanvasEl.setAttribute(\"height\", this.height);\n        this.contextCache = this.cacheCanvasEl.getContext(\"2d\");\n      },\n\n      /**\n       * @private\n       */\n      _initWrapperElement: function () {\n        this.wrapperEl = fabric.util.wrapElement(this.lowerCanvasEl, \"div\", {\n          class: this.containerClass,\n        });\n        fabric.util.setStyle(this.wrapperEl, {\n          width: this.width + \"px\",\n          height: this.height + \"px\",\n          position: \"relative\",\n        });\n        fabric.util.makeElementUnselectable(this.wrapperEl);\n      },\n\n      /**\n       * @private\n       * @param {HTMLElement} element canvas element to apply styles on\n       */\n      _applyCanvasStyle: function (element) {\n        var width = this.width || element.width,\n          height = this.height || element.height;\n\n        fabric.util.setStyle(element, {\n          position: \"absolute\",\n          width: width + \"px\",\n          height: height + \"px\",\n          left: 0,\n          top: 0,\n          \"touch-action\": this.allowTouchScrolling ? \"manipulation\" : \"none\",\n          \"-ms-touch-action\": this.allowTouchScrolling\n            ? \"manipulation\"\n            : \"none\",\n        });\n        element.width = width;\n        element.height = height;\n        fabric.util.makeElementUnselectable(element);\n      },\n\n      /**\n       * Copy the entire inline style from one element (fromEl) to another (toEl)\n       * @private\n       * @param {Element} fromEl Element style is copied from\n       * @param {Element} toEl Element copied style is applied to\n       */\n      _copyCanvasStyle: function (fromEl, toEl) {\n        toEl.style.cssText = fromEl.style.cssText;\n      },\n\n      /**\n       * Returns context of canvas where object selection is drawn\n       * @return {CanvasRenderingContext2D}\n       */\n      getSelectionContext: function () {\n        return this.contextTop;\n      },\n\n      /**\n       * Returns &lt;canvas> element on which object selection is drawn\n       * @return {HTMLCanvasElement}\n       */\n      getSelectionElement: function () {\n        return this.upperCanvasEl;\n      },\n\n      /**\n       * Returns currently active object\n       * @return {fabric.Object} active object\n       */\n      getActiveObject: function () {\n        return this._activeObject;\n      },\n\n      /**\n       * Returns an array with the current selected objects\n       * @return {fabric.Object} active object\n       */\n      getActiveObjects: function () {\n        var active = this._activeObject;\n        if (active) {\n          if (active.type === \"activeSelection\" && active._objects) {\n            return active._objects.slice(0);\n          } else {\n            return [active];\n          }\n        }\n        return [];\n      },\n\n      /**\n       * @private\n       * @param {fabric.Object} obj Object that was removed\n       */\n      _onObjectRemoved: function (obj) {\n        // removing active object should fire \"selection:cleared\" events\n        if (obj === this._activeObject) {\n          this.fire(\"before:selection:cleared\", { target: obj });\n          this._discardActiveObject();\n          this.fire(\"selection:cleared\", { target: obj });\n          obj.fire(\"deselected\");\n        }\n        if (obj === this._hoveredTarget) {\n          this._hoveredTarget = null;\n          this._hoveredTargets = [];\n        }\n        this.callSuper(\"_onObjectRemoved\", obj);\n      },\n\n      /**\n       * @private\n       * Compares the old activeObject with the current one and fires correct events\n       * @param {fabric.Object} obj old activeObject\n       */\n      _fireSelectionEvents: function (oldObjects, e) {\n        var somethingChanged = false,\n          objects = this.getActiveObjects(),\n          added = [],\n          removed = [],\n          opt = { e: e };\n        oldObjects.forEach(function (oldObject) {\n          if (objects.indexOf(oldObject) === -1) {\n            somethingChanged = true;\n            oldObject.fire(\"deselected\", opt);\n            removed.push(oldObject);\n          }\n        });\n        objects.forEach(function (object) {\n          if (oldObjects.indexOf(object) === -1) {\n            somethingChanged = true;\n            object.fire(\"selected\", opt);\n            added.push(object);\n          }\n        });\n        if (oldObjects.length > 0 && objects.length > 0) {\n          opt.selected = added;\n          opt.deselected = removed;\n          // added for backward compatibility\n          opt.updated = added[0] || removed[0];\n          opt.target = this._activeObject;\n          somethingChanged && this.fire(\"selection:updated\", opt);\n        } else if (objects.length > 0) {\n          opt.selected = added;\n          // added for backward compatibility\n          opt.target = this._activeObject;\n          this.fire(\"selection:created\", opt);\n        } else if (oldObjects.length > 0) {\n          opt.deselected = removed;\n          this.fire(\"selection:cleared\", opt);\n        }\n      },\n\n      /**\n       * Sets given object as the only active object on canvas\n       * @param {fabric.Object} object Object to set as an active one\n       * @param {Event} [e] Event (passed along when firing \"object:selected\")\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      setActiveObject: function (object, e) {\n        var currentActives = this.getActiveObjects();\n        this._setActiveObject(object, e);\n        this._fireSelectionEvents(currentActives, e);\n        return this;\n      },\n\n      /**\n       * @private\n       * @param {Object} object to set as active\n       * @param {Event} [e] Event (passed along when firing \"object:selected\")\n       * @return {Boolean} true if the selection happened\n       */\n      _setActiveObject: function (object, e) {\n        if (this._activeObject === object) {\n          return false;\n        }\n        if (!this._discardActiveObject(e, object)) {\n          return false;\n        }\n        if (object.onSelect({ e: e })) {\n          return false;\n        }\n        this._activeObject = object;\n        return true;\n      },\n\n      /**\n       * @private\n       */\n      _discardActiveObject: function (e, object) {\n        var obj = this._activeObject;\n        if (obj) {\n          // onDeselect return TRUE to cancel selection;\n          if (obj.onDeselect({ e: e, object: object })) {\n            return false;\n          }\n          this._activeObject = null;\n        }\n        return true;\n      },\n\n      /**\n       * Discards currently active object and fire events. If the function is called by fabric\n       * as a consequence of a mouse event, the event is passed as a parameter and\n       * sent to the fire function for the custom events. When used as a method the\n       * e param does not have any application.\n       * @param {event} e\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      discardActiveObject: function (e) {\n        var currentActives = this.getActiveObjects(),\n          activeObject = this.getActiveObject();\n        if (currentActives.length) {\n          this.fire(\"before:selection:cleared\", { target: activeObject, e: e });\n        }\n        this._discardActiveObject(e);\n        this._fireSelectionEvents(currentActives, e);\n        return this;\n      },\n\n      /**\n       * Clears a canvas element and removes all event listeners\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      dispose: function () {\n        var wrapper = this.wrapperEl;\n        this.removeListeners();\n        wrapper.removeChild(this.upperCanvasEl);\n        wrapper.removeChild(this.lowerCanvasEl);\n        this.contextCache = null;\n        this.contextTop = null;\n        [\"upperCanvasEl\", \"cacheCanvasEl\"].forEach(\n          function (element) {\n            fabric.util.cleanUpJsdomNode(this[element]);\n            this[element] = undefined;\n          }.bind(this)\n        );\n        if (wrapper.parentNode) {\n          wrapper.parentNode.replaceChild(this.lowerCanvasEl, this.wrapperEl);\n        }\n        delete this.wrapperEl;\n        fabric.StaticCanvas.prototype.dispose.call(this);\n        return this;\n      },\n\n      /**\n       * Clears all contexts (background, main, top) of an instance\n       * @return {fabric.Canvas} thisArg\n       * @chainable\n       */\n      clear: function () {\n        // this.discardActiveGroup();\n        this.discardActiveObject();\n        this.clearContext(this.contextTop);\n        return this.callSuper(\"clear\");\n      },\n\n      /**\n       * Draws objects' controls (borders/controls)\n       * @param {CanvasRenderingContext2D} ctx Context to render controls on\n       */\n      drawControls: function (ctx) {\n        var activeObject = this._activeObject;\n\n        if (activeObject) {\n          activeObject._renderControls(ctx);\n        }\n      },\n\n      /**\n       * @private\n       */\n      _toObject: function (instance, methodName, propertiesToInclude) {\n        //If the object is part of the current selection group, it should\n        //be transformed appropriately\n        //i.e. it should be serialised as it would appear if the selection group\n        //were to be destroyed.\n        var originalProperties = this._realizeGroupTransformOnObject(instance),\n          object = this.callSuper(\n            \"_toObject\",\n            instance,\n            methodName,\n            propertiesToInclude\n          );\n        //Undo the damage we did by changing all of its properties\n        this._unwindGroupTransformOnObject(instance, originalProperties);\n        return object;\n      },\n\n      /**\n       * Realises an object's group transformation on it\n       * @private\n       * @param {fabric.Object} [instance] the object to transform (gets mutated)\n       * @returns the original values of instance which were changed\n       */\n      _realizeGroupTransformOnObject: function (instance) {\n        if (\n          instance.group &&\n          instance.group.type === \"activeSelection\" &&\n          this._activeObject === instance.group\n        ) {\n          var layoutProps = [\n            \"angle\",\n            \"flipX\",\n            \"flipY\",\n            \"left\",\n            \"scaleX\",\n            \"scaleY\",\n            \"skewX\",\n            \"skewY\",\n            \"top\",\n          ];\n          //Copy all the positionally relevant properties across now\n          var originalValues = {};\n          layoutProps.forEach(function (prop) {\n            originalValues[prop] = instance[prop];\n          });\n          this._activeObject.realizeTransform(instance);\n          return originalValues;\n        } else {\n          return null;\n        }\n      },\n\n      /**\n       * Restores the changed properties of instance\n       * @private\n       * @param {fabric.Object} [instance] the object to un-transform (gets mutated)\n       * @param {Object} [originalValues] the original values of instance, as returned by _realizeGroupTransformOnObject\n       */\n      _unwindGroupTransformOnObject: function (instance, originalValues) {\n        if (originalValues) {\n          instance.set(originalValues);\n        }\n      },\n\n      /**\n       * @private\n       */\n      _setSVGObject: function (markup, instance, reviver) {\n        //If the object is in a selection group, simulate what would happen to that\n        //object when the group is deselected\n        var originalProperties = this._realizeGroupTransformOnObject(instance);\n        this.callSuper(\"_setSVGObject\", markup, instance, reviver);\n        this._unwindGroupTransformOnObject(instance, originalProperties);\n      },\n\n      setViewportTransform: function (vpt) {\n        if (\n          this.renderOnAddRemove &&\n          this._activeObject &&\n          this._activeObject.isEditing\n        ) {\n          this._activeObject.clearContextTop();\n        }\n        fabric.StaticCanvas.prototype.setViewportTransform.call(this, vpt);\n      },\n    }\n  );\n\n  // copying static properties manually to work around Opera's bug,\n  // where \"prototype\" property is enumerable and overrides existing prototype\n  for (var prop in fabric.StaticCanvas) {\n    if (prop !== \"prototype\") {\n      fabric.Canvas[prop] = fabric.StaticCanvas[prop];\n    }\n  }\n})();\n\n(function () {\n  var addListener = fabric.util.addListener,\n    removeListener = fabric.util.removeListener,\n    RIGHT_CLICK = 3,\n    MIDDLE_CLICK = 2,\n    LEFT_CLICK = 1,\n    addEventOptions = { passive: false };\n\n  function checkClick(e, value) {\n    return e.button && e.button === value - 1;\n  }\n\n  fabric.util.object.extend(\n    fabric.Canvas.prototype,\n    /** @lends fabric.Canvas.prototype */ {\n      /**\n       * Contains the id of the touch event that owns the fabric transform\n       * @type Number\n       * @private\n       */\n      mainTouchId: null,\n\n      /**\n       * Adds mouse listeners to canvas\n       * @private\n       */\n      _initEventListeners: function () {\n        var eventMapping = {};\n        if (window.PointerEvent) {\n          // IE11 and other W3C Pointer Event implementations (see http://www.w3.org/TR/pointerevents)\n          eventMapping = {\n            down: \"pointerdown\",\n            up: \"pointerup\",\n            enter: \"pointerenter\",\n            leave: \"pointerleave\",\n            over: \"pointerover\",\n            out: \"pointerout\",\n            move: \"pointermove\",\n          };\n        } else if (window.MSPointerEvent && window.navigator.msPointerEnabled) {\n          // IE10\n          eventMapping = {\n            down: \"MSPointerDown\",\n            up: \"MSPointerUp\",\n            enter: \"MSPointerEnter\",\n            leave: \"MSPointerLeave\",\n            over: \"MSPointerOver\",\n            out: \"MSPointerOut\",\n            move: \"MSPointerMove\",\n          };\n        } else {\n          // Legacy W3C mouse events\n          eventMapping = {\n            down: \"mousedown\",\n            up: \"mouseup\",\n            enter: \"mouseover\",\n            leave: \"mouseout\",\n            over: \"mouseover\",\n            out: \"mouseout\",\n            move: \"mousemove\",\n          };\n          /*if ( $.Browser.vendor === $.BROWSERS.IE && $.Browser.version < 9 ) {\n                    eventMapping.enter = 'mouseenter';\n                    eventMapping.leave = ' mouseleave';\n                }*/\n        }\n\n        fabric.eventMapping = eventMapping;\n        // in case we initialized the class twice. This should not happen normally\n        // but in some kind of applications where the canvas element may be changed\n        // this is a workaround to having double listeners.\n        this.removeListeners();\n        this._bindEvents();\n        this.addOrRemove(addListener, \"add\");\n      },\n\n      /**\n       * return an event prefix pointer or mouse.\n       * adapted\n       * @private\n       */\n      _getEventPrefix: function () {\n        return this.enablePointerEvents ? \"pointer\" : \"mouse\";\n      },\n\n      addOrRemove: function (functor, eventjsFunctor) {\n        var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n        functor(fabric.window, \"resize\", this._onResize);\n\n        functor(canvasElement, fabric.eventMapping.down, this._onMouseDown);\n        functor(\n          canvasElement,\n          fabric.eventMapping.move,\n          this._onMouseMove,\n          addEventOptions\n        );\n        functor(canvasElement, fabric.eventMapping.out, this._onMouseOut);\n        functor(canvasElement, fabric.eventMapping.enter, this._onMouseEnter);\n\n        functor(canvasElement, \"wheel\", this._onMouseWheel);\n        functor(canvasElement, \"contextmenu\", this._onContextMenu);\n        functor(canvasElement, \"dblclick\", this._onDoubleClick);\n        functor(canvasElement, \"dragover\", this._onDragOver);\n        functor(canvasElement, \"dragenter\", this._onDragEnter);\n        functor(canvasElement, \"dragleave\", this._onDragLeave);\n        functor(canvasElement, \"drop\", this._onDrop);\n        if (!this.enablePointerEvents) {\n          functor(\n            canvasElement,\n            \"touchstart\",\n            this._onTouchStart,\n            addEventOptions\n          );\n        }\n        if (typeof eventjs !== \"undefined\" && eventjsFunctor in eventjs) {\n          eventjs[eventjsFunctor](canvasElement, \"gesture\", this._onGesture);\n          eventjs[eventjsFunctor](canvasElement, \"drag\", this._onDrag);\n          eventjs[eventjsFunctor](\n            canvasElement,\n            \"orientation\",\n            this._onOrientationChange\n          );\n          eventjs[eventjsFunctor](canvasElement, \"shake\", this._onShake);\n          eventjs[eventjsFunctor](\n            canvasElement,\n            \"longpress\",\n            this._onLongPress\n          );\n        }\n      },\n\n      /**\n       * Removes all event listeners\n       * adapted\n       */\n      removeListeners: function () {\n        this.addOrRemove(removeListener, \"remove\");\n        // if you dispose on a mouseDown, before mouse up, you need to clean document to...\n        var eventTypePrefix = this._getEventPrefix();\n        removeListener(\n          fabric.document,\n          fabric.eventMapping.up,\n          this._onMouseUp\n        );\n        removeListener(\n          fabric.document,\n          \"touchend\",\n          this._onTouchEnd,\n          addEventOptions\n        );\n        removeListener(\n          fabric.document,\n          fabric.eventMapping.move,\n          this._onMouseMove,\n          addEventOptions\n        );\n        removeListener(\n          fabric.document,\n          \"touchmove\",\n          this._onMouseMove,\n          addEventOptions\n        );\n      },\n\n      /**\n       * @private\n       */\n      _bindEvents: function () {\n        if (this.eventsBound) {\n          // for any reason we pass here twice we do not want to bind events twice.\n          return;\n        }\n        this._onMouseDown = this._onMouseDown.bind(this);\n        this._onTouchStart = this._onTouchStart.bind(this);\n        this._onMouseMove = this._onMouseMove.bind(this);\n        this._onMouseUp = this._onMouseUp.bind(this);\n        this._onTouchEnd = this._onTouchEnd.bind(this);\n        this._onResize = this._onResize.bind(this);\n        this._onGesture = this._onGesture.bind(this);\n        this._onDrag = this._onDrag.bind(this);\n        this._onShake = this._onShake.bind(this);\n        this._onLongPress = this._onLongPress.bind(this);\n        this._onOrientationChange = this._onOrientationChange.bind(this);\n        this._onMouseWheel = this._onMouseWheel.bind(this);\n        this._onMouseOut = this._onMouseOut.bind(this);\n        this._onMouseEnter = this._onMouseEnter.bind(this);\n        this._onContextMenu = this._onContextMenu.bind(this);\n        this._onDoubleClick = this._onDoubleClick.bind(this);\n        this._onDragOver = this._onDragOver.bind(this);\n        this._onDragEnter = this._simpleEventHandler.bind(this, \"dragenter\");\n        this._onDragLeave = this._simpleEventHandler.bind(this, \"dragleave\");\n        this._onDrop = this._simpleEventHandler.bind(this, \"drop\");\n        this.eventsBound = true;\n      },\n\n      /**\n       * @private\n       * @param {Event} [e] Event object fired on Event.js gesture\n       * @param {Event} [self] Inner Event object\n       */\n      _onGesture: function (e, self) {\n        this.__onTransformGesture && this.__onTransformGesture(e, self);\n      },\n\n      /**\n       * @private\n       * @param {Event} [e] Event object fired on Event.js drag\n       * @param {Event} [self] Inner Event object\n       */\n      _onDrag: function (e, self) {\n        this.__onDrag && this.__onDrag(e, self);\n      },\n\n      /**\n       * @private\n       * @param {Event} [e] Event object fired on wheel event\n       */\n      _onMouseWheel: function (e) {\n        this.__onMouseWheel(e);\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       * adapted\n       */\n      _onMouseOut: function (e) {\n        var target = this._hoveredTarget;\n        this.fire(\"mouse:out\", { target: target, e: e });\n        this._hoveredTarget = null;\n        target && target.fire(fabric.eventMapping.out, { e: e });\n\n        var _this = this;\n        this._hoveredTargets.forEach(function (_target) {\n          _this.fire(\"mouse:out\", { target: target, e: e });\n          _target && target.fire(fabric.eventMapping.out, { e: e });\n        });\n        this._hoveredTargets = [];\n\n        if (this._iTextInstances) {\n          this._iTextInstances.forEach(function (obj) {\n            if (obj.isEditing) {\n              obj.hiddenTextarea.focus();\n            }\n          });\n        }\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object fired on mouseenter\n       */\n      _onMouseEnter: function (e) {\n        // This find target and consequent 'mouse:over' is used to\n        // clear old instances on hovered target.\n        // calling findTarget has the side effect of killing target.__corner.\n        // as a short term fix we are not firing this if we are currently transforming.\n        // as a long term fix we need to separate the action of finding a target with the\n        // side effects we added to it.\n        if (!this.currentTransform && !this.findTarget(e)) {\n          this.fire(\"mouse:over\", { target: null, e: e });\n          this._hoveredTarget = null;\n          this._hoveredTargets = [];\n        }\n      },\n\n      /**\n       * @private\n       * @param {Event} [e] Event object fired on Event.js orientation change\n       * @param {Event} [self] Inner Event object\n       */\n      _onOrientationChange: function (e, self) {\n        this.__onOrientationChange && this.__onOrientationChange(e, self);\n      },\n\n      /**\n       * @private\n       * @param {Event} [e] Event object fired on Event.js shake\n       * @param {Event} [self] Inner Event object\n       */\n      _onShake: function (e, self) {\n        this.__onShake && this.__onShake(e, self);\n      },\n\n      /**\n       * @private\n       * @param {Event} [e] Event object fired on Event.js shake\n       * @param {Event} [self] Inner Event object\n       */\n      _onLongPress: function (e, self) {\n        this.__onLongPress && this.__onLongPress(e, self);\n      },\n\n      /**\n       * prevent default to allow drop event to be fired\n       * @private\n       * @param {Event} [e] Event object fired on Event.js shake\n       */\n      _onDragOver: function (e) {\n        e.preventDefault();\n        var target = this._simpleEventHandler(\"dragover\", e);\n        this._fireEnterLeaveEvents(target, e);\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       */\n      _onContextMenu: function (e) {\n        if (this.stopContextMenu) {\n          e.stopPropagation();\n          e.preventDefault();\n        }\n        return false;\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       */\n      _onDoubleClick: function (e) {\n        this._cacheTransformEventData(e);\n        this._handleEvent(e, \"dblclick\");\n        this._resetTransformEventData(e);\n      },\n\n      /**\n       * Return a the id of an event.\n       * returns either the pointerId or the identifier or 0 for the mouse event\n       * @private\n       * @param {Event} evt Event object\n       */\n      getPointerId: function (evt) {\n        var changedTouches = evt.changedTouches;\n\n        if (changedTouches) {\n          return changedTouches[0] && changedTouches[0].identifier;\n        }\n\n        if (this.enablePointerEvents) {\n          return evt.pointerId;\n        }\n\n        return -1;\n      },\n\n      /**\n       * Determines if an event has the id of the event that is considered main\n       * @private\n       * @param {evt} event Event object\n       */\n      _isMainEvent: function (evt) {\n        if (evt.isPrimary === true) {\n          return true;\n        }\n        if (evt.isPrimary === false) {\n          return false;\n        }\n        if (evt.type === \"touchend\" && evt.touches.length === 0) {\n          return true;\n        }\n        if (evt.changedTouches) {\n          return evt.changedTouches[0].identifier === this.mainTouchId;\n        }\n        return true;\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       */\n      _onTouchStart: function (e) {\n        e.preventDefault();\n        if (this.mainTouchId === null) {\n          this.mainTouchId = this.getPointerId(e);\n        }\n        this.__onMouseDown(e);\n        this._resetTransformEventData();\n        var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n        addListener(\n          fabric.document,\n          \"touchend\",\n          this._onTouchEnd,\n          addEventOptions\n        );\n        addListener(\n          fabric.document,\n          \"touchmove\",\n          this._onMouseMove,\n          addEventOptions\n        );\n        // Unbind mousedown to prevent double triggers from touch devices\n        removeListener(\n          canvasElement,\n          eventTypePrefix + \"down\",\n          this._onMouseDown\n        );\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       * adapted\n       */\n      _onMouseDown: function (e) {\n        this.__onMouseDown(e);\n        this._resetTransformEventData();\n        var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n        removeListener(\n          canvasElement,\n          fabric.eventMapping.move,\n          this._onMouseMove,\n          addEventOptions\n        );\n        addListener(fabric.document, fabric.eventMapping.up, this._onMouseUp);\n        addListener(\n          fabric.document,\n          fabric.eventMapping.move,\n          this._onMouseMove,\n          addEventOptions\n        );\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       * adapted\n       */\n      _onTouchEnd: function (e) {\n        if (e.touches.length > 0) {\n          // if there are still touches stop here\n          return;\n        }\n        this.__onMouseUp(e);\n        this._resetTransformEventData();\n        this.mainTouchId = null;\n        var eventTypePrefix = this._getEventPrefix();\n        removeListener(\n          fabric.document,\n          \"touchend\",\n          this._onTouchEnd,\n          addEventOptions\n        );\n        removeListener(\n          fabric.document,\n          \"touchmove\",\n          this._onMouseMove,\n          addEventOptions\n        );\n        var _this = this;\n        if (this._willAddMouseDown) {\n          clearTimeout(this._willAddMouseDown);\n        }\n        this._willAddMouseDown = setTimeout(function () {\n          // Wait 400ms before rebinding mousedown to prevent double triggers\n          // from touch devices\n          addListener(\n            _this.upperCanvasEl,\n            fabric.eventMapping.down,\n            _this._onMouseDown\n          );\n          _this._willAddMouseDown = 0;\n        }, 400);\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object fired on mouseup\n       * adapted\n       */\n      _onMouseUp: function (e) {\n        this.__onMouseUp(e);\n        this._resetTransformEventData();\n        var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n        if (this._isMainEvent(e)) {\n          removeListener(\n            fabric.document,\n            fabric.eventMapping.up,\n            this._onMouseUp\n          );\n          removeListener(\n            fabric.document,\n            fabric.eventMapping.move,\n            this._onMouseMove,\n            addEventOptions\n          );\n          addListener(\n            canvasElement,\n            fabric.eventMapping.move,\n            this._onMouseMove,\n            addEventOptions\n          );\n        }\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object fired on mousemove\n       */\n      _onMouseMove: function (e) {\n        !this.allowTouchScrolling && e.preventDefault && e.preventDefault();\n        this.__onMouseMove(e);\n      },\n\n      /**\n       * @private\n       */\n      _onResize: function () {\n        this.calcOffset();\n      },\n\n      /**\n       * Decides whether the canvas should be redrawn in mouseup and mousedown events.\n       * @private\n       * @param {Object} target\n       */\n      _shouldRender: function (target) {\n        var activeObject = this._activeObject;\n\n        if (\n          !!activeObject !== !!target ||\n          (activeObject && target && activeObject !== target)\n        ) {\n          // this covers: switch of target, from target to no target, selection of target\n          // multiSelection with key and mouse\n          return true;\n        } else if (activeObject && activeObject.isEditing) {\n          // if we mouse up/down over a editing textbox a cursor change,\n          // there is no need to re render\n          return false;\n        }\n        return false;\n      },\n\n      /**\n       * Method that defines the actions when mouse is released on canvas.\n       * The method resets the currentTransform parameters, store the image corner\n       * position in the image object and render the canvas on top.\n       * @private\n       * @param {Event} e Event object fired on mouseup\n       */\n      __onMouseUp: function (e) {\n        var target,\n          transform = this._currentTransform,\n          groupSelector = this._groupSelector,\n          shouldRender = false,\n          isClick =\n            !groupSelector ||\n            (groupSelector.left === 0 && groupSelector.top === 0);\n        this._cacheTransformEventData(e);\n        target = this._target;\n        this._handleEvent(e, \"up:before\");\n        // if right/middle click just fire events and return\n        // target undefined will make the _handleEvent search the target\n        if (checkClick(e, RIGHT_CLICK)) {\n          if (this.fireRightClick) {\n            this._handleEvent(e, \"up\", RIGHT_CLICK, isClick);\n          }\n          return;\n        }\n\n        if (checkClick(e, MIDDLE_CLICK)) {\n          if (this.fireMiddleClick) {\n            this._handleEvent(e, \"up\", MIDDLE_CLICK, isClick);\n          }\n          this._resetTransformEventData();\n          return;\n        }\n\n        if (this.isDrawingMode && this._isCurrentlyDrawing) {\n          this._onMouseUpInDrawingMode(e);\n          return;\n        }\n\n        if (!this._isMainEvent(e)) {\n          return;\n        }\n        if (transform) {\n          this._finalizeCurrentTransform(e);\n          shouldRender = transform.actionPerformed;\n        }\n        if (!isClick) {\n          var targetWasActive = target === this._activeObject;\n          this._maybeGroupObjects(e);\n          if (!shouldRender) {\n            shouldRender =\n              this._shouldRender(target) ||\n              (!targetWasActive && target === this._activeObject);\n          }\n        }\n        if (target) {\n          var corner = target._findTargetCorner(\n            this.getPointer(e, true),\n            fabric.util.isTouchEvent(e)\n          );\n          var control = target.controls[corner],\n            mouseUpHandler =\n              control && control.getMouseUpHandler(e, target, control);\n          if (mouseUpHandler) {\n            mouseUpHandler(e, target, control);\n          }\n          target.isMoving = false;\n        }\n        this._setCursorFromEvent(e, target);\n        this._handleEvent(e, \"up\", LEFT_CLICK, isClick);\n        this._groupSelector = null;\n        this._currentTransform = null;\n        // reset the target information about which corner is selected\n        target && (target.__corner = 0);\n        if (shouldRender) {\n          this.requestRenderAll();\n        } else if (!isClick) {\n          this.renderTop();\n        }\n      },\n\n      /**\n       * @private\n       * Handle event firing for target and subtargets\n       * @param {Event} e event from mouse\n       * @param {String} eventType event to fire (up, down or move)\n       * @return {Fabric.Object} target return the the target found, for internal reasons.\n       */\n      _simpleEventHandler: function (eventType, e) {\n        var target = this.findTarget(e),\n          targets = this.targets,\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n          };\n        this.fire(eventType, options);\n        target && target.fire(eventType, options);\n        if (!targets) {\n          return target;\n        }\n        for (var i = 0; i < targets.length; i++) {\n          targets[i].fire(eventType, options);\n        }\n        return target;\n      },\n\n      /**\n       * @private\n       * Handle event firing for target and subtargets\n       * @param {Event} e event from mouse\n       * @param {String} eventType event to fire (up, down or move)\n       * @param {fabric.Object} targetObj receiving event\n       * @param {Number} [button] button used in the event 1 = left, 2 = middle, 3 = right\n       * @param {Boolean} isClick for left button only, indicates that the mouse up happened without move.\n       */\n      _handleEvent: function (e, eventType, button, isClick) {\n        var target = this._target,\n          targets = this.targets || [],\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n            button: button || LEFT_CLICK,\n            isClick: isClick || false,\n            pointer: this._pointer,\n            absolutePointer: this._absolutePointer,\n            transform: this._currentTransform,\n          };\n        this.fire(\"mouse:\" + eventType, options);\n        target && target.fire(\"mouse\" + eventType, options);\n        for (var i = 0; i < targets.length; i++) {\n          targets[i].fire(\"mouse\" + eventType, options);\n        }\n      },\n\n      /**\n       * @private\n       * @param {Event} e send the mouse event that generate the finalize down, so it can be used in the event\n       */\n      _finalizeCurrentTransform: function (e) {\n        var transform = this._currentTransform,\n          target = transform.target,\n          eventName,\n          options = {\n            e: e,\n            target: target,\n            transform: transform,\n          };\n\n        if (target._scaling) {\n          target._scaling = false;\n        }\n\n        target.setCoords();\n\n        if (\n          transform.actionPerformed ||\n          (this.stateful && target.hasStateChanged())\n        ) {\n          if (transform.actionPerformed) {\n            eventName = this._addEventOptions(options, transform);\n            this._fire(eventName, options);\n          }\n          this._fire(\"modified\", options);\n        }\n      },\n\n      /**\n       * Mutate option object in order to add by property and give back the event name.\n       * @private\n       * @param {Object} options to mutate\n       * @param {Object} transform to inspect action from\n       */\n      _addEventOptions: function (options, transform) {\n        // we can probably add more details at low cost\n        // scale change, rotation changes, translation changes\n        var eventName, by;\n        switch (transform.action) {\n          case \"scaleX\":\n            eventName = \"scaled\";\n            by = \"x\";\n            break;\n          case \"scaleY\":\n            eventName = \"scaled\";\n            by = \"y\";\n            break;\n          case \"skewX\":\n            eventName = \"skewed\";\n            by = \"x\";\n            break;\n          case \"skewY\":\n            eventName = \"skewed\";\n            by = \"y\";\n            break;\n          case \"scale\":\n            eventName = \"scaled\";\n            by = \"equally\";\n            break;\n          case \"rotate\":\n            eventName = \"rotated\";\n            break;\n          case \"drag\":\n            eventName = \"moved\";\n            break;\n        }\n        options.by = by;\n        return eventName;\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       */\n      _onMouseDownInDrawingMode: function (e) {\n        this._isCurrentlyDrawing = true;\n        if (this.getActiveObject()) {\n          this.discardActiveObject(e).requestRenderAll();\n        }\n        var pointer = this.getPointer(e);\n        this.freeDrawingBrush.onMouseDown(pointer, { e: e, pointer: pointer });\n        this._handleEvent(e, \"down\");\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object fired on mousemove\n       */\n      _onMouseMoveInDrawingMode: function (e) {\n        if (this._isCurrentlyDrawing) {\n          var pointer = this.getPointer(e);\n          this.freeDrawingBrush.onMouseMove(pointer, {\n            e: e,\n            pointer: pointer,\n          });\n        }\n        this.setCursor(this.freeDrawingCursor);\n        this._handleEvent(e, \"move\");\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object fired on mouseup\n       */\n      _onMouseUpInDrawingMode: function (e) {\n        var pointer = this.getPointer(e);\n        this._isCurrentlyDrawing = this.freeDrawingBrush.onMouseUp({\n          e: e,\n          pointer: pointer,\n        });\n        this._handleEvent(e, \"up\");\n      },\n\n      /**\n       * Method that defines the actions when mouse is clicked on canvas.\n       * The method inits the currentTransform parameters and renders all the\n       * canvas so the current image can be placed on the top canvas and the rest\n       * in on the container one.\n       * @private\n       * @param {Event} e Event object fired on mousedown\n       */\n      __onMouseDown: function (e) {\n        this._cacheTransformEventData(e);\n        this._handleEvent(e, \"down:before\");\n        var target = this._target;\n        // if right click just fire events\n        if (checkClick(e, RIGHT_CLICK)) {\n          if (this.fireRightClick) {\n            this._handleEvent(e, \"down\", RIGHT_CLICK);\n          }\n          return;\n        }\n\n        if (checkClick(e, MIDDLE_CLICK)) {\n          if (this.fireMiddleClick) {\n            this._handleEvent(e, \"down\", MIDDLE_CLICK);\n          }\n          return;\n        }\n\n        if (this.isDrawingMode) {\n          this._onMouseDownInDrawingMode(e);\n          return;\n        }\n\n        if (!this._isMainEvent(e)) {\n          return;\n        }\n\n        // ignore if some object is being transformed at this moment\n        if (this._currentTransform) {\n          return;\n        }\n\n        var pointer = this._pointer;\n        // save pointer for check in __onMouseUp event\n        this._previousPointer = pointer;\n        var shouldRender = this._shouldRender(target),\n          shouldGroup = this._shouldGroup(e, target);\n        if (this._shouldClearSelection(e, target)) {\n          this.discardActiveObject(e);\n        } else if (shouldGroup) {\n          this._handleGrouping(e, target);\n          target = this._activeObject;\n        }\n\n        if (\n          this.selection &&\n          (!target ||\n            (!target.selectable &&\n              !target.isEditing &&\n              target !== this._activeObject))\n        ) {\n          this._groupSelector = {\n            ex: pointer.x,\n            ey: pointer.y,\n            top: 0,\n            left: 0,\n          };\n        }\n\n        if (target) {\n          var alreadySelected = target === this._activeObject;\n          if (target.selectable) {\n            this.setActiveObject(target, e);\n          }\n          var corner = target._findTargetCorner(\n            this.getPointer(e, true),\n            fabric.util.isTouchEvent(e)\n          );\n          target.__corner = corner;\n          if (target === this._activeObject && (corner || !shouldGroup)) {\n            var control = target.controls[corner],\n              mouseDownHandler =\n                control && control.getMouseDownHandler(e, target, control);\n            if (mouseDownHandler) {\n              mouseDownHandler(e, target, control);\n            }\n            this._setupCurrentTransform(e, target, alreadySelected);\n          }\n        }\n        this._handleEvent(e, \"down\");\n        // we must renderAll so that we update the visuals\n        (shouldRender || shouldGroup) && this.requestRenderAll();\n      },\n\n      /**\n       * reset cache form common information needed during event processing\n       * @private\n       */\n      _resetTransformEventData: function () {\n        this._target = null;\n        this._pointer = null;\n        this._absolutePointer = null;\n      },\n\n      /**\n       * Cache common information needed during event processing\n       * @private\n       * @param {Event} e Event object fired on event\n       */\n      _cacheTransformEventData: function (e) {\n        // reset in order to avoid stale caching\n        this._resetTransformEventData();\n        this._pointer = this.getPointer(e, true);\n        this._absolutePointer = this.restorePointerVpt(this._pointer);\n        this._target = this._currentTransform\n          ? this._currentTransform.target\n          : this.findTarget(e) || null;\n      },\n\n      /**\n       * @private\n       */\n      _beforeTransform: function (e) {\n        var t = this._currentTransform;\n        this.stateful && t.target.saveState();\n        this.fire(\"before:transform\", {\n          e: e,\n          transform: t,\n        });\n      },\n\n      /**\n       * Method that defines the actions when mouse is hovering the canvas.\n       * The currentTransform parameter will define whether the user is rotating/scaling/translating\n       * an image or neither of them (only hovering). A group selection is also possible and would cancel\n       * all any other type of action.\n       * In case of an image transformation only the top canvas will be rendered.\n       * @private\n       * @param {Event} e Event object fired on mousemove\n       */\n      __onMouseMove: function (e) {\n        this._handleEvent(e, \"move:before\");\n        this._cacheTransformEventData(e);\n        var target, pointer;\n\n        if (this.isDrawingMode) {\n          this._onMouseMoveInDrawingMode(e);\n          return;\n        }\n\n        if (!this._isMainEvent(e)) {\n          return;\n        }\n\n        var groupSelector = this._groupSelector;\n\n        // We initially clicked in an empty area, so we draw a box for multiple selection\n        if (groupSelector) {\n          pointer = this._pointer;\n\n          groupSelector.left = pointer.x - groupSelector.ex;\n          groupSelector.top = pointer.y - groupSelector.ey;\n\n          this.renderTop();\n        } else if (!this._currentTransform) {\n          target = this.findTarget(e) || null;\n          this._setCursorFromEvent(e, target);\n          this._fireOverOutEvents(target, e);\n        } else {\n          this._transformObject(e);\n        }\n        this._handleEvent(e, \"move\");\n        this._resetTransformEventData();\n      },\n\n      /**\n       * Manage the mouseout, mouseover events for the fabric object on the canvas\n       * @param {Fabric.Object} target the target where the target from the mousemove event\n       * @param {Event} e Event object fired on mousemove\n       * @private\n       * adapted\n       */\n      _fireOverOutEvents: function (target, e) {\n        var _hoveredTarget = this._hoveredTarget,\n          _hoveredTargets = this._hoveredTargets,\n          targets = this.targets,\n          length = Math.max(_hoveredTargets.length, targets.length);\n\n        this.fireSyntheticInOutEvents(target, e, {\n          oldTarget: _hoveredTarget,\n          evtOut: fabric.eventMapping.out,\n          canvasEvtOut: \"mouse:out\",\n          evtIn: \"mouseover\",\n          canvasEvtIn: \"mouse:over\",\n        });\n        for (var i = 0; i < length; i++) {\n          this.fireSyntheticInOutEvents(targets[i], e, {\n            oldTarget: _hoveredTargets[i],\n            evtOut: fabric.eventMapping.out,\n            evtIn: \"mouseover\",\n          });\n        }\n        this._hoveredTarget = target;\n        this._hoveredTargets = this.targets.concat();\n      },\n\n      /**\n       * Manage the dragEnter, dragLeave events for the fabric objects on the canvas\n       * @param {Fabric.Object} target the target where the target from the onDrag event\n       * @param {Event} e Event object fired on ondrag\n       * @private\n       */\n      _fireEnterLeaveEvents: function (target, e) {\n        var _draggedoverTarget = this._draggedoverTarget,\n          _hoveredTargets = this._hoveredTargets,\n          targets = this.targets,\n          length = Math.max(_hoveredTargets.length, targets.length);\n\n        this.fireSyntheticInOutEvents(target, e, {\n          oldTarget: _draggedoverTarget,\n          evtOut: \"dragleave\",\n          evtIn: \"dragenter\",\n        });\n        for (var i = 0; i < length; i++) {\n          this.fireSyntheticInOutEvents(targets[i], e, {\n            oldTarget: _hoveredTargets[i],\n            evtOut: \"dragleave\",\n            evtIn: \"dragenter\",\n          });\n        }\n        this._draggedoverTarget = target;\n      },\n\n      /**\n       * Manage the synthetic in/out events for the fabric objects on the canvas\n       * @param {Fabric.Object} target the target where the target from the supported events\n       * @param {Event} e Event object fired\n       * @param {Object} config configuration for the function to work\n       * @param {String} config.targetName property on the canvas where the old target is stored\n       * @param {String} [config.canvasEvtOut] name of the event to fire at canvas level for out\n       * @param {String} config.evtOut name of the event to fire for out\n       * @param {String} [config.canvasEvtIn] name of the event to fire at canvas level for in\n       * @param {String} config.evtIn name of the event to fire for in\n       * @private\n       */\n      fireSyntheticInOutEvents: function (target, e, config) {\n        var inOpt,\n          outOpt,\n          oldTarget = config.oldTarget,\n          outFires,\n          inFires,\n          targetChanged = oldTarget !== target,\n          canvasEvtIn = config.canvasEvtIn,\n          canvasEvtOut = config.canvasEvtOut;\n        if (targetChanged) {\n          inOpt = { e: e, target: target, previousTarget: oldTarget };\n          outOpt = { e: e, target: oldTarget, nextTarget: target };\n        }\n        inFires = target && targetChanged;\n        outFires = oldTarget && targetChanged;\n        if (outFires) {\n          canvasEvtOut && this.fire(canvasEvtOut, outOpt);\n          oldTarget.fire(config.evtOut, outOpt);\n        }\n        if (inFires) {\n          canvasEvtIn && this.fire(canvasEvtIn, inOpt);\n          target.fire(config.evtIn, inOpt);\n        }\n      },\n\n      /**\n       * Method that defines actions when an Event Mouse Wheel\n       * @param {Event} e Event object fired on mouseup\n       */\n      __onMouseWheel: function (e) {\n        this._cacheTransformEventData(e);\n        this._handleEvent(e, \"wheel\");\n        this._resetTransformEventData();\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event fired on mousemove\n       */\n      _transformObject: function (e) {\n        var pointer = this.getPointer(e),\n          transform = this._currentTransform;\n\n        transform.reset = false;\n        transform.target.isMoving = true;\n        transform.shiftKey = e.shiftKey;\n        transform.altKey = e[this.centeredKey];\n\n        this._performTransformAction(e, transform, pointer);\n        transform.actionPerformed && this.requestRenderAll();\n      },\n\n      /**\n       * @private\n       */\n      _performTransformAction: function (e, transform, pointer) {\n        var x = pointer.x,\n          y = pointer.y,\n          action = transform.action,\n          actionPerformed = false,\n          actionHandler = transform.actionHandler,\n          // this object could be created from the function in the control handlers\n          options = {\n            target: transform.target,\n            e: e,\n            transform: transform,\n            pointer: pointer,\n          };\n\n        if (action === \"drag\") {\n          actionPerformed = this._translateObject(x, y);\n          if (actionPerformed) {\n            this._fire(\"moving\", options);\n            this.setCursor(options.target.moveCursor || this.moveCursor);\n          }\n        } else if (actionHandler) {\n          (actionPerformed = actionHandler(e, transform, x, y)) &&\n            this._fire(action, options);\n        }\n        transform.actionPerformed =\n          transform.actionPerformed || actionPerformed;\n      },\n\n      /**\n       * @private\n       */\n      _fire: fabric.controlsUtils.fireEvent,\n\n      /**\n       * Sets the cursor depending on where the canvas is being hovered.\n       * Note: very buggy in Opera\n       * @param {Event} e Event object\n       * @param {Object} target Object that the mouse is hovering, if so.\n       */\n      _setCursorFromEvent: function (e, target) {\n        if (!target) {\n          this.setCursor(this.defaultCursor);\n          return false;\n        }\n        var hoverCursor = target.hoverCursor || this.hoverCursor,\n          activeSelection =\n            this._activeObject && this._activeObject.type === \"activeSelection\"\n              ? this._activeObject\n              : null,\n          // only show proper corner when group selection is not active\n          corner =\n            (!activeSelection || !activeSelection.contains(target)) &&\n            // here we call findTargetCorner always with undefined for the touch parameter.\n            // we assume that if you are using a cursor you do not need to interact with\n            // the bigger touch area.\n            target._findTargetCorner(this.getPointer(e, true));\n\n        if (!corner) {\n          if (target.subTargetCheck) {\n            // hoverCursor should come from top-most subTarget,\n            // so we walk the array backwards\n            this.targets\n              .concat()\n              .reverse()\n              .map(function (_target) {\n                hoverCursor = _target.hoverCursor || hoverCursor;\n              });\n          }\n          this.setCursor(hoverCursor);\n        } else {\n          this.setCursor(this.getCornerCursor(corner, target, e));\n        }\n      },\n\n      /**\n       * @private\n       */\n      getCornerCursor: function (corner, target, e) {\n        var control = target.controls[corner];\n        return control.cursorStyleHandler(e, control, target);\n      },\n    }\n  );\n})();\n\n(function () {\n  var min = Math.min,\n    max = Math.max;\n\n  fabric.util.object.extend(\n    fabric.Canvas.prototype,\n    /** @lends fabric.Canvas.prototype */ {\n      /**\n       * @private\n       * @param {Event} e Event object\n       * @param {fabric.Object} target\n       * @return {Boolean}\n       */\n      _shouldGroup: function (e, target) {\n        var activeObject = this._activeObject;\n        return (\n          activeObject &&\n          this._isSelectionKeyPressed(e) &&\n          target &&\n          target.selectable &&\n          this.selection &&\n          (activeObject !== target ||\n            activeObject.type === \"activeSelection\") &&\n          !target.onSelect({ e: e })\n        );\n      },\n\n      /**\n       * @private\n       * @param {Event} e Event object\n       * @param {fabric.Object} target\n       */\n      _handleGrouping: function (e, target) {\n        var activeObject = this._activeObject;\n        // avoid multi select when shift click on a corner\n        if (activeObject.__corner) {\n          return;\n        }\n        if (target === activeObject) {\n          // if it's a group, find target again, using activeGroup objects\n          target = this.findTarget(e, true);\n          // if even object is not found or we are on activeObjectCorner, bail out\n          if (!target || !target.selectable) {\n            return;\n          }\n        }\n        if (activeObject && activeObject.type === \"activeSelection\") {\n          this._updateActiveSelection(target, e);\n        } else {\n          this._createActiveSelection(target, e);\n        }\n      },\n\n      /**\n       * @private\n       */\n      _updateActiveSelection: function (target, e) {\n        var activeSelection = this._activeObject,\n          currentActiveObjects = activeSelection._objects.slice(0);\n        if (activeSelection.contains(target)) {\n          activeSelection.removeWithUpdate(target);\n          this._hoveredTarget = target;\n          this._hoveredTargets = this.targets.concat();\n          if (activeSelection.size() === 1) {\n            // activate last remaining object\n            this._setActiveObject(activeSelection.item(0), e);\n          }\n        } else {\n          activeSelection.addWithUpdate(target);\n          this._hoveredTarget = activeSelection;\n          this._hoveredTargets = this.targets.concat();\n        }\n        this._fireSelectionEvents(currentActiveObjects, e);\n      },\n\n      /**\n       * @private\n       */\n      _createActiveSelection: function (target, e) {\n        var currentActives = this.getActiveObjects(),\n          group = this._createGroup(target);\n        this._hoveredTarget = group;\n        // ISSUE 4115: should we consider subTargets here?\n        // this._hoveredTargets = [];\n        // this._hoveredTargets = this.targets.concat();\n        this._setActiveObject(group, e);\n        this._fireSelectionEvents(currentActives, e);\n      },\n\n      /**\n       * @private\n       * @param {Object} target\n       */\n      _createGroup: function (target) {\n        var objects = this._objects,\n          isActiveLower =\n            objects.indexOf(this._activeObject) < objects.indexOf(target),\n          groupObjects = isActiveLower\n            ? [this._activeObject, target]\n            : [target, this._activeObject];\n        this._activeObject.isEditing && this._activeObject.exitEditing();\n        return new fabric.ActiveSelection(groupObjects, {\n          canvas: this,\n        });\n      },\n\n      /**\n       * @private\n       * @param {Event} e mouse event\n       */\n      _groupSelectedObjects: function (e) {\n        var group = this._collectObjects(e),\n          aGroup;\n\n        // do not create group for 1 element only\n        if (group.length === 1) {\n          this.setActiveObject(group[0], e);\n        } else if (group.length > 1) {\n          aGroup = new fabric.ActiveSelection(group.reverse(), {\n            canvas: this,\n          });\n          this.setActiveObject(aGroup, e);\n        }\n      },\n\n      /**\n       * @private\n       */\n      _collectObjects: function (e) {\n        var group = [],\n          currentObject,\n          x1 = this._groupSelector.ex,\n          y1 = this._groupSelector.ey,\n          x2 = x1 + this._groupSelector.left,\n          y2 = y1 + this._groupSelector.top,\n          selectionX1Y1 = new fabric.Point(min(x1, x2), min(y1, y2)),\n          selectionX2Y2 = new fabric.Point(max(x1, x2), max(y1, y2)),\n          allowIntersect = !this.selectionFullyContained,\n          isClick = x1 === x2 && y1 === y2;\n        // we iterate reverse order to collect top first in case of click.\n        for (var i = this._objects.length; i--; ) {\n          currentObject = this._objects[i];\n\n          if (\n            !currentObject ||\n            !currentObject.selectable ||\n            !currentObject.visible\n          ) {\n            continue;\n          }\n\n          if (\n            (allowIntersect &&\n              currentObject.intersectsWithRect(selectionX1Y1, selectionX2Y2)) ||\n            currentObject.isContainedWithinRect(selectionX1Y1, selectionX2Y2) ||\n            (allowIntersect && currentObject.containsPoint(selectionX1Y1)) ||\n            (allowIntersect && currentObject.containsPoint(selectionX2Y2))\n          ) {\n            group.push(currentObject);\n            // only add one object if it's a click\n            if (isClick) {\n              break;\n            }\n          }\n        }\n\n        if (group.length > 1) {\n          group = group.filter(function (object) {\n            return !object.onSelect({ e: e });\n          });\n        }\n\n        return group;\n      },\n\n      /**\n       * @private\n       */\n      _maybeGroupObjects: function (e) {\n        if (this.selection && this._groupSelector) {\n          this._groupSelectedObjects(e);\n        }\n        this.setCursor(this.defaultCursor);\n        // clear selection and current transformation\n        this._groupSelector = null;\n      },\n    }\n  );\n})();\n\n(function () {\n  fabric.util.object.extend(\n    fabric.StaticCanvas.prototype,\n    /** @lends fabric.StaticCanvas.prototype */ {\n      /**\n       * Exports canvas element to a dataurl image. Note that when multiplier is used, cropping is scaled appropriately\n       * @param {Object} [options] Options object\n       * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n       * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n       * @param {Number} [options.multiplier=1] Multiplier to scale by, to have consistent\n       * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n       * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n       * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n       * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n       * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 2.0.0\n       * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n       * @see {@link http://jsfiddle.net/fabricjs/NfZVb/|jsFiddle demo}\n       * @example <caption>Generate jpeg dataURL with lower quality</caption>\n       * var dataURL = canvas.toDataURL({\n       *   format: 'jpeg',\n       *   quality: 0.8\n       * });\n       * @example <caption>Generate cropped png dataURL (clipping of canvas)</caption>\n       * var dataURL = canvas.toDataURL({\n       *   format: 'png',\n       *   left: 100,\n       *   top: 100,\n       *   width: 200,\n       *   height: 200\n       * });\n       * @example <caption>Generate double scaled png dataURL</caption>\n       * var dataURL = canvas.toDataURL({\n       *   format: 'png',\n       *   multiplier: 2\n       * });\n       */\n      toDataURL: function (options) {\n        options || (options = {});\n\n        var format = options.format || \"png\",\n          quality = options.quality || 1,\n          multiplier =\n            (options.multiplier || 1) *\n            (options.enableRetinaScaling ? this.getRetinaScaling() : 1),\n          canvasEl = this.toCanvasElement(multiplier, options);\n        return fabric.util.toDataURL(canvasEl, format, quality);\n      },\n\n      /**\n       * Create a new HTMLCanvas element painted with the current canvas content.\n       * No need to resize the actual one or repaint it.\n       * Will transfer object ownership to a new canvas, paint it, and set everything back.\n       * This is an intermediary step used to get to a dataUrl but also it is useful to\n       * create quick image copies of a canvas without passing for the dataUrl string\n       * @param {Number} [multiplier] a zoom factor.\n       * @param {Object} [cropping] Cropping informations\n       * @param {Number} [cropping.left] Cropping left offset.\n       * @param {Number} [cropping.top] Cropping top offset.\n       * @param {Number} [cropping.width] Cropping width.\n       * @param {Number} [cropping.height] Cropping height.\n       */\n      toCanvasElement: function (multiplier, cropping) {\n        multiplier = multiplier || 1;\n        cropping = cropping || {};\n        var scaledWidth = (cropping.width || this.width) * multiplier,\n          scaledHeight = (cropping.height || this.height) * multiplier,\n          zoom = this.getZoom(),\n          originalWidth = this.width,\n          originalHeight = this.height,\n          newZoom = zoom * multiplier,\n          vp = this.viewportTransform,\n          translateX = (vp[4] - (cropping.left || 0)) * multiplier,\n          translateY = (vp[5] - (cropping.top || 0)) * multiplier,\n          originalInteractive = this.interactive,\n          newVp = [newZoom, 0, 0, newZoom, translateX, translateY],\n          originalRetina = this.enableRetinaScaling,\n          canvasEl = fabric.util.createCanvasElement(),\n          originalContextTop = this.contextTop;\n        canvasEl.width = scaledWidth;\n        canvasEl.height = scaledHeight;\n        this.contextTop = null;\n        this.enableRetinaScaling = false;\n        this.interactive = false;\n        this.viewportTransform = newVp;\n        this.width = scaledWidth;\n        this.height = scaledHeight;\n        this.calcViewportBoundaries();\n        this.renderCanvas(canvasEl.getContext(\"2d\"), this._objects);\n        this.viewportTransform = vp;\n        this.width = originalWidth;\n        this.height = originalHeight;\n        this.calcViewportBoundaries();\n        this.interactive = originalInteractive;\n        this.enableRetinaScaling = originalRetina;\n        this.contextTop = originalContextTop;\n        return canvasEl;\n      },\n    }\n  );\n})();\n\nfabric.util.object.extend(\n  fabric.StaticCanvas.prototype,\n  /** @lends fabric.StaticCanvas.prototype */ {\n    /**\n     * Populates canvas with data from the specified JSON.\n     * JSON format must conform to the one of {@link fabric.Canvas#toJSON}\n     * @param {String|Object} json JSON string or object\n     * @param {Function} callback Callback, invoked when json is parsed\n     *                            and corresponding objects (e.g: {@link fabric.Image})\n     *                            are initialized\n     * @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#deserialization}\n     * @see {@link http://jsfiddle.net/fabricjs/fmgXt/|jsFiddle demo}\n     * @example <caption>loadFromJSON</caption>\n     * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas));\n     * @example <caption>loadFromJSON with reviver</caption>\n     * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas), function(o, object) {\n     *   // `o` = json object\n     *   // `object` = fabric.Object instance\n     *   // ... do some stuff ...\n     * });\n     */\n    loadFromJSON: function (json, callback, reviver) {\n      if (!json) {\n        return;\n      }\n\n      // serialize if it wasn't already\n      var serialized =\n        typeof json === \"string\"\n          ? JSON.parse(json)\n          : fabric.util.object.clone(json);\n\n      var _this = this,\n        clipPath = serialized.clipPath,\n        renderOnAddRemove = this.renderOnAddRemove;\n\n      this.renderOnAddRemove = false;\n\n      delete serialized.clipPath;\n\n      this._enlivenObjects(\n        serialized.objects,\n        function (enlivenedObjects) {\n          _this.clear();\n          _this._setBgOverlay(serialized, function () {\n            if (clipPath) {\n              _this._enlivenObjects([clipPath], function (enlivenedCanvasClip) {\n                _this.clipPath = enlivenedCanvasClip[0];\n                _this.__setupCanvas.call(\n                  _this,\n                  serialized,\n                  enlivenedObjects,\n                  renderOnAddRemove,\n                  callback\n                );\n              });\n            } else {\n              _this.__setupCanvas.call(\n                _this,\n                serialized,\n                enlivenedObjects,\n                renderOnAddRemove,\n                callback\n              );\n            }\n          });\n        },\n        reviver\n      );\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {Object} serialized Object with background and overlay information\n     * @param {Array} restored canvas objects\n     * @param {Function} cached renderOnAddRemove callback\n     * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n     */\n    __setupCanvas: function (\n      serialized,\n      enlivenedObjects,\n      renderOnAddRemove,\n      callback\n    ) {\n      var _this = this;\n      enlivenedObjects.forEach(function (obj, index) {\n        // we splice the array just in case some custom classes restored from JSON\n        // will add more object to canvas at canvas init.\n        _this.insertAt(obj, index);\n      });\n      this.renderOnAddRemove = renderOnAddRemove;\n      // remove parts i cannot set as options\n      delete serialized.objects;\n      delete serialized.backgroundImage;\n      delete serialized.overlayImage;\n      delete serialized.background;\n      delete serialized.overlay;\n      // this._initOptions does too many things to just\n      // call it. Normally loading an Object from JSON\n      // create the Object instance. Here the Canvas is\n      // already an instance and we are just loading things over it\n      this._setOptions(serialized);\n      this.renderAll();\n      callback && callback();\n    },\n\n    /**\n     * @private\n     * @param {Object} serialized Object with background and overlay information\n     * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n     */\n    _setBgOverlay: function (serialized, callback) {\n      var loaded = {\n        backgroundColor: false,\n        overlayColor: false,\n        backgroundImage: false,\n        overlayImage: false,\n      };\n\n      if (\n        !serialized.backgroundImage &&\n        !serialized.overlayImage &&\n        !serialized.background &&\n        !serialized.overlay\n      ) {\n        callback && callback();\n        return;\n      }\n\n      var cbIfLoaded = function () {\n        if (\n          loaded.backgroundImage &&\n          loaded.overlayImage &&\n          loaded.backgroundColor &&\n          loaded.overlayColor\n        ) {\n          callback && callback();\n        }\n      };\n\n      this.__setBgOverlay(\n        \"backgroundImage\",\n        serialized.backgroundImage,\n        loaded,\n        cbIfLoaded\n      );\n      this.__setBgOverlay(\n        \"overlayImage\",\n        serialized.overlayImage,\n        loaded,\n        cbIfLoaded\n      );\n      this.__setBgOverlay(\n        \"backgroundColor\",\n        serialized.background,\n        loaded,\n        cbIfLoaded\n      );\n      this.__setBgOverlay(\n        \"overlayColor\",\n        serialized.overlay,\n        loaded,\n        cbIfLoaded\n      );\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set (backgroundImage, overlayImage, backgroundColor, overlayColor)\n     * @param {(Object|String)} value Value to set\n     * @param {Object} loaded Set loaded property to true if property is set\n     * @param {Object} callback Callback function to invoke after property is set\n     */\n    __setBgOverlay: function (property, value, loaded, callback) {\n      var _this = this;\n\n      if (!value) {\n        loaded[property] = true;\n        callback && callback();\n        return;\n      }\n\n      if (property === \"backgroundImage\" || property === \"overlayImage\") {\n        fabric.util.enlivenObjects([value], function (enlivedObject) {\n          _this[property] = enlivedObject[0];\n          loaded[property] = true;\n          callback && callback();\n        });\n      } else {\n        this[\"set\" + fabric.util.string.capitalize(property, true)](\n          value,\n          function () {\n            loaded[property] = true;\n            callback && callback();\n          }\n        );\n      }\n    },\n\n    /**\n     * @private\n     * @param {Array} objects\n     * @param {Function} callback\n     * @param {Function} [reviver]\n     */\n    _enlivenObjects: function (objects, callback, reviver) {\n      if (!objects || objects.length === 0) {\n        callback && callback([]);\n        return;\n      }\n\n      fabric.util.enlivenObjects(\n        objects,\n        function (enlivenedObjects) {\n          callback && callback(enlivenedObjects);\n        },\n        null,\n        reviver\n      );\n    },\n\n    /**\n     * @private\n     * @param {String} format\n     * @param {Function} callback\n     */\n    _toDataURL: function (format, callback) {\n      this.clone(function (clone) {\n        callback(clone.toDataURL(format));\n      });\n    },\n\n    /**\n     * @private\n     * @param {String} format\n     * @param {Number} multiplier\n     * @param {Function} callback\n     */\n    _toDataURLWithMultiplier: function (format, multiplier, callback) {\n      this.clone(function (clone) {\n        callback(clone.toDataURLWithMultiplier(format, multiplier));\n      });\n    },\n\n    /**\n     * Clones canvas instance\n     * @param {Object} [callback] Receives cloned instance as a first argument\n     * @param {Array} [properties] Array of properties to include in the cloned canvas and children\n     */\n    clone: function (callback, properties) {\n      var data = JSON.stringify(this.toJSON(properties));\n      this.cloneWithoutData(function (clone) {\n        clone.loadFromJSON(data, function () {\n          callback && callback(clone);\n        });\n      });\n    },\n\n    /**\n     * Clones canvas instance without cloning existing data.\n     * This essentially copies canvas dimensions, clipping properties, etc.\n     * but leaves data empty (so that you can populate it with your own)\n     * @param {Object} [callback] Receives cloned instance as a first argument\n     */\n    cloneWithoutData: function (callback) {\n      var el = fabric.util.createCanvasElement();\n\n      el.width = this.width;\n      el.height = this.height;\n\n      var clone = new fabric.Canvas(el);\n      if (this.backgroundImage) {\n        clone.setBackgroundImage(this.backgroundImage.src, function () {\n          clone.renderAll();\n          callback && callback(clone);\n        });\n        clone.backgroundImageOpacity = this.backgroundImageOpacity;\n        clone.backgroundImageStretch = this.backgroundImageStretch;\n      } else {\n        callback && callback(clone);\n      }\n    },\n  }\n);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    extend = fabric.util.object.extend,\n    clone = fabric.util.object.clone,\n    toFixed = fabric.util.toFixed,\n    capitalize = fabric.util.string.capitalize,\n    degreesToRadians = fabric.util.degreesToRadians,\n    supportsLineDash = fabric.StaticCanvas.supports(\"setLineDash\"),\n    objectCaching = !fabric.isLikelyNode,\n    ALIASING_LIMIT = 2;\n\n  if (fabric.Object) {\n    return;\n  }\n\n  /**\n   * Root object class from which all 2d shape classes inherit from\n   * @class fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#objects}\n   * @see {@link fabric.Object#initialize} for constructor definition\n   *\n   * @fires added\n   * @fires removed\n   *\n   * @fires selected\n   * @fires deselected\n   * @fires modified\n   * @fires modified\n   * @fires moved\n   * @fires scaled\n   * @fires rotated\n   * @fires skewed\n   *\n   * @fires rotating\n   * @fires scaling\n   * @fires moving\n   * @fires skewing\n   *\n   * @fires mousedown\n   * @fires mouseup\n   * @fires mouseover\n   * @fires mouseout\n   * @fires mousewheel\n   * @fires mousedblclick\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop\n   */\n  fabric.Object = fabric.util.createClass(\n    fabric.CommonMethods,\n    /** @lends fabric.Object.prototype */ {\n      /**\n       * Type of an object (rect, circle, path, etc.).\n       * Note that this property is meant to be read-only and not meant to be modified.\n       * If you modify, certain parts of Fabric (such as JSON loading) won't work correctly.\n       * @type String\n       * @default\n       */\n      type: \"object\",\n\n      /**\n       * Horizontal origin of transformation of an object (one of \"left\", \"right\", \"center\")\n       * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n       * @type String\n       * @default\n       */\n      originX: \"left\",\n\n      /**\n       * Vertical origin of transformation of an object (one of \"top\", \"bottom\", \"center\")\n       * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n       * @type String\n       * @default\n       */\n      originY: \"top\",\n\n      /**\n       * Top position of an object. Note that by default it's relative to object top. You can change this by setting originY={top/center/bottom}\n       * @type Number\n       * @default\n       */\n      top: 0,\n\n      /**\n       * Left position of an object. Note that by default it's relative to object left. You can change this by setting originX={left/center/right}\n       * @type Number\n       * @default\n       */\n      left: 0,\n\n      /**\n       * Object width\n       * @type Number\n       * @default\n       */\n      width: 0,\n\n      /**\n       * Object height\n       * @type Number\n       * @default\n       */\n      height: 0,\n\n      /**\n       * Object scale factor (horizontal)\n       * @type Number\n       * @default\n       */\n      scaleX: 1,\n\n      /**\n       * Object scale factor (vertical)\n       * @type Number\n       * @default\n       */\n      scaleY: 1,\n\n      /**\n       * When true, an object is rendered as flipped horizontally\n       * @type Boolean\n       * @default\n       */\n      flipX: false,\n\n      /**\n       * When true, an object is rendered as flipped vertically\n       * @type Boolean\n       * @default\n       */\n      flipY: false,\n\n      /**\n       * Opacity of an object\n       * @type Number\n       * @default\n       */\n      opacity: 1,\n\n      /**\n       * Angle of rotation of an object (in degrees)\n       * @type Number\n       * @default\n       */\n      angle: 0,\n\n      /**\n       * Angle of skew on x axes of an object (in degrees)\n       * @type Number\n       * @default\n       */\n      skewX: 0,\n\n      /**\n       * Angle of skew on y axes of an object (in degrees)\n       * @type Number\n       * @default\n       */\n      skewY: 0,\n\n      /**\n       * Size of object's controlling corners (in pixels)\n       * @type Number\n       * @default\n       */\n      cornerSize: 13,\n\n      /**\n       * Size of object's controlling corners when touch interaction is detected\n       * @type Number\n       * @default\n       */\n      touchCornerSize: 24,\n\n      /**\n       * When true, object's controlling corners are rendered as transparent inside (i.e. stroke instead of fill)\n       * @type Boolean\n       * @default\n       */\n      transparentCorners: true,\n\n      /**\n       * Default cursor value used when hovering over this object on canvas\n       * @type String\n       * @default\n       */\n      hoverCursor: null,\n\n      /**\n       * Default cursor value used when moving this object on canvas\n       * @type String\n       * @default\n       */\n      moveCursor: null,\n\n      /**\n       * Padding between object and its controlling borders (in pixels)\n       * @type Number\n       * @default\n       */\n      padding: 0,\n\n      /**\n       * Color of controlling borders of an object (when it's active)\n       * @type String\n       * @default\n       */\n      borderColor: \"rgb(178,204,255)\",\n\n      /**\n       * Array specifying dash pattern of an object's borders (hasBorder must be true)\n       * @since 1.6.2\n       * @type Array\n       */\n      borderDashArray: null,\n\n      /**\n       * Color of controlling corners of an object (when it's active)\n       * @type String\n       * @default\n       */\n      cornerColor: \"rgb(178,204,255)\",\n\n      /**\n       * Color of controlling corners of an object (when it's active and transparentCorners false)\n       * @since 1.6.2\n       * @type String\n       * @default\n       */\n      cornerStrokeColor: null,\n\n      /**\n       * Specify style of control, 'rect' or 'circle'\n       * @since 1.6.2\n       * @type String\n       */\n      cornerStyle: \"rect\",\n\n      /**\n       * Array specifying dash pattern of an object's control (hasBorder must be true)\n       * @since 1.6.2\n       * @type Array\n       */\n      cornerDashArray: null,\n\n      /**\n       * When true, this object will use center point as the origin of transformation\n       * when being scaled via the controls.\n       * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n       * @since 1.3.4\n       * @type Boolean\n       * @default\n       */\n      centeredScaling: false,\n\n      /**\n       * When true, this object will use center point as the origin of transformation\n       * when being rotated via the controls.\n       * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n       * @since 1.3.4\n       * @type Boolean\n       * @default\n       */\n      centeredRotation: true,\n\n      /**\n       * Color of object's fill\n       * takes css colors https://www.w3.org/TR/css-color-3/\n       * @type String\n       * @default\n       */\n      fill: \"rgb(0,0,0)\",\n\n      /**\n       * Fill rule used to fill an object\n       * accepted values are nonzero, evenodd\n       * <b>Backwards incompatibility note:</b> This property was used for setting globalCompositeOperation until v1.4.12 (use `fabric.Object#globalCompositeOperation` instead)\n       * @type String\n       * @default\n       */\n      fillRule: \"nonzero\",\n\n      /**\n       * Composite rule used for canvas globalCompositeOperation\n       * @type String\n       * @default\n       */\n      globalCompositeOperation: \"source-over\",\n\n      /**\n       * Background color of an object.\n       * takes css colors https://www.w3.org/TR/css-color-3/\n       * @type String\n       * @default\n       */\n      backgroundColor: \"\",\n\n      /**\n       * Selection Background color of an object. colored layer behind the object when it is active.\n       * does not mix good with globalCompositeOperation methods.\n       * @type String\n       * @default\n       */\n      selectionBackgroundColor: \"\",\n\n      /**\n       * When defined, an object is rendered via stroke and this property specifies its color\n       * takes css colors https://www.w3.org/TR/css-color-3/\n       * @type String\n       * @default\n       */\n      stroke: null,\n\n      /**\n       * Width of a stroke used to render this object\n       * @type Number\n       * @default\n       */\n      strokeWidth: 1,\n\n      /**\n       * Array specifying dash pattern of an object's stroke (stroke must be defined)\n       * @type Array\n       */\n      strokeDashArray: null,\n\n      /**\n       * Line offset of an object's stroke\n       * @type Number\n       * @default\n       */\n      strokeDashOffset: 0,\n\n      /**\n       * Line endings style of an object's stroke (one of \"butt\", \"round\", \"square\")\n       * @type String\n       * @default\n       */\n      strokeLineCap: \"butt\",\n\n      /**\n       * Corner style of an object's stroke (one of \"bevil\", \"round\", \"miter\")\n       * @type String\n       * @default\n       */\n      strokeLineJoin: \"miter\",\n\n      /**\n       * Maximum miter length (used for strokeLineJoin = \"miter\") of an object's stroke\n       * @type Number\n       * @default\n       */\n      strokeMiterLimit: 4,\n\n      /**\n       * Shadow object representing shadow of this shape\n       * @type fabric.Shadow\n       * @default\n       */\n      shadow: null,\n\n      /**\n       * Opacity of object's controlling borders when object is active and moving\n       * @type Number\n       * @default\n       */\n      borderOpacityWhenMoving: 0.4,\n\n      /**\n       * Scale factor of object's controlling borders\n       * bigger number will make a thicker border\n       * border is 1, so this is basically a border tickness\n       * since there is no way to change the border itself.\n       * @type Number\n       * @default\n       */\n      borderScaleFactor: 1,\n\n      /**\n       * Minimum allowed scale value of an object\n       * @type Number\n       * @default\n       */\n      minScaleLimit: 0,\n\n      /**\n       * When set to `false`, an object can not be selected for modification (using either point-click-based or group-based selection).\n       * But events still fire on it.\n       * @type Boolean\n       * @default\n       */\n      selectable: true,\n\n      /**\n       * When set to `false`, an object can not be a target of events. All events propagate through it. Introduced in v1.3.4\n       * @type Boolean\n       * @default\n       */\n      evented: true,\n\n      /**\n       * When set to `false`, an object is not rendered on canvas\n       * @type Boolean\n       * @default\n       */\n      visible: true,\n\n      /**\n       * When set to `false`, object's controls are not displayed and can not be used to manipulate object\n       * @type Boolean\n       * @default\n       */\n      hasControls: true,\n\n      /**\n       * When set to `false`, object's controlling borders are not rendered\n       * @type Boolean\n       * @default\n       */\n      hasBorders: true,\n\n      /**\n       * When set to `true`, objects are \"found\" on canvas on per-pixel basis rather than according to bounding box\n       * @type Boolean\n       * @default\n       */\n      perPixelTargetFind: false,\n\n      /**\n       * When `false`, default object's values are not included in its serialization\n       * @type Boolean\n       * @default\n       */\n      includeDefaultValues: true,\n\n      /**\n       * When `true`, object horizontal movement is locked\n       * @type Boolean\n       * @default\n       */\n      lockMovementX: false,\n\n      /**\n       * When `true`, object vertical movement is locked\n       * @type Boolean\n       * @default\n       */\n      lockMovementY: false,\n\n      /**\n       * When `true`, object rotation is locked\n       * @type Boolean\n       * @default\n       */\n      lockRotation: false,\n\n      /**\n       * When `true`, object horizontal scaling is locked\n       * @type Boolean\n       * @default\n       */\n      lockScalingX: false,\n\n      /**\n       * When `true`, object vertical scaling is locked\n       * @type Boolean\n       * @default\n       */\n      lockScalingY: false,\n\n      /**\n       * When `true`, object horizontal skewing is locked\n       * @type Boolean\n       * @default\n       */\n      lockSkewingX: false,\n\n      /**\n       * When `true`, object vertical skewing is locked\n       * @type Boolean\n       * @default\n       */\n      lockSkewingY: false,\n\n      /**\n       * When `true`, object cannot be flipped by scaling into negative values\n       * @type Boolean\n       * @default\n       */\n      lockScalingFlip: false,\n\n      /**\n       * When `true`, object is not exported in OBJECT/JSON\n       * @since 1.6.3\n       * @type Boolean\n       * @default\n       */\n      excludeFromExport: false,\n\n      /**\n       * When `true`, object is cached on an additional canvas.\n       * When `false`, object is not cached unless necessary ( clipPath )\n       * default to true\n       * @since 1.7.0\n       * @type Boolean\n       * @default true\n       */\n      objectCaching: objectCaching,\n\n      /**\n       * When `true`, object properties are checked for cache invalidation. In some particular\n       * situation you may want this to be disabled ( spray brush, very big, groups)\n       * or if your application does not allow you to modify properties for groups child you want\n       * to disable it for groups.\n       * default to false\n       * since 1.7.0\n       * @type Boolean\n       * @default false\n       */\n      statefullCache: false,\n\n      /**\n       * When `true`, cache does not get updated during scaling. The picture will get blocky if scaled\n       * too much and will be redrawn with correct details at the end of scaling.\n       * this setting is performance and application dependant.\n       * default to true\n       * since 1.7.0\n       * @type Boolean\n       * @default true\n       */\n      noScaleCache: true,\n\n      /**\n       * When `false`, the stoke width will scale with the object.\n       * When `true`, the stroke will always match the exact pixel size entered for stroke width.\n       * default to false\n       * @since 2.6.0\n       * @type Boolean\n       * @default false\n       * @type Boolean\n       * @default false\n       */\n      strokeUniform: false,\n\n      /**\n       * When set to `true`, object's cache will be rerendered next render call.\n       * since 1.7.0\n       * @type Boolean\n       * @default true\n       */\n      dirty: true,\n\n      /**\n       * keeps the value of the last hovered corner during mouse move.\n       * 0 is no corner, or 'mt', 'ml', 'mtr' etc..\n       * It should be private, but there is no harm in using it as\n       * a read-only property.\n       * @type number|string|any\n       * @default 0\n       */\n      __corner: 0,\n\n      /**\n       * Determines if the fill or the stroke is drawn first (one of \"fill\" or \"stroke\")\n       * @type String\n       * @default\n       */\n      paintFirst: \"fill\",\n\n      /**\n       * List of properties to consider when checking if state\n       * of an object is changed (fabric.Object#hasStateChanged)\n       * as well as for history (undo/redo) purposes\n       * @type Array\n       */\n      stateProperties: (\n        \"top left width height scaleX scaleY flipX flipY originX originY transformMatrix \" +\n        \"stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit \" +\n        \"angle opacity fill globalCompositeOperation shadow visible backgroundColor \" +\n        \"skewX skewY fillRule paintFirst clipPath strokeUniform\"\n      ).split(\" \"),\n\n      /**\n       * List of properties to consider when checking if cache needs refresh\n       * Those properties are checked by statefullCache ON ( or lazy mode if we want ) or from single\n       * calls to Object.set(key, value). If the key is in this list, the object is marked as dirty\n       * and refreshed at the next render\n       * @type Array\n       */\n      cacheProperties: (\n        \"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform\" +\n        \" strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath\"\n      ).split(\" \"),\n\n      /**\n       * List of properties to consider for animating colors.\n       * @type Array\n       */\n      colorProperties: \"fill stroke backgroundColor\".split(\" \"),\n\n      /**\n       * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n       * the clipPath object gets used when the object has rendered, and the context is placed in the center\n       * of the object cacheCanvas.\n       * If you want 0,0 of a clipPath to align with an object center, use clipPath.originX/Y to 'center'\n       * @type fabric.Object\n       */\n      clipPath: undefined,\n\n      /**\n       * Meaningful ONLY when the object is used as clipPath.\n       * if true, the clipPath will make the object clip to the outside of the clipPath\n       * since 2.4.0\n       * @type boolean\n       * @default false\n       */\n      inverted: false,\n\n      /**\n       * Meaningful ONLY when the object is used as clipPath.\n       * if true, the clipPath will have its top and left relative to canvas, and will\n       * not be influenced by the object transform. This will make the clipPath relative\n       * to the canvas, but clipping just a particular object.\n       * WARNING this is beta, this feature may change or be renamed.\n       * since 2.4.0\n       * @type boolean\n       * @default false\n       */\n      absolutePositioned: false,\n\n      /**\n       * Constructor\n       * @param {Object} [options] Options object\n       */\n      initialize: function (options) {\n        if (options) {\n          this.setOptions(options);\n        }\n      },\n\n      /**\n       * Create a the canvas used to keep the cached copy of the object\n       * @private\n       */\n      _createCacheCanvas: function () {\n        this._cacheProperties = {};\n        this._cacheCanvas = fabric.util.createCanvasElement();\n        this._cacheContext = this._cacheCanvas.getContext(\"2d\");\n        this._updateCacheCanvas();\n        // if canvas gets created, is empty, so dirty.\n        this.dirty = true;\n      },\n\n      /**\n       * Limit the cache dimensions so that X * Y do not cross fabric.perfLimitSizeTotal\n       * and each side do not cross fabric.cacheSideLimit\n       * those numbers are configurable so that you can get as much detail as you want\n       * making bargain with performances.\n       * @param {Object} dims\n       * @param {Object} dims.width width of canvas\n       * @param {Object} dims.height height of canvas\n       * @param {Object} dims.zoomX zoomX zoom value to unscale the canvas before drawing cache\n       * @param {Object} dims.zoomY zoomY zoom value to unscale the canvas before drawing cache\n       * @return {Object}.width width of canvas\n       * @return {Object}.height height of canvas\n       * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n       * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n       */\n      _limitCacheSize: function (dims) {\n        var perfLimitSizeTotal = fabric.perfLimitSizeTotal,\n          width = dims.width,\n          height = dims.height,\n          max = fabric.maxCacheSideLimit,\n          min = fabric.minCacheSideLimit;\n        if (\n          width <= max &&\n          height <= max &&\n          width * height <= perfLimitSizeTotal\n        ) {\n          if (width < min) {\n            dims.width = min;\n          }\n          if (height < min) {\n            dims.height = min;\n          }\n          return dims;\n        }\n        var ar = width / height,\n          limitedDims = fabric.util.limitDimsByArea(ar, perfLimitSizeTotal),\n          capValue = fabric.util.capValue,\n          x = capValue(min, limitedDims.x, max),\n          y = capValue(min, limitedDims.y, max);\n        if (width > x) {\n          dims.zoomX /= width / x;\n          dims.width = x;\n          dims.capped = true;\n        }\n        if (height > y) {\n          dims.zoomY /= height / y;\n          dims.height = y;\n          dims.capped = true;\n        }\n        return dims;\n      },\n\n      /**\n       * Return the dimension and the zoom level needed to create a cache canvas\n       * big enough to host the object to be cached.\n       * @private\n       * @return {Object}.x width of object to be cached\n       * @return {Object}.y height of object to be cached\n       * @return {Object}.width width of canvas\n       * @return {Object}.height height of canvas\n       * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n       * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n       */\n      _getCacheCanvasDimensions: function () {\n        var objectScale = this.getTotalObjectScaling(),\n          // caculate dimensions without skewing\n          dim = this._getTransformedDimensions(0, 0),\n          neededX = (dim.x * objectScale.scaleX) / this.scaleX,\n          neededY = (dim.y * objectScale.scaleY) / this.scaleY;\n        return {\n          // for sure this ALIASING_LIMIT is slightly creating problem\n          // in situation in which the cache canvas gets an upper limit\n          // also objectScale contains already scaleX and scaleY\n          width: neededX + ALIASING_LIMIT,\n          height: neededY + ALIASING_LIMIT,\n          zoomX: objectScale.scaleX,\n          zoomY: objectScale.scaleY,\n          x: neededX,\n          y: neededY,\n        };\n      },\n\n      /**\n       * Update width and height of the canvas for cache\n       * returns true or false if canvas needed resize.\n       * @private\n       * @return {Boolean} true if the canvas has been resized\n       */\n      _updateCacheCanvas: function () {\n        var targetCanvas = this.canvas;\n        if (\n          this.noScaleCache &&\n          targetCanvas &&\n          targetCanvas._currentTransform\n        ) {\n          var target = targetCanvas._currentTransform.target,\n            action = targetCanvas._currentTransform.action;\n          if (\n            this === target &&\n            action.slice &&\n            action.slice(0, 5) === \"scale\"\n          ) {\n            return false;\n          }\n        }\n        var canvas = this._cacheCanvas,\n          dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\n          minCacheSize = fabric.minCacheSideLimit,\n          width = dims.width,\n          height = dims.height,\n          drawingWidth,\n          drawingHeight,\n          zoomX = dims.zoomX,\n          zoomY = dims.zoomY,\n          dimensionsChanged =\n            width !== this.cacheWidth || height !== this.cacheHeight,\n          zoomChanged = this.zoomX !== zoomX || this.zoomY !== zoomY,\n          shouldRedraw = dimensionsChanged || zoomChanged,\n          additionalWidth = 0,\n          additionalHeight = 0,\n          shouldResizeCanvas = false;\n        if (dimensionsChanged) {\n          var canvasWidth = this._cacheCanvas.width,\n            canvasHeight = this._cacheCanvas.height,\n            sizeGrowing = width > canvasWidth || height > canvasHeight,\n            sizeShrinking =\n              (width < canvasWidth * 0.9 || height < canvasHeight * 0.9) &&\n              canvasWidth > minCacheSize &&\n              canvasHeight > minCacheSize;\n          shouldResizeCanvas = sizeGrowing || sizeShrinking;\n          if (\n            sizeGrowing &&\n            !dims.capped &&\n            (width > minCacheSize || height > minCacheSize)\n          ) {\n            additionalWidth = width * 0.1;\n            additionalHeight = height * 0.1;\n          }\n        }\n        if (shouldRedraw) {\n          if (shouldResizeCanvas) {\n            canvas.width = Math.ceil(width + additionalWidth);\n            canvas.height = Math.ceil(height + additionalHeight);\n          } else {\n            this._cacheContext.setTransform(1, 0, 0, 1, 0, 0);\n            this._cacheContext.clearRect(0, 0, canvas.width, canvas.height);\n          }\n          drawingWidth = dims.x / 2;\n          drawingHeight = dims.y / 2;\n          this.cacheTranslationX =\n            Math.round(canvas.width / 2 - drawingWidth) + drawingWidth;\n          this.cacheTranslationY =\n            Math.round(canvas.height / 2 - drawingHeight) + drawingHeight;\n          this.cacheWidth = width;\n          this.cacheHeight = height;\n          this._cacheContext.translate(\n            this.cacheTranslationX,\n            this.cacheTranslationY\n          );\n          this._cacheContext.scale(zoomX, zoomY);\n          this.zoomX = zoomX;\n          this.zoomY = zoomY;\n          return true;\n        }\n        return false;\n      },\n\n      /**\n       * Sets object's properties from options\n       * @param {Object} [options] Options object\n       */\n      setOptions: function (options) {\n        this._setOptions(options);\n        this._initGradient(options.fill, \"fill\");\n        this._initGradient(options.stroke, \"stroke\");\n        this._initPattern(options.fill, \"fill\");\n        this._initPattern(options.stroke, \"stroke\");\n      },\n\n      /**\n       * Transforms context when rendering an object\n       * @param {CanvasRenderingContext2D} ctx Context\n       */\n      transform: function (ctx) {\n        var needFullTransform =\n          (this.group && !this.group._transformDone) ||\n          (this.group && this.canvas && ctx === this.canvas.contextTop);\n        var m = this.calcTransformMatrix(!needFullTransform);\n        ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n      },\n\n      /**\n       * Returns an object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} Object representation of an instance\n       */\n      toObject: function (propertiesToInclude) {\n        var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          object = {\n            type: this.type,\n            version: fabric.version,\n            originX: this.originX,\n            originY: this.originY,\n            left: toFixed(this.left, NUM_FRACTION_DIGITS),\n            top: toFixed(this.top, NUM_FRACTION_DIGITS),\n            width: toFixed(this.width, NUM_FRACTION_DIGITS),\n            height: toFixed(this.height, NUM_FRACTION_DIGITS),\n            fill:\n              this.fill && this.fill.toObject\n                ? this.fill.toObject()\n                : this.fill,\n            stroke:\n              this.stroke && this.stroke.toObject\n                ? this.stroke.toObject()\n                : this.stroke,\n            strokeWidth: toFixed(this.strokeWidth, NUM_FRACTION_DIGITS),\n            strokeDashArray: this.strokeDashArray\n              ? this.strokeDashArray.concat()\n              : this.strokeDashArray,\n            strokeLineCap: this.strokeLineCap,\n            strokeDashOffset: this.strokeDashOffset,\n            strokeLineJoin: this.strokeLineJoin,\n            // strokeUniform:            this.strokeUniform,\n            strokeMiterLimit: toFixed(\n              this.strokeMiterLimit,\n              NUM_FRACTION_DIGITS\n            ),\n            scaleX: toFixed(this.scaleX, NUM_FRACTION_DIGITS),\n            scaleY: toFixed(this.scaleY, NUM_FRACTION_DIGITS),\n            angle: toFixed(this.angle, NUM_FRACTION_DIGITS),\n            flipX: this.flipX,\n            flipY: this.flipY,\n            opacity: toFixed(this.opacity, NUM_FRACTION_DIGITS),\n            shadow:\n              this.shadow && this.shadow.toObject\n                ? this.shadow.toObject()\n                : this.shadow,\n            visible: this.visible,\n            backgroundColor: this.backgroundColor,\n            fillRule: this.fillRule,\n            paintFirst: this.paintFirst,\n            globalCompositeOperation: this.globalCompositeOperation,\n            skewX: toFixed(this.skewX, NUM_FRACTION_DIGITS),\n            skewY: toFixed(this.skewY, NUM_FRACTION_DIGITS),\n          };\n\n        if (this.clipPath) {\n          object.clipPath = this.clipPath.toObject(propertiesToInclude);\n          object.clipPath.inverted = this.clipPath.inverted;\n          object.clipPath.absolutePositioned = this.clipPath.absolutePositioned;\n        }\n\n        fabric.util.populateWithProperties(this, object, propertiesToInclude);\n        if (!this.includeDefaultValues) {\n          object = this._removeDefaultValues(object);\n        }\n\n        return object;\n      },\n\n      /**\n       * Returns (dataless) object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} Object representation of an instance\n       */\n      toDatalessObject: function (propertiesToInclude) {\n        // will be overwritten by subclasses\n        return this.toObject(propertiesToInclude);\n      },\n\n      /**\n       * @private\n       * @param {Object} object\n       */\n      _removeDefaultValues: function (object) {\n        var prototype = fabric.util.getKlass(object.type).prototype,\n          stateProperties = prototype.stateProperties;\n        stateProperties.forEach(function (prop) {\n          if (prop === \"left\" || prop === \"top\") {\n            return;\n          }\n          if (object[prop] === prototype[prop]) {\n            delete object[prop];\n          }\n          var isArray =\n            Object.prototype.toString.call(object[prop]) === \"[object Array]\" &&\n            Object.prototype.toString.call(prototype[prop]) ===\n              \"[object Array]\";\n\n          // basically a check for [] === []\n          if (\n            isArray &&\n            object[prop].length === 0 &&\n            prototype[prop].length === 0\n          ) {\n            delete object[prop];\n          }\n        });\n\n        return object;\n      },\n\n      /**\n       * Returns a string representation of an instance\n       * @return {String}\n       */\n      toString: function () {\n        return \"#<fabric.\" + capitalize(this.type) + \">\";\n      },\n\n      /**\n       * Return the object scale factor counting also the group scaling\n       * @return {Object} object with scaleX and scaleY properties\n       */\n      getObjectScaling: function () {\n        var options = fabric.util.qrDecompose(this.calcTransformMatrix());\n        return {\n          scaleX: Math.abs(options.scaleX),\n          scaleY: Math.abs(options.scaleY),\n        };\n      },\n\n      /**\n       * Return the object scale factor counting also the group scaling, zoom and retina\n       * @return {Object} object with scaleX and scaleY properties\n       */\n      getTotalObjectScaling: function () {\n        var scale = this.getObjectScaling(),\n          scaleX = scale.scaleX,\n          scaleY = scale.scaleY;\n        if (this.canvas) {\n          var zoom = this.canvas.getZoom();\n          var retina = this.canvas.getRetinaScaling();\n          scaleX *= zoom * retina;\n          scaleY *= zoom * retina;\n        }\n        return { scaleX: scaleX, scaleY: scaleY };\n      },\n\n      /**\n       * Return the object opacity counting also the group property\n       * @return {Number}\n       */\n      getObjectOpacity: function () {\n        var opacity = this.opacity;\n        if (this.group) {\n          opacity *= this.group.getObjectOpacity();\n        }\n        return opacity;\n      },\n\n      /**\n       * @private\n       * @param {String} key\n       * @param {*} value\n       * @return {fabric.Object} thisArg\n       */\n      _set: function (key, value) {\n        var shouldConstrainValue = key === \"scaleX\" || key === \"scaleY\",\n          isChanged = this[key] !== value,\n          groupNeedsUpdate = false;\n\n        if (shouldConstrainValue) {\n          value = this._constrainScale(value);\n        }\n        if (key === \"scaleX\" && value < 0) {\n          this.flipX = !this.flipX;\n          value *= -1;\n        } else if (key === \"scaleY\" && value < 0) {\n          this.flipY = !this.flipY;\n          value *= -1;\n        } else if (\n          key === \"shadow\" &&\n          value &&\n          !(value instanceof fabric.Shadow)\n        ) {\n          value = new fabric.Shadow(value);\n        } else if (key === \"dirty\" && this.group) {\n          this.group.set(\"dirty\", value);\n        }\n\n        this[key] = value;\n\n        if (isChanged) {\n          groupNeedsUpdate = this.group && this.group.isOnACache();\n          if (this.cacheProperties.indexOf(key) > -1) {\n            this.dirty = true;\n            groupNeedsUpdate && this.group.set(\"dirty\", true);\n          } else if (\n            groupNeedsUpdate &&\n            this.stateProperties.indexOf(key) > -1\n          ) {\n            this.group.set(\"dirty\", true);\n          }\n        }\n\n        return this;\n      },\n\n      /**\n       * This callback function is called by the parent group of an object every\n       * time a non-delegated property changes on the group. It is passed the key\n       * and value as parameters. Not adding in this function's signature to avoid\n       * Travis build error about unused variables.\n       */\n      setOnGroup: function () {\n        // implemented by sub-classes, as needed.\n      },\n\n      /**\n       * Retrieves viewportTransform from Object's canvas if possible\n       * @method getViewportTransform\n       * @memberOf fabric.Object.prototype\n       * @return {Array}\n       */\n      getViewportTransform: function () {\n        if (this.canvas && this.canvas.viewportTransform) {\n          return this.canvas.viewportTransform;\n        }\n        return fabric.iMatrix.concat();\n      },\n\n      /*\n       * @private\n       * return if the object would be visible in rendering\n       * @memberOf fabric.Object.prototype\n       * @return {Boolean}\n       */\n      isNotVisible: function () {\n        return (\n          this.opacity === 0 ||\n          (!this.width && !this.height && this.strokeWidth === 0) ||\n          !this.visible\n        );\n      },\n\n      /**\n       * Renders an object on a specified context\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      render: function (ctx) {\n        // do not render if width/height are zeros or object is not visible\n        if (this.isNotVisible()) {\n          return;\n        }\n        if (\n          this.canvas &&\n          this.canvas.skipOffscreen &&\n          !this.group &&\n          !this.isOnScreen()\n        ) {\n          return;\n        }\n        ctx.save();\n        this._setupCompositeOperation(ctx);\n        this.drawSelectionBackground(ctx);\n        this.transform(ctx);\n        this._setOpacity(ctx);\n        this._setShadow(ctx, this);\n        if (this.shouldCache()) {\n          this.renderCache();\n          this.drawCacheOnCanvas(ctx);\n        } else {\n          this._removeCacheCanvas();\n          this.dirty = false;\n          this.drawObject(ctx);\n          if (this.objectCaching && this.statefullCache) {\n            this.saveState({ propertySet: \"cacheProperties\" });\n          }\n        }\n        ctx.restore();\n      },\n\n      renderCache: function (options) {\n        options = options || {};\n        if (!this._cacheCanvas) {\n          this._createCacheCanvas();\n        }\n        if (this.isCacheDirty()) {\n          this.statefullCache &&\n            this.saveState({ propertySet: \"cacheProperties\" });\n          this.drawObject(this._cacheContext, options.forClipping);\n          this.dirty = false;\n        }\n      },\n\n      /**\n       * Remove cacheCanvas and its dimensions from the objects\n       */\n      _removeCacheCanvas: function () {\n        this._cacheCanvas = null;\n        this.cacheWidth = 0;\n        this.cacheHeight = 0;\n      },\n\n      /**\n       * return true if the object will draw a stroke\n       * Does not consider text styles. This is just a shortcut used at rendering time\n       * We want it to be an aproximation and be fast.\n       * wrote to avoid extra caching, it has to return true when stroke happens,\n       * can guess when it will not happen at 100% chance, does not matter if it misses\n       * some use case where the stroke is invisible.\n       * @since 3.0.0\n       * @returns Boolean\n       */\n      hasStroke: function () {\n        return (\n          this.stroke && this.stroke !== \"transparent\" && this.strokeWidth !== 0\n        );\n      },\n\n      /**\n       * return true if the object will draw a fill\n       * Does not consider text styles. This is just a shortcut used at rendering time\n       * We want it to be an aproximation and be fast.\n       * wrote to avoid extra caching, it has to return true when fill happens,\n       * can guess when it will not happen at 100% chance, does not matter if it misses\n       * some use case where the fill is invisible.\n       * @since 3.0.0\n       * @returns Boolean\n       */\n      hasFill: function () {\n        return this.fill && this.fill !== \"transparent\";\n      },\n\n      /**\n       * When set to `true`, force the object to have its own cache, even if it is inside a group\n       * it may be needed when your object behave in a particular way on the cache and always needs\n       * its own isolated canvas to render correctly.\n       * Created to be overridden\n       * since 1.7.12\n       * @returns Boolean\n       */\n      needsItsOwnCache: function () {\n        if (\n          this.paintFirst === \"stroke\" &&\n          this.hasFill() &&\n          this.hasStroke() &&\n          typeof this.shadow === \"object\"\n        ) {\n          return true;\n        }\n        if (this.clipPath) {\n          return true;\n        }\n        return false;\n      },\n\n      /**\n       * Decide if the object should cache or not. Create its own cache level\n       * objectCaching is a global flag, wins over everything\n       * needsItsOwnCache should be used when the object drawing method requires\n       * a cache step. None of the fabric classes requires it.\n       * Generally you do not cache objects in groups because the group outside is cached.\n       * Read as: cache if is needed, or if the feature is enabled but we are not already caching.\n       * @return {Boolean}\n       */\n      shouldCache: function () {\n        this.ownCaching =\n          this.needsItsOwnCache() ||\n          (this.objectCaching && (!this.group || !this.group.isOnACache()));\n        return this.ownCaching;\n      },\n\n      /**\n       * Check if this object or a child object will cast a shadow\n       * used by Group.shouldCache to know if child has a shadow recursively\n       * @return {Boolean}\n       */\n      willDrawShadow: function () {\n        return (\n          !!this.shadow &&\n          (this.shadow.offsetX !== 0 || this.shadow.offsetY !== 0)\n        );\n      },\n\n      /**\n       * Execute the drawing operation for an object clipPath\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      drawClipPathOnCache: function (ctx) {\n        var path = this.clipPath;\n        ctx.save();\n        // DEBUG: uncomment this line, comment the following\n        // ctx.globalAlpha = 0.4\n        if (path.inverted) {\n          ctx.globalCompositeOperation = \"destination-out\";\n        } else {\n          ctx.globalCompositeOperation = \"destination-in\";\n        }\n        //ctx.scale(1 / 2, 1 / 2);\n        if (path.absolutePositioned) {\n          var m = fabric.util.invertTransform(this.calcTransformMatrix());\n          ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n        }\n        path.transform(ctx);\n        ctx.scale(1 / path.zoomX, 1 / path.zoomY);\n        ctx.drawImage(\n          path._cacheCanvas,\n          -path.cacheTranslationX,\n          -path.cacheTranslationY\n        );\n        ctx.restore();\n      },\n\n      /**\n       * Execute the drawing operation for an object on a specified context\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      drawObject: function (ctx, forClipping) {\n        var originalFill = this.fill,\n          originalStroke = this.stroke;\n        if (forClipping) {\n          this.fill = \"black\";\n          this.stroke = \"\";\n          this._setClippingProperties(ctx);\n        } else {\n          this._renderBackground(ctx);\n          this._setStrokeStyles(ctx, this);\n          this._setFillStyles(ctx, this);\n        }\n        this._render(ctx);\n        this._drawClipPath(ctx);\n        this.fill = originalFill;\n        this.stroke = originalStroke;\n      },\n\n      _drawClipPath: function (ctx) {\n        var path = this.clipPath;\n        if (!path) {\n          return;\n        }\n        // needed to setup a couple of variables\n        // path canvas gets overridden with this one.\n        // TODO find a better solution?\n        path.canvas = this.canvas;\n        path.shouldCache();\n        path._transformDone = true;\n        path.renderCache({ forClipping: true });\n        this.drawClipPathOnCache(ctx);\n      },\n\n      /**\n       * Paint the cached copy of the object on the target context.\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      drawCacheOnCanvas: function (ctx) {\n        ctx.scale(1 / this.zoomX, 1 / this.zoomY);\n        ctx.drawImage(\n          this._cacheCanvas,\n          -this.cacheTranslationX,\n          -this.cacheTranslationY\n        );\n      },\n\n      /**\n       * Check if cache is dirty\n       * @param {Boolean} skipCanvas skip canvas checks because this object is painted\n       * on parent canvas.\n       */\n      isCacheDirty: function (skipCanvas) {\n        if (this.isNotVisible()) {\n          return false;\n        }\n        if (this._cacheCanvas && !skipCanvas && this._updateCacheCanvas()) {\n          // in this case the context is already cleared.\n          return true;\n        } else {\n          if (\n            this.dirty ||\n            (this.clipPath && this.clipPath.absolutePositioned) ||\n            (this.statefullCache && this.hasStateChanged(\"cacheProperties\"))\n          ) {\n            if (this._cacheCanvas && !skipCanvas) {\n              var width = this.cacheWidth / this.zoomX;\n              var height = this.cacheHeight / this.zoomY;\n              this._cacheContext.clearRect(\n                -width / 2,\n                -height / 2,\n                width,\n                height\n              );\n            }\n            return true;\n          }\n        }\n        return false;\n      },\n\n      /**\n       * Draws a background for the object big as its untransformed dimensions\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderBackground: function (ctx) {\n        if (!this.backgroundColor) {\n          return;\n        }\n        var dim = this._getNonTransformedDimensions();\n        ctx.fillStyle = this.backgroundColor;\n\n        ctx.fillRect(-dim.x / 2, -dim.y / 2, dim.x, dim.y);\n        // if there is background color no other shadows\n        // should be casted\n        this._removeShadow(ctx);\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _setOpacity: function (ctx) {\n        if (this.group && !this.group._transformDone) {\n          ctx.globalAlpha = this.getObjectOpacity();\n        } else {\n          ctx.globalAlpha *= this.opacity;\n        }\n      },\n\n      _setStrokeStyles: function (ctx, decl) {\n        if (decl.stroke) {\n          ctx.lineWidth = decl.strokeWidth;\n          ctx.lineCap = decl.strokeLineCap;\n          ctx.lineDashOffset = decl.strokeDashOffset;\n          ctx.lineJoin = decl.strokeLineJoin;\n          ctx.miterLimit = decl.strokeMiterLimit;\n          ctx.strokeStyle = decl.stroke.toLive\n            ? decl.stroke.toLive(ctx, this)\n            : decl.stroke;\n        }\n      },\n\n      _setFillStyles: function (ctx, decl) {\n        if (decl.fill) {\n          ctx.fillStyle = decl.fill.toLive\n            ? decl.fill.toLive(ctx, this)\n            : decl.fill;\n        }\n      },\n\n      _setClippingProperties: function (ctx) {\n        ctx.globalAlpha = 1;\n        ctx.strokeStyle = \"transparent\";\n        ctx.fillStyle = \"#000000\";\n      },\n\n      /**\n       * @private\n       * Sets line dash\n       * @param {CanvasRenderingContext2D} ctx Context to set the dash line on\n       * @param {Array} dashArray array representing dashes\n       * @param {Function} alternative function to call if browser does not support lineDash\n       */\n      _setLineDash: function (ctx, dashArray, alternative) {\n        if (!dashArray || dashArray.length === 0) {\n          return;\n        }\n        // Spec requires the concatenation of two copies the dash list when the number of elements is odd\n        if (1 & dashArray.length) {\n          dashArray.push.apply(dashArray, dashArray);\n        }\n        if (supportsLineDash) {\n          ctx.setLineDash(dashArray);\n        } else {\n          alternative && alternative(ctx);\n        }\n      },\n\n      /**\n       * Renders controls and borders for the object\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {Object} [styleOverride] properties to override the object style\n       */\n      _renderControls: function (ctx, styleOverride) {\n        var vpt = this.getViewportTransform(),\n          matrix = this.calcTransformMatrix(),\n          options,\n          drawBorders,\n          drawControls;\n        styleOverride = styleOverride || {};\n        drawBorders =\n          typeof styleOverride.hasBorders !== \"undefined\"\n            ? styleOverride.hasBorders\n            : this.hasBorders;\n        drawControls =\n          typeof styleOverride.hasControls !== \"undefined\"\n            ? styleOverride.hasControls\n            : this.hasControls;\n        matrix = fabric.util.multiplyTransformMatrices(vpt, matrix);\n        options = fabric.util.qrDecompose(matrix);\n        ctx.save();\n        ctx.translate(options.translateX, options.translateY);\n        ctx.lineWidth = 1 * this.borderScaleFactor;\n        if (!this.group) {\n          ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n        }\n        if (styleOverride.forActiveSelection) {\n          ctx.rotate(degreesToRadians(options.angle));\n          drawBorders && this.drawBordersInGroup(ctx, options, styleOverride);\n        } else {\n          ctx.rotate(degreesToRadians(this.angle));\n          drawBorders && this.drawBorders(ctx, styleOverride);\n        }\n        drawControls && this.drawControls(ctx, styleOverride);\n        ctx.restore();\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _setShadow: function (ctx) {\n        if (!this.shadow) {\n          return;\n        }\n\n        var shadow = this.shadow,\n          canvas = this.canvas,\n          scaling,\n          multX = (canvas && canvas.viewportTransform[0]) || 1,\n          multY = (canvas && canvas.viewportTransform[3]) || 1;\n        if (shadow.nonScaling) {\n          scaling = { scaleX: 1, scaleY: 1 };\n        } else {\n          scaling = this.getObjectScaling();\n        }\n        if (canvas && canvas._isRetinaScaling()) {\n          multX *= fabric.devicePixelRatio;\n          multY *= fabric.devicePixelRatio;\n        }\n        ctx.shadowColor = shadow.color;\n        ctx.shadowBlur =\n          (shadow.blur *\n            fabric.browserShadowBlurConstant *\n            (multX + multY) *\n            (scaling.scaleX + scaling.scaleY)) /\n          4;\n        ctx.shadowOffsetX = shadow.offsetX * multX * scaling.scaleX;\n        ctx.shadowOffsetY = shadow.offsetY * multY * scaling.scaleY;\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _removeShadow: function (ctx) {\n        if (!this.shadow) {\n          return;\n        }\n\n        ctx.shadowColor = \"\";\n        ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {Object} filler fabric.Pattern or fabric.Gradient\n       * @return {Object} offset.offsetX offset for text rendering\n       * @return {Object} offset.offsetY offset for text rendering\n       */\n      _applyPatternGradientTransform: function (ctx, filler) {\n        if (!filler || !filler.toLive) {\n          return { offsetX: 0, offsetY: 0 };\n        }\n        var t = filler.gradientTransform || filler.patternTransform;\n        var offsetX = -this.width / 2 + filler.offsetX || 0,\n          offsetY = -this.height / 2 + filler.offsetY || 0;\n\n        if (filler.gradientUnits === \"percentage\") {\n          ctx.transform(this.width, 0, 0, this.height, offsetX, offsetY);\n        } else {\n          ctx.transform(1, 0, 0, 1, offsetX, offsetY);\n        }\n        if (t) {\n          ctx.transform(t[0], t[1], t[2], t[3], t[4], t[5]);\n        }\n        return { offsetX: offsetX, offsetY: offsetY };\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderPaintInOrder: function (ctx) {\n        if (this.paintFirst === \"stroke\") {\n          this._renderStroke(ctx);\n          this._renderFill(ctx);\n        } else {\n          this._renderFill(ctx);\n          this._renderStroke(ctx);\n        }\n      },\n\n      /**\n       * @private\n       * function that actually render something on the context.\n       * empty here to allow Obects to work on tests to benchmark fabric functionalites\n       * not related to rendering\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _render: function (/* ctx */) {},\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderFill: function (ctx) {\n        if (!this.fill) {\n          return;\n        }\n\n        ctx.save();\n        this._applyPatternGradientTransform(ctx, this.fill);\n        if (this.fillRule === \"evenodd\") {\n          ctx.fill(\"evenodd\");\n        } else {\n          ctx.fill();\n        }\n        ctx.restore();\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderStroke: function (ctx) {\n        if (!this.stroke || this.strokeWidth === 0) {\n          return;\n        }\n\n        if (this.shadow && !this.shadow.affectStroke) {\n          this._removeShadow(ctx);\n        }\n\n        ctx.save();\n        if (this.strokeUniform && this.group) {\n          var scaling = this.getObjectScaling();\n          ctx.scale(1 / scaling.scaleX, 1 / scaling.scaleY);\n        } else if (this.strokeUniform) {\n          ctx.scale(1 / this.scaleX, 1 / this.scaleY);\n        }\n        this._setLineDash(ctx, this.strokeDashArray, this._renderDashedStroke);\n        if (this.stroke.toLive && this.stroke.gradientUnits === \"percentage\") {\n          // need to transform gradient in a pattern.\n          // this is a slow process. If you are hitting this codepath, and the object\n          // is not using caching, you should consider switching it on.\n          // we need a canvas as big as the current object caching canvas.\n          this._applyPatternForTransformedGradient(ctx, this.stroke);\n        } else {\n          this._applyPatternGradientTransform(ctx, this.stroke);\n        }\n        ctx.stroke();\n        ctx.restore();\n      },\n\n      /**\n       * This function try to patch the missing gradientTransform on canvas gradients.\n       * transforming a context to transform the gradient, is going to transform the stroke too.\n       * we want to transform the gradient but not the stroke operation, so we create\n       * a transformed gradient on a pattern and then we use the pattern instead of the gradient.\n       * this method has drwabacks: is slow, is in low resolution, needs a patch for when the size\n       * is limited.\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {fabric.Gradient} filler a fabric gradient instance\n       */\n      _applyPatternForTransformedGradient: function (ctx, filler) {\n        var dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\n          pCanvas = fabric.util.createCanvasElement(),\n          pCtx,\n          retinaScaling = this.canvas.getRetinaScaling(),\n          width = dims.x / this.scaleX / retinaScaling,\n          height = dims.y / this.scaleY / retinaScaling;\n        pCanvas.width = width;\n        pCanvas.height = height;\n        pCtx = pCanvas.getContext(\"2d\");\n        pCtx.beginPath();\n        pCtx.moveTo(0, 0);\n        pCtx.lineTo(width, 0);\n        pCtx.lineTo(width, height);\n        pCtx.lineTo(0, height);\n        pCtx.closePath();\n        pCtx.translate(width / 2, height / 2);\n        pCtx.scale(\n          dims.zoomX / this.scaleX / retinaScaling,\n          dims.zoomY / this.scaleY / retinaScaling\n        );\n        this._applyPatternGradientTransform(pCtx, filler);\n        pCtx.fillStyle = filler.toLive(ctx);\n        pCtx.fill();\n        ctx.translate(\n          -this.width / 2 - this.strokeWidth / 2,\n          -this.height / 2 - this.strokeWidth / 2\n        );\n        ctx.scale(\n          (retinaScaling * this.scaleX) / dims.zoomX,\n          (retinaScaling * this.scaleY) / dims.zoomY\n        );\n        ctx.strokeStyle = pCtx.createPattern(pCanvas, \"no-repeat\");\n      },\n\n      /**\n       * This function is an helper for svg import. it returns the center of the object in the svg\n       * untransformed coordinates\n       * @private\n       * @return {Object} center point from element coordinates\n       */\n      _findCenterFromElement: function () {\n        return { x: this.left + this.width / 2, y: this.top + this.height / 2 };\n      },\n\n      /**\n       * This function is an helper for svg import. it decompose the transformMatrix\n       * and assign properties to object.\n       * untransformed coordinates\n       * @private\n       * @chainable\n       */\n      _assignTransformMatrixProps: function () {\n        if (this.transformMatrix) {\n          var options = fabric.util.qrDecompose(this.transformMatrix);\n          this.flipX = false;\n          this.flipY = false;\n          this.set(\"scaleX\", options.scaleX);\n          this.set(\"scaleY\", options.scaleY);\n          this.angle = options.angle;\n          this.skewX = options.skewX;\n          this.skewY = 0;\n        }\n      },\n\n      /**\n       * This function is an helper for svg import. it removes the transform matrix\n       * and set to object properties that fabricjs can handle\n       * @private\n       * @param {Object} preserveAspectRatioOptions\n       * @return {thisArg}\n       */\n      _removeTransformMatrix: function (preserveAspectRatioOptions) {\n        var center = this._findCenterFromElement();\n        if (this.transformMatrix) {\n          this._assignTransformMatrixProps();\n          center = fabric.util.transformPoint(center, this.transformMatrix);\n        }\n        this.transformMatrix = null;\n        if (preserveAspectRatioOptions) {\n          this.scaleX *= preserveAspectRatioOptions.scaleX;\n          this.scaleY *= preserveAspectRatioOptions.scaleY;\n          this.cropX = preserveAspectRatioOptions.cropX;\n          this.cropY = preserveAspectRatioOptions.cropY;\n          center.x += preserveAspectRatioOptions.offsetLeft;\n          center.y += preserveAspectRatioOptions.offsetTop;\n          this.width = preserveAspectRatioOptions.width;\n          this.height = preserveAspectRatioOptions.height;\n        }\n        this.setPositionByOrigin(center, \"center\", \"center\");\n      },\n\n      /**\n       * Clones an instance, using a callback method will work for every object.\n       * @param {Function} callback Callback is invoked with a clone as a first argument\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       */\n      clone: function (callback, propertiesToInclude) {\n        var objectForm = this.toObject(propertiesToInclude);\n        if (this.constructor.fromObject) {\n          this.constructor.fromObject(objectForm, callback);\n        } else {\n          fabric.Object._fromObject(\"Object\", objectForm, callback);\n        }\n      },\n\n      /**\n       * Creates an instance of fabric.Image out of an object\n       * could make use of both toDataUrl or toCanvasElement.\n       * @param {Function} callback callback, invoked with an instance as a first argument\n       * @param {Object} [options] for clone as image, passed to toDataURL\n       * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n       * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n       * @param {Number} [options.multiplier=1] Multiplier to scale by\n       * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n       * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n       * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n       * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n       * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n       * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n       * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n       * @return {fabric.Object} thisArg\n       */\n      cloneAsImage: function (callback, options) {\n        var canvasEl = this.toCanvasElement(options);\n        if (callback) {\n          callback(new fabric.Image(canvasEl));\n        }\n        return this;\n      },\n\n      /**\n       * Converts an object into a HTMLCanvas element\n       * @param {Object} options Options object\n       * @param {Number} [options.multiplier=1] Multiplier to scale by\n       * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n       * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n       * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n       * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n       * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n       * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n       * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n       * @return {HTMLCanvasElement} Returns DOM element <canvas> with the fabric.Object\n       */\n      toCanvasElement: function (options) {\n        options || (options = {});\n\n        var utils = fabric.util,\n          origParams = utils.saveObjectTransform(this),\n          originalGroup = this.group,\n          originalShadow = this.shadow,\n          abs = Math.abs,\n          multiplier =\n            (options.multiplier || 1) *\n            (options.enableRetinaScaling ? fabric.devicePixelRatio : 1);\n        delete this.group;\n        if (options.withoutTransform) {\n          utils.resetObjectTransform(this);\n        }\n        if (options.withoutShadow) {\n          this.shadow = null;\n        }\n\n        var el = fabric.util.createCanvasElement(),\n          // skip canvas zoom and calculate with setCoords now.\n          boundingRect = this.getBoundingRect(true, true),\n          shadow = this.shadow,\n          scaling,\n          shadowOffset = { x: 0, y: 0 },\n          shadowBlur,\n          width,\n          height;\n\n        if (shadow) {\n          shadowBlur = shadow.blur;\n          if (shadow.nonScaling) {\n            scaling = { scaleX: 1, scaleY: 1 };\n          } else {\n            scaling = this.getObjectScaling();\n          }\n          // consider non scaling shadow.\n          shadowOffset.x =\n            2 *\n            Math.round(abs(shadow.offsetX) + shadowBlur) *\n            abs(scaling.scaleX);\n          shadowOffset.y =\n            2 *\n            Math.round(abs(shadow.offsetY) + shadowBlur) *\n            abs(scaling.scaleY);\n        }\n        width = boundingRect.width + shadowOffset.x;\n        height = boundingRect.height + shadowOffset.y;\n        // if the current width/height is not an integer\n        // we need to make it so.\n        el.width = Math.ceil(width);\n        el.height = Math.ceil(height);\n        var canvas = new fabric.StaticCanvas(el, {\n          enableRetinaScaling: false,\n          renderOnAddRemove: false,\n          skipOffscreen: false,\n        });\n        if (options.format === \"jpeg\") {\n          canvas.backgroundColor = \"#fff\";\n        }\n        this.setPositionByOrigin(\n          new fabric.Point(canvas.width / 2, canvas.height / 2),\n          \"center\",\n          \"center\"\n        );\n\n        var originalCanvas = this.canvas;\n        canvas.add(this);\n        var canvasEl = canvas.toCanvasElement(multiplier || 1, options);\n        this.shadow = originalShadow;\n        this.set(\"canvas\", originalCanvas);\n        if (originalGroup) {\n          this.group = originalGroup;\n        }\n        this.set(origParams).setCoords();\n        // canvas.dispose will call image.dispose that will nullify the elements\n        // since this canvas is a simple element for the process, we remove references\n        // to objects in this way in order to avoid object trashing.\n        canvas._objects = [];\n        canvas.dispose();\n        canvas = null;\n\n        return canvasEl;\n      },\n\n      /**\n       * Converts an object into a data-url-like string\n       * @param {Object} options Options object\n       * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n       * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n       * @param {Number} [options.multiplier=1] Multiplier to scale by\n       * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n       * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n       * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n       * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n       * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n       * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n       * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n       * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n       */\n      toDataURL: function (options) {\n        options || (options = {});\n        return fabric.util.toDataURL(\n          this.toCanvasElement(options),\n          options.format || \"png\",\n          options.quality || 1\n        );\n      },\n\n      /**\n       * Returns true if specified type is identical to the type of an instance\n       * @param {String} type Type to check against\n       * @return {Boolean}\n       */\n      isType: function (type) {\n        return this.type === type;\n      },\n\n      /**\n       * Returns complexity of an instance\n       * @return {Number} complexity of this instance (is 1 unless subclassed)\n       */\n      complexity: function () {\n        return 1;\n      },\n\n      /**\n       * Returns a JSON representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} JSON\n       */\n      toJSON: function (propertiesToInclude) {\n        // delegate, not alias\n        return this.toObject(propertiesToInclude);\n      },\n\n      /**\n       * Sets \"angle\" of an instance with centered rotation\n       * @param {Number} angle Angle value (in degrees)\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      rotate: function (angle) {\n        var shouldCenterOrigin =\n          (this.originX !== \"center\" || this.originY !== \"center\") &&\n          this.centeredRotation;\n\n        if (shouldCenterOrigin) {\n          this._setOriginToCenter();\n        }\n\n        this.set(\"angle\", angle);\n\n        if (shouldCenterOrigin) {\n          this._resetOrigin();\n        }\n\n        return this;\n      },\n\n      /**\n       * Centers object horizontally on canvas to which it was added last.\n       * You might need to call `setCoords` on an object after centering, to update controls area.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      centerH: function () {\n        this.canvas && this.canvas.centerObjectH(this);\n        return this;\n      },\n\n      /**\n       * Centers object horizontally on current viewport of canvas to which it was added last.\n       * You might need to call `setCoords` on an object after centering, to update controls area.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      viewportCenterH: function () {\n        this.canvas && this.canvas.viewportCenterObjectH(this);\n        return this;\n      },\n\n      /**\n       * Centers object vertically on canvas to which it was added last.\n       * You might need to call `setCoords` on an object after centering, to update controls area.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      centerV: function () {\n        this.canvas && this.canvas.centerObjectV(this);\n        return this;\n      },\n\n      /**\n       * Centers object vertically on current viewport of canvas to which it was added last.\n       * You might need to call `setCoords` on an object after centering, to update controls area.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      viewportCenterV: function () {\n        this.canvas && this.canvas.viewportCenterObjectV(this);\n        return this;\n      },\n\n      /**\n       * Centers object vertically and horizontally on canvas to which is was added last\n       * You might need to call `setCoords` on an object after centering, to update controls area.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      center: function () {\n        this.canvas && this.canvas.centerObject(this);\n        return this;\n      },\n\n      /**\n       * Centers object on current viewport of canvas to which it was added last.\n       * You might need to call `setCoords` on an object after centering, to update controls area.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      viewportCenter: function () {\n        this.canvas && this.canvas.viewportCenterObject(this);\n        return this;\n      },\n\n      /**\n       * Returns coordinates of a pointer relative to an object\n       * @param {Event} e Event to operate upon\n       * @param {Object} [pointer] Pointer to operate upon (instead of event)\n       * @return {Object} Coordinates of a pointer (x, y)\n       */\n      getLocalPointer: function (e, pointer) {\n        pointer = pointer || this.canvas.getPointer(e);\n        var pClicked = new fabric.Point(pointer.x, pointer.y),\n          objectLeftTop = this._getLeftTopCoords();\n        if (this.angle) {\n          pClicked = fabric.util.rotatePoint(\n            pClicked,\n            objectLeftTop,\n            degreesToRadians(-this.angle)\n          );\n        }\n        return {\n          x: pClicked.x - objectLeftTop.x,\n          y: pClicked.y - objectLeftTop.y,\n        };\n      },\n\n      /**\n       * Sets canvas globalCompositeOperation for specific object\n       * custom composition operation for the particular object can be specified using globalCompositeOperation property\n       * @param {CanvasRenderingContext2D} ctx Rendering canvas context\n       */\n      _setupCompositeOperation: function (ctx) {\n        if (this.globalCompositeOperation) {\n          ctx.globalCompositeOperation = this.globalCompositeOperation;\n        }\n      },\n    }\n  );\n\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Object);\n\n  extend(fabric.Object.prototype, fabric.Observable);\n\n  /**\n   * Defines the number of fraction digits to use when serializing object values.\n   * You can use it to increase/decrease precision of such values like left, top, scaleX, scaleY, etc.\n   * @static\n   * @memberOf fabric.Object\n   * @constant\n   * @type Number\n   */\n  fabric.Object.NUM_FRACTION_DIGITS = 2;\n\n  fabric.Object._fromObject = function (\n    className,\n    object,\n    callback,\n    extraParam\n  ) {\n    var klass = fabric[className];\n    object = clone(object, true);\n    fabric.util.enlivenPatterns(\n      [object.fill, object.stroke],\n      function (patterns) {\n        if (typeof patterns[0] !== \"undefined\") {\n          object.fill = patterns[0];\n        }\n        if (typeof patterns[1] !== \"undefined\") {\n          object.stroke = patterns[1];\n        }\n        fabric.util.enlivenObjects([object.clipPath], function (enlivedProps) {\n          object.clipPath = enlivedProps[0];\n          var instance = extraParam\n            ? new klass(object[extraParam], object)\n            : new klass(object);\n          callback && callback(instance);\n        });\n      }\n    );\n  };\n\n  /**\n   * Unique id used internally when creating SVG elements\n   * @static\n   * @memberOf fabric.Object\n   * @type Number\n   */\n  fabric.Object.__uid = 0;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function () {\n  var degreesToRadians = fabric.util.degreesToRadians,\n    originXOffset = {\n      left: -0.5,\n      center: 0,\n      right: 0.5,\n    },\n    originYOffset = {\n      top: -0.5,\n      center: 0,\n      bottom: 0.5,\n    };\n\n  fabric.util.object.extend(\n    fabric.Object.prototype,\n    /** @lends fabric.Object.prototype */ {\n      /**\n       * Translates the coordinates from a set of origin to another (based on the object's dimensions)\n       * @param {fabric.Point} point The point which corresponds to the originX and originY params\n       * @param {String} fromOriginX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} fromOriginY Vertical origin: 'top', 'center' or 'bottom'\n       * @param {String} toOriginX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} toOriginY Vertical origin: 'top', 'center' or 'bottom'\n       * @return {fabric.Point}\n       */\n      translateToGivenOrigin: function (\n        point,\n        fromOriginX,\n        fromOriginY,\n        toOriginX,\n        toOriginY\n      ) {\n        var x = point.x,\n          y = point.y,\n          offsetX,\n          offsetY,\n          dim;\n\n        if (typeof fromOriginX === \"string\") {\n          fromOriginX = originXOffset[fromOriginX];\n        } else {\n          fromOriginX -= 0.5;\n        }\n\n        if (typeof toOriginX === \"string\") {\n          toOriginX = originXOffset[toOriginX];\n        } else {\n          toOriginX -= 0.5;\n        }\n\n        offsetX = toOriginX - fromOriginX;\n\n        if (typeof fromOriginY === \"string\") {\n          fromOriginY = originYOffset[fromOriginY];\n        } else {\n          fromOriginY -= 0.5;\n        }\n\n        if (typeof toOriginY === \"string\") {\n          toOriginY = originYOffset[toOriginY];\n        } else {\n          toOriginY -= 0.5;\n        }\n\n        offsetY = toOriginY - fromOriginY;\n\n        if (offsetX || offsetY) {\n          dim = this._getTransformedDimensions();\n          x = point.x + offsetX * dim.x;\n          y = point.y + offsetY * dim.y;\n        }\n\n        return new fabric.Point(x, y);\n      },\n\n      /**\n       * Translates the coordinates from origin to center coordinates (based on the object's dimensions)\n       * @param {fabric.Point} point The point which corresponds to the originX and originY params\n       * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n       * @return {fabric.Point}\n       */\n      translateToCenterPoint: function (point, originX, originY) {\n        var p = this.translateToGivenOrigin(\n          point,\n          originX,\n          originY,\n          \"center\",\n          \"center\"\n        );\n        if (this.angle) {\n          return fabric.util.rotatePoint(\n            p,\n            point,\n            degreesToRadians(this.angle)\n          );\n        }\n        return p;\n      },\n\n      /**\n       * Translates the coordinates from center to origin coordinates (based on the object's dimensions)\n       * @param {fabric.Point} center The point which corresponds to center of the object\n       * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n       * @return {fabric.Point}\n       */\n      translateToOriginPoint: function (center, originX, originY) {\n        var p = this.translateToGivenOrigin(\n          center,\n          \"center\",\n          \"center\",\n          originX,\n          originY\n        );\n        if (this.angle) {\n          return fabric.util.rotatePoint(\n            p,\n            center,\n            degreesToRadians(this.angle)\n          );\n        }\n        return p;\n      },\n\n      /**\n       * Returns the real center coordinates of the object\n       * @return {fabric.Point}\n       */\n      getCenterPoint: function () {\n        var leftTop = new fabric.Point(this.left, this.top);\n        return this.translateToCenterPoint(leftTop, this.originX, this.originY);\n      },\n\n      /**\n       * Returns the coordinates of the object based on center coordinates\n       * @param {fabric.Point} point The point which corresponds to the originX and originY params\n       * @return {fabric.Point}\n       */\n      // getOriginPoint: function(center) {\n      //   return this.translateToOriginPoint(center, this.originX, this.originY);\n      // },\n\n      /**\n       * Returns the coordinates of the object as if it has a different origin\n       * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n       * @return {fabric.Point}\n       */\n      getPointByOrigin: function (originX, originY) {\n        var center = this.getCenterPoint();\n        return this.translateToOriginPoint(center, originX, originY);\n      },\n\n      /**\n       * Returns the point in local coordinates\n       * @param {fabric.Point} point The point relative to the global coordinate system\n       * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n       * @return {fabric.Point}\n       */\n      toLocalPoint: function (point, originX, originY) {\n        var center = this.getCenterPoint(),\n          p,\n          p2;\n\n        if (typeof originX !== \"undefined\" && typeof originY !== \"undefined\") {\n          p = this.translateToGivenOrigin(\n            center,\n            \"center\",\n            \"center\",\n            originX,\n            originY\n          );\n        } else {\n          p = new fabric.Point(this.left, this.top);\n        }\n\n        p2 = new fabric.Point(point.x, point.y);\n        if (this.angle) {\n          p2 = fabric.util.rotatePoint(\n            p2,\n            center,\n            -degreesToRadians(this.angle)\n          );\n        }\n        return p2.subtractEquals(p);\n      },\n\n      /**\n       * Returns the point in global coordinates\n       * @param {fabric.Point} The point relative to the local coordinate system\n       * @return {fabric.Point}\n       */\n      // toGlobalPoint: function(point) {\n      //   return fabric.util.rotatePoint(point, this.getCenterPoint(), degreesToRadians(this.angle)).addEquals(new fabric.Point(this.left, this.top));\n      // },\n\n      /**\n       * Sets the position of the object taking into consideration the object's origin\n       * @param {fabric.Point} pos The new position of the object\n       * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n       * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n       * @return {void}\n       */\n      setPositionByOrigin: function (pos, originX, originY) {\n        var center = this.translateToCenterPoint(pos, originX, originY),\n          position = this.translateToOriginPoint(\n            center,\n            this.originX,\n            this.originY\n          );\n        this.set(\"left\", position.x);\n        this.set(\"top\", position.y);\n      },\n\n      /**\n       * @param {String} to One of 'left', 'center', 'right'\n       */\n      adjustPosition: function (to) {\n        var angle = degreesToRadians(this.angle),\n          hypotFull = this.getScaledWidth(),\n          xFull = fabric.util.cos(angle) * hypotFull,\n          yFull = fabric.util.sin(angle) * hypotFull,\n          offsetFrom,\n          offsetTo;\n\n        //TODO: this function does not consider mixed situation like top, center.\n        if (typeof this.originX === \"string\") {\n          offsetFrom = originXOffset[this.originX];\n        } else {\n          offsetFrom = this.originX - 0.5;\n        }\n        if (typeof to === \"string\") {\n          offsetTo = originXOffset[to];\n        } else {\n          offsetTo = to - 0.5;\n        }\n        this.left += xFull * (offsetTo - offsetFrom);\n        this.top += yFull * (offsetTo - offsetFrom);\n        this.setCoords();\n        this.originX = to;\n      },\n\n      /**\n       * Sets the origin/position of the object to it's center point\n       * @private\n       * @return {void}\n       */\n      _setOriginToCenter: function () {\n        this._originalOriginX = this.originX;\n        this._originalOriginY = this.originY;\n\n        var center = this.getCenterPoint();\n\n        this.originX = \"center\";\n        this.originY = \"center\";\n\n        this.left = center.x;\n        this.top = center.y;\n      },\n\n      /**\n       * Resets the origin/position of the object to it's original origin\n       * @private\n       * @return {void}\n       */\n      _resetOrigin: function () {\n        var originPoint = this.translateToOriginPoint(\n          this.getCenterPoint(),\n          this._originalOriginX,\n          this._originalOriginY\n        );\n\n        this.originX = this._originalOriginX;\n        this.originY = this._originalOriginY;\n\n        this.left = originPoint.x;\n        this.top = originPoint.y;\n\n        this._originalOriginX = null;\n        this._originalOriginY = null;\n      },\n\n      /**\n       * @private\n       */\n      _getLeftTopCoords: function () {\n        return this.translateToOriginPoint(\n          this.getCenterPoint(),\n          \"left\",\n          \"top\"\n        );\n      },\n    }\n  );\n})();\n\n(function () {\n  function arrayFromCoords(coords) {\n    return [\n      new fabric.Point(coords.tl.x, coords.tl.y),\n      new fabric.Point(coords.tr.x, coords.tr.y),\n      new fabric.Point(coords.br.x, coords.br.y),\n      new fabric.Point(coords.bl.x, coords.bl.y),\n    ];\n  }\n\n  var util = fabric.util,\n    degreesToRadians = util.degreesToRadians,\n    multiplyMatrices = util.multiplyTransformMatrices,\n    transformPoint = util.transformPoint;\n\n  util.object.extend(\n    fabric.Object.prototype,\n    /** @lends fabric.Object.prototype */ {\n      /**\n       * Describe object's corner position in canvas element coordinates.\n       * properties are depending on control keys and padding the main controls.\n       * each property is an object with x, y and corner.\n       * The `corner` property contains in a similar manner the 4 points of the\n       * interactive area of the corner.\n       * The coordinates depends from the controls positionHandler and are used\n       * to draw and locate controls\n       * @memberOf fabric.Object.prototype\n       */\n      oCoords: null,\n\n      /**\n       * Describe object's corner position in canvas object absolute coordinates\n       * properties are tl,tr,bl,br and describe the four main corner.\n       * each property is an object with x, y, instance of Fabric.Point.\n       * The coordinates depends from this properties: width, height, scaleX, scaleY\n       * skewX, skewY, angle, strokeWidth, top, left.\n       * Those coordinates are useful to understand where an object is. They get updated\n       * with oCoords but they do not need to be updated when zoom or panning change.\n       * The coordinates get updated with @method setCoords.\n       * You can calculate them without updating with @method calcACoords();\n       * @memberOf fabric.Object.prototype\n       */\n      aCoords: null,\n\n      /**\n       * Describe object's corner position in canvas element coordinates.\n       * includes padding. Used of object detection.\n       * set and refreshed with setCoords and calcCoords.\n       * @memberOf fabric.Object.prototype\n       */\n      lineCoords: null,\n\n      /**\n       * storage for object transform matrix\n       */\n      ownMatrixCache: null,\n\n      /**\n       * storage for object full transform matrix\n       */\n      matrixCache: null,\n\n      /**\n       * custom controls interface\n       * controls are added by default_controls.js\n       */\n      controls: {},\n\n      /**\n       * return correct set of coordinates for intersection\n       * this will return either aCoords or lineCoords.\n       * @param {Boolean} absolute will return aCoords if true or lineCoords\n       * @return {Object} {tl, tr, br, bl} points\n       */\n      _getCoords: function (absolute, calculate) {\n        if (calculate) {\n          return absolute ? this.calcACoords() : this.calcLineCoords();\n        }\n        if (!this.aCoords || !this.lineCoords) {\n          this.setCoords(true);\n        }\n        return absolute ? this.aCoords : this.lineCoords;\n      },\n\n      /**\n       * return correct set of coordinates for intersection\n       * this will return either aCoords or lineCoords.\n       * The coords are returned in an array.\n       * @return {Array} [tl, tr, br, bl] of points\n       */\n      getCoords: function (absolute, calculate) {\n        return arrayFromCoords(this._getCoords(absolute, calculate));\n      },\n\n      /**\n       * Checks if object intersects with an area formed by 2 points\n       * @param {Object} pointTL top-left point of area\n       * @param {Object} pointBR bottom-right point of area\n       * @param {Boolean} [absolute] use coordinates without viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if object intersects with an area formed by 2 points\n       */\n      intersectsWithRect: function (pointTL, pointBR, absolute, calculate) {\n        var coords = this.getCoords(absolute, calculate),\n          intersection = fabric.Intersection.intersectPolygonRectangle(\n            coords,\n            pointTL,\n            pointBR\n          );\n        return intersection.status === \"Intersection\";\n      },\n\n      /**\n       * Checks if object intersects with another object\n       * @param {Object} other Object to test\n       * @param {Boolean} [absolute] use coordinates without viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if object intersects with another object\n       */\n      intersectsWithObject: function (other, absolute, calculate) {\n        var intersection = fabric.Intersection.intersectPolygonPolygon(\n          this.getCoords(absolute, calculate),\n          other.getCoords(absolute, calculate)\n        );\n\n        return (\n          intersection.status === \"Intersection\" ||\n          other.isContainedWithinObject(this, absolute, calculate) ||\n          this.isContainedWithinObject(other, absolute, calculate)\n        );\n      },\n\n      /**\n       * Checks if object is fully contained within area of another object\n       * @param {Object} other Object to test\n       * @param {Boolean} [absolute] use coordinates without viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if object is fully contained within area of another object\n       */\n      isContainedWithinObject: function (other, absolute, calculate) {\n        var points = this.getCoords(absolute, calculate),\n          otherCoords = absolute ? other.aCoords : other.lineCoords,\n          i = 0,\n          lines = other._getImageLines(otherCoords);\n        for (; i < 4; i++) {\n          if (!other.containsPoint(points[i], lines)) {\n            return false;\n          }\n        }\n        return true;\n      },\n\n      /**\n       * Checks if object is fully contained within area formed by 2 points\n       * @param {Object} pointTL top-left point of area\n       * @param {Object} pointBR bottom-right point of area\n       * @param {Boolean} [absolute] use coordinates without viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if object is fully contained within area formed by 2 points\n       */\n      isContainedWithinRect: function (pointTL, pointBR, absolute, calculate) {\n        var boundingRect = this.getBoundingRect(absolute, calculate);\n\n        return (\n          boundingRect.left >= pointTL.x &&\n          boundingRect.left + boundingRect.width <= pointBR.x &&\n          boundingRect.top >= pointTL.y &&\n          boundingRect.top + boundingRect.height <= pointBR.y\n        );\n      },\n\n      /**\n       * Checks if point is inside the object\n       * @param {fabric.Point} point Point to check against\n       * @param {Object} [lines] object returned from @method _getImageLines\n       * @param {Boolean} [absolute] use coordinates without viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if point is inside the object\n       */\n      containsPoint: function (point, lines, absolute, calculate) {\n        var coords = this._getCoords(absolute, calculate),\n          lines = lines || this._getImageLines(coords),\n          xPoints = this._findCrossPoints(point, lines);\n        // if xPoints is odd then point is inside the object\n        return xPoints !== 0 && xPoints % 2 === 1;\n      },\n\n      /**\n       * Checks if object is contained within the canvas with current viewportTransform\n       * the check is done stopping at first point that appears on screen\n       * @param {Boolean} [calculate] use coordinates of current position instead of .aCoords\n       * @return {Boolean} true if object is fully or partially contained within canvas\n       */\n      isOnScreen: function (calculate) {\n        if (!this.canvas) {\n          return false;\n        }\n        var pointTL = this.canvas.vptCoords.tl,\n          pointBR = this.canvas.vptCoords.br;\n        var points = this.getCoords(true, calculate);\n        // if some point is on screen, the object is on screen.\n        if (\n          points.some(function (point) {\n            return (\n              point.x <= pointBR.x &&\n              point.x >= pointTL.x &&\n              point.y <= pointBR.y &&\n              point.y >= pointTL.y\n            );\n          })\n        ) {\n          return true;\n        }\n        // no points on screen, check intersection with absolute coordinates\n        if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\n          return true;\n        }\n        return this._containsCenterOfCanvas(pointTL, pointBR, calculate);\n      },\n\n      /**\n       * Checks if the object contains the midpoint between canvas extremities\n       * Does not make sense outside the context of isOnScreen and isPartiallyOnScreen\n       * @private\n       * @param {Fabric.Point} pointTL Top Left point\n       * @param {Fabric.Point} pointBR Top Right point\n       * @param {Boolean} calculate use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if the object contains the point\n       */\n      _containsCenterOfCanvas: function (pointTL, pointBR, calculate) {\n        // worst case scenario the object is so big that contains the screen\n        var centerPoint = {\n          x: (pointTL.x + pointBR.x) / 2,\n          y: (pointTL.y + pointBR.y) / 2,\n        };\n        if (this.containsPoint(centerPoint, null, true, calculate)) {\n          return true;\n        }\n        return false;\n      },\n\n      /**\n       * Checks if object is partially contained within the canvas with current viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n       * @return {Boolean} true if object is partially contained within canvas\n       */\n      isPartiallyOnScreen: function (calculate) {\n        if (!this.canvas) {\n          return false;\n        }\n        var pointTL = this.canvas.vptCoords.tl,\n          pointBR = this.canvas.vptCoords.br;\n        if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\n          return true;\n        }\n        var allPointsAreOutside = this.getCoords(true, calculate).every(\n          function (point) {\n            return (\n              (point.x >= pointBR.x || point.x <= pointTL.x) &&\n              (point.y >= pointBR.y || point.y <= pointTL.y)\n            );\n          }\n        );\n        return (\n          allPointsAreOutside &&\n          this._containsCenterOfCanvas(pointTL, pointBR, calculate)\n        );\n      },\n\n      /**\n       * Method that returns an object with the object edges in it, given the coordinates of the corners\n       * @private\n       * @param {Object} oCoords Coordinates of the object corners\n       */\n      _getImageLines: function (oCoords) {\n        var lines = {\n          topline: {\n            o: oCoords.tl,\n            d: oCoords.tr,\n          },\n          rightline: {\n            o: oCoords.tr,\n            d: oCoords.br,\n          },\n          bottomline: {\n            o: oCoords.br,\n            d: oCoords.bl,\n          },\n          leftline: {\n            o: oCoords.bl,\n            d: oCoords.tl,\n          },\n        };\n\n        // // debugging\n        // if (this.canvas.contextTop) {\n        //   this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n        //   this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n        //\n        //   this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n        //   this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n        //\n        //   this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n        //   this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n        //\n        //   this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n        //   this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n        // }\n\n        return lines;\n      },\n\n      /**\n       * Helper method to determine how many cross points are between the 4 object edges\n       * and the horizontal line determined by a point on canvas\n       * @private\n       * @param {fabric.Point} point Point to check\n       * @param {Object} lines Coordinates of the object being evaluated\n       */\n      // remove yi, not used but left code here just in case.\n      _findCrossPoints: function (point, lines) {\n        var b1,\n          b2,\n          a1,\n          a2,\n          xi, // yi,\n          xcount = 0,\n          iLine;\n\n        for (var lineKey in lines) {\n          iLine = lines[lineKey];\n          // optimisation 1: line below point. no cross\n          if (iLine.o.y < point.y && iLine.d.y < point.y) {\n            continue;\n          }\n          // optimisation 2: line above point. no cross\n          if (iLine.o.y >= point.y && iLine.d.y >= point.y) {\n            continue;\n          }\n          // optimisation 3: vertical line case\n          if (iLine.o.x === iLine.d.x && iLine.o.x >= point.x) {\n            xi = iLine.o.x;\n            // yi = point.y;\n          }\n          // calculate the intersection point\n          else {\n            b1 = 0;\n            b2 = (iLine.d.y - iLine.o.y) / (iLine.d.x - iLine.o.x);\n            a1 = point.y - b1 * point.x;\n            a2 = iLine.o.y - b2 * iLine.o.x;\n\n            xi = -(a1 - a2) / (b1 - b2);\n            // yi = a1 + b1 * xi;\n          }\n          // dont count xi < point.x cases\n          if (xi >= point.x) {\n            xcount += 1;\n          }\n          // optimisation 4: specific for square images\n          if (xcount === 2) {\n            break;\n          }\n        }\n        return xcount;\n      },\n\n      /**\n       * Returns coordinates of object's bounding rectangle (left, top, width, height)\n       * the box is intended as aligned to axis of canvas.\n       * @param {Boolean} [absolute] use coordinates without viewportTransform\n       * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords / .aCoords\n       * @return {Object} Object with left, top, width, height properties\n       */\n      getBoundingRect: function (absolute, calculate) {\n        var coords = this.getCoords(absolute, calculate);\n        return util.makeBoundingBoxFromPoints(coords);\n      },\n\n      /**\n       * Returns width of an object's bounding box counting transformations\n       * before 2.0 it was named getWidth();\n       * @return {Number} width value\n       */\n      getScaledWidth: function () {\n        return this._getTransformedDimensions().x;\n      },\n\n      /**\n       * Returns height of an object bounding box counting transformations\n       * before 2.0 it was named getHeight();\n       * @return {Number} height value\n       */\n      getScaledHeight: function () {\n        return this._getTransformedDimensions().y;\n      },\n\n      /**\n       * Makes sure the scale is valid and modifies it if necessary\n       * @private\n       * @param {Number} value\n       * @return {Number}\n       */\n      _constrainScale: function (value) {\n        if (Math.abs(value) < this.minScaleLimit) {\n          if (value < 0) {\n            return -this.minScaleLimit;\n          } else {\n            return this.minScaleLimit;\n          }\n        } else if (value === 0) {\n          return 0.0001;\n        }\n        return value;\n      },\n\n      /**\n       * Scales an object (equally by x and y)\n       * @param {Number} value Scale factor\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      scale: function (value) {\n        this._set(\"scaleX\", value);\n        this._set(\"scaleY\", value);\n        return this.setCoords();\n      },\n\n      /**\n       * Scales an object to a given width, with respect to bounding box (scaling by x/y equally)\n       * @param {Number} value New width value\n       * @param {Boolean} absolute ignore viewport\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      scaleToWidth: function (value, absolute) {\n        // adjust to bounding rect factor so that rotated shapes would fit as well\n        var boundingRectFactor =\n          this.getBoundingRect(absolute).width / this.getScaledWidth();\n        return this.scale(value / this.width / boundingRectFactor);\n      },\n\n      /**\n       * Scales an object to a given height, with respect to bounding box (scaling by x/y equally)\n       * @param {Number} value New height value\n       * @param {Boolean} absolute ignore viewport\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      scaleToHeight: function (value, absolute) {\n        // adjust to bounding rect factor so that rotated shapes would fit as well\n        var boundingRectFactor =\n          this.getBoundingRect(absolute).height / this.getScaledHeight();\n        return this.scale(value / this.height / boundingRectFactor);\n      },\n\n      /**\n       * Calculates and returns the .coords of an object.\n       * unused by the library, only for the end dev.\n       * @return {Object} Object with tl, tr, br, bl ....\n       * @chainable\n       * @deprecated\n       */\n      calcCoords: function (absolute) {\n        // this is a compatibility function to avoid removing calcCoords now.\n        if (absolute) {\n          return this.calcACoords();\n        }\n        return this.calcOCoords();\n      },\n\n      calcLineCoords: function () {\n        var vpt = this.getViewportTransform(),\n          padding = this.padding,\n          angle = degreesToRadians(this.angle),\n          cos = util.cos(angle),\n          sin = util.sin(angle),\n          cosP = cos * padding,\n          sinP = sin * padding,\n          cosPSinP = cosP + sinP,\n          cosPMinusSinP = cosP - sinP,\n          aCoords = this.calcACoords();\n\n        var lineCoords = {\n          tl: transformPoint(aCoords.tl, vpt),\n          tr: transformPoint(aCoords.tr, vpt),\n          bl: transformPoint(aCoords.bl, vpt),\n          br: transformPoint(aCoords.br, vpt),\n        };\n\n        if (padding) {\n          lineCoords.tl.x -= cosPMinusSinP;\n          lineCoords.tl.y -= cosPSinP;\n          lineCoords.tr.x += cosPSinP;\n          lineCoords.tr.y -= cosPMinusSinP;\n          lineCoords.bl.x -= cosPSinP;\n          lineCoords.bl.y += cosPMinusSinP;\n          lineCoords.br.x += cosPMinusSinP;\n          lineCoords.br.y += cosPSinP;\n        }\n\n        return lineCoords;\n      },\n\n      calcOCoords: function () {\n        var rotateMatrix = this._calcRotateMatrix(),\n          translateMatrix = this._calcTranslateMatrix(),\n          vpt = this.getViewportTransform(),\n          startMatrix = multiplyMatrices(vpt, translateMatrix),\n          finalMatrix = multiplyMatrices(startMatrix, rotateMatrix),\n          finalMatrix = multiplyMatrices(finalMatrix, [\n            1 / vpt[0],\n            0,\n            0,\n            1 / vpt[3],\n            0,\n            0,\n          ]),\n          dim = this._calculateCurrentDimensions(),\n          coords = {};\n        this.forEachControl(function (control, key, fabricObject) {\n          coords[key] = control.positionHandler(dim, finalMatrix, fabricObject);\n        });\n\n        // debug code\n        // var canvas = this.canvas;\n        // setTimeout(function() {\n        //   canvas.contextTop.clearRect(0, 0, 700, 700);\n        //   canvas.contextTop.fillStyle = 'green';\n        //   Object.keys(coords).forEach(function(key) {\n        //     var control = coords[key];\n        //     canvas.contextTop.fillRect(control.x, control.y, 3, 3);\n        //   });\n        // }, 50);\n        return coords;\n      },\n\n      calcACoords: function () {\n        var rotateMatrix = this._calcRotateMatrix(),\n          translateMatrix = this._calcTranslateMatrix(),\n          finalMatrix = multiplyMatrices(translateMatrix, rotateMatrix),\n          dim = this._getTransformedDimensions(),\n          w = dim.x / 2,\n          h = dim.y / 2;\n        return {\n          // corners\n          tl: transformPoint({ x: -w, y: -h }, finalMatrix),\n          tr: transformPoint({ x: w, y: -h }, finalMatrix),\n          bl: transformPoint({ x: -w, y: h }, finalMatrix),\n          br: transformPoint({ x: w, y: h }, finalMatrix),\n        };\n      },\n\n      /**\n       * Sets corner position coordinates based on current angle, width and height.\n       * oCoords are used to find the corners\n       * aCoords are used to quickly find an object on the canvas\n       * lineCoords are used to quickly find object during pointer events.\n       * See {@link https://github.com/kangax/fabric.js/wiki/When-to-call-setCoords|When-to-call-setCoords}\n       * @param {Boolean} [skipCorners] skip calculation of oCoords.\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      setCoords: function (skipCorners) {\n        this.aCoords = this.calcACoords();\n        this.lineCoords = this.calcLineCoords();\n        if (skipCorners) {\n          return this;\n        }\n        // set coordinates of the draggable boxes in the corners used to scale/rotate the image\n        this.oCoords = this.calcOCoords();\n        this._setCornerCoords && this._setCornerCoords();\n        return this;\n      },\n\n      /**\n       * calculate rotation matrix of an object\n       * @return {Array} rotation matrix for the object\n       */\n      _calcRotateMatrix: function () {\n        return util.calcRotateMatrix(this);\n      },\n\n      /**\n       * calculate the translation matrix for an object transform\n       * @return {Array} rotation matrix for the object\n       */\n      _calcTranslateMatrix: function () {\n        var center = this.getCenterPoint();\n        return [1, 0, 0, 1, center.x, center.y];\n      },\n\n      transformMatrixKey: function (skipGroup) {\n        var sep = \"_\",\n          prefix = \"\";\n        if (!skipGroup && this.group) {\n          prefix = this.group.transformMatrixKey(skipGroup) + sep;\n        }\n        return (\n          prefix +\n          this.top +\n          sep +\n          this.left +\n          sep +\n          this.scaleX +\n          sep +\n          this.scaleY +\n          sep +\n          this.skewX +\n          sep +\n          this.skewY +\n          sep +\n          this.angle +\n          sep +\n          this.originX +\n          sep +\n          this.originY +\n          sep +\n          this.width +\n          sep +\n          this.height +\n          sep +\n          this.strokeWidth +\n          this.flipX +\n          this.flipY\n        );\n      },\n\n      /**\n       * calculate transform matrix that represents the current transformations from the\n       * object's properties.\n       * @param {Boolean} [skipGroup] return transform matrix for object not counting parent transformations\n       * There are some situation in which this is useful to avoid the fake rotation.\n       * @return {Array} transform matrix for the object\n       */\n      calcTransformMatrix: function (skipGroup) {\n        var matrix = this.calcOwnMatrix();\n        if (skipGroup || !this.group) {\n          return matrix;\n        }\n        var key = this.transformMatrixKey(skipGroup),\n          cache = this.matrixCache || (this.matrixCache = {});\n        if (cache.key === key) {\n          return cache.value;\n        }\n        if (this.group) {\n          matrix = multiplyMatrices(\n            this.group.calcTransformMatrix(false),\n            matrix\n          );\n        }\n        cache.key = key;\n        cache.value = matrix;\n        return matrix;\n      },\n\n      /**\n       * calculate transform matrix that represents the current transformations from the\n       * object's properties, this matrix does not include the group transformation\n       * @return {Array} transform matrix for the object\n       */\n      calcOwnMatrix: function () {\n        var key = this.transformMatrixKey(true),\n          cache = this.ownMatrixCache || (this.ownMatrixCache = {});\n        if (cache.key === key) {\n          return cache.value;\n        }\n        var tMatrix = this._calcTranslateMatrix(),\n          options = {\n            angle: this.angle,\n            translateX: tMatrix[4],\n            translateY: tMatrix[5],\n            scaleX: this.scaleX,\n            scaleY: this.scaleY,\n            skewX: this.skewX,\n            skewY: this.skewY,\n            flipX: this.flipX,\n            flipY: this.flipY,\n          };\n        cache.key = key;\n        cache.value = util.composeMatrix(options);\n        return cache.value;\n      },\n\n      /*\n       * Calculate object dimensions from its properties\n       * @private\n       * @deprecated since 3.4.0, please use fabric.util._calcDimensionsTransformMatrix\n       * not including or including flipX, flipY to emulate the flipping boolean\n       * @return {Object} .x width dimension\n       * @return {Object} .y height dimension\n       */\n      _calcDimensionsTransformMatrix: function (skewX, skewY, flipping) {\n        return util.calcDimensionsMatrix({\n          skewX: skewX,\n          skewY: skewY,\n          scaleX: this.scaleX * (flipping && this.flipX ? -1 : 1),\n          scaleY: this.scaleY * (flipping && this.flipY ? -1 : 1),\n        });\n      },\n\n      /*\n       * Calculate object dimensions from its properties\n       * @private\n       * @return {Object} .x width dimension\n       * @return {Object} .y height dimension\n       */\n      _getNonTransformedDimensions: function () {\n        var strokeWidth = this.strokeWidth,\n          w = this.width + strokeWidth,\n          h = this.height + strokeWidth;\n        return { x: w, y: h };\n      },\n\n      /*\n       * Calculate object bounding box dimensions from its properties scale, skew.\n       * @param {Number} skewX, a value to override current skewX\n       * @param {Number} skewY, a value to override current skewY\n       * @private\n       * @return {Object} .x width dimension\n       * @return {Object} .y height dimension\n       */\n      _getTransformedDimensions: function (skewX, skewY) {\n        if (typeof skewX === \"undefined\") {\n          skewX = this.skewX;\n        }\n        if (typeof skewY === \"undefined\") {\n          skewY = this.skewY;\n        }\n        var dimensions = this._getNonTransformedDimensions(),\n          dimX,\n          dimY,\n          noSkew = skewX === 0 && skewY === 0;\n\n        if (this.strokeUniform) {\n          dimX = this.width;\n          dimY = this.height;\n        } else {\n          dimX = dimensions.x;\n          dimY = dimensions.y;\n        }\n        if (noSkew) {\n          return this._finalizeDimensions(\n            dimX * this.scaleX,\n            dimY * this.scaleY\n          );\n        }\n        var bbox = util.sizeAfterTransform(dimX, dimY, {\n          scaleX: this.scaleX,\n          scaleY: this.scaleY,\n          skewX: skewX,\n          skewY: skewY,\n        });\n        return this._finalizeDimensions(bbox.x, bbox.y);\n      },\n\n      /*\n       * Calculate object bounding box dimensions from its properties scale, skew.\n       * @param Number width width of the bbox\n       * @param Number height height of the bbox\n       * @private\n       * @return {Object} .x finalized width dimension\n       * @return {Object} .y finalized height dimension\n       */\n      _finalizeDimensions: function (width, height) {\n        return this.strokeUniform\n          ? { x: width + this.strokeWidth, y: height + this.strokeWidth }\n          : { x: width, y: height };\n      },\n\n      /*\n       * Calculate object dimensions for controls box, including padding and canvas zoom.\n       * and active selection\n       * private\n       */\n      _calculateCurrentDimensions: function () {\n        var vpt = this.getViewportTransform(),\n          dim = this._getTransformedDimensions(),\n          p = transformPoint(dim, vpt, true);\n        return p.scalarAdd(2 * this.padding);\n      },\n    }\n  );\n})();\n\nfabric.util.object.extend(\n  fabric.Object.prototype,\n  /** @lends fabric.Object.prototype */ {\n    /**\n     * Moves an object to the bottom of the stack of drawn objects\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    sendToBack: function () {\n      if (this.group) {\n        fabric.StaticCanvas.prototype.sendToBack.call(this.group, this);\n      } else if (this.canvas) {\n        this.canvas.sendToBack(this);\n      }\n      return this;\n    },\n\n    /**\n     * Moves an object to the top of the stack of drawn objects\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    bringToFront: function () {\n      if (this.group) {\n        fabric.StaticCanvas.prototype.bringToFront.call(this.group, this);\n      } else if (this.canvas) {\n        this.canvas.bringToFront(this);\n      }\n      return this;\n    },\n\n    /**\n     * Moves an object down in stack of drawn objects\n     * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    sendBackwards: function (intersecting) {\n      if (this.group) {\n        fabric.StaticCanvas.prototype.sendBackwards.call(\n          this.group,\n          this,\n          intersecting\n        );\n      } else if (this.canvas) {\n        this.canvas.sendBackwards(this, intersecting);\n      }\n      return this;\n    },\n\n    /**\n     * Moves an object up in stack of drawn objects\n     * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    bringForward: function (intersecting) {\n      if (this.group) {\n        fabric.StaticCanvas.prototype.bringForward.call(\n          this.group,\n          this,\n          intersecting\n        );\n      } else if (this.canvas) {\n        this.canvas.bringForward(this, intersecting);\n      }\n      return this;\n    },\n\n    /**\n     * Moves an object to specified level in stack of drawn objects\n     * @param {Number} index New position of object\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    moveTo: function (index) {\n      if (this.group && this.group.type !== \"activeSelection\") {\n        fabric.StaticCanvas.prototype.moveTo.call(this.group, this, index);\n      } else if (this.canvas) {\n        this.canvas.moveTo(this, index);\n      }\n      return this;\n    },\n  }\n);\n\n/* _TO_SVG_START_ */\n(function () {\n  function getSvgColorString(prop, value) {\n    if (!value) {\n      return prop + \": none; \";\n    } else if (value.toLive) {\n      return prop + \": url(#SVGID_\" + value.id + \"); \";\n    } else {\n      var color = new fabric.Color(value),\n        str = prop + \": \" + color.toRgb() + \"; \",\n        opacity = color.getAlpha();\n      if (opacity !== 1) {\n        //change the color in rgb + opacity\n        str += prop + \"-opacity: \" + opacity.toString() + \"; \";\n      }\n      return str;\n    }\n  }\n\n  var toFixed = fabric.util.toFixed;\n\n  fabric.util.object.extend(\n    fabric.Object.prototype,\n    /** @lends fabric.Object.prototype */ {\n      /**\n       * Returns styles-string for svg-export\n       * @param {Boolean} skipShadow a boolean to skip shadow filter output\n       * @return {String}\n       */\n      getSvgStyles: function (skipShadow) {\n        var fillRule = this.fillRule ? this.fillRule : \"nonzero\",\n          strokeWidth = this.strokeWidth ? this.strokeWidth : \"0\",\n          strokeDashArray = this.strokeDashArray\n            ? this.strokeDashArray.join(\" \")\n            : \"none\",\n          strokeDashOffset = this.strokeDashOffset\n            ? this.strokeDashOffset\n            : \"0\",\n          strokeLineCap = this.strokeLineCap ? this.strokeLineCap : \"butt\",\n          strokeLineJoin = this.strokeLineJoin ? this.strokeLineJoin : \"miter\",\n          strokeMiterLimit = this.strokeMiterLimit\n            ? this.strokeMiterLimit\n            : \"4\",\n          opacity = typeof this.opacity !== \"undefined\" ? this.opacity : \"1\",\n          visibility = this.visible ? \"\" : \" visibility: hidden;\",\n          filter = skipShadow ? \"\" : this.getSvgFilter(),\n          fill = getSvgColorString(\"fill\", this.fill),\n          stroke = getSvgColorString(\"stroke\", this.stroke);\n\n        return [\n          stroke,\n          \"stroke-width: \",\n          strokeWidth,\n          \"; \",\n          \"stroke-dasharray: \",\n          strokeDashArray,\n          \"; \",\n          \"stroke-linecap: \",\n          strokeLineCap,\n          \"; \",\n          \"stroke-dashoffset: \",\n          strokeDashOffset,\n          \"; \",\n          \"stroke-linejoin: \",\n          strokeLineJoin,\n          \"; \",\n          \"stroke-miterlimit: \",\n          strokeMiterLimit,\n          \"; \",\n          fill,\n          \"fill-rule: \",\n          fillRule,\n          \"; \",\n          \"opacity: \",\n          opacity,\n          \";\",\n          filter,\n          visibility,\n        ].join(\"\");\n      },\n\n      /**\n       * Returns styles-string for svg-export\n       * @param {Object} style the object from which to retrieve style properties\n       * @param {Boolean} useWhiteSpace a boolean to include an additional attribute in the style.\n       * @return {String}\n       */\n      getSvgSpanStyles: function (style, useWhiteSpace) {\n        var term = \"; \";\n        var fontFamily = style.fontFamily\n          ? \"font-family: \" +\n            (style.fontFamily.indexOf(\"'\") === -1 &&\n            style.fontFamily.indexOf('\"') === -1\n              ? \"'\" + style.fontFamily + \"'\"\n              : style.fontFamily) +\n            term\n          : \"\";\n        var strokeWidth = style.strokeWidth\n            ? \"stroke-width: \" + style.strokeWidth + term\n            : \"\",\n          fontFamily = fontFamily,\n          fontSize = style.fontSize\n            ? \"font-size: \" + style.fontSize + \"px\" + term\n            : \"\",\n          fontStyle = style.fontStyle\n            ? \"font-style: \" + style.fontStyle + term\n            : \"\",\n          fontWeight = style.fontWeight\n            ? \"font-weight: \" + style.fontWeight + term\n            : \"\",\n          fill = style.fill ? getSvgColorString(\"fill\", style.fill) : \"\",\n          stroke = style.stroke\n            ? getSvgColorString(\"stroke\", style.stroke)\n            : \"\",\n          textDecoration = this.getSvgTextDecoration(style),\n          deltaY = style.deltaY\n            ? \"baseline-shift: \" + -style.deltaY + \"; \"\n            : \"\";\n        if (textDecoration) {\n          textDecoration = \"text-decoration: \" + textDecoration + term;\n        }\n\n        return [\n          stroke,\n          strokeWidth,\n          fontFamily,\n          fontSize,\n          fontStyle,\n          fontWeight,\n          textDecoration,\n          fill,\n          deltaY,\n          useWhiteSpace ? \"white-space: pre; \" : \"\",\n        ].join(\"\");\n      },\n\n      /**\n       * Returns text-decoration property for svg-export\n       * @param {Object} style the object from which to retrieve style properties\n       * @return {String}\n       */\n      getSvgTextDecoration: function (style) {\n        return [\"overline\", \"underline\", \"line-through\"]\n          .filter(function (decoration) {\n            return style[decoration.replace(\"-\", \"\")];\n          })\n          .join(\" \");\n      },\n\n      /**\n       * Returns filter for svg shadow\n       * @return {String}\n       */\n      getSvgFilter: function () {\n        return this.shadow ? \"filter: url(#SVGID_\" + this.shadow.id + \");\" : \"\";\n      },\n\n      /**\n       * Returns id attribute for svg output\n       * @return {String}\n       */\n      getSvgCommons: function () {\n        return [\n          this.id ? 'id=\"' + this.id + '\" ' : \"\",\n          this.clipPath\n            ? 'clip-path=\"url(#' + this.clipPath.clipPathId + ')\" '\n            : \"\",\n        ].join(\"\");\n      },\n\n      /**\n       * Returns transform-string for svg-export\n       * @param {Boolean} use the full transform or the single object one.\n       * @return {String}\n       */\n      getSvgTransform: function (full, additionalTransform) {\n        var transform = full\n            ? this.calcTransformMatrix()\n            : this.calcOwnMatrix(),\n          svgTransform = 'transform=\"' + fabric.util.matrixToSVG(transform);\n        return svgTransform + (additionalTransform || \"\") + '\" ';\n      },\n\n      _setSVGBg: function (textBgRects) {\n        if (this.backgroundColor) {\n          var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n          textBgRects.push(\n            \"\\t\\t<rect \",\n            this._getFillAttributes(this.backgroundColor),\n            ' x=\"',\n            toFixed(-this.width / 2, NUM_FRACTION_DIGITS),\n            '\" y=\"',\n            toFixed(-this.height / 2, NUM_FRACTION_DIGITS),\n            '\" width=\"',\n            toFixed(this.width, NUM_FRACTION_DIGITS),\n            '\" height=\"',\n            toFixed(this.height, NUM_FRACTION_DIGITS),\n            '\"></rect>\\n'\n          );\n        }\n      },\n\n      /**\n       * Returns svg representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */\n      toSVG: function (reviver) {\n        return this._createBaseSVGMarkup(this._toSVG(reviver), {\n          reviver: reviver,\n        });\n      },\n\n      /**\n       * Returns svg clipPath representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */\n      toClipPathSVG: function (reviver) {\n        return (\n          \"\\t\" +\n          this._createBaseClipPathSVGMarkup(this._toSVG(reviver), {\n            reviver: reviver,\n          })\n        );\n      },\n\n      /**\n       * @private\n       */\n      _createBaseClipPathSVGMarkup: function (objectMarkup, options) {\n        options = options || {};\n        var reviver = options.reviver,\n          additionalTransform = options.additionalTransform || \"\",\n          commonPieces = [\n            this.getSvgTransform(true, additionalTransform),\n            this.getSvgCommons(),\n          ].join(\"\"),\n          // insert commons in the markup, style and svgCommons\n          index = objectMarkup.indexOf(\"COMMON_PARTS\");\n        objectMarkup[index] = commonPieces;\n        return reviver ? reviver(objectMarkup.join(\"\")) : objectMarkup.join(\"\");\n      },\n\n      /**\n       * @private\n       */\n      _createBaseSVGMarkup: function (objectMarkup, options) {\n        options = options || {};\n        var noStyle = options.noStyle,\n          reviver = options.reviver,\n          styleInfo = noStyle ? \"\" : 'style=\"' + this.getSvgStyles() + '\" ',\n          shadowInfo = options.withShadow\n            ? 'style=\"' + this.getSvgFilter() + '\" '\n            : \"\",\n          clipPath = this.clipPath,\n          vectorEffect = this.strokeUniform\n            ? 'vector-effect=\"non-scaling-stroke\" '\n            : \"\",\n          absoluteClipPath = clipPath && clipPath.absolutePositioned,\n          stroke = this.stroke,\n          fill = this.fill,\n          shadow = this.shadow,\n          commonPieces,\n          markup = [],\n          clipPathMarkup,\n          // insert commons in the markup, style and svgCommons\n          index = objectMarkup.indexOf(\"COMMON_PARTS\"),\n          additionalTransform = options.additionalTransform;\n        if (clipPath) {\n          clipPath.clipPathId = \"CLIPPATH_\" + fabric.Object.__uid++;\n          clipPathMarkup =\n            '<clipPath id=\"' +\n            clipPath.clipPathId +\n            '\" >\\n' +\n            clipPath.toClipPathSVG(reviver) +\n            \"</clipPath>\\n\";\n        }\n        if (absoluteClipPath) {\n          markup.push(\"<g \", shadowInfo, this.getSvgCommons(), \" >\\n\");\n        }\n        markup.push(\n          \"<g \",\n          this.getSvgTransform(false),\n          !absoluteClipPath ? shadowInfo + this.getSvgCommons() : \"\",\n          \" >\\n\"\n        );\n        commonPieces = [\n          styleInfo,\n          vectorEffect,\n          noStyle ? \"\" : this.addPaintOrder(),\n          \" \",\n          additionalTransform ? 'transform=\"' + additionalTransform + '\" ' : \"\",\n        ].join(\"\");\n        objectMarkup[index] = commonPieces;\n        if (fill && fill.toLive) {\n          markup.push(fill.toSVG(this));\n        }\n        if (stroke && stroke.toLive) {\n          markup.push(stroke.toSVG(this));\n        }\n        if (shadow) {\n          markup.push(shadow.toSVG(this));\n        }\n        if (clipPath) {\n          markup.push(clipPathMarkup);\n        }\n        markup.push(objectMarkup.join(\"\"));\n        markup.push(\"</g>\\n\");\n        absoluteClipPath && markup.push(\"</g>\\n\");\n        return reviver ? reviver(markup.join(\"\")) : markup.join(\"\");\n      },\n\n      addPaintOrder: function () {\n        return this.paintFirst !== \"fill\"\n          ? ' paint-order=\"' + this.paintFirst + '\" '\n          : \"\";\n      },\n    }\n  );\n})();\n/* _TO_SVG_END_ */\n\n(function () {\n  var extend = fabric.util.object.extend,\n    originalSet = \"stateProperties\";\n\n  /*\n      Depends on `stateProperties`\n    */\n  function saveProps(origin, destination, props) {\n    var tmpObj = {},\n      deep = true;\n    props.forEach(function (prop) {\n      tmpObj[prop] = origin[prop];\n    });\n\n    extend(origin[destination], tmpObj, deep);\n  }\n\n  function _isEqual(origValue, currentValue, firstPass) {\n    if (origValue === currentValue) {\n      // if the objects are identical, return\n      return true;\n    } else if (Array.isArray(origValue)) {\n      if (\n        !Array.isArray(currentValue) ||\n        origValue.length !== currentValue.length\n      ) {\n        return false;\n      }\n      for (var i = 0, len = origValue.length; i < len; i++) {\n        if (!_isEqual(origValue[i], currentValue[i])) {\n          return false;\n        }\n      }\n      return true;\n    } else if (origValue && typeof origValue === \"object\") {\n      var keys = Object.keys(origValue),\n        key;\n      if (\n        !currentValue ||\n        typeof currentValue !== \"object\" ||\n        (!firstPass && keys.length !== Object.keys(currentValue).length)\n      ) {\n        return false;\n      }\n      for (var i = 0, len = keys.length; i < len; i++) {\n        key = keys[i];\n        // since clipPath is in the statefull cache list and the clipPath objects\n        // would be iterated as an object, this would lead to possible infinite recursion\n        // we do not want to compare those.\n        if (key === \"canvas\" || key === \"group\") {\n          continue;\n        }\n        if (!_isEqual(origValue[key], currentValue[key])) {\n          return false;\n        }\n      }\n      return true;\n    }\n  }\n\n  fabric.util.object.extend(\n    fabric.Object.prototype,\n    /** @lends fabric.Object.prototype */ {\n      /**\n       * Returns true if object state (one of its state properties) was changed\n       * @param {String} [propertySet] optional name for the set of property we want to save\n       * @return {Boolean} true if instance' state has changed since `{@link fabric.Object#saveState}` was called\n       */\n      hasStateChanged: function (propertySet) {\n        propertySet = propertySet || originalSet;\n        var dashedPropertySet = \"_\" + propertySet;\n        if (\n          Object.keys(this[dashedPropertySet]).length < this[propertySet].length\n        ) {\n          return true;\n        }\n        return !_isEqual(this[dashedPropertySet], this, true);\n      },\n\n      /**\n       * Saves state of an object\n       * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n       * @return {fabric.Object} thisArg\n       */\n      saveState: function (options) {\n        var propertySet = (options && options.propertySet) || originalSet,\n          destination = \"_\" + propertySet;\n        if (!this[destination]) {\n          return this.setupState(options);\n        }\n        saveProps(this, destination, this[propertySet]);\n        if (options && options.stateProperties) {\n          saveProps(this, destination, options.stateProperties);\n        }\n        return this;\n      },\n\n      /**\n       * Setups state of an object\n       * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n       * @return {fabric.Object} thisArg\n       */\n      setupState: function (options) {\n        options = options || {};\n        var propertySet = options.propertySet || originalSet;\n        options.propertySet = propertySet;\n        this[\"_\" + propertySet] = {};\n        this.saveState(options);\n        return this;\n      },\n    }\n  );\n})();\n\n(function () {\n  var degreesToRadians = fabric.util.degreesToRadians;\n\n  fabric.util.object.extend(\n    fabric.Object.prototype,\n    /** @lends fabric.Object.prototype */ {\n      /**\n       * Determines which corner has been clicked\n       * @private\n       * @param {Object} pointer The pointer indicating the mouse position\n       * @return {String|Boolean} corner code (tl, tr, bl, br, etc.), or false if nothing is found\n       */\n      _findTargetCorner: function (pointer, forTouch) {\n        // objects in group, anykind, are not self modificable,\n        // must not return an hovered corner.\n        if (\n          !this.hasControls ||\n          this.group ||\n          !this.canvas ||\n          this.canvas._activeObject !== this\n        ) {\n          return false;\n        }\n\n        var ex = pointer.x,\n          ey = pointer.y,\n          xPoints,\n          lines,\n          keys = Object.keys(this.oCoords),\n          j = keys.length - 1,\n          i;\n        this.__corner = 0;\n\n        // cycle in reverse order so we pick first the one on top\n        for (; j >= 0; j--) {\n          i = keys[j];\n          if (!this.isControlVisible(i)) {\n            continue;\n          }\n\n          lines = this._getImageLines(\n            forTouch ? this.oCoords[i].touchCorner : this.oCoords[i].corner\n          );\n          // debugging\n\n          // this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n          // this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n          //\n          // this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n          // this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n          //\n          // this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n          // this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n          //\n          // this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n          // this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n\n          xPoints = this._findCrossPoints({ x: ex, y: ey }, lines);\n          if (xPoints !== 0 && xPoints % 2 === 1) {\n            this.__corner = i;\n            return i;\n          }\n        }\n        return false;\n      },\n\n      /**\n       * Calls a function for each control. The function gets called,\n       * with the control, the object that is calling the iterator and the control's key\n       * @param {Function} fn function to iterate over the controls over\n       */\n      forEachControl: function (fn) {\n        for (var i in this.controls) {\n          fn(this.controls[i], i, this);\n        }\n      },\n\n      /**\n       * Sets the coordinates of the draggable boxes in the corners of\n       * the image used to scale/rotate it.\n       * note: if we would switch to ROUND corner area, all of this would disappear.\n       * everything would resolve to a single point and a pythagorean theorem for the distance\n       * @private\n       */\n      _setCornerCoords: function () {\n        var coords = this.oCoords,\n          newTheta = degreesToRadians(45 - this.angle),\n          cosTheta = fabric.util.cos(newTheta),\n          sinTheta = fabric.util.sin(newTheta),\n          /* Math.sqrt(2 * Math.pow(this.cornerSize, 2)) / 2, */\n          /* 0.707106 stands for sqrt(2)/2 */\n          cornerHypotenuse = this.cornerSize * 0.707106,\n          touchHypotenuse = this.touchCornerSize * 0.707106,\n          cosHalfOffset = cornerHypotenuse * cosTheta,\n          sinHalfOffset = cornerHypotenuse * sinTheta,\n          touchCosHalfOffset = touchHypotenuse * cosTheta,\n          touchSinHalfOffset = touchHypotenuse * sinTheta,\n          x,\n          y;\n\n        for (var control in coords) {\n          x = coords[control].x;\n          y = coords[control].y;\n          coords[control].corner = {\n            tl: {\n              x: x - sinHalfOffset,\n              y: y - cosHalfOffset,\n            },\n            tr: {\n              x: x + cosHalfOffset,\n              y: y - sinHalfOffset,\n            },\n            bl: {\n              x: x - cosHalfOffset,\n              y: y + sinHalfOffset,\n            },\n            br: {\n              x: x + sinHalfOffset,\n              y: y + cosHalfOffset,\n            },\n          };\n          coords[control].touchCorner = {\n            tl: {\n              x: x - touchSinHalfOffset,\n              y: y - touchCosHalfOffset,\n            },\n            tr: {\n              x: x + touchCosHalfOffset,\n              y: y - touchSinHalfOffset,\n            },\n            bl: {\n              x: x - touchCosHalfOffset,\n              y: y + touchSinHalfOffset,\n            },\n            br: {\n              x: x + touchSinHalfOffset,\n              y: y + touchCosHalfOffset,\n            },\n          };\n        }\n      },\n\n      /**\n       * Draws a colored layer behind the object, inside its selection borders.\n       * Requires public options: padding, selectionBackgroundColor\n       * this function is called when the context is transformed\n       * has checks to be skipped when the object is on a staticCanvas\n       * @param {CanvasRenderingContext2D} ctx Context to draw on\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      drawSelectionBackground: function (ctx) {\n        if (\n          !this.selectionBackgroundColor ||\n          (this.canvas && !this.canvas.interactive) ||\n          (this.canvas && this.canvas._activeObject !== this)\n        ) {\n          return this;\n        }\n        ctx.save();\n        var center = this.getCenterPoint(),\n          wh = this._calculateCurrentDimensions(),\n          vpt = this.canvas.viewportTransform;\n        ctx.translate(center.x, center.y);\n        ctx.scale(1 / vpt[0], 1 / vpt[3]);\n        ctx.rotate(degreesToRadians(this.angle));\n        ctx.fillStyle = this.selectionBackgroundColor;\n        ctx.fillRect(-wh.x / 2, -wh.y / 2, wh.x, wh.y);\n        ctx.restore();\n        return this;\n      },\n\n      /**\n       * Draws borders of an object's bounding box.\n       * Requires public properties: width, height\n       * Requires public options: padding, borderColor\n       * @param {CanvasRenderingContext2D} ctx Context to draw on\n       * @param {Object} styleOverride object to override the object style\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      drawBorders: function (ctx, styleOverride) {\n        styleOverride = styleOverride || {};\n        var wh = this._calculateCurrentDimensions(),\n          strokeWidth = this.borderScaleFactor,\n          width = wh.x + strokeWidth,\n          height = wh.y + strokeWidth,\n          hasControls =\n            typeof styleOverride.hasControls !== \"undefined\"\n              ? styleOverride.hasControls\n              : this.hasControls,\n          shouldStroke = false;\n\n        ctx.save();\n        ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\n        this._setLineDash(\n          ctx,\n          styleOverride.borderDashArray || this.borderDashArray,\n          null\n        );\n\n        ctx.strokeRect(-width / 2, -height / 2, width, height);\n\n        if (hasControls) {\n          ctx.beginPath();\n          this.forEachControl(function (control, key, fabricObject) {\n            // in this moment, the ctx is centered on the object.\n            // width and height of the above function are the size of the bbox.\n            if (\n              control.withConnection &&\n              control.getVisibility(fabricObject, key)\n            ) {\n              // reset movement for each control\n              shouldStroke = true;\n              ctx.moveTo(control.x * width, control.y * height);\n              ctx.lineTo(\n                control.x * width + control.offsetX,\n                control.y * height + control.offsetY\n              );\n            }\n          });\n          if (shouldStroke) {\n            ctx.stroke();\n          }\n        }\n        ctx.restore();\n        return this;\n      },\n\n      /**\n       * Draws borders of an object's bounding box when it is inside a group.\n       * Requires public properties: width, height\n       * Requires public options: padding, borderColor\n       * @param {CanvasRenderingContext2D} ctx Context to draw on\n       * @param {object} options object representing current object parameters\n       * @param {Object} styleOverride object to override the object style\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      drawBordersInGroup: function (ctx, options, styleOverride) {\n        styleOverride = styleOverride || {};\n        var bbox = fabric.util.sizeAfterTransform(\n            this.width,\n            this.height,\n            options\n          ),\n          strokeWidth = this.strokeWidth,\n          strokeUniform = this.strokeUniform,\n          borderScaleFactor = this.borderScaleFactor,\n          width =\n            bbox.x +\n            strokeWidth *\n              (strokeUniform ? this.canvas.getZoom() : options.scaleX) +\n            borderScaleFactor,\n          height =\n            bbox.y +\n            strokeWidth *\n              (strokeUniform ? this.canvas.getZoom() : options.scaleY) +\n            borderScaleFactor;\n        ctx.save();\n        this._setLineDash(\n          ctx,\n          styleOverride.borderDashArray || this.borderDashArray,\n          null\n        );\n        ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\n        ctx.strokeRect(-width / 2, -height / 2, width, height);\n\n        ctx.restore();\n        return this;\n      },\n\n      /**\n       * Draws corners of an object's bounding box.\n       * Requires public properties: width, height\n       * Requires public options: cornerSize, padding\n       * @param {CanvasRenderingContext2D} ctx Context to draw on\n       * @param {Object} styleOverride object to override the object style\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      drawControls: function (ctx, styleOverride) {\n        styleOverride = styleOverride || {};\n        ctx.save();\n        ctx.setTransform(\n          this.canvas.getRetinaScaling(),\n          0,\n          0,\n          this.canvas.getRetinaScaling(),\n          0,\n          0\n        );\n        ctx.strokeStyle = ctx.fillStyle =\n          styleOverride.cornerColor || this.cornerColor;\n        if (!this.transparentCorners) {\n          ctx.strokeStyle =\n            styleOverride.cornerStrokeColor || this.cornerStrokeColor;\n        }\n        this._setLineDash(\n          ctx,\n          styleOverride.cornerDashArray || this.cornerDashArray,\n          null\n        );\n        this.setCoords();\n        this.forEachControl(function (control, key, fabricObject) {\n          if (control.getVisibility(fabricObject, key)) {\n            control.render(\n              ctx,\n              fabricObject.oCoords[key].x,\n              fabricObject.oCoords[key].y,\n              styleOverride,\n              fabricObject\n            );\n          }\n        });\n        ctx.restore();\n\n        return this;\n      },\n\n      /**\n       * Returns true if the specified control is visible, false otherwise.\n       * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n       * @returns {Boolean} true if the specified control is visible, false otherwise\n       */\n      isControlVisible: function (controlKey) {\n        return (\n          this.controls[controlKey] &&\n          this.controls[controlKey].getVisibility(this, controlKey)\n        );\n      },\n\n      /**\n       * Sets the visibility of the specified control.\n       * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n       * @param {Boolean} visible true to set the specified control visible, false otherwise\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      setControlVisible: function (controlKey, visible) {\n        if (!this._controlsVisibility) {\n          this._controlsVisibility = {};\n        }\n        this._controlsVisibility[controlKey] = visible;\n        return this;\n      },\n\n      /**\n       * Sets the visibility state of object controls.\n       * @param {Object} [options] Options object\n       * @param {Boolean} [options.bl] true to enable the bottom-left control, false to disable it\n       * @param {Boolean} [options.br] true to enable the bottom-right control, false to disable it\n       * @param {Boolean} [options.mb] true to enable the middle-bottom control, false to disable it\n       * @param {Boolean} [options.ml] true to enable the middle-left control, false to disable it\n       * @param {Boolean} [options.mr] true to enable the middle-right control, false to disable it\n       * @param {Boolean} [options.mt] true to enable the middle-top control, false to disable it\n       * @param {Boolean} [options.tl] true to enable the top-left control, false to disable it\n       * @param {Boolean} [options.tr] true to enable the top-right control, false to disable it\n       * @param {Boolean} [options.mtr] true to enable the middle-top-rotate control, false to disable it\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      setControlsVisibility: function (options) {\n        options || (options = {});\n\n        for (var p in options) {\n          this.setControlVisible(p, options[p]);\n        }\n        return this;\n      },\n\n      /**\n       * This callback function is called every time _discardActiveObject or _setActiveObject\n       * try to to deselect this object. If the function returns true, the process is cancelled\n       * @param {Object} [options] options sent from the upper functions\n       * @param {Event} [options.e] event if the process is generated by an event\n       */\n      onDeselect: function () {\n        // implemented by sub-classes, as needed.\n      },\n\n      /**\n       * This callback function is called every time _discardActiveObject or _setActiveObject\n       * try to to select this object. If the function returns true, the process is cancelled\n       * @param {Object} [options] options sent from the upper functions\n       * @param {Event} [options.e] event if the process is generated by an event\n       */\n      onSelect: function () {\n        // implemented by sub-classes, as needed.\n      },\n    }\n  );\n})();\n\nfabric.util.object.extend(\n  fabric.StaticCanvas.prototype,\n  /** @lends fabric.StaticCanvas.prototype */ {\n    /**\n     * Animation duration (in ms) for fx* methods\n     * @type Number\n     * @default\n     */\n    FX_DURATION: 500,\n\n    /**\n     * Centers object horizontally with animation.\n     * @param {fabric.Object} object Object to center\n     * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n     * @param {Function} [callbacks.onComplete] Invoked on completion\n     * @param {Function} [callbacks.onChange] Invoked on every step of animation\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    fxCenterObjectH: function (object, callbacks) {\n      callbacks = callbacks || {};\n\n      var empty = function () {},\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n      fabric.util.animate({\n        startValue: object.left,\n        endValue: this.getCenter().left,\n        duration: this.FX_DURATION,\n        onChange: function (value) {\n          object.set(\"left\", value);\n          _this.requestRenderAll();\n          onChange();\n        },\n        onComplete: function () {\n          object.setCoords();\n          onComplete();\n        },\n      });\n\n      return this;\n    },\n\n    /**\n     * Centers object vertically with animation.\n     * @param {fabric.Object} object Object to center\n     * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n     * @param {Function} [callbacks.onComplete] Invoked on completion\n     * @param {Function} [callbacks.onChange] Invoked on every step of animation\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    fxCenterObjectV: function (object, callbacks) {\n      callbacks = callbacks || {};\n\n      var empty = function () {},\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n      fabric.util.animate({\n        startValue: object.top,\n        endValue: this.getCenter().top,\n        duration: this.FX_DURATION,\n        onChange: function (value) {\n          object.set(\"top\", value);\n          _this.requestRenderAll();\n          onChange();\n        },\n        onComplete: function () {\n          object.setCoords();\n          onComplete();\n        },\n      });\n\n      return this;\n    },\n\n    /**\n     * Same as `fabric.Canvas#remove` but animated\n     * @param {fabric.Object} object Object to remove\n     * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n     * @param {Function} [callbacks.onComplete] Invoked on completion\n     * @param {Function} [callbacks.onChange] Invoked on every step of animation\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    fxRemove: function (object, callbacks) {\n      callbacks = callbacks || {};\n\n      var empty = function () {},\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n      fabric.util.animate({\n        startValue: object.opacity,\n        endValue: 0,\n        duration: this.FX_DURATION,\n        onChange: function (value) {\n          object.set(\"opacity\", value);\n          _this.requestRenderAll();\n          onChange();\n        },\n        onComplete: function () {\n          _this.remove(object);\n          onComplete();\n        },\n      });\n\n      return this;\n    },\n  }\n);\n\nfabric.util.object.extend(\n  fabric.Object.prototype,\n  /** @lends fabric.Object.prototype */ {\n    /**\n     * Animates object's properties\n     * @param {String|Object} property Property to animate (if string) or properties to animate (if object)\n     * @param {Number|Object} value Value to animate property to (if string was given first) or options object\n     * @return {fabric.Object} thisArg\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#animation}\n     * @chainable\n     *\n     * As object — multiple properties\n     *\n     * object.animate({ left: ..., top: ... });\n     * object.animate({ left: ..., top: ... }, { duration: ... });\n     *\n     * As string — one property\n     *\n     * object.animate('left', ...);\n     * object.animate('left', { duration: ... });\n     *\n     */\n    animate: function () {\n      if (arguments[0] && typeof arguments[0] === \"object\") {\n        var propsToAnimate = [],\n          prop,\n          skipCallbacks;\n        for (prop in arguments[0]) {\n          propsToAnimate.push(prop);\n        }\n        for (var i = 0, len = propsToAnimate.length; i < len; i++) {\n          prop = propsToAnimate[i];\n          skipCallbacks = i !== len - 1;\n          this._animate(prop, arguments[0][prop], arguments[1], skipCallbacks);\n        }\n      } else {\n        this._animate.apply(this, arguments);\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to animate\n     * @param {String} to Value to animate to\n     * @param {Object} [options] Options object\n     * @param {Boolean} [skipCallbacks] When true, callbacks like onchange and oncomplete are not invoked\n     */\n    _animate: function (property, to, options, skipCallbacks) {\n      var _this = this,\n        propPair;\n\n      to = to.toString();\n\n      if (!options) {\n        options = {};\n      } else {\n        options = fabric.util.object.clone(options);\n      }\n\n      if (~property.indexOf(\".\")) {\n        propPair = property.split(\".\");\n      }\n\n      var propIsColor =\n        _this.colorProperties.indexOf(property) > -1 ||\n        (propPair && _this.colorProperties.indexOf(propPair[1]) > -1);\n\n      var currentValue = propPair\n        ? this.get(propPair[0])[propPair[1]]\n        : this.get(property);\n\n      if (!(\"from\" in options)) {\n        options.from = currentValue;\n      }\n\n      if (!propIsColor) {\n        if (~to.indexOf(\"=\")) {\n          to = currentValue + parseFloat(to.replace(\"=\", \"\"));\n        } else {\n          to = parseFloat(to);\n        }\n      }\n\n      var _options = {\n        startValue: options.from,\n        endValue: to,\n        byValue: options.by,\n        easing: options.easing,\n        duration: options.duration,\n        abort:\n          options.abort &&\n          function () {\n            return options.abort.call(_this);\n          },\n        onChange: function (value, valueProgress, timeProgress) {\n          if (propPair) {\n            _this[propPair[0]][propPair[1]] = value;\n          } else {\n            _this.set(property, value);\n          }\n          if (skipCallbacks) {\n            return;\n          }\n          options.onChange &&\n            options.onChange(value, valueProgress, timeProgress);\n        },\n        onComplete: function (value, valueProgress, timeProgress) {\n          if (skipCallbacks) {\n            return;\n          }\n\n          _this.setCoords();\n          options.onComplete &&\n            options.onComplete(value, valueProgress, timeProgress);\n        },\n      };\n\n      if (propIsColor) {\n        fabric.util.animateColor(\n          _options.startValue,\n          _options.endValue,\n          _options.duration,\n          _options\n        );\n      } else {\n        fabric.util.animate(_options);\n      }\n    },\n  }\n);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    extend = fabric.util.object.extend,\n    clone = fabric.util.object.clone,\n    coordProps = { x1: 1, x2: 1, y1: 1, y2: 1 },\n    supportsLineDash = fabric.StaticCanvas.supports(\"setLineDash\");\n\n  if (fabric.Line) {\n    fabric.warn(\"fabric.Line is already defined\");\n    return;\n  }\n\n  /**\n   * Line class\n   * @class fabric.Line\n   * @extends fabric.Object\n   * @see {@link fabric.Line#initialize} for constructor definition\n   */\n  fabric.Line = fabric.util.createClass(\n    fabric.Object,\n    /** @lends fabric.Line.prototype */ {\n      /**\n       * Type of an object\n       * @type String\n       * @default\n       */\n      type: \"line\",\n\n      /**\n       * x value or first line edge\n       * @type Number\n       * @default\n       */\n      x1: 0,\n\n      /**\n       * y value or first line edge\n       * @type Number\n       * @default\n       */\n      y1: 0,\n\n      /**\n       * x value or second line edge\n       * @type Number\n       * @default\n       */\n      x2: 0,\n\n      /**\n       * y value or second line edge\n       * @type Number\n       * @default\n       */\n      y2: 0,\n\n      cacheProperties: fabric.Object.prototype.cacheProperties.concat(\n        \"x1\",\n        \"x2\",\n        \"y1\",\n        \"y2\"\n      ),\n\n      /**\n       * Constructor\n       * @param {Array} [points] Array of points\n       * @param {Object} [options] Options object\n       * @return {fabric.Line} thisArg\n       */\n      initialize: function (points, options) {\n        if (!points) {\n          points = [0, 0, 0, 0];\n        }\n\n        this.callSuper(\"initialize\", options);\n\n        this.set(\"x1\", points[0]);\n        this.set(\"y1\", points[1]);\n        this.set(\"x2\", points[2]);\n        this.set(\"y2\", points[3]);\n\n        this._setWidthHeight(options);\n      },\n\n      /**\n       * @private\n       * @param {Object} [options] Options\n       */\n      _setWidthHeight: function (options) {\n        options || (options = {});\n\n        this.width = Math.abs(this.x2 - this.x1);\n        this.height = Math.abs(this.y2 - this.y1);\n\n        this.left = \"left\" in options ? options.left : this._getLeftToOriginX();\n\n        this.top = \"top\" in options ? options.top : this._getTopToOriginY();\n      },\n\n      /**\n       * @private\n       * @param {String} key\n       * @param {*} value\n       */\n      _set: function (key, value) {\n        this.callSuper(\"_set\", key, value);\n        if (typeof coordProps[key] !== \"undefined\") {\n          this._setWidthHeight();\n        }\n        return this;\n      },\n\n      /**\n       * @private\n       * @return {Number} leftToOriginX Distance from left edge of canvas to originX of Line.\n       */\n      _getLeftToOriginX: makeEdgeToOriginGetter(\n        {\n          // property names\n          origin: \"originX\",\n          axis1: \"x1\",\n          axis2: \"x2\",\n          dimension: \"width\",\n        },\n        {\n          // possible values of origin\n          nearest: \"left\",\n          center: \"center\",\n          farthest: \"right\",\n        }\n      ),\n\n      /**\n       * @private\n       * @return {Number} topToOriginY Distance from top edge of canvas to originY of Line.\n       */\n      _getTopToOriginY: makeEdgeToOriginGetter(\n        {\n          // property names\n          origin: \"originY\",\n          axis1: \"y1\",\n          axis2: \"y2\",\n          dimension: \"height\",\n        },\n        {\n          // possible values of origin\n          nearest: \"top\",\n          center: \"center\",\n          farthest: \"bottom\",\n        }\n      ),\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _render: function (ctx) {\n        ctx.beginPath();\n\n        if (\n          !this.strokeDashArray ||\n          (this.strokeDashArray && supportsLineDash)\n        ) {\n          // move from center (of virtual box) to its left/top corner\n          // we can't assume x1, y1 is top left and x2, y2 is bottom right\n          var p = this.calcLinePoints();\n          ctx.moveTo(p.x1, p.y1);\n          ctx.lineTo(p.x2, p.y2);\n        }\n\n        ctx.lineWidth = this.strokeWidth;\n\n        // TODO: test this\n        // make sure setting \"fill\" changes color of a line\n        // (by copying fillStyle to strokeStyle, since line is stroked, not filled)\n        var origStrokeStyle = ctx.strokeStyle;\n        ctx.strokeStyle = this.stroke || ctx.fillStyle;\n        this.stroke && this._renderStroke(ctx);\n        ctx.strokeStyle = origStrokeStyle;\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderDashedStroke: function (ctx) {\n        var p = this.calcLinePoints();\n\n        ctx.beginPath();\n        fabric.util.drawDashedLine(\n          ctx,\n          p.x1,\n          p.y1,\n          p.x2,\n          p.y2,\n          this.strokeDashArray\n        );\n        ctx.closePath();\n      },\n\n      /**\n       * This function is an helper for svg import. it returns the center of the object in the svg\n       * untransformed coordinates\n       * @private\n       * @return {Object} center point from element coordinates\n       */\n      _findCenterFromElement: function () {\n        return {\n          x: (this.x1 + this.x2) / 2,\n          y: (this.y1 + this.y2) / 2,\n        };\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @methd toObject\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */\n      toObject: function (propertiesToInclude) {\n        return extend(\n          this.callSuper(\"toObject\", propertiesToInclude),\n          this.calcLinePoints()\n        );\n      },\n\n      /*\n       * Calculate object dimensions from its properties\n       * @private\n       */\n      _getNonTransformedDimensions: function () {\n        var dim = this.callSuper(\"_getNonTransformedDimensions\");\n        if (this.strokeLineCap === \"butt\") {\n          if (this.width === 0) {\n            dim.y -= this.strokeWidth;\n          }\n          if (this.height === 0) {\n            dim.x -= this.strokeWidth;\n          }\n        }\n        return dim;\n      },\n\n      /**\n       * Recalculates line points given width and height\n       * @private\n       */\n      calcLinePoints: function () {\n        var xMult = this.x1 <= this.x2 ? -1 : 1,\n          yMult = this.y1 <= this.y2 ? -1 : 1,\n          x1 = xMult * this.width * 0.5,\n          y1 = yMult * this.height * 0.5,\n          x2 = xMult * this.width * -0.5,\n          y2 = yMult * this.height * -0.5;\n\n        return {\n          x1: x1,\n          x2: x2,\n          y1: y1,\n          y2: y2,\n        };\n      },\n\n      /* _TO_SVG_START_ */\n      /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */\n      _toSVG: function () {\n        var p = this.calcLinePoints();\n        return [\n          \"<line \",\n          \"COMMON_PARTS\",\n          'x1=\"',\n          p.x1,\n          '\" y1=\"',\n          p.y1,\n          '\" x2=\"',\n          p.x2,\n          '\" y2=\"',\n          p.y2,\n          '\" />\\n',\n        ];\n      },\n      /* _TO_SVG_END_ */\n    }\n  );\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Line.fromElement})\n   * @static\n   * @memberOf fabric.Line\n   * @see http://www.w3.org/TR/SVG/shapes.html#LineElement\n   */\n  fabric.Line.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\n    \"x1 y1 x2 y2\".split(\" \")\n  );\n\n  /**\n   * Returns fabric.Line instance from an SVG element\n   * @static\n   * @memberOf fabric.Line\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] callback function invoked after parsing\n   */\n  fabric.Line.fromElement = function (element, callback, options) {\n    options = options || {};\n    var parsedAttributes = fabric.parseAttributes(\n        element,\n        fabric.Line.ATTRIBUTE_NAMES\n      ),\n      points = [\n        parsedAttributes.x1 || 0,\n        parsedAttributes.y1 || 0,\n        parsedAttributes.x2 || 0,\n        parsedAttributes.y2 || 0,\n      ];\n    callback(new fabric.Line(points, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Line instance from an object representation\n   * @static\n   * @memberOf fabric.Line\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */\n  fabric.Line.fromObject = function (object, callback) {\n    function _callback(instance) {\n      delete instance.points;\n      callback && callback(instance);\n    }\n    var options = clone(object, true);\n    options.points = [object.x1, object.y1, object.x2, object.y2];\n    fabric.Object._fromObject(\"Line\", options, _callback, \"points\");\n  };\n\n  /**\n   * Produces a function that calculates distance from canvas edge to Line origin.\n   */\n  function makeEdgeToOriginGetter(propertyNames, originValues) {\n    var origin = propertyNames.origin,\n      axis1 = propertyNames.axis1,\n      axis2 = propertyNames.axis2,\n      dimension = propertyNames.dimension,\n      nearest = originValues.nearest,\n      center = originValues.center,\n      farthest = originValues.farthest;\n\n    return function () {\n      switch (this.get(origin)) {\n        case nearest:\n          return Math.min(this.get(axis1), this.get(axis2));\n        case center:\n          return (\n            Math.min(this.get(axis1), this.get(axis2)) +\n            0.5 * this.get(dimension)\n          );\n        case farthest:\n          return Math.max(this.get(axis1), this.get(axis2));\n      }\n    };\n  }\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    pi = Math.PI;\n\n  if (fabric.Circle) {\n    fabric.warn(\"fabric.Circle is already defined.\");\n    return;\n  }\n\n  /**\n   * Circle class\n   * @class fabric.Circle\n   * @extends fabric.Object\n   * @see {@link fabric.Circle#initialize} for constructor definition\n   */\n  fabric.Circle = fabric.util.createClass(\n    fabric.Object,\n    /** @lends fabric.Circle.prototype */ {\n      /**\n       * Type of an object\n       * @type String\n       * @default\n       */\n      type: \"circle\",\n\n      /**\n       * Radius of this circle\n       * @type Number\n       * @default\n       */\n      radius: 0,\n\n      /**\n       * Start angle of the circle, moving clockwise\n       * deprectated type, this should be in degree, this was an oversight.\n       * probably will change to degrees in next major version\n       * @type Number\n       * @default 0\n       */\n      startAngle: 0,\n\n      /**\n       * End angle of the circle\n       * deprectated type, this should be in degree, this was an oversight.\n       * probably will change to degrees in next major version\n       * @type Number\n       * @default 2Pi\n       */\n      endAngle: pi * 2,\n\n      cacheProperties: fabric.Object.prototype.cacheProperties.concat(\n        \"radius\",\n        \"startAngle\",\n        \"endAngle\"\n      ),\n\n      /**\n       * @private\n       * @param {String} key\n       * @param {*} value\n       * @return {fabric.Circle} thisArg\n       */\n      _set: function (key, value) {\n        this.callSuper(\"_set\", key, value);\n\n        if (key === \"radius\") {\n          this.setRadius(value);\n        }\n\n        return this;\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */\n      toObject: function (propertiesToInclude) {\n        return this.callSuper(\n          \"toObject\",\n          [\"radius\", \"startAngle\", \"endAngle\"].concat(propertiesToInclude)\n        );\n      },\n\n      /* _TO_SVG_START_ */\n\n      /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */\n      _toSVG: function () {\n        var svgString,\n          x = 0,\n          y = 0,\n          angle = (this.endAngle - this.startAngle) % (2 * pi);\n\n        if (angle === 0) {\n          svgString = [\n            \"<circle \",\n            \"COMMON_PARTS\",\n            'cx=\"' + x + '\" cy=\"' + y + '\" ',\n            'r=\"',\n            this.radius,\n            '\" />\\n',\n          ];\n        } else {\n          var startX = fabric.util.cos(this.startAngle) * this.radius,\n            startY = fabric.util.sin(this.startAngle) * this.radius,\n            endX = fabric.util.cos(this.endAngle) * this.radius,\n            endY = fabric.util.sin(this.endAngle) * this.radius,\n            largeFlag = angle > pi ? \"1\" : \"0\";\n          svgString = [\n            '<path d=\"M ' + startX + \" \" + startY,\n            \" A \" + this.radius + \" \" + this.radius,\n            \" 0 \",\n            +largeFlag + \" 1\",\n            \" \" + endX + \" \" + endY,\n            '\" ',\n            \"COMMON_PARTS\",\n            \" />\\n\",\n          ];\n        }\n        return svgString;\n      },\n      /* _TO_SVG_END_ */\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx context to render on\n       */\n      _render: function (ctx) {\n        ctx.beginPath();\n        ctx.arc(0, 0, this.radius, this.startAngle, this.endAngle, false);\n        this._renderPaintInOrder(ctx);\n      },\n\n      /**\n       * Returns horizontal radius of an object (according to how an object is scaled)\n       * @return {Number}\n       */\n      getRadiusX: function () {\n        return this.get(\"radius\") * this.get(\"scaleX\");\n      },\n\n      /**\n       * Returns vertical radius of an object (according to how an object is scaled)\n       * @return {Number}\n       */\n      getRadiusY: function () {\n        return this.get(\"radius\") * this.get(\"scaleY\");\n      },\n\n      /**\n       * Sets radius of an object (and updates width accordingly)\n       * @return {fabric.Circle} thisArg\n       */\n      setRadius: function (value) {\n        this.radius = value;\n        return this.set(\"width\", value * 2).set(\"height\", value * 2);\n      },\n    }\n  );\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Circle.fromElement})\n   * @static\n   * @memberOf fabric.Circle\n   * @see: http://www.w3.org/TR/SVG/shapes.html#CircleElement\n   */\n  fabric.Circle.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\n    \"cx cy r\".split(\" \")\n  );\n\n  /**\n   * Returns {@link fabric.Circle} instance from an SVG element\n   * @static\n   * @memberOf fabric.Circle\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @param {Object} [options] Options object\n   * @throws {Error} If value of `r` attribute is missing or invalid\n   */\n  fabric.Circle.fromElement = function (element, callback) {\n    var parsedAttributes = fabric.parseAttributes(\n      element,\n      fabric.Circle.ATTRIBUTE_NAMES\n    );\n\n    if (!isValidRadius(parsedAttributes)) {\n      throw new Error(\n        \"value of `r` attribute is required and can not be negative\"\n      );\n    }\n\n    parsedAttributes.left =\n      (parsedAttributes.left || 0) - parsedAttributes.radius;\n    parsedAttributes.top =\n      (parsedAttributes.top || 0) - parsedAttributes.radius;\n    callback(new fabric.Circle(parsedAttributes));\n  };\n\n  /**\n   * @private\n   */\n  function isValidRadius(attributes) {\n    return \"radius\" in attributes && attributes.radius >= 0;\n  }\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Circle} instance from an object representation\n   * @static\n   * @memberOf fabric.Circle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {Object} Instance of fabric.Circle\n   */\n  fabric.Circle.fromObject = function (object, callback) {\n    return fabric.Object._fromObject(\"Circle\", object, callback);\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  if (fabric.Triangle) {\n    fabric.warn(\"fabric.Triangle is already defined\");\n    return;\n  }\n\n  /**\n   * Triangle class\n   * @class fabric.Triangle\n   * @extends fabric.Object\n   * @return {fabric.Triangle} thisArg\n   * @see {@link fabric.Triangle#initialize} for constructor definition\n   */\n  fabric.Triangle = fabric.util.createClass(\n    fabric.Object,\n    /** @lends fabric.Triangle.prototype */ {\n      /**\n       * Type of an object\n       * @type String\n       * @default\n       */\n      type: \"triangle\",\n\n      /**\n       * Width is set to 100 to compensate the old initialize code that was setting it to 100\n       * @type Number\n       * @default\n       */\n      width: 100,\n\n      /**\n       * Height is set to 100 to compensate the old initialize code that was setting it to 100\n       * @type Number\n       * @default\n       */\n      height: 100,\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _render: function (ctx) {\n        var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n        ctx.beginPath();\n        ctx.moveTo(-widthBy2, heightBy2);\n        ctx.lineTo(0, -heightBy2);\n        ctx.lineTo(widthBy2, heightBy2);\n        ctx.closePath();\n\n        this._renderPaintInOrder(ctx);\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderDashedStroke: function (ctx) {\n        var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n        ctx.beginPath();\n        fabric.util.drawDashedLine(\n          ctx,\n          -widthBy2,\n          heightBy2,\n          0,\n          -heightBy2,\n          this.strokeDashArray\n        );\n        fabric.util.drawDashedLine(\n          ctx,\n          0,\n          -heightBy2,\n          widthBy2,\n          heightBy2,\n          this.strokeDashArray\n        );\n        fabric.util.drawDashedLine(\n          ctx,\n          widthBy2,\n          heightBy2,\n          -widthBy2,\n          heightBy2,\n          this.strokeDashArray\n        );\n        ctx.closePath();\n      },\n\n      /* _TO_SVG_START_ */\n      /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */\n      _toSVG: function () {\n        var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2,\n          points = [\n            -widthBy2 + \" \" + heightBy2,\n            \"0 \" + -heightBy2,\n            widthBy2 + \" \" + heightBy2,\n          ].join(\",\");\n        return [\"<polygon \", \"COMMON_PARTS\", 'points=\"', points, '\" />'];\n      },\n      /* _TO_SVG_END_ */\n    }\n  );\n\n  /**\n   * Returns {@link fabric.Triangle} instance from an object representation\n   * @static\n   * @memberOf fabric.Triangle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */\n  fabric.Triangle.fromObject = function (object, callback) {\n    return fabric.Object._fromObject(\"Triangle\", object, callback);\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    piBy2 = Math.PI * 2;\n\n  if (fabric.Ellipse) {\n    fabric.warn(\"fabric.Ellipse is already defined.\");\n    return;\n  }\n\n  /**\n   * Ellipse class\n   * @class fabric.Ellipse\n   * @extends fabric.Object\n   * @return {fabric.Ellipse} thisArg\n   * @see {@link fabric.Ellipse#initialize} for constructor definition\n   */\n  fabric.Ellipse = fabric.util.createClass(\n    fabric.Object,\n    /** @lends fabric.Ellipse.prototype */ {\n      /**\n       * Type of an object\n       * @type String\n       * @default\n       */\n      type: \"ellipse\",\n\n      /**\n       * Horizontal radius\n       * @type Number\n       * @default\n       */\n      rx: 0,\n\n      /**\n       * Vertical radius\n       * @type Number\n       * @default\n       */\n      ry: 0,\n\n      cacheProperties: fabric.Object.prototype.cacheProperties.concat(\n        \"rx\",\n        \"ry\"\n      ),\n\n      /**\n       * Constructor\n       * @param {Object} [options] Options object\n       * @return {fabric.Ellipse} thisArg\n       */\n      initialize: function (options) {\n        this.callSuper(\"initialize\", options);\n        this.set(\"rx\", (options && options.rx) || 0);\n        this.set(\"ry\", (options && options.ry) || 0);\n      },\n\n      /**\n       * @private\n       * @param {String} key\n       * @param {*} value\n       * @return {fabric.Ellipse} thisArg\n       */\n      _set: function (key, value) {\n        this.callSuper(\"_set\", key, value);\n        switch (key) {\n          case \"rx\":\n            this.rx = value;\n            this.set(\"width\", value * 2);\n            break;\n\n          case \"ry\":\n            this.ry = value;\n            this.set(\"height\", value * 2);\n            break;\n        }\n        return this;\n      },\n\n      /**\n       * Returns horizontal radius of an object (according to how an object is scaled)\n       * @return {Number}\n       */\n      getRx: function () {\n        return this.get(\"rx\") * this.get(\"scaleX\");\n      },\n\n      /**\n       * Returns Vertical radius of an object (according to how an object is scaled)\n       * @return {Number}\n       */\n      getRy: function () {\n        return this.get(\"ry\") * this.get(\"scaleY\");\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */\n      toObject: function (propertiesToInclude) {\n        return this.callSuper(\n          \"toObject\",\n          [\"rx\", \"ry\"].concat(propertiesToInclude)\n        );\n      },\n\n      /* _TO_SVG_START_ */\n      /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */\n      _toSVG: function () {\n        return [\n          \"<ellipse \",\n          \"COMMON_PARTS\",\n          'cx=\"0\" cy=\"0\" ',\n          'rx=\"',\n          this.rx,\n          '\" ry=\"',\n          this.ry,\n          '\" />\\n',\n        ];\n      },\n      /* _TO_SVG_END_ */\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx context to render on\n       */\n      _render: function (ctx) {\n        ctx.beginPath();\n        ctx.save();\n        ctx.transform(1, 0, 0, this.ry / this.rx, 0, 0);\n        ctx.arc(0, 0, this.rx, 0, piBy2, false);\n        ctx.restore();\n        this._renderPaintInOrder(ctx);\n      },\n    }\n  );\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Ellipse.fromElement})\n   * @static\n   * @memberOf fabric.Ellipse\n   * @see http://www.w3.org/TR/SVG/shapes.html#EllipseElement\n   */\n  fabric.Ellipse.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\n    \"cx cy rx ry\".split(\" \")\n  );\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an SVG element\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromElement = function (element, callback) {\n    var parsedAttributes = fabric.parseAttributes(\n      element,\n      fabric.Ellipse.ATTRIBUTE_NAMES\n    );\n\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.rx;\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.ry;\n    callback(new fabric.Ellipse(parsedAttributes));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an object representation\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromObject = function (object, callback) {\n    return fabric.Object._fromObject(\"Ellipse\", object, callback);\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    extend = fabric.util.object.extend;\n\n  if (fabric.Rect) {\n    fabric.warn(\"fabric.Rect is already defined\");\n    return;\n  }\n\n  /**\n   * Rectangle class\n   * @class fabric.Rect\n   * @extends fabric.Object\n   * @return {fabric.Rect} thisArg\n   * @see {@link fabric.Rect#initialize} for constructor definition\n   */\n  fabric.Rect = fabric.util.createClass(\n    fabric.Object,\n    /** @lends fabric.Rect.prototype */ {\n      /**\n       * List of properties to consider when checking if state of an object is changed ({@link fabric.Object#hasStateChanged})\n       * as well as for history (undo/redo) purposes\n       * @type Array\n       */\n      stateProperties: fabric.Object.prototype.stateProperties.concat(\n        \"rx\",\n        \"ry\"\n      ),\n\n      /**\n       * Type of an object\n       * @type String\n       * @default\n       */\n      type: \"rect\",\n\n      /**\n       * Horizontal border radius\n       * @type Number\n       * @default\n       */\n      rx: 0,\n\n      /**\n       * Vertical border radius\n       * @type Number\n       * @default\n       */\n      ry: 0,\n\n      cacheProperties: fabric.Object.prototype.cacheProperties.concat(\n        \"rx\",\n        \"ry\"\n      ),\n\n      /**\n       * Constructor\n       * @param {Object} [options] Options object\n       * @return {Object} thisArg\n       */\n      initialize: function (options) {\n        this.callSuper(\"initialize\", options);\n        this._initRxRy();\n      },\n\n      /**\n       * Initializes rx/ry attributes\n       * @private\n       */\n      _initRxRy: function () {\n        if (this.rx && !this.ry) {\n          this.ry = this.rx;\n        } else if (this.ry && !this.rx) {\n          this.rx = this.ry;\n        }\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _render: function (ctx) {\n        // 1x1 case (used in spray brush) optimization was removed because\n        // with caching and higher zoom level this makes more damage than help\n\n        var rx = this.rx ? Math.min(this.rx, this.width / 2) : 0,\n          ry = this.ry ? Math.min(this.ry, this.height / 2) : 0,\n          w = this.width,\n          h = this.height,\n          x = -this.width / 2,\n          y = -this.height / 2,\n          isRounded = rx !== 0 || ry !== 0,\n          /* \"magic number\" for bezier approximations of arcs (http://itc.ktu.lt/itc354/Riskus354.pdf) */\n          k = 1 - 0.5522847498;\n        ctx.beginPath();\n\n        ctx.moveTo(x + rx, y);\n\n        ctx.lineTo(x + w - rx, y);\n        isRounded &&\n          ctx.bezierCurveTo(\n            x + w - k * rx,\n            y,\n            x + w,\n            y + k * ry,\n            x + w,\n            y + ry\n          );\n\n        ctx.lineTo(x + w, y + h - ry);\n        isRounded &&\n          ctx.bezierCurveTo(\n            x + w,\n            y + h - k * ry,\n            x + w - k * rx,\n            y + h,\n            x + w - rx,\n            y + h\n          );\n\n        ctx.lineTo(x + rx, y + h);\n        isRounded &&\n          ctx.bezierCurveTo(\n            x + k * rx,\n            y + h,\n            x,\n            y + h - k * ry,\n            x,\n            y + h - ry\n          );\n\n        ctx.lineTo(x, y + ry);\n        isRounded && ctx.bezierCurveTo(x, y + k * ry, x + k * rx, y, x + rx, y);\n\n        ctx.closePath();\n\n        this._renderPaintInOrder(ctx);\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderDashedStroke: function (ctx) {\n        var x = -this.width / 2,\n          y = -this.height / 2,\n          w = this.width,\n          h = this.height;\n\n        ctx.beginPath();\n        fabric.util.drawDashedLine(ctx, x, y, x + w, y, this.strokeDashArray);\n        fabric.util.drawDashedLine(\n          ctx,\n          x + w,\n          y,\n          x + w,\n          y + h,\n          this.strokeDashArray\n        );\n        fabric.util.drawDashedLine(\n          ctx,\n          x + w,\n          y + h,\n          x,\n          y + h,\n          this.strokeDashArray\n        );\n        fabric.util.drawDashedLine(ctx, x, y + h, x, y, this.strokeDashArray);\n        ctx.closePath();\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */\n      toObject: function (propertiesToInclude) {\n        return this.callSuper(\n          \"toObject\",\n          [\"rx\", \"ry\"].concat(propertiesToInclude)\n        );\n      },\n\n      /* _TO_SVG_START_ */\n      /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */\n      _toSVG: function () {\n        var x = -this.width / 2,\n          y = -this.height / 2;\n        return [\n          \"<rect \",\n          \"COMMON_PARTS\",\n          'x=\"',\n          x,\n          '\" y=\"',\n          y,\n          '\" rx=\"',\n          this.rx,\n          '\" ry=\"',\n          this.ry,\n          '\" width=\"',\n          this.width,\n          '\" height=\"',\n          this.height,\n          '\" />\\n',\n        ];\n      },\n      /* _TO_SVG_END_ */\n    }\n  );\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Rect.fromElement`)\n   * @static\n   * @memberOf fabric.Rect\n   * @see: http://www.w3.org/TR/SVG/shapes.html#RectElement\n   */\n  fabric.Rect.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\n    \"x y rx ry width height\".split(\" \")\n  );\n\n  /**\n   * Returns {@link fabric.Rect} instance from an SVG element\n   * @static\n   * @memberOf fabric.Rect\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Rect.fromElement = function (element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n    options = options || {};\n\n    var parsedAttributes = fabric.parseAttributes(\n      element,\n      fabric.Rect.ATTRIBUTE_NAMES\n    );\n    parsedAttributes.left = parsedAttributes.left || 0;\n    parsedAttributes.top = parsedAttributes.top || 0;\n    parsedAttributes.height = parsedAttributes.height || 0;\n    parsedAttributes.width = parsedAttributes.width || 0;\n    var rect = new fabric.Rect(\n      extend(options ? fabric.util.object.clone(options) : {}, parsedAttributes)\n    );\n    rect.visible = rect.visible && rect.width > 0 && rect.height > 0;\n    callback(rect);\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Rect} instance from an object representation\n   * @static\n   * @memberOf fabric.Rect\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Rect instance is created\n   */\n  fabric.Rect.fromObject = function (object, callback) {\n    return fabric.Object._fromObject(\"Rect\", object, callback);\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    extend = fabric.util.object.extend,\n    min = fabric.util.array.min,\n    max = fabric.util.array.max,\n    toFixed = fabric.util.toFixed;\n\n  if (fabric.Polyline) {\n    fabric.warn(\"fabric.Polyline is already defined\");\n    return;\n  }\n\n  /**\n   * Polyline class\n   * @class fabric.Polyline\n   * @extends fabric.Object\n   * @see {@link fabric.Polyline#initialize} for constructor definition\n   */\n  fabric.Polyline = fabric.util.createClass(\n    fabric.Object,\n    /** @lends fabric.Polyline.prototype */ {\n      /**\n       * Type of an object\n       * @type String\n       * @default\n       */\n      type: \"polyline\",\n\n      /**\n       * Points array\n       * @type Array\n       * @default\n       */\n      points: null,\n\n      cacheProperties: fabric.Object.prototype.cacheProperties.concat(\"points\"),\n\n      /**\n       * Constructor\n       * @param {Array} points Array of points (where each point is an object with x and y)\n       * @param {Object} [options] Options object\n       * @return {fabric.Polyline} thisArg\n       * @example\n       * var poly = new fabric.Polyline([\n       *     { x: 10, y: 10 },\n       *     { x: 50, y: 30 },\n       *     { x: 40, y: 70 },\n       *     { x: 60, y: 50 },\n       *     { x: 100, y: 150 },\n       *     { x: 40, y: 100 }\n       *   ], {\n       *   stroke: 'red',\n       *   left: 100,\n       *   top: 100\n       * });\n       */\n      initialize: function (points, options) {\n        options = options || {};\n        this.points = points || [];\n        this.callSuper(\"initialize\", options);\n        this._setPositionDimensions(options);\n      },\n\n      _setPositionDimensions: function (options) {\n        var calcDim = this._calcDimensions(options),\n          correctLeftTop;\n        this.width = calcDim.width;\n        this.height = calcDim.height;\n        if (!options.fromSVG) {\n          correctLeftTop = this.translateToGivenOrigin(\n            {\n              x: calcDim.left - this.strokeWidth / 2,\n              y: calcDim.top - this.strokeWidth / 2,\n            },\n            \"left\",\n            \"top\",\n            this.originX,\n            this.originY\n          );\n        }\n        if (typeof options.left === \"undefined\") {\n          this.left = options.fromSVG ? calcDim.left : correctLeftTop.x;\n        }\n        if (typeof options.top === \"undefined\") {\n          this.top = options.fromSVG ? calcDim.top : correctLeftTop.y;\n        }\n        this.pathOffset = {\n          x: calcDim.left + this.width / 2,\n          y: calcDim.top + this.height / 2,\n        };\n      },\n\n      /**\n       * Calculate the polygon min and max point from points array,\n       * returning an object with left, top, widht, height to measure the\n       * polygon size\n       * @return {Object} object.left X coordinate of the polygon leftmost point\n       * @return {Object} object.top Y coordinate of the polygon topmost point\n       * @return {Object} object.width distance between X coordinates of the polygon leftmost and rightmost point\n       * @return {Object} object.height distance between Y coordinates of the polygon topmost and bottommost point\n       * @private\n       */\n      _calcDimensions: function () {\n        var points = this.points,\n          minX = min(points, \"x\") || 0,\n          minY = min(points, \"y\") || 0,\n          maxX = max(points, \"x\") || 0,\n          maxY = max(points, \"y\") || 0,\n          width = maxX - minX,\n          height = maxY - minY;\n\n        return {\n          left: minX,\n          top: minY,\n          width: width,\n          height: height,\n        };\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} Object representation of an instance\n       */\n      toObject: function (propertiesToInclude) {\n        return extend(this.callSuper(\"toObject\", propertiesToInclude), {\n          points: this.points.concat(),\n        });\n      },\n\n      /* _TO_SVG_START_ */\n      /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */\n      _toSVG: function () {\n        var points = [],\n          diffX = this.pathOffset.x,\n          diffY = this.pathOffset.y,\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n        for (var i = 0, len = this.points.length; i < len; i++) {\n          points.push(\n            toFixed(this.points[i].x - diffX, NUM_FRACTION_DIGITS),\n            \",\",\n            toFixed(this.points[i].y - diffY, NUM_FRACTION_DIGITS),\n            \" \"\n          );\n        }\n        return [\n          \"<\" + this.type + \" \",\n          \"COMMON_PARTS\",\n          'points=\"',\n          points.join(\"\"),\n          '\" />\\n',\n        ];\n      },\n      /* _TO_SVG_END_ */\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      commonRender: function (ctx) {\n        var point,\n          len = this.points.length,\n          x = this.pathOffset.x,\n          y = this.pathOffset.y;\n\n        if (!len || isNaN(this.points[len - 1].y)) {\n          // do not draw if no points or odd points\n          // NaN comes from parseFloat of a empty string in parser\n          return false;\n        }\n        ctx.beginPath();\n        ctx.moveTo(this.points[0].x - x, this.points[0].y - y);\n        for (var i = 0; i < len; i++) {\n          point = this.points[i];\n          ctx.lineTo(point.x - x, point.y - y);\n        }\n        return true;\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _render: function (ctx) {\n        if (!this.commonRender(ctx)) {\n          return;\n        }\n        this._renderPaintInOrder(ctx);\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderDashedStroke: function (ctx) {\n        var p1, p2;\n\n        ctx.beginPath();\n        for (var i = 0, len = this.points.length; i < len; i++) {\n          p1 = this.points[i];\n          p2 = this.points[i + 1] || p1;\n          fabric.util.drawDashedLine(\n            ctx,\n            p1.x,\n            p1.y,\n            p2.x,\n            p2.y,\n            this.strokeDashArray\n          );\n        }\n      },\n\n      /**\n       * Returns complexity of an instance\n       * @return {Number} complexity of this instance\n       */\n      complexity: function () {\n        return this.get(\"points\").length;\n      },\n    }\n  );\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Polyline.fromElement})\n   * @static\n   * @memberOf fabric.Polyline\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolylineElement\n   */\n  fabric.Polyline.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns fabric.Polyline instance from an SVG element\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {SVGElement} element Element to parser\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Polyline.fromElementGenerator = function (_class) {\n    return function (element, callback, options) {\n      if (!element) {\n        return callback(null);\n      }\n      options || (options = {});\n\n      var points = fabric.parsePointsAttribute(element.getAttribute(\"points\")),\n        parsedAttributes = fabric.parseAttributes(\n          element,\n          fabric[_class].ATTRIBUTE_NAMES\n        );\n      parsedAttributes.fromSVG = true;\n      callback(new fabric[_class](points, extend(parsedAttributes, options)));\n    };\n  };\n\n  fabric.Polyline.fromElement = fabric.Polyline.fromElementGenerator(\n    \"Polyline\"\n  );\n\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polyline instance from an object representation\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Polyline.fromObject = function (object, callback) {\n    return fabric.Object._fromObject(\"Polyline\", object, callback, \"points\");\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  if (fabric.Polygon) {\n    fabric.warn(\"fabric.Polygon is already defined\");\n    return;\n  }\n\n  /**\n   * Polygon class\n   * @class fabric.Polygon\n   * @extends fabric.Polyline\n   * @see {@link fabric.Polygon#initialize} for constructor definition\n   */\n  fabric.Polygon = fabric.util.createClass(\n    fabric.Polyline,\n    /** @lends fabric.Polygon.prototype */ {\n      /**\n       * Type of an object\n       * @type String\n       * @default\n       */\n      type: \"polygon\",\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _render: function (ctx) {\n        if (!this.commonRender(ctx)) {\n          return;\n        }\n        ctx.closePath();\n        this._renderPaintInOrder(ctx);\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderDashedStroke: function (ctx) {\n        this.callSuper(\"_renderDashedStroke\", ctx);\n        ctx.closePath();\n      },\n    }\n  );\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Polygon.fromElement`)\n   * @static\n   * @memberOf fabric.Polygon\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolygonElement\n   */\n  fabric.Polygon.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns {@link fabric.Polygon} instance from an SVG element\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Polygon.fromElement = fabric.Polyline.fromElementGenerator(\"Polygon\");\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polygon instance from an object representation\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Polygon.fromObject = function (object, callback) {\n    return fabric.Object._fromObject(\"Polygon\", object, callback, \"points\");\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    min = fabric.util.array.min,\n    max = fabric.util.array.max,\n    extend = fabric.util.object.extend,\n    _toString = Object.prototype.toString,\n    drawArc = fabric.util.drawArc,\n    toFixed = fabric.util.toFixed,\n    commandLengths = {\n      m: 2,\n      l: 2,\n      h: 1,\n      v: 1,\n      c: 6,\n      s: 4,\n      q: 4,\n      t: 2,\n      a: 7,\n    },\n    repeatedCommands = {\n      m: \"l\",\n      M: \"L\",\n    };\n\n  if (fabric.Path) {\n    fabric.warn(\"fabric.Path is already defined\");\n    return;\n  }\n\n  /**\n   * Path class\n   * @class fabric.Path\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#path_and_pathgroup}\n   * @see {@link fabric.Path#initialize} for constructor definition\n   */\n  fabric.Path = fabric.util.createClass(\n    fabric.Object,\n    /** @lends fabric.Path.prototype */ {\n      /**\n       * Type of an object\n       * @type String\n       * @default\n       */\n      type: \"path\",\n\n      /**\n       * Array of path points\n       * @type Array\n       * @default\n       */\n      path: null,\n\n      cacheProperties: fabric.Object.prototype.cacheProperties.concat(\n        \"path\",\n        \"fillRule\"\n      ),\n\n      stateProperties: fabric.Object.prototype.stateProperties.concat(\"path\"),\n\n      /**\n       * Constructor\n       * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n       * @param {Object} [options] Options object\n       * @return {fabric.Path} thisArg\n       */\n      initialize: function (path, options) {\n        options = options || {};\n        this.callSuper(\"initialize\", options);\n\n        if (!path) {\n          path = [];\n        }\n\n        var fromArray = _toString.call(path) === \"[object Array]\";\n\n        this.path = fromArray\n          ? path\n          : // one of commands (m,M,l,L,q,Q,c,C,etc.) followed by non-command characters (i.e. command values)\n            path.match && path.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);\n\n        if (!this.path) {\n          return;\n        }\n\n        if (!fromArray) {\n          this.path = this._parsePath();\n        }\n\n        fabric.Polyline.prototype._setPositionDimensions.call(this, options);\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx context to render path on\n       */\n      _renderPathCommands: function (ctx) {\n        var current, // current instruction\n          previous = null,\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          controlX = 0, // current control point x\n          controlY = 0, // current control point y\n          tempX,\n          tempY,\n          l = -this.pathOffset.x,\n          t = -this.pathOffset.y;\n\n        ctx.beginPath();\n\n        for (var i = 0, len = this.path.length; i < len; ++i) {\n          current = this.path[i];\n\n          switch (\n            current[0] // first letter\n          ) {\n            case \"l\": // lineto, relative\n              x += current[1];\n              y += current[2];\n              ctx.lineTo(x + l, y + t);\n              break;\n\n            case \"L\": // lineto, absolute\n              x = current[1];\n              y = current[2];\n              ctx.lineTo(x + l, y + t);\n              break;\n\n            case \"h\": // horizontal lineto, relative\n              x += current[1];\n              ctx.lineTo(x + l, y + t);\n              break;\n\n            case \"H\": // horizontal lineto, absolute\n              x = current[1];\n              ctx.lineTo(x + l, y + t);\n              break;\n\n            case \"v\": // vertical lineto, relative\n              y += current[1];\n              ctx.lineTo(x + l, y + t);\n              break;\n\n            case \"V\": // verical lineto, absolute\n              y = current[1];\n              ctx.lineTo(x + l, y + t);\n              break;\n\n            case \"m\": // moveTo, relative\n              x += current[1];\n              y += current[2];\n              subpathStartX = x;\n              subpathStartY = y;\n              ctx.moveTo(x + l, y + t);\n              break;\n\n            case \"M\": // moveTo, absolute\n              x = current[1];\n              y = current[2];\n              subpathStartX = x;\n              subpathStartY = y;\n              ctx.moveTo(x + l, y + t);\n              break;\n\n            case \"c\": // bezierCurveTo, relative\n              tempX = x + current[5];\n              tempY = y + current[6];\n              controlX = x + current[3];\n              controlY = y + current[4];\n              ctx.bezierCurveTo(\n                x + current[1] + l, // x1\n                y + current[2] + t, // y1\n                controlX + l, // x2\n                controlY + t, // y2\n                tempX + l,\n                tempY + t\n              );\n              x = tempX;\n              y = tempY;\n              break;\n\n            case \"C\": // bezierCurveTo, absolute\n              x = current[5];\n              y = current[6];\n              controlX = current[3];\n              controlY = current[4];\n              ctx.bezierCurveTo(\n                current[1] + l,\n                current[2] + t,\n                controlX + l,\n                controlY + t,\n                x + l,\n                y + t\n              );\n              break;\n\n            case \"s\": // shorthand cubic bezierCurveTo, relative\n              // transform to absolute x,y\n              tempX = x + current[3];\n              tempY = y + current[4];\n\n              if (previous[0].match(/[CcSs]/) === null) {\n                // If there is no previous command or if the previous command was not a C, c, S, or s,\n                // the control point is coincident with the current point\n                controlX = x;\n                controlY = y;\n              } else {\n                // calculate reflection of previous control points\n                controlX = 2 * x - controlX;\n                controlY = 2 * y - controlY;\n              }\n\n              ctx.bezierCurveTo(\n                controlX + l,\n                controlY + t,\n                x + current[1] + l,\n                y + current[2] + t,\n                tempX + l,\n                tempY + t\n              );\n              // set control point to 2nd one of this command\n              // \"... the first control point is assumed to be\n              // the reflection of the second control point on\n              // the previous command relative to the current point.\"\n              controlX = x + current[1];\n              controlY = y + current[2];\n\n              x = tempX;\n              y = tempY;\n              break;\n\n            case \"S\": // shorthand cubic bezierCurveTo, absolute\n              tempX = current[3];\n              tempY = current[4];\n              if (previous[0].match(/[CcSs]/) === null) {\n                // If there is no previous command or if the previous command was not a C, c, S, or s,\n                // the control point is coincident with the current point\n                controlX = x;\n                controlY = y;\n              } else {\n                // calculate reflection of previous control points\n                controlX = 2 * x - controlX;\n                controlY = 2 * y - controlY;\n              }\n              ctx.bezierCurveTo(\n                controlX + l,\n                controlY + t,\n                current[1] + l,\n                current[2] + t,\n                tempX + l,\n                tempY + t\n              );\n              x = tempX;\n              y = tempY;\n\n              // set control point to 2nd one of this command\n              // \"... the first control point is assumed to be\n              // the reflection of the second control point on\n              // the previous command relative to the current point.\"\n              controlX = current[1];\n              controlY = current[2];\n\n              break;\n\n            case \"q\": // quadraticCurveTo, relative\n              // transform to absolute x,y\n              tempX = x + current[3];\n              tempY = y + current[4];\n\n              controlX = x + current[1];\n              controlY = y + current[2];\n\n              ctx.quadraticCurveTo(\n                controlX + l,\n                controlY + t,\n                tempX + l,\n                tempY + t\n              );\n              x = tempX;\n              y = tempY;\n              break;\n\n            case \"Q\": // quadraticCurveTo, absolute\n              tempX = current[3];\n              tempY = current[4];\n\n              ctx.quadraticCurveTo(\n                current[1] + l,\n                current[2] + t,\n                tempX + l,\n                tempY + t\n              );\n              x = tempX;\n              y = tempY;\n              controlX = current[1];\n              controlY = current[2];\n              break;\n\n            case \"t\": // shorthand quadraticCurveTo, relative\n              // transform to absolute x,y\n              tempX = x + current[1];\n              tempY = y + current[2];\n\n              if (previous[0].match(/[QqTt]/) === null) {\n                // If there is no previous command or if the previous command was not a Q, q, T or t,\n                // assume the control point is coincident with the current point\n                controlX = x;\n                controlY = y;\n              } else {\n                // calculate reflection of previous control point\n                controlX = 2 * x - controlX;\n                controlY = 2 * y - controlY;\n              }\n\n              ctx.quadraticCurveTo(\n                controlX + l,\n                controlY + t,\n                tempX + l,\n                tempY + t\n              );\n              x = tempX;\n              y = tempY;\n\n              break;\n\n            case \"T\":\n              tempX = current[1];\n              tempY = current[2];\n\n              if (previous[0].match(/[QqTt]/) === null) {\n                // If there is no previous command or if the previous command was not a Q, q, T or t,\n                // assume the control point is coincident with the current point\n                controlX = x;\n                controlY = y;\n              } else {\n                // calculate reflection of previous control point\n                controlX = 2 * x - controlX;\n                controlY = 2 * y - controlY;\n              }\n              ctx.quadraticCurveTo(\n                controlX + l,\n                controlY + t,\n                tempX + l,\n                tempY + t\n              );\n              x = tempX;\n              y = tempY;\n              break;\n\n            case \"a\":\n              // TODO: optimize this\n              drawArc(ctx, x + l, y + t, [\n                current[1],\n                current[2],\n                current[3],\n                current[4],\n                current[5],\n                current[6] + x + l,\n                current[7] + y + t,\n              ]);\n              x += current[6];\n              y += current[7];\n              break;\n\n            case \"A\":\n              // TODO: optimize this\n              drawArc(ctx, x + l, y + t, [\n                current[1],\n                current[2],\n                current[3],\n                current[4],\n                current[5],\n                current[6] + l,\n                current[7] + t,\n              ]);\n              x = current[6];\n              y = current[7];\n              break;\n\n            case \"z\":\n            case \"Z\":\n              x = subpathStartX;\n              y = subpathStartY;\n              ctx.closePath();\n              break;\n          }\n          previous = current;\n        }\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx context to render path on\n       */\n      _render: function (ctx) {\n        this._renderPathCommands(ctx);\n        this._renderPaintInOrder(ctx);\n      },\n\n      /**\n       * Returns string representation of an instance\n       * @return {String} string representation of an instance\n       */\n      toString: function () {\n        return (\n          \"#<fabric.Path (\" +\n          this.complexity() +\n          '): { \"top\": ' +\n          this.top +\n          ', \"left\": ' +\n          this.left +\n          \" }>\"\n        );\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */\n      toObject: function (propertiesToInclude) {\n        return extend(this.callSuper(\"toObject\", propertiesToInclude), {\n          path: this.path.map(function (item) {\n            return item.slice();\n          }),\n        });\n      },\n\n      /**\n       * Returns dataless object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */\n      toDatalessObject: function (propertiesToInclude) {\n        var o = this.toObject([\"sourcePath\"].concat(propertiesToInclude));\n        if (o.sourcePath) {\n          delete o.path;\n        }\n        return o;\n      },\n\n      /* _TO_SVG_START_ */\n      /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */\n      _toSVG: function () {\n        var path = this.path\n          .map(function (path) {\n            return path.join(\" \");\n          })\n          .join(\" \");\n        return [\n          \"<path \",\n          \"COMMON_PARTS\",\n          'd=\"',\n          path,\n          '\" stroke-linecap=\"round\" ',\n          \"/>\\n\",\n        ];\n      },\n\n      _getOffsetTransform: function () {\n        var digits = fabric.Object.NUM_FRACTION_DIGITS;\n        return (\n          \" translate(\" +\n          toFixed(-this.pathOffset.x, digits) +\n          \", \" +\n          toFixed(-this.pathOffset.y, digits) +\n          \")\"\n        );\n      },\n\n      /**\n       * Returns svg clipPath representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */\n      toClipPathSVG: function (reviver) {\n        var additionalTransform = this._getOffsetTransform();\n        return (\n          \"\\t\" +\n          this._createBaseClipPathSVGMarkup(this._toSVG(), {\n            reviver: reviver,\n            additionalTransform: additionalTransform,\n          })\n        );\n      },\n\n      /**\n       * Returns svg representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */\n      toSVG: function (reviver) {\n        var additionalTransform = this._getOffsetTransform();\n        return this._createBaseSVGMarkup(this._toSVG(), {\n          reviver: reviver,\n          additionalTransform: additionalTransform,\n        });\n      },\n      /* _TO_SVG_END_ */\n\n      /**\n       * Returns number representation of an instance complexity\n       * @return {Number} complexity of this instance\n       */\n      complexity: function () {\n        return this.path.length;\n      },\n\n      /**\n       * @private\n       */\n      _parsePath: function () {\n        var result = [],\n          coords = [],\n          currentPath,\n          parsed,\n          re = fabric.rePathCommand,\n          match,\n          coordsStr;\n\n        for (var i = 0, coordsParsed, len = this.path.length; i < len; i++) {\n          currentPath = this.path[i];\n\n          coordsStr = currentPath.slice(1).trim();\n          coords.length = 0;\n\n          while ((match = re.exec(coordsStr))) {\n            coords.push(match[0]);\n          }\n\n          coordsParsed = [currentPath.charAt(0)];\n\n          for (var j = 0, jlen = coords.length; j < jlen; j++) {\n            parsed = parseFloat(coords[j]);\n            if (!isNaN(parsed)) {\n              coordsParsed.push(parsed);\n            }\n          }\n\n          var command = coordsParsed[0],\n            commandLength = commandLengths[command.toLowerCase()],\n            repeatedCommand = repeatedCommands[command] || command;\n\n          if (coordsParsed.length - 1 > commandLength) {\n            for (\n              var k = 1, klen = coordsParsed.length;\n              k < klen;\n              k += commandLength\n            ) {\n              result.push(\n                [command].concat(coordsParsed.slice(k, k + commandLength))\n              );\n              command = repeatedCommand;\n            }\n          } else {\n            result.push(coordsParsed);\n          }\n        }\n\n        return result;\n      },\n\n      /**\n       * @private\n       */\n      _calcDimensions: function () {\n        var aX = [],\n          aY = [],\n          current, // current instruction\n          previous = null,\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          controlX = 0, // current control point x\n          controlY = 0, // current control point y\n          tempX,\n          tempY,\n          bounds;\n\n        for (var i = 0, len = this.path.length; i < len; ++i) {\n          current = this.path[i];\n\n          switch (\n            current[0] // first letter\n          ) {\n            case \"l\": // lineto, relative\n              x += current[1];\n              y += current[2];\n              bounds = [];\n              break;\n\n            case \"L\": // lineto, absolute\n              x = current[1];\n              y = current[2];\n              bounds = [];\n              break;\n\n            case \"h\": // horizontal lineto, relative\n              x += current[1];\n              bounds = [];\n              break;\n\n            case \"H\": // horizontal lineto, absolute\n              x = current[1];\n              bounds = [];\n              break;\n\n            case \"v\": // vertical lineto, relative\n              y += current[1];\n              bounds = [];\n              break;\n\n            case \"V\": // verical lineto, absolute\n              y = current[1];\n              bounds = [];\n              break;\n\n            case \"m\": // moveTo, relative\n              x += current[1];\n              y += current[2];\n              subpathStartX = x;\n              subpathStartY = y;\n              bounds = [];\n              break;\n\n            case \"M\": // moveTo, absolute\n              x = current[1];\n              y = current[2];\n              subpathStartX = x;\n              subpathStartY = y;\n              bounds = [];\n              break;\n\n            case \"c\": // bezierCurveTo, relative\n              tempX = x + current[5];\n              tempY = y + current[6];\n              controlX = x + current[3];\n              controlY = y + current[4];\n              bounds = fabric.util.getBoundsOfCurve(\n                x,\n                y,\n                x + current[1], // x1\n                y + current[2], // y1\n                controlX, // x2\n                controlY, // y2\n                tempX,\n                tempY\n              );\n              x = tempX;\n              y = tempY;\n              break;\n\n            case \"C\": // bezierCurveTo, absolute\n              controlX = current[3];\n              controlY = current[4];\n              bounds = fabric.util.getBoundsOfCurve(\n                x,\n                y,\n                current[1],\n                current[2],\n                controlX,\n                controlY,\n                current[5],\n                current[6]\n              );\n              x = current[5];\n              y = current[6];\n              break;\n\n            case \"s\": // shorthand cubic bezierCurveTo, relative\n              // transform to absolute x,y\n              tempX = x + current[3];\n              tempY = y + current[4];\n\n              if (previous[0].match(/[CcSs]/) === null) {\n                // If there is no previous command or if the previous command was not a C, c, S, or s,\n                // the control point is coincident with the current point\n                controlX = x;\n                controlY = y;\n              } else {\n                // calculate reflection of previous control points\n                controlX = 2 * x - controlX;\n                controlY = 2 * y - controlY;\n              }\n\n              bounds = fabric.util.getBoundsOfCurve(\n                x,\n                y,\n                controlX,\n                controlY,\n                x + current[1],\n                y + current[2],\n                tempX,\n                tempY\n              );\n              // set control point to 2nd one of this command\n              // \"... the first control point is assumed to be\n              // the reflection of the second control point on\n              // the previous command relative to the current point.\"\n              controlX = x + current[1];\n              controlY = y + current[2];\n              x = tempX;\n              y = tempY;\n              break;\n\n            case \"S\": // shorthand cubic bezierCurveTo, absolute\n              tempX = current[3];\n              tempY = current[4];\n              if (previous[0].match(/[CcSs]/) === null) {\n                // If there is no previous command or if the previous command was not a C, c, S, or s,\n                // the control point is coincident with the current point\n                controlX = x;\n                controlY = y;\n              } else {\n                // calculate reflection of previous control points\n                controlX = 2 * x - controlX;\n                controlY = 2 * y - controlY;\n              }\n              bounds = fabric.util.getBoundsOfCurve(\n                x,\n                y,\n                controlX,\n                controlY,\n                current[1],\n                current[2],\n                tempX,\n                tempY\n              );\n              x = tempX;\n              y = tempY;\n              // set control point to 2nd one of this command\n              // \"... the first control point is assumed to be\n              // the reflection of the second control point on\n              // the previous command relative to the current point.\"\n              controlX = current[1];\n              controlY = current[2];\n              break;\n\n            case \"q\": // quadraticCurveTo, relative\n              // transform to absolute x,y\n              tempX = x + current[3];\n              tempY = y + current[4];\n              controlX = x + current[1];\n              controlY = y + current[2];\n              bounds = fabric.util.getBoundsOfCurve(\n                x,\n                y,\n                controlX,\n                controlY,\n                controlX,\n                controlY,\n                tempX,\n                tempY\n              );\n              x = tempX;\n              y = tempY;\n              break;\n\n            case \"Q\": // quadraticCurveTo, absolute\n              controlX = current[1];\n              controlY = current[2];\n              bounds = fabric.util.getBoundsOfCurve(\n                x,\n                y,\n                controlX,\n                controlY,\n                controlX,\n                controlY,\n                current[3],\n                current[4]\n              );\n              x = current[3];\n              y = current[4];\n              break;\n\n            case \"t\": // shorthand quadraticCurveTo, relative\n              // transform to absolute x,y\n              tempX = x + current[1];\n              tempY = y + current[2];\n              if (previous[0].match(/[QqTt]/) === null) {\n                // If there is no previous command or if the previous command was not a Q, q, T or t,\n                // assume the control point is coincident with the current point\n                controlX = x;\n                controlY = y;\n              } else {\n                // calculate reflection of previous control point\n                controlX = 2 * x - controlX;\n                controlY = 2 * y - controlY;\n              }\n\n              bounds = fabric.util.getBoundsOfCurve(\n                x,\n                y,\n                controlX,\n                controlY,\n                controlX,\n                controlY,\n                tempX,\n                tempY\n              );\n              x = tempX;\n              y = tempY;\n\n              break;\n\n            case \"T\":\n              tempX = current[1];\n              tempY = current[2];\n\n              if (previous[0].match(/[QqTt]/) === null) {\n                // If there is no previous command or if the previous command was not a Q, q, T or t,\n                // assume the control point is coincident with the current point\n                controlX = x;\n                controlY = y;\n              } else {\n                // calculate reflection of previous control point\n                controlX = 2 * x - controlX;\n                controlY = 2 * y - controlY;\n              }\n              bounds = fabric.util.getBoundsOfCurve(\n                x,\n                y,\n                controlX,\n                controlY,\n                controlX,\n                controlY,\n                tempX,\n                tempY\n              );\n              x = tempX;\n              y = tempY;\n              break;\n\n            case \"a\":\n              // TODO: optimize this\n              bounds = fabric.util.getBoundsOfArc(\n                x,\n                y,\n                current[1],\n                current[2],\n                current[3],\n                current[4],\n                current[5],\n                current[6] + x,\n                current[7] + y\n              );\n              x += current[6];\n              y += current[7];\n              break;\n\n            case \"A\":\n              // TODO: optimize this\n              bounds = fabric.util.getBoundsOfArc(\n                x,\n                y,\n                current[1],\n                current[2],\n                current[3],\n                current[4],\n                current[5],\n                current[6],\n                current[7]\n              );\n              x = current[6];\n              y = current[7];\n              break;\n\n            case \"z\":\n            case \"Z\":\n              x = subpathStartX;\n              y = subpathStartY;\n              break;\n          }\n          previous = current;\n          bounds.forEach(function (point) {\n            aX.push(point.x);\n            aY.push(point.y);\n          });\n          aX.push(x);\n          aY.push(y);\n        }\n\n        var minX = min(aX) || 0,\n          minY = min(aY) || 0,\n          maxX = max(aX) || 0,\n          maxY = max(aY) || 0,\n          deltaX = maxX - minX,\n          deltaY = maxY - minY;\n\n        return {\n          left: minX,\n          top: minY,\n          width: deltaX,\n          height: deltaY,\n        };\n      },\n    }\n  );\n\n  /**\n   * Creates an instance of fabric.Path from an object\n   * @static\n   * @memberOf fabric.Path\n   * @param {Object} object\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Path.fromObject = function (object, callback) {\n    if (typeof object.sourcePath === \"string\") {\n      var pathUrl = object.sourcePath;\n      fabric.loadSVGFromURL(pathUrl, function (elements) {\n        var path = elements[0];\n        path.setOptions(object);\n        callback && callback(path);\n      });\n    } else {\n      fabric.Object._fromObject(\"Path\", object, callback, \"path\");\n    }\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Path.fromElement`)\n   * @static\n   * @memberOf fabric.Path\n   * @see http://www.w3.org/TR/SVG/paths.html#PathElement\n   */\n  fabric.Path.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat([\"d\"]);\n\n  /**\n   * Creates an instance of fabric.Path from an SVG <path> element\n   * @static\n   * @memberOf fabric.Path\n   * @param {SVGElement} element to parse\n   * @param {Function} callback Callback to invoke when an fabric.Path instance is created\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   */\n  fabric.Path.fromElement = function (element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(\n      element,\n      fabric.Path.ATTRIBUTE_NAMES\n    );\n    parsedAttributes.fromSVG = true;\n    callback(\n      new fabric.Path(parsedAttributes.d, extend(parsedAttributes, options))\n    );\n  };\n  /* _FROM_SVG_END_ */\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    min = fabric.util.array.min,\n    max = fabric.util.array.max;\n\n  if (fabric.Group) {\n    return;\n  }\n\n  /**\n   * Group class\n   * @class fabric.Group\n   * @extends fabric.Object\n   * @mixes fabric.Collection\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.Group#initialize} for constructor definition\n   */\n  fabric.Group = fabric.util.createClass(\n    fabric.Object,\n    fabric.Collection,\n    /** @lends fabric.Group.prototype */ {\n      /**\n       * Type of an object\n       * @type String\n       * @default\n       */\n      type: \"group\",\n\n      /**\n       * Width of stroke\n       * @type Number\n       * @default\n       */\n      strokeWidth: 0,\n\n      /**\n       * Indicates if click, mouseover, mouseout events & hoverCursor should also check for subtargets\n       * @type Boolean\n       * @default\n       */\n      subTargetCheck: false,\n\n      /**\n       * Groups are container, do not render anything on theyr own, ence no cache properties\n       * @type Array\n       * @default\n       */\n      cacheProperties: [],\n\n      /**\n       * setOnGroup is a method used for TextBox that is no more used since 2.0.0 The behavior is still\n       * available setting this boolean to true.\n       * @type Boolean\n       * @since 2.0.0\n       * @default\n       */\n      useSetOnGroup: false,\n\n      /**\n       * Constructor\n       * @param {Object} objects Group objects\n       * @param {Object} [options] Options object\n       * @param {Boolean} [isAlreadyGrouped] if true, objects have been grouped already.\n       * @return {Object} thisArg\n       */\n      initialize: function (objects, options, isAlreadyGrouped) {\n        options = options || {};\n        this._objects = [];\n        // if objects enclosed in a group have been grouped already,\n        // we cannot change properties of objects.\n        // Thus we need to set options to group without objects,\n        isAlreadyGrouped && this.callSuper(\"initialize\", options);\n        this._objects = objects || [];\n        for (var i = this._objects.length; i--; ) {\n          this._objects[i].group = this;\n        }\n\n        if (!isAlreadyGrouped) {\n          var center = options && options.centerPoint;\n          // we want to set origins before calculating the bounding box.\n          // so that the topleft can be set with that in mind.\n          // if specific top and left are passed, are overwritten later\n          // with the callSuper('initialize', options)\n          if (options.originX !== undefined) {\n            this.originX = options.originX;\n          }\n          if (options.originY !== undefined) {\n            this.originY = options.originY;\n          }\n          // if coming from svg i do not want to calc bounds.\n          // i assume width and height are passed along options\n          center || this._calcBounds();\n          this._updateObjectsCoords(center);\n          delete options.centerPoint;\n          this.callSuper(\"initialize\", options);\n        } else {\n          this._updateObjectsACoords();\n        }\n\n        this.setCoords();\n      },\n\n      /**\n       * @private\n       * @param {Boolean} [skipCoordsChange] if true, coordinates of objects enclosed in a group do not change\n       */\n      _updateObjectsACoords: function () {\n        var skipControls = true;\n        for (var i = this._objects.length; i--; ) {\n          this._objects[i].setCoords(skipControls);\n        }\n      },\n\n      /**\n       * @private\n       * @param {Boolean} [skipCoordsChange] if true, coordinates of objects enclosed in a group do not change\n       */\n      _updateObjectsCoords: function (center) {\n        var center = center || this.getCenterPoint();\n        for (var i = this._objects.length; i--; ) {\n          this._updateObjectCoords(this._objects[i], center);\n        }\n      },\n\n      /**\n       * @private\n       * @param {Object} object\n       * @param {fabric.Point} center, current center of group.\n       */\n      _updateObjectCoords: function (object, center) {\n        var objectLeft = object.left,\n          objectTop = object.top,\n          skipControls = true;\n\n        object.set({\n          left: objectLeft - center.x,\n          top: objectTop - center.y,\n        });\n        object.group = this;\n        object.setCoords(skipControls);\n      },\n\n      /**\n       * Returns string represenation of a group\n       * @return {String}\n       */\n      toString: function () {\n        return \"#<fabric.Group: (\" + this.complexity() + \")>\";\n      },\n\n      /**\n       * Adds an object to a group; Then recalculates group's dimension, position.\n       * @param {Object} object\n       * @return {fabric.Group} thisArg\n       * @chainable\n       */\n      addWithUpdate: function (object) {\n        this._restoreObjectsState();\n        fabric.util.resetObjectTransform(this);\n        if (object) {\n          this._objects.push(object);\n          object.group = this;\n          object._set(\"canvas\", this.canvas);\n        }\n        this._calcBounds();\n        this._updateObjectsCoords();\n        this.setCoords();\n        this.dirty = true;\n        return this;\n      },\n\n      /**\n       * Removes an object from a group; Then recalculates group's dimension, position.\n       * @param {Object} object\n       * @return {fabric.Group} thisArg\n       * @chainable\n       */\n      removeWithUpdate: function (object) {\n        this._restoreObjectsState();\n        fabric.util.resetObjectTransform(this);\n\n        this.remove(object);\n        this._calcBounds();\n        this._updateObjectsCoords();\n        this.setCoords();\n        this.dirty = true;\n        return this;\n      },\n\n      /**\n       * @private\n       */\n      _onObjectAdded: function (object) {\n        this.dirty = true;\n        object.group = this;\n        object._set(\"canvas\", this.canvas);\n      },\n\n      /**\n       * @private\n       */\n      _onObjectRemoved: function (object) {\n        this.dirty = true;\n        delete object.group;\n      },\n\n      /**\n       * @private\n       */\n      _set: function (key, value) {\n        var i = this._objects.length;\n        if (this.useSetOnGroup) {\n          while (i--) {\n            this._objects[i].setOnGroup(key, value);\n          }\n        }\n        if (key === \"canvas\") {\n          while (i--) {\n            this._objects[i]._set(key, value);\n          }\n        }\n        fabric.Object.prototype._set.call(this, key, value);\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */\n      toObject: function (propertiesToInclude) {\n        var _includeDefaultValues = this.includeDefaultValues;\n        var objsToObject = this._objects.map(function (obj) {\n          var originalDefaults = obj.includeDefaultValues;\n          obj.includeDefaultValues = _includeDefaultValues;\n          var _obj = obj.toObject(propertiesToInclude);\n          obj.includeDefaultValues = originalDefaults;\n          return _obj;\n        });\n        var obj = fabric.Object.prototype.toObject.call(\n          this,\n          propertiesToInclude\n        );\n        obj.objects = objsToObject;\n        return obj;\n      },\n\n      /**\n       * Returns object representation of an instance, in dataless mode.\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} object representation of an instance\n       */\n      toDatalessObject: function (propertiesToInclude) {\n        var objsToObject,\n          sourcePath = this.sourcePath;\n        if (sourcePath) {\n          objsToObject = sourcePath;\n        } else {\n          var _includeDefaultValues = this.includeDefaultValues;\n          objsToObject = this._objects.map(function (obj) {\n            var originalDefaults = obj.includeDefaultValues;\n            obj.includeDefaultValues = _includeDefaultValues;\n            var _obj = obj.toDatalessObject(propertiesToInclude);\n            obj.includeDefaultValues = originalDefaults;\n            return _obj;\n          });\n        }\n        var obj = fabric.Object.prototype.toDatalessObject.call(\n          this,\n          propertiesToInclude\n        );\n        obj.objects = objsToObject;\n        return obj;\n      },\n\n      /**\n       * Renders instance on a given context\n       * @param {CanvasRenderingContext2D} ctx context to render instance on\n       */\n      render: function (ctx) {\n        this._transformDone = true;\n        this.callSuper(\"render\", ctx);\n        this._transformDone = false;\n      },\n\n      /**\n       * Decide if the object should cache or not. Create its own cache level\n       * needsItsOwnCache should be used when the object drawing method requires\n       * a cache step. None of the fabric classes requires it.\n       * Generally you do not cache objects in groups because the group is already cached.\n       * @return {Boolean}\n       */\n      shouldCache: function () {\n        var ownCache = fabric.Object.prototype.shouldCache.call(this);\n        if (ownCache) {\n          for (var i = 0, len = this._objects.length; i < len; i++) {\n            if (this._objects[i].willDrawShadow()) {\n              this.ownCaching = false;\n              return false;\n            }\n          }\n        }\n        return ownCache;\n      },\n\n      /**\n       * Check if this object or a child object will cast a shadow\n       * @return {Boolean}\n       */\n      willDrawShadow: function () {\n        if (fabric.Object.prototype.willDrawShadow.call(this)) {\n          return true;\n        }\n        for (var i = 0, len = this._objects.length; i < len; i++) {\n          if (this._objects[i].willDrawShadow()) {\n            return true;\n          }\n        }\n        return false;\n      },\n\n      /**\n       * Check if this group or its parent group are caching, recursively up\n       * @return {Boolean}\n       */\n      isOnACache: function () {\n        return this.ownCaching || (this.group && this.group.isOnACache());\n      },\n\n      /**\n       * Execute the drawing operation for an object on a specified context\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      drawObject: function (ctx) {\n        for (var i = 0, len = this._objects.length; i < len; i++) {\n          this._objects[i].render(ctx);\n        }\n        this._drawClipPath(ctx);\n      },\n\n      /**\n       * Check if cache is dirty\n       */\n      isCacheDirty: function (skipCanvas) {\n        if (this.callSuper(\"isCacheDirty\", skipCanvas)) {\n          return true;\n        }\n        if (!this.statefullCache) {\n          return false;\n        }\n        for (var i = 0, len = this._objects.length; i < len; i++) {\n          if (this._objects[i].isCacheDirty(true)) {\n            if (this._cacheCanvas) {\n              // if this group has not a cache canvas there is nothing to clean\n              var x = this.cacheWidth / this.zoomX,\n                y = this.cacheHeight / this.zoomY;\n              this._cacheContext.clearRect(-x / 2, -y / 2, x, y);\n            }\n            return true;\n          }\n        }\n        return false;\n      },\n\n      /**\n       * Retores original state of each of group objects (original state is that which was before group was created).\n       * @private\n       * @return {fabric.Group} thisArg\n       * @chainable\n       */\n      _restoreObjectsState: function () {\n        this._objects.forEach(this._restoreObjectState, this);\n        return this;\n      },\n\n      /**\n       * Realises the transform from this group onto the supplied object\n       * i.e. it tells you what would happen if the supplied object was in\n       * the group, and then the group was destroyed. It mutates the supplied\n       * object.\n       * @param {fabric.Object} object\n       * @return {fabric.Object} transformedObject\n       */\n      realizeTransform: function (object) {\n        var matrix = object.calcTransformMatrix(),\n          options = fabric.util.qrDecompose(matrix),\n          center = new fabric.Point(options.translateX, options.translateY);\n        object.flipX = false;\n        object.flipY = false;\n        object.set(\"scaleX\", options.scaleX);\n        object.set(\"scaleY\", options.scaleY);\n        object.skewX = options.skewX;\n        object.skewY = options.skewY;\n        object.angle = options.angle;\n        object.setPositionByOrigin(center, \"center\", \"center\");\n        return object;\n      },\n\n      /**\n       * Restores original state of a specified object in group\n       * @private\n       * @param {fabric.Object} object\n       * @return {fabric.Group} thisArg\n       */\n      _restoreObjectState: function (object) {\n        this.realizeTransform(object);\n        object.setCoords();\n        delete object.group;\n        return this;\n      },\n\n      /**\n       * Destroys a group (restoring state of its objects)\n       * @return {fabric.Group} thisArg\n       * @chainable\n       */\n      destroy: function () {\n        // when group is destroyed objects needs to get a repaint to be eventually\n        // displayed on canvas.\n        this._objects.forEach(function (object) {\n          object.set(\"dirty\", true);\n        });\n        return this._restoreObjectsState();\n      },\n\n      /**\n       * make a group an active selection, remove the group from canvas\n       * the group has to be on canvas for this to work.\n       * @return {fabric.ActiveSelection} thisArg\n       * @chainable\n       */\n      toActiveSelection: function () {\n        if (!this.canvas) {\n          return;\n        }\n        var objects = this._objects,\n          canvas = this.canvas;\n        this._objects = [];\n        var options = this.toObject();\n        delete options.objects;\n        var activeSelection = new fabric.ActiveSelection([]);\n        activeSelection.set(options);\n        activeSelection.type = \"activeSelection\";\n        canvas.remove(this);\n        objects.forEach(function (object) {\n          object.group = activeSelection;\n          object.dirty = true;\n          canvas.add(object);\n        });\n        activeSelection.canvas = canvas;\n        activeSelection._objects = objects;\n        canvas._activeObject = activeSelection;\n        activeSelection.setCoords();\n        return activeSelection;\n      },\n\n      /**\n       * Destroys a group (restoring state of its objects)\n       * @return {fabric.Group} thisArg\n       * @chainable\n       */\n      ungroupOnCanvas: function () {\n        return this._restoreObjectsState();\n      },\n\n      /**\n       * Sets coordinates of all objects inside group\n       * @return {fabric.Group} thisArg\n       * @chainable\n       */\n      setObjectsCoords: function () {\n        var skipControls = true;\n        this.forEachObject(function (object) {\n          object.setCoords(skipControls);\n        });\n        return this;\n      },\n\n      /**\n       * @private\n       */\n      _calcBounds: function (onlyWidthHeight) {\n        var aX = [],\n          aY = [],\n          o,\n          prop,\n          props = [\"tr\", \"br\", \"bl\", \"tl\"],\n          i = 0,\n          iLen = this._objects.length,\n          j,\n          jLen = props.length;\n\n        for (; i < iLen; ++i) {\n          o = this._objects[i];\n          o.aCoords = o.calcACoords();\n          for (j = 0; j < jLen; j++) {\n            prop = props[j];\n            aX.push(o.aCoords[prop].x);\n            aY.push(o.aCoords[prop].y);\n          }\n        }\n\n        this._getBounds(aX, aY, onlyWidthHeight);\n      },\n\n      /**\n       * @private\n       */\n      _getBounds: function (aX, aY, onlyWidthHeight) {\n        var minXY = new fabric.Point(min(aX), min(aY)),\n          maxXY = new fabric.Point(max(aX), max(aY)),\n          top = minXY.y || 0,\n          left = minXY.x || 0,\n          width = maxXY.x - minXY.x || 0,\n          height = maxXY.y - minXY.y || 0;\n        this.width = width;\n        this.height = height;\n        if (!onlyWidthHeight) {\n          // the bounding box always finds the topleft most corner.\n          // whatever is the group origin, we set up here the left/top position.\n          this.setPositionByOrigin({ x: left, y: top }, \"left\", \"top\");\n        }\n      },\n\n      /* _TO_SVG_START_ */\n      /**\n       * Returns svg representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */\n      _toSVG: function (reviver) {\n        var svgString = [\"<g \", \"COMMON_PARTS\", \" >\\n\"];\n\n        for (var i = 0, len = this._objects.length; i < len; i++) {\n          svgString.push(\"\\t\\t\", this._objects[i].toSVG(reviver));\n        }\n        svgString.push(\"</g>\\n\");\n        return svgString;\n      },\n\n      /**\n       * Returns styles-string for svg-export, specific version for group\n       * @return {String}\n       */\n      getSvgStyles: function () {\n        var opacity =\n            typeof this.opacity !== \"undefined\" && this.opacity !== 1\n              ? \"opacity: \" + this.opacity + \";\"\n              : \"\",\n          visibility = this.visible ? \"\" : \" visibility: hidden;\";\n        return [opacity, this.getSvgFilter(), visibility].join(\"\");\n      },\n\n      /**\n       * Returns svg clipPath representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */\n      toClipPathSVG: function (reviver) {\n        var svgString = [];\n\n        for (var i = 0, len = this._objects.length; i < len; i++) {\n          svgString.push(\"\\t\", this._objects[i].toClipPathSVG(reviver));\n        }\n\n        return this._createBaseClipPathSVGMarkup(svgString, {\n          reviver: reviver,\n        });\n      },\n      /* _TO_SVG_END_ */\n    }\n  );\n\n  /**\n   * Returns {@link fabric.Group} instance from an object representation\n   * @static\n   * @memberOf fabric.Group\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an group instance is created\n   */\n  fabric.Group.fromObject = function (object, callback) {\n    var objects = object.objects,\n      options = fabric.util.object.clone(object, true);\n    delete options.objects;\n    if (typeof objects === \"string\") {\n      // it has to be an url or something went wrong.\n      fabric.loadSVGFromURL(objects, function (elements) {\n        var group = fabric.util.groupSVGElements(elements, object, objects);\n        group.set(options);\n        callback && callback(group);\n      });\n      return;\n    }\n    fabric.util.enlivenObjects(objects, function (enlivenedObjects) {\n      fabric.util.enlivenObjects([object.clipPath], function (enlivedClipPath) {\n        var options = fabric.util.object.clone(object, true);\n        options.clipPath = enlivedClipPath[0];\n        delete options.objects;\n        callback && callback(new fabric.Group(enlivenedObjects, options, true));\n      });\n    });\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  if (fabric.ActiveSelection) {\n    return;\n  }\n\n  /**\n   * Group class\n   * @class fabric.ActiveSelection\n   * @extends fabric.Group\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.ActiveSelection#initialize} for constructor definition\n   */\n  fabric.ActiveSelection = fabric.util.createClass(\n    fabric.Group,\n    /** @lends fabric.ActiveSelection.prototype */ {\n      /**\n       * Type of an object\n       * @type String\n       * @default\n       */\n      type: \"activeSelection\",\n\n      /**\n       * Constructor\n       * @param {Object} objects ActiveSelection objects\n       * @param {Object} [options] Options object\n       * @return {Object} thisArg\n       */\n      initialize: function (objects, options) {\n        options = options || {};\n        this._objects = objects || [];\n        for (var i = this._objects.length; i--; ) {\n          this._objects[i].group = this;\n        }\n\n        if (options.originX) {\n          this.originX = options.originX;\n        }\n        if (options.originY) {\n          this.originY = options.originY;\n        }\n        this._calcBounds();\n        this._updateObjectsCoords();\n        fabric.Object.prototype.initialize.call(this, options);\n        this.setCoords();\n      },\n\n      /**\n       * Change te activeSelection to a normal group,\n       * High level function that automatically adds it to canvas as\n       * active object. no events fired.\n       * @since 2.0.0\n       * @return {fabric.Group}\n       */\n      toGroup: function () {\n        var objects = this._objects.concat();\n        this._objects = [];\n        var options = fabric.Object.prototype.toObject.call(this);\n        var newGroup = new fabric.Group([]);\n        delete options.type;\n        newGroup.set(options);\n        objects.forEach(function (object) {\n          object.canvas.remove(object);\n          object.group = newGroup;\n        });\n        newGroup._objects = objects;\n        if (!this.canvas) {\n          return newGroup;\n        }\n        var canvas = this.canvas;\n        canvas.add(newGroup);\n        canvas._activeObject = newGroup;\n        newGroup.setCoords();\n        return newGroup;\n      },\n\n      /**\n       * If returns true, deselection is cancelled.\n       * @since 2.0.0\n       * @return {Boolean} [cancel]\n       */\n      onDeselect: function () {\n        this.destroy();\n        return false;\n      },\n\n      /**\n       * Returns string representation of a group\n       * @return {String}\n       */\n      toString: function () {\n        return \"#<fabric.ActiveSelection: (\" + this.complexity() + \")>\";\n      },\n\n      /**\n       * Decide if the object should cache or not. Create its own cache level\n       * objectCaching is a global flag, wins over everything\n       * needsItsOwnCache should be used when the object drawing method requires\n       * a cache step. None of the fabric classes requires it.\n       * Generally you do not cache objects in groups because the group outside is cached.\n       * @return {Boolean}\n       */\n      shouldCache: function () {\n        return false;\n      },\n\n      /**\n       * Check if this group or its parent group are caching, recursively up\n       * @return {Boolean}\n       */\n      isOnACache: function () {\n        return false;\n      },\n\n      /**\n       * Renders controls and borders for the object\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {Object} [styleOverride] properties to override the object style\n       * @param {Object} [childrenOverride] properties to override the children overrides\n       */\n      _renderControls: function (ctx, styleOverride, childrenOverride) {\n        ctx.save();\n        ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n        this.callSuper(\"_renderControls\", ctx, styleOverride);\n        childrenOverride = childrenOverride || {};\n        if (typeof childrenOverride.hasControls === \"undefined\") {\n          childrenOverride.hasControls = false;\n        }\n        childrenOverride.forActiveSelection = true;\n        for (var i = 0, len = this._objects.length; i < len; i++) {\n          this._objects[i]._renderControls(ctx, childrenOverride);\n        }\n        ctx.restore();\n      },\n    }\n  );\n\n  /**\n   * Returns {@link fabric.ActiveSelection} instance from an object representation\n   * @static\n   * @memberOf fabric.ActiveSelection\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an ActiveSelection instance is created\n   */\n  fabric.ActiveSelection.fromObject = function (object, callback) {\n    fabric.util.enlivenObjects(object.objects, function (enlivenedObjects) {\n      delete object.objects;\n      callback &&\n        callback(new fabric.ActiveSelection(enlivenedObjects, object, true));\n    });\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var extend = fabric.util.object.extend;\n\n  if (!global.fabric) {\n    global.fabric = {};\n  }\n\n  if (global.fabric.Image) {\n    fabric.warn(\"fabric.Image is already defined.\");\n    return;\n  }\n\n  /**\n   * Image class\n   * @class fabric.Image\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#images}\n   * @see {@link fabric.Image#initialize} for constructor definition\n   */\n  fabric.Image = fabric.util.createClass(\n    fabric.Object,\n    /** @lends fabric.Image.prototype */ {\n      /**\n       * Type of an object\n       * @type String\n       * @default\n       */\n      type: \"image\",\n\n      /**\n       * Width of a stroke.\n       * For image quality a stroke multiple of 2 gives better results.\n       * @type Number\n       * @default\n       */\n      strokeWidth: 0,\n\n      /**\n       * When calling {@link fabric.Image.getSrc}, return value from element src with `element.getAttribute('src')`.\n       * This allows for relative urls as image src.\n       * @since 2.7.0\n       * @type Boolean\n       * @default\n       */\n      srcFromAttribute: false,\n\n      /**\n       * private\n       * contains last value of scaleX to detect\n       * if the Image got resized after the last Render\n       * @type Number\n       */\n      _lastScaleX: 1,\n\n      /**\n       * private\n       * contains last value of scaleY to detect\n       * if the Image got resized after the last Render\n       * @type Number\n       */\n      _lastScaleY: 1,\n\n      /**\n       * private\n       * contains last value of scaling applied by the apply filter chain\n       * @type Number\n       */\n      _filterScalingX: 1,\n\n      /**\n       * private\n       * contains last value of scaling applied by the apply filter chain\n       * @type Number\n       */\n      _filterScalingY: 1,\n\n      /**\n       * minimum scale factor under which any resizeFilter is triggered to resize the image\n       * 0 will disable the automatic resize. 1 will trigger automatically always.\n       * number bigger than 1 are not implemented yet.\n       * @type Number\n       */\n      minimumScaleTrigger: 0.5,\n\n      /**\n       * List of properties to consider when checking if\n       * state of an object is changed ({@link fabric.Object#hasStateChanged})\n       * as well as for history (undo/redo) purposes\n       * @type Array\n       */\n      stateProperties: fabric.Object.prototype.stateProperties.concat(\n        \"cropX\",\n        \"cropY\"\n      ),\n\n      /**\n       * key used to retrieve the texture representing this image\n       * @since 2.0.0\n       * @type String\n       * @default\n       */\n      cacheKey: \"\",\n\n      /**\n       * Image crop in pixels from original image size.\n       * @since 2.0.0\n       * @type Number\n       * @default\n       */\n      cropX: 0,\n\n      /**\n       * Image crop in pixels from original image size.\n       * @since 2.0.0\n       * @type Number\n       * @default\n       */\n      cropY: 0,\n\n      /**\n       * Indicates whether this canvas will use image smoothing when painting this image.\n       * Also influence if the cacheCanvas for this image uses imageSmoothing\n       * @since 4.0.0-beta.11\n       * @type Boolean\n       * @default\n       */\n      imageSmoothing: true,\n\n      /**\n       * Constructor\n       * @param {HTMLImageElement | String} element Image element\n       * @param {Object} [options] Options object\n       * @param {function} [callback] callback function to call after eventual filters applied.\n       * @return {fabric.Image} thisArg\n       */\n      initialize: function (element, options) {\n        options || (options = {});\n        this.filters = [];\n        this.cacheKey = \"texture\" + fabric.Object.__uid++;\n        this.callSuper(\"initialize\", options);\n        this._initElement(element, options);\n      },\n\n      /**\n       * Returns image element which this instance if based on\n       * @return {HTMLImageElement} Image element\n       */\n      getElement: function () {\n        return this._element || {};\n      },\n\n      /**\n       * Sets image element for this instance to a specified one.\n       * If filters defined they are applied to new image.\n       * You might need to call `canvas.renderAll` and `object.setCoords` after replacing, to render new image and update controls area.\n       * @param {HTMLImageElement} element\n       * @param {Object} [options] Options object\n       * @return {fabric.Image} thisArg\n       * @chainable\n       */\n      setElement: function (element, options) {\n        this.removeTexture(this.cacheKey);\n        this.removeTexture(this.cacheKey + \"_filtered\");\n        this._element = element;\n        this._originalElement = element;\n        this._initConfig(options);\n        if (this.filters.length !== 0) {\n          this.applyFilters();\n        }\n        // resizeFilters work on the already filtered copy.\n        // we need to apply resizeFilters AFTER normal filters.\n        // applyResizeFilters is run more often than normal fiters\n        // and is triggered by user interactions rather than dev code\n        if (this.resizeFilter) {\n          this.applyResizeFilters();\n        }\n        return this;\n      },\n\n      /**\n       * Delete a single texture if in webgl mode\n       */\n      removeTexture: function (key) {\n        var backend = fabric.filterBackend;\n        if (backend && backend.evictCachesForKey) {\n          backend.evictCachesForKey(key);\n        }\n      },\n\n      /**\n       * Delete textures, reference to elements and eventually JSDOM cleanup\n       */\n      dispose: function () {\n        this.removeTexture(this.cacheKey);\n        this.removeTexture(this.cacheKey + \"_filtered\");\n        this._cacheContext = undefined;\n        [\"_originalElement\", \"_element\", \"_filteredEl\", \"_cacheCanvas\"].forEach(\n          function (element) {\n            fabric.util.cleanUpJsdomNode(this[element]);\n            this[element] = undefined;\n          }.bind(this)\n        );\n      },\n\n      /**\n       * Get the crossOrigin value (of the corresponding image element)\n       */\n      getCrossOrigin: function () {\n        return (\n          this._originalElement && (this._originalElement.crossOrigin || null)\n        );\n      },\n\n      /**\n       * Returns original size of an image\n       * @return {Object} Object with \"width\" and \"height\" properties\n       */\n      getOriginalSize: function () {\n        var element = this.getElement();\n        return {\n          width: element.naturalWidth || element.width,\n          height: element.naturalHeight || element.height,\n        };\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _stroke: function (ctx) {\n        if (!this.stroke || this.strokeWidth === 0) {\n          return;\n        }\n        var w = this.width / 2,\n          h = this.height / 2;\n        ctx.beginPath();\n        ctx.moveTo(-w, -h);\n        ctx.lineTo(w, -h);\n        ctx.lineTo(w, h);\n        ctx.lineTo(-w, h);\n        ctx.lineTo(-w, -h);\n        ctx.closePath();\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderDashedStroke: function (ctx) {\n        var x = -this.width / 2,\n          y = -this.height / 2,\n          w = this.width,\n          h = this.height;\n\n        ctx.save();\n        this._setStrokeStyles(ctx, this);\n\n        ctx.beginPath();\n        fabric.util.drawDashedLine(ctx, x, y, x + w, y, this.strokeDashArray);\n        fabric.util.drawDashedLine(\n          ctx,\n          x + w,\n          y,\n          x + w,\n          y + h,\n          this.strokeDashArray\n        );\n        fabric.util.drawDashedLine(\n          ctx,\n          x + w,\n          y + h,\n          x,\n          y + h,\n          this.strokeDashArray\n        );\n        fabric.util.drawDashedLine(ctx, x, y + h, x, y, this.strokeDashArray);\n        ctx.closePath();\n        ctx.restore();\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} Object representation of an instance\n       */\n      toObject: function (propertiesToInclude) {\n        var filters = [];\n\n        this.filters.forEach(function (filterObj) {\n          if (filterObj) {\n            filters.push(filterObj.toObject());\n          }\n        });\n        var object = extend(\n          this.callSuper(\n            \"toObject\",\n            [\"cropX\", \"cropY\"].concat(propertiesToInclude)\n          ),\n          {\n            src: this.getSrc(),\n            crossOrigin: this.getCrossOrigin(),\n            filters: filters,\n          }\n        );\n        if (this.resizeFilter) {\n          object.resizeFilter = this.resizeFilter.toObject();\n        }\n        return object;\n      },\n\n      /**\n       * Returns true if an image has crop applied, inspecting values of cropX,cropY,width,hight.\n       * @return {Boolean}\n       */\n      hasCrop: function () {\n        return (\n          this.cropX ||\n          this.cropY ||\n          this.width < this._element.width ||\n          this.height < this._element.height\n        );\n      },\n\n      /* _TO_SVG_START_ */\n      /**\n       * Returns svg representation of an instance\n       * @return {Array} an array of strings with the specific svg representation\n       * of the instance\n       */\n      _toSVG: function () {\n        var svgString = [],\n          imageMarkup = [],\n          strokeSvg,\n          element = this._element,\n          x = -this.width / 2,\n          y = -this.height / 2,\n          clipPath = \"\",\n          imageRendering = \"\";\n        if (!element) {\n          return [];\n        }\n        if (this.hasCrop()) {\n          var clipPathId = fabric.Object.__uid++;\n          svgString.push(\n            '<clipPath id=\"imageCrop_' + clipPathId + '\">\\n',\n            '\\t<rect x=\"' +\n              x +\n              '\" y=\"' +\n              y +\n              '\" width=\"' +\n              this.width +\n              '\" height=\"' +\n              this.height +\n              '\" />\\n',\n            \"</clipPath>\\n\"\n          );\n          clipPath = ' clip-path=\"url(#imageCrop_' + clipPathId + ')\" ';\n        }\n        if (!this.imageSmoothing) {\n          imageRendering = '\" image-rendering=\"optimizeSpeed';\n        }\n        imageMarkup.push(\n          \"\\t<image \",\n          \"COMMON_PARTS\",\n          'xlink:href=\"',\n          this.getSvgSrc(true),\n          '\" x=\"',\n          x - this.cropX,\n          '\" y=\"',\n          y - this.cropY,\n          // we're essentially moving origin of transformation from top/left corner to the center of the shape\n          // by wrapping it in container <g> element with actual transformation, then offsetting object to the top/left\n          // so that object's center aligns with container's left/top\n          '\" width=\"',\n          element.width || element.naturalWidth,\n          '\" height=\"',\n          element.height || element.height,\n          imageRendering,\n          '\"',\n          clipPath,\n          \"></image>\\n\"\n        );\n\n        if (this.stroke || this.strokeDashArray) {\n          var origFill = this.fill;\n          this.fill = null;\n          strokeSvg = [\n            \"\\t<rect \",\n            'x=\"',\n            x,\n            '\" y=\"',\n            y,\n            '\" width=\"',\n            this.width,\n            '\" height=\"',\n            this.height,\n            '\" style=\"',\n            this.getSvgStyles(),\n            '\"/>\\n',\n          ];\n          this.fill = origFill;\n        }\n        if (this.paintFirst !== \"fill\") {\n          svgString = svgString.concat(strokeSvg, imageMarkup);\n        } else {\n          svgString = svgString.concat(imageMarkup, strokeSvg);\n        }\n        return svgString;\n      },\n      /* _TO_SVG_END_ */\n\n      /**\n       * Returns source of an image\n       * @param {Boolean} filtered indicates if the src is needed for svg\n       * @return {String} Source of an image\n       */\n      getSrc: function (filtered) {\n        var element = filtered ? this._element : this._originalElement;\n        if (element) {\n          if (element.toDataURL) {\n            return element.toDataURL();\n          }\n\n          if (this.srcFromAttribute) {\n            return element.getAttribute(\"src\");\n          } else {\n            return element.src;\n          }\n        } else {\n          return this.src || \"\";\n        }\n      },\n\n      /**\n       * Sets source of an image\n       * @param {String} src Source string (URL)\n       * @param {Function} [callback] Callback is invoked when image has been loaded (and all filters have been applied)\n       * @param {Object} [options] Options object\n       * @param {String} [options.crossOrigin] crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n       * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n       * @return {fabric.Image} thisArg\n       * @chainable\n       */\n      setSrc: function (src, callback, options) {\n        fabric.util.loadImage(\n          src,\n          function (img, isError) {\n            this.setElement(img, options);\n            this._setWidthHeight();\n            callback && callback(this, isError);\n          },\n          this,\n          options && options.crossOrigin\n        );\n        return this;\n      },\n\n      /**\n       * Returns string representation of an instance\n       * @return {String} String representation of an instance\n       */\n      toString: function () {\n        return '#<fabric.Image: { src: \"' + this.getSrc() + '\" }>';\n      },\n\n      applyResizeFilters: function () {\n        var filter = this.resizeFilter,\n          minimumScale = this.minimumScaleTrigger,\n          objectScale = this.getTotalObjectScaling(),\n          scaleX = objectScale.scaleX,\n          scaleY = objectScale.scaleY,\n          elementToFilter = this._filteredEl || this._originalElement;\n        if (this.group) {\n          this.set(\"dirty\", true);\n        }\n        if (!filter || (scaleX > minimumScale && scaleY > minimumScale)) {\n          this._element = elementToFilter;\n          this._filterScalingX = 1;\n          this._filterScalingY = 1;\n          this._lastScaleX = scaleX;\n          this._lastScaleY = scaleY;\n          return;\n        }\n        if (!fabric.filterBackend) {\n          fabric.filterBackend = fabric.initFilterBackend();\n        }\n        var canvasEl = fabric.util.createCanvasElement(),\n          cacheKey = this._filteredEl\n            ? this.cacheKey + \"_filtered\"\n            : this.cacheKey,\n          sourceWidth = elementToFilter.width,\n          sourceHeight = elementToFilter.height;\n        canvasEl.width = sourceWidth;\n        canvasEl.height = sourceHeight;\n        this._element = canvasEl;\n        this._lastScaleX = filter.scaleX = scaleX;\n        this._lastScaleY = filter.scaleY = scaleY;\n        fabric.filterBackend.applyFilters(\n          [filter],\n          elementToFilter,\n          sourceWidth,\n          sourceHeight,\n          this._element,\n          cacheKey\n        );\n        this._filterScalingX = canvasEl.width / this._originalElement.width;\n        this._filterScalingY = canvasEl.height / this._originalElement.height;\n      },\n\n      /**\n       * Applies filters assigned to this image (from \"filters\" array) or from filter param\n       * @method applyFilters\n       * @param {Array} filters to be applied\n       * @param {Boolean} forResizing specify if the filter operation is a resize operation\n       * @return {thisArg} return the fabric.Image object\n       * @chainable\n       */\n      applyFilters: function (filters) {\n        filters = filters || this.filters || [];\n        filters = filters.filter(function (filter) {\n          return filter && !filter.isNeutralState();\n        });\n        this.set(\"dirty\", true);\n\n        // needs to clear out or WEBGL will not resize correctly\n        this.removeTexture(this.cacheKey + \"_filtered\");\n\n        if (filters.length === 0) {\n          this._element = this._originalElement;\n          this._filteredEl = null;\n          this._filterScalingX = 1;\n          this._filterScalingY = 1;\n          return this;\n        }\n\n        var imgElement = this._originalElement,\n          sourceWidth = imgElement.naturalWidth || imgElement.width,\n          sourceHeight = imgElement.naturalHeight || imgElement.height;\n\n        if (this._element === this._originalElement) {\n          // if the element is the same we need to create a new element\n          var canvasEl = fabric.util.createCanvasElement();\n          canvasEl.width = sourceWidth;\n          canvasEl.height = sourceHeight;\n          this._element = canvasEl;\n          this._filteredEl = canvasEl;\n        } else {\n          // clear the existing element to get new filter data\n          // also dereference the eventual resized _element\n          this._element = this._filteredEl;\n          this._filteredEl\n            .getContext(\"2d\")\n            .clearRect(0, 0, sourceWidth, sourceHeight);\n          // we also need to resize again at next renderAll, so remove saved _lastScaleX/Y\n          this._lastScaleX = 1;\n          this._lastScaleY = 1;\n        }\n        if (!fabric.filterBackend) {\n          fabric.filterBackend = fabric.initFilterBackend();\n        }\n        fabric.filterBackend.applyFilters(\n          filters,\n          this._originalElement,\n          sourceWidth,\n          sourceHeight,\n          this._element,\n          this.cacheKey\n        );\n        if (\n          this._originalElement.width !== this._element.width ||\n          this._originalElement.height !== this._element.height\n        ) {\n          this._filterScalingX =\n            this._element.width / this._originalElement.width;\n          this._filterScalingY =\n            this._element.height / this._originalElement.height;\n        }\n        return this;\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _render: function (ctx) {\n        fabric.util.setImageSmoothing(ctx, this.imageSmoothing);\n        if (\n          this.isMoving !== true &&\n          this.resizeFilter &&\n          this._needsResize()\n        ) {\n          this.applyResizeFilters();\n        }\n        this._stroke(ctx);\n        this._renderPaintInOrder(ctx);\n      },\n\n      /**\n       * Paint the cached copy of the object on the target context.\n       * it will set the imageSmoothing for the draw operation\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      drawCacheOnCanvas: function (ctx) {\n        fabric.util.setImageSmoothing(ctx, this.imageSmoothing);\n        fabric.Object.prototype.drawCacheOnCanvas.call(this, ctx);\n      },\n\n      /**\n       * Decide if the object should cache or not. Create its own cache level\n       * needsItsOwnCache should be used when the object drawing method requires\n       * a cache step. None of the fabric classes requires it.\n       * Generally you do not cache objects in groups because the group outside is cached.\n       * This is the special image version where we would like to avoid caching where possible.\n       * Essentially images do not benefit from caching. They may require caching, and in that\n       * case we do it. Also caching an image usually ends in a loss of details.\n       * A full performance audit should be done.\n       * @return {Boolean}\n       */\n      shouldCache: function () {\n        return this.needsItsOwnCache();\n      },\n\n      _renderFill: function (ctx) {\n        var elementToDraw = this._element;\n        if (!elementToDraw) {\n          return;\n        }\n        var w = this.width,\n          h = this.height,\n          sW = Math.min(\n            elementToDraw.naturalWidth || elementToDraw.width,\n            w * this._filterScalingX\n          ),\n          sH = Math.min(\n            elementToDraw.naturalHeight || elementToDraw.height,\n            h * this._filterScalingY\n          ),\n          x = -w / 2,\n          y = -h / 2,\n          sX = Math.max(0, this.cropX * this._filterScalingX),\n          sY = Math.max(0, this.cropY * this._filterScalingY);\n\n        elementToDraw &&\n          ctx.drawImage(elementToDraw, sX, sY, sW, sH, x, y, w, h);\n      },\n\n      /**\n       * needed to check if image needs resize\n       * @private\n       */\n      _needsResize: function () {\n        var scale = this.getTotalObjectScaling();\n        return (\n          scale.scaleX !== this._lastScaleX || scale.scaleY !== this._lastScaleY\n        );\n      },\n\n      /**\n       * @private\n       */\n      _resetWidthHeight: function () {\n        this.set(this.getOriginalSize());\n      },\n\n      /**\n       * The Image class's initialization method. This method is automatically\n       * called by the constructor.\n       * @private\n       * @param {HTMLImageElement|String} element The element representing the image\n       * @param {Object} [options] Options object\n       */\n      _initElement: function (element, options) {\n        this.setElement(fabric.util.getById(element), options);\n        fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);\n      },\n\n      /**\n       * @private\n       * @param {Object} [options] Options object\n       */\n      _initConfig: function (options) {\n        options || (options = {});\n        this.setOptions(options);\n        this._setWidthHeight(options);\n      },\n\n      /**\n       * @private\n       * @param {Array} filters to be initialized\n       * @param {Function} callback Callback to invoke when all fabric.Image.filters instances are created\n       */\n      _initFilters: function (filters, callback) {\n        if (filters && filters.length) {\n          fabric.util.enlivenObjects(\n            filters,\n            function (enlivenedObjects) {\n              callback && callback(enlivenedObjects);\n            },\n            \"fabric.Image.filters\"\n          );\n        } else {\n          callback && callback();\n        }\n      },\n\n      /**\n       * @private\n       * Set the width and the height of the image object, using the element or the\n       * options.\n       * @param {Object} [options] Object with width/height properties\n       */\n      _setWidthHeight: function (options) {\n        options || (options = {});\n        var el = this.getElement();\n        this.width = options.width || el.naturalWidth || el.width || 0;\n        this.height = options.height || el.naturalHeight || el.height || 0;\n      },\n\n      /**\n       * Calculate offset for center and scale factor for the image in order to respect\n       * the preserveAspectRatio attribute\n       * @private\n       * @return {Object}\n       */\n      parsePreserveAspectRatioAttribute: function () {\n        var pAR = fabric.util.parsePreserveAspectRatioAttribute(\n            this.preserveAspectRatio || \"\"\n          ),\n          rWidth = this._element.width,\n          rHeight = this._element.height,\n          scaleX = 1,\n          scaleY = 1,\n          offsetLeft = 0,\n          offsetTop = 0,\n          cropX = 0,\n          cropY = 0,\n          offset,\n          pWidth = this.width,\n          pHeight = this.height,\n          parsedAttributes = { width: pWidth, height: pHeight };\n        if (pAR && (pAR.alignX !== \"none\" || pAR.alignY !== \"none\")) {\n          if (pAR.meetOrSlice === \"meet\") {\n            scaleX = scaleY = fabric.util.findScaleToFit(\n              this._element,\n              parsedAttributes\n            );\n            offset = (pWidth - rWidth * scaleX) / 2;\n            if (pAR.alignX === \"Min\") {\n              offsetLeft = -offset;\n            }\n            if (pAR.alignX === \"Max\") {\n              offsetLeft = offset;\n            }\n            offset = (pHeight - rHeight * scaleY) / 2;\n            if (pAR.alignY === \"Min\") {\n              offsetTop = -offset;\n            }\n            if (pAR.alignY === \"Max\") {\n              offsetTop = offset;\n            }\n          }\n          if (pAR.meetOrSlice === \"slice\") {\n            scaleX = scaleY = fabric.util.findScaleToCover(\n              this._element,\n              parsedAttributes\n            );\n            offset = rWidth - pWidth / scaleX;\n            if (pAR.alignX === \"Mid\") {\n              cropX = offset / 2;\n            }\n            if (pAR.alignX === \"Max\") {\n              cropX = offset;\n            }\n            offset = rHeight - pHeight / scaleY;\n            if (pAR.alignY === \"Mid\") {\n              cropY = offset / 2;\n            }\n            if (pAR.alignY === \"Max\") {\n              cropY = offset;\n            }\n            rWidth = pWidth / scaleX;\n            rHeight = pHeight / scaleY;\n          }\n        } else {\n          scaleX = pWidth / rWidth;\n          scaleY = pHeight / rHeight;\n        }\n        return {\n          width: rWidth,\n          height: rHeight,\n          scaleX: scaleX,\n          scaleY: scaleY,\n          offsetLeft: offsetLeft,\n          offsetTop: offsetTop,\n          cropX: cropX,\n          cropY: cropY,\n        };\n      },\n    }\n  );\n\n  /**\n   * Default CSS class name for canvas\n   * @static\n   * @type String\n   * @default\n   */\n  fabric.Image.CSS_CANVAS = \"canvas-img\";\n\n  /**\n   * Alias for getSrc\n   * @static\n   */\n  fabric.Image.prototype.getSvgSrc = fabric.Image.prototype.getSrc;\n\n  /**\n   * Creates an instance of fabric.Image from its object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} callback Callback to invoke when an image instance is created\n   */\n  fabric.Image.fromObject = function (_object, callback) {\n    var object = fabric.util.object.clone(_object);\n    fabric.util.loadImage(\n      object.src,\n      function (img, isError) {\n        if (isError) {\n          callback && callback(null, true);\n          return;\n        }\n        fabric.Image.prototype._initFilters.call(\n          object,\n          object.filters,\n          function (filters) {\n            object.filters = filters || [];\n            fabric.Image.prototype._initFilters.call(\n              object,\n              [object.resizeFilter],\n              function (resizeFilters) {\n                object.resizeFilter = resizeFilters[0];\n                fabric.util.enlivenObjects(\n                  [object.clipPath],\n                  function (enlivedProps) {\n                    object.clipPath = enlivedProps[0];\n                    var image = new fabric.Image(img, object);\n                    callback(image, false);\n                  }\n                );\n              }\n            );\n          }\n        );\n      },\n      null,\n      object.crossOrigin\n    );\n  };\n\n  /**\n   * Creates an instance of fabric.Image from an URL string\n   * @static\n   * @param {String} url URL to create an image from\n   * @param {Function} [callback] Callback to invoke when image is created (newly created image is passed as a first argument). Second argument is a boolean indicating if an error occured or not.\n   * @param {Object} [imgOptions] Options object\n   */\n  fabric.Image.fromURL = function (url, callback, imgOptions) {\n    fabric.util.loadImage(\n      url,\n      function (img, isError) {\n        callback && callback(new fabric.Image(img, imgOptions), isError);\n      },\n      null,\n      imgOptions && imgOptions.crossOrigin\n    );\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Image.fromElement})\n   * @static\n   * @see {@link http://www.w3.org/TR/SVG/struct.html#ImageElement}\n   */\n  fabric.Image.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\n    \"x y width height preserveAspectRatio xlink:href crossOrigin image-rendering\".split(\n      \" \"\n    )\n  );\n\n  /**\n   * Returns {@link fabric.Image} instance from an SVG element\n   * @static\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} callback Callback to execute when fabric.Image object is created\n   * @return {fabric.Image} Instance of fabric.Image\n   */\n  fabric.Image.fromElement = function (element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(\n      element,\n      fabric.Image.ATTRIBUTE_NAMES\n    );\n    fabric.Image.fromURL(\n      parsedAttributes[\"xlink:href\"],\n      callback,\n      extend(options ? fabric.util.object.clone(options) : {}, parsedAttributes)\n    );\n  };\n  /* _FROM_SVG_END_ */\n})(typeof exports !== \"undefined\" ? exports : this);\n\nfabric.util.object.extend(\n  fabric.Object.prototype,\n  /** @lends fabric.Object.prototype */ {\n    /**\n     * @private\n     * @return {Number} angle value\n     */\n    _getAngleValueForStraighten: function () {\n      var angle = this.angle % 360;\n      if (angle > 0) {\n        return Math.round((angle - 1) / 90) * 90;\n      }\n      return Math.round(angle / 90) * 90;\n    },\n\n    /**\n     * Straightens an object (rotating it from current angle to one of 0, 90, 180, 270, etc. depending on which is closer)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    straighten: function () {\n      this.rotate(this._getAngleValueForStraighten());\n      return this;\n    },\n\n    /**\n     * Same as {@link fabric.Object.prototype.straighten} but with animation\n     * @param {Object} callbacks Object with callback functions\n     * @param {Function} [callbacks.onComplete] Invoked on completion\n     * @param {Function} [callbacks.onChange] Invoked on every step of animation\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    fxStraighten: function (callbacks) {\n      callbacks = callbacks || {};\n\n      var empty = function () {},\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n      fabric.util.animate({\n        startValue: this.get(\"angle\"),\n        endValue: this._getAngleValueForStraighten(),\n        duration: this.FX_DURATION,\n        onChange: function (value) {\n          _this.rotate(value);\n          onChange();\n        },\n        onComplete: function () {\n          _this.setCoords();\n          onComplete();\n        },\n      });\n\n      return this;\n    },\n  }\n);\n\nfabric.util.object.extend(\n  fabric.StaticCanvas.prototype,\n  /** @lends fabric.StaticCanvas.prototype */ {\n    /**\n     * Straightens object, then rerenders canvas\n     * @param {fabric.Object} object Object to straighten\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    straightenObject: function (object) {\n      object.straighten();\n      this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Same as {@link fabric.Canvas.prototype.straightenObject}, but animated\n     * @param {fabric.Object} object Object to straighten\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    fxStraightenObject: function (object) {\n      object.fxStraighten({\n        onChange: this.requestRenderAllBound,\n      });\n      return this;\n    },\n  }\n);\n\n(function () {\n  \"use strict\";\n\n  /**\n   * Tests if webgl supports certain precision\n   * @param {WebGL} Canvas WebGL context to test on\n   * @param {String} Precision to test can be any of following: 'lowp', 'mediump', 'highp'\n   * @returns {Boolean} Whether the user's browser WebGL supports given precision.\n   */\n  function testPrecision(gl, precision) {\n    var fragmentSource = \"precision \" + precision + \" float;\\nvoid main(){}\";\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentSource);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Indicate whether this filtering backend is supported by the user's browser.\n   * @param {Number} tileSize check if the tileSize is supported\n   * @returns {Boolean} Whether the user's browser supports WebGL.\n   */\n  fabric.isWebglSupported = function (tileSize) {\n    if (fabric.isLikelyNode) {\n      return false;\n    }\n    tileSize = tileSize || fabric.WebglFilterBackend.prototype.tileSize;\n    var canvas = document.createElement(\"canvas\");\n    var gl =\n      canvas.getContext(\"webgl\") || canvas.getContext(\"experimental-webgl\");\n    var isSupported = false;\n    // eslint-disable-next-line\n    if (gl) {\n      fabric.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);\n      isSupported = fabric.maxTextureSize >= tileSize;\n      var precisions = [\"highp\", \"mediump\", \"lowp\"];\n      for (var i = 0; i < 3; i++) {\n        if (testPrecision(gl, precisions[i])) {\n          fabric.webGlPrecision = precisions[i];\n          break;\n        }\n      }\n    }\n    this.isSupported = isSupported;\n    return isSupported;\n  };\n\n  fabric.WebglFilterBackend = WebglFilterBackend;\n\n  /**\n   * WebGL filter backend.\n   */\n  function WebglFilterBackend(options) {\n    if (options && options.tileSize) {\n      this.tileSize = options.tileSize;\n    }\n    this.setupGLContext(this.tileSize, this.tileSize);\n    this.captureGPUInfo();\n  }\n\n  WebglFilterBackend.prototype = /** @lends fabric.WebglFilterBackend.prototype */ {\n    tileSize: 2048,\n\n    /**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you problably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/\n    resources: {},\n\n    /**\n     * Setup a WebGL context suitable for filtering, and bind any needed event handlers.\n     */\n    setupGLContext: function (width, height) {\n      this.dispose();\n      this.createWebGLCanvas(width, height);\n      // eslint-disable-next-line\n      this.aPosition = new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]);\n      this.chooseFastestCopyGLTo2DMethod(width, height);\n    },\n\n    /**\n     * Pick a method to copy data from GL context to 2d canvas.  In some browsers using\n     * putImageData is faster than drawImage for that specific operation.\n     */\n    chooseFastestCopyGLTo2DMethod: function (width, height) {\n      var canMeasurePerf = typeof window.performance !== \"undefined\",\n        canUseImageData;\n      try {\n        new ImageData(1, 1);\n        canUseImageData = true;\n      } catch (e) {\n        canUseImageData = false;\n      }\n      // eslint-disable-next-line no-undef\n      var canUseArrayBuffer = typeof ArrayBuffer !== \"undefined\";\n      // eslint-disable-next-line no-undef\n      var canUseUint8Clamped = typeof Uint8ClampedArray !== \"undefined\";\n\n      if (\n        !(\n          canMeasurePerf &&\n          canUseImageData &&\n          canUseArrayBuffer &&\n          canUseUint8Clamped\n        )\n      ) {\n        return;\n      }\n\n      var targetCanvas = fabric.util.createCanvasElement();\n      // eslint-disable-next-line no-undef\n      var imageBuffer = new ArrayBuffer(width * height * 4);\n      if (fabric.forceGLPutImageData) {\n        this.imageBuffer = imageBuffer;\n        this.copyGLTo2D = copyGLTo2DPutImageData;\n        return;\n      }\n      var testContext = {\n        imageBuffer: imageBuffer,\n        destinationWidth: width,\n        destinationHeight: height,\n        targetCanvas: targetCanvas,\n      };\n      var startTime, drawImageTime, putImageDataTime;\n      targetCanvas.width = width;\n      targetCanvas.height = height;\n\n      startTime = window.performance.now();\n      copyGLTo2DDrawImage.call(testContext, this.gl, testContext);\n      drawImageTime = window.performance.now() - startTime;\n\n      startTime = window.performance.now();\n      copyGLTo2DPutImageData.call(testContext, this.gl, testContext);\n      putImageDataTime = window.performance.now() - startTime;\n\n      if (drawImageTime > putImageDataTime) {\n        this.imageBuffer = imageBuffer;\n        this.copyGLTo2D = copyGLTo2DPutImageData;\n      } else {\n        this.copyGLTo2D = copyGLTo2DDrawImage;\n      }\n    },\n\n    /**\n     * Create a canvas element and associated WebGL context and attaches them as\n     * class properties to the GLFilterBackend class.\n     */\n    createWebGLCanvas: function (width, height) {\n      var canvas = fabric.util.createCanvasElement();\n      canvas.width = width;\n      canvas.height = height;\n      var glOptions = {\n          alpha: true,\n          premultipliedAlpha: false,\n          depth: false,\n          stencil: false,\n          antialias: false,\n        },\n        gl = canvas.getContext(\"webgl\", glOptions);\n      if (!gl) {\n        gl = canvas.getContext(\"experimental-webgl\", glOptions);\n      }\n      if (!gl) {\n        return;\n      }\n      gl.clearColor(0, 0, 0, 0);\n      // this canvas can fire webglcontextlost and webglcontextrestored\n      this.canvas = canvas;\n      this.gl = gl;\n    },\n\n    /**\n     * Attempts to apply the requested filters to the source provided, drawing the filtered output\n     * to the provided target canvas.\n     *\n     * @param {Array} filters The filters to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} source The source to be filtered.\n     * @param {Number} width The width of the source input.\n     * @param {Number} height The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     * @param {String|undefined} cacheKey A key used to cache resources related to the source. If\n     * omitted, caching will be skipped.\n     */\n    applyFilters: function (\n      filters,\n      source,\n      width,\n      height,\n      targetCanvas,\n      cacheKey\n    ) {\n      var gl = this.gl;\n      var cachedTexture;\n      if (cacheKey) {\n        cachedTexture = this.getCachedTexture(cacheKey, source);\n      }\n      var pipelineState = {\n        originalWidth: source.width || source.originalWidth,\n        originalHeight: source.height || source.originalHeight,\n        sourceWidth: width,\n        sourceHeight: height,\n        destinationWidth: width,\n        destinationHeight: height,\n        context: gl,\n        sourceTexture: this.createTexture(\n          gl,\n          width,\n          height,\n          !cachedTexture && source\n        ),\n        targetTexture: this.createTexture(gl, width, height),\n        originalTexture:\n          cachedTexture ||\n          this.createTexture(gl, width, height, !cachedTexture && source),\n        passes: filters.length,\n        webgl: true,\n        aPosition: this.aPosition,\n        programCache: this.programCache,\n        pass: 0,\n        filterBackend: this,\n        targetCanvas: targetCanvas,\n      };\n      var tempFbo = gl.createFramebuffer();\n      gl.bindFramebuffer(gl.FRAMEBUFFER, tempFbo);\n      filters.forEach(function (filter) {\n        filter && filter.applyTo(pipelineState);\n      });\n      resizeCanvasIfNeeded(pipelineState);\n      this.copyGLTo2D(gl, pipelineState);\n      gl.bindTexture(gl.TEXTURE_2D, null);\n      gl.deleteTexture(pipelineState.sourceTexture);\n      gl.deleteTexture(pipelineState.targetTexture);\n      gl.deleteFramebuffer(tempFbo);\n      targetCanvas.getContext(\"2d\").setTransform(1, 0, 0, 1, 0, 0);\n      return pipelineState;\n    },\n\n    /**\n     * Detach event listeners, remove references, and clean up caches.\n     */\n    dispose: function () {\n      if (this.canvas) {\n        this.canvas = null;\n        this.gl = null;\n      }\n      this.clearWebGLCaches();\n    },\n\n    /**\n     * Wipe out WebGL-related caches.\n     */\n    clearWebGLCaches: function () {\n      this.programCache = {};\n      this.textureCache = {};\n    },\n\n    /**\n     * Create a WebGL texture object.\n     *\n     * Accepts specific dimensions to initialize the textuer to or a source image.\n     *\n     * @param {WebGLRenderingContext} gl The GL context to use for creating the texture.\n     * @param {Number} width The width to initialize the texture at.\n     * @param {Number} height The height to initialize the texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source for the texture data.\n     * @returns {WebGLTexture}\n     */\n    createTexture: function (gl, width, height, textureImageSource) {\n      var texture = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      if (textureImageSource) {\n        gl.texImage2D(\n          gl.TEXTURE_2D,\n          0,\n          gl.RGBA,\n          gl.RGBA,\n          gl.UNSIGNED_BYTE,\n          textureImageSource\n        );\n      } else {\n        gl.texImage2D(\n          gl.TEXTURE_2D,\n          0,\n          gl.RGBA,\n          width,\n          height,\n          0,\n          gl.RGBA,\n          gl.UNSIGNED_BYTE,\n          null\n        );\n      }\n      return texture;\n    },\n\n    /**\n     * Can be optionally used to get a texture from the cache array\n     *\n     * If an existing texture is not found, a new texture is created and cached.\n     *\n     * @param {String} uniqueId A cache key to use to find an existing texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source to use to create the\n     * texture cache entry if one does not already exist.\n     */\n    getCachedTexture: function (uniqueId, textureImageSource) {\n      if (this.textureCache[uniqueId]) {\n        return this.textureCache[uniqueId];\n      } else {\n        var texture = this.createTexture(\n          this.gl,\n          textureImageSource.width,\n          textureImageSource.height,\n          textureImageSource\n        );\n        this.textureCache[uniqueId] = texture;\n        return texture;\n      }\n    },\n\n    /**\n     * Clear out cached resources related to a source image that has been\n     * filtered previously.\n     *\n     * @param {String} cacheKey The cache key provided when the source image was filtered.\n     */\n    evictCachesForKey: function (cacheKey) {\n      if (this.textureCache[cacheKey]) {\n        this.gl.deleteTexture(this.textureCache[cacheKey]);\n        delete this.textureCache[cacheKey];\n      }\n    },\n\n    copyGLTo2D: copyGLTo2DDrawImage,\n\n    /**\n     * Attempt to extract GPU information strings from a WebGL context.\n     *\n     * Useful information when debugging or blacklisting specific GPUs.\n     *\n     * @returns {Object} A GPU info object with renderer and vendor strings.\n     */\n    captureGPUInfo: function () {\n      if (this.gpuInfo) {\n        return this.gpuInfo;\n      }\n      var gl = this.gl,\n        gpuInfo = { renderer: \"\", vendor: \"\" };\n      if (!gl) {\n        return gpuInfo;\n      }\n      var ext = gl.getExtension(\"WEBGL_debug_renderer_info\");\n      if (ext) {\n        var renderer = gl.getParameter(ext.UNMASKED_RENDERER_WEBGL);\n        var vendor = gl.getParameter(ext.UNMASKED_VENDOR_WEBGL);\n        if (renderer) {\n          gpuInfo.renderer = renderer.toLowerCase();\n        }\n        if (vendor) {\n          gpuInfo.vendor = vendor.toLowerCase();\n        }\n      }\n      this.gpuInfo = gpuInfo;\n      return gpuInfo;\n    },\n  };\n})();\n\nfunction resizeCanvasIfNeeded(pipelineState) {\n  var targetCanvas = pipelineState.targetCanvas,\n    width = targetCanvas.width,\n    height = targetCanvas.height,\n    dWidth = pipelineState.destinationWidth,\n    dHeight = pipelineState.destinationHeight;\n\n  if (width !== dWidth || height !== dHeight) {\n    targetCanvas.width = dWidth;\n    targetCanvas.height = dHeight;\n  }\n}\n\n/**\n * Copy an input WebGL canvas on to an output 2D canvas.\n *\n * The WebGL canvas is assumed to be upside down, with the top-left pixel of the\n * desired output image appearing in the bottom-left corner of the WebGL canvas.\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */\nfunction copyGLTo2DDrawImage(gl, pipelineState) {\n  var glCanvas = gl.canvas,\n    targetCanvas = pipelineState.targetCanvas,\n    ctx = targetCanvas.getContext(\"2d\");\n  ctx.translate(0, targetCanvas.height); // move it down again\n  ctx.scale(1, -1); // vertical flip\n  // where is my image on the big glcanvas?\n  var sourceY = glCanvas.height - targetCanvas.height;\n  ctx.drawImage(\n    glCanvas,\n    0,\n    sourceY,\n    targetCanvas.width,\n    targetCanvas.height,\n    0,\n    0,\n    targetCanvas.width,\n    targetCanvas.height\n  );\n}\n\n/**\n * Copy an input WebGL canvas on to an output 2D canvas using 2d canvas' putImageData\n * API. Measurably faster than using ctx.drawImage in Firefox (version 54 on OSX Sierra).\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */\nfunction copyGLTo2DPutImageData(gl, pipelineState) {\n  var targetCanvas = pipelineState.targetCanvas,\n    ctx = targetCanvas.getContext(\"2d\"),\n    dWidth = pipelineState.destinationWidth,\n    dHeight = pipelineState.destinationHeight,\n    numBytes = dWidth * dHeight * 4;\n\n  // eslint-disable-next-line no-undef\n  var u8 = new Uint8Array(this.imageBuffer, 0, numBytes);\n  // eslint-disable-next-line no-undef\n  var u8Clamped = new Uint8ClampedArray(this.imageBuffer, 0, numBytes);\n\n  gl.readPixels(0, 0, dWidth, dHeight, gl.RGBA, gl.UNSIGNED_BYTE, u8);\n  var imgData = new ImageData(u8Clamped, dWidth, dHeight);\n  ctx.putImageData(imgData, 0, 0);\n}\n\n(function () {\n  \"use strict\";\n\n  var noop = function () {};\n\n  fabric.Canvas2dFilterBackend = Canvas2dFilterBackend;\n\n  /**\n   * Canvas 2D filter backend.\n   */\n  function Canvas2dFilterBackend() {}\n\n  Canvas2dFilterBackend.prototype = /** @lends fabric.Canvas2dFilterBackend.prototype */ {\n    evictCachesForKey: noop,\n    dispose: noop,\n    clearWebGLCaches: noop,\n\n    /**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you probably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/\n    resources: {},\n\n    /**\n     * Apply a set of filters against a source image and draw the filtered output\n     * to the provided destination canvas.\n     *\n     * @param {EnhancedFilter} filters The filter to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} sourceElement The source to be filtered.\n     * @param {Number} sourceWidth The width of the source input.\n     * @param {Number} sourceHeight The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     */\n    applyFilters: function (\n      filters,\n      sourceElement,\n      sourceWidth,\n      sourceHeight,\n      targetCanvas\n    ) {\n      var ctx = targetCanvas.getContext(\"2d\");\n      ctx.drawImage(sourceElement, 0, 0, sourceWidth, sourceHeight);\n      var imageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      var originalImageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      var pipelineState = {\n        sourceWidth: sourceWidth,\n        sourceHeight: sourceHeight,\n        imageData: imageData,\n        originalEl: sourceElement,\n        originalImageData: originalImageData,\n        canvasEl: targetCanvas,\n        ctx: ctx,\n        filterBackend: this,\n      };\n      filters.forEach(function (filter) {\n        filter.applyTo(pipelineState);\n      });\n      if (\n        pipelineState.imageData.width !== sourceWidth ||\n        pipelineState.imageData.height !== sourceHeight\n      ) {\n        targetCanvas.width = pipelineState.imageData.width;\n        targetCanvas.height = pipelineState.imageData.height;\n      }\n      ctx.putImageData(pipelineState.imageData, 0, 0);\n      return pipelineState;\n    },\n  };\n})();\n\n/**\n * @namespace fabric.Image.filters\n * @memberOf fabric.Image\n * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#image_filters}\n * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n */\nfabric.Image = fabric.Image || {};\nfabric.Image.filters = fabric.Image.filters || {};\n\n/**\n * Root filter class from which all filter classes inherit from\n * @class fabric.Image.filters.BaseFilter\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.BaseFilter = fabric.util.createClass(\n  /** @lends fabric.Image.filters.BaseFilter.prototype */ {\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: \"BaseFilter\",\n\n    /**\n     * Array of attributes to send with buffers. do not modify\n     * @private\n     */\n\n    vertexSource:\n      \"attribute vec2 aPosition;\\n\" +\n      \"varying vec2 vTexCoord;\\n\" +\n      \"void main() {\\n\" +\n      \"vTexCoord = aPosition;\\n\" +\n      \"gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n\" +\n      \"}\",\n\n    fragmentSource:\n      \"precision highp float;\\n\" +\n      \"varying vec2 vTexCoord;\\n\" +\n      \"uniform sampler2D uTexture;\\n\" +\n      \"void main() {\\n\" +\n      \"gl_FragColor = texture2D(uTexture, vTexCoord);\\n\" +\n      \"}\",\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function (options) {\n      if (options) {\n        this.setOptions(options);\n      }\n    },\n\n    /**\n     * Sets filter's properties from options\n     * @param {Object} [options] Options object\n     */\n    setOptions: function (options) {\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n    },\n\n    /**\n     * Compile this filter's shader program.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context to use for shader compilation.\n     * @param {String} fragmentSource fragmentShader source for compilation\n     * @param {String} vertexSource vertexShader source for compilation\n     */\n    createProgram: function (gl, fragmentSource, vertexSource) {\n      fragmentSource = fragmentSource || this.fragmentSource;\n      vertexSource = vertexSource || this.vertexSource;\n      if (fabric.webGlPrecision !== \"highp\") {\n        fragmentSource = fragmentSource.replace(\n          /precision highp float/g,\n          \"precision \" + fabric.webGlPrecision + \" float\"\n        );\n      }\n      var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n      gl.shaderSource(vertexShader, vertexSource);\n      gl.compileShader(vertexShader);\n      if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n        throw new Error(\n          // eslint-disable-next-line prefer-template\n          \"Vertex shader compile error for \" +\n            this.type +\n            \": \" +\n            gl.getShaderInfoLog(vertexShader)\n        );\n      }\n\n      var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n      gl.shaderSource(fragmentShader, fragmentSource);\n      gl.compileShader(fragmentShader);\n      if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n        throw new Error(\n          // eslint-disable-next-line prefer-template\n          \"Fragment shader compile error for \" +\n            this.type +\n            \": \" +\n            gl.getShaderInfoLog(fragmentShader)\n        );\n      }\n\n      var program = gl.createProgram();\n      gl.attachShader(program, vertexShader);\n      gl.attachShader(program, fragmentShader);\n      gl.linkProgram(program);\n      if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n        throw new Error(\n          // eslint-disable-next-line prefer-template\n          'Shader link error for \"${this.type}\" ' +\n            gl.getProgramInfoLog(program)\n        );\n      }\n\n      var attributeLocations = this.getAttributeLocations(gl, program);\n      var uniformLocations = this.getUniformLocations(gl, program) || {};\n      uniformLocations.uStepW = gl.getUniformLocation(program, \"uStepW\");\n      uniformLocations.uStepH = gl.getUniformLocation(program, \"uStepH\");\n      return {\n        program: program,\n        attributeLocations: attributeLocations,\n        uniformLocations: uniformLocations,\n      };\n    },\n\n    /**\n     * Return a map of attribute names to WebGLAttributeLocation objects.\n     *\n     * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n     * @param {WebGLShaderProgram} program The shader program from which to take attribute locations.\n     * @returns {Object} A map of attribute names to attribute locations.\n     */\n    getAttributeLocations: function (gl, program) {\n      return {\n        aPosition: gl.getAttribLocation(program, \"aPosition\"),\n      };\n    },\n\n    /**\n     * Return a map of uniform names to WebGLUniformLocation objects.\n     *\n     * Intended to be overridden by subclasses.\n     *\n     * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n     * @param {WebGLShaderProgram} program The shader program from which to take uniform locations.\n     * @returns {Object} A map of uniform names to uniform locations.\n     */\n    getUniformLocations: function (/* gl, program */) {\n      // in case i do not need any special uniform i need to return an empty object\n      return {};\n    },\n\n    /**\n     * Send attribute data from this filter to its shader program on the GPU.\n     *\n     * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n     * @param {Object} attributeLocations A map of shader attribute names to their locations.\n     */\n    sendAttributeData: function (gl, attributeLocations, aPositionData) {\n      var attributeLocation = attributeLocations.aPosition;\n      var buffer = gl.createBuffer();\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n      gl.enableVertexAttribArray(attributeLocation);\n      gl.vertexAttribPointer(attributeLocation, 2, gl.FLOAT, false, 0, 0);\n      gl.bufferData(gl.ARRAY_BUFFER, aPositionData, gl.STATIC_DRAW);\n    },\n\n    _setupFrameBuffer: function (options) {\n      var gl = options.context,\n        width,\n        height;\n      if (options.passes > 1) {\n        width = options.destinationWidth;\n        height = options.destinationHeight;\n        if (options.sourceWidth !== width || options.sourceHeight !== height) {\n          gl.deleteTexture(options.targetTexture);\n          options.targetTexture = options.filterBackend.createTexture(\n            gl,\n            width,\n            height\n          );\n        }\n        gl.framebufferTexture2D(\n          gl.FRAMEBUFFER,\n          gl.COLOR_ATTACHMENT0,\n          gl.TEXTURE_2D,\n          options.targetTexture,\n          0\n        );\n      } else {\n        // draw last filter on canvas and not to framebuffer.\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.finish();\n      }\n    },\n\n    _swapTextures: function (options) {\n      options.passes--;\n      options.pass++;\n      var temp = options.targetTexture;\n      options.targetTexture = options.sourceTexture;\n      options.sourceTexture = temp;\n    },\n\n    /**\n     * Generic isNeutral implementation for one parameter based filters.\n     * Used only in image applyFilters to discard filters that will not have an effect\n     * on the image\n     * Other filters may need their own verison ( ColorMatrix, HueRotation, gamma, ComposedFilter )\n     * @param {Object} options\n     **/\n    isNeutralState: function (/* options */) {\n      var main = this.mainParameter,\n        _class = fabric.Image.filters[this.type].prototype;\n      if (main) {\n        if (Array.isArray(_class[main])) {\n          for (var i = _class[main].length; i--; ) {\n            if (this[main][i] !== _class[main][i]) {\n              return false;\n            }\n          }\n          return true;\n        } else {\n          return _class[main] === this[main];\n        }\n      } else {\n        return false;\n      }\n    },\n\n    /**\n     * Apply this filter to the input image data provided.\n     *\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    applyTo: function (options) {\n      if (options.webgl) {\n        this._setupFrameBuffer(options);\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n      } else {\n        this.applyTo2d(options);\n      }\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function (options) {\n      if (!options.programCache.hasOwnProperty(this.type)) {\n        options.programCache[this.type] = this.createProgram(options.context);\n      }\n      return options.programCache[this.type];\n    },\n\n    /**\n     * Apply this filter using webgl.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.originalTexture The texture of the original input image.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    applyToWebGL: function (options) {\n      var gl = options.context;\n      var shader = this.retrieveShader(options);\n      if (options.pass === 0 && options.originalTexture) {\n        gl.bindTexture(gl.TEXTURE_2D, options.originalTexture);\n      } else {\n        gl.bindTexture(gl.TEXTURE_2D, options.sourceTexture);\n      }\n      gl.useProgram(shader.program);\n      this.sendAttributeData(gl, shader.attributeLocations, options.aPosition);\n\n      gl.uniform1f(shader.uniformLocations.uStepW, 1 / options.sourceWidth);\n      gl.uniform1f(shader.uniformLocations.uStepH, 1 / options.sourceHeight);\n\n      this.sendUniformData(gl, shader.uniformLocations);\n      gl.viewport(0, 0, options.destinationWidth, options.destinationHeight);\n      gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n    },\n\n    bindAdditionalTexture: function (gl, texture, textureUnit) {\n      gl.activeTexture(textureUnit);\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      // reset active texture to 0 as usual\n      gl.activeTexture(gl.TEXTURE0);\n    },\n\n    unbindAdditionalTexture: function (gl, textureUnit) {\n      gl.activeTexture(textureUnit);\n      gl.bindTexture(gl.TEXTURE_2D, null);\n      gl.activeTexture(gl.TEXTURE0);\n    },\n\n    getMainParameter: function () {\n      return this[this.mainParameter];\n    },\n\n    setMainParameter: function (value) {\n      this[this.mainParameter] = value;\n    },\n\n    /**\n     * Send uniform data from this filter to its shader program on the GPU.\n     *\n     * Intended to be overridden by subclasses.\n     *\n     * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n     * @param {Object} uniformLocations A map of shader uniform names to their locations.\n     */\n    sendUniformData: function (/* gl, uniformLocations */) {\n      // Intentionally left blank.  Override me in subclasses.\n    },\n\n    /**\n     * If needed by a 2d filter, this functions can create an helper canvas to be used\n     * remember that options.targetCanvas is available for use till end of chain.\n     */\n    createHelpLayer: function (options) {\n      if (!options.helpLayer) {\n        var helpLayer = document.createElement(\"canvas\");\n        helpLayer.width = options.sourceWidth;\n        helpLayer.height = options.sourceHeight;\n        options.helpLayer = helpLayer;\n      }\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function () {\n      var object = { type: this.type },\n        mainP = this.mainParameter;\n      if (mainP) {\n        object[mainP] = this[mainP];\n      }\n      return object;\n    },\n\n    /**\n     * Returns a JSON representation of an instance\n     * @return {Object} JSON\n     */\n    toJSON: function () {\n      // delegate, not alias\n      return this.toObject();\n    },\n  }\n);\n\nfabric.Image.filters.BaseFilter.fromObject = function (object, callback) {\n  var filter = new fabric.Image.filters[object.type](object);\n  callback && callback(filter);\n  return filter;\n};\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n     * Color Matrix filter class\n     * @class fabric.Image.filters.ColorMatrix\n     * @memberOf fabric.Image.filters\n     * @extends fabric.Image.filters.BaseFilter\n     * @see {@link fabric.Image.filters.ColorMatrix#initialize} for constructor definition\n     * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n     * @see {@Link http://www.webwasp.co.uk/tutorials/219/Color_Matrix_Filter.php}\n     * @see {@Link http://phoboslab.org/log/2013/11/fast-image-filters-with-webgl}\n     * @example <caption>Kodachrome filter</caption>\n     * var filter = new fabric.Image.filters.ColorMatrix({\n     *  matrix: [\n         1.1285582396593525, -0.3967382283601348, -0.03992559172921793, 0, 63.72958762196502,\n         -0.16404339962244616, 1.0835251566291304, -0.05498805115633132, 0, 24.732407896706203,\n         -0.16786010706155763, -0.5603416277695248, 1.6014850761964943, 0, 35.62982807460946,\n         0, 0, 0, 1, 0\n        ]\n     * });\n     * object.filters.push(filter);\n     * object.applyFilters();\n     */\n  filters.ColorMatrix = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.ColorMatrix.prototype */ {\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: \"ColorMatrix\",\n\n      fragmentSource:\n        \"precision highp float;\\n\" +\n        \"uniform sampler2D uTexture;\\n\" +\n        \"varying vec2 vTexCoord;\\n\" +\n        \"uniform mat4 uColorMatrix;\\n\" +\n        \"uniform vec4 uConstants;\\n\" +\n        \"void main() {\\n\" +\n        \"vec4 color = texture2D(uTexture, vTexCoord);\\n\" +\n        \"color *= uColorMatrix;\\n\" +\n        \"color += uConstants;\\n\" +\n        \"gl_FragColor = color;\\n\" +\n        \"}\",\n\n      /**\n       * Colormatrix for pixels.\n       * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n       * outside the -1, 1 range.\n       * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n       * @param {Array} matrix array of 20 numbers.\n       * @default\n       */\n      matrix: [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0],\n\n      mainParameter: \"matrix\",\n\n      /**\n       * Lock the colormatrix on the color part, skipping alpha, manly for non webgl scenario\n       * to save some calculation\n       */\n      colorsOnly: true,\n\n      /**\n       * Constructor\n       * @param {Object} [options] Options object\n       */\n      initialize: function (options) {\n        this.callSuper(\"initialize\", options);\n        // create a new array instead mutating the prototype with push\n        this.matrix = this.matrix.slice(0);\n      },\n\n      /**\n       * Apply the ColorMatrix operation to a Uint8Array representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8Array to be filtered.\n       */\n      applyTo2d: function (options) {\n        var imageData = options.imageData,\n          data = imageData.data,\n          iLen = data.length,\n          m = this.matrix,\n          r,\n          g,\n          b,\n          a,\n          i,\n          colorsOnly = this.colorsOnly;\n\n        for (i = 0; i < iLen; i += 4) {\n          r = data[i];\n          g = data[i + 1];\n          b = data[i + 2];\n          if (colorsOnly) {\n            data[i] = r * m[0] + g * m[1] + b * m[2] + m[4] * 255;\n            data[i + 1] = r * m[5] + g * m[6] + b * m[7] + m[9] * 255;\n            data[i + 2] = r * m[10] + g * m[11] + b * m[12] + m[14] * 255;\n          } else {\n            a = data[i + 3];\n            data[i] = r * m[0] + g * m[1] + b * m[2] + a * m[3] + m[4] * 255;\n            data[i + 1] =\n              r * m[5] + g * m[6] + b * m[7] + a * m[8] + m[9] * 255;\n            data[i + 2] =\n              r * m[10] + g * m[11] + b * m[12] + a * m[13] + m[14] * 255;\n            data[i + 3] =\n              r * m[15] + g * m[16] + b * m[17] + a * m[18] + m[19] * 255;\n          }\n        }\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uColorMatrix: gl.getUniformLocation(program, \"uColorMatrix\"),\n          uConstants: gl.getUniformLocation(program, \"uConstants\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        var m = this.matrix,\n          matrix = [\n            m[0],\n            m[1],\n            m[2],\n            m[3],\n            m[5],\n            m[6],\n            m[7],\n            m[8],\n            m[10],\n            m[11],\n            m[12],\n            m[13],\n            m[15],\n            m[16],\n            m[17],\n            m[18],\n          ],\n          constants = [m[4], m[9], m[14], m[19]];\n        gl.uniformMatrix4fv(uniformLocations.uColorMatrix, false, matrix);\n        gl.uniform4fv(uniformLocations.uConstants, constants);\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] function to invoke after filter creation\n   * @return {fabric.Image.filters.ColorMatrix} Instance of fabric.Image.filters.ColorMatrix\n   */\n  fabric.Image.filters.ColorMatrix.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Brightness filter class\n   * @class fabric.Image.filters.Brightness\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Brightness#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Brightness({\n   *   brightness: 0.05\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Brightness = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.Brightness.prototype */ {\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: \"Brightness\",\n\n      /**\n       * Fragment source for the brightness program\n       */\n      fragmentSource:\n        \"precision highp float;\\n\" +\n        \"uniform sampler2D uTexture;\\n\" +\n        \"uniform float uBrightness;\\n\" +\n        \"varying vec2 vTexCoord;\\n\" +\n        \"void main() {\\n\" +\n        \"vec4 color = texture2D(uTexture, vTexCoord);\\n\" +\n        \"color.rgb += uBrightness;\\n\" +\n        \"gl_FragColor = color;\\n\" +\n        \"}\",\n\n      /**\n       * Brightness value, from -1 to 1.\n       * translated to -255 to 255 for 2d\n       * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n       * @param {Number} brightness\n       * @default\n       */\n      brightness: 0,\n\n      /**\n       * Describe the property that is the filter parameter\n       * @param {String} m\n       * @default\n       */\n      mainParameter: \"brightness\",\n\n      /**\n       * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */\n      applyTo2d: function (options) {\n        if (this.brightness === 0) {\n          return;\n        }\n        var imageData = options.imageData,\n          data = imageData.data,\n          i,\n          len = data.length,\n          brightness = Math.round(this.brightness * 255);\n        for (i = 0; i < len; i += 4) {\n          data[i] = data[i] + brightness;\n          data[i + 1] = data[i + 1] + brightness;\n          data[i + 2] = data[i + 2] + brightness;\n        }\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uBrightness: gl.getUniformLocation(program, \"uBrightness\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        gl.uniform1f(uniformLocations.uBrightness, this.brightness);\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Brightness} Instance of fabric.Image.filters.Brightness\n   */\n  fabric.Image.filters.Brightness.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    extend = fabric.util.object.extend,\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Adapted from <a href=\"http://www.html5rocks.com/en/tutorials/canvas/imagefilters/\">html5rocks article</a>\n   * @class fabric.Image.filters.Convolute\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Convolute#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example <caption>Sharpen filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 0, -1,  0,\n   *            -1,  5, -1,\n   *             0, -1,  0 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Blur filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter with opaqueness</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   opaque: true,\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Convolute = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.Convolute.prototype */ {\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: \"Convolute\",\n\n      /*\n       * Opaque value (true/false)\n       */\n      opaque: false,\n\n      /*\n       * matrix for the filter, max 9x9\n       */\n      matrix: [0, 0, 0, 0, 1, 0, 0, 0, 0],\n\n      /**\n       * Fragment source for the brightness program\n       */\n      fragmentSource: {\n        Convolute_3_1:\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"uniform float uMatrix[9];\\n\" +\n          \"uniform float uStepW;\\n\" +\n          \"uniform float uStepH;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 color = vec4(0, 0, 0, 0);\\n\" +\n          \"for (float h = 0.0; h < 3.0; h+=1.0) {\\n\" +\n          \"for (float w = 0.0; w < 3.0; w+=1.0) {\\n\" +\n          \"vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\\n\" +\n          \"color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\\n\" +\n          \"}\\n\" +\n          \"}\\n\" +\n          \"gl_FragColor = color;\\n\" +\n          \"}\",\n        Convolute_3_0:\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"uniform float uMatrix[9];\\n\" +\n          \"uniform float uStepW;\\n\" +\n          \"uniform float uStepH;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 color = vec4(0, 0, 0, 1);\\n\" +\n          \"for (float h = 0.0; h < 3.0; h+=1.0) {\\n\" +\n          \"for (float w = 0.0; w < 3.0; w+=1.0) {\\n\" +\n          \"vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\\n\" +\n          \"color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\\n\" +\n          \"}\\n\" +\n          \"}\\n\" +\n          \"float alpha = texture2D(uTexture, vTexCoord).a;\\n\" +\n          \"gl_FragColor = color;\\n\" +\n          \"gl_FragColor.a = alpha;\\n\" +\n          \"}\",\n        Convolute_5_1:\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"uniform float uMatrix[25];\\n\" +\n          \"uniform float uStepW;\\n\" +\n          \"uniform float uStepH;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 color = vec4(0, 0, 0, 0);\\n\" +\n          \"for (float h = 0.0; h < 5.0; h+=1.0) {\\n\" +\n          \"for (float w = 0.0; w < 5.0; w+=1.0) {\\n\" +\n          \"vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n\" +\n          \"color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\\n\" +\n          \"}\\n\" +\n          \"}\\n\" +\n          \"gl_FragColor = color;\\n\" +\n          \"}\",\n        Convolute_5_0:\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"uniform float uMatrix[25];\\n\" +\n          \"uniform float uStepW;\\n\" +\n          \"uniform float uStepH;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 color = vec4(0, 0, 0, 1);\\n\" +\n          \"for (float h = 0.0; h < 5.0; h+=1.0) {\\n\" +\n          \"for (float w = 0.0; w < 5.0; w+=1.0) {\\n\" +\n          \"vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n\" +\n          \"color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\\n\" +\n          \"}\\n\" +\n          \"}\\n\" +\n          \"float alpha = texture2D(uTexture, vTexCoord).a;\\n\" +\n          \"gl_FragColor = color;\\n\" +\n          \"gl_FragColor.a = alpha;\\n\" +\n          \"}\",\n        Convolute_7_1:\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"uniform float uMatrix[49];\\n\" +\n          \"uniform float uStepW;\\n\" +\n          \"uniform float uStepH;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 color = vec4(0, 0, 0, 0);\\n\" +\n          \"for (float h = 0.0; h < 7.0; h+=1.0) {\\n\" +\n          \"for (float w = 0.0; w < 7.0; w+=1.0) {\\n\" +\n          \"vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n\" +\n          \"color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\\n\" +\n          \"}\\n\" +\n          \"}\\n\" +\n          \"gl_FragColor = color;\\n\" +\n          \"}\",\n        Convolute_7_0:\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"uniform float uMatrix[49];\\n\" +\n          \"uniform float uStepW;\\n\" +\n          \"uniform float uStepH;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 color = vec4(0, 0, 0, 1);\\n\" +\n          \"for (float h = 0.0; h < 7.0; h+=1.0) {\\n\" +\n          \"for (float w = 0.0; w < 7.0; w+=1.0) {\\n\" +\n          \"vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n\" +\n          \"color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\\n\" +\n          \"}\\n\" +\n          \"}\\n\" +\n          \"float alpha = texture2D(uTexture, vTexCoord).a;\\n\" +\n          \"gl_FragColor = color;\\n\" +\n          \"gl_FragColor.a = alpha;\\n\" +\n          \"}\",\n        Convolute_9_1:\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"uniform float uMatrix[81];\\n\" +\n          \"uniform float uStepW;\\n\" +\n          \"uniform float uStepH;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 color = vec4(0, 0, 0, 0);\\n\" +\n          \"for (float h = 0.0; h < 9.0; h+=1.0) {\\n\" +\n          \"for (float w = 0.0; w < 9.0; w+=1.0) {\\n\" +\n          \"vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n\" +\n          \"color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\\n\" +\n          \"}\\n\" +\n          \"}\\n\" +\n          \"gl_FragColor = color;\\n\" +\n          \"}\",\n        Convolute_9_0:\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"uniform float uMatrix[81];\\n\" +\n          \"uniform float uStepW;\\n\" +\n          \"uniform float uStepH;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 color = vec4(0, 0, 0, 1);\\n\" +\n          \"for (float h = 0.0; h < 9.0; h+=1.0) {\\n\" +\n          \"for (float w = 0.0; w < 9.0; w+=1.0) {\\n\" +\n          \"vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n\" +\n          \"color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\\n\" +\n          \"}\\n\" +\n          \"}\\n\" +\n          \"float alpha = texture2D(uTexture, vTexCoord).a;\\n\" +\n          \"gl_FragColor = color;\\n\" +\n          \"gl_FragColor.a = alpha;\\n\" +\n          \"}\",\n      },\n\n      /**\n       * Constructor\n       * @memberOf fabric.Image.filters.Convolute.prototype\n       * @param {Object} [options] Options object\n       * @param {Boolean} [options.opaque=false] Opaque value (true/false)\n       * @param {Array} [options.matrix] Filter matrix\n       */\n\n      /**\n       * Retrieves the cached shader.\n       * @param {Object} options\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */\n      retrieveShader: function (options) {\n        var size = Math.sqrt(this.matrix.length);\n        var cacheKey = this.type + \"_\" + size + \"_\" + (this.opaque ? 1 : 0);\n        var shaderSource = this.fragmentSource[cacheKey];\n        if (!options.programCache.hasOwnProperty(cacheKey)) {\n          options.programCache[cacheKey] = this.createProgram(\n            options.context,\n            shaderSource\n          );\n        }\n        return options.programCache[cacheKey];\n      },\n\n      /**\n       * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */\n      applyTo2d: function (options) {\n        var imageData = options.imageData,\n          data = imageData.data,\n          weights = this.matrix,\n          side = Math.round(Math.sqrt(weights.length)),\n          halfSide = Math.floor(side / 2),\n          sw = imageData.width,\n          sh = imageData.height,\n          output = options.ctx.createImageData(sw, sh),\n          dst = output.data,\n          // go through the destination image pixels\n          alphaFac = this.opaque ? 1 : 0,\n          r,\n          g,\n          b,\n          a,\n          dstOff,\n          scx,\n          scy,\n          srcOff,\n          wt,\n          x,\n          y,\n          cx,\n          cy;\n\n        for (y = 0; y < sh; y++) {\n          for (x = 0; x < sw; x++) {\n            dstOff = (y * sw + x) * 4;\n            // calculate the weighed sum of the source image pixels that\n            // fall under the convolution matrix\n            r = 0;\n            g = 0;\n            b = 0;\n            a = 0;\n\n            for (cy = 0; cy < side; cy++) {\n              for (cx = 0; cx < side; cx++) {\n                scy = y + cy - halfSide;\n                scx = x + cx - halfSide;\n\n                // eslint-disable-next-line max-depth\n                if (scy < 0 || scy >= sh || scx < 0 || scx >= sw) {\n                  continue;\n                }\n\n                srcOff = (scy * sw + scx) * 4;\n                wt = weights[cy * side + cx];\n\n                r += data[srcOff] * wt;\n                g += data[srcOff + 1] * wt;\n                b += data[srcOff + 2] * wt;\n                // eslint-disable-next-line max-depth\n                if (!alphaFac) {\n                  a += data[srcOff + 3] * wt;\n                }\n              }\n            }\n            dst[dstOff] = r;\n            dst[dstOff + 1] = g;\n            dst[dstOff + 2] = b;\n            if (!alphaFac) {\n              dst[dstOff + 3] = a;\n            } else {\n              dst[dstOff + 3] = data[dstOff + 3];\n            }\n          }\n        }\n        options.imageData = output;\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uMatrix: gl.getUniformLocation(program, \"uMatrix\"),\n          uOpaque: gl.getUniformLocation(program, \"uOpaque\"),\n          uHalfSize: gl.getUniformLocation(program, \"uHalfSize\"),\n          uSize: gl.getUniformLocation(program, \"uSize\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        gl.uniform1fv(uniformLocations.uMatrix, this.matrix);\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @return {Object} Object representation of an instance\n       */\n      toObject: function () {\n        return extend(this.callSuper(\"toObject\"), {\n          opaque: this.opaque,\n          matrix: this.matrix,\n        });\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Convolute} Instance of fabric.Image.filters.Convolute\n   */\n  fabric.Image.filters.Convolute.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Grayscale image filter class\n   * @class fabric.Image.filters.Grayscale\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Grayscale();\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Grayscale = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.Grayscale.prototype */ {\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: \"Grayscale\",\n\n      fragmentSource: {\n        average:\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 color = texture2D(uTexture, vTexCoord);\\n\" +\n          \"float average = (color.r + color.b + color.g) / 3.0;\\n\" +\n          \"gl_FragColor = vec4(average, average, average, color.a);\\n\" +\n          \"}\",\n        lightness:\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"uniform int uMode;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 col = texture2D(uTexture, vTexCoord);\\n\" +\n          \"float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\\n\" +\n          \"gl_FragColor = vec4(average, average, average, col.a);\\n\" +\n          \"}\",\n        luminosity:\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"uniform int uMode;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 col = texture2D(uTexture, vTexCoord);\\n\" +\n          \"float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\\n\" +\n          \"gl_FragColor = vec4(average, average, average, col.a);\\n\" +\n          \"}\",\n      },\n\n      /**\n       * Grayscale mode, between 'average', 'lightness', 'luminosity'\n       * @param {String} type\n       * @default\n       */\n      mode: \"average\",\n\n      mainParameter: \"mode\",\n\n      /**\n       * Apply the Grayscale operation to a Uint8Array representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8Array to be filtered.\n       */\n      applyTo2d: function (options) {\n        var imageData = options.imageData,\n          data = imageData.data,\n          i,\n          len = data.length,\n          value,\n          mode = this.mode;\n        for (i = 0; i < len; i += 4) {\n          if (mode === \"average\") {\n            value = (data[i] + data[i + 1] + data[i + 2]) / 3;\n          } else if (mode === \"lightness\") {\n            value =\n              (Math.min(data[i], data[i + 1], data[i + 2]) +\n                Math.max(data[i], data[i + 1], data[i + 2])) /\n              2;\n          } else if (mode === \"luminosity\") {\n            value = 0.21 * data[i] + 0.72 * data[i + 1] + 0.07 * data[i + 2];\n          }\n          data[i] = value;\n          data[i + 1] = value;\n          data[i + 2] = value;\n        }\n      },\n\n      /**\n       * Retrieves the cached shader.\n       * @param {Object} options\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */\n      retrieveShader: function (options) {\n        var cacheKey = this.type + \"_\" + this.mode;\n        if (!options.programCache.hasOwnProperty(cacheKey)) {\n          var shaderSource = this.fragmentSource[this.mode];\n          options.programCache[cacheKey] = this.createProgram(\n            options.context,\n            shaderSource\n          );\n        }\n        return options.programCache[cacheKey];\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uMode: gl.getUniformLocation(program, \"uMode\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        // default average mode.\n        var mode = 1;\n        gl.uniform1i(uniformLocations.uMode, mode);\n      },\n\n      /**\n       * Grayscale filter isNeutralState implementation\n       * The filter is never neutral\n       * on the image\n       **/\n      isNeutralState: function () {\n        return false;\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Grayscale} Instance of fabric.Image.filters.Grayscale\n   */\n  fabric.Image.filters.Grayscale.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Invert filter class\n   * @class fabric.Image.filters.Invert\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Invert();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Invert = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.Invert.prototype */ {\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: \"Invert\",\n\n      fragmentSource:\n        \"precision highp float;\\n\" +\n        \"uniform sampler2D uTexture;\\n\" +\n        \"uniform int uInvert;\\n\" +\n        \"varying vec2 vTexCoord;\\n\" +\n        \"void main() {\\n\" +\n        \"vec4 color = texture2D(uTexture, vTexCoord);\\n\" +\n        \"if (uInvert == 1) {\\n\" +\n        \"gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\\n\" +\n        \"} else {\\n\" +\n        \"gl_FragColor = color;\\n\" +\n        \"}\\n\" +\n        \"}\",\n\n      /**\n       * Filter invert. if false, does nothing\n       * @param {Boolean} invert\n       * @default\n       */\n      invert: true,\n\n      mainParameter: \"invert\",\n\n      /**\n       * Apply the Invert operation to a Uint8Array representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8Array to be filtered.\n       */\n      applyTo2d: function (options) {\n        var imageData = options.imageData,\n          data = imageData.data,\n          i,\n          len = data.length;\n        for (i = 0; i < len; i += 4) {\n          data[i] = 255 - data[i];\n          data[i + 1] = 255 - data[i + 1];\n          data[i + 2] = 255 - data[i + 2];\n        }\n      },\n\n      /**\n       * Invert filter isNeutralState implementation\n       * Used only in image applyFilters to discard filters that will not have an effect\n       * on the image\n       * @param {Object} options\n       **/\n      isNeutralState: function () {\n        return !this.invert;\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uInvert: gl.getUniformLocation(program, \"uInvert\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        gl.uniform1i(uniformLocations.uInvert, this.invert);\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Invert} Instance of fabric.Image.filters.Invert\n   */\n  fabric.Image.filters.Invert.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    extend = fabric.util.object.extend,\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Noise filter class\n   * @class fabric.Image.filters.Noise\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Noise#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Noise({\n   *   noise: 700\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Noise = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.Noise.prototype */ {\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: \"Noise\",\n\n      /**\n       * Fragment source for the noise program\n       */\n      fragmentSource:\n        \"precision highp float;\\n\" +\n        \"uniform sampler2D uTexture;\\n\" +\n        \"uniform float uStepH;\\n\" +\n        \"uniform float uNoise;\\n\" +\n        \"uniform float uSeed;\\n\" +\n        \"varying vec2 vTexCoord;\\n\" +\n        \"float rand(vec2 co, float seed, float vScale) {\\n\" +\n        \"return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\\n\" +\n        \"}\\n\" +\n        \"void main() {\\n\" +\n        \"vec4 color = texture2D(uTexture, vTexCoord);\\n\" +\n        \"color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\\n\" +\n        \"gl_FragColor = color;\\n\" +\n        \"}\",\n\n      /**\n       * Describe the property that is the filter parameter\n       * @param {String} m\n       * @default\n       */\n      mainParameter: \"noise\",\n\n      /**\n       * Noise value, from\n       * @param {Number} noise\n       * @default\n       */\n      noise: 0,\n\n      /**\n       * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */\n      applyTo2d: function (options) {\n        if (this.noise === 0) {\n          return;\n        }\n        var imageData = options.imageData,\n          data = imageData.data,\n          i,\n          len = data.length,\n          noise = this.noise,\n          rand;\n\n        for (i = 0, len = data.length; i < len; i += 4) {\n          rand = (0.5 - Math.random()) * noise;\n\n          data[i] += rand;\n          data[i + 1] += rand;\n          data[i + 2] += rand;\n        }\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uNoise: gl.getUniformLocation(program, \"uNoise\"),\n          uSeed: gl.getUniformLocation(program, \"uSeed\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        gl.uniform1f(uniformLocations.uNoise, this.noise / 255);\n        gl.uniform1f(uniformLocations.uSeed, Math.random());\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @return {Object} Object representation of an instance\n       */\n      toObject: function () {\n        return extend(this.callSuper(\"toObject\"), {\n          noise: this.noise,\n        });\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Noise} Instance of fabric.Image.filters.Noise\n   */\n  fabric.Image.filters.Noise.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Pixelate filter class\n   * @class fabric.Image.filters.Pixelate\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Pixelate#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Pixelate({\n   *   blocksize: 8\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Pixelate = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.Pixelate.prototype */ {\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: \"Pixelate\",\n\n      blocksize: 4,\n\n      mainParameter: \"blocksize\",\n\n      /**\n       * Fragment source for the Pixelate program\n       */\n      fragmentSource:\n        \"precision highp float;\\n\" +\n        \"uniform sampler2D uTexture;\\n\" +\n        \"uniform float uBlocksize;\\n\" +\n        \"uniform float uStepW;\\n\" +\n        \"uniform float uStepH;\\n\" +\n        \"varying vec2 vTexCoord;\\n\" +\n        \"void main() {\\n\" +\n        \"float blockW = uBlocksize * uStepW;\\n\" +\n        \"float blockH = uBlocksize * uStepW;\\n\" +\n        \"int posX = int(vTexCoord.x / blockW);\\n\" +\n        \"int posY = int(vTexCoord.y / blockH);\\n\" +\n        \"float fposX = float(posX);\\n\" +\n        \"float fposY = float(posY);\\n\" +\n        \"vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\\n\" +\n        \"vec4 color = texture2D(uTexture, squareCoords);\\n\" +\n        \"gl_FragColor = color;\\n\" +\n        \"}\",\n\n      /**\n       * Apply the Pixelate operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */\n      applyTo2d: function (options) {\n        var imageData = options.imageData,\n          data = imageData.data,\n          iLen = imageData.height,\n          jLen = imageData.width,\n          index,\n          i,\n          j,\n          r,\n          g,\n          b,\n          a,\n          _i,\n          _j,\n          _iLen,\n          _jLen;\n\n        for (i = 0; i < iLen; i += this.blocksize) {\n          for (j = 0; j < jLen; j += this.blocksize) {\n            index = i * 4 * jLen + j * 4;\n\n            r = data[index];\n            g = data[index + 1];\n            b = data[index + 2];\n            a = data[index + 3];\n\n            _iLen = Math.min(i + this.blocksize, iLen);\n            _jLen = Math.min(j + this.blocksize, jLen);\n            for (_i = i; _i < _iLen; _i++) {\n              for (_j = j; _j < _jLen; _j++) {\n                index = _i * 4 * jLen + _j * 4;\n                data[index] = r;\n                data[index + 1] = g;\n                data[index + 2] = b;\n                data[index + 3] = a;\n              }\n            }\n          }\n        }\n      },\n\n      /**\n       * Indicate when the filter is not gonna apply changes to the image\n       **/\n      isNeutralState: function () {\n        return this.blocksize === 1;\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uBlocksize: gl.getUniformLocation(program, \"uBlocksize\"),\n          uStepW: gl.getUniformLocation(program, \"uStepW\"),\n          uStepH: gl.getUniformLocation(program, \"uStepH\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        gl.uniform1f(uniformLocations.uBlocksize, this.blocksize);\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Pixelate} Instance of fabric.Image.filters.Pixelate\n   */\n  fabric.Image.filters.Pixelate.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    extend = fabric.util.object.extend,\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Remove white filter class\n   * @class fabric.Image.filters.RemoveColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.RemoveColor#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.RemoveColor({\n   *   threshold: 0.2,\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.RemoveColor = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.RemoveColor.prototype */ {\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: \"RemoveColor\",\n\n      /**\n       * Color to remove, in any format understood by fabric.Color.\n       * @param {String} type\n       * @default\n       */\n      color: \"#FFFFFF\",\n\n      /**\n       * Fragment source for the brightness program\n       */\n      fragmentSource:\n        \"precision highp float;\\n\" +\n        \"uniform sampler2D uTexture;\\n\" +\n        \"uniform vec4 uLow;\\n\" +\n        \"uniform vec4 uHigh;\\n\" +\n        \"varying vec2 vTexCoord;\\n\" +\n        \"void main() {\\n\" +\n        \"gl_FragColor = texture2D(uTexture, vTexCoord);\\n\" +\n        \"if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\\n\" +\n        \"gl_FragColor.a = 0.0;\\n\" +\n        \"}\\n\" +\n        \"}\",\n\n      /**\n       * distance to actual color, as value up or down from each r,g,b\n       * between 0 and 1\n       **/\n      distance: 0.02,\n\n      /**\n       * For color to remove inside distance, use alpha channel for a smoother deletion\n       * NOT IMPLEMENTED YET\n       **/\n      useAlpha: false,\n\n      /**\n       * Constructor\n       * @memberOf fabric.Image.filters.RemoveWhite.prototype\n       * @param {Object} [options] Options object\n       * @param {Number} [options.color=#RRGGBB] Threshold value\n       * @param {Number} [options.distance=10] Distance value\n       */\n\n      /**\n       * Applies filter to canvas element\n       * @param {Object} canvasEl Canvas element to apply filter to\n       */\n      applyTo2d: function (options) {\n        var imageData = options.imageData,\n          data = imageData.data,\n          i,\n          distance = this.distance * 255,\n          r,\n          g,\n          b,\n          source = new fabric.Color(this.color).getSource(),\n          lowC = [\n            source[0] - distance,\n            source[1] - distance,\n            source[2] - distance,\n          ],\n          highC = [\n            source[0] + distance,\n            source[1] + distance,\n            source[2] + distance,\n          ];\n\n        for (i = 0; i < data.length; i += 4) {\n          r = data[i];\n          g = data[i + 1];\n          b = data[i + 2];\n\n          if (\n            r > lowC[0] &&\n            g > lowC[1] &&\n            b > lowC[2] &&\n            r < highC[0] &&\n            g < highC[1] &&\n            b < highC[2]\n          ) {\n            data[i + 3] = 0;\n          }\n        }\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uLow: gl.getUniformLocation(program, \"uLow\"),\n          uHigh: gl.getUniformLocation(program, \"uHigh\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        var source = new fabric.Color(this.color).getSource(),\n          distance = parseFloat(this.distance),\n          lowC = [\n            0 + source[0] / 255 - distance,\n            0 + source[1] / 255 - distance,\n            0 + source[2] / 255 - distance,\n            1,\n          ],\n          highC = [\n            source[0] / 255 + distance,\n            source[1] / 255 + distance,\n            source[2] / 255 + distance,\n            1,\n          ];\n        gl.uniform4fv(uniformLocations.uLow, lowC);\n        gl.uniform4fv(uniformLocations.uHigh, highC);\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @return {Object} Object representation of an instance\n       */\n      toObject: function () {\n        return extend(this.callSuper(\"toObject\"), {\n          color: this.color,\n          distance: this.distance,\n        });\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.RemoveColor} Instance of fabric.Image.filters.RemoveWhite\n   */\n  fabric.Image.filters.RemoveColor.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  var matrices = {\n    Brownie: [\n      0.5997,\n      0.34553,\n      -0.27082,\n      0,\n      0.186,\n      -0.0377,\n      0.86095,\n      0.15059,\n      0,\n      -0.1449,\n      0.24113,\n      -0.07441,\n      0.44972,\n      0,\n      -0.02965,\n      0,\n      0,\n      0,\n      1,\n      0,\n    ],\n    Vintage: [\n      0.62793,\n      0.32021,\n      -0.03965,\n      0,\n      0.03784,\n      0.02578,\n      0.64411,\n      0.03259,\n      0,\n      0.02926,\n      0.0466,\n      -0.08512,\n      0.52416,\n      0,\n      0.02023,\n      0,\n      0,\n      0,\n      1,\n      0,\n    ],\n    Kodachrome: [\n      1.12855,\n      -0.39673,\n      -0.03992,\n      0,\n      0.24991,\n      -0.16404,\n      1.08352,\n      -0.05498,\n      0,\n      0.09698,\n      -0.16786,\n      -0.56034,\n      1.60148,\n      0,\n      0.13972,\n      0,\n      0,\n      0,\n      1,\n      0,\n    ],\n    Technicolor: [\n      1.91252,\n      -0.85453,\n      -0.09155,\n      0,\n      0.04624,\n      -0.30878,\n      1.76589,\n      -0.10601,\n      0,\n      -0.27589,\n      -0.2311,\n      -0.75018,\n      1.84759,\n      0,\n      0.12137,\n      0,\n      0,\n      0,\n      1,\n      0,\n    ],\n    Polaroid: [\n      1.438,\n      -0.062,\n      -0.062,\n      0,\n      0,\n      -0.122,\n      1.378,\n      -0.122,\n      0,\n      0,\n      -0.016,\n      -0.016,\n      1.483,\n      0,\n      0,\n      0,\n      0,\n      0,\n      1,\n      0,\n    ],\n    Sepia: [\n      0.393,\n      0.769,\n      0.189,\n      0,\n      0,\n      0.349,\n      0.686,\n      0.168,\n      0,\n      0,\n      0.272,\n      0.534,\n      0.131,\n      0,\n      0,\n      0,\n      0,\n      0,\n      1,\n      0,\n    ],\n    BlackWhite: [\n      1.5,\n      1.5,\n      1.5,\n      0,\n      -1,\n      1.5,\n      1.5,\n      1.5,\n      0,\n      -1,\n      1.5,\n      1.5,\n      1.5,\n      0,\n      -1,\n      0,\n      0,\n      0,\n      1,\n      0,\n    ],\n  };\n\n  for (var key in matrices) {\n    filters[key] = createClass(\n      filters.ColorMatrix,\n      /** @lends fabric.Image.filters.Sepia.prototype */ {\n        /**\n         * Filter type\n         * @param {String} type\n         * @default\n         */\n        type: key,\n\n        /**\n         * Colormatrix for the effect\n         * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n         * outside the -1, 1 range.\n         * @param {Array} matrix array of 20 numbers.\n         * @default\n         */\n        matrix: matrices[key],\n\n        /**\n         * Lock the matrix export for this kind of static, parameter less filters.\n         */\n        mainParameter: false,\n        /**\n         * Lock the colormatrix on the color part, skipping alpha\n         */\n        colorsOnly: true,\n      }\n    );\n    fabric.Image.filters[key].fromObject =\n      fabric.Image.filters.BaseFilter.fromObject;\n  }\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric,\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Color Blend filter class\n   * @class fabric.Image.filter.BlendColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n\n  filters.BlendColor = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.Blend.prototype */ {\n      type: \"BlendColor\",\n\n      /**\n       * Color to make the blend operation with. default to a reddish color since black or white\n       * gives always strong result.\n       **/\n      color: \"#F95C63\",\n\n      /**\n       * Blend mode for the filter: one of multiply, add, diff, screen, subtract,\n       * darken, lighten, overlay, exclusion, tint.\n       **/\n      mode: \"multiply\",\n\n      /**\n       * alpha value. represent the strength of the blend color operation.\n       **/\n      alpha: 1,\n\n      /**\n       * Fragment source for the Multiply program\n       */\n      fragmentSource: {\n        multiply: \"gl_FragColor.rgb *= uColor.rgb;\\n\",\n        screen:\n          \"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\\n\",\n        add: \"gl_FragColor.rgb += uColor.rgb;\\n\",\n        diff: \"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\\n\",\n        subtract: \"gl_FragColor.rgb -= uColor.rgb;\\n\",\n        lighten: \"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\\n\",\n        darken: \"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\\n\",\n        exclusion:\n          \"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\\n\",\n        overlay:\n          \"if (uColor.r < 0.5) {\\n\" +\n          \"gl_FragColor.r *= 2.0 * uColor.r;\\n\" +\n          \"} else {\\n\" +\n          \"gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\\n\" +\n          \"}\\n\" +\n          \"if (uColor.g < 0.5) {\\n\" +\n          \"gl_FragColor.g *= 2.0 * uColor.g;\\n\" +\n          \"} else {\\n\" +\n          \"gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\\n\" +\n          \"}\\n\" +\n          \"if (uColor.b < 0.5) {\\n\" +\n          \"gl_FragColor.b *= 2.0 * uColor.b;\\n\" +\n          \"} else {\\n\" +\n          \"gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\\n\" +\n          \"}\\n\",\n        tint:\n          \"gl_FragColor.rgb *= (1.0 - uColor.a);\\n\" +\n          \"gl_FragColor.rgb += uColor.rgb;\\n\",\n      },\n\n      /**\n       * build the fragment source for the filters, joining the common part with\n       * the specific one.\n       * @param {String} mode the mode of the filter, a key of this.fragmentSource\n       * @return {String} the source to be compiled\n       * @private\n       */\n      buildSource: function (mode) {\n        return (\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"uniform vec4 uColor;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 color = texture2D(uTexture, vTexCoord);\\n\" +\n          \"gl_FragColor = color;\\n\" +\n          \"if (color.a > 0.0) {\\n\" +\n          this.fragmentSource[mode] +\n          \"}\\n\" +\n          \"}\"\n        );\n      },\n\n      /**\n       * Retrieves the cached shader.\n       * @param {Object} options\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */\n      retrieveShader: function (options) {\n        var cacheKey = this.type + \"_\" + this.mode,\n          shaderSource;\n        if (!options.programCache.hasOwnProperty(cacheKey)) {\n          shaderSource = this.buildSource(this.mode);\n          options.programCache[cacheKey] = this.createProgram(\n            options.context,\n            shaderSource\n          );\n        }\n        return options.programCache[cacheKey];\n      },\n\n      /**\n       * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */\n      applyTo2d: function (options) {\n        var imageData = options.imageData,\n          data = imageData.data,\n          iLen = data.length,\n          tr,\n          tg,\n          tb,\n          r,\n          g,\n          b,\n          source,\n          alpha1 = 1 - this.alpha;\n\n        source = new fabric.Color(this.color).getSource();\n        tr = source[0] * this.alpha;\n        tg = source[1] * this.alpha;\n        tb = source[2] * this.alpha;\n\n        for (var i = 0; i < iLen; i += 4) {\n          r = data[i];\n          g = data[i + 1];\n          b = data[i + 2];\n\n          switch (this.mode) {\n            case \"multiply\":\n              data[i] = (r * tr) / 255;\n              data[i + 1] = (g * tg) / 255;\n              data[i + 2] = (b * tb) / 255;\n              break;\n            case \"screen\":\n              data[i] = 255 - ((255 - r) * (255 - tr)) / 255;\n              data[i + 1] = 255 - ((255 - g) * (255 - tg)) / 255;\n              data[i + 2] = 255 - ((255 - b) * (255 - tb)) / 255;\n              break;\n            case \"add\":\n              data[i] = r + tr;\n              data[i + 1] = g + tg;\n              data[i + 2] = b + tb;\n              break;\n            case \"diff\":\n            case \"difference\":\n              data[i] = Math.abs(r - tr);\n              data[i + 1] = Math.abs(g - tg);\n              data[i + 2] = Math.abs(b - tb);\n              break;\n            case \"subtract\":\n              data[i] = r - tr;\n              data[i + 1] = g - tg;\n              data[i + 2] = b - tb;\n              break;\n            case \"darken\":\n              data[i] = Math.min(r, tr);\n              data[i + 1] = Math.min(g, tg);\n              data[i + 2] = Math.min(b, tb);\n              break;\n            case \"lighten\":\n              data[i] = Math.max(r, tr);\n              data[i + 1] = Math.max(g, tg);\n              data[i + 2] = Math.max(b, tb);\n              break;\n            case \"overlay\":\n              data[i] =\n                tr < 128\n                  ? (2 * r * tr) / 255\n                  : 255 - (2 * (255 - r) * (255 - tr)) / 255;\n              data[i + 1] =\n                tg < 128\n                  ? (2 * g * tg) / 255\n                  : 255 - (2 * (255 - g) * (255 - tg)) / 255;\n              data[i + 2] =\n                tb < 128\n                  ? (2 * b * tb) / 255\n                  : 255 - (2 * (255 - b) * (255 - tb)) / 255;\n              break;\n            case \"exclusion\":\n              data[i] = tr + r - (2 * tr * r) / 255;\n              data[i + 1] = tg + g - (2 * tg * g) / 255;\n              data[i + 2] = tb + b - (2 * tb * b) / 255;\n              break;\n            case \"tint\":\n              data[i] = tr + r * alpha1;\n              data[i + 1] = tg + g * alpha1;\n              data[i + 2] = tb + b * alpha1;\n          }\n        }\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uColor: gl.getUniformLocation(program, \"uColor\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        var source = new fabric.Color(this.color).getSource();\n        source[0] = (this.alpha * source[0]) / 255;\n        source[1] = (this.alpha * source[1]) / 255;\n        source[2] = (this.alpha * source[2]) / 255;\n        source[3] = this.alpha;\n        gl.uniform4fv(uniformLocations.uColor, source);\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @return {Object} Object representation of an instance\n       */\n      toObject: function () {\n        return {\n          type: this.type,\n          color: this.color,\n          mode: this.mode,\n          alpha: this.alpha,\n        };\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendColor} Instance of fabric.Image.filters.BlendColor\n   */\n  fabric.Image.filters.BlendColor.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric,\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Image Blend filter class\n   * @class fabric.Image.filter.BlendImage\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n\n  filters.BlendImage = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.BlendImage.prototype */ {\n      type: \"BlendImage\",\n\n      /**\n       * Color to make the blend operation with. default to a reddish color since black or white\n       * gives always strong result.\n       **/\n      image: null,\n\n      /**\n       * Blend mode for the filter: one of multiply, add, diff, screen, subtract,\n       * darken, lighten, overlay, exclusion, tint.\n       **/\n      mode: \"multiply\",\n\n      /**\n       * alpha value. represent the strength of the blend image operation.\n       * not implemented.\n       **/\n      alpha: 1,\n\n      vertexSource:\n        \"attribute vec2 aPosition;\\n\" +\n        \"varying vec2 vTexCoord;\\n\" +\n        \"varying vec2 vTexCoord2;\\n\" +\n        \"uniform mat3 uTransformMatrix;\\n\" +\n        \"void main() {\\n\" +\n        \"vTexCoord = aPosition;\\n\" +\n        \"vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\\n\" +\n        \"gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n\" +\n        \"}\",\n\n      /**\n       * Fragment source for the Multiply program\n       */\n      fragmentSource: {\n        multiply:\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"uniform sampler2D uImage;\\n\" +\n          \"uniform vec4 uColor;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"varying vec2 vTexCoord2;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 color = texture2D(uTexture, vTexCoord);\\n\" +\n          \"vec4 color2 = texture2D(uImage, vTexCoord2);\\n\" +\n          \"color.rgba *= color2.rgba;\\n\" +\n          \"gl_FragColor = color;\\n\" +\n          \"}\",\n        mask:\n          \"precision highp float;\\n\" +\n          \"uniform sampler2D uTexture;\\n\" +\n          \"uniform sampler2D uImage;\\n\" +\n          \"uniform vec4 uColor;\\n\" +\n          \"varying vec2 vTexCoord;\\n\" +\n          \"varying vec2 vTexCoord2;\\n\" +\n          \"void main() {\\n\" +\n          \"vec4 color = texture2D(uTexture, vTexCoord);\\n\" +\n          \"vec4 color2 = texture2D(uImage, vTexCoord2);\\n\" +\n          \"color.a = color2.a;\\n\" +\n          \"gl_FragColor = color;\\n\" +\n          \"}\",\n      },\n\n      /**\n       * Retrieves the cached shader.\n       * @param {Object} options\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */\n      retrieveShader: function (options) {\n        var cacheKey = this.type + \"_\" + this.mode;\n        var shaderSource = this.fragmentSource[this.mode];\n        if (!options.programCache.hasOwnProperty(cacheKey)) {\n          options.programCache[cacheKey] = this.createProgram(\n            options.context,\n            shaderSource\n          );\n        }\n        return options.programCache[cacheKey];\n      },\n\n      applyToWebGL: function (options) {\n        // load texture to blend.\n        var gl = options.context,\n          texture = this.createTexture(options.filterBackend, this.image);\n        this.bindAdditionalTexture(gl, texture, gl.TEXTURE1);\n        this.callSuper(\"applyToWebGL\", options);\n        this.unbindAdditionalTexture(gl, gl.TEXTURE1);\n      },\n\n      createTexture: function (backend, image) {\n        return backend.getCachedTexture(image.cacheKey, image._element);\n      },\n\n      /**\n       * Calculate a transformMatrix to adapt the image to blend over\n       * @param {Object} options\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */\n      calculateMatrix: function () {\n        var image = this.image,\n          width = image._element.width,\n          height = image._element.height;\n        return [\n          1 / image.scaleX,\n          0,\n          0,\n          0,\n          1 / image.scaleY,\n          0,\n          -image.left / width,\n          -image.top / height,\n          1,\n        ];\n      },\n\n      /**\n       * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */\n      applyTo2d: function (options) {\n        var imageData = options.imageData,\n          resources = options.filterBackend.resources,\n          data = imageData.data,\n          iLen = data.length,\n          width = imageData.width,\n          height = imageData.height,\n          tr,\n          tg,\n          tb,\n          ta,\n          r,\n          g,\n          b,\n          a,\n          canvas1,\n          context,\n          image = this.image,\n          blendData;\n\n        if (!resources.blendImage) {\n          resources.blendImage = fabric.util.createCanvasElement();\n        }\n        canvas1 = resources.blendImage;\n        context = canvas1.getContext(\"2d\");\n        if (canvas1.width !== width || canvas1.height !== height) {\n          canvas1.width = width;\n          canvas1.height = height;\n        } else {\n          context.clearRect(0, 0, width, height);\n        }\n        context.setTransform(\n          image.scaleX,\n          0,\n          0,\n          image.scaleY,\n          image.left,\n          image.top\n        );\n        context.drawImage(image._element, 0, 0, width, height);\n        blendData = context.getImageData(0, 0, width, height).data;\n        for (var i = 0; i < iLen; i += 4) {\n          r = data[i];\n          g = data[i + 1];\n          b = data[i + 2];\n          a = data[i + 3];\n\n          tr = blendData[i];\n          tg = blendData[i + 1];\n          tb = blendData[i + 2];\n          ta = blendData[i + 3];\n\n          switch (this.mode) {\n            case \"multiply\":\n              data[i] = (r * tr) / 255;\n              data[i + 1] = (g * tg) / 255;\n              data[i + 2] = (b * tb) / 255;\n              data[i + 3] = (a * ta) / 255;\n              break;\n            case \"mask\":\n              data[i + 3] = ta;\n              break;\n          }\n        }\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uTransformMatrix: gl.getUniformLocation(program, \"uTransformMatrix\"),\n          uImage: gl.getUniformLocation(program, \"uImage\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        var matrix = this.calculateMatrix();\n        gl.uniform1i(uniformLocations.uImage, 1); // texture unit 1.\n        gl.uniformMatrix3fv(uniformLocations.uTransformMatrix, false, matrix);\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @return {Object} Object representation of an instance\n       */\n      toObject: function () {\n        return {\n          type: this.type,\n          image: this.image && this.image.toObject(),\n          mode: this.mode,\n          alpha: this.alpha,\n        };\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} callback to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendImage} Instance of fabric.Image.filters.BlendImage\n   */\n  fabric.Image.filters.BlendImage.fromObject = function (object, callback) {\n    fabric.Image.fromObject(object.image, function (image) {\n      var options = fabric.util.object.clone(object);\n      options.image = image;\n      callback(new fabric.Image.filters.BlendImage(options));\n    });\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    pow = Math.pow,\n    floor = Math.floor,\n    sqrt = Math.sqrt,\n    abs = Math.abs,\n    round = Math.round,\n    sin = Math.sin,\n    ceil = Math.ceil,\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Resize image filter class\n   * @class fabric.Image.filters.Resize\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Resize();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Resize = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.Resize.prototype */ {\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: \"Resize\",\n\n      /**\n       * Resize type\n       * for webgl resizeType is just lanczos, for canvas2d can be:\n       * bilinear, hermite, sliceHack, lanczos.\n       * @param {String} resizeType\n       * @default\n       */\n      resizeType: \"hermite\",\n\n      /**\n       * Scale factor for resizing, x axis\n       * @param {Number} scaleX\n       * @default\n       */\n      scaleX: 1,\n\n      /**\n       * Scale factor for resizing, y axis\n       * @param {Number} scaleY\n       * @default\n       */\n      scaleY: 1,\n\n      /**\n       * LanczosLobes parameter for lanczos filter, valid for resizeType lanczos\n       * @param {Number} lanczosLobes\n       * @default\n       */\n      lanczosLobes: 3,\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uDelta: gl.getUniformLocation(program, \"uDelta\"),\n          uTaps: gl.getUniformLocation(program, \"uTaps\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        gl.uniform2fv(\n          uniformLocations.uDelta,\n          this.horizontal ? [1 / this.width, 0] : [0, 1 / this.height]\n        );\n        gl.uniform1fv(uniformLocations.uTaps, this.taps);\n      },\n\n      /**\n       * Retrieves the cached shader.\n       * @param {Object} options\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */\n      retrieveShader: function (options) {\n        var filterWindow = this.getFilterWindow(),\n          cacheKey = this.type + \"_\" + filterWindow;\n        if (!options.programCache.hasOwnProperty(cacheKey)) {\n          var fragmentShader = this.generateShader(filterWindow);\n          options.programCache[cacheKey] = this.createProgram(\n            options.context,\n            fragmentShader\n          );\n        }\n        return options.programCache[cacheKey];\n      },\n\n      getFilterWindow: function () {\n        var scale = this.tempScale;\n        return Math.ceil(this.lanczosLobes / scale);\n      },\n\n      getTaps: function () {\n        var lobeFunction = this.lanczosCreate(this.lanczosLobes),\n          scale = this.tempScale,\n          filterWindow = this.getFilterWindow(),\n          taps = new Array(filterWindow);\n        for (var i = 1; i <= filterWindow; i++) {\n          taps[i - 1] = lobeFunction(i * scale);\n        }\n        return taps;\n      },\n\n      /**\n       * Generate vertex and shader sources from the necessary steps numbers\n       * @param {Number} filterWindow\n       */\n      generateShader: function (filterWindow) {\n        var offsets = new Array(filterWindow),\n          fragmentShader = this.fragmentSourceTOP,\n          filterWindow;\n\n        for (var i = 1; i <= filterWindow; i++) {\n          offsets[i - 1] = i + \".0 * uDelta\";\n        }\n\n        fragmentShader += \"uniform float uTaps[\" + filterWindow + \"];\\n\";\n        fragmentShader += \"void main() {\\n\";\n        fragmentShader += \"  vec4 color = texture2D(uTexture, vTexCoord);\\n\";\n        fragmentShader += \"  float sum = 1.0;\\n\";\n\n        offsets.forEach(function (offset, i) {\n          fragmentShader +=\n            \"  color += texture2D(uTexture, vTexCoord + \" +\n            offset +\n            \") * uTaps[\" +\n            i +\n            \"];\\n\";\n          fragmentShader +=\n            \"  color += texture2D(uTexture, vTexCoord - \" +\n            offset +\n            \") * uTaps[\" +\n            i +\n            \"];\\n\";\n          fragmentShader += \"  sum += 2.0 * uTaps[\" + i + \"];\\n\";\n        });\n        fragmentShader += \"  gl_FragColor = color / sum;\\n\";\n        fragmentShader += \"}\";\n        return fragmentShader;\n      },\n\n      fragmentSourceTOP:\n        \"precision highp float;\\n\" +\n        \"uniform sampler2D uTexture;\\n\" +\n        \"uniform vec2 uDelta;\\n\" +\n        \"varying vec2 vTexCoord;\\n\",\n\n      /**\n       * Apply the resize filter to the image\n       * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n       *\n       * @param {Object} options\n       * @param {Number} options.passes The number of filters remaining to be executed\n       * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n       * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n       * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */\n      applyTo: function (options) {\n        if (options.webgl) {\n          options.passes++;\n          this.width = options.sourceWidth;\n          this.horizontal = true;\n          this.dW = Math.round(this.width * this.scaleX);\n          this.dH = options.sourceHeight;\n          this.tempScale = this.dW / this.width;\n          this.taps = this.getTaps();\n          options.destinationWidth = this.dW;\n          this._setupFrameBuffer(options);\n          this.applyToWebGL(options);\n          this._swapTextures(options);\n          options.sourceWidth = options.destinationWidth;\n\n          this.height = options.sourceHeight;\n          this.horizontal = false;\n          this.dH = Math.round(this.height * this.scaleY);\n          this.tempScale = this.dH / this.height;\n          this.taps = this.getTaps();\n          options.destinationHeight = this.dH;\n          this._setupFrameBuffer(options);\n          this.applyToWebGL(options);\n          this._swapTextures(options);\n          options.sourceHeight = options.destinationHeight;\n        } else {\n          this.applyTo2d(options);\n        }\n      },\n\n      isNeutralState: function () {\n        return this.scaleX === 1 && this.scaleY === 1;\n      },\n\n      lanczosCreate: function (lobes) {\n        return function (x) {\n          if (x >= lobes || x <= -lobes) {\n            return 0.0;\n          }\n          if (x < 1.1920929e-7 && x > -1.1920929e-7) {\n            return 1.0;\n          }\n          x *= Math.PI;\n          var xx = x / lobes;\n          return ((sin(x) / x) * sin(xx)) / xx;\n        };\n      },\n\n      /**\n       * Applies filter to canvas element\n       * @memberOf fabric.Image.filters.Resize.prototype\n       * @param {Object} canvasEl Canvas element to apply filter to\n       * @param {Number} scaleX\n       * @param {Number} scaleY\n       */\n      applyTo2d: function (options) {\n        var imageData = options.imageData,\n          scaleX = this.scaleX,\n          scaleY = this.scaleY;\n\n        this.rcpScaleX = 1 / scaleX;\n        this.rcpScaleY = 1 / scaleY;\n\n        var oW = imageData.width,\n          oH = imageData.height,\n          dW = round(oW * scaleX),\n          dH = round(oH * scaleY),\n          newData;\n\n        if (this.resizeType === \"sliceHack\") {\n          newData = this.sliceByTwo(options, oW, oH, dW, dH);\n        } else if (this.resizeType === \"hermite\") {\n          newData = this.hermiteFastResize(options, oW, oH, dW, dH);\n        } else if (this.resizeType === \"bilinear\") {\n          newData = this.bilinearFiltering(options, oW, oH, dW, dH);\n        } else if (this.resizeType === \"lanczos\") {\n          newData = this.lanczosResize(options, oW, oH, dW, dH);\n        }\n        options.imageData = newData;\n      },\n\n      /**\n       * Filter sliceByTwo\n       * @param {Object} canvasEl Canvas element to apply filter to\n       * @param {Number} oW Original Width\n       * @param {Number} oH Original Height\n       * @param {Number} dW Destination Width\n       * @param {Number} dH Destination Height\n       * @returns {ImageData}\n       */\n      sliceByTwo: function (options, oW, oH, dW, dH) {\n        var imageData = options.imageData,\n          mult = 0.5,\n          doneW = false,\n          doneH = false,\n          stepW = oW * mult,\n          stepH = oH * mult,\n          resources = fabric.filterBackend.resources,\n          tmpCanvas,\n          ctx,\n          sX = 0,\n          sY = 0,\n          dX = oW,\n          dY = 0;\n        if (!resources.sliceByTwo) {\n          resources.sliceByTwo = document.createElement(\"canvas\");\n        }\n        tmpCanvas = resources.sliceByTwo;\n        if (tmpCanvas.width < oW * 1.5 || tmpCanvas.height < oH) {\n          tmpCanvas.width = oW * 1.5;\n          tmpCanvas.height = oH;\n        }\n        ctx = tmpCanvas.getContext(\"2d\");\n        ctx.clearRect(0, 0, oW * 1.5, oH);\n        ctx.putImageData(imageData, 0, 0);\n\n        dW = floor(dW);\n        dH = floor(dH);\n\n        while (!doneW || !doneH) {\n          oW = stepW;\n          oH = stepH;\n          if (dW < floor(stepW * mult)) {\n            stepW = floor(stepW * mult);\n          } else {\n            stepW = dW;\n            doneW = true;\n          }\n          if (dH < floor(stepH * mult)) {\n            stepH = floor(stepH * mult);\n          } else {\n            stepH = dH;\n            doneH = true;\n          }\n          ctx.drawImage(tmpCanvas, sX, sY, oW, oH, dX, dY, stepW, stepH);\n          sX = dX;\n          sY = dY;\n          dY += stepH;\n        }\n        return ctx.getImageData(sX, sY, dW, dH);\n      },\n\n      /**\n       * Filter lanczosResize\n       * @param {Object} canvasEl Canvas element to apply filter to\n       * @param {Number} oW Original Width\n       * @param {Number} oH Original Height\n       * @param {Number} dW Destination Width\n       * @param {Number} dH Destination Height\n       * @returns {ImageData}\n       */\n      lanczosResize: function (options, oW, oH, dW, dH) {\n        function process(u) {\n          var v, i, weight, idx, a, red, green, blue, alpha, fX, fY;\n          center.x = (u + 0.5) * ratioX;\n          icenter.x = floor(center.x);\n          for (v = 0; v < dH; v++) {\n            center.y = (v + 0.5) * ratioY;\n            icenter.y = floor(center.y);\n            a = 0;\n            red = 0;\n            green = 0;\n            blue = 0;\n            alpha = 0;\n            for (i = icenter.x - range2X; i <= icenter.x + range2X; i++) {\n              if (i < 0 || i >= oW) {\n                continue;\n              }\n              fX = floor(1000 * abs(i - center.x));\n              if (!cacheLanc[fX]) {\n                cacheLanc[fX] = {};\n              }\n              for (var j = icenter.y - range2Y; j <= icenter.y + range2Y; j++) {\n                if (j < 0 || j >= oH) {\n                  continue;\n                }\n                fY = floor(1000 * abs(j - center.y));\n                if (!cacheLanc[fX][fY]) {\n                  cacheLanc[fX][fY] = lanczos(\n                    sqrt(pow(fX * rcpRatioX, 2) + pow(fY * rcpRatioY, 2)) / 1000\n                  );\n                }\n                weight = cacheLanc[fX][fY];\n                if (weight > 0) {\n                  idx = (j * oW + i) * 4;\n                  a += weight;\n                  red += weight * srcData[idx];\n                  green += weight * srcData[idx + 1];\n                  blue += weight * srcData[idx + 2];\n                  alpha += weight * srcData[idx + 3];\n                }\n              }\n            }\n            idx = (v * dW + u) * 4;\n            destData[idx] = red / a;\n            destData[idx + 1] = green / a;\n            destData[idx + 2] = blue / a;\n            destData[idx + 3] = alpha / a;\n          }\n\n          if (++u < dW) {\n            return process(u);\n          } else {\n            return destImg;\n          }\n        }\n\n        var srcData = options.imageData.data,\n          destImg = options.ctx.createImageData(dW, dH),\n          destData = destImg.data,\n          lanczos = this.lanczosCreate(this.lanczosLobes),\n          ratioX = this.rcpScaleX,\n          ratioY = this.rcpScaleY,\n          rcpRatioX = 2 / this.rcpScaleX,\n          rcpRatioY = 2 / this.rcpScaleY,\n          range2X = ceil((ratioX * this.lanczosLobes) / 2),\n          range2Y = ceil((ratioY * this.lanczosLobes) / 2),\n          cacheLanc = {},\n          center = {},\n          icenter = {};\n\n        return process(0);\n      },\n\n      /**\n       * bilinearFiltering\n       * @param {Object} canvasEl Canvas element to apply filter to\n       * @param {Number} oW Original Width\n       * @param {Number} oH Original Height\n       * @param {Number} dW Destination Width\n       * @param {Number} dH Destination Height\n       * @returns {ImageData}\n       */\n      bilinearFiltering: function (options, oW, oH, dW, dH) {\n        var a,\n          b,\n          c,\n          d,\n          x,\n          y,\n          i,\n          j,\n          xDiff,\n          yDiff,\n          chnl,\n          color,\n          offset = 0,\n          origPix,\n          ratioX = this.rcpScaleX,\n          ratioY = this.rcpScaleY,\n          w4 = 4 * (oW - 1),\n          img = options.imageData,\n          pixels = img.data,\n          destImage = options.ctx.createImageData(dW, dH),\n          destPixels = destImage.data;\n        for (i = 0; i < dH; i++) {\n          for (j = 0; j < dW; j++) {\n            x = floor(ratioX * j);\n            y = floor(ratioY * i);\n            xDiff = ratioX * j - x;\n            yDiff = ratioY * i - y;\n            origPix = 4 * (y * oW + x);\n\n            for (chnl = 0; chnl < 4; chnl++) {\n              a = pixels[origPix + chnl];\n              b = pixels[origPix + 4 + chnl];\n              c = pixels[origPix + w4 + chnl];\n              d = pixels[origPix + w4 + 4 + chnl];\n              color =\n                a * (1 - xDiff) * (1 - yDiff) +\n                b * xDiff * (1 - yDiff) +\n                c * yDiff * (1 - xDiff) +\n                d * xDiff * yDiff;\n              destPixels[offset++] = color;\n            }\n          }\n        }\n        return destImage;\n      },\n\n      /**\n       * hermiteFastResize\n       * @param {Object} canvasEl Canvas element to apply filter to\n       * @param {Number} oW Original Width\n       * @param {Number} oH Original Height\n       * @param {Number} dW Destination Width\n       * @param {Number} dH Destination Height\n       * @returns {ImageData}\n       */\n      hermiteFastResize: function (options, oW, oH, dW, dH) {\n        var ratioW = this.rcpScaleX,\n          ratioH = this.rcpScaleY,\n          ratioWHalf = ceil(ratioW / 2),\n          ratioHHalf = ceil(ratioH / 2),\n          img = options.imageData,\n          data = img.data,\n          img2 = options.ctx.createImageData(dW, dH),\n          data2 = img2.data;\n        for (var j = 0; j < dH; j++) {\n          for (var i = 0; i < dW; i++) {\n            var x2 = (i + j * dW) * 4,\n              weight = 0,\n              weights = 0,\n              weightsAlpha = 0,\n              gxR = 0,\n              gxG = 0,\n              gxB = 0,\n              gxA = 0,\n              centerY = (j + 0.5) * ratioH;\n            for (var yy = floor(j * ratioH); yy < (j + 1) * ratioH; yy++) {\n              var dy = abs(centerY - (yy + 0.5)) / ratioHHalf,\n                centerX = (i + 0.5) * ratioW,\n                w0 = dy * dy;\n              for (var xx = floor(i * ratioW); xx < (i + 1) * ratioW; xx++) {\n                var dx = abs(centerX - (xx + 0.5)) / ratioWHalf,\n                  w = sqrt(w0 + dx * dx);\n                /* eslint-disable max-depth */\n                if (w > 1 && w < -1) {\n                  continue;\n                }\n                //hermite filter\n                weight = 2 * w * w * w - 3 * w * w + 1;\n                if (weight > 0) {\n                  dx = 4 * (xx + yy * oW);\n                  //alpha\n                  gxA += weight * data[dx + 3];\n                  weightsAlpha += weight;\n                  //colors\n                  if (data[dx + 3] < 255) {\n                    weight = (weight * data[dx + 3]) / 250;\n                  }\n                  gxR += weight * data[dx];\n                  gxG += weight * data[dx + 1];\n                  gxB += weight * data[dx + 2];\n                  weights += weight;\n                }\n                /* eslint-enable max-depth */\n              }\n            }\n            data2[x2] = gxR / weights;\n            data2[x2 + 1] = gxG / weights;\n            data2[x2 + 2] = gxB / weights;\n            data2[x2 + 3] = gxA / weightsAlpha;\n          }\n        }\n        return img2;\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @return {Object} Object representation of an instance\n       */\n      toObject: function () {\n        return {\n          type: this.type,\n          scaleX: this.scaleX,\n          scaleY: this.scaleY,\n          resizeType: this.resizeType,\n          lanczosLobes: this.lanczosLobes,\n        };\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Resize} Instance of fabric.Image.filters.Resize\n   */\n  fabric.Image.filters.Resize.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Contrast filter class\n   * @class fabric.Image.filters.Contrast\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Contrast#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Contrast({\n   *   contrast: 0.25\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Contrast = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.Contrast.prototype */ {\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: \"Contrast\",\n\n      fragmentSource:\n        \"precision highp float;\\n\" +\n        \"uniform sampler2D uTexture;\\n\" +\n        \"uniform float uContrast;\\n\" +\n        \"varying vec2 vTexCoord;\\n\" +\n        \"void main() {\\n\" +\n        \"vec4 color = texture2D(uTexture, vTexCoord);\\n\" +\n        \"float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\\n\" +\n        \"color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\\n\" +\n        \"gl_FragColor = color;\\n\" +\n        \"}\",\n\n      /**\n       * contrast value, range from -1 to 1.\n       * @param {Number} contrast\n       * @default 0\n       */\n      contrast: 0,\n\n      mainParameter: \"contrast\",\n\n      /**\n       * Constructor\n       * @memberOf fabric.Image.filters.Contrast.prototype\n       * @param {Object} [options] Options object\n       * @param {Number} [options.contrast=0] Value to contrast the image up (-1...1)\n       */\n\n      /**\n       * Apply the Contrast operation to a Uint8Array representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8Array to be filtered.\n       */\n      applyTo2d: function (options) {\n        if (this.contrast === 0) {\n          return;\n        }\n        var imageData = options.imageData,\n          i,\n          len,\n          data = imageData.data,\n          len = data.length,\n          contrast = Math.floor(this.contrast * 255),\n          contrastF = (259 * (contrast + 255)) / (255 * (259 - contrast));\n\n        for (i = 0; i < len; i += 4) {\n          data[i] = contrastF * (data[i] - 128) + 128;\n          data[i + 1] = contrastF * (data[i + 1] - 128) + 128;\n          data[i + 2] = contrastF * (data[i + 2] - 128) + 128;\n        }\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uContrast: gl.getUniformLocation(program, \"uContrast\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        gl.uniform1f(uniformLocations.uContrast, this.contrast);\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Contrast} Instance of fabric.Image.filters.Contrast\n   */\n  fabric.Image.filters.Contrast.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Saturate filter class\n   * @class fabric.Image.filters.Saturation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Saturation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Saturation({\n   *   saturation: 100\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Saturation = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.Saturation.prototype */ {\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: \"Saturation\",\n\n      fragmentSource:\n        \"precision highp float;\\n\" +\n        \"uniform sampler2D uTexture;\\n\" +\n        \"uniform float uSaturation;\\n\" +\n        \"varying vec2 vTexCoord;\\n\" +\n        \"void main() {\\n\" +\n        \"vec4 color = texture2D(uTexture, vTexCoord);\\n\" +\n        \"float rgMax = max(color.r, color.g);\\n\" +\n        \"float rgbMax = max(rgMax, color.b);\\n\" +\n        \"color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\\n\" +\n        \"color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\\n\" +\n        \"color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\\n\" +\n        \"gl_FragColor = color;\\n\" +\n        \"}\",\n\n      saturation: 0,\n\n      mainParameter: \"saturation\",\n\n      /**\n       * Constructor\n       * @memberOf fabric.Image.filters.Saturate.prototype\n       * @param {Object} [options] Options object\n       * @param {Number} [options.saturate=0] Value to saturate the image (-1...1)\n       */\n\n      /**\n       * Apply the Saturation operation to a Uint8ClampedArray representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n       */\n      applyTo2d: function (options) {\n        if (this.saturation === 0) {\n          return;\n        }\n        var imageData = options.imageData,\n          data = imageData.data,\n          len = data.length,\n          adjust = -this.saturation,\n          i,\n          max;\n\n        for (i = 0; i < len; i += 4) {\n          max = Math.max(data[i], data[i + 1], data[i + 2]);\n          data[i] += max !== data[i] ? (max - data[i]) * adjust : 0;\n          data[i + 1] += max !== data[i + 1] ? (max - data[i + 1]) * adjust : 0;\n          data[i + 2] += max !== data[i + 2] ? (max - data[i + 2]) * adjust : 0;\n        }\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uSaturation: gl.getUniformLocation(program, \"uSaturation\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        gl.uniform1f(uniformLocations.uSaturation, -this.saturation);\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Saturation} Instance of fabric.Image.filters.Saturate\n   */\n  fabric.Image.filters.Saturation.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Blur filter class\n   * @class fabric.Image.filters.Blur\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Blur#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Blur({\n   *   blur: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Blur = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.Blur.prototype */ {\n      type: \"Blur\",\n\n      /*\n    'gl_FragColor = vec4(0.0);',\n    'gl_FragColor += texture2D(texture, vTexCoord + -7 * uDelta)*0.0044299121055113265;',\n    'gl_FragColor += texture2D(texture, vTexCoord + -6 * uDelta)*0.00895781211794;',\n    'gl_FragColor += texture2D(texture, vTexCoord + -5 * uDelta)*0.0215963866053;',\n    'gl_FragColor += texture2D(texture, vTexCoord + -4 * uDelta)*0.0443683338718;',\n    'gl_FragColor += texture2D(texture, vTexCoord + -3 * uDelta)*0.0776744219933;',\n    'gl_FragColor += texture2D(texture, vTexCoord + -2 * uDelta)*0.115876621105;',\n    'gl_FragColor += texture2D(texture, vTexCoord + -1 * uDelta)*0.147308056121;',\n    'gl_FragColor += texture2D(texture, vTexCoord              )*0.159576912161;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 1 * uDelta)*0.147308056121;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 2 * uDelta)*0.115876621105;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 3 * uDelta)*0.0776744219933;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 4 * uDelta)*0.0443683338718;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 5 * uDelta)*0.0215963866053;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 6 * uDelta)*0.00895781211794;',\n    'gl_FragColor += texture2D(texture, vTexCoord + 7 * uDelta)*0.0044299121055113265;',\n    */\n\n      /* eslint-disable max-len */\n      fragmentSource:\n        \"precision highp float;\\n\" +\n        \"uniform sampler2D uTexture;\\n\" +\n        \"uniform vec2 uDelta;\\n\" +\n        \"varying vec2 vTexCoord;\\n\" +\n        \"const float nSamples = 15.0;\\n\" +\n        \"vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\\n\" +\n        \"float random(vec3 scale) {\\n\" +\n        /* use the fragment position for a different seed per-pixel */\n        \"return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\\n\" +\n        \"}\\n\" +\n        \"void main() {\\n\" +\n        \"vec4 color = vec4(0.0);\\n\" +\n        \"float total = 0.0;\\n\" +\n        \"float offset = random(v3offset);\\n\" +\n        \"for (float t = -nSamples; t <= nSamples; t++) {\\n\" +\n        \"float percent = (t + offset - 0.5) / nSamples;\\n\" +\n        \"float weight = 1.0 - abs(percent);\\n\" +\n        \"color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\\n\" +\n        \"total += weight;\\n\" +\n        \"}\\n\" +\n        \"gl_FragColor = color / total;\\n\" +\n        \"}\",\n      /* eslint-enable max-len */\n\n      /**\n       * blur value, in percentage of image dimensions.\n       * specific to keep the image blur constant at different resolutions\n       * range bewteen 0 and 1.\n       */\n      blur: 0,\n\n      mainParameter: \"blur\",\n\n      applyTo: function (options) {\n        if (options.webgl) {\n          // this aspectRatio is used to give the same blur to vertical and horizontal\n          this.aspectRatio = options.sourceWidth / options.sourceHeight;\n          options.passes++;\n          this._setupFrameBuffer(options);\n          this.horizontal = true;\n          this.applyToWebGL(options);\n          this._swapTextures(options);\n          this._setupFrameBuffer(options);\n          this.horizontal = false;\n          this.applyToWebGL(options);\n          this._swapTextures(options);\n        } else {\n          this.applyTo2d(options);\n        }\n      },\n\n      applyTo2d: function (options) {\n        // paint canvasEl with current image data.\n        //options.ctx.putImageData(options.imageData, 0, 0);\n        options.imageData = this.simpleBlur(options);\n      },\n\n      simpleBlur: function (options) {\n        var resources = options.filterBackend.resources,\n          canvas1,\n          canvas2,\n          width = options.imageData.width,\n          height = options.imageData.height;\n\n        if (!resources.blurLayer1) {\n          resources.blurLayer1 = fabric.util.createCanvasElement();\n          resources.blurLayer2 = fabric.util.createCanvasElement();\n        }\n        canvas1 = resources.blurLayer1;\n        canvas2 = resources.blurLayer2;\n        if (canvas1.width !== width || canvas1.height !== height) {\n          canvas2.width = canvas1.width = width;\n          canvas2.height = canvas1.height = height;\n        }\n        var ctx1 = canvas1.getContext(\"2d\"),\n          ctx2 = canvas2.getContext(\"2d\"),\n          nSamples = 15,\n          random,\n          percent,\n          j,\n          i,\n          blur = this.blur * 0.06 * 0.5;\n\n        // load first canvas\n        ctx1.putImageData(options.imageData, 0, 0);\n        ctx2.clearRect(0, 0, width, height);\n\n        for (i = -nSamples; i <= nSamples; i++) {\n          random = (Math.random() - 0.5) / 4;\n          percent = i / nSamples;\n          j = blur * percent * width + random;\n          ctx2.globalAlpha = 1 - Math.abs(percent);\n          ctx2.drawImage(canvas1, j, random);\n          ctx1.drawImage(canvas2, 0, 0);\n          ctx2.globalAlpha = 1;\n          ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\n        }\n        for (i = -nSamples; i <= nSamples; i++) {\n          random = (Math.random() - 0.5) / 4;\n          percent = i / nSamples;\n          j = blur * percent * height + random;\n          ctx2.globalAlpha = 1 - Math.abs(percent);\n          ctx2.drawImage(canvas1, random, j);\n          ctx1.drawImage(canvas2, 0, 0);\n          ctx2.globalAlpha = 1;\n          ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\n        }\n        options.ctx.drawImage(canvas1, 0, 0);\n        var newImageData = options.ctx.getImageData(\n          0,\n          0,\n          canvas1.width,\n          canvas1.height\n        );\n        ctx1.globalAlpha = 1;\n        ctx1.clearRect(0, 0, canvas1.width, canvas1.height);\n        return newImageData;\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          delta: gl.getUniformLocation(program, \"uDelta\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        var delta = this.chooseRightDelta();\n        gl.uniform2fv(uniformLocations.delta, delta);\n      },\n\n      /**\n       * choose right value of image percentage to blur with\n       * @returns {Array} a numeric array with delta values\n       */\n      chooseRightDelta: function () {\n        var blurScale = 1,\n          delta = [0, 0],\n          blur;\n        if (this.horizontal) {\n          if (this.aspectRatio > 1) {\n            // image is wide, i want to shrink radius horizontal\n            blurScale = 1 / this.aspectRatio;\n          }\n        } else {\n          if (this.aspectRatio < 1) {\n            // image is tall, i want to shrink radius vertical\n            blurScale = this.aspectRatio;\n          }\n        }\n        blur = blurScale * this.blur * 0.12;\n        if (this.horizontal) {\n          delta[0] = blur;\n        } else {\n          delta[1] = blur;\n        }\n        return delta;\n      },\n    }\n  );\n\n  /**\n   * Deserialize a JSON definition of a BlurFilter into a concrete instance.\n   */\n  filters.Blur.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * Gamma filter class\n   * @class fabric.Image.filters.Gamma\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Gamma#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Gamma({\n   *   brightness: 200\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Gamma = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.Gamma.prototype */ {\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: \"Gamma\",\n\n      fragmentSource:\n        \"precision highp float;\\n\" +\n        \"uniform sampler2D uTexture;\\n\" +\n        \"uniform vec3 uGamma;\\n\" +\n        \"varying vec2 vTexCoord;\\n\" +\n        \"void main() {\\n\" +\n        \"vec4 color = texture2D(uTexture, vTexCoord);\\n\" +\n        \"vec3 correction = (1.0 / uGamma);\\n\" +\n        \"color.r = pow(color.r, correction.r);\\n\" +\n        \"color.g = pow(color.g, correction.g);\\n\" +\n        \"color.b = pow(color.b, correction.b);\\n\" +\n        \"gl_FragColor = color;\\n\" +\n        \"gl_FragColor.rgb *= color.a;\\n\" +\n        \"}\",\n\n      /**\n       * Gamma array value, from 0.01 to 2.2.\n       * @param {Array} gamma\n       * @default\n       */\n      gamma: [1, 1, 1],\n\n      /**\n       * Describe the property that is the filter parameter\n       * @param {String} m\n       * @default\n       */\n      mainParameter: \"gamma\",\n\n      /**\n       * Constructor\n       * @param {Object} [options] Options object\n       */\n      initialize: function (options) {\n        this.gamma = [1, 1, 1];\n        filters.BaseFilter.prototype.initialize.call(this, options);\n      },\n\n      /**\n       * Apply the Gamma operation to a Uint8Array representing the pixels of an image.\n       *\n       * @param {Object} options\n       * @param {ImageData} options.imageData The Uint8Array to be filtered.\n       */\n      applyTo2d: function (options) {\n        var imageData = options.imageData,\n          data = imageData.data,\n          gamma = this.gamma,\n          len = data.length,\n          rInv = 1 / gamma[0],\n          gInv = 1 / gamma[1],\n          bInv = 1 / gamma[2],\n          i;\n\n        if (!this.rVals) {\n          // eslint-disable-next-line\n          this.rVals = new Uint8Array(256);\n          // eslint-disable-next-line\n          this.gVals = new Uint8Array(256);\n          // eslint-disable-next-line\n          this.bVals = new Uint8Array(256);\n        }\n\n        // This is an optimization - pre-compute a look-up table for each color channel\n        // instead of performing these pow calls for each pixel in the image.\n        for (i = 0, len = 256; i < len; i++) {\n          this.rVals[i] = Math.pow(i / 255, rInv) * 255;\n          this.gVals[i] = Math.pow(i / 255, gInv) * 255;\n          this.bVals[i] = Math.pow(i / 255, bInv) * 255;\n        }\n        for (i = 0, len = data.length; i < len; i += 4) {\n          data[i] = this.rVals[data[i]];\n          data[i + 1] = this.gVals[data[i + 1]];\n          data[i + 2] = this.bVals[data[i + 2]];\n        }\n      },\n\n      /**\n       * Return WebGL uniform locations for this filter's shader.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {WebGLShaderProgram} program This filter's compiled shader program.\n       */\n      getUniformLocations: function (gl, program) {\n        return {\n          uGamma: gl.getUniformLocation(program, \"uGamma\"),\n        };\n      },\n\n      /**\n       * Send data from this filter to its shader program's uniforms.\n       *\n       * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n       * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n       */\n      sendUniformData: function (gl, uniformLocations) {\n        gl.uniform3fv(uniformLocations.uGamma, this.gamma);\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Gamma} Instance of fabric.Image.filters.Gamma\n   */\n  fabric.Image.filters.Gamma.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * A container class that knows how to apply a sequence of filters to an input image.\n   */\n  filters.Composed = createClass(\n    filters.BaseFilter,\n    /** @lends fabric.Image.filters.Composed.prototype */ {\n      type: \"Composed\",\n\n      /**\n       * A non sparse array of filters to apply\n       */\n      subFilters: [],\n\n      /**\n       * Constructor\n       * @param {Object} [options] Options object\n       */\n      initialize: function (options) {\n        this.callSuper(\"initialize\", options);\n        // create a new array instead mutating the prototype with push\n        this.subFilters = this.subFilters.slice(0);\n      },\n\n      /**\n       * Apply this container's filters to the input image provided.\n       *\n       * @param {Object} options\n       * @param {Number} options.passes The number of filters remaining to be applied.\n       */\n      applyTo: function (options) {\n        options.passes += this.subFilters.length - 1;\n        this.subFilters.forEach(function (filter) {\n          filter.applyTo(options);\n        });\n      },\n\n      /**\n       * Serialize this filter into JSON.\n       *\n       * @returns {Object} A JSON representation of this filter.\n       */\n      toObject: function () {\n        return fabric.util.object.extend(this.callSuper(\"toObject\"), {\n          subFilters: this.subFilters.map(function (filter) {\n            return filter.toObject();\n          }),\n        });\n      },\n\n      isNeutralState: function () {\n        return !this.subFilters.some(function (filter) {\n          return !filter.isNeutralState();\n        });\n      },\n    }\n  );\n\n  /**\n   * Deserialize a JSON definition of a ComposedFilter into a concrete instance.\n   */\n  fabric.Image.filters.Composed.fromObject = function (object, callback) {\n    var filters = object.subFilters || [],\n      subFilters = filters.map(function (filter) {\n        return new fabric.Image.filters[filter.type](filter);\n      }),\n      instance = new fabric.Image.filters.Composed({ subFilters: subFilters });\n    callback && callback(instance);\n    return instance;\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    filters = fabric.Image.filters,\n    createClass = fabric.util.createClass;\n\n  /**\n   * HueRotation filter class\n   * @class fabric.Image.filters.HueRotation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.HueRotation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.HueRotation({\n   *   rotation: -0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.HueRotation = createClass(\n    filters.ColorMatrix,\n    /** @lends fabric.Image.filters.HueRotation.prototype */ {\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: \"HueRotation\",\n\n      /**\n       * HueRotation value, from -1 to 1.\n       * the unit is radians\n       * @param {Number} myParameter\n       * @default\n       */\n      rotation: 0,\n\n      /**\n       * Describe the property that is the filter parameter\n       * @param {String} m\n       * @default\n       */\n      mainParameter: \"rotation\",\n\n      calculateMatrix: function () {\n        var rad = this.rotation * Math.PI,\n          cos = fabric.util.cos(rad),\n          sin = fabric.util.sin(rad),\n          aThird = 1 / 3,\n          aThirdSqtSin = Math.sqrt(aThird) * sin,\n          OneMinusCos = 1 - cos;\n        this.matrix = [\n          1,\n          0,\n          0,\n          0,\n          0,\n          0,\n          1,\n          0,\n          0,\n          0,\n          0,\n          0,\n          1,\n          0,\n          0,\n          0,\n          0,\n          0,\n          1,\n          0,\n        ];\n        this.matrix[0] = cos + OneMinusCos / 3;\n        this.matrix[1] = aThird * OneMinusCos - aThirdSqtSin;\n        this.matrix[2] = aThird * OneMinusCos + aThirdSqtSin;\n        this.matrix[5] = aThird * OneMinusCos + aThirdSqtSin;\n        this.matrix[6] = cos + aThird * OneMinusCos;\n        this.matrix[7] = aThird * OneMinusCos - aThirdSqtSin;\n        this.matrix[10] = aThird * OneMinusCos - aThirdSqtSin;\n        this.matrix[11] = aThird * OneMinusCos + aThirdSqtSin;\n        this.matrix[12] = cos + aThird * OneMinusCos;\n      },\n\n      /**\n       * HueRotation isNeutralState implementation\n       * Used only in image applyFilters to discard filters that will not have an effect\n       * on the image\n       * @param {Object} options\n       **/\n      isNeutralState: function (options) {\n        this.calculateMatrix();\n        return filters.BaseFilter.prototype.isNeutralState.call(this, options);\n      },\n\n      /**\n       * Apply this filter to the input image data provided.\n       *\n       * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n       *\n       * @param {Object} options\n       * @param {Number} options.passes The number of filters remaining to be executed\n       * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n       * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n       * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n       * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n       * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n       */\n      applyTo: function (options) {\n        this.calculateMatrix();\n        filters.BaseFilter.prototype.applyTo.call(this, options);\n      },\n    }\n  );\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.HueRotation} Instance of fabric.Image.filters.HueRotation\n   */\n  fabric.Image.filters.HueRotation.fromObject =\n    fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {}),\n    clone = fabric.util.object.clone;\n\n  if (fabric.Text) {\n    fabric.warn(\"fabric.Text is already defined\");\n    return;\n  }\n\n  /**\n   * Text class\n   * @class fabric.Text\n   * @extends fabric.Object\n   * @return {fabric.Text} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#text}\n   * @see {@link fabric.Text#initialize} for constructor definition\n   */\n  fabric.Text = fabric.util.createClass(\n    fabric.Object,\n    /** @lends fabric.Text.prototype */ {\n      /**\n       * Properties which when set cause object to change dimensions\n       * @type Array\n       * @private\n       */\n      _dimensionAffectingProps: [\n        \"fontSize\",\n        \"fontWeight\",\n        \"fontFamily\",\n        \"fontStyle\",\n        \"lineHeight\",\n        \"text\",\n        \"charSpacing\",\n        \"textAlign\",\n        \"styles\",\n      ],\n\n      /**\n       * @private\n       */\n      _reNewline: /\\r?\\n/,\n\n      /**\n       * Use this regular expression to filter for whitespaces that is not a new line.\n       * Mostly used when text is 'justify' aligned.\n       * @private\n       */\n      _reSpacesAndTabs: /[ \\t\\r]/g,\n\n      /**\n       * Use this regular expression to filter for whitespace that is not a new line.\n       * Mostly used when text is 'justify' aligned.\n       * @private\n       */\n      _reSpaceAndTab: /[ \\t\\r]/,\n\n      /**\n       * Use this regular expression to filter consecutive groups of non spaces.\n       * Mostly used when text is 'justify' aligned.\n       * @private\n       */\n      _reWords: /\\S+/g,\n\n      /**\n       * Type of an object\n       * @type String\n       * @default\n       */\n      type: \"text\",\n\n      /**\n       * Font size (in pixels)\n       * @type Number\n       * @default\n       */\n      fontSize: 40,\n\n      /**\n       * Font weight (e.g. bold, normal, 400, 600, 800)\n       * @type {(Number|String)}\n       * @default\n       */\n      fontWeight: \"normal\",\n\n      /**\n       * Font family\n       * @type String\n       * @default\n       */\n      fontFamily: \"Times New Roman\",\n\n      /**\n       * Text decoration underline.\n       * @type Boolean\n       * @default\n       */\n      underline: false,\n\n      /**\n       * Text decoration overline.\n       * @type Boolean\n       * @default\n       */\n      overline: false,\n\n      /**\n       * Text decoration linethrough.\n       * @type Boolean\n       * @default\n       */\n      linethrough: false,\n\n      /**\n       * Text alignment. Possible values: \"left\", \"center\", \"right\", \"justify\",\n       * \"justify-left\", \"justify-center\" or \"justify-right\".\n       * @type String\n       * @default\n       */\n      textAlign: \"left\",\n\n      /**\n       * Font style . Possible values: \"\", \"normal\", \"italic\" or \"oblique\".\n       * @type String\n       * @default\n       */\n      fontStyle: \"normal\",\n\n      /**\n       * Line height\n       * @type Number\n       * @default\n       */\n      lineHeight: 1.16,\n\n      /**\n       * Superscript schema object (minimum overlap)\n       * @type {Object}\n       * @default\n       */\n      superscript: {\n        size: 0.6, // fontSize factor\n        baseline: -0.35, // baseline-shift factor (upwards)\n      },\n\n      /**\n       * Subscript schema object (minimum overlap)\n       * @type {Object}\n       * @default\n       */\n      subscript: {\n        size: 0.6, // fontSize factor\n        baseline: 0.11, // baseline-shift factor (downwards)\n      },\n\n      /**\n       * Background color of text lines\n       * @type String\n       * @default\n       */\n      textBackgroundColor: \"\",\n\n      /**\n       * List of properties to consider when checking if\n       * state of an object is changed ({@link fabric.Object#hasStateChanged})\n       * as well as for history (undo/redo) purposes\n       * @type Array\n       */\n      stateProperties: fabric.Object.prototype.stateProperties.concat(\n        \"fontFamily\",\n        \"fontWeight\",\n        \"fontSize\",\n        \"text\",\n        \"underline\",\n        \"overline\",\n        \"linethrough\",\n        \"textAlign\",\n        \"fontStyle\",\n        \"lineHeight\",\n        \"textBackgroundColor\",\n        \"charSpacing\",\n        \"styles\"\n      ),\n\n      /**\n       * List of properties to consider when checking if cache needs refresh\n       * @type Array\n       */\n      cacheProperties: fabric.Object.prototype.cacheProperties.concat(\n        \"fontFamily\",\n        \"fontWeight\",\n        \"fontSize\",\n        \"text\",\n        \"underline\",\n        \"overline\",\n        \"linethrough\",\n        \"textAlign\",\n        \"fontStyle\",\n        \"lineHeight\",\n        \"textBackgroundColor\",\n        \"charSpacing\",\n        \"styles\"\n      ),\n\n      /**\n       * When defined, an object is rendered via stroke and this property specifies its color.\n       * <b>Backwards incompatibility note:</b> This property was named \"strokeStyle\" until v1.1.6\n       * @type String\n       * @default\n       */\n      stroke: null,\n\n      /**\n       * Shadow object representing shadow of this shape.\n       * <b>Backwards incompatibility note:</b> This property was named \"textShadow\" (String) until v1.2.11\n       * @type fabric.Shadow\n       * @default\n       */\n      shadow: null,\n\n      /**\n       * @private\n       */\n      _fontSizeFraction: 0.222,\n\n      /**\n       * @private\n       */\n      offsets: {\n        underline: 0.1,\n        linethrough: -0.315,\n        overline: -0.88,\n      },\n\n      /**\n       * Text Line proportion to font Size (in pixels)\n       * @type Number\n       * @default\n       */\n      _fontSizeMult: 1.13,\n\n      /**\n       * additional space between characters\n       * expressed in thousands of em unit\n       * @type Number\n       * @default\n       */\n      charSpacing: 0,\n\n      /**\n       * Object containing character styles - top-level properties -> line numbers,\n       * 2nd-level properties - charater numbers\n       * @type Object\n       * @default\n       */\n      styles: null,\n\n      /**\n       * Reference to a context to measure text char or couple of chars\n       * the cacheContext of the canvas will be used or a freshly created one if the object is not on canvas\n       * once created it will be referenced on fabric._measuringContext to avoide creating a canvas for every\n       * text object created.\n       * @type {CanvasRenderingContext2D}\n       * @default\n       */\n      _measuringContext: null,\n\n      /**\n       * Baseline shift, stlyes only, keep at 0 for the main text object\n       * @type {Number}\n       * @default\n       */\n      deltaY: 0,\n\n      /**\n       * Array of properties that define a style unit (of 'styles').\n       * @type {Array}\n       * @default\n       */\n      _styleProperties: [\n        \"stroke\",\n        \"strokeWidth\",\n        \"fill\",\n        \"fontFamily\",\n        \"fontSize\",\n        \"fontWeight\",\n        \"fontStyle\",\n        \"underline\",\n        \"overline\",\n        \"linethrough\",\n        \"deltaY\",\n        \"textBackgroundColor\",\n      ],\n\n      /**\n       * contains characters bounding boxes\n       */\n      __charBounds: [],\n\n      /**\n       * use this size when measuring text. To avoid IE11 rounding errors\n       * @type {Number}\n       * @default\n       * @readonly\n       * @private\n       */\n      CACHE_FONT_SIZE: 400,\n\n      /**\n       * contains the min text width to avoid getting 0\n       * @type {Number}\n       * @default\n       */\n      MIN_TEXT_WIDTH: 2,\n\n      /**\n       * Constructor\n       * @param {String} text Text string\n       * @param {Object} [options] Options object\n       * @return {fabric.Text} thisArg\n       */\n      initialize: function (text, options) {\n        this.styles = options ? options.styles || {} : {};\n        this.text = text;\n        this.__skipDimension = true;\n        this.callSuper(\"initialize\", options);\n        this.__skipDimension = false;\n        this.initDimensions();\n        this.setCoords();\n        this.setupState({ propertySet: \"_dimensionAffectingProps\" });\n      },\n\n      /**\n       * Return a contex for measurement of text string.\n       * if created it gets stored for reuse\n       * @param {String} text Text string\n       * @param {Object} [options] Options object\n       * @return {fabric.Text} thisArg\n       */\n      getMeasuringContext: function () {\n        // if we did not return we have to measure something.\n        if (!fabric._measuringContext) {\n          fabric._measuringContext =\n            (this.canvas && this.canvas.contextCache) ||\n            fabric.util.createCanvasElement().getContext(\"2d\");\n        }\n        return fabric._measuringContext;\n      },\n\n      /**\n       * @private\n       * Divides text into lines of text and lines of graphemes.\n       */\n      _splitText: function () {\n        var newLines = this._splitTextIntoLines(this.text);\n        this.textLines = newLines.lines;\n        this._textLines = newLines.graphemeLines;\n        this._unwrappedTextLines = newLines._unwrappedLines;\n        this._text = newLines.graphemeText;\n        return newLines;\n      },\n\n      /**\n       * Initialize or update text dimensions.\n       * Updates this.width and this.height with the proper values.\n       * Does not return dimensions.\n       */\n      initDimensions: function () {\n        if (this.__skipDimension) {\n          return;\n        }\n        this._splitText();\n        this._clearCache();\n        this.width =\n          this.calcTextWidth() || this.cursorWidth || this.MIN_TEXT_WIDTH;\n        if (this.textAlign.indexOf(\"justify\") !== -1) {\n          // once text is measured we need to make space fatter to make justified text.\n          this.enlargeSpaces();\n        }\n        this.height = this.calcTextHeight();\n        this.saveState({ propertySet: \"_dimensionAffectingProps\" });\n      },\n\n      /**\n       * Enlarge space boxes and shift the others\n       */\n      enlargeSpaces: function () {\n        var diffSpace,\n          currentLineWidth,\n          numberOfSpaces,\n          accumulatedSpace,\n          line,\n          charBound,\n          spaces;\n        for (var i = 0, len = this._textLines.length; i < len; i++) {\n          if (\n            this.textAlign !== \"justify\" &&\n            (i === len - 1 || this.isEndOfWrapping(i))\n          ) {\n            continue;\n          }\n          accumulatedSpace = 0;\n          line = this._textLines[i];\n          currentLineWidth = this.getLineWidth(i);\n          if (\n            currentLineWidth < this.width &&\n            (spaces = this.textLines[i].match(this._reSpacesAndTabs))\n          ) {\n            numberOfSpaces = spaces.length;\n            diffSpace = (this.width - currentLineWidth) / numberOfSpaces;\n            for (var j = 0, jlen = line.length; j <= jlen; j++) {\n              charBound = this.__charBounds[i][j];\n              if (this._reSpaceAndTab.test(line[j])) {\n                charBound.width += diffSpace;\n                charBound.kernedWidth += diffSpace;\n                charBound.left += accumulatedSpace;\n                accumulatedSpace += diffSpace;\n              } else {\n                charBound.left += accumulatedSpace;\n              }\n            }\n          }\n        }\n      },\n\n      /**\n       * Detect if the text line is ended with an hard break\n       * text and itext do not have wrapping, return false\n       * @return {Boolean}\n       */\n      isEndOfWrapping: function (lineIndex) {\n        return lineIndex === this._textLines.length - 1;\n      },\n\n      /**\n       * Detect if a line has a linebreak and so we need to account for it when moving\n       * and counting style.\n       * It return always for text and Itext.\n       * @return Number\n       */\n      missingNewlineOffset: function () {\n        return 1;\n      },\n\n      /**\n       * Returns string representation of an instance\n       * @return {String} String representation of text object\n       */\n      toString: function () {\n        return (\n          \"#<fabric.Text (\" +\n          this.complexity() +\n          '): { \"text\": \"' +\n          this.text +\n          '\", \"fontFamily\": \"' +\n          this.fontFamily +\n          '\" }>'\n        );\n      },\n\n      /**\n       * Return the dimension and the zoom level needed to create a cache canvas\n       * big enough to host the object to be cached.\n       * @private\n       * @param {Object} dim.x width of object to be cached\n       * @param {Object} dim.y height of object to be cached\n       * @return {Object}.width width of canvas\n       * @return {Object}.height height of canvas\n       * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n       * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n       */\n      _getCacheCanvasDimensions: function () {\n        var dims = this.callSuper(\"_getCacheCanvasDimensions\");\n        var fontSize = this.fontSize;\n        dims.width += fontSize * dims.zoomX;\n        dims.height += fontSize * dims.zoomY;\n        return dims;\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _render: function (ctx) {\n        this._setTextStyles(ctx);\n        this._renderTextLinesBackground(ctx);\n        this._renderTextDecoration(ctx, \"underline\");\n        this._renderText(ctx);\n        this._renderTextDecoration(ctx, \"overline\");\n        this._renderTextDecoration(ctx, \"linethrough\");\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderText: function (ctx) {\n        if (this.paintFirst === \"stroke\") {\n          this._renderTextStroke(ctx);\n          this._renderTextFill(ctx);\n        } else {\n          this._renderTextFill(ctx);\n          this._renderTextStroke(ctx);\n        }\n      },\n\n      /**\n       * Set the font parameter of the context with the object properties or with charStyle\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {Object} [charStyle] object with font style properties\n       * @param {String} [charStyle.fontFamily] Font Family\n       * @param {Number} [charStyle.fontSize] Font size in pixels. ( without px suffix )\n       * @param {String} [charStyle.fontWeight] Font weight\n       * @param {String} [charStyle.fontStyle] Font style (italic|normal)\n       */\n      _setTextStyles: function (ctx, charStyle, forMeasuring) {\n        ctx.textBaseline = \"alphabetic\";\n        ctx.font = this._getFontDeclaration(charStyle, forMeasuring);\n      },\n\n      /**\n       * calculate and return the text Width measuring each line.\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @return {Number} Maximum width of fabric.Text object\n       */\n      calcTextWidth: function () {\n        var maxWidth = this.getLineWidth(0);\n\n        for (var i = 1, len = this._textLines.length; i < len; i++) {\n          var currentLineWidth = this.getLineWidth(i);\n          if (currentLineWidth > maxWidth) {\n            maxWidth = currentLineWidth;\n          }\n        }\n        return maxWidth;\n      },\n\n      /**\n       * @private\n       * @param {String} method Method name (\"fillText\" or \"strokeText\")\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {String} line Text to render\n       * @param {Number} left Left position of text\n       * @param {Number} top Top position of text\n       * @param {Number} lineIndex Index of a line in a text\n       */\n      _renderTextLine: function (method, ctx, line, left, top, lineIndex) {\n        this._renderChars(method, ctx, line, left, top, lineIndex);\n      },\n\n      /**\n       * Renders the text background for lines, taking care of style\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderTextLinesBackground: function (ctx) {\n        if (\n          !this.textBackgroundColor &&\n          !this.styleHas(\"textBackgroundColor\")\n        ) {\n          return;\n        }\n        var lineTopOffset = 0,\n          heightOfLine,\n          lineLeftOffset,\n          originalFill = ctx.fillStyle,\n          line,\n          lastColor,\n          leftOffset = this._getLeftOffset(),\n          topOffset = this._getTopOffset(),\n          boxStart = 0,\n          boxWidth = 0,\n          charBox,\n          currentColor;\n\n        for (var i = 0, len = this._textLines.length; i < len; i++) {\n          heightOfLine = this.getHeightOfLine(i);\n          if (\n            !this.textBackgroundColor &&\n            !this.styleHas(\"textBackgroundColor\", i)\n          ) {\n            lineTopOffset += heightOfLine;\n            continue;\n          }\n          line = this._textLines[i];\n          lineLeftOffset = this._getLineLeftOffset(i);\n          boxWidth = 0;\n          boxStart = 0;\n          lastColor = this.getValueOfPropertyAt(i, 0, \"textBackgroundColor\");\n          for (var j = 0, jlen = line.length; j < jlen; j++) {\n            charBox = this.__charBounds[i][j];\n            currentColor = this.getValueOfPropertyAt(\n              i,\n              j,\n              \"textBackgroundColor\"\n            );\n            if (currentColor !== lastColor) {\n              ctx.fillStyle = lastColor;\n              lastColor &&\n                ctx.fillRect(\n                  leftOffset + lineLeftOffset + boxStart,\n                  topOffset + lineTopOffset,\n                  boxWidth,\n                  heightOfLine / this.lineHeight\n                );\n              boxStart = charBox.left;\n              boxWidth = charBox.width;\n              lastColor = currentColor;\n            } else {\n              boxWidth += charBox.kernedWidth;\n            }\n          }\n          if (currentColor) {\n            ctx.fillStyle = currentColor;\n            ctx.fillRect(\n              leftOffset + lineLeftOffset + boxStart,\n              topOffset + lineTopOffset,\n              boxWidth,\n              heightOfLine / this.lineHeight\n            );\n          }\n          lineTopOffset += heightOfLine;\n        }\n        ctx.fillStyle = originalFill;\n        // if there is text background color no\n        // other shadows should be casted\n        this._removeShadow(ctx);\n      },\n\n      /**\n       * @private\n       * @param {Object} decl style declaration for cache\n       * @param {String} decl.fontFamily fontFamily\n       * @param {String} decl.fontStyle fontStyle\n       * @param {String} decl.fontWeight fontWeight\n       * @return {Object} reference to cache\n       */\n      getFontCache: function (decl) {\n        var fontFamily = decl.fontFamily.toLowerCase();\n        if (!fabric.charWidthsCache[fontFamily]) {\n          fabric.charWidthsCache[fontFamily] = {};\n        }\n        var cache = fabric.charWidthsCache[fontFamily],\n          cacheProp =\n            decl.fontStyle.toLowerCase() +\n            \"_\" +\n            (decl.fontWeight + \"\").toLowerCase();\n        if (!cache[cacheProp]) {\n          cache[cacheProp] = {};\n        }\n        return cache[cacheProp];\n      },\n\n      /**\n       * apply all the character style to canvas for rendering\n       * @private\n       * @param {String} _char\n       * @param {Number} lineIndex\n       * @param {Number} charIndex\n       * @param {Object} [decl]\n       */\n      _applyCharStyles: function (\n        method,\n        ctx,\n        lineIndex,\n        charIndex,\n        styleDeclaration\n      ) {\n        this._setFillStyles(ctx, styleDeclaration);\n        this._setStrokeStyles(ctx, styleDeclaration);\n\n        ctx.font = this._getFontDeclaration(styleDeclaration);\n      },\n\n      /**\n       * measure and return the width of a single character.\n       * possibly overridden to accommodate different measure logic or\n       * to hook some external lib for character measurement\n       * @private\n       * @param {String} _char, char to be measured\n       * @param {Object} charStyle style of char to be measured\n       * @param {String} [previousChar] previous char\n       * @param {Object} [prevCharStyle] style of previous char\n       */\n      _measureChar: function (_char, charStyle, previousChar, prevCharStyle) {\n        // first i try to return from cache\n        var fontCache = this.getFontCache(charStyle),\n          fontDeclaration = this._getFontDeclaration(charStyle),\n          previousFontDeclaration = this._getFontDeclaration(prevCharStyle),\n          couple = previousChar + _char,\n          stylesAreEqual = fontDeclaration === previousFontDeclaration,\n          width,\n          coupleWidth,\n          previousWidth,\n          fontMultiplier = charStyle.fontSize / this.CACHE_FONT_SIZE,\n          kernedWidth;\n\n        if (previousChar && fontCache[previousChar] !== undefined) {\n          previousWidth = fontCache[previousChar];\n        }\n        if (fontCache[_char] !== undefined) {\n          kernedWidth = width = fontCache[_char];\n        }\n        if (stylesAreEqual && fontCache[couple] !== undefined) {\n          coupleWidth = fontCache[couple];\n          kernedWidth = coupleWidth - previousWidth;\n        }\n        if (\n          width === undefined ||\n          previousWidth === undefined ||\n          coupleWidth === undefined\n        ) {\n          var ctx = this.getMeasuringContext();\n          // send a TRUE to specify measuring font size CACHE_FONT_SIZE\n          this._setTextStyles(ctx, charStyle, true);\n        }\n        if (width === undefined) {\n          kernedWidth = width = ctx.measureText(_char).width;\n          fontCache[_char] = width;\n        }\n        if (previousWidth === undefined && stylesAreEqual && previousChar) {\n          previousWidth = ctx.measureText(previousChar).width;\n          fontCache[previousChar] = previousWidth;\n        }\n        if (stylesAreEqual && coupleWidth === undefined) {\n          // we can measure the kerning couple and subtract the width of the previous character\n          coupleWidth = ctx.measureText(couple).width;\n          fontCache[couple] = coupleWidth;\n          kernedWidth = coupleWidth - previousWidth;\n        }\n        return {\n          width: width * fontMultiplier,\n          kernedWidth: kernedWidth * fontMultiplier,\n        };\n      },\n\n      /**\n       * Computes height of character at given position\n       * @param {Number} line the line index number\n       * @param {Number} _char the character index number\n       * @return {Number} fontSize of the character\n       */\n      getHeightOfChar: function (line, _char) {\n        return this.getValueOfPropertyAt(line, _char, \"fontSize\");\n      },\n\n      /**\n       * measure a text line measuring all characters.\n       * @param {Number} lineIndex line number\n       * @return {Number} Line width\n       */\n      measureLine: function (lineIndex) {\n        var lineInfo = this._measureLine(lineIndex);\n        if (this.charSpacing !== 0) {\n          lineInfo.width -= this._getWidthOfCharSpacing();\n        }\n        if (lineInfo.width < 0) {\n          lineInfo.width = 0;\n        }\n        return lineInfo;\n      },\n\n      /**\n       * measure every grapheme of a line, populating __charBounds\n       * @param {Number} lineIndex\n       * @return {Object} object.width total width of characters\n       * @return {Object} object.widthOfSpaces length of chars that match this._reSpacesAndTabs\n       */\n      _measureLine: function (lineIndex) {\n        var width = 0,\n          i,\n          grapheme,\n          line = this._textLines[lineIndex],\n          prevGrapheme,\n          graphemeInfo,\n          numOfSpaces = 0,\n          lineBounds = new Array(line.length);\n\n        this.__charBounds[lineIndex] = lineBounds;\n        for (i = 0; i < line.length; i++) {\n          grapheme = line[i];\n          graphemeInfo = this._getGraphemeBox(\n            grapheme,\n            lineIndex,\n            i,\n            prevGrapheme\n          );\n          lineBounds[i] = graphemeInfo;\n          width += graphemeInfo.kernedWidth;\n          prevGrapheme = grapheme;\n        }\n        // this latest bound box represent the last character of the line\n        // to simplify cursor handling in interactive mode.\n        lineBounds[i] = {\n          left: graphemeInfo ? graphemeInfo.left + graphemeInfo.width : 0,\n          width: 0,\n          kernedWidth: 0,\n          height: this.fontSize,\n        };\n        return { width: width, numOfSpaces: numOfSpaces };\n      },\n\n      /**\n       * Measure and return the info of a single grapheme.\n       * needs the the info of previous graphemes already filled\n       * @private\n       * @param {String} grapheme to be measured\n       * @param {Number} lineIndex index of the line where the char is\n       * @param {Number} charIndex position in the line\n       * @param {String} [prevGrapheme] character preceding the one to be measured\n       */\n      _getGraphemeBox: function (\n        grapheme,\n        lineIndex,\n        charIndex,\n        prevGrapheme,\n        skipLeft\n      ) {\n        var style = this.getCompleteStyleDeclaration(lineIndex, charIndex),\n          prevStyle = prevGrapheme\n            ? this.getCompleteStyleDeclaration(lineIndex, charIndex - 1)\n            : {},\n          info = this._measureChar(grapheme, style, prevGrapheme, prevStyle),\n          kernedWidth = info.kernedWidth,\n          width = info.width,\n          charSpacing;\n\n        if (this.charSpacing !== 0) {\n          charSpacing = this._getWidthOfCharSpacing();\n          width += charSpacing;\n          kernedWidth += charSpacing;\n        }\n\n        var box = {\n          width: width,\n          left: 0,\n          height: style.fontSize,\n          kernedWidth: kernedWidth,\n          deltaY: style.deltaY,\n        };\n        if (charIndex > 0 && !skipLeft) {\n          var previousBox = this.__charBounds[lineIndex][charIndex - 1];\n          box.left =\n            previousBox.left +\n            previousBox.width +\n            info.kernedWidth -\n            info.width;\n        }\n        return box;\n      },\n\n      /**\n       * Calculate height of line at 'lineIndex'\n       * @param {Number} lineIndex index of line to calculate\n       * @return {Number}\n       */\n      getHeightOfLine: function (lineIndex) {\n        if (this.__lineHeights[lineIndex]) {\n          return this.__lineHeights[lineIndex];\n        }\n\n        var line = this._textLines[lineIndex],\n          // char 0 is measured before the line cycle because it nneds to char\n          // emptylines\n          maxHeight = this.getHeightOfChar(lineIndex, 0);\n        for (var i = 1, len = line.length; i < len; i++) {\n          maxHeight = Math.max(this.getHeightOfChar(lineIndex, i), maxHeight);\n        }\n\n        return (this.__lineHeights[lineIndex] =\n          maxHeight * this.lineHeight * this._fontSizeMult);\n      },\n\n      /**\n       * Calculate text box height\n       */\n      calcTextHeight: function () {\n        var lineHeight,\n          height = 0;\n        for (var i = 0, len = this._textLines.length; i < len; i++) {\n          lineHeight = this.getHeightOfLine(i);\n          height += i === len - 1 ? lineHeight / this.lineHeight : lineHeight;\n        }\n        return height;\n      },\n\n      /**\n       * @private\n       * @return {Number} Left offset\n       */\n      _getLeftOffset: function () {\n        return -this.width / 2;\n      },\n\n      /**\n       * @private\n       * @return {Number} Top offset\n       */\n      _getTopOffset: function () {\n        return -this.height / 2;\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {String} method Method name (\"fillText\" or \"strokeText\")\n       */\n      _renderTextCommon: function (ctx, method) {\n        ctx.save();\n        var lineHeights = 0,\n          left = this._getLeftOffset(),\n          top = this._getTopOffset(),\n          offsets = this._applyPatternGradientTransform(\n            ctx,\n            method === \"fillText\" ? this.fill : this.stroke\n          );\n        for (var i = 0, len = this._textLines.length; i < len; i++) {\n          var heightOfLine = this.getHeightOfLine(i),\n            maxHeight = heightOfLine / this.lineHeight,\n            leftOffset = this._getLineLeftOffset(i);\n          this._renderTextLine(\n            method,\n            ctx,\n            this._textLines[i],\n            left + leftOffset - offsets.offsetX,\n            top + lineHeights + maxHeight - offsets.offsetY,\n            i\n          );\n          lineHeights += heightOfLine;\n        }\n        ctx.restore();\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderTextFill: function (ctx) {\n        if (!this.fill && !this.styleHas(\"fill\")) {\n          return;\n        }\n\n        this._renderTextCommon(ctx, \"fillText\");\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderTextStroke: function (ctx) {\n        if ((!this.stroke || this.strokeWidth === 0) && this.isEmptyStyles()) {\n          return;\n        }\n\n        if (this.shadow && !this.shadow.affectStroke) {\n          this._removeShadow(ctx);\n        }\n\n        ctx.save();\n        this._setLineDash(ctx, this.strokeDashArray);\n        ctx.beginPath();\n        this._renderTextCommon(ctx, \"strokeText\");\n        ctx.closePath();\n        ctx.restore();\n      },\n\n      /**\n       * @private\n       * @param {String} method\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {String} line Content of the line\n       * @param {Number} left\n       * @param {Number} top\n       * @param {Number} lineIndex\n       * @param {Number} charOffset\n       */\n      _renderChars: function (method, ctx, line, left, top, lineIndex) {\n        // set proper line offset\n        var lineHeight = this.getHeightOfLine(lineIndex),\n          isJustify = this.textAlign.indexOf(\"justify\") !== -1,\n          actualStyle,\n          nextStyle,\n          charsToRender = \"\",\n          charBox,\n          boxWidth = 0,\n          timeToRender,\n          shortCut =\n            !isJustify &&\n            this.charSpacing === 0 &&\n            this.isEmptyStyles(lineIndex);\n\n        ctx.save();\n        top -= (lineHeight * this._fontSizeFraction) / this.lineHeight;\n        if (shortCut) {\n          // render all the line in one pass without checking\n          this._renderChar(\n            method,\n            ctx,\n            lineIndex,\n            0,\n            this.textLines[lineIndex],\n            left,\n            top,\n            lineHeight\n          );\n          ctx.restore();\n          return;\n        }\n        for (var i = 0, len = line.length - 1; i <= len; i++) {\n          timeToRender = i === len || this.charSpacing;\n          charsToRender += line[i];\n          charBox = this.__charBounds[lineIndex][i];\n          if (boxWidth === 0) {\n            left += charBox.kernedWidth - charBox.width;\n            boxWidth += charBox.width;\n          } else {\n            boxWidth += charBox.kernedWidth;\n          }\n          if (isJustify && !timeToRender) {\n            if (this._reSpaceAndTab.test(line[i])) {\n              timeToRender = true;\n            }\n          }\n          if (!timeToRender) {\n            // if we have charSpacing, we render char by char\n            actualStyle =\n              actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\n            nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\n            timeToRender = this._hasStyleChanged(actualStyle, nextStyle);\n          }\n          if (timeToRender) {\n            this._renderChar(\n              method,\n              ctx,\n              lineIndex,\n              i,\n              charsToRender,\n              left,\n              top,\n              lineHeight\n            );\n            charsToRender = \"\";\n            actualStyle = nextStyle;\n            left += boxWidth;\n            boxWidth = 0;\n          }\n        }\n        ctx.restore();\n      },\n\n      /**\n       * @private\n       * @param {String} method\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       * @param {Number} lineIndex\n       * @param {Number} charIndex\n       * @param {String} _char\n       * @param {Number} left Left coordinate\n       * @param {Number} top Top coordinate\n       * @param {Number} lineHeight Height of the line\n       */\n      _renderChar: function (\n        method,\n        ctx,\n        lineIndex,\n        charIndex,\n        _char,\n        left,\n        top\n      ) {\n        var decl = this._getStyleDeclaration(lineIndex, charIndex),\n          fullDecl = this.getCompleteStyleDeclaration(lineIndex, charIndex),\n          shouldFill = method === \"fillText\" && fullDecl.fill,\n          shouldStroke =\n            method === \"strokeText\" && fullDecl.stroke && fullDecl.strokeWidth;\n\n        if (!shouldStroke && !shouldFill) {\n          return;\n        }\n        decl && ctx.save();\n\n        this._applyCharStyles(method, ctx, lineIndex, charIndex, fullDecl);\n\n        if (decl && decl.textBackgroundColor) {\n          this._removeShadow(ctx);\n        }\n        if (decl && decl.deltaY) {\n          top += decl.deltaY;\n        }\n\n        shouldFill && ctx.fillText(_char, left, top);\n        shouldStroke && ctx.strokeText(_char, left, top);\n        decl && ctx.restore();\n      },\n\n      /**\n       * Turns the character into a 'superior figure' (i.e. 'superscript')\n       * @param {Number} start selection start\n       * @param {Number} end selection end\n       * @returns {fabric.Text} thisArg\n       * @chainable\n       */\n      setSuperscript: function (start, end) {\n        return this._setScript(start, end, this.superscript);\n      },\n\n      /**\n       * Turns the character into an 'inferior figure' (i.e. 'subscript')\n       * @param {Number} start selection start\n       * @param {Number} end selection end\n       * @returns {fabric.Text} thisArg\n       * @chainable\n       */\n      setSubscript: function (start, end) {\n        return this._setScript(start, end, this.subscript);\n      },\n\n      /**\n       * Applies 'schema' at given position\n       * @private\n       * @param {Number} start selection start\n       * @param {Number} end selection end\n       * @param {Number} schema\n       * @returns {fabric.Text} thisArg\n       * @chainable\n       */\n      _setScript: function (start, end, schema) {\n        var loc = this.get2DCursorLocation(start, true),\n          fontSize = this.getValueOfPropertyAt(\n            loc.lineIndex,\n            loc.charIndex,\n            \"fontSize\"\n          ),\n          dy = this.getValueOfPropertyAt(\n            loc.lineIndex,\n            loc.charIndex,\n            \"deltaY\"\n          ),\n          style = {\n            fontSize: fontSize * schema.size,\n            deltaY: dy + fontSize * schema.baseline,\n          };\n        this.setSelectionStyles(style, start, end);\n        return this;\n      },\n\n      /**\n       * @private\n       * @param {Object} prevStyle\n       * @param {Object} thisStyle\n       */\n      _hasStyleChanged: function (prevStyle, thisStyle) {\n        return (\n          prevStyle.fill !== thisStyle.fill ||\n          prevStyle.stroke !== thisStyle.stroke ||\n          prevStyle.strokeWidth !== thisStyle.strokeWidth ||\n          prevStyle.fontSize !== thisStyle.fontSize ||\n          prevStyle.fontFamily !== thisStyle.fontFamily ||\n          prevStyle.fontWeight !== thisStyle.fontWeight ||\n          prevStyle.fontStyle !== thisStyle.fontStyle ||\n          prevStyle.deltaY !== thisStyle.deltaY\n        );\n      },\n\n      /**\n       * @private\n       * @param {Object} prevStyle\n       * @param {Object} thisStyle\n       */\n      _hasStyleChangedForSvg: function (prevStyle, thisStyle) {\n        return (\n          this._hasStyleChanged(prevStyle, thisStyle) ||\n          prevStyle.overline !== thisStyle.overline ||\n          prevStyle.underline !== thisStyle.underline ||\n          prevStyle.linethrough !== thisStyle.linethrough\n        );\n      },\n\n      /**\n       * @private\n       * @param {Number} lineIndex index text line\n       * @return {Number} Line left offset\n       */\n      _getLineLeftOffset: function (lineIndex) {\n        var lineWidth = this.getLineWidth(lineIndex);\n        if (this.textAlign === \"center\") {\n          return (this.width - lineWidth) / 2;\n        }\n        if (this.textAlign === \"right\") {\n          return this.width - lineWidth;\n        }\n        if (\n          this.textAlign === \"justify-center\" &&\n          this.isEndOfWrapping(lineIndex)\n        ) {\n          return (this.width - lineWidth) / 2;\n        }\n        if (\n          this.textAlign === \"justify-right\" &&\n          this.isEndOfWrapping(lineIndex)\n        ) {\n          return this.width - lineWidth;\n        }\n        return 0;\n      },\n\n      /**\n       * @private\n       */\n      _clearCache: function () {\n        this.__lineWidths = [];\n        this.__lineHeights = [];\n        this.__charBounds = [];\n      },\n\n      /**\n       * @private\n       */\n      _shouldClearDimensionCache: function () {\n        var shouldClear = this._forceClearCache;\n        shouldClear ||\n          (shouldClear = this.hasStateChanged(\"_dimensionAffectingProps\"));\n        if (shouldClear) {\n          this.dirty = true;\n          this._forceClearCache = false;\n        }\n        return shouldClear;\n      },\n\n      /**\n       * Measure a single line given its index. Used to calculate the initial\n       * text bounding box. The values are calculated and stored in __lineWidths cache.\n       * @private\n       * @param {Number} lineIndex line number\n       * @return {Number} Line width\n       */\n      getLineWidth: function (lineIndex) {\n        if (this.__lineWidths[lineIndex]) {\n          return this.__lineWidths[lineIndex];\n        }\n\n        var width,\n          line = this._textLines[lineIndex],\n          lineInfo;\n\n        if (line === \"\") {\n          width = 0;\n        } else {\n          lineInfo = this.measureLine(lineIndex);\n          width = lineInfo.width;\n        }\n        this.__lineWidths[lineIndex] = width;\n        return width;\n      },\n\n      _getWidthOfCharSpacing: function () {\n        if (this.charSpacing !== 0) {\n          return (this.fontSize * this.charSpacing) / 1000;\n        }\n        return 0;\n      },\n\n      /**\n       * Retrieves the value of property at given character position\n       * @param {Number} lineIndex the line number\n       * @param {Number} charIndex the charater number\n       * @param {String} property the property name\n       * @returns the value of 'property'\n       */\n      getValueOfPropertyAt: function (lineIndex, charIndex, property) {\n        var charStyle = this._getStyleDeclaration(lineIndex, charIndex);\n        if (charStyle && typeof charStyle[property] !== \"undefined\") {\n          return charStyle[property];\n        }\n        return this[property];\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _renderTextDecoration: function (ctx, type) {\n        if (!this[type] && !this.styleHas(type)) {\n          return;\n        }\n        var heightOfLine,\n          size,\n          _size,\n          lineLeftOffset,\n          dy,\n          _dy,\n          line,\n          lastDecoration,\n          leftOffset = this._getLeftOffset(),\n          topOffset = this._getTopOffset(),\n          top,\n          boxStart,\n          boxWidth,\n          charBox,\n          currentDecoration,\n          maxHeight,\n          currentFill,\n          lastFill,\n          charSpacing = this._getWidthOfCharSpacing();\n\n        for (var i = 0, len = this._textLines.length; i < len; i++) {\n          heightOfLine = this.getHeightOfLine(i);\n          if (!this[type] && !this.styleHas(type, i)) {\n            topOffset += heightOfLine;\n            continue;\n          }\n          line = this._textLines[i];\n          maxHeight = heightOfLine / this.lineHeight;\n          lineLeftOffset = this._getLineLeftOffset(i);\n          boxStart = 0;\n          boxWidth = 0;\n          lastDecoration = this.getValueOfPropertyAt(i, 0, type);\n          lastFill = this.getValueOfPropertyAt(i, 0, \"fill\");\n          top = topOffset + maxHeight * (1 - this._fontSizeFraction);\n          size = this.getHeightOfChar(i, 0);\n          dy = this.getValueOfPropertyAt(i, 0, \"deltaY\");\n          for (var j = 0, jlen = line.length; j < jlen; j++) {\n            charBox = this.__charBounds[i][j];\n            currentDecoration = this.getValueOfPropertyAt(i, j, type);\n            currentFill = this.getValueOfPropertyAt(i, j, \"fill\");\n            _size = this.getHeightOfChar(i, j);\n            _dy = this.getValueOfPropertyAt(i, j, \"deltaY\");\n            if (\n              (currentDecoration !== lastDecoration ||\n                currentFill !== lastFill ||\n                _size !== size ||\n                _dy !== dy) &&\n              boxWidth > 0\n            ) {\n              ctx.fillStyle = lastFill;\n              lastDecoration &&\n                lastFill &&\n                ctx.fillRect(\n                  leftOffset + lineLeftOffset + boxStart,\n                  top + this.offsets[type] * size + dy,\n                  boxWidth,\n                  this.fontSize / 15\n                );\n              boxStart = charBox.left;\n              boxWidth = charBox.width;\n              lastDecoration = currentDecoration;\n              lastFill = currentFill;\n              size = _size;\n              dy = _dy;\n            } else {\n              boxWidth += charBox.kernedWidth;\n            }\n          }\n          ctx.fillStyle = currentFill;\n          currentDecoration &&\n            currentFill &&\n            ctx.fillRect(\n              leftOffset + lineLeftOffset + boxStart,\n              top + this.offsets[type] * size + dy,\n              boxWidth - charSpacing,\n              this.fontSize / 15\n            );\n          topOffset += heightOfLine;\n        }\n        // if there is text background color no\n        // other shadows should be casted\n        this._removeShadow(ctx);\n      },\n\n      /**\n       * return font declaration string for canvas context\n       * @param {Object} [styleObject] object\n       * @returns {String} font declaration formatted for canvas context.\n       */\n      _getFontDeclaration: function (styleObject, forMeasuring) {\n        var style = styleObject || this,\n          family = this.fontFamily,\n          fontIsGeneric =\n            fabric.Text.genericFonts.indexOf(family.toLowerCase()) > -1;\n        var fontFamily =\n          family === undefined ||\n          family.indexOf(\"'\") > -1 ||\n          family.indexOf(\",\") > -1 ||\n          family.indexOf('\"') > -1 ||\n          fontIsGeneric\n            ? style.fontFamily\n            : '\"' + style.fontFamily + '\"';\n        return [\n          // node-canvas needs \"weight style\", while browsers need \"style weight\"\n          // verify if this can be fixed in JSDOM\n          fabric.isLikelyNode ? style.fontWeight : style.fontStyle,\n          fabric.isLikelyNode ? style.fontStyle : style.fontWeight,\n          forMeasuring ? this.CACHE_FONT_SIZE + \"px\" : style.fontSize + \"px\",\n          fontFamily,\n        ].join(\" \");\n      },\n\n      /**\n       * Renders text instance on a specified context\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      render: function (ctx) {\n        // do not render if object is not visible\n        if (!this.visible) {\n          return;\n        }\n        if (\n          this.canvas &&\n          this.canvas.skipOffscreen &&\n          !this.group &&\n          !this.isOnScreen()\n        ) {\n          return;\n        }\n        if (this._shouldClearDimensionCache()) {\n          this.initDimensions();\n        }\n        this.callSuper(\"render\", ctx);\n      },\n\n      /**\n       * Returns the text as an array of lines.\n       * @param {String} text text to split\n       * @returns {Array} Lines in the text\n       */\n      _splitTextIntoLines: function (text) {\n        var lines = text.split(this._reNewline),\n          newLines = new Array(lines.length),\n          newLine = [\"\\n\"],\n          newText = [];\n        for (var i = 0; i < lines.length; i++) {\n          newLines[i] = fabric.util.string.graphemeSplit(lines[i]);\n          newText = newText.concat(newLines[i], newLine);\n        }\n        newText.pop();\n        return {\n          _unwrappedLines: newLines,\n          lines: lines,\n          graphemeText: newText,\n          graphemeLines: newLines,\n        };\n      },\n\n      /**\n       * Returns object representation of an instance\n       * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n       * @return {Object} Object representation of an instance\n       */\n      toObject: function (propertiesToInclude) {\n        var additionalProperties = [\n          \"text\",\n          \"fontSize\",\n          \"fontWeight\",\n          \"fontFamily\",\n          \"fontStyle\",\n          \"lineHeight\",\n          \"underline\",\n          \"overline\",\n          \"linethrough\",\n          \"textAlign\",\n          \"textBackgroundColor\",\n          \"charSpacing\",\n        ].concat(propertiesToInclude);\n        var obj = this.callSuper(\"toObject\", additionalProperties);\n        obj.styles = clone(this.styles, true);\n        return obj;\n      },\n\n      /**\n       * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n       * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n       * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n       * @return {fabric.Object} thisArg\n       * @chainable\n       */\n      set: function (key, value) {\n        this.callSuper(\"set\", key, value);\n        var needsDims = false;\n        if (typeof key === \"object\") {\n          for (var _key in key) {\n            needsDims =\n              needsDims || this._dimensionAffectingProps.indexOf(_key) !== -1;\n          }\n        } else {\n          needsDims = this._dimensionAffectingProps.indexOf(key) !== -1;\n        }\n        if (needsDims) {\n          this.initDimensions();\n          this.setCoords();\n        }\n        return this;\n      },\n\n      /**\n       * Returns complexity of an instance\n       * @return {Number} complexity\n       */\n      complexity: function () {\n        return 1;\n      },\n    }\n  );\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Text.fromElement})\n   * @static\n   * @memberOf fabric.Text\n   * @see: http://www.w3.org/TR/SVG/text.html#TextElement\n   */\n  fabric.Text.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\n    \"x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor\".split(\n      \" \"\n    )\n  );\n\n  /**\n   * Default SVG font size\n   * @static\n   * @memberOf fabric.Text\n   */\n  fabric.Text.DEFAULT_SVG_FONT_SIZE = 16;\n\n  /**\n   * Returns fabric.Text instance from an SVG element (<b>not yet implemented</b>)\n   * @static\n   * @memberOf fabric.Text\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Text.fromElement = function (element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n\n    var parsedAttributes = fabric.parseAttributes(\n        element,\n        fabric.Text.ATTRIBUTE_NAMES\n      ),\n      parsedAnchor = parsedAttributes.textAnchor || \"left\";\n    options = fabric.util.object.extend(\n      options ? clone(options) : {},\n      parsedAttributes\n    );\n\n    options.top = options.top || 0;\n    options.left = options.left || 0;\n    if (parsedAttributes.textDecoration) {\n      var textDecoration = parsedAttributes.textDecoration;\n      if (textDecoration.indexOf(\"underline\") !== -1) {\n        options.underline = true;\n      }\n      if (textDecoration.indexOf(\"overline\") !== -1) {\n        options.overline = true;\n      }\n      if (textDecoration.indexOf(\"line-through\") !== -1) {\n        options.linethrough = true;\n      }\n      delete options.textDecoration;\n    }\n    if (\"dx\" in parsedAttributes) {\n      options.left += parsedAttributes.dx;\n    }\n    if (\"dy\" in parsedAttributes) {\n      options.top += parsedAttributes.dy;\n    }\n    if (!(\"fontSize\" in options)) {\n      options.fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n    }\n\n    var textContent = \"\";\n\n    // The XML is not properly parsed in IE9 so a workaround to get\n    // textContent is through firstChild.data. Another workaround would be\n    // to convert XML loaded from a file to be converted using DOMParser (same way loadSVGFromString() does)\n    if (!(\"textContent\" in element)) {\n      if (\"firstChild\" in element && element.firstChild !== null) {\n        if (\"data\" in element.firstChild && element.firstChild.data !== null) {\n          textContent = element.firstChild.data;\n        }\n      }\n    } else {\n      textContent = element.textContent;\n    }\n\n    textContent = textContent\n      .replace(/^\\s+|\\s+$|\\n+/g, \"\")\n      .replace(/\\s+/g, \" \");\n    var originalStrokeWidth = options.strokeWidth;\n    options.strokeWidth = 0;\n\n    var text = new fabric.Text(textContent, options),\n      textHeightScaleFactor = text.getScaledHeight() / text.height,\n      lineHeightDiff =\n        (text.height + text.strokeWidth) * text.lineHeight - text.height,\n      scaledDiff = lineHeightDiff * textHeightScaleFactor,\n      textHeight = text.getScaledHeight() + scaledDiff,\n      offX = 0;\n    /*\n          Adjust positioning:\n            x/y attributes in SVG correspond to the bottom-left corner of text bounding box\n            fabric output by default at top, left.\n        */\n    if (parsedAnchor === \"center\") {\n      offX = text.getScaledWidth() / 2;\n    }\n    if (parsedAnchor === \"right\") {\n      offX = text.getScaledWidth();\n    }\n    text.set({\n      left: text.left - offX,\n      top:\n        text.top -\n        (textHeight - text.fontSize * (0.07 + text._fontSizeFraction)) /\n          text.lineHeight,\n      strokeWidth:\n        typeof originalStrokeWidth !== \"undefined\" ? originalStrokeWidth : 1,\n    });\n    callback(text);\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Text instance from an object representation\n   * @static\n   * @memberOf fabric.Text\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Text instance is created\n   */\n  fabric.Text.fromObject = function (object, callback) {\n    return fabric.Object._fromObject(\"Text\", object, callback, \"text\");\n  };\n\n  fabric.Text.genericFonts = [\n    \"sans-serif\",\n    \"serif\",\n    \"cursive\",\n    \"fantasy\",\n    \"monospace\",\n  ];\n\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Text);\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function () {\n  fabric.util.object.extend(\n    fabric.Text.prototype,\n    /** @lends fabric.Text.prototype */ {\n      /**\n       * Returns true if object has no styling or no styling in a line\n       * @param {Number} lineIndex , lineIndex is on wrapped lines.\n       * @return {Boolean}\n       */\n      isEmptyStyles: function (lineIndex) {\n        if (!this.styles) {\n          return true;\n        }\n        if (typeof lineIndex !== \"undefined\" && !this.styles[lineIndex]) {\n          return true;\n        }\n        var obj =\n          typeof lineIndex === \"undefined\"\n            ? this.styles\n            : { line: this.styles[lineIndex] };\n        for (var p1 in obj) {\n          for (var p2 in obj[p1]) {\n            // eslint-disable-next-line no-unused-vars\n            for (var p3 in obj[p1][p2]) {\n              return false;\n            }\n          }\n        }\n        return true;\n      },\n\n      /**\n       * Returns true if object has a style property or has it ina specified line\n       * This function is used to detect if a text will use a particular property or not.\n       * @param {String} property to check for\n       * @param {Number} lineIndex to check the style on\n       * @return {Boolean}\n       */\n      styleHas: function (property, lineIndex) {\n        if (!this.styles || !property || property === \"\") {\n          return false;\n        }\n        if (typeof lineIndex !== \"undefined\" && !this.styles[lineIndex]) {\n          return false;\n        }\n        var obj =\n          typeof lineIndex === \"undefined\"\n            ? this.styles\n            : { 0: this.styles[lineIndex] };\n        // eslint-disable-next-line\n        for (var p1 in obj) {\n          // eslint-disable-next-line\n          for (var p2 in obj[p1]) {\n            if (typeof obj[p1][p2][property] !== \"undefined\") {\n              return true;\n            }\n          }\n        }\n        return false;\n      },\n\n      /**\n       * Check if characters in a text have a value for a property\n       * whose value matches the textbox's value for that property.  If so,\n       * the character-level property is deleted.  If the character\n       * has no other properties, then it is also deleted.  Finally,\n       * if the line containing that character has no other characters\n       * then it also is deleted.\n       *\n       * @param {string} property The property to compare between characters and text.\n       */\n      cleanStyle: function (property) {\n        if (!this.styles || !property || property === \"\") {\n          return false;\n        }\n        var obj = this.styles,\n          stylesCount = 0,\n          letterCount,\n          stylePropertyValue,\n          allStyleObjectPropertiesMatch = true,\n          graphemeCount = 0,\n          styleObject;\n        // eslint-disable-next-line\n        for (var p1 in obj) {\n          letterCount = 0;\n          // eslint-disable-next-line\n          for (var p2 in obj[p1]) {\n            var styleObject = obj[p1][p2],\n              stylePropertyHasBeenSet = styleObject.hasOwnProperty(property);\n\n            stylesCount++;\n\n            if (stylePropertyHasBeenSet) {\n              if (!stylePropertyValue) {\n                stylePropertyValue = styleObject[property];\n              } else if (styleObject[property] !== stylePropertyValue) {\n                allStyleObjectPropertiesMatch = false;\n              }\n\n              if (styleObject[property] === this[property]) {\n                delete styleObject[property];\n              }\n            } else {\n              allStyleObjectPropertiesMatch = false;\n            }\n\n            if (Object.keys(styleObject).length !== 0) {\n              letterCount++;\n            } else {\n              delete obj[p1][p2];\n            }\n          }\n\n          if (letterCount === 0) {\n            delete obj[p1];\n          }\n        }\n        // if every grapheme has the same style set then\n        // delete those styles and set it on the parent\n        for (var i = 0; i < this._textLines.length; i++) {\n          graphemeCount += this._textLines[i].length;\n        }\n        if (allStyleObjectPropertiesMatch && stylesCount === graphemeCount) {\n          this[property] = stylePropertyValue;\n          this.removeStyle(property);\n        }\n      },\n\n      /**\n       * Remove a style property or properties from all individual character styles\n       * in a text object.  Deletes the character style object if it contains no other style\n       * props.  Deletes a line style object if it contains no other character styles.\n       *\n       * @param {String} props The property to remove from character styles.\n       */\n      removeStyle: function (property) {\n        if (!this.styles || !property || property === \"\") {\n          return;\n        }\n        var obj = this.styles,\n          line,\n          lineNum,\n          charNum;\n        for (lineNum in obj) {\n          line = obj[lineNum];\n          for (charNum in line) {\n            delete line[charNum][property];\n            if (Object.keys(line[charNum]).length === 0) {\n              delete line[charNum];\n            }\n          }\n          if (Object.keys(line).length === 0) {\n            delete obj[lineNum];\n          }\n        }\n      },\n\n      /**\n       * @private\n       */\n      _extendStyles: function (index, styles) {\n        var loc = this.get2DCursorLocation(index);\n\n        if (!this._getLineStyle(loc.lineIndex)) {\n          this._setLineStyle(loc.lineIndex);\n        }\n\n        if (!this._getStyleDeclaration(loc.lineIndex, loc.charIndex)) {\n          this._setStyleDeclaration(loc.lineIndex, loc.charIndex, {});\n        }\n\n        fabric.util.object.extend(\n          this._getStyleDeclaration(loc.lineIndex, loc.charIndex),\n          styles\n        );\n      },\n\n      /**\n       * Returns 2d representation (lineIndex and charIndex) of cursor (or selection start)\n       * @param {Number} [selectionStart] Optional index. When not given, current selectionStart is used.\n       * @param {Boolean} [skipWrapping] consider the location for unwrapped lines. useful to manage styles.\n       */\n      get2DCursorLocation: function (selectionStart, skipWrapping) {\n        if (typeof selectionStart === \"undefined\") {\n          selectionStart = this.selectionStart;\n        }\n        var lines = skipWrapping ? this._unwrappedTextLines : this._textLines,\n          len = lines.length;\n        for (var i = 0; i < len; i++) {\n          if (selectionStart <= lines[i].length) {\n            return {\n              lineIndex: i,\n              charIndex: selectionStart,\n            };\n          }\n          selectionStart -= lines[i].length + this.missingNewlineOffset(i);\n        }\n        return {\n          lineIndex: i - 1,\n          charIndex:\n            lines[i - 1].length < selectionStart\n              ? lines[i - 1].length\n              : selectionStart,\n        };\n      },\n\n      /**\n       * Gets style of a current selection/cursor (at the start position)\n       * if startIndex or endIndex are not provided, slectionStart or selectionEnd will be used.\n       * @param {Number} [startIndex] Start index to get styles at\n       * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n       * @param {Boolean} [complete] get full style or not\n       * @return {Array} styles an array with one, zero or more Style objects\n       */\n      getSelectionStyles: function (startIndex, endIndex, complete) {\n        if (typeof startIndex === \"undefined\") {\n          startIndex = this.selectionStart || 0;\n        }\n        if (typeof endIndex === \"undefined\") {\n          endIndex = this.selectionEnd || startIndex;\n        }\n        var styles = [];\n        for (var i = startIndex; i < endIndex; i++) {\n          styles.push(this.getStyleAtPosition(i, complete));\n        }\n        return styles;\n      },\n\n      /**\n       * Gets style of a current selection/cursor position\n       * @param {Number} position  to get styles at\n       * @param {Boolean} [complete] full style if true\n       * @return {Object} style Style object at a specified index\n       * @private\n       */\n      getStyleAtPosition: function (position, complete) {\n        var loc = this.get2DCursorLocation(position),\n          style = complete\n            ? this.getCompleteStyleDeclaration(loc.lineIndex, loc.charIndex)\n            : this._getStyleDeclaration(loc.lineIndex, loc.charIndex);\n        return style || {};\n      },\n\n      /**\n       * Sets style of a current selection, if no selection exist, do not set anything.\n       * @param {Object} [styles] Styles object\n       * @param {Number} [startIndex] Start index to get styles at\n       * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n       * @return {fabric.IText} thisArg\n       * @chainable\n       */\n      setSelectionStyles: function (styles, startIndex, endIndex) {\n        if (typeof startIndex === \"undefined\") {\n          startIndex = this.selectionStart || 0;\n        }\n        if (typeof endIndex === \"undefined\") {\n          endIndex = this.selectionEnd || startIndex;\n        }\n        for (var i = startIndex; i < endIndex; i++) {\n          this._extendStyles(i, styles);\n        }\n        /* not included in _extendStyles to avoid clearing cache more than once */\n        this._forceClearCache = true;\n        return this;\n      },\n\n      /**\n       * get the reference, not a clone, of the style object for a given character\n       * @param {Number} lineIndex\n       * @param {Number} charIndex\n       * @return {Object} style object\n       */\n      _getStyleDeclaration: function (lineIndex, charIndex) {\n        var lineStyle = this.styles && this.styles[lineIndex];\n        if (!lineStyle) {\n          return null;\n        }\n        return lineStyle[charIndex];\n      },\n\n      /**\n       * return a new object that contains all the style property for a character\n       * the object returned is newly created\n       * @param {Number} lineIndex of the line where the character is\n       * @param {Number} charIndex position of the character on the line\n       * @return {Object} style object\n       */\n      getCompleteStyleDeclaration: function (lineIndex, charIndex) {\n        var style = this._getStyleDeclaration(lineIndex, charIndex) || {},\n          styleObject = {},\n          prop;\n        for (var i = 0; i < this._styleProperties.length; i++) {\n          prop = this._styleProperties[i];\n          styleObject[prop] =\n            typeof style[prop] === \"undefined\" ? this[prop] : style[prop];\n        }\n        return styleObject;\n      },\n\n      /**\n       * @param {Number} lineIndex\n       * @param {Number} charIndex\n       * @param {Object} style\n       * @private\n       */\n      _setStyleDeclaration: function (lineIndex, charIndex, style) {\n        this.styles[lineIndex][charIndex] = style;\n      },\n\n      /**\n       *\n       * @param {Number} lineIndex\n       * @param {Number} charIndex\n       * @private\n       */\n      _deleteStyleDeclaration: function (lineIndex, charIndex) {\n        delete this.styles[lineIndex][charIndex];\n      },\n\n      /**\n       * @param {Number} lineIndex\n       * @return {Boolean} if the line exists or not\n       * @private\n       */\n      _getLineStyle: function (lineIndex) {\n        return !!this.styles[lineIndex];\n      },\n\n      /**\n       * Set the line style to an empty object so that is initialized\n       * @param {Number} lineIndex\n       * @private\n       */\n      _setLineStyle: function (lineIndex) {\n        this.styles[lineIndex] = {};\n      },\n\n      /**\n       * @param {Number} lineIndex\n       * @private\n       */\n      _deleteLineStyle: function (lineIndex) {\n        delete this.styles[lineIndex];\n      },\n    }\n  );\n})();\n\n(function () {\n  function parseDecoration(object) {\n    if (object.textDecoration) {\n      object.textDecoration.indexOf(\"underline\") > -1 &&\n        (object.underline = true);\n      object.textDecoration.indexOf(\"line-through\") > -1 &&\n        (object.linethrough = true);\n      object.textDecoration.indexOf(\"overline\") > -1 &&\n        (object.overline = true);\n      delete object.textDecoration;\n    }\n  }\n\n  /**\n   * IText class (introduced in <b>v1.4</b>) Events are also fired with \"text:\"\n   * prefix when observing canvas.\n   * @class fabric.IText\n   * @extends fabric.Text\n   * @mixes fabric.Observable\n   *\n   * @fires changed\n   * @fires selection:changed\n   * @fires editing:entered\n   * @fires editing:exited\n   *\n   * @return {fabric.IText} thisArg\n   * @see {@link fabric.IText#initialize} for constructor definition\n   *\n   * <p>Supported key combinations:</p>\n   * <pre>\n   *   Move cursor:                    left, right, up, down\n   *   Select character:               shift + left, shift + right\n   *   Select text vertically:         shift + up, shift + down\n   *   Move cursor by word:            alt + left, alt + right\n   *   Select words:                   shift + alt + left, shift + alt + right\n   *   Move cursor to line start/end:  cmd + left, cmd + right or home, end\n   *   Select till start/end of line:  cmd + shift + left, cmd + shift + right or shift + home, shift + end\n   *   Jump to start/end of text:      cmd + up, cmd + down\n   *   Select till start/end of text:  cmd + shift + up, cmd + shift + down or shift + pgUp, shift + pgDown\n   *   Delete character:               backspace\n   *   Delete word:                    alt + backspace\n   *   Delete line:                    cmd + backspace\n   *   Forward delete:                 delete\n   *   Copy text:                      ctrl/cmd + c\n   *   Paste text:                     ctrl/cmd + v\n   *   Cut text:                       ctrl/cmd + x\n   *   Select entire text:             ctrl/cmd + a\n   *   Quit editing                    tab or esc\n   * </pre>\n   *\n   * <p>Supported mouse/touch combination</p>\n   * <pre>\n   *   Position cursor:                click/touch\n   *   Create selection:               click/touch & drag\n   *   Create selection:               click & shift + click\n   *   Select word:                    double click\n   *   Select line:                    triple click\n   * </pre>\n   */\n  fabric.IText = fabric.util.createClass(\n    fabric.Text,\n    fabric.Observable,\n    /** @lends fabric.IText.prototype */ {\n      /**\n       * Type of an object\n       * @type String\n       * @default\n       */\n      type: \"i-text\",\n\n      /**\n       * Index where text selection starts (or where cursor is when there is no selection)\n       * @type Number\n       * @default\n       */\n      selectionStart: 0,\n\n      /**\n       * Index where text selection ends\n       * @type Number\n       * @default\n       */\n      selectionEnd: 0,\n\n      /**\n       * Color of text selection\n       * @type String\n       * @default\n       */\n      selectionColor: \"rgba(17,119,255,0.3)\",\n\n      /**\n       * Indicates whether text is in editing mode\n       * @type Boolean\n       * @default\n       */\n      isEditing: false,\n\n      /**\n       * Indicates whether a text can be edited\n       * @type Boolean\n       * @default\n       */\n      editable: true,\n\n      /**\n       * Border color of text object while it's in editing mode\n       * @type String\n       * @default\n       */\n      editingBorderColor: \"rgba(102,153,255,0.25)\",\n\n      /**\n       * Width of cursor (in px)\n       * @type Number\n       * @default\n       */\n      cursorWidth: 2,\n\n      /**\n       * Color of text cursor color in editing mode.\n       * if not set (default) will take color from the text.\n       * if set to a color value that fabric can understand, it will\n       * be used instead of the color of the text at the current position.\n       * @type String\n       * @default\n       */\n      cursorColor: \"\",\n\n      /**\n       * Delay between cursor blink (in ms)\n       * @type Number\n       * @default\n       */\n      cursorDelay: 1000,\n\n      /**\n       * Duration of cursor fadein (in ms)\n       * @type Number\n       * @default\n       */\n      cursorDuration: 600,\n\n      /**\n       * Indicates whether internal text char widths can be cached\n       * @type Boolean\n       * @default\n       */\n      caching: true,\n\n      /**\n       * @private\n       */\n      _reSpace: /\\s|\\n/,\n\n      /**\n       * @private\n       */\n      _currentCursorOpacity: 0,\n\n      /**\n       * @private\n       */\n      _selectionDirection: null,\n\n      /**\n       * @private\n       */\n      _abortCursorAnimation: false,\n\n      /**\n       * @private\n       */\n      __widthOfSpace: [],\n\n      /**\n       * Helps determining when the text is in composition, so that the cursor\n       * rendering is altered.\n       */\n      inCompositionMode: false,\n\n      /**\n       * Constructor\n       * @param {String} text Text string\n       * @param {Object} [options] Options object\n       * @return {fabric.IText} thisArg\n       */\n      initialize: function (text, options) {\n        this.callSuper(\"initialize\", text, options);\n        this.initBehavior();\n      },\n\n      /**\n       * Sets selection start (left boundary of a selection)\n       * @param {Number} index Index to set selection start to\n       */\n      setSelectionStart: function (index) {\n        index = Math.max(index, 0);\n        this._updateAndFire(\"selectionStart\", index);\n      },\n\n      /**\n       * Sets selection end (right boundary of a selection)\n       * @param {Number} index Index to set selection end to\n       */\n      setSelectionEnd: function (index) {\n        index = Math.min(index, this.text.length);\n        this._updateAndFire(\"selectionEnd\", index);\n      },\n\n      /**\n       * @private\n       * @param {String} property 'selectionStart' or 'selectionEnd'\n       * @param {Number} index new position of property\n       */\n      _updateAndFire: function (property, index) {\n        if (this[property] !== index) {\n          this._fireSelectionChanged();\n          this[property] = index;\n        }\n        this._updateTextarea();\n      },\n\n      /**\n       * Fires the even of selection changed\n       * @private\n       */\n      _fireSelectionChanged: function () {\n        this.fire(\"selection:changed\");\n        this.canvas &&\n          this.canvas.fire(\"text:selection:changed\", { target: this });\n      },\n\n      /**\n       * Initialize text dimensions. Render all text on given context\n       * or on a offscreen canvas to get the text width with measureText.\n       * Updates this.width and this.height with the proper values.\n       * Does not return dimensions.\n       * @private\n       */\n      initDimensions: function () {\n        this.isEditing && this.initDelayedCursor();\n        this.clearContextTop();\n        this.callSuper(\"initDimensions\");\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      render: function (ctx) {\n        this.clearContextTop();\n        this.callSuper(\"render\", ctx);\n        // clear the cursorOffsetCache, so we ensure to calculate once per renderCursor\n        // the correct position but not at every cursor animation.\n        this.cursorOffsetCache = {};\n        this.renderCursorOrSelection();\n      },\n\n      /**\n       * @private\n       * @param {CanvasRenderingContext2D} ctx Context to render on\n       */\n      _render: function (ctx) {\n        this.callSuper(\"_render\", ctx);\n      },\n\n      /**\n       * Prepare and clean the contextTop\n       */\n      clearContextTop: function (skipRestore) {\n        if (!this.isEditing || !this.canvas || !this.canvas.contextTop) {\n          return;\n        }\n        var ctx = this.canvas.contextTop,\n          v = this.canvas.viewportTransform;\n        ctx.save();\n        ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        this.transform(ctx);\n        this._clearTextArea(ctx);\n        skipRestore || ctx.restore();\n      },\n      /**\n       * Renders cursor or selection (depending on what exists)\n       * it does on the contextTop. If contextTop is not available, do nothing.\n       */\n      renderCursorOrSelection: function () {\n        if (!this.isEditing || !this.canvas || !this.canvas.contextTop) {\n          return;\n        }\n        var boundaries = this._getCursorBoundaries(),\n          ctx = this.canvas.contextTop;\n        this.clearContextTop(true);\n        if (this.selectionStart === this.selectionEnd) {\n          this.renderCursor(boundaries, ctx);\n        } else {\n          this.renderSelection(boundaries, ctx);\n        }\n        ctx.restore();\n      },\n\n      _clearTextArea: function (ctx) {\n        // we add 4 pixel, to be sure to do not leave any pixel out\n        var width = this.width + 4,\n          height = this.height + 4;\n        ctx.clearRect(-width / 2, -height / 2, width, height);\n      },\n\n      /**\n       * Returns cursor boundaries (left, top, leftOffset, topOffset)\n       * @private\n       * @param {Array} chars Array of characters\n       * @param {String} typeOfBoundaries\n       */\n      _getCursorBoundaries: function (position) {\n        // left/top are left/top of entire text box\n        // leftOffset/topOffset are offset from that left/top point of a text box\n\n        if (typeof position === \"undefined\") {\n          position = this.selectionStart;\n        }\n\n        var left = this._getLeftOffset(),\n          top = this._getTopOffset(),\n          offsets = this._getCursorBoundariesOffsets(position);\n\n        return {\n          left: left,\n          top: top,\n          leftOffset: offsets.left,\n          topOffset: offsets.top,\n        };\n      },\n\n      /**\n       * @private\n       */\n      _getCursorBoundariesOffsets: function (position) {\n        if (this.cursorOffsetCache && \"top\" in this.cursorOffsetCache) {\n          return this.cursorOffsetCache;\n        }\n        var lineLeftOffset,\n          lineIndex,\n          charIndex,\n          topOffset = 0,\n          leftOffset = 0,\n          boundaries,\n          cursorPosition = this.get2DCursorLocation(position);\n        charIndex = cursorPosition.charIndex;\n        lineIndex = cursorPosition.lineIndex;\n        for (var i = 0; i < lineIndex; i++) {\n          topOffset += this.getHeightOfLine(i);\n        }\n        lineLeftOffset = this._getLineLeftOffset(lineIndex);\n        var bound = this.__charBounds[lineIndex][charIndex];\n        bound && (leftOffset = bound.left);\n        if (\n          this.charSpacing !== 0 &&\n          charIndex === this._textLines[lineIndex].length\n        ) {\n          leftOffset -= this._getWidthOfCharSpacing();\n        }\n        boundaries = {\n          top: topOffset,\n          left: lineLeftOffset + (leftOffset > 0 ? leftOffset : 0),\n        };\n        this.cursorOffsetCache = boundaries;\n        return this.cursorOffsetCache;\n      },\n\n      /**\n       * Renders cursor\n       * @param {Object} boundaries\n       * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n       */\n      renderCursor: function (boundaries, ctx) {\n        var cursorLocation = this.get2DCursorLocation(),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex =\n            cursorLocation.charIndex > 0 ? cursorLocation.charIndex - 1 : 0,\n          charHeight = this.getValueOfPropertyAt(\n            lineIndex,\n            charIndex,\n            \"fontSize\"\n          ),\n          multiplier = this.scaleX * this.canvas.getZoom(),\n          cursorWidth = this.cursorWidth / multiplier,\n          topOffset = boundaries.topOffset,\n          dy = this.getValueOfPropertyAt(lineIndex, charIndex, \"deltaY\");\n\n        topOffset +=\n          ((1 - this._fontSizeFraction) * this.getHeightOfLine(lineIndex)) /\n            this.lineHeight -\n          charHeight * (1 - this._fontSizeFraction);\n\n        if (this.inCompositionMode) {\n          this.renderSelection(boundaries, ctx);\n        }\n\n        ctx.fillStyle =\n          this.cursorColor ||\n          this.getValueOfPropertyAt(lineIndex, charIndex, \"fill\");\n        ctx.globalAlpha = this.__isMousedown ? 1 : this._currentCursorOpacity;\n        ctx.fillRect(\n          boundaries.left + boundaries.leftOffset - cursorWidth / 2,\n          topOffset + boundaries.top + dy,\n          cursorWidth,\n          charHeight\n        );\n      },\n\n      /**\n       * Renders text selection\n       * @param {Object} boundaries Object with left/top/leftOffset/topOffset\n       * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n       */\n      renderSelection: function (boundaries, ctx) {\n        var selectionStart = this.inCompositionMode\n            ? this.hiddenTextarea.selectionStart\n            : this.selectionStart,\n          selectionEnd = this.inCompositionMode\n            ? this.hiddenTextarea.selectionEnd\n            : this.selectionEnd,\n          isJustify = this.textAlign.indexOf(\"justify\") !== -1,\n          start = this.get2DCursorLocation(selectionStart),\n          end = this.get2DCursorLocation(selectionEnd),\n          startLine = start.lineIndex,\n          endLine = end.lineIndex,\n          startChar = start.charIndex < 0 ? 0 : start.charIndex,\n          endChar = end.charIndex < 0 ? 0 : end.charIndex;\n\n        for (var i = startLine; i <= endLine; i++) {\n          var lineOffset = this._getLineLeftOffset(i) || 0,\n            lineHeight = this.getHeightOfLine(i),\n            realLineHeight = 0,\n            boxStart = 0,\n            boxEnd = 0;\n\n          if (i === startLine) {\n            boxStart = this.__charBounds[startLine][startChar].left;\n          }\n          if (i >= startLine && i < endLine) {\n            boxEnd =\n              isJustify && !this.isEndOfWrapping(i)\n                ? this.width\n                : this.getLineWidth(i) || 5; // WTF is this 5?\n          } else if (i === endLine) {\n            if (endChar === 0) {\n              boxEnd = this.__charBounds[endLine][endChar].left;\n            } else {\n              var charSpacing = this._getWidthOfCharSpacing();\n              boxEnd =\n                this.__charBounds[endLine][endChar - 1].left +\n                this.__charBounds[endLine][endChar - 1].width -\n                charSpacing;\n            }\n          }\n          realLineHeight = lineHeight;\n          if (this.lineHeight < 1 || (i === endLine && this.lineHeight > 1)) {\n            lineHeight /= this.lineHeight;\n          }\n          if (this.inCompositionMode) {\n            ctx.fillStyle = this.compositionColor || \"black\";\n            ctx.fillRect(\n              boundaries.left + lineOffset + boxStart,\n              boundaries.top + boundaries.topOffset + lineHeight,\n              boxEnd - boxStart,\n              1\n            );\n          } else {\n            ctx.fillStyle = this.selectionColor;\n            ctx.fillRect(\n              boundaries.left + lineOffset + boxStart,\n              boundaries.top + boundaries.topOffset,\n              boxEnd - boxStart,\n              lineHeight\n            );\n          }\n\n          boundaries.topOffset += realLineHeight;\n        }\n      },\n\n      /**\n       * High level function to know the height of the cursor.\n       * the currentChar is the one that precedes the cursor\n       * Returns fontSize of char at the current cursor\n       * Unused from the library, is for the end user\n       * @return {Number} Character font size\n       */\n      getCurrentCharFontSize: function () {\n        var cp = this._getCurrentCharIndex();\n        return this.getValueOfPropertyAt(cp.l, cp.c, \"fontSize\");\n      },\n\n      /**\n       * High level function to know the color of the cursor.\n       * the currentChar is the one that precedes the cursor\n       * Returns color (fill) of char at the current cursor\n       * Unused from the library, is for the end user\n       * @return {String} Character color (fill)\n       */\n      getCurrentCharColor: function () {\n        var cp = this._getCurrentCharIndex();\n        return this.getValueOfPropertyAt(cp.l, cp.c, \"fill\");\n      },\n\n      /**\n       * Returns the cursor position for the getCurrent.. functions\n       * @private\n       */\n      _getCurrentCharIndex: function () {\n        var cursorPosition = this.get2DCursorLocation(\n            this.selectionStart,\n            true\n          ),\n          charIndex =\n            cursorPosition.charIndex > 0 ? cursorPosition.charIndex - 1 : 0;\n        return { l: cursorPosition.lineIndex, c: charIndex };\n      },\n    }\n  );\n\n  /**\n   * Returns fabric.IText instance from an object representation\n   * @static\n   * @memberOf fabric.IText\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as argument\n   */\n  fabric.IText.fromObject = function (object, callback) {\n    parseDecoration(object);\n    if (object.styles) {\n      for (var i in object.styles) {\n        for (var j in object.styles[i]) {\n          parseDecoration(object.styles[i][j]);\n        }\n      }\n    }\n    fabric.Object._fromObject(\"IText\", object, callback, \"text\");\n  };\n})();\n\n(function () {\n  var clone = fabric.util.object.clone;\n\n  fabric.util.object.extend(\n    fabric.IText.prototype,\n    /** @lends fabric.IText.prototype */ {\n      /**\n       * Initializes all the interactive behavior of IText\n       */\n      initBehavior: function () {\n        this.initAddedHandler();\n        this.initRemovedHandler();\n        this.initCursorSelectionHandlers();\n        this.initDoubleClickSimulation();\n        this.mouseMoveHandler = this.mouseMoveHandler.bind(this);\n      },\n\n      onDeselect: function () {\n        this.isEditing && this.exitEditing();\n        this.selected = false;\n      },\n\n      /**\n       * Initializes \"added\" event handler\n       */\n      initAddedHandler: function () {\n        var _this = this;\n        this.on(\"added\", function () {\n          var canvas = _this.canvas;\n          if (canvas) {\n            if (!canvas._hasITextHandlers) {\n              canvas._hasITextHandlers = true;\n              _this._initCanvasHandlers(canvas);\n            }\n            canvas._iTextInstances = canvas._iTextInstances || [];\n            canvas._iTextInstances.push(_this);\n          }\n        });\n      },\n\n      initRemovedHandler: function () {\n        var _this = this;\n        this.on(\"removed\", function () {\n          var canvas = _this.canvas;\n          if (canvas) {\n            canvas._iTextInstances = canvas._iTextInstances || [];\n            fabric.util.removeFromArray(canvas._iTextInstances, _this);\n            if (canvas._iTextInstances.length === 0) {\n              canvas._hasITextHandlers = false;\n              _this._removeCanvasHandlers(canvas);\n            }\n          }\n        });\n      },\n\n      /**\n       * register canvas event to manage exiting on other instances\n       * @private\n       */\n      _initCanvasHandlers: function (canvas) {\n        canvas._mouseUpITextHandler = function () {\n          if (canvas._iTextInstances) {\n            canvas._iTextInstances.forEach(function (obj) {\n              obj.__isMousedown = false;\n            });\n          }\n        };\n        canvas.on(\"mouse:up\", canvas._mouseUpITextHandler);\n      },\n\n      /**\n       * remove canvas event to manage exiting on other instances\n       * @private\n       */\n      _removeCanvasHandlers: function (canvas) {\n        canvas.off(\"mouse:up\", canvas._mouseUpITextHandler);\n      },\n\n      /**\n       * @private\n       */\n      _tick: function () {\n        this._currentTickState = this._animateCursor(\n          this,\n          1,\n          this.cursorDuration,\n          \"_onTickComplete\"\n        );\n      },\n\n      /**\n       * @private\n       */\n      _animateCursor: function (obj, targetOpacity, duration, completeMethod) {\n        var tickState;\n\n        tickState = {\n          isAborted: false,\n          abort: function () {\n            this.isAborted = true;\n          },\n        };\n\n        obj.animate(\"_currentCursorOpacity\", targetOpacity, {\n          duration: duration,\n          onComplete: function () {\n            if (!tickState.isAborted) {\n              obj[completeMethod]();\n            }\n          },\n          onChange: function () {\n            // we do not want to animate a selection, only cursor\n            if (obj.canvas && obj.selectionStart === obj.selectionEnd) {\n              obj.renderCursorOrSelection();\n            }\n          },\n          abort: function () {\n            return tickState.isAborted;\n          },\n        });\n        return tickState;\n      },\n\n      /**\n       * @private\n       */\n      _onTickComplete: function () {\n        var _this = this;\n\n        if (this._cursorTimeout1) {\n          clearTimeout(this._cursorTimeout1);\n        }\n        this._cursorTimeout1 = setTimeout(function () {\n          _this._currentTickCompleteState = _this._animateCursor(\n            _this,\n            0,\n            this.cursorDuration / 2,\n            \"_tick\"\n          );\n        }, 100);\n      },\n\n      /**\n       * Initializes delayed cursor\n       */\n      initDelayedCursor: function (restart) {\n        var _this = this,\n          delay = restart ? 0 : this.cursorDelay;\n\n        this.abortCursorAnimation();\n        this._currentCursorOpacity = 1;\n        this._cursorTimeout2 = setTimeout(function () {\n          _this._tick();\n        }, delay);\n      },\n\n      /**\n       * Aborts cursor animation and clears all timeouts\n       */\n      abortCursorAnimation: function () {\n        var shouldClear =\n            this._currentTickState || this._currentTickCompleteState,\n          canvas = this.canvas;\n        this._currentTickState && this._currentTickState.abort();\n        this._currentTickCompleteState &&\n          this._currentTickCompleteState.abort();\n\n        clearTimeout(this._cursorTimeout1);\n        clearTimeout(this._cursorTimeout2);\n\n        this._currentCursorOpacity = 0;\n        // to clear just itext area we need to transform the context\n        // it may not be worth it\n        if (shouldClear && canvas) {\n          canvas.clearContext(canvas.contextTop || canvas.contextContainer);\n        }\n      },\n\n      /**\n       * Selects entire text\n       * @return {fabric.IText} thisArg\n       * @chainable\n       */\n      selectAll: function () {\n        this.selectionStart = 0;\n        this.selectionEnd = this._text.length;\n        this._fireSelectionChanged();\n        this._updateTextarea();\n        return this;\n      },\n\n      /**\n       * Returns selected text\n       * @return {String}\n       */\n      getSelectedText: function () {\n        return this._text\n          .slice(this.selectionStart, this.selectionEnd)\n          .join(\"\");\n      },\n\n      /**\n       * Find new selection index representing start of current word according to current selection index\n       * @param {Number} startFrom Current selection index\n       * @return {Number} New selection index\n       */\n      findWordBoundaryLeft: function (startFrom) {\n        var offset = 0,\n          index = startFrom - 1;\n\n        // remove space before cursor first\n        if (this._reSpace.test(this._text[index])) {\n          while (this._reSpace.test(this._text[index])) {\n            offset++;\n            index--;\n          }\n        }\n        while (/\\S/.test(this._text[index]) && index > -1) {\n          offset++;\n          index--;\n        }\n\n        return startFrom - offset;\n      },\n\n      /**\n       * Find new selection index representing end of current word according to current selection index\n       * @param {Number} startFrom Current selection index\n       * @return {Number} New selection index\n       */\n      findWordBoundaryRight: function (startFrom) {\n        var offset = 0,\n          index = startFrom;\n\n        // remove space after cursor first\n        if (this._reSpace.test(this._text[index])) {\n          while (this._reSpace.test(this._text[index])) {\n            offset++;\n            index++;\n          }\n        }\n        while (/\\S/.test(this._text[index]) && index < this._text.length) {\n          offset++;\n          index++;\n        }\n\n        return startFrom + offset;\n      },\n\n      /**\n       * Find new selection index representing start of current line according to current selection index\n       * @param {Number} startFrom Current selection index\n       * @return {Number} New selection index\n       */\n      findLineBoundaryLeft: function (startFrom) {\n        var offset = 0,\n          index = startFrom - 1;\n\n        while (!/\\n/.test(this._text[index]) && index > -1) {\n          offset++;\n          index--;\n        }\n\n        return startFrom - offset;\n      },\n\n      /**\n       * Find new selection index representing end of current line according to current selection index\n       * @param {Number} startFrom Current selection index\n       * @return {Number} New selection index\n       */\n      findLineBoundaryRight: function (startFrom) {\n        var offset = 0,\n          index = startFrom;\n\n        while (!/\\n/.test(this._text[index]) && index < this._text.length) {\n          offset++;\n          index++;\n        }\n\n        return startFrom + offset;\n      },\n\n      /**\n       * Finds index corresponding to beginning or end of a word\n       * @param {Number} selectionStart Index of a character\n       * @param {Number} direction 1 or -1\n       * @return {Number} Index of the beginning or end of a word\n       */\n      searchWordBoundary: function (selectionStart, direction) {\n        var text = this._text,\n          index = this._reSpace.test(text[selectionStart])\n            ? selectionStart - 1\n            : selectionStart,\n          _char = text[index],\n          // wrong\n          reNonWord = fabric.reNonWord;\n\n        while (!reNonWord.test(_char) && index > 0 && index < text.length) {\n          index += direction;\n          _char = text[index];\n        }\n        if (reNonWord.test(_char)) {\n          index += direction === 1 ? 0 : 1;\n        }\n        return index;\n      },\n\n      /**\n       * Selects a word based on the index\n       * @param {Number} selectionStart Index of a character\n       */\n      selectWord: function (selectionStart) {\n        selectionStart = selectionStart || this.selectionStart;\n        var newSelectionStart = this.searchWordBoundary(\n            selectionStart,\n            -1\n          ) /* search backwards */,\n          newSelectionEnd = this.searchWordBoundary(\n            selectionStart,\n            1\n          ); /* search forward */\n\n        this.selectionStart = newSelectionStart;\n        this.selectionEnd = newSelectionEnd;\n        this._fireSelectionChanged();\n        this._updateTextarea();\n        this.renderCursorOrSelection();\n      },\n\n      /**\n       * Selects a line based on the index\n       * @param {Number} selectionStart Index of a character\n       * @return {fabric.IText} thisArg\n       * @chainable\n       */\n      selectLine: function (selectionStart) {\n        selectionStart = selectionStart || this.selectionStart;\n        var newSelectionStart = this.findLineBoundaryLeft(selectionStart),\n          newSelectionEnd = this.findLineBoundaryRight(selectionStart);\n\n        this.selectionStart = newSelectionStart;\n        this.selectionEnd = newSelectionEnd;\n        this._fireSelectionChanged();\n        this._updateTextarea();\n        return this;\n      },\n\n      /**\n       * Enters editing state\n       * @return {fabric.IText} thisArg\n       * @chainable\n       */\n      enterEditing: function (e) {\n        if (this.isEditing || !this.editable) {\n          return;\n        }\n\n        if (this.canvas) {\n          this.canvas.calcOffset();\n          this.exitEditingOnOthers(this.canvas);\n        }\n\n        this.isEditing = true;\n\n        this.initHiddenTextarea(e);\n        this.hiddenTextarea.focus();\n        this.hiddenTextarea.value = this.text;\n        this._updateTextarea();\n        this._saveEditingProps();\n        this._setEditingProps();\n        this._textBeforeEdit = this.text;\n\n        this._tick();\n        this.fire(\"editing:entered\");\n        this._fireSelectionChanged();\n        if (!this.canvas) {\n          return this;\n        }\n        this.canvas.fire(\"text:editing:entered\", { target: this });\n        this.initMouseMoveHandler();\n        this.canvas.requestRenderAll();\n        return this;\n      },\n\n      exitEditingOnOthers: function (canvas) {\n        if (canvas._iTextInstances) {\n          canvas._iTextInstances.forEach(function (obj) {\n            obj.selected = false;\n            if (obj.isEditing) {\n              obj.exitEditing();\n            }\n          });\n        }\n      },\n\n      /**\n       * Initializes \"mousemove\" event handler\n       */\n      initMouseMoveHandler: function () {\n        this.canvas.on(\"mouse:move\", this.mouseMoveHandler);\n      },\n\n      /**\n       * @private\n       */\n      mouseMoveHandler: function (options) {\n        if (!this.__isMousedown || !this.isEditing) {\n          return;\n        }\n\n        var newSelectionStart = this.getSelectionStartFromPointer(options.e),\n          currentStart = this.selectionStart,\n          currentEnd = this.selectionEnd;\n        if (\n          (newSelectionStart !== this.__selectionStartOnMouseDown ||\n            currentStart === currentEnd) &&\n          (currentStart === newSelectionStart ||\n            currentEnd === newSelectionStart)\n        ) {\n          return;\n        }\n        if (newSelectionStart > this.__selectionStartOnMouseDown) {\n          this.selectionStart = this.__selectionStartOnMouseDown;\n          this.selectionEnd = newSelectionStart;\n        } else {\n          this.selectionStart = newSelectionStart;\n          this.selectionEnd = this.__selectionStartOnMouseDown;\n        }\n        if (\n          this.selectionStart !== currentStart ||\n          this.selectionEnd !== currentEnd\n        ) {\n          this.restartCursorIfNeeded();\n          this._fireSelectionChanged();\n          this._updateTextarea();\n          this.renderCursorOrSelection();\n        }\n      },\n\n      /**\n       * @private\n       */\n      _setEditingProps: function () {\n        this.hoverCursor = \"text\";\n\n        if (this.canvas) {\n          this.canvas.defaultCursor = this.canvas.moveCursor = \"text\";\n        }\n\n        this.borderColor = this.editingBorderColor;\n        this.hasControls = this.selectable = false;\n        this.lockMovementX = this.lockMovementY = true;\n      },\n\n      /**\n       * convert from textarea to grapheme indexes\n       */\n      fromStringToGraphemeSelection: function (start, end, text) {\n        var smallerTextStart = text.slice(0, start),\n          graphemeStart = fabric.util.string.graphemeSplit(smallerTextStart)\n            .length;\n        if (start === end) {\n          return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\n        }\n        var smallerTextEnd = text.slice(start, end),\n          graphemeEnd = fabric.util.string.graphemeSplit(smallerTextEnd).length;\n        return {\n          selectionStart: graphemeStart,\n          selectionEnd: graphemeStart + graphemeEnd,\n        };\n      },\n\n      /**\n       * convert from fabric to textarea values\n       */\n      fromGraphemeToStringSelection: function (start, end, _text) {\n        var smallerTextStart = _text.slice(0, start),\n          graphemeStart = smallerTextStart.join(\"\").length;\n        if (start === end) {\n          return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\n        }\n        var smallerTextEnd = _text.slice(start, end),\n          graphemeEnd = smallerTextEnd.join(\"\").length;\n        return {\n          selectionStart: graphemeStart,\n          selectionEnd: graphemeStart + graphemeEnd,\n        };\n      },\n\n      /**\n       * @private\n       */\n      _updateTextarea: function () {\n        this.cursorOffsetCache = {};\n        if (!this.hiddenTextarea) {\n          return;\n        }\n        if (!this.inCompositionMode) {\n          var newSelection = this.fromGraphemeToStringSelection(\n            this.selectionStart,\n            this.selectionEnd,\n            this._text\n          );\n          this.hiddenTextarea.selectionStart = newSelection.selectionStart;\n          this.hiddenTextarea.selectionEnd = newSelection.selectionEnd;\n        }\n        this.updateTextareaPosition();\n      },\n\n      /**\n       * @private\n       */\n      updateFromTextArea: function () {\n        if (!this.hiddenTextarea) {\n          return;\n        }\n        this.cursorOffsetCache = {};\n        this.text = this.hiddenTextarea.value;\n        if (this._shouldClearDimensionCache()) {\n          this.initDimensions();\n          this.setCoords();\n        }\n        var newSelection = this.fromStringToGraphemeSelection(\n          this.hiddenTextarea.selectionStart,\n          this.hiddenTextarea.selectionEnd,\n          this.hiddenTextarea.value\n        );\n        this.selectionEnd = this.selectionStart = newSelection.selectionEnd;\n        if (!this.inCompositionMode) {\n          this.selectionStart = newSelection.selectionStart;\n        }\n        this.updateTextareaPosition();\n      },\n\n      /**\n       * @private\n       */\n      updateTextareaPosition: function () {\n        if (this.selectionStart === this.selectionEnd) {\n          var style = this._calcTextareaPosition();\n          this.hiddenTextarea.style.left = style.left;\n          this.hiddenTextarea.style.top = style.top;\n        }\n      },\n\n      /**\n       * @private\n       * @return {Object} style contains style for hiddenTextarea\n       */\n      _calcTextareaPosition: function () {\n        if (!this.canvas) {\n          return { x: 1, y: 1 };\n        }\n        var desiredPosition = this.inCompositionMode\n            ? this.compositionStart\n            : this.selectionStart,\n          boundaries = this._getCursorBoundaries(desiredPosition),\n          cursorLocation = this.get2DCursorLocation(desiredPosition),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex,\n          charHeight =\n            this.getValueOfPropertyAt(lineIndex, charIndex, \"fontSize\") *\n            this.lineHeight,\n          leftOffset = boundaries.leftOffset,\n          m = this.calcTransformMatrix(),\n          p = {\n            x: boundaries.left + leftOffset,\n            y: boundaries.top + boundaries.topOffset + charHeight,\n          },\n          retinaScaling = this.canvas.getRetinaScaling(),\n          upperCanvas = this.canvas.upperCanvasEl,\n          upperCanvasWidth = upperCanvas.width / retinaScaling,\n          upperCanvasHeight = upperCanvas.height / retinaScaling,\n          maxWidth = upperCanvasWidth - charHeight,\n          maxHeight = upperCanvasHeight - charHeight,\n          scaleX = upperCanvas.clientWidth / upperCanvasWidth,\n          scaleY = upperCanvas.clientHeight / upperCanvasHeight;\n\n        p = fabric.util.transformPoint(p, m);\n        p = fabric.util.transformPoint(p, this.canvas.viewportTransform);\n        p.x *= scaleX;\n        p.y *= scaleY;\n        if (p.x < 0) {\n          p.x = 0;\n        }\n        if (p.x > maxWidth) {\n          p.x = maxWidth;\n        }\n        if (p.y < 0) {\n          p.y = 0;\n        }\n        if (p.y > maxHeight) {\n          p.y = maxHeight;\n        }\n\n        // add canvas offset on document\n        p.x += this.canvas._offset.left;\n        p.y += this.canvas._offset.top;\n\n        return {\n          left: p.x + \"px\",\n          top: p.y + \"px\",\n          fontSize: charHeight + \"px\",\n          charHeight: charHeight,\n        };\n      },\n\n      /**\n       * @private\n       */\n      _saveEditingProps: function () {\n        this._savedProps = {\n          hasControls: this.hasControls,\n          borderColor: this.borderColor,\n          lockMovementX: this.lockMovementX,\n          lockMovementY: this.lockMovementY,\n          hoverCursor: this.hoverCursor,\n          selectable: this.selectable,\n          defaultCursor: this.canvas && this.canvas.defaultCursor,\n          moveCursor: this.canvas && this.canvas.moveCursor,\n        };\n      },\n\n      /**\n       * @private\n       */\n      _restoreEditingProps: function () {\n        if (!this._savedProps) {\n          return;\n        }\n\n        this.hoverCursor = this._savedProps.hoverCursor;\n        this.hasControls = this._savedProps.hasControls;\n        this.borderColor = this._savedProps.borderColor;\n        this.selectable = this._savedProps.selectable;\n        this.lockMovementX = this._savedProps.lockMovementX;\n        this.lockMovementY = this._savedProps.lockMovementY;\n\n        if (this.canvas) {\n          this.canvas.defaultCursor = this._savedProps.defaultCursor;\n          this.canvas.moveCursor = this._savedProps.moveCursor;\n        }\n      },\n\n      /**\n       * Exits from editing state\n       * @return {fabric.IText} thisArg\n       * @chainable\n       */\n      exitEditing: function () {\n        var isTextChanged = this._textBeforeEdit !== this.text;\n        var hiddenTextarea = this.hiddenTextarea;\n        this.selected = false;\n        this.isEditing = false;\n\n        this.selectionEnd = this.selectionStart;\n\n        if (hiddenTextarea) {\n          hiddenTextarea.blur && hiddenTextarea.blur();\n          hiddenTextarea.parentNode &&\n            hiddenTextarea.parentNode.removeChild(hiddenTextarea);\n        }\n        this.hiddenTextarea = null;\n        this.abortCursorAnimation();\n        this._restoreEditingProps();\n        this._currentCursorOpacity = 0;\n        if (this._shouldClearDimensionCache()) {\n          this.initDimensions();\n          this.setCoords();\n        }\n        this.fire(\"editing:exited\");\n        isTextChanged && this.fire(\"modified\");\n        if (this.canvas) {\n          this.canvas.off(\"mouse:move\", this.mouseMoveHandler);\n          this.canvas.fire(\"text:editing:exited\", { target: this });\n          isTextChanged &&\n            this.canvas.fire(\"object:modified\", { target: this });\n        }\n        return this;\n      },\n\n      /**\n       * @private\n       */\n      _removeExtraneousStyles: function () {\n        for (var prop in this.styles) {\n          if (!this._textLines[prop]) {\n            delete this.styles[prop];\n          }\n        }\n      },\n\n      /**\n       * remove and reflow a style block from start to end.\n       * @param {Number} start linear start position for removal (included in removal)\n       * @param {Number} end linear end position for removal ( excluded from removal )\n       */\n      removeStyleFromTo: function (start, end) {\n        var cursorStart = this.get2DCursorLocation(start, true),\n          cursorEnd = this.get2DCursorLocation(end, true),\n          lineStart = cursorStart.lineIndex,\n          charStart = cursorStart.charIndex,\n          lineEnd = cursorEnd.lineIndex,\n          charEnd = cursorEnd.charIndex,\n          i,\n          styleObj;\n        if (lineStart !== lineEnd) {\n          // step1 remove the trailing of lineStart\n          if (this.styles[lineStart]) {\n            for (\n              i = charStart;\n              i < this._unwrappedTextLines[lineStart].length;\n              i++\n            ) {\n              delete this.styles[lineStart][i];\n            }\n          }\n          // step2 move the trailing of lineEnd to lineStart if needed\n          if (this.styles[lineEnd]) {\n            for (\n              i = charEnd;\n              i < this._unwrappedTextLines[lineEnd].length;\n              i++\n            ) {\n              styleObj = this.styles[lineEnd][i];\n              if (styleObj) {\n                this.styles[lineStart] || (this.styles[lineStart] = {});\n                this.styles[lineStart][charStart + i - charEnd] = styleObj;\n              }\n            }\n          }\n          // step3 detects lines will be completely removed.\n          for (i = lineStart + 1; i <= lineEnd; i++) {\n            delete this.styles[i];\n          }\n          // step4 shift remaining lines.\n          this.shiftLineStyles(lineEnd, lineStart - lineEnd);\n        } else {\n          // remove and shift left on the same line\n          if (this.styles[lineStart]) {\n            styleObj = this.styles[lineStart];\n            var diff = charEnd - charStart,\n              numericChar,\n              _char;\n            for (i = charStart; i < charEnd; i++) {\n              delete styleObj[i];\n            }\n            for (_char in this.styles[lineStart]) {\n              numericChar = parseInt(_char, 10);\n              if (numericChar >= charEnd) {\n                styleObj[numericChar - diff] = styleObj[_char];\n                delete styleObj[_char];\n              }\n            }\n          }\n        }\n      },\n\n      /**\n       * Shifts line styles up or down\n       * @param {Number} lineIndex Index of a line\n       * @param {Number} offset Can any number?\n       */\n      shiftLineStyles: function (lineIndex, offset) {\n        // shift all line styles by offset upward or downward\n        // do not clone deep. we need new array, not new style objects\n        var clonedStyles = clone(this.styles);\n        for (var line in this.styles) {\n          var numericLine = parseInt(line, 10);\n          if (numericLine > lineIndex) {\n            this.styles[numericLine + offset] = clonedStyles[numericLine];\n            if (!clonedStyles[numericLine - offset]) {\n              delete this.styles[numericLine];\n            }\n          }\n        }\n      },\n\n      restartCursorIfNeeded: function () {\n        if (\n          !this._currentTickState ||\n          this._currentTickState.isAborted ||\n          !this._currentTickCompleteState ||\n          this._currentTickCompleteState.isAborted\n        ) {\n          this.initDelayedCursor();\n        }\n      },\n\n      /**\n       * Handle insertion of more consecutive style lines for when one or more\n       * newlines gets added to the text. Since current style needs to be shifted\n       * first we shift the current style of the number lines needed, then we add\n       * new lines from the last to the first.\n       * @param {Number} lineIndex Index of a line\n       * @param {Number} charIndex Index of a char\n       * @param {Number} qty number of lines to add\n       * @param {Array} copiedStyle Array of objects styles\n       */\n      insertNewlineStyleObject: function (\n        lineIndex,\n        charIndex,\n        qty,\n        copiedStyle\n      ) {\n        var currentCharStyle,\n          newLineStyles = {},\n          somethingAdded = false,\n          isEndOfLine =\n            this._unwrappedTextLines[lineIndex].length === charIndex;\n\n        qty || (qty = 1);\n        this.shiftLineStyles(lineIndex, qty);\n        if (this.styles[lineIndex]) {\n          currentCharStyle = this.styles[lineIndex][\n            charIndex === 0 ? charIndex : charIndex - 1\n          ];\n        }\n        // we clone styles of all chars\n        // after cursor onto the current line\n        for (var index in this.styles[lineIndex]) {\n          var numIndex = parseInt(index, 10);\n          if (numIndex >= charIndex) {\n            somethingAdded = true;\n            newLineStyles[numIndex - charIndex] = this.styles[lineIndex][index];\n            // remove lines from the previous line since they're on a new line now\n            if (!(isEndOfLine && charIndex === 0)) {\n              delete this.styles[lineIndex][index];\n            }\n          }\n        }\n        var styleCarriedOver = false;\n        if (somethingAdded && !isEndOfLine) {\n          // if is end of line, the extra style we copied\n          // is probably not something we want\n          this.styles[lineIndex + qty] = newLineStyles;\n          styleCarriedOver = true;\n        }\n        if (styleCarriedOver) {\n          // skip the last line of since we already prepared it.\n          qty--;\n        }\n        // for the all the lines or all the other lines\n        // we clone current char style onto the next (otherwise empty) line\n        while (qty > 0) {\n          if (copiedStyle && copiedStyle[qty - 1]) {\n            this.styles[lineIndex + qty] = { 0: clone(copiedStyle[qty - 1]) };\n          } else if (currentCharStyle) {\n            this.styles[lineIndex + qty] = { 0: clone(currentCharStyle) };\n          } else {\n            delete this.styles[lineIndex + qty];\n          }\n          qty--;\n        }\n        this._forceClearCache = true;\n      },\n\n      /**\n       * Inserts style object for a given line/char index\n       * @param {Number} lineIndex Index of a line\n       * @param {Number} charIndex Index of a char\n       * @param {Number} quantity number Style object to insert, if given\n       * @param {Array} copiedStyle array of style objects\n       */\n      insertCharStyleObject: function (\n        lineIndex,\n        charIndex,\n        quantity,\n        copiedStyle\n      ) {\n        if (!this.styles) {\n          this.styles = {};\n        }\n        var currentLineStyles = this.styles[lineIndex],\n          currentLineStylesCloned = currentLineStyles\n            ? clone(currentLineStyles)\n            : {};\n\n        quantity || (quantity = 1);\n        // shift all char styles by quantity forward\n        // 0,1,2,3 -> (charIndex=2) -> 0,1,3,4 -> (insert 2) -> 0,1,2,3,4\n        for (var index in currentLineStylesCloned) {\n          var numericIndex = parseInt(index, 10);\n          if (numericIndex >= charIndex) {\n            currentLineStyles[numericIndex + quantity] =\n              currentLineStylesCloned[numericIndex];\n            // only delete the style if there was nothing moved there\n            if (!currentLineStylesCloned[numericIndex - quantity]) {\n              delete currentLineStyles[numericIndex];\n            }\n          }\n        }\n        this._forceClearCache = true;\n        if (copiedStyle) {\n          while (quantity--) {\n            if (!Object.keys(copiedStyle[quantity]).length) {\n              continue;\n            }\n            if (!this.styles[lineIndex]) {\n              this.styles[lineIndex] = {};\n            }\n            this.styles[lineIndex][charIndex + quantity] = clone(\n              copiedStyle[quantity]\n            );\n          }\n          return;\n        }\n        if (!currentLineStyles) {\n          return;\n        }\n        var newStyle = currentLineStyles[charIndex ? charIndex - 1 : 1];\n        while (newStyle && quantity--) {\n          this.styles[lineIndex][charIndex + quantity] = clone(newStyle);\n        }\n      },\n\n      /**\n       * Inserts style object(s)\n       * @param {Array} insertedText Characters at the location where style is inserted\n       * @param {Number} start cursor index for inserting style\n       * @param {Array} [copiedStyle] array of style objects to insert.\n       */\n      insertNewStyleBlock: function (insertedText, start, copiedStyle) {\n        var cursorLoc = this.get2DCursorLocation(start, true),\n          addedLines = [0],\n          linesLength = 0;\n        // get an array of how many char per lines are being added.\n        for (var i = 0; i < insertedText.length; i++) {\n          if (insertedText[i] === \"\\n\") {\n            linesLength++;\n            addedLines[linesLength] = 0;\n          } else {\n            addedLines[linesLength]++;\n          }\n        }\n        // for the first line copy the style from the current char position.\n        if (addedLines[0] > 0) {\n          this.insertCharStyleObject(\n            cursorLoc.lineIndex,\n            cursorLoc.charIndex,\n            addedLines[0],\n            copiedStyle\n          );\n          copiedStyle = copiedStyle && copiedStyle.slice(addedLines[0] + 1);\n        }\n        linesLength &&\n          this.insertNewlineStyleObject(\n            cursorLoc.lineIndex,\n            cursorLoc.charIndex + addedLines[0],\n            linesLength\n          );\n        for (var i = 1; i < linesLength; i++) {\n          if (addedLines[i] > 0) {\n            this.insertCharStyleObject(\n              cursorLoc.lineIndex + i,\n              0,\n              addedLines[i],\n              copiedStyle\n            );\n          } else if (copiedStyle) {\n            this.styles[cursorLoc.lineIndex + i][0] = copiedStyle[0];\n          }\n          copiedStyle = copiedStyle && copiedStyle.slice(addedLines[i] + 1);\n        }\n        // we use i outside the loop to get it like linesLength\n        if (addedLines[i] > 0) {\n          this.insertCharStyleObject(\n            cursorLoc.lineIndex + i,\n            0,\n            addedLines[i],\n            copiedStyle\n          );\n        }\n      },\n\n      /**\n       * Set the selectionStart and selectionEnd according to the new position of cursor\n       * mimic the key - mouse navigation when shift is pressed.\n       */\n      setSelectionStartEndWithShift: function (start, end, newSelection) {\n        if (newSelection <= start) {\n          if (end === start) {\n            this._selectionDirection = \"left\";\n          } else if (this._selectionDirection === \"right\") {\n            this._selectionDirection = \"left\";\n            this.selectionEnd = start;\n          }\n          this.selectionStart = newSelection;\n        } else if (newSelection > start && newSelection < end) {\n          if (this._selectionDirection === \"right\") {\n            this.selectionEnd = newSelection;\n          } else {\n            this.selectionStart = newSelection;\n          }\n        } else {\n          // newSelection is > selection start and end\n          if (end === start) {\n            this._selectionDirection = \"right\";\n          } else if (this._selectionDirection === \"left\") {\n            this._selectionDirection = \"right\";\n            this.selectionStart = end;\n          }\n          this.selectionEnd = newSelection;\n        }\n      },\n\n      setSelectionInBoundaries: function () {\n        var length = this.text.length;\n        if (this.selectionStart > length) {\n          this.selectionStart = length;\n        } else if (this.selectionStart < 0) {\n          this.selectionStart = 0;\n        }\n        if (this.selectionEnd > length) {\n          this.selectionEnd = length;\n        } else if (this.selectionEnd < 0) {\n          this.selectionEnd = 0;\n        }\n      },\n    }\n  );\n})();\n\n// adapted\nfabric.util.object.extend(\n  fabric.IText.prototype,\n  /** @lends fabric.IText.prototype */ {\n    /**\n     * Initializes \"dbclick\" event handler\n     * adapted AA\n     */\n    initDoubleClickSimulation: function () {\n      // for double click\n      this.__lastClickTime = +new Date();\n\n      // for triple click\n      this.__lastLastClickTime = +new Date();\n\n      this.__lastPointer = {};\n\n      this.on(\"mousedown\", this.onMouseDown);\n    },\n\n    /**\n     * Default event handler to simulate triple click\n     * @private\n     */\n    onMouseDown: function (options) {\n      if (!this.canvas) {\n        return;\n      }\n      this.__newClickTime = +new Date();\n      var newPointer = options.pointer;\n      if (this.isTripleClick(newPointer)) {\n        this.fire(\"tripleclick\", options);\n        this._stopEvent(options.e);\n      }\n      this.__lastLastClickTime = this.__lastClickTime;\n      this.__lastClickTime = this.__newClickTime;\n      this.__lastPointer = newPointer;\n      this.__lastIsEditing = this.isEditing;\n      this.__lastSelected = this.selected;\n    },\n\n    isTripleClick: function (newPointer) {\n      return (\n        this.__newClickTime - this.__lastClickTime < 500 &&\n        this.__lastClickTime - this.__lastLastClickTime < 500 &&\n        this.__lastPointer.x === newPointer.x &&\n        this.__lastPointer.y === newPointer.y\n      );\n    },\n\n    /**\n     * @private\n     */\n    _stopEvent: function (e) {\n      e.preventDefault && e.preventDefault();\n      e.stopPropagation && e.stopPropagation();\n    },\n\n    /**\n     * Initializes event handlers related to cursor or selection\n     */\n    initCursorSelectionHandlers: function () {\n      this.initMousedownHandler();\n      this.initMouseupHandler();\n      this.initClicks();\n    },\n\n    /**\n     * Default handler for double click, select a word\n     */\n    doubleClickHandler: function (options) {\n      if (!this.isEditing) {\n        return;\n      }\n      this.selectWord(this.getSelectionStartFromPointer(options.e));\n    },\n\n    /**\n     * Default handler for triple click, select a line\n     */\n    tripleClickHandler: function (options) {\n      if (!this.isEditing) {\n        return;\n      }\n      this.selectLine(this.getSelectionStartFromPointer(options.e));\n    },\n\n    /**\n     * Initializes double and triple click event handlers\n     */\n    initClicks: function () {\n      this.on(\"mousedblclick\", this.doubleClickHandler);\n      this.on(\"tripleclick\", this.tripleClickHandler);\n    },\n\n    /**\n     * Default event handler for the basic functionalities needed on _mouseDown\n     * can be overridden to do something different.\n     * Scope of this implementation is: find the click position, set selectionStart\n     * find selectionEnd, initialize the drawing of either cursor or selection area\n     * initializing a mousedDown on a text area will cancel fabricjs knowledge of\n     * current compositionMode. It will be set to false.\n     */\n    _mouseDownHandler: function (options) {\n      if (\n        !this.canvas ||\n        !this.editable ||\n        (options.e.button && options.e.button !== 1)\n      ) {\n        return;\n      }\n\n      this.__isMousedown = true;\n\n      if (this.selected) {\n        this.inCompositionMode = false;\n        this.setCursorByClick(options.e);\n      }\n\n      if (this.isEditing) {\n        this.__selectionStartOnMouseDown = this.selectionStart;\n        if (this.selectionStart === this.selectionEnd) {\n          this.abortCursorAnimation();\n        }\n        this.renderCursorOrSelection();\n      }\n    },\n\n    /**\n     * Default event handler for the basic functionalities needed on mousedown:before\n     * can be overridden to do something different.\n     * Scope of this implementation is: verify the object is already selected when mousing down\n     */\n    _mouseDownHandlerBefore: function (options) {\n      if (\n        !this.canvas ||\n        !this.editable ||\n        (options.e.button && options.e.button !== 1)\n      ) {\n        return;\n      }\n      // we want to avoid that an object that was selected and then becomes unselectable,\n      // may trigger editing mode in some way.\n      this.selected = this === this.canvas._activeObject;\n    },\n\n    /**\n     * Initializes \"mousedown\" event handler\n     * adapted\n     * adapted AA\n     */\n    initMousedownHandler: function () {\n      this.on(\"mousedown\", this._mouseDownHandler);\n      this.on(\"mousedown:before\", this._mouseDownHandlerBefore);\n    },\n\n    /**\n     * Initializes \"mouseup\" event handler\n     * adapted AA\n     */\n    initMouseupHandler: function () {\n      this.on(\"mouseup\", this.mouseUpHandler);\n    },\n\n    /**\n     * standard hander for mouse up, overridable\n     * @private\n     */\n    mouseUpHandler: function (options) {\n      this.__isMousedown = false;\n      if (\n        !this.editable ||\n        this.group ||\n        (options.transform && options.transform.actionPerformed) ||\n        (options.e.button && options.e.button !== 1)\n      ) {\n        return;\n      }\n\n      if (this.canvas) {\n        var currentActive = this.canvas._activeObject;\n        if (currentActive && currentActive !== this) {\n          // avoid running this logic when there is an active object\n          // this because is possible with shift click and fast clicks,\n          // to rapidly deselect and reselect this object and trigger an enterEdit\n          return;\n        }\n      }\n\n      if (this.__lastSelected && !this.__corner) {\n        this.selected = false;\n        this.__lastSelected = false;\n        this.enterEditing(options.e);\n        if (this.selectionStart === this.selectionEnd) {\n          this.initDelayedCursor(true);\n        } else {\n          this.renderCursorOrSelection();\n        }\n      } else {\n        this.selected = true;\n      }\n    },\n\n    /**\n     * Changes cursor location in a text depending on passed pointer (x/y) object\n     * @param {Event} e Event object\n     */\n    setCursorByClick: function (e) {\n      var newSelection = this.getSelectionStartFromPointer(e),\n        start = this.selectionStart,\n        end = this.selectionEnd;\n      if (e.shiftKey) {\n        this.setSelectionStartEndWithShift(start, end, newSelection);\n      } else {\n        this.selectionStart = newSelection;\n        this.selectionEnd = newSelection;\n      }\n      if (this.isEditing) {\n        this._fireSelectionChanged();\n        this._updateTextarea();\n      }\n    },\n\n    /**\n     * Returns index of a character corresponding to where an object was clicked\n     * @param {Event} e Event object\n     * @return {Number} Index of a character\n     */\n    getSelectionStartFromPointer: function (e) {\n      var mouseOffset = this.getLocalPointer(e),\n        prevWidth = 0,\n        width = 0,\n        height = 0,\n        charIndex = 0,\n        lineIndex = 0,\n        lineLeftOffset,\n        line;\n\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        if (height <= mouseOffset.y) {\n          height += this.getHeightOfLine(i) * this.scaleY;\n          lineIndex = i;\n          if (i > 0) {\n            charIndex +=\n              this._textLines[i - 1].length + this.missingNewlineOffset(i - 1);\n          }\n        } else {\n          break;\n        }\n      }\n      lineLeftOffset = this._getLineLeftOffset(lineIndex);\n      width = lineLeftOffset * this.scaleX;\n      line = this._textLines[lineIndex];\n      for (var j = 0, jlen = line.length; j < jlen; j++) {\n        prevWidth = width;\n        // i removed something about flipX here, check.\n        width += this.__charBounds[lineIndex][j].kernedWidth * this.scaleX;\n        if (width <= mouseOffset.x) {\n          charIndex++;\n        } else {\n          break;\n        }\n      }\n      return this._getNewSelectionStartFromOffset(\n        mouseOffset,\n        prevWidth,\n        width,\n        charIndex,\n        jlen\n      );\n    },\n\n    /**\n     * @private\n     */\n    _getNewSelectionStartFromOffset: function (\n      mouseOffset,\n      prevWidth,\n      width,\n      index,\n      jlen\n    ) {\n      // we need Math.abs because when width is after the last char, the offset is given as 1, while is 0\n      var distanceBtwLastCharAndCursor = mouseOffset.x - prevWidth,\n        distanceBtwNextCharAndCursor = width - mouseOffset.x,\n        offset =\n          distanceBtwNextCharAndCursor > distanceBtwLastCharAndCursor ||\n          distanceBtwNextCharAndCursor < 0\n            ? 0\n            : 1,\n        newSelectionStart = index + offset;\n      // if object is horizontally flipped, mirror cursor location from the end\n      if (this.flipX) {\n        newSelectionStart = jlen - newSelectionStart;\n      }\n\n      if (newSelectionStart > this._text.length) {\n        newSelectionStart = this._text.length;\n      }\n\n      return newSelectionStart;\n    },\n  }\n);\n\nfabric.util.object.extend(\n  fabric.IText.prototype,\n  /** @lends fabric.IText.prototype */ {\n    /**\n     * Initializes hidden textarea (needed to bring up keyboard in iOS)\n     */\n    initHiddenTextarea: function () {\n      this.hiddenTextarea = fabric.document.createElement(\"textarea\");\n      this.hiddenTextarea.setAttribute(\"autocapitalize\", \"off\");\n      this.hiddenTextarea.setAttribute(\"autocorrect\", \"off\");\n      this.hiddenTextarea.setAttribute(\"autocomplete\", \"off\");\n      this.hiddenTextarea.setAttribute(\"spellcheck\", \"false\");\n      this.hiddenTextarea.setAttribute(\"data-fabric-hiddentextarea\", \"\");\n      this.hiddenTextarea.setAttribute(\"wrap\", \"off\");\n      var style = this._calcTextareaPosition();\n      // line-height: 1px; was removed from the style to fix this:\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=870966\n      this.hiddenTextarea.style.cssText =\n        \"position: absolute; top: \" +\n        style.top +\n        \"; left: \" +\n        style.left +\n        \"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px;\" +\n        \" paddingｰtop: \" +\n        style.fontSize +\n        \";\";\n      fabric.document.body.appendChild(this.hiddenTextarea);\n\n      fabric.util.addListener(\n        this.hiddenTextarea,\n        \"keydown\",\n        this.onKeyDown.bind(this)\n      );\n      fabric.util.addListener(\n        this.hiddenTextarea,\n        \"keyup\",\n        this.onKeyUp.bind(this)\n      );\n      fabric.util.addListener(\n        this.hiddenTextarea,\n        \"input\",\n        this.onInput.bind(this)\n      );\n      fabric.util.addListener(\n        this.hiddenTextarea,\n        \"copy\",\n        this.copy.bind(this)\n      );\n      fabric.util.addListener(this.hiddenTextarea, \"cut\", this.copy.bind(this));\n      fabric.util.addListener(\n        this.hiddenTextarea,\n        \"paste\",\n        this.paste.bind(this)\n      );\n      fabric.util.addListener(\n        this.hiddenTextarea,\n        \"compositionstart\",\n        this.onCompositionStart.bind(this)\n      );\n      fabric.util.addListener(\n        this.hiddenTextarea,\n        \"compositionupdate\",\n        this.onCompositionUpdate.bind(this)\n      );\n      fabric.util.addListener(\n        this.hiddenTextarea,\n        \"compositionend\",\n        this.onCompositionEnd.bind(this)\n      );\n\n      if (!this._clickHandlerInitialized && this.canvas) {\n        fabric.util.addListener(\n          this.canvas.upperCanvasEl,\n          \"click\",\n          this.onClick.bind(this)\n        );\n        this._clickHandlerInitialized = true;\n      }\n    },\n\n    /**\n     * For functionalities on keyDown\n     * Map a special key to a function of the instance/prototype\n     * If you need different behaviour for ESC or TAB or arrows, you have to change\n     * this map setting the name of a function that you build on the fabric.Itext or\n     * your prototype.\n     * the map change will affect all Instances unless you need for only some text Instances\n     * in that case you have to clone this object and assign your Instance.\n     * this.keysMap = fabric.util.object.clone(this.keysMap);\n     * The function must be in fabric.Itext.prototype.myFunction And will receive event as args[0]\n     */\n    keysMap: {\n      9: \"exitEditing\",\n      27: \"exitEditing\",\n      33: \"moveCursorUp\",\n      34: \"moveCursorDown\",\n      35: \"moveCursorRight\",\n      36: \"moveCursorLeft\",\n      37: \"moveCursorLeft\",\n      38: \"moveCursorUp\",\n      39: \"moveCursorRight\",\n      40: \"moveCursorDown\",\n    },\n\n    /**\n     * For functionalities on keyUp + ctrl || cmd\n     */\n    ctrlKeysMapUp: {\n      67: \"copy\",\n      88: \"cut\",\n    },\n\n    /**\n     * For functionalities on keyDown + ctrl || cmd\n     */\n    ctrlKeysMapDown: {\n      65: \"selectAll\",\n    },\n\n    onClick: function () {\n      // No need to trigger click event here, focus is enough to have the keyboard appear on Android\n      this.hiddenTextarea && this.hiddenTextarea.focus();\n    },\n\n    /**\n     * Handles keydown event\n     * only used for arrows and combination of modifier keys.\n     * @param {Event} e Event object\n     */\n    onKeyDown: function (e) {\n      if (!this.isEditing) {\n        return;\n      }\n      if (e.keyCode in this.keysMap) {\n        this[this.keysMap[e.keyCode]](e);\n      } else if (\n        e.keyCode in this.ctrlKeysMapDown &&\n        (e.ctrlKey || e.metaKey)\n      ) {\n        this[this.ctrlKeysMapDown[e.keyCode]](e);\n      } else {\n        return;\n      }\n      e.stopImmediatePropagation();\n      e.preventDefault();\n      if (e.keyCode >= 33 && e.keyCode <= 40) {\n        // if i press an arrow key just update selection\n        this.inCompositionMode = false;\n        this.clearContextTop();\n        this.renderCursorOrSelection();\n      } else {\n        this.canvas && this.canvas.requestRenderAll();\n      }\n    },\n\n    /**\n     * Handles keyup event\n     * We handle KeyUp because ie11 and edge have difficulties copy/pasting\n     * if a copy/cut event fired, keyup is dismissed\n     * @param {Event} e Event object\n     */\n    onKeyUp: function (e) {\n      if (!this.isEditing || this._copyDone || this.inCompositionMode) {\n        this._copyDone = false;\n        return;\n      }\n      if (e.keyCode in this.ctrlKeysMapUp && (e.ctrlKey || e.metaKey)) {\n        this[this.ctrlKeysMapUp[e.keyCode]](e);\n      } else {\n        return;\n      }\n      e.stopImmediatePropagation();\n      e.preventDefault();\n      this.canvas && this.canvas.requestRenderAll();\n    },\n\n    /**\n     * Handles onInput event\n     * @param {Event} e Event object\n     */\n    onInput: function (e) {\n      var fromPaste = this.fromPaste;\n      this.fromPaste = false;\n      e && e.stopPropagation();\n      if (!this.isEditing) {\n        return;\n      }\n      // decisions about style changes.\n      var nextText = this._splitTextIntoLines(this.hiddenTextarea.value)\n          .graphemeText,\n        charCount = this._text.length,\n        nextCharCount = nextText.length,\n        removedText,\n        insertedText,\n        charDiff = nextCharCount - charCount,\n        selectionStart = this.selectionStart,\n        selectionEnd = this.selectionEnd,\n        selection = selectionStart !== selectionEnd,\n        copiedStyle,\n        removeFrom,\n        removeTo;\n      if (this.hiddenTextarea.value === \"\") {\n        this.styles = {};\n        this.updateFromTextArea();\n        this.fire(\"changed\");\n        if (this.canvas) {\n          this.canvas.fire(\"text:changed\", { target: this });\n          this.canvas.requestRenderAll();\n        }\n        return;\n      }\n\n      var textareaSelection = this.fromStringToGraphemeSelection(\n        this.hiddenTextarea.selectionStart,\n        this.hiddenTextarea.selectionEnd,\n        this.hiddenTextarea.value\n      );\n      var backDelete = selectionStart > textareaSelection.selectionStart;\n\n      if (selection) {\n        removedText = this._text.slice(selectionStart, selectionEnd);\n        charDiff += selectionEnd - selectionStart;\n      } else if (nextCharCount < charCount) {\n        if (backDelete) {\n          removedText = this._text.slice(selectionEnd + charDiff, selectionEnd);\n        } else {\n          removedText = this._text.slice(\n            selectionStart,\n            selectionStart - charDiff\n          );\n        }\n      }\n      insertedText = nextText.slice(\n        textareaSelection.selectionEnd - charDiff,\n        textareaSelection.selectionEnd\n      );\n      if (removedText && removedText.length) {\n        if (insertedText.length) {\n          // let's copy some style before deleting.\n          // we want to copy the style before the cursor OR the style at the cursor if selection\n          // is bigger than 0.\n          copiedStyle = this.getSelectionStyles(\n            selectionStart,\n            selectionStart + 1,\n            false\n          );\n\n          // now duplicate the style one for each inserted text.\n          copiedStyle = insertedText.map(function () {\n            // this return an array of references, but that is fine since we are\n            // copying the style later.\n            return copiedStyle[0];\n          });\n        }\n        if (selection) {\n          removeFrom = selectionStart;\n          removeTo = selectionEnd;\n        } else if (backDelete) {\n          // detect differencies between forwardDelete and backDelete\n          removeFrom = selectionEnd - removedText.length;\n          removeTo = selectionEnd;\n        } else {\n          removeFrom = selectionEnd;\n          removeTo = selectionEnd + removedText.length;\n        }\n        this.removeStyleFromTo(removeFrom, removeTo);\n      }\n      if (insertedText.length) {\n        if (\n          fromPaste &&\n          insertedText.join(\"\") === fabric.copiedText &&\n          !fabric.disableStyleCopyPaste\n        ) {\n          copiedStyle = fabric.copiedTextStyle;\n        }\n        this.insertNewStyleBlock(insertedText, selectionStart, copiedStyle);\n      }\n      this.updateFromTextArea();\n      this.fire(\"changed\");\n      if (this.canvas) {\n        this.canvas.fire(\"text:changed\", { target: this });\n        this.canvas.requestRenderAll();\n      }\n    },\n    /**\n     * Composition start\n     */\n    onCompositionStart: function () {\n      this.inCompositionMode = true;\n    },\n\n    /**\n     * Composition end\n     */\n    onCompositionEnd: function () {\n      this.inCompositionMode = false;\n    },\n\n    // /**\n    //  * Composition update\n    //  */\n    onCompositionUpdate: function (e) {\n      this.compositionStart = e.target.selectionStart;\n      this.compositionEnd = e.target.selectionEnd;\n      this.updateTextareaPosition();\n    },\n\n    /**\n     * Copies selected text\n     * @param {Event} e Event object\n     */\n    copy: function () {\n      if (this.selectionStart === this.selectionEnd) {\n        //do not cut-copy if no selection\n        return;\n      }\n\n      fabric.copiedText = this.getSelectedText();\n      if (!fabric.disableStyleCopyPaste) {\n        fabric.copiedTextStyle = this.getSelectionStyles(\n          this.selectionStart,\n          this.selectionEnd,\n          true\n        );\n      } else {\n        fabric.copiedTextStyle = null;\n      }\n      this._copyDone = true;\n    },\n\n    /**\n     * Pastes text\n     * @param {Event} e Event object\n     */\n    paste: function () {\n      this.fromPaste = true;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @return {Object} Clipboard data object\n     */\n    _getClipboardData: function (e) {\n      return (e && e.clipboardData) || fabric.window.clipboardData;\n    },\n\n    /**\n     * Finds the width in pixels before the cursor on the same line\n     * @private\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @return {Number} widthBeforeCursor width before cursor\n     */\n    _getWidthBeforeCursor: function (lineIndex, charIndex) {\n      var widthBeforeCursor = this._getLineLeftOffset(lineIndex),\n        bound;\n\n      if (charIndex > 0) {\n        bound = this.__charBounds[lineIndex][charIndex - 1];\n        widthBeforeCursor += bound.left + bound.width;\n      }\n      return widthBeforeCursor;\n    },\n\n    /**\n     * Gets start offset of a selection\n     * @param {Event} e Event object\n     * @param {Boolean} isRight\n     * @return {Number}\n     */\n    getDownCursorOffset: function (e, isRight) {\n      var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n      // if on last line, down cursor goes to end of line\n      if (\n        lineIndex === this._textLines.length - 1 ||\n        e.metaKey ||\n        e.keyCode === 34\n      ) {\n        // move to the end of a text\n        return this._text.length - selectionProp;\n      }\n      var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(\n          lineIndex + 1,\n          widthBeforeCursor\n        ),\n        textAfterCursor = this._textLines[lineIndex].slice(charIndex);\n      return (\n        textAfterCursor.length +\n        indexOnOtherLine +\n        1 +\n        this.missingNewlineOffset(lineIndex)\n      );\n    },\n\n    /**\n     * private\n     * Helps finding if the offset should be counted from Start or End\n     * @param {Event} e Event object\n     * @param {Boolean} isRight\n     * @return {Number}\n     */\n    _getSelectionForOffset: function (e, isRight) {\n      if (e.shiftKey && this.selectionStart !== this.selectionEnd && isRight) {\n        return this.selectionEnd;\n      } else {\n        return this.selectionStart;\n      }\n    },\n\n    /**\n     * @param {Event} e Event object\n     * @param {Boolean} isRight\n     * @return {Number}\n     */\n    getUpCursorOffset: function (e, isRight) {\n      var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n      if (lineIndex === 0 || e.metaKey || e.keyCode === 33) {\n        // if on first line, up cursor goes to start of line\n        return -selectionProp;\n      }\n      var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(\n          lineIndex - 1,\n          widthBeforeCursor\n        ),\n        textBeforeCursor = this._textLines[lineIndex].slice(0, charIndex),\n        missingNewlineOffset = this.missingNewlineOffset(lineIndex - 1);\n      // return a negative offset\n      return (\n        -this._textLines[lineIndex - 1].length +\n        indexOnOtherLine -\n        textBeforeCursor.length +\n        (1 - missingNewlineOffset)\n      );\n    },\n\n    /**\n     * for a given width it founds the matching character.\n     * @private\n     */\n    _getIndexOnLine: function (lineIndex, width) {\n      var line = this._textLines[lineIndex],\n        lineLeftOffset = this._getLineLeftOffset(lineIndex),\n        widthOfCharsOnLine = lineLeftOffset,\n        indexOnLine = 0,\n        charWidth,\n        foundMatch;\n\n      for (var j = 0, jlen = line.length; j < jlen; j++) {\n        charWidth = this.__charBounds[lineIndex][j].width;\n        widthOfCharsOnLine += charWidth;\n        if (widthOfCharsOnLine > width) {\n          foundMatch = true;\n          var leftEdge = widthOfCharsOnLine - charWidth,\n            rightEdge = widthOfCharsOnLine,\n            offsetFromLeftEdge = Math.abs(leftEdge - width),\n            offsetFromRightEdge = Math.abs(rightEdge - width);\n\n          indexOnLine = offsetFromRightEdge < offsetFromLeftEdge ? j : j - 1;\n          break;\n        }\n      }\n\n      // reached end\n      if (!foundMatch) {\n        indexOnLine = line.length - 1;\n      }\n\n      return indexOnLine;\n    },\n\n    /**\n     * Moves cursor down\n     * @param {Event} e Event object\n     */\n    moveCursorDown: function (e) {\n      if (\n        this.selectionStart >= this._text.length &&\n        this.selectionEnd >= this._text.length\n      ) {\n        return;\n      }\n      this._moveCursorUpOrDown(\"Down\", e);\n    },\n\n    /**\n     * Moves cursor up\n     * @param {Event} e Event object\n     */\n    moveCursorUp: function (e) {\n      if (this.selectionStart === 0 && this.selectionEnd === 0) {\n        return;\n      }\n      this._moveCursorUpOrDown(\"Up\", e);\n    },\n\n    /**\n     * Moves cursor up or down, fires the events\n     * @param {String} direction 'Up' or 'Down'\n     * @param {Event} e Event object\n     */\n    _moveCursorUpOrDown: function (direction, e) {\n      // getUpCursorOffset\n      // getDownCursorOffset\n      var action = \"get\" + direction + \"CursorOffset\",\n        offset = this[action](e, this._selectionDirection === \"right\");\n      if (e.shiftKey) {\n        this.moveCursorWithShift(offset);\n      } else {\n        this.moveCursorWithoutShift(offset);\n      }\n      if (offset !== 0) {\n        this.setSelectionInBoundaries();\n        this.abortCursorAnimation();\n        this._currentCursorOpacity = 1;\n        this.initDelayedCursor();\n        this._fireSelectionChanged();\n        this._updateTextarea();\n      }\n    },\n\n    /**\n     * Moves cursor with shift\n     * @param {Number} offset\n     */\n    moveCursorWithShift: function (offset) {\n      var newSelection =\n        this._selectionDirection === \"left\"\n          ? this.selectionStart + offset\n          : this.selectionEnd + offset;\n      this.setSelectionStartEndWithShift(\n        this.selectionStart,\n        this.selectionEnd,\n        newSelection\n      );\n      return offset !== 0;\n    },\n\n    /**\n     * Moves cursor up without shift\n     * @param {Number} offset\n     */\n    moveCursorWithoutShift: function (offset) {\n      if (offset < 0) {\n        this.selectionStart += offset;\n        this.selectionEnd = this.selectionStart;\n      } else {\n        this.selectionEnd += offset;\n        this.selectionStart = this.selectionEnd;\n      }\n      return offset !== 0;\n    },\n\n    /**\n     * Moves cursor left\n     * @param {Event} e Event object\n     */\n    moveCursorLeft: function (e) {\n      if (this.selectionStart === 0 && this.selectionEnd === 0) {\n        return;\n      }\n      this._moveCursorLeftOrRight(\"Left\", e);\n    },\n\n    /**\n     * @private\n     * @return {Boolean} true if a change happened\n     */\n    _move: function (e, prop, direction) {\n      var newValue;\n      if (e.altKey) {\n        newValue = this[\"findWordBoundary\" + direction](this[prop]);\n      } else if (e.metaKey || e.keyCode === 35 || e.keyCode === 36) {\n        newValue = this[\"findLineBoundary\" + direction](this[prop]);\n      } else {\n        this[prop] += direction === \"Left\" ? -1 : 1;\n        return true;\n      }\n      if (typeof newValue !== undefined && this[prop] !== newValue) {\n        this[prop] = newValue;\n        return true;\n      }\n    },\n\n    /**\n     * @private\n     */\n    _moveLeft: function (e, prop) {\n      return this._move(e, prop, \"Left\");\n    },\n\n    /**\n     * @private\n     */\n    _moveRight: function (e, prop) {\n      return this._move(e, prop, \"Right\");\n    },\n\n    /**\n     * Moves cursor left without keeping selection\n     * @param {Event} e\n     */\n    moveCursorLeftWithoutShift: function (e) {\n      var change = true;\n      this._selectionDirection = \"left\";\n\n      // only move cursor when there is no selection,\n      // otherwise we discard it, and leave cursor on same place\n      if (\n        this.selectionEnd === this.selectionStart &&\n        this.selectionStart !== 0\n      ) {\n        change = this._moveLeft(e, \"selectionStart\");\n      }\n      this.selectionEnd = this.selectionStart;\n      return change;\n    },\n\n    /**\n     * Moves cursor left while keeping selection\n     * @param {Event} e\n     */\n    moveCursorLeftWithShift: function (e) {\n      if (\n        this._selectionDirection === \"right\" &&\n        this.selectionStart !== this.selectionEnd\n      ) {\n        return this._moveLeft(e, \"selectionEnd\");\n      } else if (this.selectionStart !== 0) {\n        this._selectionDirection = \"left\";\n        return this._moveLeft(e, \"selectionStart\");\n      }\n    },\n\n    /**\n     * Moves cursor right\n     * @param {Event} e Event object\n     */\n    moveCursorRight: function (e) {\n      if (\n        this.selectionStart >= this._text.length &&\n        this.selectionEnd >= this._text.length\n      ) {\n        return;\n      }\n      this._moveCursorLeftOrRight(\"Right\", e);\n    },\n\n    /**\n     * Moves cursor right or Left, fires event\n     * @param {String} direction 'Left', 'Right'\n     * @param {Event} e Event object\n     */\n    _moveCursorLeftOrRight: function (direction, e) {\n      var actionName = \"moveCursor\" + direction + \"With\";\n      this._currentCursorOpacity = 1;\n\n      if (e.shiftKey) {\n        actionName += \"Shift\";\n      } else {\n        actionName += \"outShift\";\n      }\n      if (this[actionName](e)) {\n        this.abortCursorAnimation();\n        this.initDelayedCursor();\n        this._fireSelectionChanged();\n        this._updateTextarea();\n      }\n    },\n\n    /**\n     * Moves cursor right while keeping selection\n     * @param {Event} e\n     */\n    moveCursorRightWithShift: function (e) {\n      if (\n        this._selectionDirection === \"left\" &&\n        this.selectionStart !== this.selectionEnd\n      ) {\n        return this._moveRight(e, \"selectionStart\");\n      } else if (this.selectionEnd !== this._text.length) {\n        this._selectionDirection = \"right\";\n        return this._moveRight(e, \"selectionEnd\");\n      }\n    },\n\n    /**\n     * Moves cursor right without keeping selection\n     * @param {Event} e Event object\n     */\n    moveCursorRightWithoutShift: function (e) {\n      var changed = true;\n      this._selectionDirection = \"right\";\n\n      if (this.selectionStart === this.selectionEnd) {\n        changed = this._moveRight(e, \"selectionStart\");\n        this.selectionEnd = this.selectionStart;\n      } else {\n        this.selectionStart = this.selectionEnd;\n      }\n      return changed;\n    },\n\n    /**\n     * Removes characters from start/end\n     * start/end ar per grapheme position in _text array.\n     *\n     * @param {Number} start\n     * @param {Number} end default to start + 1\n     */\n    removeChars: function (start, end) {\n      if (typeof end === \"undefined\") {\n        end = start + 1;\n      }\n      this.removeStyleFromTo(start, end);\n      this._text.splice(start, end - start);\n      this.text = this._text.join(\"\");\n      this.set(\"dirty\", true);\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      this._removeExtraneousStyles();\n    },\n\n    /**\n     * insert characters at start position, before start position.\n     * start  equal 1 it means the text get inserted between actual grapheme 0 and 1\n     * if style array is provided, it must be as the same length of text in graphemes\n     * if end is provided and is bigger than start, old text is replaced.\n     * start/end ar per grapheme position in _text array.\n     *\n     * @param {String} text text to insert\n     * @param {Array} style array of style objects\n     * @param {Number} start\n     * @param {Number} end default to start + 1\n     */\n    insertChars: function (text, style, start, end) {\n      if (typeof end === \"undefined\") {\n        end = start;\n      }\n      if (end > start) {\n        this.removeStyleFromTo(start, end);\n      }\n      var graphemes = fabric.util.string.graphemeSplit(text);\n      this.insertNewStyleBlock(graphemes, start, style);\n      this._text = [].concat(\n        this._text.slice(0, start),\n        graphemes,\n        this._text.slice(end)\n      );\n      this.text = this._text.join(\"\");\n      this.set(\"dirty\", true);\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      this._removeExtraneousStyles();\n    },\n  }\n);\n\n/* _TO_SVG_START_ */\n(function () {\n  var toFixed = fabric.util.toFixed,\n    multipleSpacesRegex = /  +/g;\n\n  fabric.util.object.extend(\n    fabric.Text.prototype,\n    /** @lends fabric.Text.prototype */ {\n      /**\n       * Returns SVG representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */\n      _toSVG: function () {\n        var offsets = this._getSVGLeftTopOffsets(),\n          textAndBg = this._getSVGTextAndBg(offsets.textTop, offsets.textLeft);\n        return this._wrapSVGTextAndBg(textAndBg);\n      },\n\n      /**\n       * Returns svg representation of an instance\n       * @param {Function} [reviver] Method for further parsing of svg representation.\n       * @return {String} svg representation of an instance\n       */\n      toSVG: function (reviver) {\n        return this._createBaseSVGMarkup(this._toSVG(), {\n          reviver: reviver,\n          noStyle: true,\n          withShadow: true,\n        });\n      },\n\n      /**\n       * @private\n       */\n      _getSVGLeftTopOffsets: function () {\n        return {\n          textLeft: -this.width / 2,\n          textTop: -this.height / 2,\n          lineTop: this.getHeightOfLine(0),\n        };\n      },\n\n      /**\n       * @private\n       */\n      _wrapSVGTextAndBg: function (textAndBg) {\n        var noShadow = true,\n          textDecoration = this.getSvgTextDecoration(this);\n        return [\n          textAndBg.textBgRects.join(\"\"),\n          '\\t\\t<text xml:space=\"preserve\" ',\n          this.fontFamily\n            ? 'font-family=\"' + this.fontFamily.replace(/\"/g, \"'\") + '\" '\n            : \"\",\n          this.fontSize ? 'font-size=\"' + this.fontSize + '\" ' : \"\",\n          this.fontStyle ? 'font-style=\"' + this.fontStyle + '\" ' : \"\",\n          this.fontWeight ? 'font-weight=\"' + this.fontWeight + '\" ' : \"\",\n          textDecoration ? 'text-decoration=\"' + textDecoration + '\" ' : \"\",\n          'style=\"',\n          this.getSvgStyles(noShadow),\n          '\"',\n          this.addPaintOrder(),\n          \" >\",\n          textAndBg.textSpans.join(\"\"),\n          \"</text>\\n\",\n        ];\n      },\n\n      /**\n       * @private\n       * @param {Number} textTopOffset Text top offset\n       * @param {Number} textLeftOffset Text left offset\n       * @return {Object}\n       */\n      _getSVGTextAndBg: function (textTopOffset, textLeftOffset) {\n        var textSpans = [],\n          textBgRects = [],\n          height = textTopOffset,\n          lineOffset;\n        // bounding-box background\n        this._setSVGBg(textBgRects);\n\n        // text and text-background\n        for (var i = 0, len = this._textLines.length; i < len; i++) {\n          lineOffset = this._getLineLeftOffset(i);\n          if (\n            this.textBackgroundColor ||\n            this.styleHas(\"textBackgroundColor\", i)\n          ) {\n            this._setSVGTextLineBg(\n              textBgRects,\n              i,\n              textLeftOffset + lineOffset,\n              height\n            );\n          }\n          this._setSVGTextLineText(\n            textSpans,\n            i,\n            textLeftOffset + lineOffset,\n            height\n          );\n          height += this.getHeightOfLine(i);\n        }\n\n        return {\n          textSpans: textSpans,\n          textBgRects: textBgRects,\n        };\n      },\n\n      /**\n       * @private\n       */\n      _createTextCharSpan: function (_char, styleDecl, left, top) {\n        var shouldUseWhitespace =\n            _char !== _char.trim() || _char.match(multipleSpacesRegex),\n          styleProps = this.getSvgSpanStyles(styleDecl, shouldUseWhitespace),\n          fillStyles = styleProps ? 'style=\"' + styleProps + '\"' : \"\",\n          dy = styleDecl.deltaY,\n          dySpan = \"\",\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n        if (dy) {\n          dySpan = ' dy=\"' + toFixed(dy, NUM_FRACTION_DIGITS) + '\" ';\n        }\n        return [\n          '<tspan x=\"',\n          toFixed(left, NUM_FRACTION_DIGITS),\n          '\" y=\"',\n          toFixed(top, NUM_FRACTION_DIGITS),\n          '\" ',\n          dySpan,\n          fillStyles,\n          \">\",\n          fabric.util.string.escapeXml(_char),\n          \"</tspan>\",\n        ].join(\"\");\n      },\n\n      _setSVGTextLineText: function (\n        textSpans,\n        lineIndex,\n        textLeftOffset,\n        textTopOffset\n      ) {\n        // set proper line offset\n        var lineHeight = this.getHeightOfLine(lineIndex),\n          isJustify = this.textAlign.indexOf(\"justify\") !== -1,\n          actualStyle,\n          nextStyle,\n          charsToRender = \"\",\n          charBox,\n          style,\n          boxWidth = 0,\n          line = this._textLines[lineIndex],\n          timeToRender;\n\n        textTopOffset +=\n          (lineHeight * (1 - this._fontSizeFraction)) / this.lineHeight;\n        for (var i = 0, len = line.length - 1; i <= len; i++) {\n          timeToRender = i === len || this.charSpacing;\n          charsToRender += line[i];\n          charBox = this.__charBounds[lineIndex][i];\n          if (boxWidth === 0) {\n            textLeftOffset += charBox.kernedWidth - charBox.width;\n            boxWidth += charBox.width;\n          } else {\n            boxWidth += charBox.kernedWidth;\n          }\n          if (isJustify && !timeToRender) {\n            if (this._reSpaceAndTab.test(line[i])) {\n              timeToRender = true;\n            }\n          }\n          if (!timeToRender) {\n            // if we have charSpacing, we render char by char\n            actualStyle =\n              actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\n            nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\n            timeToRender = this._hasStyleChangedForSvg(actualStyle, nextStyle);\n          }\n          if (timeToRender) {\n            style = this._getStyleDeclaration(lineIndex, i) || {};\n            textSpans.push(\n              this._createTextCharSpan(\n                charsToRender,\n                style,\n                textLeftOffset,\n                textTopOffset\n              )\n            );\n            charsToRender = \"\";\n            actualStyle = nextStyle;\n            textLeftOffset += boxWidth;\n            boxWidth = 0;\n          }\n        }\n      },\n\n      _pushTextBgRect: function (textBgRects, color, left, top, width, height) {\n        var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n        textBgRects.push(\n          \"\\t\\t<rect \",\n          this._getFillAttributes(color),\n          ' x=\"',\n          toFixed(left, NUM_FRACTION_DIGITS),\n          '\" y=\"',\n          toFixed(top, NUM_FRACTION_DIGITS),\n          '\" width=\"',\n          toFixed(width, NUM_FRACTION_DIGITS),\n          '\" height=\"',\n          toFixed(height, NUM_FRACTION_DIGITS),\n          '\"></rect>\\n'\n        );\n      },\n\n      _setSVGTextLineBg: function (textBgRects, i, leftOffset, textTopOffset) {\n        var line = this._textLines[i],\n          heightOfLine = this.getHeightOfLine(i) / this.lineHeight,\n          boxWidth = 0,\n          boxStart = 0,\n          charBox,\n          currentColor,\n          lastColor = this.getValueOfPropertyAt(i, 0, \"textBackgroundColor\");\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\n          charBox = this.__charBounds[i][j];\n          currentColor = this.getValueOfPropertyAt(i, j, \"textBackgroundColor\");\n          if (currentColor !== lastColor) {\n            lastColor &&\n              this._pushTextBgRect(\n                textBgRects,\n                lastColor,\n                leftOffset + boxStart,\n                textTopOffset,\n                boxWidth,\n                heightOfLine\n              );\n            boxStart = charBox.left;\n            boxWidth = charBox.width;\n            lastColor = currentColor;\n          } else {\n            boxWidth += charBox.kernedWidth;\n          }\n        }\n        currentColor &&\n          this._pushTextBgRect(\n            textBgRects,\n            currentColor,\n            leftOffset + boxStart,\n            textTopOffset,\n            boxWidth,\n            heightOfLine\n          );\n      },\n\n      /**\n       * Adobe Illustrator (at least CS5) is unable to render rgba()-based fill values\n       * we work around it by \"moving\" alpha channel into opacity attribute and setting fill's alpha to 1\n       *\n       * @private\n       * @param {*} value\n       * @return {String}\n       */\n      _getFillAttributes: function (value) {\n        var fillColor =\n          value && typeof value === \"string\" ? new fabric.Color(value) : \"\";\n        if (\n          !fillColor ||\n          !fillColor.getSource() ||\n          fillColor.getAlpha() === 1\n        ) {\n          return 'fill=\"' + value + '\"';\n        }\n        return (\n          'opacity=\"' +\n          fillColor.getAlpha() +\n          '\" fill=\"' +\n          fillColor.setAlpha(1).toRgb() +\n          '\"'\n        );\n      },\n\n      /**\n       * @private\n       */\n      _getSVGLineTopOffset: function (lineIndex) {\n        var lineTopOffset = 0,\n          lastHeight = 0;\n        for (var j = 0; j < lineIndex; j++) {\n          lineTopOffset += this.getHeightOfLine(j);\n        }\n        lastHeight = this.getHeightOfLine(j);\n        return {\n          lineTop: lineTopOffset,\n          offset:\n            ((this._fontSizeMult - this._fontSizeFraction) * lastHeight) /\n            (this.lineHeight * this._fontSizeMult),\n        };\n      },\n\n      /**\n       * Returns styles-string for svg-export\n       * @param {Boolean} skipShadow a boolean to skip shadow filter output\n       * @return {String}\n       */\n      getSvgStyles: function (skipShadow) {\n        var svgStyle = fabric.Object.prototype.getSvgStyles.call(\n          this,\n          skipShadow\n        );\n        return svgStyle + \" white-space: pre;\";\n      },\n    }\n  );\n})();\n/* _TO_SVG_END_ */\n\n(function (global) {\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  /**\n   * Textbox class, based on IText, allows the user to resize the text rectangle\n   * and wraps lines automatically. Textboxes have their Y scaling locked, the\n   * user can only change width. Height is adjusted automatically based on the\n   * wrapping of lines.\n   * @class fabric.Textbox\n   * @extends fabric.IText\n   * @mixes fabric.Observable\n   * @return {fabric.Textbox} thisArg\n   * @see {@link fabric.Textbox#initialize} for constructor definition\n   */\n  fabric.Textbox = fabric.util.createClass(fabric.IText, fabric.Observable, {\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: \"textbox\",\n\n    /**\n     * Minimum width of textbox, in pixels.\n     * @type Number\n     * @default\n     */\n    minWidth: 20,\n\n    /**\n     * Minimum calculated width of a textbox, in pixels.\n     * fixed to 2 so that an empty textbox cannot go to 0\n     * and is still selectable without text.\n     * @type Number\n     * @default\n     */\n    dynamicMinWidth: 2,\n\n    /**\n     * Cached array of text wrapping.\n     * @type Array\n     */\n    __cachedLines: null,\n\n    /**\n     * Override standard Object class values\n     */\n    lockScalingFlip: true,\n\n    /**\n     * Override standard Object class values\n     * Textbox needs this on false\n     */\n    noScaleCache: false,\n\n    /**\n     * Properties which when set cause object to change dimensions\n     * @type Object\n     * @private\n     */\n    _dimensionAffectingProps: fabric.Text.prototype._dimensionAffectingProps.concat(\n      \"width\"\n    ),\n\n    /**\n     * Use this regular expression to split strings in breakable lines\n     * @private\n     */\n    _wordJoiners: /[ \\t\\r]/,\n\n    /**\n     * Use this boolean property in order to split strings that have no white space concept.\n     * this is a cheap way to help with chinese/japaense\n     * @type Boolean\n     * @since 2.6.0\n     */\n    splitByGrapheme: false,\n\n    /**\n     * Unlike superclass's version of this function, Textbox does not update\n     * its width.\n     * @private\n     * @override\n     */\n    initDimensions: function () {\n      if (this.__skipDimension) {\n        return;\n      }\n      this.isEditing && this.initDelayedCursor();\n      this.clearContextTop();\n      this._clearCache();\n      // clear dynamicMinWidth as it will be different after we re-wrap line\n      this.dynamicMinWidth = 0;\n      // wrap lines\n      this._styleMap = this._generateStyleMap(this._splitText());\n      // if after wrapping, the width is smaller than dynamicMinWidth, change the width and re-wrap\n      if (this.dynamicMinWidth > this.width) {\n        this._set(\"width\", this.dynamicMinWidth);\n      }\n      if (this.textAlign.indexOf(\"justify\") !== -1) {\n        // once text is measured we need to make space fatter to make justified text.\n        this.enlargeSpaces();\n      }\n      // clear cache and re-calculate height\n      this.height = this.calcTextHeight();\n      this.saveState({ propertySet: \"_dimensionAffectingProps\" });\n    },\n\n    /**\n     * Generate an object that translates the style object so that it is\n     * broken up by visual lines (new lines and automatic wrapping).\n     * The original text styles object is broken up by actual lines (new lines only),\n     * which is only sufficient for Text / IText\n     * @private\n     */\n    _generateStyleMap: function (textInfo) {\n      var realLineCount = 0,\n        realLineCharCount = 0,\n        charCount = 0,\n        map = {};\n\n      for (var i = 0; i < textInfo.graphemeLines.length; i++) {\n        if (textInfo.graphemeText[charCount] === \"\\n\" && i > 0) {\n          realLineCharCount = 0;\n          charCount++;\n          realLineCount++;\n        } else if (\n          !this.splitByGrapheme &&\n          this._reSpaceAndTab.test(textInfo.graphemeText[charCount]) &&\n          i > 0\n        ) {\n          // this case deals with space's that are removed from end of lines when wrapping\n          realLineCharCount++;\n          charCount++;\n        }\n\n        map[i] = { line: realLineCount, offset: realLineCharCount };\n\n        charCount += textInfo.graphemeLines[i].length;\n        realLineCharCount += textInfo.graphemeLines[i].length;\n      }\n\n      return map;\n    },\n\n    /**\n     * Returns true if object has a style property or has it on a specified line\n     * @param {Number} lineIndex\n     * @return {Boolean}\n     */\n    styleHas: function (property, lineIndex) {\n      if (this._styleMap && !this.isWrapping) {\n        var map = this._styleMap[lineIndex];\n        if (map) {\n          lineIndex = map.line;\n        }\n      }\n      return fabric.Text.prototype.styleHas.call(this, property, lineIndex);\n    },\n\n    /**\n     * Returns true if object has no styling or no styling in a line\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\n     * @return {Boolean}\n     */\n    isEmptyStyles: function (lineIndex) {\n      if (!this.styles) {\n        return true;\n      }\n      var offset = 0,\n        nextLineIndex = lineIndex + 1,\n        nextOffset,\n        obj,\n        shouldLimit = false,\n        map = this._styleMap[lineIndex],\n        mapNextLine = this._styleMap[lineIndex + 1];\n      if (map) {\n        lineIndex = map.line;\n        offset = map.offset;\n      }\n      if (mapNextLine) {\n        nextLineIndex = mapNextLine.line;\n        shouldLimit = nextLineIndex === lineIndex;\n        nextOffset = mapNextLine.offset;\n      }\n      obj =\n        typeof lineIndex === \"undefined\"\n          ? this.styles\n          : { line: this.styles[lineIndex] };\n      for (var p1 in obj) {\n        for (var p2 in obj[p1]) {\n          if (p2 >= offset && (!shouldLimit || p2 < nextOffset)) {\n            // eslint-disable-next-line no-unused-vars\n            for (var p3 in obj[p1][p2]) {\n              return false;\n            }\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _getStyleDeclaration: function (lineIndex, charIndex) {\n      if (this._styleMap && !this.isWrapping) {\n        var map = this._styleMap[lineIndex];\n        if (!map) {\n          return null;\n        }\n        lineIndex = map.line;\n        charIndex = map.offset + charIndex;\n      }\n      return this.callSuper(\"_getStyleDeclaration\", lineIndex, charIndex);\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function (lineIndex, charIndex, style) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function (lineIndex, charIndex) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * probably broken need a fix\n     * Returns the real style line that correspond to the wrapped lineIndex line\n     * Used just to verify if the line does exist or not.\n     * @param {Number} lineIndex\n     * @returns {Boolean} if the line exists or not\n     * @private\n     */\n    _getLineStyle: function (lineIndex) {\n      var map = this._styleMap[lineIndex];\n      return !!this.styles[map.line];\n    },\n\n    /**\n     * Set the line style to an empty object so that is initialized\n     * @param {Number} lineIndex\n     * @param {Object} style\n     * @private\n     */\n    _setLineStyle: function (lineIndex) {\n      var map = this._styleMap[lineIndex];\n      this.styles[map.line] = {};\n    },\n\n    /**\n     * Wraps text using the 'width' property of Textbox. First this function\n     * splits text on newlines, so we preserve newlines entered by the user.\n     * Then it wraps each line using the width of the Textbox by calling\n     * _wrapLine().\n     * @param {Array} lines The string array of text that is split into lines\n     * @param {Number} desiredWidth width you want to wrap to\n     * @returns {Array} Array of lines\n     */\n    _wrapText: function (lines, desiredWidth) {\n      var wrapped = [],\n        i;\n      this.isWrapping = true;\n      for (i = 0; i < lines.length; i++) {\n        wrapped = wrapped.concat(this._wrapLine(lines[i], i, desiredWidth));\n      }\n      this.isWrapping = false;\n      return wrapped;\n    },\n\n    /**\n     * Helper function to measure a string of text, given its lineIndex and charIndex offset\n     * it gets called when charBounds are not available yet.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {String} text\n     * @param {number} lineIndex\n     * @param {number} charOffset\n     * @returns {number}\n     * @private\n     */\n    _measureWord: function (word, lineIndex, charOffset) {\n      var width = 0,\n        prevGrapheme,\n        skipLeft = true;\n      charOffset = charOffset || 0;\n      for (var i = 0, len = word.length; i < len; i++) {\n        var box = this._getGraphemeBox(\n          word[i],\n          lineIndex,\n          i + charOffset,\n          prevGrapheme,\n          skipLeft\n        );\n        width += box.kernedWidth;\n        prevGrapheme = word[i];\n      }\n      return width;\n    },\n\n    /**\n     * Wraps a line of text using the width of the Textbox and a context.\n     * @param {Array} line The grapheme array that represent the line\n     * @param {Number} lineIndex\n     * @param {Number} desiredWidth width you want to wrap the line to\n     * @param {Number} reservedSpace space to remove from wrapping for custom functionalities\n     * @returns {Array} Array of line(s) into which the given text is wrapped\n     * to.\n     */\n    _wrapLine: function (_line, lineIndex, desiredWidth, reservedSpace) {\n      var lineWidth = 0,\n        splitByGrapheme = this.splitByGrapheme,\n        graphemeLines = [],\n        line = [],\n        // spaces in different languges?\n        words = splitByGrapheme\n          ? fabric.util.string.graphemeSplit(_line)\n          : _line.split(this._wordJoiners),\n        word = \"\",\n        offset = 0,\n        infix = splitByGrapheme ? \"\" : \" \",\n        wordWidth = 0,\n        infixWidth = 0,\n        largestWordWidth = 0,\n        lineJustStarted = true,\n        additionalSpace = this._getWidthOfCharSpacing(),\n        reservedSpace = reservedSpace || 0;\n      // fix a difference between split and graphemeSplit\n      if (words.length === 0) {\n        words.push([]);\n      }\n      desiredWidth -= reservedSpace;\n      for (var i = 0; i < words.length; i++) {\n        // if using splitByGrapheme words are already in graphemes.\n        word = splitByGrapheme\n          ? words[i]\n          : fabric.util.string.graphemeSplit(words[i]);\n        wordWidth = this._measureWord(word, lineIndex, offset);\n        offset += word.length;\n\n        lineWidth += infixWidth + wordWidth - additionalSpace;\n        if (lineWidth >= desiredWidth && !lineJustStarted) {\n          graphemeLines.push(line);\n          line = [];\n          lineWidth = wordWidth;\n          lineJustStarted = true;\n        } else {\n          lineWidth += additionalSpace;\n        }\n\n        if (!lineJustStarted && !splitByGrapheme) {\n          line.push(infix);\n        }\n        line = line.concat(word);\n\n        infixWidth = splitByGrapheme\n          ? 0\n          : this._measureWord([infix], lineIndex, offset);\n        offset++;\n        lineJustStarted = false;\n        // keep track of largest word\n        if (wordWidth > largestWordWidth) {\n          largestWordWidth = wordWidth;\n        }\n      }\n\n      i && graphemeLines.push(line);\n\n      if (largestWordWidth + reservedSpace > this.dynamicMinWidth) {\n        this.dynamicMinWidth =\n          largestWordWidth - additionalSpace + reservedSpace;\n      }\n      return graphemeLines;\n    },\n\n    /**\n     * Detect if the text line is ended with an hard break\n     * text and itext do not have wrapping, return false\n     * @param {Number} lineIndex text to split\n     * @return {Boolean}\n     */\n    isEndOfWrapping: function (lineIndex) {\n      if (!this._styleMap[lineIndex + 1]) {\n        // is last line, return true;\n        return true;\n      }\n      if (\n        this._styleMap[lineIndex + 1].line !== this._styleMap[lineIndex].line\n      ) {\n        // this is last line before a line break, return true;\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Detect if a line has a linebreak and so we need to account for it when moving\n     * and counting style.\n     * @return Number\n     */\n    missingNewlineOffset: function (lineIndex) {\n      if (this.splitByGrapheme) {\n        return this.isEndOfWrapping(lineIndex) ? 1 : 0;\n      }\n      return 1;\n    },\n\n    /**\n     * Gets lines of text to render in the Textbox. This function calculates\n     * text wrapping on the fly every time it is called.\n     * @param {String} text text to split\n     * @returns {Array} Array of lines in the Textbox.\n     * @override\n     */\n    _splitTextIntoLines: function (text) {\n      var newText = fabric.Text.prototype._splitTextIntoLines.call(this, text),\n        graphemeLines = this._wrapText(newText.lines, this.width),\n        lines = new Array(graphemeLines.length);\n      for (var i = 0; i < graphemeLines.length; i++) {\n        lines[i] = graphemeLines[i].join(\"\");\n      }\n      newText.lines = lines;\n      newText.graphemeLines = graphemeLines;\n      return newText;\n    },\n\n    getMinWidth: function () {\n      return Math.max(this.minWidth, this.dynamicMinWidth);\n    },\n\n    _removeExtraneousStyles: function () {\n      var linesToKeep = {};\n      for (var prop in this._styleMap) {\n        if (this._textLines[prop]) {\n          linesToKeep[this._styleMap[prop].line] = 1;\n        }\n      }\n      for (var prop in this.styles) {\n        if (!linesToKeep[prop]) {\n          delete this.styles[prop];\n        }\n      }\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function (propertiesToInclude) {\n      return this.callSuper(\n        \"toObject\",\n        [\"minWidth\", \"splitByGrapheme\"].concat(propertiesToInclude)\n      );\n    },\n  });\n\n  /**\n   * Returns fabric.Textbox instance from an object representation\n   * @static\n   * @memberOf fabric.Textbox\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Textbox instance is created\n   */\n  fabric.Textbox.fromObject = function (object, callback) {\n    return fabric.Object._fromObject(\"Textbox\", object, callback, \"text\");\n  };\n})(typeof exports !== \"undefined\" ? exports : this);\n\n(function () {\n  var controlsUtils = fabric.controlsUtils,\n    scaleSkewStyleHandler = controlsUtils.scaleSkewCursorStyleHandler,\n    scaleStyleHandler = controlsUtils.scaleCursorStyleHandler,\n    scalingEqually = controlsUtils.scalingEqually,\n    scalingYOrSkewingX = controlsUtils.scalingYOrSkewingX,\n    scalingXOrSkewingY = controlsUtils.scalingXOrSkewingY,\n    scaleOrSkewActionName = controlsUtils.scaleOrSkewActionName,\n    objectControls = fabric.Object.prototype.controls;\n\n  objectControls.ml = new fabric.Control({\n    x: -0.5,\n    y: 0,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingXOrSkewingY,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mr = new fabric.Control({\n    x: 0.5,\n    y: 0,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingXOrSkewingY,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mb = new fabric.Control({\n    x: 0,\n    y: 0.5,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingYOrSkewingX,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mt = new fabric.Control({\n    x: 0,\n    y: -0.5,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingYOrSkewingX,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.tl = new fabric.Control({\n    x: -0.5,\n    y: -0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually,\n  });\n\n  objectControls.tr = new fabric.Control({\n    x: 0.5,\n    y: -0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually,\n  });\n\n  objectControls.bl = new fabric.Control({\n    x: -0.5,\n    y: 0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually,\n  });\n\n  objectControls.br = new fabric.Control({\n    x: 0.5,\n    y: 0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually,\n  });\n\n  objectControls.mtr = new fabric.Control({\n    x: 0,\n    y: -0.5,\n    actionHandler: controlsUtils.rotationWithSnapping,\n    cursorStyleHandler: controlsUtils.rotationStyleHandler,\n    offsetY: -40,\n    withConnection: true,\n    actionName: \"rotate\",\n  });\n\n  if (fabric.Textbox) {\n    // this is breaking the prototype inheritance, no time / ideas to fix it.\n    // is important to document that if you want to have all objects to have a\n    // specific custom control, you have to add it to Object prototype and to Textbox\n    // prototype. The controls are shared as references. So changes to control `tr`\n    // can still apply to all objects if needed.\n    var textBoxControls = (fabric.Textbox.prototype.controls = {});\n\n    textBoxControls.mtr = objectControls.mtr;\n    textBoxControls.tr = objectControls.tr;\n    textBoxControls.br = objectControls.br;\n    textBoxControls.tl = objectControls.tl;\n    textBoxControls.bl = objectControls.bl;\n    textBoxControls.mt = objectControls.mt;\n    textBoxControls.mb = objectControls.mb;\n\n    textBoxControls.mr = new fabric.Control({\n      x: 0.5,\n      y: 0,\n      actionHandler: controlsUtils.changeWidth,\n      cursorStyleHandler: scaleSkewStyleHandler,\n      actionName: \"resizing\",\n    });\n\n    textBoxControls.ml = new fabric.Control({\n      x: -0.5,\n      y: 0,\n      actionHandler: controlsUtils.changeWidth,\n      cursorStyleHandler: scaleSkewStyleHandler,\n      actionName: \"resizing\",\n    });\n  }\n})();\n"],"mappings":"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CA;AACA,SACMv1B,UAAU,CAAE,SAAUmD,EAAV,CAAcjc,OAAd,CAAuB,CACjCA,OAAO,GAAKA,OAAO,CAAG,EAAf,CAAP,CACA,KAAKwuC,mBAAL,CAA2B,KAAKC,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAA3B,CACA,KAAKC,qBAAL,CAA6B,KAAK9tC,gBAAL,CAAsB6tC,IAAtB,CAA2B,IAA3B,CAA7B,CACA,KAAKE,WAAL,CAAiB3yB,EAAjB,CAAqBjc,OAArB,EACA,KAAKo/C,gBAAL,GACA,KAAKC,kBAAL,GACD,CAdmC,CAgBpC;AACN;AACA;AACA;AACA;AACA;AACA,SACMnd,cAAc,CAAE,IAvBoB,CAyBpC;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SACMF,WAAW,CAAE,UArCuB,CAuCpC;AACN;AACA;AACA;AACA;AACA;AACA,SACMsd,eAAe,CAAE,KA9CmB,CAgDpC;AACN;AACA;AACA;AACA;AACA;AACA,SACMC,gBAAgB,CAAE,KAvDkB,CAyDpC;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SACMC,WAAW,CAAE,QAlEuB,CAoEpC;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SACMvc,YAAY,CAAE,UA7EsB,CA+EpC;AACN;AACA;AACA;AACA,SACM4M,WAAW,CAAE,IApFuB,CAsFpC;AACN;AACA;AACA;AACA,SACM4P,SAAS,CAAE,IA3FyB,CA6FpC;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SACMC,YAAY,CAAE,UAvGsB,CAyGpC;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SACMC,eAAe,CAAE,IArHmB,CAuHpC;AACN;AACA;AACA;AACA,SACMC,cAAc,CAAE,0BA5HoB,CA4HQ;AAE5C;AACN;AACA;AACA;AACA,SACMC,kBAAkB,CAAE,EAnIgB,CAqIpC;AACN;AACA;AACA;AACA,SACMC,oBAAoB,CAAE,0BA1Ic,CA4IpC;AACN;AACA;AACA;AACA,SACMC,kBAAkB,CAAE,CAjJgB,CAmJpC;AACN;AACA;AACA;AACA,SACMC,uBAAuB,CAAE,KAxJW,CA0JpC;AACN;AACA;AACA;AACA,SACMC,WAAW,CAAE,MA/JuB,CAiKpC;AACN;AACA;AACA;AACA,SACMC,UAAU,CAAE,MAtKwB,CAwKpC;AACN;AACA;AACA;AACA,SACMC,aAAa,CAAE,SA7KqB,CA+KpC;AACN;AACA;AACA;AACA,SACMC,iBAAiB,CAAE,WApLiB,CAsLpC;AACN;AACA;AACA;AACA,SACMC,cAAc,CAAE,WA3LoB,CA6LpC;AACN;AACA;AACA;AACA;AACA,SACMC,gBAAgB,CAAE,aAnMkB,CAqMpC;AACN;AACA;AACA;AACA,SACMC,cAAc,CAAE,kBA1MoB,CA4MpC;AACN;AACA;AACA;AACA,SACMC,kBAAkB,CAAE,KAjNgB,CAmNpC;AACN;AACA;AACA;AACA,SACMC,mBAAmB,CAAE,CAxNe,CA0NpC;AACN;AACA;AACA;AACA,SACMC,cAAc,CAAE,KA/NoB,CAiOpC;AACN;AACA;AACA;AACA;AACA;AACA;AACA,SACMC,aAAa,CAAE,KAzOqB,CA2OpC;AACN;AACA;AACA;AACA;AACA,SACMC,sBAAsB,CAAE,KAjPY,CAmPpC;AACN;AACA;AACA;AACA;AACA,SACMta,SAAS,CAAE,CAzPyB,CA2PpC;AACN;AACA;AACA;AACA;AACA;AACA,SACMC,aAAa,CAAE,IAlQqB,CAoQpC;AACN;AACA;AACA;AACA;AACA,SACMsa,eAAe,CAAE,KA1QmB,CA4QpC;AACN;AACA;AACA;AACA;AACA,SACMC,cAAc,CAAE,KAlRoB,CAoRpC;AACN;AACA;AACA;AACA;AACA,SACMC,eAAe,CAAE,KA1RmB,CA4RpC;AACN;AACA;AACA,SACMC,OAAO,CAAE,EAhS2B,CAkSpC;AACN;AACA;AACA;AACA,SACMC,cAAc,CAAE,IAvSoB,CAySpC;AACN;AACA;AACA;AACA,SACMC,eAAe,CAAE,EA9SmB,CAgTpC;AACN;AACA,SACM9B,gBAAgB,CAAE,UAAY,CAC5B,KAAK+B,iBAAL,CAAyB,IAAzB,CACA,KAAK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Z,CACdzd,MAAM,CAACmH,aADO,CAEd,qCAAsC,CACpC;AACN;AACA;AACA;AACA;AACA;AACA,SACMX,IAAI,CAAE,QAR8B,CAUpC;AACN;AACA;AACA;AACA;AACA,SACMoiC,OAAO,CAAE,MAhB2B,CAkBpC;AACN;AACA;AACA;AACA;AACA,SACMC,OAAO,CAAE,KAxB2B,CA0BpC;AACN;AACA;AACA;AACA,SACMp9B,GAAG,CAAE,CA/B+B,CAiCpC;AACN;AACA;AACA;AACA,SACMD,IAAI,CAAE,CAtC8B,CAwCpC;AACN;AACA;AACA;AACA,SACML,KAAK,CAAE,CA7C6B,CA+CpC;AACN;AACA;AACA;AACA,SACMI,MAAM,CAAE,CApD4B,CAsDpC;AACN;AACA;AACA;AACA,SACM6G,MAAM,CAAE,CA3D4B,CA6DpC;AACN;AACA;AACA;AACA,SACMC,MAAM,CAAE,CAlE4B,CAoEpC;AACN;AACA;AACA;AACA,SACMS,KAAK,CAAE,KAzE6B,CA2EpC;AACN;AACA;AACA;AACA,SACMC,KAAK,CAAE,KAhF6B,CAkFpC;AACN;AACA;AACA;AACA,SACM2M,OAAO,CAAE,CAvF2B,CAyFpC;AACN;AACA;AACA;AACA,SACM7W,KAAK,CAAE,CA9F6B,CAgGpC;AACN;AACA;AACA;AACA,SACMyJ,KAAK,CAAE,CArG6B,CAuGpC;AACN;AACA;AACA;AACA,SACMC,KAAK,CAAE,CA5G6B,CA8GpC;AACN;AACA;AACA;AACA,SACM66B,UAAU,CAAE,EAnHwB,CAqHpC;AACN;AACA;AACA;AACA,SACM4qB,eAAe,CAAE,EA1HmB,CA4HpC;AACN;AACA;AACA;AACA,SACM3qB,kBAAkB,CAAE,IAjIgB,CAmIpC;AACN;AACA;AACA;AACA,SACMyX,WAAW,CAAE,IAxIuB,CA0IpC;AACN;AACA;AACA;AACA,SACMC,UAAU,CAAE,IA/IwB,CAiJpC;AACN;AACA;AACA;AACA,SACM7b,OAAO,CAAE,CAtJ2B,CAwJpC;AACN;AACA;AACA;AACA,SACM+uB,WAAW,CAAE,kBA7JuB,CA+JpC;AACN;AACA;AACA;AACA,SACMC,eAAe,CAAE,IApKmB,CAsKpC;AACN;AACA;AACA;AACA,SACM1qB,WAAW,CAAE,kBA3KuB,CA6KpC;AACN;AACA;AACA;AACA;AACA,SACMF,iBAAiB,CAAE,IAnLiB,CAqLpC;AACN;AACA;AACA;AACA,SACM6B,WAAW,CAAE,MA1LuB,CA4LpC;AACN;AACA;AACA;AACA,SACMgpB,eAAe,CAAE,IAjMmB,CAmMpC;AACN;AACA;AACA;AACA;AACA;AACA;AACA,SACMhU,eAAe,CAAE,KA3MmB,CA6MpC;AACN;AACA;AACA;AACA;AACA;AACA;AACA,SACMC,gBAAgB,CAAE,IArNkB,CAuNpC;AACN;AACA;AACA;AACA;AACA,SACMhgD,IAAI,CAAE,YA7N8B,CA+NpC;AACN;AACA;AACA;AACA;AACA;AACA,SACM4xB,QAAQ,CAAE,SAtO0B,CAwOpC;AACN;AACA;AACA;AACA,SACMwjB,wBAAwB,CAAE,aA7OU,CA+OpC;AACN;AACA;AACA;AACA;AACA,SACM9F,eAAe,CAAE,EArPmB,CAuPpC;AACN;AACA;AACA;AACA;AACA,SACMoU,wBAAwB,CAAE,EA7PU,CA+PpC;AACN;AACA;AACA;AACA;AACA,SACM98B,MAAM,CAAE,IArQ4B,CAuQpC;AACN;AACA;AACA;AACA,SACM6hB,WAAW,CAAE,CA5QuB,CA8QpC;AACN;AACA;AACA,SACM8R,eAAe,CAAE,IAlRmB,CAoRpC;AACN;AACA;AACA;AACA,SACMyZ,gBAAgB,CAAE,CAzRkB,CA2RpC;AACN;AACA;AACA;AACA,SACM5Z,aAAa,CAAE,MAhSqB,CAkSpC;AACN;AACA;AACA;AACA,SACMC,cAAc,CAAE,OAvSoB,CAySpC;AACN;AACA;AACA;AACA,SACMC,gBAAgB,CAAE,CA9SkB,CAgTpC;AACN;AACA;AACA;AACA,SACM/L,MAAM,CAAE,IArT4B,CAuTpC;AACN;AACA;AACA;AACA,SACM0lB,uBAAuB,CAAE,GA5TW,CA8TpC;AACN;AACA;AACA;AACA;AACA;AACA;AACA,SACMC,iBAAiB,CAAE,CAtUiB,CAwUpC;AACN;AACA;AACA;AACA,SACMC,aAAa,CAAE,CA7UqB,CA+UpC;AACN;AACA;AACA;AACA;AACA,SACMlQ,UAAU,CAAE,IArVwB,CAuVpC;AACN;AACA;AACA;AACA,SACMD,OAAO,CAAE,IA5V2B,CA8VpC;AACN;AACA;AACA;AACA,SACMp8B,OAAO,CAAE,IAnW2B,CAqWpC;AACN;AACA;AACA;AACA,SACMwsC,WAAW,CAAE,IA1WuB,CA4WpC;AACN;AACA;AACA;AACA,SACMxQ,UAAU,CAAE,IAjXwB,CAmXpC;AACN;AACA;AACA;AACA,SACM3C,kBAAkB,CAAE,KAxXgB,CA0XpC;AACN;AACA;AACA;AACA,SACM7S,oBAAoB,CAAE,IA/Xc,CAiYpC;AACN;AACA;AACA;AACA,SACMimB,aAAa,CAAE,KAtYqB,CAwYpC;AACN;AACA;AACA;AACA,SACMC,aAAa,CAAE,KA7YqB,CA+YpC;AACN;AACA;AACA;AACA,SACMxwB,YAAY,CAAE,KApZsB,CAsZpC;AACN;AACA;AACA;AACA,SACMd,YAAY,CAAE,KA3ZsB,CA6ZpC;AACN;AACA;AACA;AACA,SACME,YAAY,CAAE,KAlasB,CAoapC;AACN;AACA;AACA;AACA,SACMM,YAAY,CAAE,KAzasB,CA2apC;AACN;AACA;AACA;AACA,SACMD,YAAY,CAAE,KAhbsB,CAkbpC;AACN;AACA;AACA;AACA,SACMkE,eAAe,CAAE,KAvbmB,CAybpC;AACN;AACA;AACA;AACA;AACA,SACMsP,iBAAiB,CAAE,KA/biB,CAicpC;AACN;AACA;AACA;AACA;AACA;AACA;AACA,SACM2c,aAAa,CAAEA,aAzcqB,CA2cpC;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SACMa,cAAc,CAAE,KArdoB,CAudpC;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SACMC,YAAY,CAAE,IAhesB,CAkepC;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SACM9rB,aAAa,CAAE,KA5eqB,CA8epC;AACN;AACA;AACA;AACA;AACA,SACM+rB,KAA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CACftM,MAAM,CAACilB,IAAP,CAAY,gCAAZ,EACA,OACD,CAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA,KACEjlB,MAAM,CAACsM,IAAP,CAActM,MAAM,CAACkE,IAAP,CAAYuZ,WAAZ,CACZzd,MAAM,CAACkQ,MADK,CAEZ,mCAAoC,CAClC;AACN;AACA;AACA;AACA,SACMu8E,wBAAwB,CAAE,CACxB,UADwB,CAExB,YAFwB,CAGxB,YAHwB,CAIxB,WAJwB,CAKxB,YALwB,CAMxB,MANwB,CAOxB,aAPwB,CAQxB,WARwB,CASxB,QATwB,CANQ,CAkBlC;AACN;AACA,SACMC,UAAU,CAAE,OArBsB,CAuBlC;AACN;AACA;AACA;AACA,SACMC,gBAAgB,CAAE,UA5BgB,CA8BlC;AACN;AACA;AACA;AACA,SACMC,cAAc,CAAE,SAnCkB,CAqClC;AACN;AACA;AACA;AACA,SACMC,QAAQ,CAAE,MA1CwB,CA4ClC;AACN;AACA;AACA;AACA,SACMrmF,IAAI,CAAE,MAjD4B,CAmDlC;AACN;AACA;AACA;AACA,SACM2F,QAAQ,CAAE,EAxDwB,CA0DlC;AACN;AACA;AACA;AACA,SACMmmB,UAAU,CAAE,QA/DsB,CAiElC;AACN;AACA;AACA;AACA,SACM9d,UAAU,CAAE,iBAtEsB,CAwElC;AACN;AACA;AACA;AACA,SACMs4E,SAAS,CAAE,KA7EuB,CA+ElC;AACN;AACA;AACA;AACA,SACMC,QAAQ,CAAE,KApFwB,CAsFlC;AACN;AACA;AACA;AACA,SACMC,WAAW,CAAE,KA3FqB,CA6FlC;AACN;AACA;AACA;AACA;AACA,SACMC,SAAS,CAAE,MAnGuB,CAqGlC;AACN;AACA;AACA;AACA,SACM56D,SAAS,CAAE,QA1GuB,CA4GlC;AACN;AACA;AACA;AACA,SACME,UAAU,CAAE,IAjHsB,CAmHlC;AACN;AACA;AACA;AACA,SACM26D,WAAW,CAAE,CACXrmF,IAAI,CAAE,GADK,CACA;AACXsmF,QAAQ,CAAE,CAAC,IAAM;AAFN,CAxHqB,CA6HlC;AACN;AACA;AACA;AACA,SACMC,SAAS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"},"metadata":{},"sourceType":"script"}