{"ast":null,"code":"'use strict';\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nconst tls = require('tls');\n\nconst net = require('net');\n\nconst debug = require('debug')('mqttjs:tls');\n\nfunction buildBuilder(mqttClient, opts) {\n  opts.port = opts.port || 8883;\n  opts.host = opts.hostname || opts.host || 'localhost';\n\n  if (net.isIP(opts.host) === 0) {\n    opts.servername = opts.host;\n  }\n\n  opts.rejectUnauthorized = opts.rejectUnauthorized !== false;\n  delete opts.path;\n  debug('port %d host %s rejectUnauthorized %b', opts.port, opts.host, opts.rejectUnauthorized);\n  const connection = tls.connect(opts);\n  /* eslint no-use-before-define: [2, \"nofunc\"] */\n\n  connection.on('secureConnect', function () {\n    if (opts.rejectUnauthorized && !connection.authorized) {\n      connection.emit('error', new Error('TLS not authorized'));\n    } else {\n      connection.removeListener('error', handleTLSerrors);\n    }\n  });\n\n  function handleTLSerrors(err) {\n    // How can I get verify this error is a tls error?\n    if (opts.rejectUnauthorized) {\n      mqttClient.emit('error', err);\n    } // close this connection to match the behaviour of net\n    // otherwise all we get is an error from the connection\n    // and close event doesn't fire. This is a work around\n    // to enable the reconnect code to work the same as with\n    // net.createConnection\n\n\n    connection.end();\n  }\n\n  connection.on('error', handleTLSerrors);\n  return connection;\n}\n\nmodule.exports = buildBuilder;","map":{"version":3,"names":["tls","require","net","debug","buildBuilder","mqttClient","opts","port","host","hostname","isIP","servername","rejectUnauthorized","path","connection","connect","on","authorized","emit","Error","removeListener","handleTLSerrors","err","end","module","exports"],"sources":["C:/Users/Danil/Desktop/122/node_modules/mqtt/lib/connect/tls.js"],"sourcesContent":["'use strict'\nconst tls = require('tls')\nconst net = require('net')\nconst debug = require('debug')('mqttjs:tls')\n\nfunction buildBuilder (mqttClient, opts) {\n  opts.port = opts.port || 8883\n  opts.host = opts.hostname || opts.host || 'localhost'\n\n  if (net.isIP(opts.host) === 0) {\n    opts.servername = opts.host\n  }\n\n  opts.rejectUnauthorized = opts.rejectUnauthorized !== false\n\n  delete opts.path\n\n  debug('port %d host %s rejectUnauthorized %b', opts.port, opts.host, opts.rejectUnauthorized)\n\n  const connection = tls.connect(opts)\n  /* eslint no-use-before-define: [2, \"nofunc\"] */\n  connection.on('secureConnect', function () {\n    if (opts.rejectUnauthorized && !connection.authorized) {\n      connection.emit('error', new Error('TLS not authorized'))\n    } else {\n      connection.removeListener('error', handleTLSerrors)\n    }\n  })\n\n  function handleTLSerrors (err) {\n    // How can I get verify this error is a tls error?\n    if (opts.rejectUnauthorized) {\n      mqttClient.emit('error', err)\n    }\n\n    // close this connection to match the behaviour of net\n    // otherwise all we get is an error from the connection\n    // and close event doesn't fire. This is a work around\n    // to enable the reconnect code to work the same as with\n    // net.createConnection\n    connection.end()\n  }\n\n  connection.on('error', handleTLSerrors)\n  return connection\n}\n\nmodule.exports = buildBuilder\n"],"mappings":"AAAA;;;;AACA,MAAMA,GAAG,GAAGC,OAAO,CAAC,KAAD,CAAnB;;AACA,MAAMC,GAAG,GAAGD,OAAO,CAAC,KAAD,CAAnB;;AACA,MAAME,KAAK,GAAGF,OAAO,CAAC,OAAD,CAAP,CAAiB,YAAjB,CAAd;;AAEA,SAASG,YAAT,CAAuBC,UAAvB,EAAmCC,IAAnC,EAAyC;EACvCA,IAAI,CAACC,IAAL,GAAYD,IAAI,CAACC,IAAL,IAAa,IAAzB;EACAD,IAAI,CAACE,IAAL,GAAYF,IAAI,CAACG,QAAL,IAAiBH,IAAI,CAACE,IAAtB,IAA8B,WAA1C;;EAEA,IAAIN,GAAG,CAACQ,IAAJ,CAASJ,IAAI,CAACE,IAAd,MAAwB,CAA5B,EAA+B;IAC7BF,IAAI,CAACK,UAAL,GAAkBL,IAAI,CAACE,IAAvB;EACD;;EAEDF,IAAI,CAACM,kBAAL,GAA0BN,IAAI,CAACM,kBAAL,KAA4B,KAAtD;EAEA,OAAON,IAAI,CAACO,IAAZ;EAEAV,KAAK,CAAC,uCAAD,EAA0CG,IAAI,CAACC,IAA/C,EAAqDD,IAAI,CAACE,IAA1D,EAAgEF,IAAI,CAACM,kBAArE,CAAL;EAEA,MAAME,UAAU,GAAGd,GAAG,CAACe,OAAJ,CAAYT,IAAZ,CAAnB;EACA;;EACAQ,UAAU,CAACE,EAAX,CAAc,eAAd,EAA+B,YAAY;IACzC,IAAIV,IAAI,CAACM,kBAAL,IAA2B,CAACE,UAAU,CAACG,UAA3C,EAAuD;MACrDH,UAAU,CAACI,IAAX,CAAgB,OAAhB,EAAyB,IAAIC,KAAJ,CAAU,oBAAV,CAAzB;IACD,CAFD,MAEO;MACLL,UAAU,CAACM,cAAX,CAA0B,OAA1B,EAAmCC,eAAnC;IACD;EACF,CAND;;EAQA,SAASA,eAAT,CAA0BC,GAA1B,EAA+B;IAC7B;IACA,IAAIhB,IAAI,CAACM,kBAAT,EAA6B;MAC3BP,UAAU,CAACa,IAAX,CAAgB,OAAhB,EAAyBI,GAAzB;IACD,CAJ4B,CAM7B;IACA;IACA;IACA;IACA;;;IACAR,UAAU,CAACS,GAAX;EACD;;EAEDT,UAAU,CAACE,EAAX,CAAc,OAAd,EAAuBK,eAAvB;EACA,OAAOP,UAAP;AACD;;AAEDU,MAAM,CAACC,OAAP,GAAiBrB,YAAjB"},"metadata":{},"sourceType":"script"}