{"ast":null,"code":"'use strict';\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nconst MqttClient = require('../client');\n\nconst Store = require('../store');\n\nconst url = require('url');\n\nconst xtend = require('xtend');\n\nconst debug = require('debug')('mqttjs');\n\nconst protocols = {}; // eslint-disable-next-line camelcase\n\nif (typeof process !== 'undefined' && process.title !== 'browser' || typeof __webpack_require__ !== 'function') {\n  protocols.mqtt = require('./tcp');\n  protocols.tcp = require('./tcp');\n  protocols.ssl = require('./tls');\n  protocols.tls = require('./tls');\n  protocols.mqtts = require('./tls');\n} else {\n  protocols.wx = require('./wx');\n  protocols.wxs = require('./wx');\n  protocols.ali = require('./ali');\n  protocols.alis = require('./ali');\n}\n\nprotocols.ws = require('./ws');\nprotocols.wss = require('./ws');\n/**\n * Parse the auth attribute and merge username and password in the options object.\n *\n * @param {Object} [opts] option object\n */\n\nfunction parseAuthOptions(opts) {\n  let matches;\n\n  if (opts.auth) {\n    matches = opts.auth.match(/^(.+):(.+)$/);\n\n    if (matches) {\n      opts.username = matches[1];\n      opts.password = matches[2];\n    } else {\n      opts.username = opts.auth;\n    }\n  }\n}\n/**\n * connect - connect to an MQTT broker.\n *\n * @param {String} [brokerUrl] - url of the broker, optional\n * @param {Object} opts - see MqttClient#constructor\n */\n\n\nfunction connect(brokerUrl, opts) {\n  debug('connecting to an MQTT broker...');\n\n  if (typeof brokerUrl === 'object' && !opts) {\n    opts = brokerUrl;\n    brokerUrl = null;\n  }\n\n  opts = opts || {};\n\n  if (brokerUrl) {\n    // eslint-disable-next-line\n    const parsed = url.parse(brokerUrl, true);\n\n    if (parsed.port != null) {\n      parsed.port = Number(parsed.port);\n    }\n\n    opts = xtend(parsed, opts);\n\n    if (opts.protocol === null) {\n      throw new Error('Missing protocol');\n    }\n\n    opts.protocol = opts.protocol.replace(/:$/, '');\n  } // merge in the auth options if supplied\n\n\n  parseAuthOptions(opts); // support clientId passed in the query string of the url\n\n  if (opts.query && typeof opts.query.clientId === 'string') {\n    opts.clientId = opts.query.clientId;\n  }\n\n  if (opts.cert && opts.key) {\n    if (opts.protocol) {\n      if (['mqtts', 'wss', 'wxs', 'alis'].indexOf(opts.protocol) === -1) {\n        switch (opts.protocol) {\n          case 'mqtt':\n            opts.protocol = 'mqtts';\n            break;\n\n          case 'ws':\n            opts.protocol = 'wss';\n            break;\n\n          case 'wx':\n            opts.protocol = 'wxs';\n            break;\n\n          case 'ali':\n            opts.protocol = 'alis';\n            break;\n\n          default:\n            throw new Error('Unknown protocol for secure connection: \"' + opts.protocol + '\"!');\n        }\n      }\n    } else {\n      // A cert and key was provided, however no protocol was specified, so we will throw an error.\n      throw new Error('Missing secure protocol key');\n    }\n  }\n\n  if (!protocols[opts.protocol]) {\n    const isSecure = ['mqtts', 'wss'].indexOf(opts.protocol) !== -1;\n    opts.protocol = ['mqtt', 'mqtts', 'ws', 'wss', 'wx', 'wxs', 'ali', 'alis'].filter(function (key, index) {\n      if (isSecure && index % 2 === 0) {\n        // Skip insecure protocols when requesting a secure one.\n        return false;\n      }\n\n      return typeof protocols[key] === 'function';\n    })[0];\n  }\n\n  if (opts.clean === false && !opts.clientId) {\n    throw new Error('Missing clientId for unclean clients');\n  }\n\n  if (opts.protocol) {\n    opts.defaultProtocol = opts.protocol;\n  }\n\n  function wrapper(client) {\n    if (opts.servers) {\n      if (!client._reconnectCount || client._reconnectCount === opts.servers.length) {\n        client._reconnectCount = 0;\n      }\n\n      opts.host = opts.servers[client._reconnectCount].host;\n      opts.port = opts.servers[client._reconnectCount].port;\n      opts.protocol = !opts.servers[client._reconnectCount].protocol ? opts.defaultProtocol : opts.servers[client._reconnectCount].protocol;\n      opts.hostname = opts.host;\n      client._reconnectCount++;\n    }\n\n    debug('calling streambuilder for', opts.protocol);\n    return protocols[opts.protocol](client, opts);\n  }\n\n  const client = new MqttClient(wrapper, opts);\n  client.on('error', function () {\n    /* Automatically set up client error handling */\n  });\n  return client;\n}\n\nmodule.exports = connect;\nmodule.exports.connect = connect;\nmodule.exports.MqttClient = MqttClient;\nmodule.exports.Store = Store;","map":{"version":3,"names":["MqttClient","require","Store","url","xtend","debug","protocols","process","title","__webpack_require__","mqtt","tcp","ssl","tls","mqtts","wx","wxs","ali","alis","ws","wss","parseAuthOptions","opts","matches","auth","match","username","password","connect","brokerUrl","parsed","parse","port","Number","protocol","Error","replace","query","clientId","cert","key","indexOf","isSecure","filter","index","clean","defaultProtocol","wrapper","client","servers","_reconnectCount","length","host","hostname","on","module","exports"],"sources":["C:/Users/Danil/Desktop/project1/node_modules/mqtt/lib/connect/index.js"],"sourcesContent":["'use strict'\n\nconst MqttClient = require('../client')\nconst Store = require('../store')\nconst url = require('url')\nconst xtend = require('xtend')\nconst debug = require('debug')('mqttjs')\n\nconst protocols = {}\n\n// eslint-disable-next-line camelcase\nif ((typeof process !== 'undefined' && process.title !== 'browser') || typeof __webpack_require__ !== 'function') {\n  protocols.mqtt = require('./tcp')\n  protocols.tcp = require('./tcp')\n  protocols.ssl = require('./tls')\n  protocols.tls = require('./tls')\n  protocols.mqtts = require('./tls')\n} else {\n  protocols.wx = require('./wx')\n  protocols.wxs = require('./wx')\n\n  protocols.ali = require('./ali')\n  protocols.alis = require('./ali')\n}\n\nprotocols.ws = require('./ws')\nprotocols.wss = require('./ws')\n\n/**\n * Parse the auth attribute and merge username and password in the options object.\n *\n * @param {Object} [opts] option object\n */\nfunction parseAuthOptions (opts) {\n  let matches\n  if (opts.auth) {\n    matches = opts.auth.match(/^(.+):(.+)$/)\n    if (matches) {\n      opts.username = matches[1]\n      opts.password = matches[2]\n    } else {\n      opts.username = opts.auth\n    }\n  }\n}\n\n/**\n * connect - connect to an MQTT broker.\n *\n * @param {String} [brokerUrl] - url of the broker, optional\n * @param {Object} opts - see MqttClient#constructor\n */\nfunction connect (brokerUrl, opts) {\n  debug('connecting to an MQTT broker...')\n  if ((typeof brokerUrl === 'object') && !opts) {\n    opts = brokerUrl\n    brokerUrl = null\n  }\n\n  opts = opts || {}\n\n  if (brokerUrl) {\n    // eslint-disable-next-line\n    const parsed = url.parse(brokerUrl, true)\n    if (parsed.port != null) {\n      parsed.port = Number(parsed.port)\n    }\n\n    opts = xtend(parsed, opts)\n\n    if (opts.protocol === null) {\n      throw new Error('Missing protocol')\n    }\n\n    opts.protocol = opts.protocol.replace(/:$/, '')\n  }\n\n  // merge in the auth options if supplied\n  parseAuthOptions(opts)\n\n  // support clientId passed in the query string of the url\n  if (opts.query && typeof opts.query.clientId === 'string') {\n    opts.clientId = opts.query.clientId\n  }\n\n  if (opts.cert && opts.key) {\n    if (opts.protocol) {\n      if (['mqtts', 'wss', 'wxs', 'alis'].indexOf(opts.protocol) === -1) {\n        switch (opts.protocol) {\n          case 'mqtt':\n            opts.protocol = 'mqtts'\n            break\n          case 'ws':\n            opts.protocol = 'wss'\n            break\n          case 'wx':\n            opts.protocol = 'wxs'\n            break\n          case 'ali':\n            opts.protocol = 'alis'\n            break\n          default:\n            throw new Error('Unknown protocol for secure connection: \"' + opts.protocol + '\"!')\n        }\n      }\n    } else {\n      // A cert and key was provided, however no protocol was specified, so we will throw an error.\n      throw new Error('Missing secure protocol key')\n    }\n  }\n\n  if (!protocols[opts.protocol]) {\n    const isSecure = ['mqtts', 'wss'].indexOf(opts.protocol) !== -1\n    opts.protocol = [\n      'mqtt',\n      'mqtts',\n      'ws',\n      'wss',\n      'wx',\n      'wxs',\n      'ali',\n      'alis'\n    ].filter(function (key, index) {\n      if (isSecure && index % 2 === 0) {\n        // Skip insecure protocols when requesting a secure one.\n        return false\n      }\n      return (typeof protocols[key] === 'function')\n    })[0]\n  }\n\n  if (opts.clean === false && !opts.clientId) {\n    throw new Error('Missing clientId for unclean clients')\n  }\n\n  if (opts.protocol) {\n    opts.defaultProtocol = opts.protocol\n  }\n\n  function wrapper (client) {\n    if (opts.servers) {\n      if (!client._reconnectCount || client._reconnectCount === opts.servers.length) {\n        client._reconnectCount = 0\n      }\n\n      opts.host = opts.servers[client._reconnectCount].host\n      opts.port = opts.servers[client._reconnectCount].port\n      opts.protocol = (!opts.servers[client._reconnectCount].protocol ? opts.defaultProtocol : opts.servers[client._reconnectCount].protocol)\n      opts.hostname = opts.host\n\n      client._reconnectCount++\n    }\n\n    debug('calling streambuilder for', opts.protocol)\n    return protocols[opts.protocol](client, opts)\n  }\n  const client = new MqttClient(wrapper, opts)\n  client.on('error', function () { /* Automatically set up client error handling */ })\n  return client\n}\n\nmodule.exports = connect\nmodule.exports.connect = connect\nmodule.exports.MqttClient = MqttClient\nmodule.exports.Store = Store\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}