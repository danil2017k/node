{"ast":null,"code":"'use strict';\n/**\n * Module dependencies\n */\n\nconst LruMap = require('lru-cache');\n\nconst NumberAllocator = require('number-allocator').NumberAllocator;\n/**\n * Topic Alias sending manager\n * This holds both topic to alias and alias to topic map\n * @param {Number} [max] - topic alias maximum entries\n */\n\n\nfunction TopicAliasSend(max) {\n  if (!(this instanceof TopicAliasSend)) {\n    return new TopicAliasSend(max);\n  }\n\n  if (max > 0) {\n    this.aliasToTopic = new LruMap({\n      max: max\n    });\n    this.topicToAlias = {};\n    this.numberAllocator = new NumberAllocator(1, max);\n    this.max = max;\n    this.length = 0;\n  }\n}\n/**\n * Insert or update topic - alias entry.\n * @param {String} [topic] - topic\n * @param {Number} [alias] - topic alias\n * @returns {Boolean} - if success return true otherwise false\n */\n\n\nTopicAliasSend.prototype.put = function (topic, alias) {\n  if (alias === 0 || alias > this.max) {\n    return false;\n  }\n\n  const entry = this.aliasToTopic.get(alias);\n\n  if (entry) {\n    delete this.topicToAlias[entry];\n  }\n\n  this.aliasToTopic.set(alias, topic);\n  this.topicToAlias[topic] = alias;\n  this.numberAllocator.use(alias);\n  this.length = this.aliasToTopic.length;\n  return true;\n};\n/**\n * Get topic by alias\n * @param {Number} [alias] - topic alias\n * @returns {String} - if mapped topic exists return topic, otherwise return undefined\n */\n\n\nTopicAliasSend.prototype.getTopicByAlias = function (alias) {\n  return this.aliasToTopic.get(alias);\n};\n/**\n * Get topic by alias\n * @param {String} [topic] - topic\n * @returns {Number} - if mapped topic exists return topic alias, otherwise return undefined\n */\n\n\nTopicAliasSend.prototype.getAliasByTopic = function (topic) {\n  const alias = this.topicToAlias[topic];\n\n  if (typeof alias !== 'undefined') {\n    this.aliasToTopic.get(alias); // LRU update\n  }\n\n  return alias;\n};\n/**\n * Clear all entries\n */\n\n\nTopicAliasSend.prototype.clear = function () {\n  this.aliasToTopic.reset();\n  this.topicToAlias = {};\n  this.numberAllocator.clear();\n  this.length = 0;\n};\n/**\n * Get Least Recently Used (LRU) topic alias\n * @returns {Number} - if vacant alias exists then return it, otherwise then return LRU alias\n */\n\n\nTopicAliasSend.prototype.getLruAlias = function () {\n  const alias = this.numberAllocator.firstVacant();\n  if (alias) return alias;\n  return this.aliasToTopic.keys()[this.aliasToTopic.length - 1];\n};\n\nmodule.exports = TopicAliasSend;","map":{"version":3,"names":["LruMap","require","NumberAllocator","TopicAliasSend","max","aliasToTopic","topicToAlias","numberAllocator","length","prototype","put","topic","alias","entry","get","set","use","getTopicByAlias","getAliasByTopic","clear","reset","getLruAlias","firstVacant","keys","module","exports"],"sources":["C:/Users/Danil/Desktop/122/node_modules/mqtt/lib/topic-alias-send.js"],"sourcesContent":["'use strict'\n\n/**\n * Module dependencies\n */\nconst LruMap = require('lru-cache')\nconst NumberAllocator = require('number-allocator').NumberAllocator\n\n/**\n * Topic Alias sending manager\n * This holds both topic to alias and alias to topic map\n * @param {Number} [max] - topic alias maximum entries\n */\nfunction TopicAliasSend (max) {\n  if (!(this instanceof TopicAliasSend)) {\n    return new TopicAliasSend(max)\n  }\n\n  if (max > 0) {\n    this.aliasToTopic = new LruMap({ max: max })\n    this.topicToAlias = {}\n    this.numberAllocator = new NumberAllocator(1, max)\n    this.max = max\n    this.length = 0\n  }\n}\n\n/**\n * Insert or update topic - alias entry.\n * @param {String} [topic] - topic\n * @param {Number} [alias] - topic alias\n * @returns {Boolean} - if success return true otherwise false\n */\nTopicAliasSend.prototype.put = function (topic, alias) {\n  if (alias === 0 || alias > this.max) {\n    return false\n  }\n  const entry = this.aliasToTopic.get(alias)\n  if (entry) {\n    delete this.topicToAlias[entry]\n  }\n  this.aliasToTopic.set(alias, topic)\n  this.topicToAlias[topic] = alias\n  this.numberAllocator.use(alias)\n  this.length = this.aliasToTopic.length\n  return true\n}\n\n/**\n * Get topic by alias\n * @param {Number} [alias] - topic alias\n * @returns {String} - if mapped topic exists return topic, otherwise return undefined\n */\nTopicAliasSend.prototype.getTopicByAlias = function (alias) {\n  return this.aliasToTopic.get(alias)\n}\n\n/**\n * Get topic by alias\n * @param {String} [topic] - topic\n * @returns {Number} - if mapped topic exists return topic alias, otherwise return undefined\n */\nTopicAliasSend.prototype.getAliasByTopic = function (topic) {\n  const alias = this.topicToAlias[topic]\n  if (typeof alias !== 'undefined') {\n    this.aliasToTopic.get(alias) // LRU update\n  }\n  return alias\n}\n\n/**\n * Clear all entries\n */\nTopicAliasSend.prototype.clear = function () {\n  this.aliasToTopic.reset()\n  this.topicToAlias = {}\n  this.numberAllocator.clear()\n  this.length = 0\n}\n\n/**\n * Get Least Recently Used (LRU) topic alias\n * @returns {Number} - if vacant alias exists then return it, otherwise then return LRU alias\n */\nTopicAliasSend.prototype.getLruAlias = function () {\n  const alias = this.numberAllocator.firstVacant()\n  if (alias) return alias\n  return this.aliasToTopic.keys()[this.aliasToTopic.length - 1]\n}\n\nmodule.exports = TopicAliasSend\n"],"mappings":"AAAA;AAEA;AACA;AACA;;AACA,MAAMA,MAAM,GAAGC,OAAO,CAAC,WAAD,CAAtB;;AACA,MAAMC,eAAe,GAAGD,OAAO,CAAC,kBAAD,CAAP,CAA4BC,eAApD;AAEA;AACA;AACA;AACA;AACA;;;AACA,SAASC,cAAT,CAAyBC,GAAzB,EAA8B;EAC5B,IAAI,EAAE,gBAAgBD,cAAlB,CAAJ,EAAuC;IACrC,OAAO,IAAIA,cAAJ,CAAmBC,GAAnB,CAAP;EACD;;EAED,IAAIA,GAAG,GAAG,CAAV,EAAa;IACX,KAAKC,YAAL,GAAoB,IAAIL,MAAJ,CAAW;MAAEI,GAAG,EAAEA;IAAP,CAAX,CAApB;IACA,KAAKE,YAAL,GAAoB,EAApB;IACA,KAAKC,eAAL,GAAuB,IAAIL,eAAJ,CAAoB,CAApB,EAAuBE,GAAvB,CAAvB;IACA,KAAKA,GAAL,GAAWA,GAAX;IACA,KAAKI,MAAL,GAAc,CAAd;EACD;AACF;AAED;AACA;AACA;AACA;AACA;AACA;;;AACAL,cAAc,CAACM,SAAf,CAAyBC,GAAzB,GAA+B,UAAUC,KAAV,EAAiBC,KAAjB,EAAwB;EACrD,IAAIA,KAAK,KAAK,CAAV,IAAeA,KAAK,GAAG,KAAKR,GAAhC,EAAqC;IACnC,OAAO,KAAP;EACD;;EACD,MAAMS,KAAK,GAAG,KAAKR,YAAL,CAAkBS,GAAlB,CAAsBF,KAAtB,CAAd;;EACA,IAAIC,KAAJ,EAAW;IACT,OAAO,KAAKP,YAAL,CAAkBO,KAAlB,CAAP;EACD;;EACD,KAAKR,YAAL,CAAkBU,GAAlB,CAAsBH,KAAtB,EAA6BD,KAA7B;EACA,KAAKL,YAAL,CAAkBK,KAAlB,IAA2BC,KAA3B;EACA,KAAKL,eAAL,CAAqBS,GAArB,CAAyBJ,KAAzB;EACA,KAAKJ,MAAL,GAAc,KAAKH,YAAL,CAAkBG,MAAhC;EACA,OAAO,IAAP;AACD,CAbD;AAeA;AACA;AACA;AACA;AACA;;;AACAL,cAAc,CAACM,SAAf,CAAyBQ,eAAzB,GAA2C,UAAUL,KAAV,EAAiB;EAC1D,OAAO,KAAKP,YAAL,CAAkBS,GAAlB,CAAsBF,KAAtB,CAAP;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;;;AACAT,cAAc,CAACM,SAAf,CAAyBS,eAAzB,GAA2C,UAAUP,KAAV,EAAiB;EAC1D,MAAMC,KAAK,GAAG,KAAKN,YAAL,CAAkBK,KAAlB,CAAd;;EACA,IAAI,OAAOC,KAAP,KAAiB,WAArB,EAAkC;IAChC,KAAKP,YAAL,CAAkBS,GAAlB,CAAsBF,KAAtB,EADgC,CACH;EAC9B;;EACD,OAAOA,KAAP;AACD,CAND;AAQA;AACA;AACA;;;AACAT,cAAc,CAACM,SAAf,CAAyBU,KAAzB,GAAiC,YAAY;EAC3C,KAAKd,YAAL,CAAkBe,KAAlB;EACA,KAAKd,YAAL,GAAoB,EAApB;EACA,KAAKC,eAAL,CAAqBY,KAArB;EACA,KAAKX,MAAL,GAAc,CAAd;AACD,CALD;AAOA;AACA;AACA;AACA;;;AACAL,cAAc,CAACM,SAAf,CAAyBY,WAAzB,GAAuC,YAAY;EACjD,MAAMT,KAAK,GAAG,KAAKL,eAAL,CAAqBe,WAArB,EAAd;EACA,IAAIV,KAAJ,EAAW,OAAOA,KAAP;EACX,OAAO,KAAKP,YAAL,CAAkBkB,IAAlB,GAAyB,KAAKlB,YAAL,CAAkBG,MAAlB,GAA2B,CAApD,CAAP;AACD,CAJD;;AAMAgB,MAAM,CAACC,OAAP,GAAiBtB,cAAjB"},"metadata":{},"sourceType":"script"}