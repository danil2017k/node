{"ast":null,"code":"import axios from 'axios';\nimport router from '@/router';\nimport WebSocket from 'reconnecting-websocket';\nimport Vue from 'vue';\nimport moment from 'moment';\nexport const login = ({\n  commit,\n  dispatch\n}, credentials) => {\n  return axios.post('/api/session', credentials);\n};\nexport const signup = ({\n  commit,\n  dispatch\n}, data) => {\n  return axios.post('/api/account', data);\n};\nexport const sendRestoreMail = ({\n  commit,\n  dispatch\n}, email) => {\n  return axios.post('/api/account/restore', {\n    email\n  });\n};\nexport const confirmRestore = ({\n  commit\n}, credentials) => {\n  axios.post('/api/account/restore', credentials).then(() => {\n    router.push('/');\n  }).catch(({\n    response\n  }) => {\n    console.error(response);\n  });\n};\nexport const getAccount = ({\n  commit,\n  dispatch,\n  state\n}) => {\n  return new Promise((resolve, reject) => {\n    axios.get('/api/account').then(({\n      data\n    }) => {\n      axios.get('/api/cases/notification/1').then(res => commit('SET_HOTIFICATION_HISTORY', res.data));\n      data.socket = new WebSocket(`${location.protocol === 'https:' ? 'wss' : 'ws'}://${location.host}/websocket/userId=${data.id}`, [], {\n        maxReconnectionDelay: 10000,\n        minReconnectionDelay: 1000,\n        reconnectionDelayGrowFactor: 1.2,\n        connectionTimeout: 3000\n      });\n\n      data.socket.onmessage = msg => dispatch('proceedSocketMessage', msg.data);\n\n      data.socket.onerror = error => console.log('Ошибка соединения:' + JSON.stringify(error));\n\n      data.socket.onclose = event => {\n        if (event.wasClean) {\n          console.log('Соединение закрыто чисто');\n        } else {\n          console.log('Обрыв соединения');\n        }\n\n        console.log('Код: ' + event.code + ' причина: ' + JSON.stringify(event));\n      }; // Change locale on account load or change\n\n\n      Vue.config.lang = data.locale || 'ru';\n      moment.locale(data.locale);\n\n      if (data.access['admin']) {\n        const msg = {\n          type: 'admin_session',\n          author: data,\n          id: 'admin_' + data.id\n        };\n        commit('ADD_NOTIFICATION', msg);\n        setTimeout(() => {\n          if (state.notifications.find(elem => elem.id === msg.id)) commit('SHIFT_NOTIFICATION');\n        }, 10000);\n      }\n\n      resolve(commit('LOAD_ACCOUNT', data));\n      return axios.get('/api/autocompletes/collaborators');\n    }).then(({\n      data\n    }) => {\n      resolve(commit('SET_ALL_COLLABORATORS', data.collaborators));\n    }).catch(reject);\n  });\n};\nexport const changeAccount = ({\n  commit,\n  dispatch\n}, payload) => {\n  if (!payload.silentSave) {\n    commit('LOADING');\n  }\n\n  return new Promise((resolve, reject) => {\n    axios.put('/api/account', payload).then(() => {\n      if (payload.silentSave) {\n        return;\n      }\n\n      if (payload.locale) {\n        commit('ACCOUNT_LOCALE_CHANGE', payload);\n        Vue.config.lang = payload.locale;\n        moment.locale(payload.locale);\n      } else {\n        resolve(dispatch('getAccount'));\n      }\n    }).catch(e => {\n      if (e.response.data.error === 'wrong_old_password') {\n        reject('wrong_old_password');\n      } else {\n        reject(e);\n      }\n    });\n  });\n};\nexport const changeAvatar = ({\n  commit,\n  dispatch\n}, payload) => {\n  commit('LOADING');\n  axios.post('/api/account/avatar', payload).then(() => dispatch('getAccount')).catch(console.error);\n};\nexport const logout = ({\n  commit\n}) => {\n  axios.delete('/api/session').then(() => {\n    commit('LOGOUT');\n    router.push('/login');\n    commit('SHIFT_NOTIFICATION');\n  });\n}; // WEBPACK FOOTER //\n// ./src/store/actions/account.js","map":{"version":3,"names":["axios","router","WebSocket","Vue","moment","login","commit","dispatch","credentials","post","signup","data","sendRestoreMail","email","confirmRestore","then","push","catch","response","console","error","getAccount","state","Promise","resolve","reject","get","res","socket","location","protocol","host","id","maxReconnectionDelay","minReconnectionDelay","reconnectionDelayGrowFactor","connectionTimeout","onmessage","msg","onerror","log","JSON","stringify","onclose","event","wasClean","code","config","lang","locale","access","type","author","setTimeout","notifications","find","elem","collaborators","changeAccount","payload","silentSave","put","e","changeAvatar","logout","delete"],"sources":["C:/Users/Danil/Desktop/project1/src/store/action/account.js"],"sourcesContent":["import axios from 'axios'\r\nimport router from '@/router'\r\nimport WebSocket from 'reconnecting-websocket'\r\nimport Vue from 'vue'\r\nimport moment from 'moment'\r\n\r\nexport const login = ({ commit, dispatch }, credentials) => {\r\n  return axios.post('/api/session', credentials)\r\n}\r\n\r\nexport const signup = ({ commit, dispatch }, data) => {\r\n  return axios.post('/api/account', data)\r\n}\r\n\r\nexport const sendRestoreMail = ({ commit, dispatch }, email) => {\r\n  return axios.post('/api/account/restore', { email })\r\n}\r\n\r\nexport const confirmRestore = ({ commit }, credentials) => {\r\n  axios.post('/api/account/restore', credentials)\r\n  .then(() => {\r\n    router.push('/')\r\n  })\r\n  .catch(({ response }) => {\r\n    console.error(response)\r\n  })\r\n}\r\n\r\nexport const getAccount = ({ commit, dispatch, state }) => {\r\n  return new Promise((resolve, reject) => {\r\n    axios.get('/api/account')\r\n      .then(({ data }) => {\r\n        axios\r\n          .get('/api/cases/notification/1')\r\n          .then(res => commit('SET_HOTIFICATION_HISTORY', res.data))\r\n\r\n        data.socket = new WebSocket(`${location.protocol === 'https:' ? 'wss' : 'ws'}://${location.host}/websocket/userId=${data.id}`, [], {\r\n          maxReconnectionDelay: 10000,\r\n          minReconnectionDelay: 1000,\r\n          reconnectionDelayGrowFactor: 1.2,\r\n          connectionTimeout: 3000\r\n        })\r\n        data.socket.onmessage = (msg) => dispatch('proceedSocketMessage', msg.data)\r\n        data.socket.onerror = (error) => console.log('Ошибка соединения:' + JSON.stringify(error))\r\n        data.socket.onclose = (event) => {\r\n          if (event.wasClean) {\r\n            console.log('Соединение закрыто чисто')\r\n          } else {\r\n            console.log('Обрыв соединения')\r\n          }\r\n          console.log('Код: ' + event.code + ' причина: ' + JSON.stringify(event))\r\n        }\r\n        // Change locale on account load or change\r\n        Vue.config.lang = data.locale || 'ru'\r\n        moment.locale(data.locale)\r\n\r\n        if (data.access['admin']) {\r\n          const msg = {\r\n            type: 'admin_session',\r\n            author: data,\r\n            id: 'admin_' + data.id\r\n          }\r\n\r\n          commit('ADD_NOTIFICATION', msg)\r\n          setTimeout(() => { if (state.notifications.find(elem => elem.id === msg.id)) commit('SHIFT_NOTIFICATION') }, 10000)\r\n        }\r\n        resolve(commit('LOAD_ACCOUNT', data))\r\n\r\n        return axios.get('/api/autocompletes/collaborators')\r\n      })\r\n      .then(({ data }) => {\r\n        resolve(commit('SET_ALL_COLLABORATORS', data.collaborators))\r\n      })\r\n      .catch(reject)\r\n  })\r\n}\r\n\r\nexport const changeAccount = ({ commit, dispatch }, payload) => {\r\n  if (!payload.silentSave) {\r\n    commit('LOADING')\r\n  }\r\n  return new Promise((resolve, reject) => {\r\n    axios.put('/api/account', payload)\r\n      .then(() => {\r\n        if (payload.silentSave) {\r\n          return\r\n        }\r\n        if (payload.locale) {\r\n          commit('ACCOUNT_LOCALE_CHANGE', payload)\r\n          Vue.config.lang = payload.locale\r\n          moment.locale(payload.locale)\r\n        } else {\r\n          resolve(dispatch('getAccount'))\r\n        }\r\n      })\r\n      .catch(e => {\r\n        if (e.response.data.error === 'wrong_old_password') {\r\n          reject('wrong_old_password')\r\n        } else {\r\n          reject(e)\r\n        }\r\n      })\r\n  })\r\n}\r\n\r\nexport const changeAvatar = ({ commit, dispatch }, payload) => {\r\n  commit('LOADING')\r\n  axios.post('/api/account/avatar', payload)\r\n    .then(() => dispatch('getAccount'))\r\n    .catch(console.error)\r\n}\r\n\r\nexport const logout = ({ commit }) => {\r\n  axios.delete('/api/session')\r\n  .then(() => {\r\n    commit('LOGOUT')\r\n    router.push('/login')\r\n    commit('SHIFT_NOTIFICATION')\r\n  })\r\n}\r\n\r\n\r\n\r\n// WEBPACK FOOTER //\r\n// ./src/store/actions/account.js"],"mappings":"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"},"metadata":{},"sourceType":"module"}