{"ast":null,"code":"'use strict';\n/**\n * Module dependencies\n */\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nconst xtend = require('xtend');\n\nconst Readable = require('readable-stream').Readable;\n\nconst streamsOpts = {\n  objectMode: true\n};\nconst defaultStoreOptions = {\n  clean: true\n};\n/**\n * In-memory implementation of the message store\n * This can actually be saved into files.\n *\n * @param {Object} [options] - store options\n */\n\nfunction Store(options) {\n  if (!(this instanceof Store)) {\n    return new Store(options);\n  }\n\n  this.options = options || {}; // Defaults\n\n  this.options = xtend(defaultStoreOptions, options);\n  this._inflights = new Map();\n}\n/**\n * Adds a packet to the store, a packet is\n * anything that has a messageId property.\n *\n */\n\n\nStore.prototype.put = function (packet, cb) {\n  this._inflights.set(packet.messageId, packet);\n\n  if (cb) {\n    cb();\n  }\n\n  return this;\n};\n/**\n * Creates a stream with all the packets in the store\n *\n */\n\n\nStore.prototype.createStream = function () {\n  const stream = new Readable(streamsOpts);\n  const values = [];\n  let destroyed = false;\n  let i = 0;\n\n  this._inflights.forEach(function (value, key) {\n    values.push(value);\n  });\n\n  stream._read = function () {\n    if (!destroyed && i < values.length) {\n      this.push(values[i++]);\n    } else {\n      this.push(null);\n    }\n  };\n\n  stream.destroy = function () {\n    if (destroyed) {\n      return;\n    }\n\n    const self = this;\n    destroyed = true;\n    setTimeout(function () {\n      self.emit('close');\n    }, 0);\n  };\n\n  return stream;\n};\n/**\n * deletes a packet from the store.\n */\n\n\nStore.prototype.del = function (packet, cb) {\n  packet = this._inflights.get(packet.messageId);\n\n  if (packet) {\n    this._inflights.delete(packet.messageId);\n\n    cb(null, packet);\n  } else if (cb) {\n    cb(new Error('missing packet'));\n  }\n\n  return this;\n};\n/**\n * get a packet from the store.\n */\n\n\nStore.prototype.get = function (packet, cb) {\n  packet = this._inflights.get(packet.messageId);\n\n  if (packet) {\n    cb(null, packet);\n  } else if (cb) {\n    cb(new Error('missing packet'));\n  }\n\n  return this;\n};\n/**\n * Close the store\n */\n\n\nStore.prototype.close = function (cb) {\n  if (this.options.clean) {\n    this._inflights = null;\n  }\n\n  if (cb) {\n    cb();\n  }\n};\n\nmodule.exports = Store;","map":{"version":3,"names":["xtend","require","Readable","streamsOpts","objectMode","defaultStoreOptions","clean","Store","options","_inflights","Map","prototype","put","packet","cb","set","messageId","createStream","stream","values","destroyed","i","forEach","value","key","push","_read","length","destroy","self","setTimeout","emit","del","get","delete","Error","close","module","exports"],"sources":["C:/Users/Danil/Desktop/project1/node_modules/mqtt/lib/store.js"],"sourcesContent":["'use strict'\n\n/**\n * Module dependencies\n */\nconst xtend = require('xtend')\n\nconst Readable = require('readable-stream').Readable\nconst streamsOpts = { objectMode: true }\nconst defaultStoreOptions = {\n  clean: true\n}\n\n/**\n * In-memory implementation of the message store\n * This can actually be saved into files.\n *\n * @param {Object} [options] - store options\n */\nfunction Store (options) {\n  if (!(this instanceof Store)) {\n    return new Store(options)\n  }\n\n  this.options = options || {}\n\n  // Defaults\n  this.options = xtend(defaultStoreOptions, options)\n\n  this._inflights = new Map()\n}\n\n/**\n * Adds a packet to the store, a packet is\n * anything that has a messageId property.\n *\n */\nStore.prototype.put = function (packet, cb) {\n  this._inflights.set(packet.messageId, packet)\n\n  if (cb) {\n    cb()\n  }\n\n  return this\n}\n\n/**\n * Creates a stream with all the packets in the store\n *\n */\nStore.prototype.createStream = function () {\n  const stream = new Readable(streamsOpts)\n  const values = []\n  let destroyed = false\n  let i = 0\n\n  this._inflights.forEach(function (value, key) {\n    values.push(value)\n  })\n\n  stream._read = function () {\n    if (!destroyed && i < values.length) {\n      this.push(values[i++])\n    } else {\n      this.push(null)\n    }\n  }\n\n  stream.destroy = function () {\n    if (destroyed) {\n      return\n    }\n\n    const self = this\n\n    destroyed = true\n\n    setTimeout(function () {\n      self.emit('close')\n    }, 0)\n  }\n\n  return stream\n}\n\n/**\n * deletes a packet from the store.\n */\nStore.prototype.del = function (packet, cb) {\n  packet = this._inflights.get(packet.messageId)\n  if (packet) {\n    this._inflights.delete(packet.messageId)\n    cb(null, packet)\n  } else if (cb) {\n    cb(new Error('missing packet'))\n  }\n\n  return this\n}\n\n/**\n * get a packet from the store.\n */\nStore.prototype.get = function (packet, cb) {\n  packet = this._inflights.get(packet.messageId)\n  if (packet) {\n    cb(null, packet)\n  } else if (cb) {\n    cb(new Error('missing packet'))\n  }\n\n  return this\n}\n\n/**\n * Close the store\n */\nStore.prototype.close = function (cb) {\n  if (this.options.clean) {\n    this._inflights = null\n  }\n  if (cb) {\n    cb()\n  }\n}\n\nmodule.exports = Store\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}